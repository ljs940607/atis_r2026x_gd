define("DS/CfgConfigurationContextUX/CfgAttachedScopesView",["UWA/Class/View","UWA/Class/Collection","UWA/Date","UWA/Class/Model","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/Scroller","DS/Controls/Toggle","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgAutoComplete","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/modelProviders/CollectionViewUWACollectionModelProvider","DS/Tweakers/GeneratedToolbar","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],(function(e,t,i,a,n,o,r,l,s,c,d,u,C,p,h){"use strict";return e.extend({collection:null,className:"CfgEditConfigurationContextView",selectedModelsList:[],probesOperationList:[],caId:"",scopeDefination:a.extend({defaults:function(){return{id:null,type:"",marketingName:"",name:"",state:"",description:"",owner:"",label:"",subLabel:"",icon:"",thumbnail:"",maturity:"",isactive:!1}}}),setup:function(){},init:function(e,t,i,a,n,o){this._parent(e,t,i),this.probesOperationList=[],this.createCollection(e),this.variantCriteriaValue=t,this.selection=i,this.pandOAccess=a,this.enableRWNativeScope=n,this.isAttachContextReadOnly=o;this.isCriteriaModified=!1,d.get2((e=>{null!=e.isLicenseValid&&0==e.isLicenseValid||null!=e.AuthoringContextHeader&&null!=e.AuthoringContextHeader["DS-Change-Authoring-Context"]&&(this.caId=e.change.id,this.caOptions={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+this.caId}})}))},render:function(){this.selectedModelsList=[];let e=this,t=UWA.createElement("div",{class:"main-context-xrevision-container"});this.environment="Dashboard",window.enoviaServerFilterWidget.mode&&"Native"==window.enoviaServerFilterWidget.mode&&(this.environment="Native");let i=this.headercontainer=new UWA.createElement("div",{class:"xrevision-header-container",html:[{tag:"div",class:"xrevision-currCriteria-container"},{tag:"div",class:"toolbar-container"}]});this.container.addContent(i);var a=UWA.createElement("div",{class:"gridlistview-xrevision-scope-container",styles:{position:"absolute"}});if(this.AutocompleteContainer=UWA.createElement("div",{class:"autocompleteContainer"}),this.initializeModelSearchUI(this.AutocompleteContainer),this.AutocompleteContainer.hide(),this.container.addContent(this.AutocompleteContainer),t.addContent(a),new r({element:t}).inject(this.container),this.availableChangeControlledObjectsCount=0,"Native"!==window.enoviaServerFilterWidget.mode){var n=this.selection;s.getChangeControlledList(n).then((function(t){e.availableChangeControlledObjectsCount=t.length}))}return null!=this.variantCriteriaValue&&this.container.getElement(".xrevision-currCriteria-container").setContent(this.createCriteriaView()),"Native"==window.enoviaServerFilterWidget.mode?this.enableRWNativeScope&&1==this.enableRWNativeScope&&this.createToolbar():this.isAttachContextReadOnly||this.createToolbar(),this.refreshToolbar(),this.createView(),this.ScopeGridView=this.container.getElement(".gridlistview-xrevision-scope-container"),this.VariantScriteriaContainer=this.container.getElement(".varCritContent"),this.collection.addEvent("onAdd",(function(){e.createView()})),this.container},initializeModelSearchUI:function(e){const{autoComplete:t,searchBtn:i}=this.createAutocompleteWithSearch(e);this.modelSearchAutocomplete=t,this.modelSearchBtn=i,this.modelUXReady=!0},createAutocompleteWithSearch:function(e){let t={query:[{type:"Model",condition:'( NOT current:"Inactive")',excludedArray:[]}],searchTitle:h.selectConfigContext||"SearchTitleHere",mode:"configurationcontext",multiselection:!1,minLengthBeforeSearch:0,parentElement:e,showRevision:!0,callBackFunction:e=>this.autocompleteSearchCallback(e),clearInfo:()=>{}};this.CfgAutocompleteControlObj=new c(t);const{autoComplete:i,searchBtn:a}=this.CfgAutocompleteControlObj.render();return{autoComplete:i,searchBtn:a}},createToolbar:function(){this.toolBar&&this.toolBar.destroy();const e={entries:[{id:"CfgEditContextPlusIcon",icon:{iconName:"plus wux-ui-3ds",fontIconFamily:1,className:""},dataElements:{typeRepresentation:"functionIcon",tooltip:h.Attach,value:e=>this.plusIconCB(e),visibleFlag:!0},position:"far",domId:"CfgEditContextPlusIcon"},{id:"CfgEditContextTrashIcon",icon:{iconName:"trash wux-ui-3ds",fontIconFamily:1,className:""},dataElements:{typeRepresentation:"functionIcon",tooltip:h.Detach,value:e=>this.trashIconCB(e),visibleFlag:!1},position:"far",domId:"CfgEditContextTrashIcon"}]};var t=p.prototype.createTreeDocument(e);this.toolBar=new p({direction:"horizontal",items:t}),this.toolBar.inject(this.container.getElement(".toolbar-container"))},createCriteriaView:function(){let e=this,t=this.variantCritView=new UWA.createElement("div",{class:"variantCrit-xRevision-container",html:[{tag:"div",class:"varCritContainer",html:['<h5 class="varCritHeader">'+h.Variants+"</h5>",{tag:"div",class:"varCritContent"}]}]}),i=this.criteriaContent=new UWA.createElement("div",{class:"main-CriteriaContent"});this.Spinner=new o({className:"Spinners"}).inject(i),t.inject(this.criteriaContent);let a=t.getElement(".varCritContent");a.setContent("");var n=!1;return"Native"==window.enoviaServerFilterWidget.mode&&"enabled"===this.variantCriteriaValue&&(n=!0),"disabled"===this.variantCriteriaValue&&0==this.collection.length&&(n=!0),this.featureCheckbox=new l({type:"checkbox",value:"feature",className:"primary",checkFlag:"disabled"!==this.variantCriteriaValue,disabled:n,label:h.Variant_Options,mixedState:"mixedState"===this.variantCriteriaValue}).inject(a),1==this.featureCheckbox.disabled&&this.criteriaContent.addClassName("cfg-readonly-criteria"),this.featureCheckbox.addEventListener("click",(function(t){e.setUnsetCriteria()})),i},updateVariantCriteriaUX:function(e){1==e.enabled?(this.featureCheckbox.checkFlag=!0,this.featureCheckbox.disabled=!1,this.criteriaContent.removeClassName("cfg-readonly-criteria"),this.variantCriteriaValue="enabled"):1==e.enabledOnCollection?(this.featureCheckbox.disabled=!1,this.criteriaContent.removeClassName("cfg-readonly-criteria")):(this.featureCheckbox.checkFlag=!1,this.featureCheckbox.disabled=!0,this.criteriaContent.addClassName("cfg-readonly-criteria"),this.variantCriteriaValue="disabled")},setUnsetCriteria:function(){let e=this,t="Native",i="Rich Client Applications",a="NATIVEWIW";if(widget&&widget.data&&widget.data.appId&&(t=widget.data.appId),widget&&widget.options&&widget.options.title&&(i=widget.options.title),"Dashboard"==e.environment&&(a="DASHBOARD"),this.isCriteriaModified=!0,"Native"==window.enoviaServerFilterWidget.mode)e.variantCriteriaValue=e.featureCheckbox.checkFlag?"enabled":"disabled","enabled"==e.variantCriteriaValue?e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Enable_Variant_Criteria",ApplicationMode:a}):e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Disable_Variant_Criteria",ApplicationMode:a});else{let o=[];for(let t=0;t<e.selection.length;t++)o.push(e.selection[t].id);n.mask(this.criteriaContent),!e.featureCheckbox.checkFlag?e.setVariantCriteria("DisableVariantCriteria",o).then((function(o){"SUCCEED"==o.result&&null!=o.details&&o.details.length>0&&null!=o.details[0].contexts&&null!=o.details[0].contexts.xRevisionContent&&"disabled"==o.details[0].contexts.xRevisionContent.variantCriteria?(e.featureCheckbox.checkFlag=!1,e.variantCriteriaValue="disabled"):e.featureCheckbox.checkFlag=!0,n.unmask(e.criteriaContent),e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Disable_Variant_Criteria",ApplicationMode:a})}),(function(){e.featureCheckbox.checkFlag=!0,s.showwarning(h.DisableVariantCriteriaFailGeneric,"error"),n.unmask(e.criteriaContent)})):e.setVariantCriteria("EnableVariantCriteria",o).then((function(o){"SUCCEED"==o.result&&null!=o.details&&o.details.length>0&&null!=o.details[0].contexts&&null!=o.details[0].contexts.xRevisionContent&&"enabled"==o.details[0].contexts.xRevisionContent.variantCriteria?(e.featureCheckbox.checkFlag=!0,e.variantCriteriaValue="enabled"):e.featureCheckbox.checkFlag=!1,n.unmask(e.criteriaContent),e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Enable_Variant_Criteria",ApplicationMode:a})}),(function(){e.featureCheckbox.checkFlag=!1,s.showwarning(h.EnableVariantCriteriaFailGeneric,"error"),n.unmask(e.criteriaContent)}))}},setConfigurationContext:function(e,t,i,a){let n=[],o=[],r=[];return null!=t&&null!=t&&(n=t),"AddContext"==e&&null!=i&&null!=i?o=i:"RemoveContext"==e&&null!=i&&null!=i&&(r=i),new Promise((function(e,t){var i={version:"1.3",pidList:n,xRevisionContent:{attachScopes:o,detachScopes:r}};i=JSON.stringify(i);s.makeWSCall("/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1","POST","enovia","application/json",i,(function(t){e(t)}),(function(e,i){t(i||e)}),!0,a)}))},setVariantCriteria:function(e,t){let i=[],a="";return null!=t&&null!=t&&(i=t),"EnableVariantCriteria"==e?a="enable":"DisableVariantCriteria"==e&&(a="disable"),new Promise((function(e,t){var n={version:"1.3",pidList:i,xRevisionContent:{variantCriteria:a}};n=JSON.stringify(n);s.makeWSCall("/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1","POST","enovia","application/json",n,(function(t){e(t)}),(function(e,i){t(i||e)}),!0)}))},checkisMultipleModelSelected:function(e){let t={isValidType:!0,errorMassage:"",typeOfObject:""};return e.length>1&&(t.isValidType=!1,t.errorMassage=h.CfgErrorMultipleScopes),t},autocompleteSearchCallback:async function(e){var t=[],i=this;let a="Native",o="Rich Client Applications",r="NATIVEWIW";if(widget&&widget.data&&widget.data.appId&&(a=widget.data.appId),widget&&widget.options&&widget.options.title&&(o=widget.options.title),"Dashboard"==i.environment&&(r="DASHBOARD"),"Native"==window.enoviaServerFilterWidget.mode){var l,c="",d=e.sublabel?jsonresponse.sublabel:"",u="",C="",p="",g=[];e.length>0&&g.push(e.at(0).get("dispvalue")),g&&Array.isArray(g)&&g.length>0&&(l=await s.readNLSvaluesOfAttributes(g));var f={};if(e.length>0){c=e.at(0).get("ID"),f.type=e.at(0).get("type"),f.image=e.at(0).get("image"),f.marketingName=e.at(0).get("label"),f.name=e.at(0).get("name"),f.owner=e.at(0).get("owner");let t=e.at(0).get("dispvalue");if(l&&l["ds6w:status"]){let e=l["ds6w:status"][t];e?f.state=e:-1!=t.indexOf("Model.")&&(f.state=t.split("Model.").pop())}else-1!=t.indexOf("Model.")&&(f.state=t.split("Model.").pop());if(C=f.image,p=f.type,e.at(0).get("modified")){let t=e.at(0).get("modified");t&&(u=i.getFormatedDate(t))}}var m=new i.scopeDefination({id:c,type:f.type||"",marketingName:f.marketingName||"",name:f.name||"",state:f.state,description:"",owner:f.owner,label:f.marketingName,subLabel:d,thumbnail:"",maturity:f.state,isactive:!1,dateModified:u,preview_url:C,icon:p,isToPropagate:!1});i.collection.add(m),i.collection.isCollectionModified=!0,i.probesOperationList.push({AppId:a,AppName:o,CommandOperation:"Add_EffectivityBased_Scopes_With_Type_Ahead",ApplicationMode:r});let t={enabled:!0};i.updateVariantCriteriaUX(t),i.changeScopeVisibility()}else{i.ItemFromType=e;let l=i.checkisMultipleModelSelected(e);if(0==l.isValidType)return void s.showwarning(l.errorMassage,"error");for(let i=0;i<e.length;i++)t.push(e.at(i).get("ID"));let c=[];for(var v=0;v<i.selection.length;v++)c.push(i.selection[v].id);let d=null;""!=this.caId&&(d=this.caOptions),t.length>0&&i.setConfigurationContext("AddContext",c,t,d).then((function(e){"SUCCEED"==e.result?(i.onattach(i,e,"SUCCEED"),n.unmask(i.container),i.probesOperationList.push({AppId:a,AppName:o,CommandOperation:"Add_EffectivityBased_Scopes_With_Type_Ahead",ApplicationMode:r})):(s.showwarning(h.AttachFailed,"error"),n.unmask(i.container))}),(function(){s.showwarning(h.AttachFailed,"error"),n.unmask(i.container)}))}},onattach:function(e,t){let i=enoviaServerFilterWidget.baseURL,a="";for(var n=0;n<t.details.length;n++){for(var o=0;o<t.details[n].contexts.xRevisionContent.scopes.length;o++){let s="",c="";var r=t.details[n].contexts.xRevisionContent.scopes[o];if(null!=r.attributes[0].type_icon_url&&-1==r.attributes[0].type_icon_url.indexOf(i)&&(c=i+r.attributes[0].type_icon_url),null!=r.attributes[0].type_icon_large_url&&-1==r.attributes[0].type_icon_large_url.indexOf(i)&&(s=i+r.attributes[0].type_icon_large_url),null==r.attributes[0].preview_url&&(r.preview_url=e.defaultImage),""==r.attributes[0].preview_url&&(r.preview_url=""!=s?s:e.defaultImage),"attached"==r.status||r.attributes&&r.attributes.length>0){let t,i,a,n,o=r.attributes[0],s="",c="",d="",u="",C="";var l;let p=o.basicData.length;for(let r=0;r<p;r++)if("name"==o.basicData[r].name&&null!=o.basicData[r].value&&(t=i=a=s=o.basicData[r].value[0]),"current"==o.basicData[r].name&&null!=o.basicData[r].value&&(d=o.basicData[r].value[0]),"owner"==o.basicData[r].name&&null!=o.basicData[r].value&&(n=o.basicData[r].value[0]),"modified"==o.basicData[r].name&&null!=o.basicData[r].value){let t=o.basicData[r].value[0];t&&(u=e.getFormatedDate(t))}o.data[0]&&o.data[0].value&&(s=o.data[0].value[0]),l=new e.scopeDefination({id:r.attributes[0].physicalID,type:r.attributes[0].type,marketingName:s,name:i,state:d,description:C,owner:n,label:i,subLabel:i,thumbnail:"",maturity:d,isactive:!1,preview_url:r.preview_url,dateModified:u,icon:""!=c?c:e.defaultIcon,isToPropagate:!1}),e.collection.add(l),e.collection.isCollectionModified=!0}"ERROR"==r.status&&(a=r.errorMessage)}""!=a&&s.showNotifs("warning","",a);let c={enabled:!1,enabledOnCollection:!0};null!=t.details[n]&&null!=t.details[n].contexts&&null!=t.details[n].contexts.xRevisionContent&&"enabled"==t.details[n].contexts.xRevisionContent.variantCriteria&&(c.enabled=!0),e.updateVariantCriteriaUX(c),delete c.enabledOnCollection,e.changeScopeVisibility()}},ondetach:function(e,t,i){var a=!1,n=0;let o="";for(var r=[],l=[],c=0;c<t.details.length;c++)for(var d=0;d<t.details[c].contexts.xRevisionContent.scopes.length;d++){var u=t.details[c].contexts.xRevisionContent.scopes[d];if("detached"==u.status){var C=u.scopePID,p=e.selectedModelsList.indexOf(C);-1==r.indexOf(C)&&(r.push(C),n++),"SUCCEED"==i&&(-1!==p&&e.selectedModelsList.splice(p,1),a=!0,e.collection.remove(C),e.collection.isCollectionModified=!0)}else"ERROR"==u.status&&-1==l.indexOf(u.scopePID)&&(l.push(u.scopePID),o=u.errorMessage)}if(null!=r.length&&r.length>=1&&l.forEach((function(e,t){-1!=r.indexOf(l[t])&&r.pop(l[t])})),r.forEach((function(t,i){var n=e.selectedModelsList.indexOf(r[i]);-1!==n&&e.selectedModelsList.splice(n,1),a=!0,e.collection.remove(r[i])})),"FAILED"==t.result&&n>=1?(e.collection.isCollectionModified=!0,s.showwarning(h.PartialDetachFailed,"info")):l.length>0&&""!=o&&s.showwarning(o,"error"),1==a){for(d=0;d<e.selectedModelsList.length;d++)e.collection.get(e.selectedModelsList[d])._attributes.isactive=!1;e.selectedModelsList=[];let t={enabled:!1};e.updateVariantCriteriaUX(t)}e.changeScopeVisibility()},changeScopeVisibility:function(){this.collection.length<=0?this.ScopeGridView.setStyle("display","none"):(this.ScopeGridView.setStyle("display","flex"),this.VariantScriteriaContainer.setStyle("display","flex")),this.refreshToolbar()},refreshToolbar:function(){if(this.toolBar){var e=this;e.selectedModelsList.length<=0?e.toolBar.updateNodeModel("CfgEditContextTrashIcon",{visibleFlag:!1}):e.toolBar.updateNodeModel("CfgEditContextTrashIcon",{visibleFlag:!0}),this.collection.length<=0?e.toolBar.updateNodeModel("CfgEditContextPlusIcon",{visibleFlag:!0}):(e.toolBar.updateNodeModel("CfgEditContextPlusIcon",{visibleFlag:!1}),e.AutocompleteContainer.hide())}},addContextToggle:function(){var e=this;e.AutocompleteContainer.isHidden()?(e.toolBar.updateNodeModel("CfgEditContextPlusIcon",{icon:{className:"addContextActivePlus"}}),e.AutocompleteContainer.show(),e.CfgAutocompleteControlObj.setFocus()):(e.toolBar.updateNodeModel("CfgEditContextPlusIcon",{icon:{className:""}}),e.AutocompleteContainer.hide())},createView:function(){var e=this,i=e.collection,a=[];e.myResponsiveTilesCollectionView=new u,e.myResponsiveTilesCollectionView.modelProvider=new C,i.forEach((function(e){e._attributes.isactive=!1;var t=[],i=[];let n,o;1==e._attributes.isToPropagate&&(t.push("propagate"),i.push(h.PropagateModelTooltip)),o=h.Tootip_Title+" : "+e.get("marketingName")+"\n"+h.Tootip_Name+" : "+e.get("name")+"\n"+h.Tootip_Owner+" : "+e.get("owner")+"\n"+h.Tootip_Maturity+" : "+e.get("maturity")+"\n"+h.Tootip_Modification_Date+" : "+e.get("dateModified"),n={label:e.get("marketingName"),customTooltip:o,icon:e.get("icon"),picture:e.get("preview_url"),subLabel:e.get("name")+" | "+e.get("owner"),description:e.get("maturity")+" | "+e.get("dateModified"),statusbarIcons:t,statusbarIconsTooltips:i,contextualMenu:[],propertiesList:["propertiesList1"],emptyStatusbarVisibleFlag:!0,modelData:e},a.push(n)})),e.tileCollection=new t,e.tileCollection.push(a),e.myResponsiveTilesCollectionView.loadApplicativeModel(e.tileCollection),e.myResponsiveTilesCollectionView.onSelectionAdd((function(t){var i=t._attributes;e.onscopetileviewclick(t,i)})),e.myResponsiveTilesCollectionView.onSelectionRemove((function(t){var i=t._attributes;e.onscopetileviewclick(t,i)})),e.myResponsiveTilesCollectionView.inject(e.container.getElement(".gridlistview-xrevision-scope-container"))},getDefaultImage:function(){this.defaultImage=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png",this.defaultIcon=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png"},onscopetileviewclick:function(e,t){var i;1==t.modelData._attributes.isactive?(t.modelData._attributes.isactive=!1,-1!==(i=this.selectedModelsList.indexOf(t.modelData.id))&&this.selectedModelsList.splice(i,1)):(t.modelData._attributes.isactive=!0,-1==(i=this.selectedModelsList.indexOf(t.modelData.id))&&this.selectedModelsList.push(t.modelData.id));this.refreshToolbar()},createCollection:function(e){let i,a,n=this,o=[];a=e,null!=a&&a.length>0&&a.forEach((function(e){if(e&&e.scopePID&&e.attributes&&e.attributes.length>0){let t,a,r,l,s,c,d=e.attributes[0],u="",C="",p="",h="",g="",f=d.basicData.length;for(let e=0;e<f;e++){let i=d.basicData[e].name,o=Array.isArray(d.basicData[e].value)?d.basicData[e].value[0]:d.basicData[e].value;if("ds6w:what/ds6w:type"!=i&&"type"!=i||!o||(p=o),"name"==i&&o&&(t=a=r=u=o),"owner"==i&&o&&(s=o),"Native"==window.enoviaServerFilterWidget.mode){if("ds6w:what/ds6w:status"==i){let e="";for(let t=d.basicData.length-1;t>=0;t--)if("current"===d.basicData[t].name){e=d.basicData[t].value[1];break}e?c=e:-1!=o.indexOf("Model.")&&(c=o.split("Model.").pop())}"ds6w:when/ds6w:modified"==i&&o&&(h=n.getFormatedDate(o))}else"current"==i&&o&&(c=o),"modified"==i&&o&&o&&(h=n.getFormatedDate(o))}d.data[0]&&d.data[0].value&&(u=d.data[0].value[0]),C=null==d.preview_url||null==d.preview_url||""==d.preview_url?n.defaultImage:d.preview_url,null!=d.type_icon_large_url&&(C=d.type_icon_large_url),null!=d.type_icon_url&&(l=d.type_icon_url),i={id:e.scopePID,type:p||"",marketingName:u||"",name:a||"",state:c,description:g||"",owner:s,label:t,subLabel:r,thumbnail:"",maturity:c,isactive:!1,preview_url:C,dateModified:h,icon:n.defaultIcon},""!=l&&(i.icon=l),o.push(i)}})),this.collection=new t(o,{model:this.scopeDefination}),this.collection.isCollectionModified=!1},getFormatedDate:function(e){var t="";t="Native"==window.enoviaServerFilterWidget.mode?e.split("T")[0]:e.split("@")[0];var a=Date.parse(t),n=parseInt(a),o=new Date(n);return i.strftime(o,"%Y-%m-%d")},getModelIdsAndEnabledCriteria:function(e){var t=[];this.collection.forEach((function(e,i){t.push(e.id)}));var i=[];this.collection.forEach((function(e,t){e.get("isToPropagate")||i.push(e.id)}));var a=[];"enabled"==this.variantCriteriaValue&&a.push("feature");var n=[];return"enabled"==this.variantCriteriaValue&&n.push("feature"),{modelIds:t,enabledCriteria:n,modelIdsCommon:i,criteriaCommon:a,isContextOrCriteriaModified:this.checkisContextOrCriteriaModified()}},checkisContextOrCriteriaModified:function(){return 1==this.isCriteriaModified||1==this.collection.isCollectionModified},plusIconCB:function(e){let t=null,i="Native",a="Rich Client Applications",o="NATIVEWIW";widget&&widget.data&&widget.data.appId&&(i=widget.data.appId),widget&&widget.options&&widget.options.title&&(a=widget.options.title),this.CfgAutocompleteControlObj.options&&"Dashboard"==this.CfgAutocompleteControlObj.options.environment&&(o="DASHBOARD"),""!=this.caId&&(t=this.caOptions),null==t&&this.availableChangeControlledObjectsCount>0&&this.selection.length==this.availableChangeControlledObjectsCount?(s.showwarning(h.CfgErrorChangeControlled,"error"),this.myResponsiveTilesCollectionView.unselectAll(),n.unmask(this.container)):this.pandOAccess&&"Not Granted"==this.pandOAccess.AttachModels?(s.showwarning(CfgBaseUXNLS.CfgMessageAccessRightsError,"error"),this.myResponsiveTilesCollectionView.unselectAll(),n.unmask(this.container)):(this.addContextToggle(),this.AutocompleteContainer.isHidden()||this.probesOperationList.push({AppId:i,AppName:a,CommandOperation:"Add_EffectivityBased_Scopes_Plus_Icon_Click",ApplicationMode:o}))},trashIconCB:function(e){n.mask(this.container);let t=null,i="Native",a="Rich Client Applications",o="NATIVEWIW";if(widget&&widget.data&&widget.data.appId&&(i=widget.data.appId),widget&&widget.options&&widget.options.title&&(a=widget.options.title),this.CfgAutocompleteControlObj.options&&"Dashboard"==this.CfgAutocompleteControlObj.options.environment&&(o="DASHBOARD"),""!=this.caId&&(t=this.caOptions),null==t&&this.availableChangeControlledObjectsCount>0&&this.selection.length==this.availableChangeControlledObjectsCount)s.showwarning(h.CfgErrorChangeControlled,"error"),this.myResponsiveTilesCollectionView.unselectAll(),n.unmask(this.container);else if(this.pandOAccess&&"Not Granted"==this.pandOAccess.DetachModels)s.showwarning(CfgBaseUXNLS.CfgMessageAccessRightsError,"error"),this.myResponsiveTilesCollectionView.unselectAll(),n.unmask(this.container);else if(this.selectedModelsList.length>0){let e=this;if("Native"==window.enoviaServerFilterWidget.mode){let t=e.selectedModelsList;for(let l=0;l<t.length;){var r=t[l];t.splice(0,1),e.collection.remove(r),e.collection.isCollectionModified=!0,e.probesOperationList.push({AppId:i,AppName:a,CommandOperation:"Remove_EffectivityBased_Scopes_Success",ApplicationMode:o}),e.selectedModelsList=[];let s={enabled:!1};e.updateVariantCriteriaUX(s),e.changeScopeVisibility(),n.unmask(e.container)}}else{var l=[];for(let t=0;t<e.selection.length;t++)l.push(e.selection[t].id);e.setConfigurationContext("RemoveContext",l,e.selectedModelsList,t).then((function(t){"SUCCEED"==t.result?(e.ondetach(e,t,"SUCCEED"),n.unmask(e.container),e.probesOperationList.push({AppId:i,AppName:a,CommandOperation:"Remove_EffectivityBased_Scopes_Success",ApplicationMode:o})):"FAILED"==t.result?(e.ondetach(e,t,"FAILED"),n.unmask(e.container),console.log("Detach scope failed."),e.probesOperationList.push({AppId:i,AppName:a,CommandOperation:"Remove_EffectivityBased_Scopes_Fail",ApplicationMode:o})):(s.showwarning(h.DetachFailed,"error"),n.unmask(e.container),console.log("Detach scope total failed."),e.probesOperationList.push({AppId:i,AppName:a,CommandOperation:"Remove_EffectivityBased_Scopes_Fail",ApplicationMode:o}))}),(function(t){if(t.errorMessage){var r=t.errorMessage;s.showwarning(r,"error")}else s.showwarning(h.DetachFailed,"error");n.unmask(e.container),e.probesOperationList.push({AppId:i,AppName:a,CommandOperation:"Remove_EffectivityBased_Scopes_Fail",ApplicationMode:o})}))}}}})})),define("DS/CfgConfigurationContextUX/CfgConfigurationContextCriteria",["DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/View","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","DS/Controls/Toggle","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],(function(e,t,i,a,n,o,r,l){"use strict";return n.extend({collection:null,className:"CfgConfigurationContextCriteria",enabledCriteria:{feature:"false",productState:"false",unit:"false",contextualDate:"false",milestone:"false",manufacturingPlan:"false"},setup:function(){},init:function(e){var t=this;this.alertDiv=new i({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"}),this.options=e,this.isCriteriaModified=!1,this.enabledCriteriaFromNative=JSON.parse(JSON.stringify(e.enabledCriterias));if(o.get2((function(e){console.log(e),null!=e.isLicenseValid&&0==e.isLicenseValid||(t.caid=e.change.id)})),t.availableChangeControlledObjectsCount=0,"Native"!==window.enoviaServerFilterWidget.mode){var n=this.options.selection;a.getChangeControlledList(n).then((function(e){t.availableChangeControlledObjectsCount=e.length}))}},render:function(e){this.collection=e;return this.createCriteriaView()},getActiveCriteria:function(){var e=r.ActivatedCriteria,t=this.ROCriteriaView=new UWA.createElement("div",{class:"ROCriteria-container",title:e,html:e});return this.renderActiveCriteria(this.options.enabledCriterias),t},renderActiveCriteria:function(e){var t="<b>"+r.ActivatedCriteria+"  :  </b>",i="";("true"===e.productState||"mixedState"===e.productState)&&(i+=r.Product_state+", "),("true"===e.manufacturingPlan||"mixedState"===e.manufacturingPlan)&&(i+=r.Manufacturing_Plan+", "),("true"===e.contextualDate||"mixedState"===e.contextualDate)&&(i+=r.Date+", "),("true"===e.milestone||"mixedState"===e.milestone)&&(i+=r.Milestone+", "),("true"===e.unit||"mixedState"===e.unit)&&(i+=r.Unit+", "),("true"===e.feature||"mixedState"===e.feature)&&(i+=r.Variant_Options+", "),i=i.replace(/,\s*$/,""),this.ROCriteriaView.setContent(t+i),this.ROCriteriaView.setAttributes({title:i})},onResize:function(){this.criteriaContent&&"none"!=this.criteriaContent.getParent().getStyle("display")&&(this.criteriaContent.getParent().offsetWidth<=448?(this.criteriaContent.addClassName("main-CriteriaContent-mobilemode"),this.evolutionCritView&&this.evolutionCritView.addClassName("evolutionCrit-containert-mobilemode"),this.variantCritView&&this.variantCritView.addClassName("variantCrit-container-mobilemode")):(this.criteriaContent.removeClassName("main-CriteriaContent-mobilemode"),this.evolutionCritView&&this.evolutionCritView.removeClassName("evolutionCrit-containert-mobilemode"),this.variantCritView&&this.variantCritView.removeClassName("variantCrit-container-mobilemode")))},createCriteriaView:function(){var t=this,i=this.evolutionCritView=new UWA.createElement("div",{class:"evolutionCrit-container",html:[{tag:"div",class:"evoCritContainer",html:['<h5 class="evoCritHeader">'+r.Evolution+"</h5>",{tag:"div",class:"evoCritContent"}]}]}),n=this.separator=new UWA.createElement("div",{class:"separator-line",styles:{Float:"left",height:"inherit",width:"1px","background-color":" #e2e4e3",margin:"0px 2px"}}),o=this.variantCritView=new UWA.createElement("div",{class:"variantCrit-container",html:[{tag:"div",class:"varCritContainer",html:['<h5 class="varCritHeader">'+r.Variants+"</h5>",{tag:"div",class:"varCritContent"}]}]}),l=this.criteriaContent=new UWA.createElement("div",{class:"main-CriteriaContent"});this.Spinner=new e({className:"Spinners"}).inject(l),i.inject(this.criteriaContent),n.inject(this.criteriaContent),o.inject(this.criteriaContent);var s=t.options.enabledCriterias?t.options.enabledCriterias:t.enabledCriteria;return t.enabledCriteriasUX=s,a.checkDecouplingActivation().then((function(e){t.AllowedCriteria=e,t.renderCriteriaView(t.enabledCriteriasUX),t.criteriaContent.addEvent("resize",(function(){t.onResize()}))})),l},updateCollection:function(e,t){this.collection=e,UWA.is(t)&&(this.enabledCriteriasUX=t,this.renderActiveCriteria(this.enabledCriteriasUX)),0==this.collection.length&&"Native"==window.enoviaServerFilterWidget.mode&&(this.enabledCriteriaFromNative=this.enabledCriteriasUX=JSON.parse(JSON.stringify(this.enabledCriteria)))},renderCriteriaViewNative:function(e){var t=this,i=t.enabledCriteriasUX,a=t.evolutionCritView.getElement(".evoCritContent"),n=t.variantCritView.getElement(".varCritContent");t.evolutionCritView.getElement(".evoCritHeader"),t.variantCritView.getElement(".varCritHeader");n.setContent(""),a.setContent(""),e.indexOf("products")>=0||-1==e.indexOf("products")&&"true"==i.productState?(t.productstateCheckbox=new l({type:"checkbox",value:"productState",className:"primary",checkFlag:"true"===i.productState||"mixedState"===i.productState,label:r.Product_state,mixedState:"mixedState"===i.productState,disabled:"true"==t.enabledCriteriaFromNative.productState}).inject(a),t.productstateCheckbox.elements.container.classList.add("productStateCheckBox"),t.productstateCheckbox.addEventListener("click",(function(e){"mixedState"==t.enabledCriteriasUX[t.productstateCheckbox.value]&&t.productstateCheckbox.checkFlag&&(t.productstateCheckbox.disabled=!0),t.setUnsetCriteria(t.productstateCheckbox)}))):(t.enabledCriteriasUX.productState="false",t.enabledCriteriaFromNative.productState="false"),(e.indexOf("manufacturingPlans")>=0||-1==e.indexOf("manufacturingPlans")&&"true"==i.manufacturingPlan)&&t.options.IsManufPlanAllowedFromNative?(t.manufacturingPlanCheckbox=new l({type:"checkbox",value:"manufacturingPlan",className:"primary",checkFlag:"true"===i.manufacturingPlan||"mixedState"===i.manufacturingPlan,label:r.Manufacturing_Plan,mixedState:"mixedState"===i.manufacturingPlan,disabled:"true"==t.enabledCriteriaFromNative.manufacturingPlan}).inject(a),t.manufacturingPlanCheckbox.elements.container.classList.add("manufacturingPlanCheckBox"),t.manufacturingPlanCheckbox.addEventListener("click",(function(e){"mixedState"==t.enabledCriteriasUX[t.manufacturingPlanCheckbox.value]&&t.manufacturingPlanCheckbox.checkFlag&&(t.manufacturingPlanCheckbox.disabled=!0),t.setUnsetCriteria(t.manufacturingPlanCheckbox)}))):(t.enabledCriteriasUX.manufacturingPlan="false",t.enabledCriteriaFromNative.manufacturingPlan="false"),t.AllowedCriteria.contextualDate?(t.contextualDatebox=new l({type:"checkbox",value:"contextualDate",className:"primary",checkFlag:"true"===i.contextualDate||"mixedState"===i.contextualDate,label:r.Date,mixedState:"mixedState"===i.contextualDate,disabled:"true"==t.enabledCriteriaFromNative.contextualDate}).inject(a),t.contextualDatebox.elements.container.classList.add("contextualDateCheckBox"),t.contextualDatebox.addEventListener("click",(function(e){"mixedState"==t.enabledCriteriasUX[t.contextualDatebox.value]&&t.contextualDatebox.checkFlag&&(t.contextualDatebox.disabled=!0),t.setUnsetCriteria(t.contextualDatebox)}))):(t.enabledCriteriasUX.contextualDate="false",t.enabledCriteriaFromNative.contextualDate="false"),t.AllowedCriteria.unit&&e.indexOf("builds")>=0||-1==e.indexOf("builds")&&"true"==i.unit?(t.unitCheckbox=new l({type:"checkbox",value:"unit",className:"primary",checkFlag:"true"===i.unit||"mixedState"===i.unit,label:r.Unit,mixedState:"mixedState"===i.unit,disabled:"true"==t.enabledCriteriaFromNative.unit}).inject(a),t.unitCheckbox.elements.container.classList.add("unitCheckBox"),t.unitCheckbox.addEventListener("click",(function(e){"mixedState"==t.enabledCriteriasUX[t.unitCheckbox.value]&&t.unitCheckbox.checkFlag&&(t.unitCheckbox.disabled=!0),t.setUnsetCriteria(t.unitCheckbox)}))):(t.enabledCriteriasUX.unit="false",t.enabledCriteriaFromNative.unit="false"),e.indexOf("variant")>=0||-1==e.indexOf("variant")&&"true"==i.feature?(t.featureCheckbox=new l({type:"checkbox",value:"feature",className:"primary",checkFlag:"true"===i.feature||"mixedState"===i.feature,label:r.Variant_Options,mixedState:"mixedState"===i.feature,disabled:"true"==t.enabledCriteriaFromNative.feature}).inject(n),t.featureCheckbox.elements.container.classList.add("featureCheckBox"),t.featureCheckbox.addEventListener("click",(function(e){"mixedState"==t.enabledCriteriasUX[t.featureCheckbox.value]&&t.featureCheckbox.checkFlag&&(t.featureCheckbox.disabled=!0),t.setUnsetCriteria(t.featureCheckbox)}))):(t.enabledCriteriasUX.feature="false",t.enabledCriteriaFromNative.feature="false"),t.renderActiveCriteria(t.enabledCriteriasUX)},renderCriteriaView:function(){var e=this;new Promise((function(t,i){var n=[];e.collection.forEach((function(e,t){n.push({id:"pid:"+e.id})}));var o={version:"1.0.0",modelIds:n};o=JSON.stringify(o);a.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",o,(function(e){t(e)}),(function(e){console.log("fail to get last product evolution")}),!0)})).then((function(t){var i=e.enabledCriteriasUX,a=t,n=[];for(var o in a.criteria){var s=a.criteria[o],c=Object.keys(s);for(var d in c)"TRUE"!=s[c[d]]&&"True"!=s[c[d]]||-1!=n.indexOf(c[d])||n.push(c[d])}if("Native"==window.enoviaServerFilterWidget.mode)e.renderCriteriaViewNative(n);else{var u=e.evolutionCritView.getElement(".evoCritContent"),C=e.variantCritView.getElement(".varCritContent");e.evolutionCritView.getElement(".evoCritHeader"),e.variantCritView.getElement(".varCritHeader");C.setContent(""),u.setContent(""),(n.indexOf("products")>=0||-1==n.indexOf("products")&&"true"==i.productState)&&(e.productstateCheckbox=new l({type:"checkbox",value:"productState",className:"primary",checkFlag:"true"===i.productState||"mixedState"===i.productState,label:r.Product_state,mixedState:"mixedState"===i.productState,disabled:-1==n.indexOf("products")&&"true"==i.productState}).inject(u),e.productstateCheckbox.elements.container.classList.add("productStateCheckBox"),e.productstateCheckbox.addEventListener("click",(function(t){this.hasAttribute("disabled")||e.setUnsetCriteria(e.productstateCheckbox)}))),(n.indexOf("manufacturingPlans")>=0||-1==n.indexOf("manufacturingPlans")&&"true"==i.manufacturingPlan)&&(e.manufacturingPlanCheckbox=new l({type:"checkbox",value:"manufacturingPlan",className:"primary",checkFlag:"true"===i.manufacturingPlan||"mixedState"===i.manufacturingPlan,label:r.Manufacturing_Plan,mixedState:"mixedState"===i.manufacturingPlan,disabled:-1==n.indexOf("manufacturingPlans")&&"true"==i.manufacturingPlan}).inject(u),e.manufacturingPlanCheckbox.elements.container.classList.add("manufacturingPlanCheckBox"),e.manufacturingPlanCheckbox.addEventListener("click",(function(t){this.hasAttribute("disabled")||e.setUnsetCriteria(e.manufacturingPlanCheckbox)}))),e.AllowedCriteria.contextualDate&&(e.contextualDatebox=new l({type:"checkbox",value:"contextualDate",className:"primary",checkFlag:"true"===i.contextualDate||"mixedState"===i.contextualDate,label:r.Date,mixedState:"mixedState"===i.contextualDate}).inject(u),e.contextualDatebox.elements.container.classList.add("contextualDateCheckBox"),e.contextualDatebox.addEventListener("click",(function(t){this.hasAttribute("disabled")||e.setUnsetCriteria(e.contextualDatebox)}))),(e.AllowedCriteria.unit&&n.indexOf("builds")>=0||-1==n.indexOf("builds")&&"true"==i.unit)&&(e.unitCheckbox=new l({type:"checkbox",value:"unit",className:"primary",checkFlag:"true"===i.unit||"mixedState"===i.unit,label:r.Unit,mixedState:"mixedState"===i.unit,disabled:-1==n.indexOf("builds")&&"true"==i.unit}).inject(u),e.unitCheckbox.elements.container.classList.add("unitCheckBox"),e.unitCheckbox.addEventListener("click",(function(t){this.hasAttribute("disabled")||e.setUnsetCriteria(e.unitCheckbox)}))),(n.indexOf("variant")>=0||-1==n.indexOf("variant")&&"true"==i.feature)&&(e.featureCheckbox=new l({type:"checkbox",value:"feature",className:"primary",checkFlag:"true"===i.feature||"mixedState"===i.feature,label:r.Variant_Options,mixedState:"mixedState"===i.feature,disabled:-1==n.indexOf("variant")&&"true"==i.feature}).inject(C),e.featureCheckbox.elements.container.classList.add("featureCheckBox"),e.featureCheckbox.addEventListener("click",(function(t){this.hasAttribute("disabled")||e.setUnsetCriteria(e.featureCheckbox)})))}}))},readOnlyCriteriaView:function(){var e=this;[e.productstateCheckbox,e.manufacturingPlanCheckbox,e.contextualDatebox,e.unitCheckbox,e.featureCheckbox].forEach((function(e){e&&(e.disabled=!0)}))},setUnsetCriteria:function(e){var i=this;this.isCriteriaModified=!0;let n=e.checkFlag;if(i.toggleLastState=i.enabledCriteriasUX[e.value],i.enabledCriteriasUX[e.value]=e.checkFlag.toString(),t.mask(this.criteriaContent),"Native"==window.enoviaServerFilterWidget.mode)i.renderActiveCriteria(i.enabledCriteriasUX),t.unmask(this.criteriaContent);else{var o=null;i.caid&&(o={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+i.caid}});for(var l=[],s=0;s<i.options.selection.length;s++)l.push(i.options.selection[s].id);if(null==o&&i.availableChangeControlledObjectsCount>0&&i.options.selection.length>i.availableChangeControlledObjectsCount)a.showwarning(r.CfgErrorSomeChangeControlled,"error"),i.revertToggleState(e),t.unmask(i.criteriaContent);else if(null==o&&i.availableChangeControlledObjectsCount>0&&i.options.selection.length==i.availableChangeControlledObjectsCount)a.showwarning(r.CfgErrorAllChangeControlled,"error"),i.revertToggleState(e),t.unmask(i.criteriaContent);else{new Promise((function(t,n){let r={[e.value]:e.checkFlag.toString()};var s={version:"1.2",pidList:l,content:{enabledCriteria:r}};s=JSON.stringify(s);a.makeWSCall("/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1","POST","enovia","application/json",s,(function(e){t(e)}),(function(t,a){i.revertToggleState(e),n(a)}),!0,o)})).then((function(e){i.renderActiveCriteria(i.enabledCriteriasUX),t.unmask(i.criteriaContent)}),(function(e){i.alertDiv.add({message:r.SetCriteriaFailed,style:{position:"absolute"},className:"error"}),i.alertDiv.show(),1==e.errorMessage.contains("No model(s) attached to the reference")?a.showwarning(r.EnableCriteriaFail,"error"):e.errorMessage?a.showwarning(r.EditContextFailed+e.errorMessage,"error"):!1===n?a.showwarning(r.DisableCriteriaFailGeneric,"error"):a.showwarning(r.EnableCriteriaFailGeneric,"error"),t.unmask(i.criteriaContent)}))}}},revertToggleState:function(e){var t=this;"mixedState"==t.toggleLastState?(t.enabledCriteriasUX[e.value]=t.toggleLastState,e.mixedState=!0):(t.enabledCriteriasUX[e.value]=(!e.checkFlag).toString(),e.checkFlag=!e.checkFlag)}})})),define("DS/CfgConfigurationContextUX/CfgReplaceModelVersionView",["UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/EffectivityWebExternalJS/scripts/CfgVersionExplorerLoader","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],(function(e,t,i){"use strict";return e.extend({className:"cfg-replace-modelversion-versionexplorerview",vEObject:{},getVEObject(){return this.vEObject.value},init:async function(e){try{t.cfgReplaceModelVersionActionEvents=new i,this._parent(e),this.divVersionGraph=UWA.createElement("div",{class:"CfgVersionGraphInModelVersion"}).inject(this.container),this.displayCompactMode=!this.options.displayCompactMode||0!=this.options.displayCompactMode,this.options.callBackFunction=()=>this.pubSubEvents(),this.modelID=e.modelVersionId,await this.loadVersionGraph()}catch(e){console.error(e)}},loadVersionGraph:async function(){this.divVersionGraph.innerHTML="",await VersionExplorerLoaderFactory(this.modelID,this.options.callBackFunction,enoviaServerFilterWidget.tenant,enoviaServerFilterWidget.baseURL,enoviaServerFilterWidget.getSecurityContext(),this.divVersionGraph,{id:this.modelID||""},"Products",this.vEObject)},render:function(){return this.container},pubSubEvents:function(){this.getVEObject().subscribeEvent("select",(e=>{t.cfgReplaceModelVersionActionEvents.publish({event:"selectionInReplaceModelVersionDialog",data:e})})),this.getVEObject().subscribeEvent("unselect",(()=>{t.cfgReplaceModelVersionActionEvents.publish({event:"unselectionInReplaceeModelVersionDialog"})}))}})})),define("DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextXRevisionView",["DS/Controls/ResponsiveTileView","UWA/Class/View","DS/UIKIT/Mask","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","DS/CfgConfigurationContextUX/CfgAttachedScopesView"],(function(e,t,i,a,n){"use strict";return t.extend({attachedScopesView:null,className:"CfgEditConfigurationContextXRevisionView",setup:function(){},init:function(e){this._parent(e),this.xRevisionGraphData=this.getXRevisionGraphData(e),this.attachedScopesData=this.getAttachedScopesData(e),this.variantCriteriaData=this.getvariantCriteriaData(e),this.attachedScopesView=new n(this.attachedScopesData,this.variantCriteriaData,e.selection,e.pandOAccess,e.enableRWNativeScope,e.isAttachContextReadOnly)},getXRevisionGraphData:function(e){let t="",i=enoviaServerFilterWidget.baseURL,a=i+"/snresources/images/icons/large/I_ENOVIA_Baseline.png",n=i+"/snresources/images/icons/small/I_ENOVIA_Baseline.png";return null!=e.xRevisionContextList&&null!=e.xRevisionContextList[0].xRevisionGraph&&null!=e.xRevisionContextList[0].xRevisionGraph.name&&(t=e.xRevisionContextList[0].xRevisionGraph.name),{title:t,preview_image:a,icon_image:n}},getAttachedScopesData:function(e){let t=[];if(e.xRevisionContextList.length>0){e.xRevisionContextList.forEach((function(e){if(e&&e.attachedScopes){let i=e.attachedScopes;i.length>0&&i.forEach((function(e){t.push(e)}))}}))}return t},getvariantCriteriaData:function(e){let t="",i=[];if(e.xRevisionContextList.length>0){e.xRevisionContextList.forEach((function(e){e&&e.variantCriteria&&i.push(e.variantCriteria)})),t=1==i.length||1===new Set(t).size?i[0]:"mixedState"}return t},render:function(){i.mask(this.container),i.unmask(this.container);let e=this.xrevisionTitlecontainer=new UWA.createElement("div",{class:"xrevisionContainer"});this.xrevisionModeTitle=new UWA.createElement("span",{class:"xrevisionControlTitle"}).inject(this.xrevisionTitlecontainer),this.xrevisionModeValue=new UWA.createElement("span",{class:"xrevisionModeValue"}).inject(this.xrevisionTitlecontainer),this.container.addContent(e),this.createRevisionControlTitle();var t=this.gridlistviewxrevisionscopecontainer=new UWA.createElement("div",{class:"gridlistview-xrevision-control-container"});return this.container.addContent(t),this.xRevisionGraphData&&this.xRevisionGraphData.title&&this.xRevisionGraphData.title.length>0&&this.createXRevisionView(this.xRevisionGraphData),this.attachedScopesView.render().inject(this.container),this.container},createRevisionControlTitle:function(){this.container.getElement(".xrevisionControlTitle").setContent(a.RevisionControl),this.container.getElement(".xrevisionModeValue").setContent(a.RevisionModeValue)},createXRevisionView:function(t){const i=new e({picture:t.preview_image,icon:t.icon_image,customTooltip:t.title,title:t.title,subtitle:"",statusbarIcons:[],statusbarIconsTooltips:[],contextualMenu:[]});i.getContent().style.removeProperty("width"),i.getContent().style.display="flex",i.getContent().inject(this.container.getElement(".gridlistview-xrevision-control-container"))}})})),define("DS/CfgConfigurationContextUX/CfgReplaceModelVersionDialog",["DS/CfgBaseUX/scripts/CfgDialog","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgConfigurationContextUX/CfgReplaceModelVersionView","DS/CfgBaseUX/scripts/CfgUtility","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],(function(e,t,i,a,n,o,r){"use strict";var l=a.extend({className:"CfgReplaceModelVersionDialog",setup:function(){},init:function(a){this._parent(a);var n=this;this.MainContainer=new UWA.Element("div",{styles:{width:"100%",height:"100%"}});let o=[{id:"CfgReplaceMV_OK",label:"OK",labelValue:t.CfgLabelOK,handler:function(){n.OkClick()},className:"primary"},{id:"CfgReplaceMV_Cancel",label:"Cancel",labelValue:t.CfgLabelCancel,handler:function(){n.replaceModelVersionDialog.closeDialog()},className:"secondary"}],r={className:"",title:"",parent:widget.body,body:this.MainContainer,overlay:!0,mode:"DashboardConfigurationContext",closable:!0,animate:!0,resizable:!0,footer:o,persistId:"CfgReplaceModelVersion",width:950,height:390,minHeight:300,minWidth:370,style:{"min-height":"350px"},dialogue:{header:i.ReplaceModelVersionHeader+this.options.modelVersionName,buttonArray:o,target:widget.body},touchMode:!0};this.replaceModelVersionDialog=new e(r)},OkClick:async function(){l.selectedModelVersionId&&n.cfgReplaceModelVersionInDialog.publish({event:"replaceModelVersionInDialog",data:l.selectedModelVersionId}),this.replaceModelVersionDialog.closeDialog()},render:async function(){let e={};e.modelVersionId=this.options.modelVersionId,l.existingModelVersionId=e.modelVersionId,this.cfgReplaceModelVersionViewObj=new o(e),this.cfgReplaceModelVersionViewObj.render().inject(this.MainContainer),this.subscribeCfgReplaceModelVersionEvents(),this.replaceModelVersionDialog.render(),this.replaceModelVersionDialog.footerButton.Ok.disabled=!0},subscribeCfgReplaceModelVersionEvents:function(){n.cfgReplaceModelVersionActionEvents.subscribe({event:"selectionInReplaceModelVersionDialog"},(e=>{let t="",i="";null!=e&&null!=e.data&&null!=e.data.nodeModel&&null!=e.data.nodeModel.options&&e.data.nodeModel.options&&(null!=e.data.nodeModel.options.id&&(t=e.data.nodeModel.options.id),null!=e.data.nodeModel.options.grid&&null!=e.data.nodeModel.options.grid.maturity&&(i=e.data.nodeModel.options.grid.maturity)),l.existingModelVersionId===t||"Inactive"===i||"Obsolete"===i?this.replaceModelVersionDialog.footerButton.Ok.disabled=!0:this.replaceModelVersionDialog.footerButton.Ok.disabled=!1,l.selectedModelVersionId=t})),n.cfgReplaceModelVersionActionEvents.subscribe({event:"unselectionInReplaceeModelVersionDialog"},(()=>{this.replaceModelVersionDialog.footerButton.Ok.disabled=!0}))}});return l})),define("DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextView",["DS/UIKIT/Alert","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/modelProviders/CollectionViewUWACollectionModelProvider","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Collection","UWA/Class/Model","DS/Handlebars/Handlebars4","text!DS/CfgConfigurationContextUX/CfgEditConfigurationContextDialogTemplate.html","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","UWA/Class/View","DS/CfgConfigurationContextUX/CfgReplaceModelVersionDialog","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgConfigurationContextUX/CfgConfigurationContextCriteria","DS/UIKIT/Mask","UWA/Date","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgAutoComplete","DS/Tweakers/GeneratedToolbar","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],(function(e,t,i,a,n,o,r,l,s,c,d,u,C,p,h,g,f,m,v,b){"use strict";r.compile(l);var w=null;return d.extend({collection:null,className:"CfgEditConfigurationContextView",gridListView:null,CfgFloatingPanel:null,toolBar:null,activatedView:"ModelView",tileCollection:null,caid:"",selectedModelsList:[],probesOperationList:[],modelDefination:o.extend({defaults:function(){return{id:null,type:"",marketingName:"",name:"",state:"",description:"",owner:"",label:"",subLabel:"",icon:"",thumbnail:"",maturity:"",isactive:!1}}}),setup:function(){},init:function(t){this._parent(t),this.alertDiv=new e({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"}),f.cfgReplaceModelVersionInDialog=new m;var i={};"Native"!==window.enoviaServerFilterWidget.mode&&(i.selection=t.selection),i.enabledCriterias=t.enabledCriteriaArray,null!=t.IsManufPlanAllowedFromNative&&(i.IsManufPlanAllowedFromNative=t.IsManufPlanAllowedFromNative),this.criteriaView=new p(i);var a=this;C.get2((function(e){console.log(e),null!=e.isLicenseValid&&0==e.isLicenseValid||null!=e.AuthoringContextHeader&&null!=e.AuthoringContextHeader["DS-Change-Authoring-Context"]&&(a.caid=e.change.id)})),this.subscribeReplaceModelVersionEvents()},subscribeReplaceModelVersionEvents:function(){var e=this;f.cfgReplaceModelVersionInDialog.subscribe({event:"replaceModelVersionInDialog"},(t=>{e.updateModelVersionTileInfo(t)}))},updateModelVersionTileInfo:function(e){var t=this;let i=[],n=null;if(""!=t.caid&&(n={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+t.caid}}),i.push(e),"Native"==window.enoviaServerFilterWidget.mode){let e=null,n="Products",o=[];a.getObjectsBySearchService(i,e,n,o).then((async function(e){if(e&&e.results&&e.results.length>0&&e.results[0].attributes){let i=e.results[0].attributes,n="",o="",r="",l="",s="",c="",d="",u="",C=i.length;for(let e=0;e<C;e++)"resourceid"==i[e].name&&null!=i[e].value&&(d=i[e].value),"ds6w:label"==i[e].name&&null!=i[e].value&&(n=i[e].value),"ds6w:identifier"==i[e].name&&null!=i[e].value&&(r=i[e].value),"ds6w:who/ds6w:responsible"==i[e].name&&null!=i[e].value&&(l=i[e].value),"ds6wg:revision"==i[e].name&&null!=i[e].value&&(o=i[e].value),"ds6w:when/ds6w:modified"==i[e].name&&null!=i[e].value&&(u=i[e].value),"ds6w:what/ds6w:status"==i[e].name&&null!=i[e].value&&(s=i[e].value);if(t.collection&&t.collection.length>0){let e=t.selectedModelVersionIdForReplace;t.collection.get(e).set("id",d);let i=d;t.collection.get(i).set("marketingName",n),t.collection.get(i).set("name",r),t.collection.get(i).set("owner",l);let C=[];s&&C.push(s);let p=await a.readNLSvaluesOfAttributes(C);p&&p["ds6w:status"]&&(c=p["ds6w:status"][s]),c?t.collection.get(i).set("state",c):-1!=s.indexOf("Product.")&&(c=s.split("Product.").pop(),t.collection.get(i).set("state",c)),t.collection.get(i).set("maturity",c),t.collection.get(i).set("revision",o),u&&(u=t.getFormatedDate(u)),t.collection.get(i).set("dateModified",u),t.collection.isCollectionModified=!0,t.createView()}}}))}else{let e=[];for(var o=0;o<t.options.selection.length;o++)e.push(t.options.selection[o].id);t.setConfigurationContext("AddContext",n,e,i).then((function(e){if(e.details&&e.details.length>0&&e.details[0].contexts&&e.details[0].contexts.content&&e.details[0].contexts.content.length>0&&e.details[0].contexts.content[0].attributes&&e.details[0].contexts.content[0].attributes.length>0){let i=e.details[0].contexts.content[0].attributes[0],a=i.data.find((e=>"Marketing Name"===e.name)),n=i.basicData.find((e=>"name"===e.name)),o=i.basicData.find((e=>"owner"===e.name)),r=i.basicData.find((e=>"current"===e.name)),l=i.basicData.find((e=>"revision"===e.name)),s=a.value[0],c=l.value[0],d=n.value[0],u=o.value[0],C=r.value[0];if(t.collection&&t.collection.length>0){let e=t.selectedModelVersionIdForReplace;t.collection.get(e).set("id",i.physicalID);let a=i.physicalID;t.collection.get(a).set("marketingName",s),t.collection.get(a).set("name",d),t.collection.get(a).set("owner",u),t.collection.get(a).set("state",C),t.collection.get(a).set("maturity",C),t.collection.get(a).set("revision",c),t.collection.isCollectionModified=!0,t.createView()}}}),(function(e){console.log(e.errorMessage)}))}},render:function(){this.selectedModelsList=[],this.probesOperationList=[];var e={};e.NoModelAttached=s.NoModelAttached;var t=this;h.mask(this.container),h.unmask(this.container),this.getDefaultImage(),this.createCollection(this.options);var i=UWA.createElement("div",{class:"main-Context-container"});this.environment="Dashboard",window.enoviaServerFilterWidget.mode&&"Native"==window.enoviaServerFilterWidget.mode&&(this.environment="Native");var n=this.headercontainer=new UWA.createElement("div",{class:"header-container",html:[{tag:"div",class:"currCriteria-container"},{tag:"div",class:"toolbar-container"}]}),o=UWA.createElement("div",{class:"no-model-attached"}),r=UWA.createElement("div",{class:"gridlistview-dialog-container"});this.criteriaContent=new UWA.createElement("div",{class:"CriteriaContent"});if(this.container.addContent(n),this.criteriaView&&(this.criteriaContent.setContent(this.criteriaView.render(this.collection)),this.options.pandOAccess)){let e=this.options.pandOAccess;"Not Granted"!=e.AttachModels&&"Not Granted"!=e.GetAttachedModels||this.criteriaContent.addClassName("cfg-readonly-criteria")}if(this.container.addContent(this.criteriaContent),this.AutocompleteContainer=UWA.createElement("div",{class:"autocompleteContainer"}),this.initializeModelSearchUI(this.AutocompleteContainer),this.AutocompleteContainer.hide(),this.container.addContent(this.AutocompleteContainer),i.addContent(o),i.addContent(r),this.container.appendChild(i),t.availableChangeControlledObjectsCount=0,"Native"!==window.enoviaServerFilterWidget.mode){var l=t.options.selection;a.getChangeControlledList(l).then((function(e){t.availableChangeControlledObjectsCount=e.length}))}return this.createToolbar(),this.refreshToolbar(),this.createHeader(),this.createView(),this.GridView=this.container.getElement(".gridlistview-dialog-container"),this.EmptyView=this.container.getElement(".no-model-attached"),this.EmptyView.setContent("<span><img src="+this.defaultIcon+' style="width:25%;"></img></span><br>'),this.EmptyView.addContent('<font-size="17px">'+e.NoModelAttached+"</font>"),this.EmptyView.setStyle("color","silver"),this.EmptyView.setStyle("text-align","center"),this.EmptyView.setStyle("display","inline-flex"),this.EmptyView.setStyle("flex-direction","column"),this.EmptyView.setStyle("justify-content","center"),this.filpflopDivs(),this.alertDiv.inject(this.container,"top"),this.collection.addEvent("onAdd",(function(){if(t.refreshToolbar(),t.filpflopDivs(),t.collection&&1==t.collection.length){var e=[];t.collection.forEach((function(t,i){e.push({id:"pid:"+t.id})})),t.isModelVersionAvailable(e).then((function(e){"Products"===t.collection.at(0).get("type")&&(e.criteria[0].products="false",e.criteria[0].variant="True"),e;var i=e.criteria,a=[];i.forEach((function(e,t){var n=i[t],o=[];(o=Object.keys(n)).forEach((function(e,t){"TRUE"!=n[o[t]]&&"True"!=n[o[t]]||-1!=a.indexOf(o[t])||a.push(o[t])}))}));var n={feature:a.indexOf("variant")>=0?"true":"false",productState:a.indexOf("products")>=0?"true":"false"};t.collection.forEach((function(e){e.enabledcriteria&&(void 0!==e.enabledcriteria.feature&&(n.feature=e.enabledcriteria.feature),void 0!==e.enabledcriteria.product&&(n.productState=e.enabledcriteria.product))})),t.criteriaView&&t.criteriaView.updateCollection(t.collection,n),t.criteriaView&&t.criteriaView.renderCriteriaView()}))}else t.criteriaView&&t.criteriaView.updateCollection(t.collection),t.criteriaView&&t.criteriaView.renderCriteriaView();t.createView(),t.disableAutocompleteSelection("Add")})),this.collection.addEvent("onRemove",(function(){t.refreshToolbar(),t.filpflopDivs(),t.criteriaView&&(t.criteriaView.updateCollection(t.collection),t.criteriaView.renderCriteriaView()),t.createView(),t.disableAutocompleteSelection("Remove")})),i.addEvent("resize",(function(){if("ModelView"===t.activatedView){var e=0,i=t.headercontainer.getDimensions().height,a=t.criteriaContent.getDimensions().height,n=t.AutocompleteContainer.getDimensions().height;t.AutocompleteContainer.isHidden()||(e=n+5),this.setStyle("height","calc(100% - "+(i+e+5)+"px)")}else if("CriteriaView"===t.activatedView){i=t.headercontainer.getDimensions().height,a=t.criteriaContent.getDimensions().height;this.setStyle("height","calc(100% - "+(i+a+10)+"px)")}})),this.container},disableAutocompleteSelection:function(e){let t=this,i=[];t.collection.forEach((function(e){i.push(e.id)})),t.CfgAutocompleteControlObj.searchString="";let a="Model";const n='( NOT current:"Inactive") AND ( NOT current: "Obsolete")';if(0==i.length)if(t.options&&t.options.typesToSearch){let e=t.options.typesToSearch,o=[];for(let t=0;t<e.length;t++)a=e[t],o.push({type:a,condition:n,excludedArray:i});o.length>0&&t.CfgAutocompleteControlObj.setQuery(o)}else t.CfgAutocompleteControlObj.setQuery([{type:a,condition:n,excludedArray:i}]);else t.collection.length>0&&t.collection.at(0).get("type")&&(a=t.collection.at(0).get("type")),t.CfgAutocompleteControlObj.setQuery([{type:a,condition:n,excludedArray:i}]),this.isModelVersionSelected="Model"!=a;t.CfgAutocompleteControlObj.updateAutoCompleteModel(),t.toolBar.updateNodeModel("CfgEditContextPlusIcon",{visibleFlag:!0}),this.isModelVersionSelected&&"Add"==e&&(t.toolBar.updateNodeModel("CfgEditContextPlusIcon",{visibleFlag:!1}),t.toolBar.updateNodeModel("CfgEditContextCogIcon",{visibleFlag:!1}),t.AutocompleteContainer.hide())},initializeModelSearchUI:function(e){let t=this;let i=[],a=["Model"];if(0==t.collection.length)t.options&&t.options.typesToSearch&&(a=t.options.typesToSearch);else if(t.collection.length>0){const e=t.collection.at(0);a="Products"==e.get("type")?["Products"]:[e.get("type")]}t.collection.forEach((function(e){i.push(e.id)}));const{autoComplete:n,searchBtn:o}=this.createAutocompleteWithSearch(a,e,'( NOT current:"Inactive") AND ( NOT current: "Obsolete")',i);this.modelSearchAutocomplete=n,this.modelSearchBtn=o,this.modelUXReady=!0},createAutocompleteWithSearch:function(e,t,i,a){let n={query:e.map((e=>({type:e,condition:i,excludedArray:a}))),searchTitle:s.selectConfigContext||"SearchTitleHere",mode:"configurationcontext",multiselection:!1,minLengthBeforeSearch:0,parentElement:t,showRevision:!0,callBackFunction:e=>this.autocompleteSearchCallback(e),clearInfo:()=>{}};this.CfgAutocompleteControlObj=new v(n);const{autoComplete:o,searchBtn:r}=this.CfgAutocompleteControlObj.render();return{autoComplete:o,searchBtn:r}},createToolbar:function(){this.toolBar&&this.toolBar.destroy();this.isCogEnabled=!1;const e={entries:[{id:"CfgEditContextPlusIcon",icon:{iconName:"plus wux-ui-3ds",fontIconFamily:1,className:""},dataElements:{typeRepresentation:"functionIcon",tooltip:s.Attach,value:e=>this.plusIconCB(e),visibleFlag:!0},position:"far",domId:"CfgEditContextPlusIcon"},{id:"CfgEditContextTrashIcon",icon:{iconName:"trash wux-ui-3ds",fontIconFamily:1,className:""},dataElements:{typeRepresentation:"functionIcon",tooltip:s.Detach,value:e=>this.trashIconCB(e),visibleFlag:!1},position:"far",domId:"CfgEditContextTrashIcon"},{id:"CfgEditContextCogIcon",icon:{iconName:"cog wux-ui-3ds",fontIconFamily:1,className:""},dataElements:{typeRepresentation:"functionIcon",tooltip:s.EditCriteria,value:e=>this.cogIconCB(e),visibleFlag:!1},position:"far",domId:"CfgEditContextCogIcon"}]};var t=b.prototype.createTreeDocument(e);this.toolBar=new b({direction:"horizontal",items:t}),this.toolBar.inject(this.container.getElement(".toolbar-container"))},refreshToolbar:function(){var e=this;if(e.selectedModelsList.length<=0?e.toolBar.updateNodeModel("CfgEditContextTrashIcon",{visibleFlag:!1}):e.toolBar.updateNodeModel("CfgEditContextTrashIcon",{visibleFlag:!0}),e.criteriaView)if(e.collection&&e.collection.length>0&&e.options.isCriteriaEditable){"Products"==e.collection.at(0).get("type")?e.toolBar.updateNodeModel("CfgEditContextCogIcon",{visibleFlag:!1}):e.toolBar.updateNodeModel("CfgEditContextCogIcon",{visibleFlag:!0})}else e.toolBar.updateNodeModel("CfgEditContextCogIcon",{visibleFlag:!1});e.options&&e.options.typesToSearch&&(e.collection.length>0&&"Products"==e.collection.at(0).get("type")?e.toolBar.updateNodeModel("CfgEditContextPlusIcon",{visibleFlag:!1}):e.toolBar.updateNodeModel("CfgEditContextPlusIcon",{visibleFlag:!0}))},addContextToggle:function(){var e=this;e.AutocompleteContainer.isHidden()?(e.toolBar.updateNodeModel("CfgEditContextPlusIcon",{icon:{className:"addContextActivePlus"}}),e.AutocompleteContainer.show(),e.CfgAutocompleteControlObj.setFocus(),e.isCogEnabled=!1,e.toolBar.updateNodeModel("CfgEditContextCogIcon",{icon:{className:""}}),e.editCriteria(!1),e.criteriaContent.hide()):(e.toolBar.updateNodeModel("CfgEditContextPlusIcon",{icon:{className:""}}),e.AutocompleteContainer.hide(),e.editCriteria(!1))},setConfigurationContext:function(e,t,i,n,o){const r=i||[],l="PropagateContext"!==e&&"AddContext"!==e||!n?[]:n,s="RemoveContext"===e&&n?n:[];return new Promise(((e,i)=>{const n=o=>{const c={version:"1.2",pidList:r,content:{attachCfgCtxt:l,detachCfgCtxt:s,enabledCriteria:o||void 0}};a.makeWSCall("/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1","POST","enovia","application/json",JSON.stringify(c),(t=>{o&&"false"===o.productState&&(t.productState="false"),o&&"false"===o.feature&&(t.feature="false"),e(t)}),((e,t)=>{o&&("true"===o.productState&&"true"===o.feature?(o.productState="false",n(o)):"true"===o.feature||"true"===o.productState?(o.productState="false",o.feature="false",n(o)):i(t||e))}),!0,t)};n(o)}))},createHeader:function(){var e=this.container.getElement(".currCriteria-container");this.criteriaView&&e.setContent(this.criteriaView.getActiveCriteria())},ondetach:function(e,t,i){var n=!1,o=0,r=0,l=0;let c=0,d="",u=0,C="",p=0,h="";for(var g=[],f=[],m=[],v=0;v<t.details.length;v++)for(var b=0;b<t.details[v].contexts.content.length;b++){var w=t.details[v].contexts.content[b];if("detached"==w.status){var x=w.attributes[0].physicalID,D=e.selectedModelsList.indexOf(x);-1==g.indexOf(x)&&(g.push(x),o++),"SUCCEED"==i&&(-1!==D&&e.selectedModelsList.splice(D,1),n=!0,e.collection.remove(x),e.collection.isCollectionModified=!0)}else if("ERROR"==w.status){-1==f.indexOf(w.attributes[0].physicalID)&&f.push(w.attributes[0].physicalID);for(var A=w.attributes[0].basicData.length,E="",M=0;M<A;M++)"name"==w.attributes[0].basicData[M].name&&null!=w.attributes[0].basicData[M].value&&(E=w.attributes[0].basicData[M].value[0]),w.attributes[0].data[0]&&w.attributes[0].data[0].value[0]&&(E=w.attributes[0].data[0].value[0]);"03"==w.errorCode?(r++,m.push(E)):"02"==w.errorCode?l++:"04"===w.errorCode?(c++,d=d||w.errorMessage):""===w.errorCode||"09"===w.errorCode?(p++,h=h||w.errorMessage):"152"===w.errorCode&&(u++,C=C||w.errorMessage)}}if(null!=g.length&&g.length>=1&&f.forEach((function(e,t){-1!=g.indexOf(f[t])&&g.pop(f[t])})),g.forEach((function(t,i){var a=e.selectedModelsList.indexOf(g[i]);-1!==a&&e.selectedModelsList.splice(a,1),n=!0,e.collection.remove(g[i])})),"FAILED"==t.result&&(o>=1||r>=1||l>=1||c>=1||u>=1||p>=1)&&(r>=1&&o>=1?(e.collection.isCollectionModified=!0,a.showwarning(s.PartialDetachFailed,"info")):r>=1&&0==o?m.forEach((function(e,t){a.showwarning(m[t]+" "+s.HasEffectivityReferences,"error")})):l>=1?a.showwarning(s.HasProductConfigurationsReferences,"error"):c>=1?a.showwarning(d||s.DetachFailedDueToCRDefined,"error"):u>=1?a.showwarning(C||s.DetachFailedDueToModelVersionUsed,"error"):p>=1?a.showwarning(h||s.DetachFailed,"error"):a.showwarning(s.DetachFailed,"error")),1==n){for(b=0;b<e.selectedModelsList.length;b++)e.collection.get(e.selectedModelsList[b])._attributes.isactive=!1;e.selectedModelsList=[]}e.filpflopDivs()},filpflopDivs:function(){if(this.collection.length<=0)this.activatedView="ModelView",this.GridView.setStyle("display","none"),this.EmptyView.setStyle("display","inline-flex"),this.criteriaContent.setStyle("display","none"),this.container.getElement(".currCriteria-container").setStyle("display","none");else if(this.container.getElement(".currCriteria-container").setStyle("display","flex"),"ModelView"===this.activatedView){this.criteriaContent.getDimensions().height;this.EmptyView.setStyle("display","none"),this.criteriaContent.setStyle("display","none"),this.GridView.setStyle("display","flex")}else"CriteriaView"===this.activatedView&&(this.EmptyView.setStyle("display","none"),this.criteriaContent.setStyle("display","block"))},checkisValidTypeSelected:function(e){let t={isValidType:!0,errorMassage:"",typeOfObject:""};if(1==e.length)t.typeOfObject=e.at(0).get("type");else if(e.length>1)for(let i=e.length-1;i>0;i--){let a=e.at(i).get("type"),n=e.at(i-1).get("type");if(a!=n)return t.isValidType=!1,t.errorMassage=s.CfgErrorMixedType,t.typeOfObject=n,t;if(a==n&&"Model"!=a)return t.isValidType=!1,t.errorMassage=s.CfgErrorMultipleModelVersion,t.typeOfObject=n,t}return t},autocompleteSearchCallback:async function(e){var t=[],i=this;let n="Native",o="Rich Client Applications",r="NATIVEWIW";if(widget&&widget.data&&widget.data.appId&&(n=widget.data.appId),widget&&widget.options&&widget.options.title&&(o=widget.options.title),"Dashboard"==i.environment&&(r="DASHBOARD"),"Native"==window.enoviaServerFilterWidget.mode){var l,d="",u=e.sublabel?jsonresponse.sublabel:"",C="",p="",g=[];e.length>0&&g.push(e.at(0).get("dispvalue")),g&&Array.isArray(g)&&g.length>0&&(l=await a.readNLSvaluesOfAttributes(g));var f={};if(e.length>0){d=e.at(0).get("ID"),f.type=e.at(0).get("type"),f.image=e.at(0).get("image"),f.marketingName=e.at(0).get("label"),f.name=e.at(0).get("name"),f.owner=e.at(0).get("owner");let t=e.at(0).get("dispvalue");if(l&&l["ds6w:status"]){let e=l["ds6w:status"][t];e?f.state=e:-1!=t.indexOf("Model.")&&(f.state=t.split("Model.").pop())}else-1!=t.indexOf("Model.")&&(f.state=t.split("Model.").pop());if(p=f.image,e.at(0).get("modified")){let t=e.at(0).get("modified");t&&(C=i.getFormatedDate(t))}}let t=e.length>0?e.at(0).get("icon"):void 0;var m=new i.modelDefination({id:d,type:f.type||"",marketingName:f.marketingName||"",name:f.name||"",state:f.state,description:"",owner:f.owner,label:f.marketingName,subLabel:u,thumbnail:"",maturity:f.state,isactive:!1,dateModified:C,preview_url:p,icon:""!==t?t:i.defaultIcon,isToPropagate:!1});m.set("revision",(x=e.find((e=>e.get("revision"))))?x.get("revision"):null),i.collection.add(m),i.collection.isCollectionModified=!0,i.probesOperationList.push({AppId:n,AppName:o,CommandOperation:"Add_Context_With_Type_Ahead",ApplicationMode:r})}else{i.ItemFromType=e;let l=i.checkisValidTypeSelected(e);if(0==l.isValidType)return void a.showwarning(l.errorMassage,"error");for(let i=0;i<e.length;i++)t.push(e.at(i).get("ID"));h.mask(i.container);var v=function(e){if(t.length>0){var l=null;""!=i.caid&&(l={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+i.caid}});for(var d=[],u=e||"",C=0;C<i.options.selection.length;C++)d.push(i.options.selection[C].id);i.setConfigurationContext("AddContext",l,d,t,u).then((function(e){if("SUCCEED"==e.result)i.onattach(i,e),h.unmask(i.container),i.probesOperationList.push({AppId:n,AppName:o,CommandOperation:"Add_Context_With_Type_Ahead",ApplicationMode:r});else{let t=s.AttachFailed;e.details&&e.details.length>0&&e.details[0].contexts&&e.details[0].contexts.content.length>0&&(""==e.details[0].contexts.content[0].errorCode||"09"==e.details[0].contexts.content[0].errorCode)&&(t=e.details[0].contexts.content[0].errorMessage),a.showwarning(t,"error"),h.unmask(i.container)}}),(function(e){e&&e.errorMessage&&e.errorMessage.includes("Attach models failed, possibly because of access issue on objects.")?a.showwarning(c.CfgMessageFrozenReferenceAddContextFailed,"error"):"103"==e.errorID?a.showwarning(s.V5AttachFailed,"error"):e&&e.errorMessage?a.showwarning(s.EditContextFailed+e.errorMessage,"error"):a.showwarning(s.AttachFailed,"error"),h.unmask(i.container)}))}};if(i.collection&&0==i.collection.length){var b=[];t.forEach((function(e){b.push({id:"pid:"+e})})),w=null,i.isModelVersionAvailable(b).then((function(e){e;var t=e.criteria,i=[];t.forEach((function(e,a){var n=t[a],o=[];(o=Object.keys(n)).forEach((function(e,t){"TRUE"!=n[o[t]]&&"True"!=n[o[t]]||-1!=i.indexOf(o[t])||i.push(o[t])}))}));var a={};i.indexOf("variant")>=0&&(a.feature="true"),i.indexOf("products")>=0&&(a.productState="true"),0!=Object.keys(a).length?v(a):v()}))}else v()}var x},isModelVersionAvailable:function(e){if(null!=w)return w;var t=new Promise((function(t,i){var n={version:"1.0.0",modelIds:e};n=JSON.stringify(n);a.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",n,(function(e){var i=e.criteria,a=[];i.forEach((function(e,t){var n=i[t],o=[];(o=Object.keys(n)).forEach((function(e,t){"TRUE"!=n[o[t]]&&"True"!=n[o[t]]||-1!=a.indexOf(o[t])||a.push(o[t])}))})),t(e)}),(function(e){console.log("fail to get last product evolution")}),!0)}));return w=t,t},onattach:function(e,t){if("Native"==window.enoviaServerFilterWidget.mode){var i;(i=t.contextList).length>0&&i.forEach((function(t){if(t&&t.physicalID){var i="",a="",n="",o="",r="",l="",s="",c="",d=t.isToPropagate,u=t.basicData.length;let g="",f="";for(var C=0;C<u;C++){if("ds6w:what/ds6w:type"==t.basicData[C].name&&null!=t.basicData[C].value&&(i=t.basicData[C].value),"name"==t.basicData[C].name&&null!=t.basicData[C].value&&(r=n=a=l=t.basicData[C].value),"current"==t.basicData[C].name&&null!=t.basicData[C].value&&(o=t.basicData[C].value[1]),"owner"==t.basicData[C].name&&null!=t.basicData[C].value&&(c=t.basicData[C].value),"ds6w:when/ds6w:modified"==t.basicData[C].name&&null!=t.basicData[C].value){var p=t.basicData[C].value;p&&(s=e.getFormatedDate(p))}t.data[0]&&t.data[0].value&&0!=t.data.length&&"Marketing Name"==t.data[0].name&&(a=t.data[0].value[0]),"type_icon_url"==t.basicData[C].name&&null!=t.basicData[C].value&&(g=t.basicData[C].value),"ds6wg:revision"==t.basicData[C].name&&null!=t.basicData[C].value&&(f=t.basicData[C].value)}null!=t.propValue&&(d=t.propValue);var h=new e.modelDefination({id:t.physicalID,type:i||"",marketingName:a||"",name:n||"",state:o,description:"",owner:c,label:r,subLabel:l,thumbnail:"",maturity:o,isactive:!1,dateModified:s,preview_url:t.preview_url,icon:""!=g?g:e.defaultIcon,isToPropagate:d});"Products"==i&&f&&h.set("revision",f),e.collection.add(h),e.collection.isCollectionModified=!0}}))}else{let i=enoviaServerFilterWidget.baseURL;for(var a=0;a<t.details.length;a++){for(var n=0;n<t.details[a].contexts.content.length;n++){let g="",f="";null!=(h=t.details[a].contexts.content[n]).attributes[0].type_icon_url&&-1==h.attributes[0].type_icon_url.indexOf(i)&&(f=i+h.attributes[0].type_icon_url),null!=h.attributes[0].type_icon_large_url&&-1==h.attributes[0].type_icon_large_url.indexOf(i)&&(g=i+h.attributes[0].type_icon_large_url),""==h.attributes[0].preview_url&&(h.attributes[0].preview_url=""!=g?g:e.defaultImage);var o=" ";if("attached"==h.status){var r="",l="",s="",c="",d="",u=h.attributes[0].basicData.length;let i="",a=h.attributes[0].data.find((e=>"Marketing Name"===e.name));a&&a.value&&(i=a.value[0]);for(var C=0;C<u;C++){if("name"==h.attributes[0].basicData[C].name&&null!=h.attributes[0].basicData[C].value&&(r=h.attributes[0].basicData[C].value[0]),"owner"==h.attributes[0].basicData[C].name&&null!=h.attributes[0].basicData[C].value&&(d=h.attributes[0].basicData[C].value[0]),"current"==h.attributes[0].basicData[C].name&&null!=h.attributes[0].basicData[C].value&&(l=h.attributes[0].basicData[C].value[0]),"modified"==h.attributes[0].basicData[C].name&&null!=h.attributes[0].basicData[C].value)(p=h.attributes[0].basicData[C].value[0])&&(c=e.getFormatedDate(p))}let n=null;if("Products"===h.attributes[0].type){const e=h.attributes[0].basicData.find((e=>"revision"===e.name));e&&(n=e.value[0])}"Products"===(h=new e.modelDefination({id:h.attributes[0].physicalID,type:h.attributes[0].type,marketingName:i,name:r,state:l,description:s,owner:d,label:r,subLabel:r,thumbnail:"",maturity:l,isactive:!1,preview_url:h.attributes[0].preview_url,dateModified:c,icon:""!==f?f:e.defaultIcon,isToPropagate:!1}))._attributes.type&&(h._attributes.revision=n),h.enabledcriteria={product:t.productState,feature:t.feature},e.collection.add(h),e.collection.isCollectionModified=!0}else if("alreadyAttached"==h.status){for(r="",l="",s="",c="",d="",u=h.attributes[0].basicData.length,C=0;C<u;C++){var p;if("name"==h.attributes[0].basicData[C].name&&null!=h.attributes[0].basicData[C].value&&(r=o=h.attributes[0].basicData[C].value[0]),"owner"==h.attributes[0].basicData[C].name&&null!=h.attributes[0].basicData[C].value&&(d=h.attributes[0].basicData[C].value[0]),"current"==h.attributes[0].basicData[C].name&&null!=h.attributes[0].basicData[C].value&&(l=h.attributes[0].basicData[C].value[0]),"modified"==h.attributes[0].basicData[C].name&&null!=h.attributes[0].basicData[C].value)(p=h.attributes[0].basicData[C].value[0])&&(c=e.getFormatedDate(p))}h.attributes[0].data[0]&&h.attributes[0].data[0].value&&(o=h.attributes[0].data[0].value[0]);var h=new e.modelDefination({id:h.attributes[0].physicalID,type:h.attributes[0].type,marketingName:o,name:r,state:l,description:s,owner:d,label:r,subLabel:r,thumbnail:"",maturity:l,isactive:!1,preview_url:h.attributes[0].preview_url,dateModified:c,icon:""!=f?f:e.defaultIcon,isToPropagate:!1});e.collection.add(h),e.collection.isCollectionModified=!0}}e.filpflopDivs()}}},editCriteria:function(e){this.activatedView=1==e?"CriteriaView":"ModelView",this.filpflopDivs(),this.refreshToolbar()},createCollection:function(e){var t,i,a=[],o=this;i=e.contextList,"Native"==window.enoviaServerFilterWidget.mode?null!=i&&i.length>0&&i.forEach((function(e){if(e&&e.physicalID){var i="",n="",r="",l="",s="",c="",d="",u="",C=!0,p="";let m="",v="";for(var h=e.basicData.length,g=0;g<h;g++){if("ds6w:what/ds6w:type"==e.basicData[g].name&&null!=e.basicData[g].value&&(i=e.basicData[g].value),"name"==e.basicData[g].name&&null!=e.basicData[g].value&&(c=r=n=d=e.basicData[g].value),"current"==e.basicData[g].name&&null!=e.basicData[g].value&&(s=e.basicData[g].value[1]),"owner"==e.basicData[g].name&&null!=e.basicData[g].value&&(u=e.basicData[g].value),"ds6w:when/ds6w:modified"==e.basicData[g].name&&null!=e.basicData[g].value){var f=e.basicData[g].value;f&&(l=o.getFormatedDate(f))}"type_icon_url"==e.basicData[g].name&&null!=e.basicData[g].value&&(m=e.basicData[g].value)}if("Products"==i){const t=e.basicData.find((e=>"ds6wg:revision"===e.name));t&&t.value&&(v=t.value)}e.data[0]&&e.data[0].value[0]&&e.data.length>0&&(n=e.data[0].value[0]),p=null==e.preview_url||null==e.preview_url||""==e.preview_url?o.defaultImage:e.preview_url,void 0!==e.isToPropagate&&(C=e.isToPropagate),t={id:e.physicalID,type:i||"",marketingName:n||"",name:r||"",state:s,description:"",owner:u,label:c,subLabel:d,thumbnail:"",maturity:s,isactive:!1,preview_url:p,dateModified:l,icon:o.defaultIcon,isToPropagate:C},"Products"==i&&v&&(t.revision=v),""!=m&&(t.icon=m),a.push(t)}})):null!=i&&i.length>0&&i.forEach((function(e){if(e&&e.physicalID){var i="",n="",r="",l="",s="",c="",d="",u="",C=!0,p="";let m="",v="";for(var h=e.basicData.length,g=0;g<h;g++)if("revision"==e.basicData[g].name&&null!=e.basicData[g].value&&(v=e.basicData[g].value[0]),"name"==e.basicData[g].name&&null!=e.basicData[g].value&&(c=r=d=n=e.basicData[g].value[0]),"current"==e.basicData[g].name&&null!=e.basicData[g].value&&(s=e.basicData[g].value[0]),"owner"==e.basicData[g].name&&null!=e.basicData[g].value&&(u=e.basicData[g].value[0]),"modified"==e.basicData[g].name&&null!=e.basicData[g].value){var f=e.basicData[g].value[0];f&&(l=o.getFormatedDate(f))}if(e.type&&(i=e.type),e.data[0]&&e.data[0].value&&(n=e.data[0].value[0]),p=null==e.preview_url||null==e.preview_url||""==e.preview_url?o.defaultImage:e.preview_url,null!=e.type_icon_large_url&&(p=e.type_icon_large_url),null!=e.type_icon_url&&(m=e.type_icon_url),null!=e.isToPropagate&&(C=e.isToPropagate),t={id:e.physicalID,type:i||"",marketingName:n||"",revision:v||"",name:r||"",state:s,description:"",owner:u,label:c,subLabel:d,thumbnail:"",maturity:s,isactive:!1,preview_url:p,dateModified:l,icon:o.defaultIcon,isToPropagate:C},"Products"===e.type){const i=e.data.find((e=>"Marketing Name"===e.name));i&&i.value&&v&&""!=v&&(t.marketingName=i.value[0]+" "+v)}""!=m&&(t.icon=m),a.push(t)}})),this.collection=new n(a,{model:this.modelDefination}),this.collection.isCollectionModified=!1},getDefaultImage:function(){this.defaultImage=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png",this.defaultIcon=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png"},createView:function(){var e=this,o=e.collection,r=[];e.myResponsiveTilesCollectionView=new t,e.myResponsiveTilesCollectionView.modelProvider=new i,o.forEach((function(e){e._attributes.isactive=!1;var t=[],i=[];let a=e.get("marketingName");if("Products"==e.get("type")){t.push("replace-by-revision"),i.push(s.ReplaceModelVersionTooltip);let n=" "+e.get("revision");a.endsWith(n)||(a=a+" "+e.get("revision"))}1==e._attributes.isToPropagate&&(t.push("propagate"),i.push(s.PropagateModelTooltip));var n={label:a,customTooltip:s.Tootip_Title+" : "+a+"\n"+s.Tootip_Name+" : "+e.get("name")+"\n"+s.Tootip_Owner+" : "+e.get("owner")+"\n"+s.Tootip_Maturity+" : "+e.get("maturity")+"\n"+s.Tootip_Modification_Date+" : "+e.get("dateModified"),icon:e.get("icon"),picture:e.get("preview_url"),subLabel:e.get("name")+" | "+e.get("owner"),description:e.get("maturity")+" | "+e.get("dateModified"),statusbarIcons:t,statusbarIconsTooltips:i,contextualMenu:[],propertiesList:["propertiesList1"],emptyStatusbarVisibleFlag:!0,modelData:e};r.push(n)})),e.selectedModelsList.length>0&&(e.selectedModelsList=[],e.refreshToolbar()),e.tileCollection=new n,e.tileCollection.push(r),e.myResponsiveTilesCollectionView.loadApplicativeModel(e.tileCollection),e.myResponsiveTilesCollectionView.onStatusbarIconPointerDown=function(t){if(null!=t.clickedIconIndex&&t.clickedIconIndex>=0&&t.clickedIconIndex<t.cellInfos.cellModel._attributes.statusbarIcons.length){for(var i=[],n=[],o=0;o<t.cellInfos.cellModel._attributes.statusbarIcons.length;o++)i.push(t.cellInfos.cellModel._attributes.statusbarIcons[o]),n.push(t.cellInfos.cellModel._attributes.statusbarIconsTooltips[o]);if("propagate"===i[t.clickedIconIndex]){var r=e.container;h.mask(r);var l=null;""!=e.caid&&(l={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+e.caid}});var d=[],C=[];e.propagateModelId=[];var p=t.cellInfos.cellModel._attributes.modelData.get("marketingName");e.propagateModelId.push(t.cellInfos.cellModel._attributes.modelData.get("id")),C.push(t.cellInfos.cellModel._attributes.modelData.id);let i="Native",n="Rich Client Applications",u="NATIVEWIW";if(widget&&widget.data&&widget.data.appId&&(i=widget.data.appId),widget&&widget.options&&widget.options.title&&(n=widget.options.title),"Dashboard"==e.environment&&(u="DASHBOARD"),"Native"==window.enoviaServerFilterWidget.mode)h.unmask(r),e.postPropagateCollection(),e.probesOperationList.push({AppId:i,AppName:n,CommandOperation:"Propogate_Operation_Successful",ApplicationMode:u});else{for(o=0;o<e.options.selection.length;o++)d.push(e.options.selection[o].id);if(null==l&&e.availableChangeControlledObjectsCount>0&&e.options.selection.length>e.availableChangeControlledObjectsCount)a.showwarning(s.CfgErrorSomeChangeControlled,"error"),e.myResponsiveTilesCollectionView.unselectAll(),h.unmask(e.container);else if(null==l&&e.availableChangeControlledObjectsCount>0&&e.options.selection.length==e.availableChangeControlledObjectsCount)a.showwarning(s.CfgErrorAllChangeControlled,"error"),h.unmask(r);else if(e.options.pandOAccess&&"Not Granted"==e.options.pandOAccess.AttachModels)a.showwarning(c.CfgMessageAccessRightsError,"error"),h.unmask(r);else{let t=e.collection._models.find((e=>e.id===C[0]));t&&t._attributes&&"Obsolete"!==t._attributes.maturity?e.setConfigurationContext("PropagateContext",l,d,C).then((function(t){"SUCCEED"==t.result?(h.unmask(r),a.showwarning(`${p.replaceAll("<","&lt;")} ${s.PropagateModelSuccessful}`,"success"),e.postPropagateCollection(),console.log("propagate successful"),e.probesOperationList.push({AppId:i,AppName:n,CommandOperation:"Propogate_Operation_Successful",ApplicationMode:u})):(h.unmask(r),a.showwarning(`${p.replaceAll("<","&lt;")} ${s.PropagateModelFailed}`,"error"),console.log("propagate Failed"),e.probesOperationList.push({AppId:i,AppName:n,CommandOperation:"Propogate_Operation_Fail",ApplicationMode:u}))}),(function(t){t&&t.errorMessage&&t.errorMessage.includes("Attach models failed, possibly because of access issue on objects.")?a.showwarning(c.CfgMessageFrozenReferenceAddContextFailed,"error"):"103"==t.errorID?a.showwarning(s.V5AttachFailed,"error"):a.showwarning(s.PropagateModelFailed+". "+t.errorMessage,"error"),h.unmask(r),e.probesOperationList.push({AppId:i,AppName:n,CommandOperation:"Propogate_Operation_Fail",ApplicationMode:u})})):(a.showwarning(s.CfgErrorInappropiateStateModelAttach,"error"),C=[],h.unmask(r),e.probesOperationList.push({AppId:i,AppName:n,CommandOperation:"Propogate_Operation_Fail",ApplicationMode:u}))}}}else if("replace-by-revision"===i[t.clickedIconIndex]){let t=e.collection.at(0),i=t.get("id"),a={modelVersionId:i,modelVersionName:t.get("marketingName")||t.get("name")};e.selectedModelVersionIdForReplace=i,this.replaceModelVersionDialog=new u(a).render()}}},e.myResponsiveTilesCollectionView.onSelectionAdd((function(t){var i=t._attributes;e.ontileviewclick2(t,i)})),e.myResponsiveTilesCollectionView.onSelectionRemove((function(t){var i=t._attributes;e.ontileviewclick2(t,i)}));let l=e.container.getElement(".gridlistview-dialog-container");l&&l.children.length>0&&(l.innerHTML=""),e.myResponsiveTilesCollectionView.inject(e.container.getElement(".gridlistview-dialog-container"))},postPropagateCollection:function(){var e=this;e.collection._models.forEach((function(t){t.id==e.propagateModelId[0]&&(t._attributes.isToPropagate=!1,e.propagateModelId.splice(0,1))})),e.collection.isCollectionModified=!0,e.createView()},ontileviewclick2:function(e,t){var i;1==t.modelData._attributes.isactive?(t.modelData._attributes.isactive=!1,-1!==(i=this.selectedModelsList.indexOf(t.modelData.id))&&this.selectedModelsList.splice(i,1)):(t.modelData._attributes.isactive=!0,-1==(i=this.selectedModelsList.indexOf(t.modelData.id))&&this.selectedModelsList.push(t.modelData.id));this.refreshToolbar()},getModelIdsAndEnabledCriteria:function(e){var t=this,i=[];t.collection.forEach((function(e,t){i.push(e.id)}));var a=[];t.collection.forEach((function(e,t){e.get("isToPropagate")||a.push(e.id)}));var n=[];n=Object.getOwnPropertyNames(t.criteriaView.enabledCriteriasUX);var o=[];n.forEach((function(e){"true"==t.criteriaView.enabledCriteriasUX[e]&&o.push(e)}));var r=[];return n.forEach((function(e){"true"!=t.criteriaView.enabledCriteriasUX[e]&&"mixedState"!=t.criteriaView.enabledCriteriasUX[e]||r.push(e)})),{modelIds:i,enabledCriteria:r,modelIdsCommon:a,criteriaCommon:o,isContextOrCriteriaModified:this.checkisContextOrCriteriaModified()}},getFormatedDate:function(e){var t="";t="Native"==window.enoviaServerFilterWidget.mode?e.split("T")[0]:e.split("@")[0];var i=Date.parse(t),a=parseInt(i),n=new Date(a);return g.strftime(n,"%Y-%m-%d")},checkisContextOrCriteriaModified:function(){return 1==this.criteriaView.isCriteriaModified||1==this.collection.isCollectionModified},plusIconCB:function(e){var t=null;let i="Native",n="Rich Client Applications",o="NATIVEWIW";widget&&widget.data&&widget.data.appId&&(i=widget.data.appId),widget&&widget.options&&widget.options.title&&(n=widget.options.title),"Dashboard"==this.environment&&(o="DASHBOARD"),""!=this.caid&&(t={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+this.caid}}),null==t&&this.availableChangeControlledObjectsCount>0&&this.options.selection.length>this.availableChangeControlledObjectsCount?(a.showwarning(s.CfgErrorSomeChangeControlled,"error"),this.myResponsiveTilesCollectionView.unselectAll(),h.unmask(this.container)):null==t&&this.availableChangeControlledObjectsCount>0&&this.options.selection.length==this.availableChangeControlledObjectsCount?(a.showwarning(s.CfgErrorAllChangeControlled,"error"),this.myResponsiveTilesCollectionView.unselectAll(),h.unmask(this.container)):this.options.pandOAccess&&"Not Granted"==this.options.pandOAccess.AttachModels?(a.showwarning(c.CfgMessageAccessRightsError,"error"),this.myResponsiveTilesCollectionView.unselectAll(),h.unmask(this.container)):(this.addContextToggle(),this.AutocompleteContainer.isHidden()||this.probesOperationList.push({AppId:i,AppName:n,CommandOperation:"Add_Context_Plus_Icon_Click",ApplicationMode:o}))},trashIconCB:function(e){h.mask(this.container);let t="Native",i="Rich Client Applications",n="NATIVEWIW";widget&&widget.data&&widget.data.appId&&(t=widget.data.appId),widget&&widget.options&&widget.options.title&&(i=widget.options.title),"Dashboard"==this.environment&&(n="DASHBOARD");var o=null;if(""!=this.caid&&(o={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+this.caid}}),null==o&&this.availableChangeControlledObjectsCount>0&&this.options.selection.length>this.availableChangeControlledObjectsCount)a.showwarning(s.CfgErrorSomeChangeControlled,"error"),this.myResponsiveTilesCollectionView.unselectAll(),h.unmask(this.container);else if(null==o&&this.availableChangeControlledObjectsCount>0&&this.options.selection.length==this.availableChangeControlledObjectsCount)a.showwarning(s.CfgErrorAllChangeControlled,"error"),this.myResponsiveTilesCollectionView.unselectAll(),h.unmask(this.container);else if(this.options.pandOAccess&&"Not Granted"==this.options.pandOAccess.DetachModels)a.showwarning(c.CfgMessageAccessRightsError,"error"),this.myResponsiveTilesCollectionView.unselectAll(),h.unmask(this.container);else if(this.selectedModelsList.length>0){let e=this;if("Native"==window.enoviaServerFilterWidget.mode){let a=e.selectedModelsList;for(let o=0;o<a.length;){var r=a[o];a.splice(0,1),e.collection.remove(r),h.unmask(e.container),e.collection.isCollectionModified=!0,e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Remove_Context_Success",ApplicationMode:n})}}else{var l=[];for(let t=0;t<e.options.selection.length;t++)l.push(e.options.selection[t].id);e.setConfigurationContext("RemoveContext",o,l,e.selectedModelsList).then((function(o){"SUCCEED"==o.result?(e.ondetach(e,o,"SUCCEED"),h.unmask(e.container),console.log("Detach configuration context succeed."),e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Remove_Context_Success",ApplicationMode:n})):"FAILED"==o.result?(e.ondetach(e,o,"FAILED"),h.unmask(e.container),console.log("Detach configuration context failed."),e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Remove_Context_Fail",ApplicationMode:n})):(a.showwarning(s.DetachFailed,"error"),h.unmask(e.container),console.log("Detach configuration context failed."),e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Remove_Context_Fail",ApplicationMode:n}))}),(function(o){if(o.errorMessage){var r=o.errorMessage;a.showwarning(r,"error")}else a.showwarning(s.DetachFailed,"error");h.unmask(e.container),e.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Remove_Context_Fail",ApplicationMode:n})}))}}},cogIconCB:function(e){let t="Native",i="Rich Client Applications",a="NATIVEWIW";if(widget&&widget.data&&widget.data.appId&&(t=widget.data.appId),widget&&widget.options&&widget.options.title&&(i=widget.options.title),"Dashboard"==this.environment&&(a="DASHBOARD"),this.options.pandOAccess){let e=this.options.pandOAccess;"Not Granted"!=e.AttachModels&&"Not Granted"!=e.GetAttachedModels||this.criteriaView.readOnlyCriteriaView()}this.isCogEnabled=!this.isCogEnabled,this.AutocompleteContainer.isHidden()||(this.toolBar.updateNodeModel("CfgEditContextPlusIcon",{icon:{className:""}}),this.AutocompleteContainer.hide()),this.isCogEnabled?this.toolBar.updateNodeModel("CfgEditContextCogIcon",{icon:{className:"criteriaActiveCog"}}):this.toolBar.updateNodeModel("CfgEditContextCogIcon",{icon:{className:""}}),this.editCriteria(this.isCogEnabled),this.isCogEnabled&&this.probesOperationList.push({AppId:t,AppName:i,CommandOperation:"Edit_Criteria",ApplicationMode:a})}})})),define("DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextDialog",["DS/UIKIT/Alert","DS/CfgBaseUX/scripts/CfgDialog","DS/PlatformAPI/PlatformAPI","DS/Handlebars/Handlebars4","text!DS/CfgConfigurationContextUX/CfgEditConfigurationContextDialogTemplate.html","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","UWA/Class/View","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextView","DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextXRevisionView","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgContainerView","DS/UIKIT/Mask","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],(function(e,t,i,a,n,o,r,l,s,c,d,u,C,p,h,g){"use strict";a.compile(n);return r.extend({collection:null,className:"CfgEditConfigurationContextDialog",gridListView:null,CfgFloatingPanel:null,caid:"",selectedModelsList:[],setup:function(){},init:function(t){this._parent(t),this.alertDiv=new e({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"});var i=this;l.get2((function(e){console.log(e),null!=e.isLicenseValid&&0==e.isLicenseValid||(i.caid=e.change.id)})),this.criteriaEditable=!0},sendEditContextTrackerEvent:function(e){var t="",i="",a=e.CfgEditMultipleConfigurationContextView.collection.length,n=1;"Native"==enoviaServerFilterWidget.mode?(t="Native",i="Web In Win"):(t=widget.data.appId,n=e.CfgEditMultipleConfigurationContextView.options.selection.length,i=null!=widget.options?widget.options.title:"ODT Environment");var o=p.ContextCriteria.FALSE,r=p.ContextCriteria.FALSE,l=p.ContextCriteria.FALSE,s=p.ContextCriteria.FALSE,c=p.ContextCriteria.FALSE;if(null!=e.CfgEditMultipleConfigurationContextView.criteriaView&&null!=e.CfgEditMultipleConfigurationContextView.criteriaView.enabledCriteriasUX){var d=e.CfgEditMultipleConfigurationContextView.criteriaView.enabledCriteriasUX;null!=d.feature&&"true"==d.feature&&(o=p.ContextCriteria.TRUE),null!=d.productState&&"true"==d.productState&&(r=p.ContextCriteria.TRUE),null!=d.manufacturingPlan&&"true"==d.manufacturingPlan&&(l=p.ContextCriteria.TRUE),null!=d.unit&&"true"==d.unit&&(s=p.ContextCriteria.TRUE),null!=d.contextualDate&&"true"==d.contextualDate&&(c=p.ContextCriteria.TRUE)}var u=p.getDeviceUsedForOperation(),C=p.ContextMode.READ;null!=e.CfgEditMultipleConfigurationContextView.collection.isCollectionModified&&1==e.CfgEditMultipleConfigurationContextView.collection.isCollectionModified&&(C=p.ContextMode.EDIT),p.createEventBuilder({category:p.Category.USAGE,action:p.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(p.Labels.EDIT_CONFIGURATION_CONTEXT).setAppId(t).addDimension(h.EDIT_CONFIGURATION_CONTEXT.EDIT_CONFIGURATION_CONTEXT_WIDGET,i).addDimension(h.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_VARIANT,o).addDimension(h.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_MODEL_VERSION,r).addDimension(h.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_MANUFACTURING_PLAN,l).addDimension(h.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_UNIT,s).addDimension(h.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_DATE,c).addDimension(h.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_MEDIA,u).addDimension(h.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_MODE,C).addPersonalValue(g.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_NO_OF_MODEL,a).addPersonalValue(g.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_REFERENCE_SELECTED,n).send()},sendEvtsToWidgetsOnCfgCtxDialogClose:function(){let e=this.CfgEditMultipleConfigurationContextView.collection;null!=this.CfgEditMultipleConfigurationContextView.attachedScopesView&&null!=this.CfgEditMultipleConfigurationContextView.attachedScopesView.collection.isCollectionModified&&1==this.CfgEditMultipleConfigurationContextView.attachedScopesView.collection.isCollectionModified&&(e=this.CfgEditMultipleConfigurationContextView.attachedScopesView.collection);let t={commandName:"cfgEditConfigurationContext",widgetId:widget.id,response:e,data:{}};i.publish("cfgEditConfigurationContextModification_"+widget.id,t),t.data={...t.data,pids:this.options.selection.map((e=>e.id))},d.publishPostProcessingEventForApplications(t)},render:function(){var e=this;this.selectedModelsList=[];o.NoModelAttached;var i=[{label:"Cancel",labelValue:o.Cancel,handler:function(){(null!=e.CfgEditMultipleConfigurationContextView.attachedScopesView&&null!=e.CfgEditMultipleConfigurationContextView.attachedScopesView.collection.isCollectionModified&&1==e.CfgEditMultipleConfigurationContextView.attachedScopesView.collection.isCollectionModified||null!=e.CfgEditMultipleConfigurationContextView.collection&&null!=e.CfgEditMultipleConfigurationContextView.collection.isCollectionModified&&1==e.CfgEditMultipleConfigurationContextView.collection.isCollectionModified)&&e.sendEvtsToWidgetsOnCfgCtxDialogClose(),e.CfgFloatingPanel.closeDialog(),0==e.options.xRevisionPresent&&e.sendEditContextTrackerEvent(e);let t=0,i=[];if(e.CfgEditMultipleConfigurationContextView.probesOperationList&&e.CfgEditMultipleConfigurationContextView.probesOperationList.length>0?(t=e.CfgEditMultipleConfigurationContextView.probesOperationList.length,i=e.CfgEditMultipleConfigurationContextView.probesOperationList):e.CfgEditMultipleConfigurationContextView.attachedScopesView&&e.CfgEditMultipleConfigurationContextView.attachedScopesView.probesOperationList&&e.CfgEditMultipleConfigurationContextView.attachedScopesView.probesOperationList.length>0&&(t=e.CfgEditMultipleConfigurationContextView.attachedScopesView.probesOperationList.length,i=e.CfgEditMultipleConfigurationContextView.attachedScopesView.probesOperationList),i.length>0){for(let e=0;e<t;e++){let t={AppId:i[e].AppId,AppName:i[e].AppName,CommandOperation:i[e].CommandOperation,CommandName:p.Labels.EDIT_CONFIGURATION_CONTEXT,ConfigMode:p.ConfigMode.CONTEXTUAL,ApplicationMode:i[e].ApplicationMode};d.sendConfgurationCommandsClickEventForMagicProbes(t)}let e={AppId:i[0].AppId,CommandName:"Edit Configuration Context Page View"};d.sendConfgurationCommandsPageViewForMagicProbes(e)}},className:"primary"}];C.mask(this.container),C.unmask(this.container);var a={};if(!0===e.options.xRevisionPresent)a.xRevisionContextList=this.createxRevisionCollectionForView(e.options.response),a.selection=e.options.selection,a.pandOAccess=e.options.pAndOAccess,a.typesToSearch=e.options.typesToSearch,a.isAttachContextReadOnly=e.options.isAttachContextReadOnly,this.CfgEditMultipleConfigurationContextView=new c(a);else try{a.enabledCriteriaArray=this.getActivatedCriteriaStates(e.options.response.enabledCriteria,e.options.selection),a.contextList=this.createCollectionForView(e.options.response),a.selection=e.options.selection,this.isCriteriaEditableCheck(e.options.response.referencesInfo),a.isCriteriaEditable=this.criteriaEditable,a.pandOAccess=e.options.pAndOAccess,a.typesToSearch=e.options.typesToSearch,this.CfgEditMultipleConfigurationContextView=new s(a)}catch(e){console.error(e),a.CPQActivation=!1}var n="";n=this.options.selection.length>1?o.Header+" - "+this.options.selection.length+" "+o.Header_All_Ref:o.Header+" - "+this.options.selection[0].alias,this.MainContainer=new UWA.Element("div",{id:"CtxView",html:this.CfgEditMultipleConfigurationContextView.render(),styles:{width:"100%",height:"100%"}});var r={className:"CfgEditConfigurationFloatingPanel",title:n,parent:widget.body,body:this.MainContainer,overlay:!0,mode:"DashboardConfigurationContext",closable:!1,animate:!0,resizable:!0,footer:i,persistId:"CfgEditConfigurationContextDialog",appNamePosition:0,width:440,height:490,minHeight:100,minWidth:370,style:{"min-height":"350px"},dialogue:{header:n,buttonArray:i,target:widget.body}};UWA.createElement("div",{class:"no-model-attached"}),UWA.createElement("div",{class:"gridlistview-dialog-container"});this.CfgFloatingPanel=new t(r),r.parent=widget.body,r.parentElement=widget.body,r.dialogue.object=this.CfgFloatingPanel,this.MainContainer.inject(this.CfgFloatingPanel.container),this.CfgFloatingPanel.render(),this.alertDiv.inject(this.container,"top"),widget.addEvent("onResize",(function(){}))},getActivatedCriteriaStates:function(e,t){var i={};if(e)for(let a=0;a<e.length;a++)e[a].activatedFor.length==t.length?i[e[a].criteriaName]="true":e[a].activatedFor.length<t.length&&e[a].activatedFor.length>0?i[e[a].criteriaName]="mixedState":0==e[a].activatedFor.length&&(i[e[a].criteriaName]="false");return i},createCollectionForView:function(e){var t,i,a=[];return"1.0"!==e.version&&"1.1"!==e.version&&"1.2"!==e.version||(i=e.contextInfo),i&&i.length>0&&i.forEach((function(i){if(i&&i.modelPID){var n=!0;i.notContextOf&&0===i.notContextOf.length&&(n=!1),"1.2"===e.version&&e.description&&i.descId&&e.description[i.descId]&&e.description[i.descId].results&&e.description[i.descId].results.length>0?((t=e.description[i.descId].results[0]).isToPropagate=n,a.push(t)):("1.1"===e.version||!e.description&&i.content&&i.content.results&&i.content.results.length>0)&&((t=i.content.results[0]).isToPropagate=n,a.push(t))}})),a},createxRevisionCollectionForView:function(e){let t,i,a=[];return"1.1"!=e.version&&"1.2"!=e.version||(t=e.xRevisionContent),t.length>0&&t.forEach((function(e){e&&e.xRevisionGraph&&(i=e,a.push(i))})),a},isCriteriaEditableCheck:function(e){var t=this;e&&e.forEach((function(e){"NO"==e.isCriteriaEditable&&(t.criteriaEditable=!1)}))},onResize:function(){},closeDialog:function(){this.CfgFloatingPanel&&this.CfgFloatingPanel.destroy()},renderNative:function(e){var t=this,i={isHeader:!1,isFooter:!0,firstButtonText:this.options.isReadOnly?void 0:o.Cancel,headerText:"",onButtonClickCB:function(){var e=(t.CfgEditMultipleConfigurationContextView.attachedScopesView?t.CfgEditMultipleConfigurationContextView.attachedScopesView:t.CfgEditMultipleConfigurationContextView).getModelIdsAndEnabledCriteria(),i={eventName:"cfgConfigurationContext",operation:"onClose",operationVersion:"1.0",content:e=JSON.stringify(e)};d.sendNotificationWebInWin(i),0==t.options.xRevisionPresent&&t.sendEditContextTrackerEvent(t)}};this.contextViewContainer=new u(i).render(),this.contextViewContainer.inject(e.parent),e.parent=this.contextViewContainer._body,1==t.options.xRevisionPresent?(e.isCriteriaEditable=this.criteriaEditable,this.CfgEditMultipleConfigurationContextView=new c(e)):(e.isCriteriaEditable=this.criteriaEditable,this.CfgEditMultipleConfigurationContextView=new s(e)),this.CfgEditMultipleConfigurationContextView&&e.parent.setHTML(this.CfgEditMultipleConfigurationContextView.render()),this.options.isReadOnly&&e.parent.addClassName("cfg-readonly-criteria")},onModelSearchOK:function(e){var t=this.CfgEditMultipleConfigurationContextView.attachedScopesView?this.CfgEditMultipleConfigurationContextView.attachedScopesView:this.CfgEditMultipleConfigurationContextView;t.onattach(t,e)}})}));