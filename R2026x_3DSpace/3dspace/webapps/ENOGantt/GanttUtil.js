define("DS/ENOGantt/GanttUtil",["DS/ENOGantt/GanttConstants","DS/ENOjquery/ENOjquery","DS/WAFData/WAFData","DS/ENOGantt/URLStore","DS/ENOProjectMgmtModels/Utils/DataUtils"],(function(e,t,n,a,r){var o=function(e){var t=e.onFailure||function(t,n){var a=n||{};!1===a.success&&a.error||(a={error:"Network Error: Unable to load widget due to network or authentication error."}),e.callback.call(this,a)},a=e.onTimeout||function(){e.callback.call(this,{error:"Network Error: Unable to load widget due to timeout error."})},r=e.onCancel||function(){e.callback.call(this,{error:"Application Error: Request canceled."})},o=n.authenticatedRequest(e.url,{method:e.type,type:e.dataType,proxy:"passport",timeout:5e5,cache:3600,data:e.data,onComplete:e.callback,onFailure:t,onCancel:r,async:!1,onTimeout:a,headers:e.headers});return o=o||{cancel:Function.prototype}};return{authenticateReqAndCall:function(e){o(e)},checkRepetativeDependancy:function(e){for(var t=new Array,n=e.split(","),a=0;a<n.length;a++){var r="",o=n[a].split(":");if(r=o.length>2?o[0]+":"+o[1]:o[0],-1!=t.indexOf(r))return!0;t.push(r)}return!1},isNumeric:function(e){return!isNaN(e)},getSelectiveItemArray:function(e,t,n,a){for(var r=[],o=App.Nls["emxProgramCentral.Common.All"],i=1,s=e;i<=s;i++)r.push({text:i,id:t.concat(i),itemId:t.concat(i),level:i});return r.push({text:o,id:t.concat("all"),itemId:t.concat("all")}),r},selectiveExpandFromRMB:function(e,t){e.collapse(!0),e.expand(!1),t>1&&e.hasChildNodes&&this.expandNode(e,t,e.data.depth)},selectiveExpand:function(e,t){var n=e.taskStore.getRoot().childNodes[0];n.expanded?e.collapseAll():n.collapse(!0),n.expand(!1),t>n.data.depth&&n.hasChildNodes&&this.expandNode(n,t,null)},expandNode:function(e,t,n){for(var a=e.childNodes,r=0,o=a.length;r<o;r++){var i=a[r],s=i.data.depth;n&&(s=i.data.depth-n+1),t>=s&&i.expand(!1),t>=s&&i.hasChildNodes&&this.expandNode(i,t,n)}},getDataIndex:function(e,t){return e.taskStore.data.items[0].get("ganttConfig")},getGanttLabel:function(e,t){var n,a=Ext.ComponentQuery.query("#dpmprojectgantt")[0],r=this.getDataIndex(a,e);if(t){var o=e.get("Name");n=e.get("EnglishType")+"rb"}else{o="";n=e.get("EnglishType")+"lb"}if(""!=r&&App.Infra.ViewId!=App.Infra.Views.VIEW_STATUS_REPORT){var i=JSON.parse(r)[n];if(null==i||""==i)return o;var s=i.split("#");if("TaskNotes"==s[0]&&(s[0]="Note"),null==(o="Duration"==s[0]?e.get(s[0])+" "+e.get("DurationUnit"):e.get(s[0]))&&(o=""),this.isDateField(s[0])?o=Ext.Date.format(o,this.getDateFormat()):""!==o&&(o=this.truncateValue(o)),i.indexOf("#")>=0){var l="";"TaskNotes"==s[1]&&(s[1]="Note"),null==(l="Duration"==s[1]?e.get(s[1])+" "+e.get("DurationUnit"):e.get(s[1]))&&(l=""),this.isDateField(s[1])?l=Ext.Date.format(l,this.getDateFormat()):""!==l&&(l=this.truncateValue(l)),""!==l&&(o=""===o?l:o+","+l)}}return o},truncateValue:function(e){return e.length>100?e.substring(0,97)+"...":e},isDateField:function(e){return"StartDate"==e||"EndDate"==e||"BaselineStartDate"==e||"BaselineEndDate"==e},getDateFormat:function(t){if(r.isISODateAndTime())return"Y-m-d H:i";var n="M d, Y, g:i A";return n=void 0!==t?e.dateFormat[t.toLowerCase()]:e.dateFormat[window.languageGlobalVar.toLowerCase()]||n},getLastSequenceIdForProject:function(e){var t=0,n=a.getLastSequenceURL(e),r={url:n,type:"GET",async:!1,dataType:"json",callback:function(e){"200"==e.success&&(t=e.lastSequence)}};return"undefined"==typeof widget?Ext.Ajax.request({url:n,async:!1,success:function(e){var t=JSON.parse(e.responseText.trim());r.callback(t)}}):o(r),t},hasValidSequenceNo:function(e,t){for(var n=Ext.ComponentQuery.query("#dpmprojectgantt")[0],a=App.Nls["emxProgramCentral.Common.Dependency.InvalidSequenceNumber"],r=t.data.Id,o=null,i=e.split(","),s=0;s<i.length;s++){var l,c=i[s].split(":"),p=c.length>2,d=!0;if(p){var u=c[0];if(!this.isValidExternalProject(u))return!1;var f=c[1];null!=(l=this.getSubProjectByName(u))?o=l.get("LastSequence"):d=!1}else{f=c[0];var g=n.taskStore.getModelById(r),m=null,h=g.data.EnglishType;m="ProjectSpace"==h||"ProjectConcept"==h||"Experiment"==h?n.taskStore.toArray()[1].get("Id"):g.get("TaskProjectId"),o=(l=n.taskStore.getModelById(m)).get("LastSequence")}if(!(o&&0==App.Infra.Load.Level||null==l||window.isODTRunning)){m=l.getId();(o=this.getLastSequenceIdForProject(m))||l.set("LastSequence",o)}var y=(f=parseInt(f))<=o;if(0==f||!p&&!y||d&&!y)return a=a.replace("<SequenceNo>",f),alert(a),!1}return!0},getTaskBySequenceId:function(e,t){for(var n=Ext.ComponentQuery.query("#dpmprojectgantt")[0],a=e.get("Id"),r=n.taskStore.toArray(),o=r.length,i=null,s=1;s<o;s++){var l=r[s],c=l.get("TaskSequenceId");c+="";var p=l.get("TaskProjectId");if(t===c&&(!p||p==a)){i=l;break}}if(!i){var d=e.get("Name"),u=this.getExternalProjectTaskBySequenceId(d,t,!0);i={Id:u.taskId,projectPhyId:u.projectPhyId}}return i},getExternalProjectTaskBySequenceId:function(e,t,n){var r=Ext.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0].id,i=a.getExternalProjectTaskBySequenceIdURL(e,t,r,n),s={},l={url:i,type:"GET",async:!1,dataType:"json",callback:function(e){if("200"==e.success){var t=e.taskId,n=e.projectPhyId;s={taskId:t,projectPhyId:n}}}};return"undefined"==typeof widget?Ext.Ajax.request({url:i,async:!1,success:function(e){var t=JSON.parse(e.responseText.trim());l.callback(t)}}):o(l),s},hasCircularDependency:function(e,t){var n=Ext.ComponentQuery.query("#dpmprojectgantt")[0],a=[-1,-3,-4,-9],r={SS:0,SF:1,FS:2,FF:3},o=t.data.Id,i=t.data.Name;i+=", id:"+t.data.TaskSequenceId;var s=App.Nls["emxComponents.Task.CircularDependancyDetected"];s=s.replace("{0}",i);for(var l=[],c=n.getDependencyStore(),p=t.getIncomingDependencies(c),d=[],u=0;u<p.length;u++){var f=p[u].data;d.push(f.From)}var g=e.split(",");for(u=0;u<g.length;u++){var m=!0,h=null,y=null,v=g[u].split(":"),S=v.length>2;if(S){var A=v[0],C=v[1];if(y=v[2],null!=(k=this.getSubProjectByName(A)))h=(I=this.getTaskBySequenceId(k,C)).Id||I.get("Id");else m=!1}else{C=v[0];y=v[1];var T=n.taskStore.getModelById(o),x=null,E=T.data.EnglishType;x="ProjectSpace"==E||"ProjectConcept"==E||"Experiment"==E?n.taskStore.toArray()[1].get("Id"):T.get("TaskProjectId");var I,k=n.taskStore.getModelById(x);h=(I=this.getTaskBySequenceId(k,C)).Id||I.get("Id")}if(y=r[(y=y.substring(0,2)).toUpperCase()],m){var P={};P.From=h,P.To=o,P.Type=y,l.push(P)}if(m&&-1==d.indexOf(h)&&(!S||m)){var N=c.getDependencyError(h,o,y);if(-1!=a.indexOf(N))return alert(s),true}}return!1},validateDependency:function(e,t){if((t=t.trim())&&""!=t){var n=App.Nls.dependencyTypes,a=n[0],r=n[1],o=n[2],i=n[3],s=App.Nls.Active,l=App.Nls.Review,c=App.Nls["emxProgramCentral.Common.InValidProjectSpaceDependency"],p=App.Nls["emxProgramCentral.Common.InValidProjectTemplateDependency"],d=App.Infra.TypeOf.ProjectTemplate?p:c;d=d.replace(/\\n/g,"\n");var u=App.Nls["emxProgramCentral.WBS.editDependency.errorMessage"],f=App.Nls["emxProgramCentral.Common.InValidRepetitionDependency"],g=this.parseDependencyString(t);if(t=g.validationValue,!this.validateDependencySyntax(t))return alert(d),!1;if(t=g.actualValue,this.checkRepetativeDependancy(t))return alert(f),!1;var m=!e.isLeaf(),h=t.toUpperCase(),y=-1!=h.indexOf(r)||-1!=h.indexOf(i);if(m&&y){var v=e.data.Name;return alert(" "+r+" and "+i+" "+u+" "+v),!1}var S=-1!=h.indexOf(a)||-1!=h.indexOf(o);if((e.data.State==s||e.data.State===l)&&S){var A=App.Nls["emxProgramCentral.DependencyNotAllowedNotice"];return A=A.replace("{0}",e.data.State),alert(A),!1}if(!this.hasValidSequenceNo(t,e))return!1;if(this.hasCircularDependency(t,e))return!1}else;return!0},validateDependencySyntax:function(e){var t=/^((([a-zA-Z0-9_-]+((\s\w+)+)?:)?\d+:[FSfs]{2}([\+\-]\d+(\.\d+)?\s([DdHhWw]|[Mm][Oo][Nn]))?)(\,((\w+((\s\w+)+)?:)?\d+:[FSfs]{2}([\+\-]\d+(\.\d+)?\s([DdHhWw]|[Mm][Oo][Nn]))?))*)?$/;return App.Infra.TypeOf.ProjectTemplate&&(t=/^((\d+:[FSfs]{2}([\+\-]\d+(\.\d+)?\s([DdHhWw]|[Mm][Oo][Nn]))?)(\,((\w+((\s\w+)+)?:)?\d+:[FSfs]{2}([\+\-]\d+(\,\d+)?\s([DdHhWw]|[Mm][Oo][Nn]))?))*)?$/),t.test(e)},parseDependencyString:function(e){if(e&&""!=e){e=e.trim();for(var t=new Array("",""),n=":"+App.Nls["emxProgramCentral.KeyinDependency.Default"],a=e.split(","),r=0;r<a.length;r++){var o=a[r];if(o){if(o=o.trim(),isNaN(o))2==o.split(":").length-1&&(o="TestPRJ:"+o.substring(o.indexOf(":")+1,o.length));else a[r]=o+n,o=a[r];0==r?(t[0]=a[r].trim(),t[1]=o.trim()):(t[0]+=","+a[r].trim(),t[1]+=","+o.trim())}}return{actualValue:t[0],validationValue:t[1]}}return{actualValue:"",validationValue:""}},isValidExternalProject:function(e){return!0},getSubProjectByName:function(e){for(var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.toArray(),n=null,a=0,r=t.length;a<r;a++){var o=t[a].data.EnglishType;if(t[a].data.Name==e&&("ProjectSpace"==o||"ProjectConcept"==o||"Experiment"==o)){n=t[a];break}}return n},enableButtons:function(e){for(var t=0;t<e.length;t++)Ext.getCmp(e[t].trim()).enable()},disableButtons:function(e){for(var t=0;t<e.length;t++)Ext.getCmp(e[t].trim()).disable()},isValidRMBOperation:function(t,n){var a=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(a.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;a.getCrudManager().reject()}if(!this.isRecordSelectionOkForAddOrDeleteTask(n))return!1;e.actionType;var r=t.data.EnglishType;if(this.isDeleteTask(n))if("ProjectSpace"==r||"ProjectConcept"==r||"Experiment"==r){if(!confirm(App.Nls["emxProgramCentral.Project.ConfirmSubProjectDelete"]))return!1}else if(!confirm(App.Nls["emxProgramCentral.Project.ConfirmTaskDelete"]))return!1;return!(this.isAddAsSubTask(n)&&!this.cnfrmToRemoveSelectedTaskDependency(t))&&(this.isDeleteTask(n)&&this.filterTasksBeforeDelete(),!0)},isValidAddTaskAbove:function(e){return!this.isRootNode(e)&&this.isValidAddSubTask(e.parentNode)},isValidAddSubTask:function(e){var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0],n=t.data.Policy;return!!this.hasAccessOnTaskForRestrictAssignee(e)&&((null==App.Infra.BaselineRequired||1!=App.Infra.BaselineRequired)&&("Project Space Hold Cancel"!=n&&(!!this.isSelTaskInActiveOrPrior(e)&&("Cancel"!=t.data.experimentProjectState&&"Hold"!=t.data.experimentProjectState&&("TRUE"!=e.data.passiveSubtask&&((!e.isMilestone()||!e.isLeaf())&&(e.data.State!=App.Nls.Complete&&("TRUE"==e.data.hasEditAccess&&(App.Infra.Views.VIEW_TEMPLATE_WBS==App.Infra.ViewId||(App.Infra.Views.VIEW_WBS==App.Infra.ViewId?!App.Infra.TypeOf.Experiment||!App.Infra.routeId:1!=App.Infra.ReadOnly))))))))))},isValidRemoveSubProject:function(e){if(null!=App.Infra.BaselineRequired&&1==App.Infra.BaselineRequired)return!1;if(this.isRootNode(e))return!1;var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if("Project Space Hold Cancel"==t.taskStore.getRoot().childNodes[0].data.Policy)return!1;for(var n=t.lockedGrid.getSelectionModel().selected.items,a=0;a<n.length;a++){var r=n[a].data.EnglishType;if("Task"==r||"Phase"==r||"Gate"==r||"Milestone"==r)return!1}return!0},isValidDeleteTask:function(e){var t=App.Nls.Create,n=App.Nls.Assign,a=e.data.State;e.data.EnglishType;if(null!=App.Infra.BaselineRequired&&1==App.Infra.BaselineRequired)return!1;if(this.isRootNode(e))return!1;var r=Ext.ComponentQuery.query("#dpmprojectgantt")[0],o=r.taskStore.getRoot().childNodes[0];if("Project Space Hold Cancel"==o.data.Policy)return!1;if("ProjectBaseline"==o.data.EnglishType)return!1;for(var i=r.lockedGrid.getSelectionModel().selected.items,s=0;s<i.length;s++){var l=i[s].data.EnglishType;if("ProjectSpace"==l||"ProjectConcept"==l||"Experiment"==l)return!1}return"Cancel"!=o.data.experimentProjectState&&"Hold"!=o.data.experimentProjectState&&((t==a||n==a)&&"TRUE"==e.data.deleteAccess)},filterTasksBeforeDelete:function(){this.filterTasksBeyondAssignState()},filterTasksBeyondAssignState:function(){for(var e=Ext.ComponentQuery.query("#dpmprojectgantt")[0],t=App.Nls.Create,n=App.Nls.Assign,a=new Array,r=e.lockedGrid.getSelectionModel().selected.items,o=0,i=r.length;o<i;o++){var s=r[o].id,l=e.taskStore.getModelById(s),c=l.data.State,p=(l.data.isSummaryTask,l.data.EnglishType);t!=c&&n!=c&&"ProjectSpace"!=p&&"ProjectConcept"!=p&&"Experiment"!=p&&(e.lockedGrid.getSelectionModel().deselect(l),a.push(l.data.Name),--o,--i)}a.length>0&&alert(App.Nls["emxProgramCentral.Common.UnableToDeleteTasks"]+"\n"+a)},filterBy_Mandatory_Effort_Effectivity:function(e){var t=e.MandExcludeTaskIds,n="";t.length>0&&((r=this.deSelectAndGetNames(t)).length>0&&(n="\n"+n+App.Nls["emxProgramCentral.Common.CannotDeleteMandatoryTask"]+"\n"+r+"\n"));var a=e.TaskIdsWithEffort;a.length>0&&((r=this.deSelectAndGetNames(a)).length>0&&(n="\n"+n+App.Nls["emxProgramCentral.WeeklyTimeSheet.DeleteTask.TaskWithEffortCannotBeDeleted"]+"\n"+r+"\n"));var r,o=e.MilestoneListUsedInEffectivity;o&&((r=this.deSelectAndGetNames(o)).length>0&&(n="\n"+n+App.Nls["emxProgramCentral.Common.CannotDeleteMilestoneEffectivityTask"]+"\n"+r));if(n.length>0)return n},getAsArr:function(e){return-1!=e.indexOf("[")&&-1!=e.indexOf("]")&&(e=e.substring(1,e.length-1)),e.split(",")},deSelectAndGetNames:function(e){for(var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0],n=new Array,a=t.lockedGrid.getSelectionModel(),r=0,o=e.length;r<o;r++){var i=e[r].trim(),s=t.taskStore.getModelById(i);a.deselect(s),n.push(s.data.Name)}return n},isParentInActiveOrPrior:function(e){App.Nls.Active;var t=App.Nls.Review,n=App.Nls.Complete,a=e.parentNode.data.State;return a!=t&&a!=n},isSelTaskInActiveOrPrior:function(e){var t=App.Nls.Review,n=App.Nls.Complete,a=App.Nls.Archive,r=e.data.State;return App.Infra.Views.VIEW_TEMPLATE_WBS===App.Infra.ViewId||r!=t&&r!=n&&r!=a},cnfrmToRemoveSelectedTaskDependency:function(e){for(var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0],n=e.getIncomingDependencies(t.getDependencyStore()),a=0,r=n.length;a<r;a++){var o=n[a].data.Type;if("1"==o||"3"==o){var i=App.Nls.dependencyTypes,s=i[1],l=i[3],c=App.Nls["emxProgramCentral.WBS.addSubtask.ConfirmToRemoveDependency"];return c=(c=(c=(c=c.replace("<dependencyType1>",s)).replace("<dependencyType3>",s)).replace("<dependencyType2>",l)).replace("<dependencyType4>",l),confirm(c)}}return!0},isRecordSelectionOkForAddOrDeleteTask:function(e){var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.length;if(this.isAddTask(e)&&1!=t)return alert(App.Nls["emxFramework.Common.PleaseSelectOneItemOnly"]),!1;if(this.isDeleteTask(e)){if(t<1)return alert(App.Nls["emxFramework.Common.PleaseSelectitem"]),!1;if(t>1950)return alert(App.Nls["emxProgramCentral.Common.TooManySelected"]),!1}return!0},isAddAsSubTask:function(t){var n=e.actionType;return n.ADD_SUB_TASK==t||n.ADD_PHASE==t||n.ADD_GATE==t||n.ADD_MILESTONE==t},isAddTask:function(t){var n=e.actionType;return this.isAddAsSubTask(t)||n.ADD_TASK_ABOVE==t},isDeleteTask:function(e){return!this.isAddTask(e)},isRootNode:function(e){return""==e.data.TaskSequenceId||null==e.data.TaskSequenceId},isValidTaskResize:function(e,t,n){var a=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(!e.isDurationEditable())return!1;var r=t.currentTarget.className.indexOf("start")>-1?"StartStretch":"EndStretch",o=e.get("TaskProjectId");o="null"==o?e.id:o;var i=a.taskStore.getModelById(o),s=i.get("ScheduleFrom");return"Forecast"!==i.get("scheduleBasedOn")&&!("StartStretch"===r&&"Project Start Date"===s||"EndStretch"===r&&"Project Finish Date"===s)},isValidManageResourceAction:function(e){var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0],n=t.lockedGrid.getSelectionModel().selected.items;if(!this.hasAccessOnTaskForRestrictAssignee(e))return!1;if(null!=App.Infra.BaselineRequired&&1==App.Infra.BaselineRequired)return!1;if(n&&1!=n.length)return!1;var a=App.Infra.TypeOf.Experiment,r=App.Infra.TypeOf.ProjectTemplate,o=App.Infra.TypeOf.ProjectBaseline,i=e.data.EnglishType;if(a||r||o||"ProjectSpace"==i)return!1;var s=t.taskStore.getRoot().childNodes[0];if("ProjectSpace"==s.data.EnglishType&&"ProjectSpace"!=i){if("Project Space"!=s.data.Policy)return!1;var l=App.Nls.Complete,c=e.data.State;if("TRUE"!=e.data.hasEditAccess||e.isReadOnly()||l==c)return!1}return!0},isGanttChartReadOnly:function(){var e=!1,t=Ext.ComponentQuery.query("#dpmprojectgantt")[0];return t&&(e=t.isReadOnly()),e},validateBadNameChar:function(e){var t=!0,n=a.validateBadNameCharURL(),r={url:n,type:"GET",async:!1,dataType:"json",callback:function(n){if(n.badChars)for(var a=(a=App.Nls["emxProgramCentral.ProjectImport.InvalidCharacterInTaskName"])+"\n"+n.badChars,r=n.badChars.split(" "),o=0;o<r.length;o++){var i=r[o];if(-1!=e.indexOf(i)){t=!1,alert(a);break}}}};return"undefined"==typeof widget?Ext.Ajax.request({url:n,async:!1,success:function(e){if("200"==e.status){var t=JSON.parse(e.responseText.trim());r.callback(t)}}}):o(r),t},getStoreTaskExpandStatus:function(e){for(var t=e.getData().items.length,n=0;n<t;n++){var a=e.getData().items[n];if(0==a.get("leaf"))1==a.get("expanded")&&(App.Infra.expandStatus[a.get("Id")]=!0)}},isValidForOpenInNewTab:function(e){return null==App.Infra.BaselineRequired||1!=App.Infra.BaselineRequired},isValidForCollabTask:function(e){Ext.ComponentQuery.query("#dpmprojectgantt")[0];var t=e.get("EnglishType");return!("ProjectTemplate"==t||"ProjectSpace"==t||"ProjectConcept"==t||"Experiment"==t||!e.isLeaf())},isTaskAllExpanded:function(e){var t=e.data.EnglishType;return"ProjectSpace"==t||"ProjectConcept"==t||"Experiment"==t||"ProjectTemplate"==t||"ProjectBaseline"==t||"TRUE"===e.data.isSummaryTask},isReadyToExpand:function(e,t,n,a){var r=this,o=!1,i=Ext.ComponentQuery.query("#dpmprojectgantt")[0],s=n||0;if(null!=App.Infra.Load.Level){var l=App.Infra.Load.Level;if(l>=s&&0!=s||0==l)return t(),!0;App.Infra.Load.Level=s>=5||0==s?0:s}e?(e.set("expanded",!0),o=!0,i.crudManager.isExpandCall=o):a&&a.refresh&&(i.crudManager.isExpandCall=a.refresh);var c=i.getTaskStore();new UWA.Promise((function(e,t){i.crudManager.transport.load.resolve=e,o&&r.getStoreTaskExpandStatus(c),console.time("load"),i.crudManager.load(),console.timeEnd("load")})).then((function(e){delete i.crudManager.isExpandCall,t()}))},isValidForColor:function(e,t){var n=Ext.ComponentQuery.query("#dpmprojectgantt")[0],a=n.taskStore.getRoot().childNodes[0],r=a.data.Policy;if(!this.hasAccessOnTaskForRestrictAssignee(e))return!1;if(null!=App.Infra.BaselineRequired&&1==App.Infra.BaselineRequired)return!1;if("ProjectBaseline"==a.data.EnglishType)return!1;if("Project Space Hold Cancel"==r)return!1;if("Cancel"==a.data.experimentProjectState||"Hold"==a.data.experimentProjectState)return!1;if(!this.isSelTaskInActiveOrPrior(e))return!1;if("TRUE"!=e.data.hasEditAccess)return!1;var o=n.getSchedulingView(),i=n.lockedGrid.getView().getSelectionModel();if(t&&!t.ctrlKey){for(var s=n.lockedGrid.getSelectionModel().selected.items,l=0,c=s.length;l<c;l++)o.unhighlightTask(s[l],!1),i.deselect(s[l]);i.select(e)}return o.highlightTask(e,!1),!0},isValidTaskIndentation:function(e,t){for(var n=[],a=0,r=e.length;a<r;a++){for(var o=(C=e[a]).parentNode,i=!1;o;){if(e.indexOf(o)>=0){i=!0;break}o=o.parentNode}i||n.push(C)}(e=n).sort((function(e,t){return e.data.TaskSequenceId-t.data.TaskSequenceId}));var s=[],l=[],c=[],p=[],d=!0;for(a=e.length-1;a>=0;a--){var u=(C=e[a]).data.PercentDone;if(C.previousSibling&&("ProjectSpace"==C.previousSibling.get("EnglishType")||"ProjectConcept"==C.previousSibling.get("EnglishType")||"Experiment"==C.previousSibling.get("EnglishType"))&&e.indexOf(C.previousSibling)<0)for(var f=!0;f;){if(C.previousSibling=C.previousSibling.previousSibling,C.previousSibling)"Task"!=(y=C.previousSibling.get("EnglishType"))&&"Phase"!=y&&"Gate"!=y&&"Milestone"!=y||(f=!1);else f=!1}if(C.previousSibling&&100==C.previousSibling.get("PercentDone")&&0==t){d=!1;break}if(100!=u)if(t){if(null==C.parentNode.get("TaskProjectId")){s.push(C.get("Name")),e.splice(a,1);continue}}else{if(null!=C.previousSibling){var g=C.previousSibling,m=g.get("EnglishType");if("Gate"==m||"Milestone"==m||"TRUE"==g.get("passiveSubtask")){if(e.indexOf(g)>=0){for(var h=!0;h;)if(null!=(g=g.previousSibling)){var y=g.get("EnglishType"),v=g.get("passiveSubtask");if(e.indexOf(g)<0){"Gate"==y||"Milestone"==y||"TRUE"==v?d=!1:h=!1;break}}else h=!1;continue}d=!1;break}}if(null==C.previousSibling){l.push(C.get("Name")),e.splice(a,1);continue}}else c.push(C.get("Name")),e.splice(a,1)}var S="",A=!0;if(!d){for(a=0,r=e.length;a<r;a++){var C=e[a];p.push(C.get("Name"))}e=[],S=S+App.Nls["emxProgramcentral.Milestone.SubtaskCreationAlert"]+"\n"+p+"\n"}return s.length>0&&(S=S+App.Nls["emxProgramcentral.TaskIndentaion.NoLeftIndentAlert"]+"\n"+s+"\n"),l.length>0&&(S=S+App.Nls["emxProgramcentral.TaskIndentaion.NoRightIndentAlert"]+"\n"+l+"\n"),c.length>0&&(S=S+App.Nls["emxProgramCentral.TaskDragdrop.TaskInReviewState"]+"\n"+c+"\n"),""!=S&&(A=confirm(S)),A||(e=[]),e},syncAjaxCall:function(e,t){null!=t&&""!=t||(t="GET");var n="",a={url:e,type:t,async:!1,dataType:"json",callback:function(e){n=e}};return"undefined"==typeof widget?Ext.Ajax.request({url:e,async:!1,success:function(e){var t=JSON.parse(e.responseText.trim());a.callback(t)}}):o(a),n},getGanttItem:function(e,t){for(var n=e.items.items,a=0,r=n.length;a<r;a++)if(itemIdValue=n[a].id,t===itemIdValue){var o=n[a];break}return o},getTaskAndProjectModelFields:function(){var e=new Array,t=App.Infra.Columns,n=t.length;for(e.push({name:"TaskProjectId",mapping:"TaskProjectId"}),e.push({name:"ExternalDependencies",mapping:"ExternalDependencies"}),e.push({name:"ExternalRawDependencies",mapping:"ExternalRawDependencies"}),e.push({name:"hasEditAccess",mapping:"hasEditAccess"}),e.push({name:"Color",mapping:"Color",type:"string"}),e.push({name:"Pattern",mapping:"Pattern"}),e.push({name:"Symbol",mapping:"Symbol"}),e.push({name:"EnglishType",mapping:"EnglishType"}),e.push({name:"BaselineDuration",mapping:"BaselineDuration"}),idx=0;idx<n;idx++){var a=t[idx],r=a.dataIndex,o=a.xtype,i=a.excludeInRefinement;"datecolumn"==o?e.push({name:r,mapping:r,excludeInRefinement:i,type:"date",dateFormat:"c"}):e.push({name:r,mapping:r,excludeInRefinement:i})}return e},doBasicEditChecks:function(e){if(e.data.hasEditAccess&&"false"==e.data.hasEditAccess.toLowerCase()||App.Infra.TypeOf.ProjectBaseline||App.Infra.BaselineRequired||App.Infra.routeId&&App.Infra.ReadOnly)return!1;var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0];return t.data.State!=App.Nls.Cancel&&("Cancel"!=t.data.experimentProjectState&&"Hold"!=t.data.experimentProjectState)},cacheColumnConfiguration:function(e,t,n,a,r){var o=t.name;if(null!=o&&""!=o){var i=App.Infra.Columns;null!=App.Infra.ColumnConfig&&""!=App.Infra.ColumnConfig||(App.Infra.ColumnConfig={}),null!=App.Infra.ColumnConfig[o]&&""!=App.Infra.ColumnConfig[o]||(App.Infra.ColumnConfig[o]={});for(var s=0,l=i.length;s<l;s++){if(o==i[s].name){App.Infra.ColumnConfig[o][a]=r;break}if(null!=i[s].columns)for(var c=i[s].columns,p=0,d=c.length;p<d;p++)if(o==c[p].name){App.Infra.ColumnConfig[o][a]=r;break}}}},cacheColumnIndex:function(){for(var e=Ext.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getColumns(),t=0,n=e.length;t<n;t++){var a=e[t],r=t;this.cacheColumnConfiguration(null,a,null,"columnIndex",r)}},getConfigurationCommnads:function(){var e=[];return 1==App.Infra.ReadOnly||(e.push({text:App.Nls["emxProgramCentral.Gantt.Toolbar.OpenConfigurationPanel"],id:"tBarganttConfiguration",tooltip:App.Nls["emxProgramCentral.Gantt.Toolbar.OpenConfigurationPanel"],iconCls:"tBarIcon",reference:"ganttConfiguration",overflowText:App.Nls["emxProgramCentral.Gantt.Toolbar.OpenConfigurationPanel"]}),e.push({text:App.Nls["emxProgramCentral.Gantt.Toolbar.SaveColumnConfiguration"],id:"tBarSaveColumnConfiguration",tooltip:App.Nls["emxProgramCentral.Gantt.Toolbar.SaveColumnConfiguration"],iconCls:"tBarIcon",reference:"saveColumnConfiguration",overflowText:App.Nls["emxProgramCentral.Gantt.Toolbar.SaveColumnConfiguration"]}),e.push({text:App.Nls["emxProgramCentral.Gantt.Toolbar.ResetToDefault"],id:"tBarResetToDefaultColumnConfiguration",tooltip:App.Nls["emxProgramCentral.Gantt.Toolbar.ResetToDefault"],iconCls:"tBarIcon",reference:"resetToDefaultColumnConfiguration",overflowText:App.Nls["emxProgramCentral.Gantt.Toolbar.ResetToDefault"]})),e},getSVGImage:function(e,t,n,a){var r="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'",o="%2342a2da";return null!=n&&""!=n&&(o="%23"+n),r+=" fill='"+o+"'","circle"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Ccircle id='circle' class='circle' cx='36' cy='36' r='31.5'":"concavesquare"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpath class='concavesquare' d='M67.5,22.05v27.91c-8.82,1.78-15.76,8.72-17.55,17.54h-27.9c-1.79-8.82-8.73-15.76-17.55-17.54v-27.91c8.82-1.79,15.76-8.73,17.55-17.55h27.9c1.79,8.82,8.73,15.76,17.55,17.55Z'":"diamond"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Crect class='simple-diamond' x='13.5416' y='13.5416' width='44.9169' height='44.9169' transform='translate(-14.9117 36) rotate(-45)'":"ellipse"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cellipse class='ellipse' cx='36' cy='36' rx='36' ry='22.5'":"facetdiamond"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpolygon class='facetdiamond' points='56.8264 9.2171 36 7.2459 15.1736 9.2171 1.2894 24.5583 36 64.7541 70.7106 24.5583 56.8264 9.2171'":"heart"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpath class='heart' d='M65.255,36.5264c-7.5489,9.8215-19.8787,21.7197-29.2541,28.062-9.3759-6.3422-21.7069-18.2405-29.2563-28.062C2.6923,31.2546.3846,19.2804,7.5444,12.1216c6.7162-6.7152,18.4666-5.5886,24.2555-.7962,1.3525,1.1197,2.757,2.3087,4.201,3.5645,1.4432-1.2557,2.8469-2.4448,4.1986-3.5645,6.4636-5.0163,17.1282-5.6857,24.2555.7961,7.2067,6.554,5.1941,18.6879.8,24.4048Z'":"pentagon"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpolygon class='pentagon' points='36 4.7685 3.1612 28.6272 15.7045 67.2315 56.2955 67.2315 68.8388 28.6272 36 4.7685'":"rhombus"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpolygon class='rhombus' points='49.5 58.5 0 58.5 22.5 13.5 72 13.5 49.5 58.5'":"roundedRectangle"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpath class='rounded-rectangle' d='M26.9444,13.5h40.5556v22.4444c0,12.4487-10.1068,22.5556-22.5556,22.5556H4.5v-22.5556c0-12.3874,10.057-22.4444,22.4444-22.4444Z'":"shield"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpath class='shield' d='M65.8902,10.0216c-.0047,2.8799-.1898,5.7218-.5409,8.5068-2.5098,19.8746-13.555,37.0876-29.3493,47.8528-15.7944-10.7652-26.8395-27.9782-29.3493-47.8528-.3511-2.785-.5361-5.6269-.5409-8.5068,15.8902-5.5216,42.8902-5.5216,59.7804,0Z'":"square"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Crect class='square' x='6.2461' y='6.2461' width='59.5079' height='59.5079'":"star"==t?r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpolygon class='star' points='36 3.1776 46.6647 24.7865 70.5116 28.2517 53.2558 45.0719 57.3293 68.8224 36 57.609 14.6707 68.8224 18.7442 45.0719 1.4884 28.2517 25.3353 24.7865 36 3.1776'":"triangle"==t&&(r+=" class='gantt-element-milestone' viewBox='0 0 72 72'%3E%3Cpolygon class='triangle' points='36 8.5745 4.3317 63.4255 67.6683 63.4255 36 8.5745'"),r+=" /%3E%3C/svg%3E"},renameKey:function(e,t,n){t!==n&&(Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(e,t)),delete e[t])},hasAccessOnTaskForRestrictAssignee:function(e){if(e){let t=!1,n=e.get("hasEditAccess");if(n&&"true"==n.toLowerCase()){let n=App.Infra.contextInfo;if(e&&e.get("TaskProjectId")&&e.get("TaskProjectId")!=App.Infra.contextInfo.get("id")){let n=Ext.ComponentQuery.query("#dpmprojectgantt")[0].getTaskStore().getModelById(e.get("TaskProjectId"));t=n&&"TRUE"===n.get("hasEditAccess")}else t="TRUE"===n.get("modifyAccess");let a=e.get("restrictAssigneeAccess");return!(!t&&a&&"yes"==a.toLowerCase())}return!1}}}}));