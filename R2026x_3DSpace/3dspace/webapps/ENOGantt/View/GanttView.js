try{define("DS/ENOGantt/View/GanttView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/E6WCommonUI/Views/DetailsDisplayView","DS/E6WCommonUI/Views/FoundationBaseView","DS/Foundation2/Models/ReferenceModel","DS/Foundation2/FoundationV2Data","DS/ENOProjectMgmtModels/Models/AppSettings","DS/ENOGantt/Widget/PreferenceUtils","DS/ENOGantt/Infra","DS/ENOGantt/Data/CrudManager","DS/ENOGantt/View/Toolbar","DS/ENOGantt/View/ResourceUtilizationPanel","DS/ENOGantt/View/TaskCreationPanel","DS/ENOGantt/View/GanttConfiguration","DS/ENOGantt/View/GanttRefinement","DS/ENOGantt/Data/ResponseUtil","DS/ENOGantt/GanttUtil","DS/ENOGantt/Custom/DPMGanttAll","DS/E6WCommonUI/UIHelper","DS/ENOGantt/URLStore","DS/ENOProjectMgmtModels/Collections/Projects","DS/ENOGantt/Nls/Eno/"+window.languageGlobalVar,"css!DS/Sencha/classic/theme-neptune/resources/theme-neptune-all","css!DS/Bryntum/resources/css/sch-gantt-triton-all","css!ENOGantt/GanttWidget.css","css!ENOGantt/GanttGradientPattern.css","css!ENOGantt/Custom/GanttCustomGradientPattern.css","css!ENOGantt/GanttGradientSymbol.css"],(function(e,t,n,a,r,o,i,s,l,c,d,p,g,u,h,m,f,y,w,v,C,P,S,b,I,T){"use strict";var E="savedPhysicalId",A="savedObjectID",D="savedObject",j="savedTitle",G="Project Space,Project Concept,Project Baseline",V="bordered",O=l.extend({get:function(e){if("canEdit"===e)return!0,true;this._parent.apply(this,arguments)},dataForRendering:function(){return{canEdit:!0}},add:function(e,t){this._fireRelationshipChangeEvents(e,t,!0)}}),B=s.extend({_uwaClassName:"GanttView",ganttViewAppsettings:void 0,className:"gantt-view",id:function(){return"ganttView"},domEvents:{"dragover ":"handleDragOver","drop ":"handleDrop","drop .drop-target":"handleDrop","dragend .drop-target":"handleDragEnd"},save:function(){this.crudManager.sync()},getViewHeight:function(){return window.isIFWE?this.container.clientHeight:r.getBody().getHeight()},loadGanttView:function(e){let t=UWA.clone(e||{},!1),n=e&&e.contextModel;this.contextInfo=n.model||n;let a=this.contextInfo.id,r=t.AppSettings,o=r.get("collabspace");this.ganttViewAppsettings=r,this.parentApp=e.parentView,a?(App.ContextModel=n,this.contextInfo&&(this.initializeEvents(this.contextInfo),p.set(j,this.contextInfo.title)),this._onProjectSelected("",a,o,r)):this.hideGanttPanels()},initializeEvents:function(e){this.listenTo(e,{removeTaskFromGantt:this.removeTasksFromGanttChart,onSaveModelComplete:this.updateGanttChart})},handleListenersForTasks:function(e){this.listenTo(e,{onSaveModelComplete:this.updateGanttChart})},removeTasksFromGanttChart:function(){let e=r.ComponentQuery.query("#dpmprojectgantt")[0];var t=e.getTaskStore();let n=e.lockedGrid.getSelectionModel().selected.items;t.removeTasks(n),e.crudManager.commit(),e.crudManager.load()},updateGanttChart:function(e){if(e){let e=r.ComponentQuery.query("#dpmprojectgantt")[0];App.Infra.loadProjectSelectable||(App.Infra.loadProjectSelectable=!0);let t=e.crudManager;C.getStoreTaskExpandStatus(e.getTaskStore()),t.load()}},getSavedProjectPhysicalId:function(){return p.get(E)},removeProjectPhysicalId:function(){p.set(E,!1)},setup:function(e){let t=UWA.clone(e||{},!1);if(this.container=t.container,this.homeView=t.homeView,this.viewCollection=this.homeView&&this.homeView.viewCollection||this.homeView._viewCollection,this.ganttPlugins=e.ganttPlugins,this.mainPanel=r.create("Ext.panel.Panel",{width:"auto",id:"mainpanel",xtype:"xmainpanel",autoHeight:!0,height:this.getViewHeight(),layout:"border",renderTo:this.container}),window.isIFWE){this.alerter=new a({autoHide:!0,closable:!0}),this.alerter.inject(this.container,"top"),widget.alerter=this.alerter}},prerender:function(){},getGanttPlugins:function(){var e=new this.ganttPlugins;return e&&e.getPlugins()},renderProjectGantt:function(){var e=this;new g({viewCollection:e.viewCollection,contextInfo:e.contextInfo,loadWidget:function(t){e.searchPanel&&(e.searchPanel.setLoading(!1),e.searchPanel.setHidden(!0));var n=new u({parentView:e,viewCollection:e.viewCollection});if(e.crudManager=n.crudManager,r.ComponentQuery.query("#dpmprojectgantt")[0]){var a=r.ComponentQuery.query("#dpmprojectgantt")[0];e.panel.setReadOnly(!1),App.Infra.TypeOf.ProjectBaseline&&e.panel.setReadOnly(!0),e.refreshGanttColumn(a),e.refreshToolbar(a),e.refreshPlugins(a);var i=r.getCmp("dpmresourceutilizationpanel"),s=r.getCmp("GanttRefinementPanel"),l=r.getCmp("ganttConfigPanel");i&&i.hide(),s&&s.hide(),l&&l.hide(),e.panel.show()}else{new P;var c=!1,d=C.getDateFormat();App.Infra.ViewId!=App.Infra.Views.VIEW_TEMPLATE_WBS&&(c=r.create("DS.ENOGantt.DPMGanttAll.TooltipTamplate",null,d));var g={ToolbarRequired:App.Infra.ToolbarRequired};e.undoManager=new o.data.undoredo.Manager({transactionBoundary:"timeout",stores:[e.crudManager.getTaskStore(),e.crudManager.getDependencyStore()],listeners:{undoqueuechange:function(e,t){var n=r.ComponentQuery.query("#dpmprojectgantt")[0].undoManager.getRedoQueue().length,a=r.getCmp("tBarActionRedo");0===n?null!=a&&(a.isDisabled()||a.disable()):null!=a&&a.isDisabled()&&(a.enable(),a.setTooltip(App.Nls["emxProgramCentral.Gantt.Redo"]))}}}),e.panel=r.create("Gnt.panel.Gantt",{xtype:"dpmprojectgantt",id:"dpmprojectgantt",rowHeight:32,region:"center",parentView:e.parentApp,rightLabelField:{renderer:function(e,t){return C.getGanttLabel(t,!0)}},leftLabelField:{renderer:function(e,t){return C.getGanttLabel(t,!1)}},dragDropConfig:{showExactDropPosition:!0},undoManager:e.undoManager,controller:"GanttViewController",columns:App.Infra.Columns,crudManager:e.crudManager,highlightWeekends:!0,tooltipTpl:c,showTodayLine:!0,showProjectLines:!1,loadMask:!0,zoomKeepsOriginalTimespan:!0,selModel:new r.selection.TreeModel({ignoreRightMouseSelection:!1,mode:"MULTI"}),autoFitOnLoad:!0,columnLines:!0,enableBaseline:!0,baselineVisible:App.Infra.BaselineRequired,enableProgressBarResize:!0,showRollupTasks:!1,allowParentTaskMove:!0,enableTaskReordering:!0,toggleParentTasksOnClick:!1,tbar:e.getTbar(g),bbar:e.getBbar(g),plugins:e.getGanttPlugins(),taskBodyTemplate:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}" unselectable="on"><span class="sch-gantt-progress-bar-label" style="display: inline-block;margin-top: 3px;padding: 0.5pt 2pt 0 0;border-radius: 2px;background-color: inherit;">{[Gnt.column.PercentDone.prototype.defaultRenderer(values.percentDone)]}%</span></div>',parentTaskBodyTemplate:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}; text-align: right" unselectable="on"><span class="sch-gantt-progress-bar-label" style="display: inline-block;margin-top: 1px;padding: 0.5pt 2pt 0 0;border-radius: 2px;background-color: inherit; font-size: 0.8em; color:#FFFFFF">{[Gnt.column.PercentDone.prototype.defaultRenderer(values.percentDone)]}%</span></div>',eventRenderer:function(e,t){var n,a,o,i,s=e.get("Symbol");if(void 0!==e||void 0!==t){if((null==s||""==s)&&e.get("Color")&&""!=e.get("Color"))if(n=r.String.format("background-color: #{0}!important;border-color:#{0}!important",e.get("Color")),t.segments)for(a=t.segments,o=0;o<a.length;o++)a[o].style=n;else i={style:n}}else i={};if((null==s||""==s)&&e.get("Pattern")&&""!=e.get("Pattern")){var l=e.get("Pattern"),c=l;"Gate"!=e.get("Type")&&"Milestone"!=e.get("Type")||(c=l+"-gate"),0==e.get("leaf")&&(c=l+"-summary"),i&&i.style?(i.cls=c,i.ctcls=c):i={cls:c,ctcls:c}}if((null==s||""==s)&&e.get("Color")&&""!=e.get("Color")){var d=p(e.get("Color"),-.5);function p(e,t){e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var n,a,r="#";for(a=0;a<3;a++)n=parseInt(e.substr(2*a,2),16),r+=("00"+(n=Math.round(Math.min(Math.max(0,n+n*t),255)).toString(16))).substr(n.length);return r}i.progressBarStyle="background-color:"+d+"!important;border-color:"+d}return void 0!==e&&("TRUE"!=e.get("isTypeMilestone")&&"TRUE"!=e.get("isTypeGate")||e.get("State")!=App.Nls.Complete||null!=e.get("Color")&&""!=e.get("Color")||(i={style:n=r.String.format("background-color: #969696!important;border-color:#969696!important")})),i},lockedGridConfig:{width:"20%"},listeners:{taskclick:e.getTask}}),e.undoManager.start(),(enoviaServer.viewId==App.Infra.Views.VIEW_STATUS_REPORT||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_WBS||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_VERSUS_CURRENT_BASELINE||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_VERSUS_CURRENT_BASELINE2||enoviaServer.viewId==App.Infra.Views.VIEW_TEMPLATE_WBS||App.Infra.routeId)&&e.panel.setReadOnly(App.Infra.ReadOnly),e.refinement=new w({taskStore:e.crudManager.getTaskStore()}),e.refinement.render(),e.resourceUtilizationPanel=new m({viewCollection:e.viewCollection}),e.ganttTaskCreationPanel=new f({parentView:e.parentApp}),e.ganttConfigPanel=new y({parentView:e.parentApp});var h={region:"center",layout:"border",items:[e.panel,{xtype:"dpmresourceutilizationpanel",id:"dpmresourceutilizationpanel",region:"south",height:"50%",partnerTimelinePanel:e.panel,hidden:!0}]};window.gantt=e.ganttPanel,r.tip.QuickTipManager.init(),e.mainPanel.add({xtype:e.refinement.panel,reference:"refinement"}),e.mainPanel.add(h),e.mainPanel.add({xtype:"ganttConfigPanel",id:"ganttConfigPanel"}),e.mainPanel.add({xtype:"ganttTaskCreationPanel",id:"ganttTaskCreationPanel"})}if(!window.isODTRunning&&enoviaServer.physicalId){(a=r.ComponentQuery.query("#dpmprojectgantt")[0]).rendered&&a.setLoading({msg:App.Infra.LoadText||a.L("loadingText")});var S=b.getCalendarURL();v.loadCalendarData(S).then((function(){console.log("resolve"),e.panel.crudManager.load(),console.log("done")}),(function(){console.log("Failed to load calendar data. Please check server logs")}))}window.isIFWE&&widget.setTitle(p.get("savedTitle"))}})},refreshPlugins:function(e){var t=r.ComponentQuery.query("#dependencyEditor")[0],n=r.ComponentQuery.query("#taskEditor")[0],a=r.ComponentQuery.query("#projectEditor")[0],o=r.ComponentQuery.query("#customColorPanel")[0],i=r.ComponentQuery.query("#colorpickerid")[0],s=r.ComponentQuery.query("#buttonPanel")[0],l=r.ComponentQuery.query("#clearColorButton")[0];null!=t&&t.destroy(),null!=n&&n.destroy(),null!=a&&a.destroy(),null!=o&&o.destroy(),null!=i&&i.destroy(),null!=s&&s.destroy(),null!=l&&l.destroy();for(var c=this.panel,d=c.plugins,p=0;p<d.length;p++)if(d[p].ptype&&"gantt_progressline"===d[p].ptype){d[p].disable();break}c.plugins=[];var g=this.getGanttPlugins();for(p=0;p<g.length;p++)c.addPlugin(g[p]);for(p=0;p<d.length;p++)switch(d[p].$className){case"Sch.plugin.NonWorkingTime":case"Sch.plugin.CurrentTimeLine":c.addPlugin(d[p])}},refreshGanttColumn:function(e){var t=App.Infra.Columns;e.lockedGrid.setColumns(t)},refreshToolbar:function(e){for(var t=r.ComponentQuery.query("#dpmgantttbar")[0],n=App.Infra.ReadOnly,a=t.items.items,o=0;o<a.length;o++){if(a[o].hasOwnProperty("disabled")&&a[o].setDisabled(n),a[o].hasOwnProperty("hidden"))switch(a[o].id){case"tBarGanttTaskCreation":a[o].setHidden(App.Infra.Views.VIEW_WBS!==App.Infra.ViewId||App.Infra.TypeOf.ProjectBaseline);break;case"tBarActionProgressLine":a[o].setHidden(App.Infra.Views.VIEW_WBS!==App.Infra.ViewId);break;case"View":a[o].setHidden(App.Infra.HideView);break;case"tBarActionCalculateForecastValues":case"tBarActionCalculateFloatAndCriticalPath":a[o].setHidden(App.Infra.TypeOf.ProjectTemplate||App.Infra.TypeOf.ProjectBaseline||App.Infra.TypeOf.Experiment);break;case"tBarActionPromoteSuccessor":a[o].setHidden("true"==App.Infra.projectDataElements.checkIfPromoteReadyTaskCommandVisible||!("TRUE"==App.Infra.projectDataElements.kindOfProjectSpace&&("Active"==App.Infra.projectDataElements.state||"Assign"==App.Infra.projectDataElements.state)&&"TRUE"==App.Infra.projectDataElements.modifyAccess));break;case"tBarActionSaveAll":case"tBarActionUndo":case"tBarActionRedo":case"tBarActionResetAll":case"tBarActionIndent":case"tBarActionOutdent":a[o].setHidden(n)}}},configureGanttLabelsData:function(e){var t=this.getGantt();if(t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var n="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,getFloatValues";t.setLoading(!1);c.ajaxRequest({url:n,type:"GET",dataType:"json",callback:function(e){alert(e)}})},changeAutoCompleteDisplaySettings:function(){this._searchBar.getElement("input");var e=this._searchBar.getElement(".chooser"),t=(this._searchBar._childrenViews[0].autoCompleteControl,T["emxProgramCentral.GanttView.SearchForProject"]);this._searchBar._childrenViews[0].autoCompleteControl.setOption("placeholder",t),this._searchBar._childrenViews[0].autoCompleteControl.setOption("position",{my:"left-1.5 top",at:"left bottom",of:e,collision:"fit",within:this.container})},hideGanttPanels:function(){var e=r.ComponentQuery.query("#dpmresourceutilizationpanel")[0];e&&e.hide();var t=r.ComponentQuery.query("#GanttRefinementPanel")[0];t&&t.hide();var n=r.ComponentQuery.query("#dpmprojectgantt")[0];n&&n.hide()},renderProjectSearch:function(){var e=r.ComponentQuery.query("#mainpanel")[0];if(e){this.searchPanel=r.ComponentQuery.query("#searchprojectpanel")[0],this.searchPanel||(this.model=new O,this._searchBar=new i({model:this.model,id:"projectSpaceSearch"}),this._searchBar.setConfig([{readWrite:"true",name:"project",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,searchTypes:G,validTypes:G,searchTitle:App.Nls["emxProgramCentral.GanttWidget.SearchTitle"],typeAheadCallback:l.typeAheadCallback,type:"object"}]),this.listenTo(this.model,"onChange:project",this._onProjectSelected),this.listenTo(widget,"onResize",(function(){this._searchBar._childrenViews[0].container.setStyle("width",.75*widget.body.clientWidth)})),p.get(E)?p.addClearProjectPreference():p.removeClearProjectPreference(),this._searchBar.render(),this._searchBar._childrenViews[0].container.setStyle("width",.75*widget.body.clientWidth),this._searchBar._childrenViews[0].container.toggleClassName("fluid-width",!0),this._searchBar._childrenViews[0].container.toggleClassName("visible",!0),this._searchBar._childrenViews[0].container.toggleClassName("ds-detail-display",!1),this.changeAutoCompleteDisplaySettings(),this.searchPanel=r.create("Ext.Panel",{xtype:"panel",id:"searchprojectpanel",width:"100%",region:"east",items:[r.get(this._searchBar.getContent())]}),e.add(this.searchPanel)),this.refreshPlaceHolderText(),this.hideGanttPanels(),this.searchPanel.show();var t=widget.data.collabspace,n=t.substring(t.lastIndexOf(".")+1);window.isIFWE&&widget.setTitle(n)}},refreshPlaceHolderText:function(){var e=this._searchBar.getElement("input[type=text]");e&&e.setAttribute("placeholder",T["emxProgramCentral.GanttView.SearchForProject"])},render:function(e){var t=this;if(window.isIFWE){var n=!0;if(p.get(E))if(e){var a="",r="";a=p.get(D)?p.get(D):p.get(E);var o=p.get(j),i=b.getUpdatedDataURL(a,o);(new I).fetch({idList:a,refresh:!0,include:i.include,customParams:i.customParams,onComplete:function(e){s(JSON.parse(JSON.stringify(e)))}});var s=function(e){e[0].Error?(n=!1,r=e[0].Error):e[0].physicalId&&e[0].physicalId!==p.get(E)&&(p.set(E,e[0].physicalId),p.get(D)&&p.set(D,!1),p.get(A)&&p.set(A,!1)),n?(enoviaServer.physicalId=p.get(E),t.renderProjectGantt()):(t.alerter.setOption("autoHide",!1),t.alerter.setOption("hideDelay",5e3),t.alerter.add({message:r,className:"error"}),t.alerter.show(),p.set(E,!1),t.renderProjectSearch())}}else enoviaServer.physicalId=p.get(E),t.renderProjectGantt();else p.removeClearProjectPreference(),this.renderProjectSearch()}else this.renderProjectGantt();return t},resize:function(){this.mainPanel.setWidth(r.getBody().getWidth()),this.mainPanel.setHeight(r.getBody().getHeight())},getTask:function(){var e=arguments[1];c.ajaxRequest({url:"/resources/v2/e6w/service/ObjectInfo/"+e.getId()+"?$fields=objectId",dataType:"json",callback:function(e){}})},getBbar:function(e){if(e.ToolbarRequired){var t=[];return t.push("->"),t.push({id:"bbarObjectCount",xtype:"displayfield",cls:"my-toolbar",label:"Objects",name:"Objects",value:0}),t.push({id:"bbarSelectObjectCount",xtype:"displayfield",cls:"my-toolbar",label:"Selected",hidden:!0,name:"Selected",value:0}),t}return[]},getTbar:function(e){if(e.ToolbarRequired){var t={crudManager:this.crudManager};new h(t);return{xtype:"dpmgantttbar"}}return[]},_onProjectSelected:function(e,t,n,a){var r=this;if(a=a||r.ganttViewAppsettings,n=n||a.get("collabspace"),r.searchPanel&&(r.searchPanel.setLoading({msg:T["emxProgramCentral.Gantt.Loading"]}),r._searchBar.hide()),enoviaServer.physicalId=t,window.isIFWE){var o=a.get("user");o&&o.login&&(o=o.login);var i=(new Date).getTimezoneOffset(),s=widget.getUrl(),l=a.get("myAppsUrl");s=s.substring(0,s.indexOf("/webapps"));var c=window.widget.lang;window.enoviaServer={params:"",sRealURL:s,showSpace:"true",objectId:"",widgetId:"",widgetName:"",taggerContextId:"auto",appName:"",tenant:"",space:null,rows:null,preferences:{},storageUrl:l,language:c,timezone:i,_getUrl:function(){return this.storageUrl||this.sRealURL},computeUrl:function(e){return a.get("3DSpace")+e},getParams:function(){var e="";return""!==(e+="&tenant="+enoviaServer.tenant)&&(e=e.substring(1)),enoviaServer.space&&enoviaServer.space.length>0&&(e+="&SecurityContext="+encodeURIComponent(enoviaServer.space)),e},getParamsAsJSON:function(){return{}},user:o},enoviaServer.securityContext=encodeURIComponent(n)}p.set(E,t),this.render(!1)},handleDrop:function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.container.removeClassName(V);var t=S.getDataTransferJSON(e.dataTransfer);return t&&this.processDropData(t),!1},handleDragEnd:function(){this.container.removeClassName(V)},handleDragOver:function(e){
//!this._blockerDiv.isInjected() && this._blockerDiv.inject(this.container, 'top');
return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",p.get(E)&&this.container.addClassName(V),!1},processDropData:function(e){var t=e.data.items[0],n=t.displayName;n&&n.length>0&&("Project Space"!==t.objectType&&"Project Baseline"!==t.objectType&&"Project Concept"!==t.objectType&&"Experiment"!==t.objectType?(this.alerter.add({message:NLS["emxProgramCentral.GanttView.NotProjectSpace"],className:"error"}),this.alerter.show()):this.parentApp.parentView.handleContextWithDroppedObj(e.data.items))}});return B}))}catch(e){console.log("==============================================Error:======"+e.Name)}