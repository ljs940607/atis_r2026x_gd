define("DS/ENOGantt/View/GanttConfiguration",["UWA/Class","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/ENOProjectMgmtCommonComponents/utils/ProjectMgmtCloneModel","DS/ENOGantt/URLStore"],(function(e,t,a,n,l){return e.extend({init:function(e){var a=UWA.clone(e||{},!1);this.parentView=a.parentView,this.parentView&&this.parentView.listenTo(this.parentView,"closeConfigurationPanel",this.closeConfigurationPanel);var r=t.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"Task",name:App.Nls["emxProgramCentral.Type.Task"]},{abbr:"Gate",name:App.Nls["emxProgramCentral.Type.Gate"]},{abbr:"Phase",name:App.Nls["emxProgramCentral.Type.Phase"]},{abbr:"Milestone",name:App.Nls["emxProgramCentral.Type.Milestone"]}]}),o=t.create("Ext.data.Store",{fields:["abbr","name"],data:function(){var e=new Array,t=App.Infra.Columns,a=t.length;for(idx=0;idx<a;idx++){var n=t[idx],l=n.header,r=n.name,o=n.hidden;n.xtype;if(n.columns)for(var i=0,s=n.columns.length;i<s;i++){var d=n.columns[i];o=d.hidden,!d.groupedHeader&&n.text==App.Nls.viewStore[0].name||"Actual"==n.text?d.groupedHeader=n.text+" "+d.header:d.groupedHeader||(d.groupedHeader=d.header),o||e.push({abbr:d.name,name:d.groupedHeader})}else o||"Dependency"==r||"Status"==r||e.push({abbr:r,name:l})}return e}()});t.define("DS.ENOGantt.View.GanttConfiguration",{extend:"Ext.form.Panel",renderTo:document.body,title:App.Nls["emxProgramCentral.GanttConfig.ConfigureBarLabels"],region:"east",xtype:"ganttConfigPanel",id:"ganttConfigPanel",scrollable:!0,width:310,hidden:!0,bodyPadding:10,defaultType:"textfield",defaults:{anchor:"100%",labelAlign:"top",font:"15px/18px Arial,Helvetica,sans-serif"},cls:"x-panel-header-default",layout:"anchor",items:[{xtype:"tagfield",fieldLabel:App.Nls["emxProgramCentral.GanttConfig.SelectType"],store:r,queryMode:"local",maxLength:4,displayField:"name",valueField:"abbr",name:"selecttype",id:"selecttype",filterPickList:!0},{xtype:"fieldset",title:App.Nls["emxProgramCentral.GanttConfig.SelectLabels"],defaultType:"textfield",defaults:{anchor:"100%"},items:[{xtype:"tagfield",fieldLabel:App.Nls["emxProgramCentral.GanttConfig.LeftLabel"],store:o,queryMode:"local",maxLength:2,displayField:"name",valueField:"abbr",name:"leftlb",id:"leftlb",filterPickList:!0},{xtype:"tagfield",fieldLabel:App.Nls["emxProgramCentral.GanttConfig.RightLabel"],store:o,queryMode:"local",maxLength:2,displayField:"name",valueField:"abbr",name:"rightlb",id:"rightlb",filterPickList:!0}]},{boxLabel:App.Nls["emxProgramCentral.GanttConfig.SetDefault"],xtype:"checkboxfield",name:"setDefault",value:"setDefault",checked:!0}],buttons:[{text:"OK",style:"border-color:#368EC4;background-color:#368EC4;color:#FFFFFF !important;font-size:14px",cls:"apply-button-text",handler:function(){var e=this.up("form"),a=e.getValues(),r=t.ComponentQuery.query("#dpmprojectgantt")[0];if(r.setLoading(!1),null==a.setDefault&&""==a.selecttype&&""==a.rightlb&&""==a.leftlb||null==a.setDefault&&""==a.selecttype)t.Msg.alert(App.Nls["emxProgramCentral.GanttConfig.FormErrorMsg"]);else if(e.isValid()){var o={};if(null!=a.setDefault)o.Taskrb="Name",o.Gaterb="Name",o.Milestonerb="Name",o.Phaserb="Name",o.Tasklb="",o.Gatelb="",o.Milestonelb="",o.Phaselb="";else{var i=a.selecttype,s=a.rightlb;s=s.length>1?s[0].concat("#").concat(s[1]):s.toString();var d=a.leftlb;d=d.length>1?d[0].concat("#").concat(d[1]):d.toString(),i.indexOf("Task")>=0&&(o.Tasklb=d,o.Taskrb=s),i.indexOf("Gate")>=0&&(o.Gatelb=d,o.Gaterb=s),i.indexOf("Milestone")>=0&&(o.Milestonelb=d,o.Milestonerb=s),i.indexOf("Phase")>=0&&(o.Phaselb=d,o.Phaserb=s)}let e=App.Infra.contextInfo;e.set({ganttConfig:JSON.stringify(o)});let g=l.getGanttConfigURL();r.setLoading(!1);let p=new n(e),f=r.crudManager.viewCollection;window.Widget||(donotShowMessage=!0),f.processSaveDataModel(p,{fields:g.fields,include:g.include,donotShowMessage:donotShowMessage,isNew:!1,customParams:g.customParams,onComplete:function(e){!function(e){var a=(l=t.ComponentQuery.query("#dpmprojectgantt")[0]).crudManager;App.Infra.loadProjectSelectable||(App.Infra.loadProjectSelectable=!0);var n=l.getTaskStore();""==n.data.items[0].data.ganttConfig?n.data.items[0].data.ganttConfig=e.ganttConfig:n.data.items[0].set("ganttConfig",e.ganttConfig),a.commit(),t.ComponentQuery.query("#ganttConfigPanel")[0].hide();for(var l,r=(l=t.ComponentQuery.query("#dpmprojectgantt")[0]).getPlugins(),o=0,i=r.length;o<i;o++)if(pluginId=r[o].id,"RMBMenu"===pluginId){r[o].enable();break}}(JSON.parse(JSON.stringify(e)))}})}else alert(App.Nls["emxProgramCentral.GanttConfig.ErrorMsg"])}},{id:"btnCloseOpenForm",text:App.Nls["emxProgramCentral.Gantt.DependencyEditor.Cancel"],handler:this.closeConfigurationPanel}]})},closeConfigurationPanel:function(){t.ComponentQuery.query("#ganttConfigPanel")[0].hide();var e=t.ComponentQuery.query("#dpmprojectgantt")[0];e.normalGrid.collapsed&&e.lockedGrid.setWidth("100%");for(var a=e.getPlugins(),n=0,l=a.length;n<l;n++)if(pluginId=a[n].id,"RMBMenu"===pluginId){a[n].enable();break}}})}));