define("DS/ENOGantt/View/TaskCreationPanel",["UWA/Class","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/GanttUtil","DS/ENOGantt/GanttConstants"],(function(e,t,a,n,r){return e.extend({init:function(e){var a=UWA.clone(e||{},!1);this.parentView=a.parentView,this.parentView&&this.parentView.listenTo(this.parentView,"closeCreationPanel",this.closeTaskCreationPanel);var i=t.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"Optional",name:App.Nls["emxProgramCentral.Range.Task_Requirement.Optional"]},{abbr:"Mandatory",name:App.Nls["emxProgramCentral.Range.Task_Requirement.Mandatory"]}]}),l=t.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"Yes",name:App.Nls["emxProgramCentral.Range.NeedsReview.Yes"]},{abbr:"No",name:App.Nls["emxProgramCentral.Range.NeedsReview.No"]}]});let s=[App.Nls.durationUnits.day,App.Nls.durationUnits.days,App.Nls.durationUnits.hour,App.Nls.durationUnits.hours,App.Nls.durationUnits.week,App.Nls.durationUnits.weeks,App.Nls.durationUnits.month,App.Nls.durationUnits.months];t.define("DS.ENOGantt.View.TaskCreationPanel",{extend:"Ext.form.Panel",renderTo:document.body,title:App.Nls["emxProgramCentral.Common.AddTask"],region:"east",xtype:"ganttTaskCreationPanel",id:"ganttTaskCreationPanel",width:330,hidden:!0,bodyPadding:10,scrollable:!0,defaultType:"textfield",defaults:{anchor:"100%",labelAlign:"top",font:"15px/18px Arial,Helvetica,sans-serif"},cls:"x-panel-header-default",layout:"anchor",items:[{xtype:"fieldcontainer",id:"requiredFields",fieldLabel:App.Nls["ProgramCentral.GanttTaskCreation.FieldsRequired"],labelCls:"createRequired"},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.Type"],queryMode:"local",displayField:"name",valueField:"abbr",name:"type",id:"type",editable:!1,listeners:{change:function(e,a){var r=t.ComponentQuery.query("#ganttTaskCreationPanel")[0];null==a&&(a="Task");var i=a;"Task"==a?i=App.Nls["emxProgramCentral.Type.Task"]:"Phase"==a?i=App.Nls["emxProgramCentral.Type.Phase"]:"Gate"==a?i=App.Nls["emxProgramCentral.Type.Gate"]:"Milestone"==a&&(i=App.Nls["emxProgramCentral.Type.Milestone"]),r.setTitle(App.Nls["emxProgramCentral.Gantt.Create"]+" : "+i);var l=t.create("Ext.data.Store",{fields:["abbr","name"],data:function(){var e=new Array,t=App.Infra.PoliciesAndTypes[a].split("#")[0],n=t.substring(1,t.length-1).split(","),r=App.Infra.PoliciesAndTypes[a].split("#")[1],i=r.substring(1,r.length-1).split(", "),l=n.length;for(idx=0;idx<l;idx++){var s=n[idx].trim(),o=i[idx].trim();null==o&&(o=s),e.push({abbr:s,name:o})}return e}()});t.getCmp("policy").bindStore(l),n.getGanttItem(r,"policy").setValue(l.data.items[0]);var s=n.getGanttItem(r,"duration");"Gate"==a||"Milestone"==a?(s.durationUnit="d",s.setValue(0),s.setReadOnly(!0)):(s.durationUnit="d",s.setValue(1),s.setReadOnly(!1))}}},{xtype:"numberfield",fieldLabel:App.Nls["emxProgramCentral.Common.Number"],minValue:1,name:"number",id:"number",value:1,validator:function(e){var t=!0;return this.value<=0||this.value>100?(t=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber"],this.setError(t),t):(Number.isInteger(this.value)||(t=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber.MustBePositiveInteger"],this.setError(t)),t)},listeners:{change:function(e,a){var r=t.ComponentQuery.query("#ganttTaskCreationPanel")[0],i=n.getGanttItem(r,"namecontainer");a>1?(i.items.items[1].setValue(!0),i.items.items[1].setDisabled(!0),i.items.items[0].setDisabled(!0)):(i.items.items[1].setValue(!1),i.items.items[1].setDisabled(!1),i.items.items[0].setDisabled(!1))},focusleave:function(e,t,a){var n=this.getValue();if(isNaN(n)||!Number.isInteger(this.value)){var r=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber.MustBePositiveInteger"];alert(r),this.setValue(1)}else if(n<=0||n>100){r=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber"];alert(r),this.setValue(1)}}}},{xtype:"fieldcontainer",fieldLabel:App.Nls["emxProgramCentral.Gantt.ResourceUtilization.Header.Name"],id:"namecontainer",name:"Name",labelCls:"createName",layout:{type:"hbox"},items:[{xtype:"textfield",name:"name",id:"name",validator:function(e){var t=!0;if(0==this.nextSibling("[name=autoname]").value&&""==this.value)return t=App.Nls["emxProgramCentral.Gantt.MustHaveName"],this.setError(t),t;if(App.Infra.PoliciesAndTypes)for(var a=App.Infra.PoliciesAndTypes.InvalidChars,n=a.split(" "),r=0;r<n.length;r++){var i=n[r];if(-1!=e.indexOf(i)){t=App.Nls["emxProgramCentral.ProjectImport.InvalidCharacterInTaskName"]+"\n"+a;break}}return t}},{xtype:"checkbox",fieldLabel:App.Nls["emxProgramCentral.Common.AutoName"],labelAlign:"right",name:"autoname",id:"autoname",value:!1,listeners:{change:function(e,a,r,i){var l=t.ComponentQuery.query("#ganttTaskCreationPanel")[0],s=n.getGanttItem(l,"namecontainer");1==a?(s.items.items[0].reset(),s.items.items[0].setDisabled(!0)):s.items.items[0].setDisabled(!1)}}}]},{xtype:"textareafield",fieldLabel:App.Nls["emxProgramCentral.Common.Description"],name:"description",id:"description"},{xtype:"radiogroup",fieldLabel:App.Nls["emxProgramCentral.Button.Insert"],id:"insertradio",columns:1,vertical:!0,items:[{boxLabel:App.Nls["emxProgramCentral.Gantt.Above"],name:"insert",id:"above",inputValue:"above",checked:!0},{boxLabel:App.Nls["emxProgramCentral.Gantt.SubLevel"],name:"insert",id:"sublevel",inputValue:"sublevel"}]},{xtype:"durationfield",fieldLabel:App.Nls["emxProgramCentral.Common.Duration"],minValue:0,maxValue:79999,name:"duration",durationUnit:"d",id:"duration",value:1,listeners:{focusleave:function(e,t,a){var n=this.rawValue.split(" "),r=n[0],i=n[1];if(isNaN(r)){var l=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];return alert(l),void this.setValue(1)}if(s.indexOf(i)<0)return p=(p=App.Nls["emxProgramCentral.Common.InvalidDuration"]).replace(/\\n/g,"\n"),alert(p),void this.setValue(1);var o=this.up("form").getValues();if(App.Infra.PoliciesAndTypes&&(App.Infra.PoliciesAndTypes.gateMilestoneTypes.indexOf(o.type)>=0&&"0"!=n[0]&&this.setValue(0),App.Infra.PoliciesAndTypes.gateMilestoneTypes.indexOf(o.type)<0))if("0"==r||"0.0"==r){var p=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];alert(p),this.setValue(1)}else if(r<=0||r>=8e4&&i===App.Nls.durationUnits.hours||r>=1e4&&i===App.Nls.durationUnits.days||r>=2e3&&i===App.Nls.durationUnits.weeks||r>=500&&i===App.Nls.durationUnits.months){var m=App.Nls["emxProgramCentral.Gantt.Task.Duration.Limit"];alert(m),this.setValue(1)}}}},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.Policy"],queryMode:"local",displayField:"name",valueField:"abbr",name:"policy",id:"policy",editable:!1},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.TaskRequirement"],store:i,queryMode:"local",displayField:"name",valueField:"abbr",name:"taskRequirement",id:"taskRequirement",value:"Optional",editable:!1},{xtype:"constrainttypefield",fieldLabel:App.Nls["emxProgramCentral.WBS.ConstraintType"],name:"constrainttype",id:"constrainttype",editable:!1,value:"assoonaspossible",hidden:App.Infra.TypeOf.ProjectTemplate,validator:function(e){var t=this.nextSibling("[name=constraintdate]");return"assoonaspossible"==this.getValue()||"aslateaspossible"==this.getValue()||""!=t.getValue()&&null!=t.getValue()||App.Nls["emxProgramCentral.Gantt.selectConstraintDate"]}},{xtype:"constraintdatefield",fieldLabel:App.Nls["emxProgramCentral.WBS.ConstraintDate"],name:"constraintdate",id:"constraintdate",format:n.getDateFormat(),hidden:App.Infra.TypeOf.ProjectTemplate,listeners:{change:function(){var e=t.ComponentQuery.query("#ganttTaskCreationPanel")[0],a=n.getGanttItem(e,"constrainttype");if(""!=this.getValue()||null!=this.getValue()){let e=a.getValue();a.reset(),a.setValue(e)}}}},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Task.NeedsReview"],store:l,queryMode:"local",displayField:"name",valueField:"abbr",name:"needsReview",id:"needsReview",value:"No",editable:!1},{xtype:"radiogroup",fieldLabel:App.Nls["emxProgramCentral.Task.DeliverablesInheritance"],id:"deliverablesInheritance",columns:1,vertical:!0,items:[{boxLabel:App.Nls["emxProgramCentral.Range.NeedsReview.Yes"],name:"deliverablesInheritance",inputValue:"Yes",checked:!0},{boxLabel:App.Nls["emxProgramCentral.Range.NeedsReview.No"],name:"deliverablesInheritance",inputValue:"No"}]}],buttons:[{text:"OK",style:"border-color:#368EC4;background-color:#368EC4;color:#FFFFFF !important;font-size:14px;border-radius: 5px;border-width:1px;border-style:solid;box-shadow: inset 0px 2px 0px rgba(255,255,255,.3), inset 0px 0px 8px rgba(255,255,255,.5);",cls:"apply-button-text",handler:function(){var e=t.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,a=this.up("form"),i=a.getValues(),l=i.type,s=r.actionType.ADD_SUB_TASK;"Phase"===l?s=r.actionType.ADD_PHASE:"Gate"===l?s=r.actionType.ADD_GATE:"Milestone"===l&&(s=r.actionType.ADD_MILESTONE);var o=App.Nls["emxProgramCentral.Common.InvalidDuration"];if(o=o.replace(/\\n/g,"\n"),a.hasInvalidField()){for(var p=[],m=a.items.items,d=0,u=m.length;d<u;d++){if(fieldId=m[d].id,"namecontainer"===fieldId)for(var g=m[d].items.items,c=0,b=g.length;c<b;c++){var f=g[c].getErrors();break}else{if("requiredFields"==m[d].id)continue;f=m[d].getErrors();if("duration"===fieldId&&f.length>0)for(var x=0,C=f.length;x<C;x++)if(f[x].error!=o){f.splice(x,1);break}}f.length>0&&p.push(m[d].fieldLabel)}var y=App.Nls["emxProgramCentral.GanttTaskCreation.InvalidFormErrorMsg"];return alert(y+" : \n"+p),!1}if(n.isValidRMBOperation(e[0],s)&&!a.hasInvalidField()){cpnl.syncOnAddRemoveTask(this,s,i);var A=t.ComponentQuery.query("#ganttTaskCreationPanel")[0];A.hide(),A.reset(),t.getCmp("tBarganttConfiguration").enable()}}},{id:"Apply",text:App.Nls["emxProgramCentral.Gantt.Apply"],handler:function(){var e=t.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,a=this.up("form"),i=a.getValues(),l=i.type,s=r.actionType.ADD_SUB_TASK;"Phase"===l?s=r.actionType.ADD_PHASE:"Gate"===l?s=r.actionType.ADD_GATE:"Milestone"===l&&(s=r.actionType.ADD_MILESTONE);var o=App.Nls["emxProgramCentral.Common.InvalidDuration"];if(o=o.replace(/\\n/g,"\n"),a.hasInvalidField()){for(var p=[],m=a.items.items,d=0,u=m.length;d<u;d++){if(fieldId=m[d].id,"namecontainer"===fieldId)for(var g=m[d].items.items,c=0,b=g.length;c<b;c++){var f=g[c].getErrors();break}else{if("requiredFields"==m[d].id)continue;f=m[d].getErrors();if("duration"===fieldId&&f.length>0)for(var x=0,C=f.length;x<C;x++)if(f[x].error!=o){f.splice(x,1);break}}f.length>0&&p.push(m[d].fieldLabel)}var y=App.Nls["emxProgramCentral.GanttTaskCreation.InvalidFormErrorMsg"];return alert(y+" : \n"+p),!1}n.isValidRMBOperation(e[0],s)&&!a.hasInvalidField()&&cpnl.syncOnAddRemoveTask(this,s,i);t.ComponentQuery.query("#ganttTaskCreationPanel")[0]}},{id:"Close",text:App.Nls["emxProgramCentral.Gantt.DependencyEditor.Cancel"],handler:this.closeTaskCreationPanel}]})},closeTaskCreationPanel:function(){var e=t.ComponentQuery.query("#ganttTaskCreationPanel")[0],a=t.ComponentQuery.query("#dpmprojectgantt")[0];a.normalGrid.collapsed&&a.lockedGrid.setWidth("100%"),e.hide(),e.reset();var n=t.getCmp("tBarganttConfiguration");n&&n.enable()}})}));