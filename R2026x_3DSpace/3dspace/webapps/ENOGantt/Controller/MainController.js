define("DS/ENOGantt/Controller/MainController",["DS/ENOGantt/Ven/Ext","DS/ENOGantt/Controller/Finder","DS/ENOGantt/GanttUtil","DS/ENOGantt/GanttConstants","DS/Foundation2/FoundationV2Data","DS/ENOGantt/URLStore","DS/ENOProjectMgmtCommonComponents/utils/ProjectMgmtCloneModel","DS/ENOProjectMgmtCommonComponents/utils/CommonUtils","DS/ENOProjectMgmtModels/Models/AppSettings","DS/ENOProjectMgmtModels/Models/FieldsDefinition"],(function(e,t,a,n,r,o,i,l,s,c){"use strict";e.define("DS/ENOGantt/Controller/MainController",{extend:"Ext.app.ViewController",alias:"controller.GanttViewController",control:{"#dpmprojectgantt":{beforetaskresize:"beforetaskresize",beforetaskdrag:"beforetaskdrag",aftertaskresize:"aftertaskresize",taskdrop:"taskdrop",dependencybeforedrag:"dependencybeforedrag",dependencydrop:"dependencydrop",beforedrop:"beforedrop",drop:"drop",selectionchange:"selectionchange",beforeprogressbarresize:"beforeprogressbarresize",afterprogressbarresize:"afterprogressbarresize"},"[reference=ganttTaskCreation]":{click:"showTaskCreationForm"},"[reference=zoomToFit]":{click:"onzoomToFit"},"[reference=undo]":{click:"onUndo"},"[reference=redo]":{click:"onRedo"},"[reference=zoomOut]":{click:"onZoomOut"},"[reference=zoomIn]":{click:"onZoomIn"},"[reference=expandAll]":{click:"onExpandAll"},"#ganttTaskCreation":{click:"showTaskCreationForm"},"#rmbExpandAll":{click:"onExpandAll"},"#expandLevel_1":{click:"onExpandNLevelHandler"},"#expandLevel_2":{click:"onExpandNLevelHandler"},"#expandLevel_3":{click:"onExpandNLevelHandler"},"#expandLevel_4":{click:"onExpandNLevelHandler"},"#expandLevel_5":{click:"onExpandNLevelHandler"},"#expandLevel_all":{click:"onExpandAll"},"[reference=highlightCrit]":{click:"onHighlightCrit"},"[reference=print]":{click:"onPrint"},"[reference=collapseGanttChart]":{click:"onCollapseGanttChart"},"[reference=SaveAll]":{click:"onSave"},"[reference=resetAll]":{click:"onReset"},"[reference=viewDropDown]":{click:"toggleView"},"[reference=showRollUpTask]":{click:"toggleRollUpTaskView"},"[reference=showHidePercentComplete]":{click:"onShowHidePercentComplete"},"[reference=refinement]":{click:"showRefinement"},"[reference=ganttConfiguration]":{click:"showForm"},"[reference=calculateFloatData]":{click:"calculateFloatData"},"[reference=calculateForecastValues]":{click:"calculateForecastValues"},"[reference=promoteSuccessor]":{click:"promoteSuccessor"},"[reference=outdentTask]":{click:"onOutdent"},"[reference=indentTask]":{click:"onIndent"},"[reference=openInCollabTask]":{click:"openTaskinCollabTask"},"[reference=openTask]":{click:"openTask"},"[reference=remove]":{click:"onRemove"},"#RMB_expandLevel_1":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_2":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_3":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_4":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_5":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_all":{click:"onExpandAll"},"#rmbOpenTaskAction":{click:"openTask"},"#outdentTask":{click:"onOutdent"},"#indentTask":{click:"onIndent"},"#rmbOpenCollabTaskAction":{click:"openTaskinCollabTask"},"[reference=find]":{change:"find"},"[reference=filterByName]":{keyup:"filterByName",specialkey:"filterByName"},"[reference=filter]":{click:"filter"},"[reference=resetFilter]":{click:"resetFilter"},"[reference=hide]":{click:"hide"},"[reference=saveColumnConfiguration]":{click:"saveColumnConfiguration"},"[reference=resetToDefaultColumnConfiguration]":{click:"resetToDefaultColumnConfiguration"}},getGantt:function(){return this.getView()},beforetaskdrag:function(e,t){return"Gnt.model.Project"!==t.get("TaskType")&&(!1!==a.doBasicEditChecks(t)&&(t.isStartDateEditable()&&t.isEndDateEditable()))},beforetaskresize:function(e,t,n,r){return!1!==a.doBasicEditChecks(t)&&a.isValidTaskResize(t,n,r)},beforedrop:function(t,a,n){var r=e.ComponentQuery.query("#dpmprojectgantt")[0].crudManager;if(r.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;r.reject()}if(!0===App.Infra.BaselineRequired)return!1;if("TRUE"!==a.records[0].data.hasEditAccess)return e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.NoAccessToDragDrop"]),!1;var o=a.records[0].get("TaskProjectId"),i=n.get("TaskProjectId"),l=n.parentNode.get("EnglishType");if(void 0===o){var s=a.records[0].parentNode.get("EnglishType");o="Task"===s||"Phase"===s||"Gate"===s||"Milestone"===s?a.records[0].parentNode.get("TaskProjectId"):a.records[0].get("parentId")}if(null==i&&"ProjectSpace"!=l&&"ProjectConcept"!=l&&"Experiment"!=l){i=n.get("parentId");var c=n.parentNode.get("EnglishType");i="Task"==c||"Phase"==c||"Gate"==c||"Milestone"==c?n.parentNode.get("TaskProjectId"):n.get("parentId")}return a.records.length>1?(e.MessageBox.alert(App.Nls["emxFramework.Common.PleaseSelectOneItemOnly"]),!1):100===a.records[0].get("PercentDone")?(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.TaskInReviewState"]),!1):100===n.parentNode.get("PercentDone")?(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.ParentTaskInReviewCompleteState"]),!1):i===o&&(void 0!==i||void 0!==o)||(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.CrossProjectDragdrop"]),!1)},drop:function(t,n,r,o,i){var l=e.ComponentQuery.query("#dpmprojectgantt")[0],s=l.crudManager,c=l.getTaskStore();a.getStoreTaskExpandStatus(c);var d=!1,p=s.getChangeSetPackage();if(p.tasks){var g=p.tasks;if(g.updated)for(var m=g.updated,f=0,u=m.length;f<u;f++){var C=m[f];if(C.parentId){var h=c.getModelById(C.parentId).get("PercentDone");if("FALSE"===c.getModelById(C.parentId).data.hasEditAccess){d=!0,e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.NoAccessToDragDrop"]);break}if(100===h){d=!0,e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.ParentTaskInReviewCompleteState"]);break}}}}if(d)s.load();else{let e=n&&n.records&&n.records.length&&n.records[0].id,t=e&&s.viewCollection.modelCache[e],a=r&&r.id,i=a&&s.viewCollection.modelCache[a];if(o&&"before"===o)i.getParent().insertBefore(t,i);else if(i.getNextBrother()){let e=i.getNextBrother();e.getParent().insertBefore(t,e)}else i.getParent().addChild(t);s.transport.sync.params.DragDrop=!0,l.getCrudManager().sync(),l.getCrudManager().commit()}},aftertaskresize:function(e,t,a){var n=t.data,r=n.Policy,o=n.Duration;if("Project Review"!=r&&null!=o&&0==o){var i=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];return alert(i),void t.reject()}},taskdrop:function(t,a,n){var r=a.data,o=(r.Policy,r.StartDate),i=r.EndDate,l=(r.Duration,r.DurationUnit);if(null==i&&null!=o){var s=r.Duration;l=r.DurationUnit;i=e.Date.add(o,l,s)}1==t.getTaskStore().data.items[0].data.ScheduleBackwards?a.setConstraint("finishnolaterthan",i):a.setConstraint("startnoearlierthan",o)},dependencybeforedrag:function(e,t,n){return!!a.hasAccessOnTaskForRestrictAssignee(t)&&a.doBasicEditChecks(t)},dependencydrop:function(t,a,n,r){var o=e.ComponentQuery.query("#dpmprojectgantt")[0].taskStore,i=a.getSourceId(),l=o.getModelById(i);if(null!=l){var s=l.get("Name"),c=l.get("TaskSequenceId"),d=l.get("TaskProjectId");c&&(c=parseInt(c)),a.data.predTaskSeqNumber=c,a.data.predecessorTaskName=s,a.data.predProjectId=d}var p=a.getTargetId(),g=o.getModelById(p);if(null!=g){var m=g.get("Name"),f=g.get("TaskSequenceId"),u=g.get("taskWBS");f&&(f=parseInt(f)),a.data.taskSeqNumber=f,a.data.successorTaskName=m,a.data.taskWBS=u}if(!n)return!1},selectionchange:function(t,n,r){var o=n.length,i=e.getCmp("bbarSelectObjectCount");if(i&&o>0){i.setHidden(!1);var l=App.Nls["emxProgramCentral.Common.Selected"];i.setValue(o+" "+l);let e=this.view.parentView;e&&e.dispatchEvent("onSelectionChange")}else i.setHidden(!0);if(o>0)for(var s=e.ComponentQuery.query("#dpmgantttbar")[0].items.items,c=0;c<s.length;c++){if(s[c].hasOwnProperty("hidden"))switch(s[c].id){case"tBarGanttTaskCreation":s[c].setHidden(!(a.isValidAddTaskAbove(n[0])||a.isValidAddSubTask(n[0])));break;case"tBarActionExpandAll":case"tBarActionExpandNLevels":s[c].setHidden(!a.isTaskAllExpanded(n[0]));break;case"tBarOpenCollabTaskAction":s[c].setHidden(!a.isValidForCollabTask(n[0]));break;case"tBarOpenTaskAction":s[c].setHidden(!a.isValidForOpenInNewTab(n[0]));break;case"tBarActionOutdent":case"tBarActionIndent":s[c].setHidden(!a.isValidForColor(n[0]));break;case"tBarDeleteTask":s[c].setHidden(!a.isValidDeleteTask(n[0]));break;case"tBarRemove":s[c].setHidden(!a.isValidRemoveSubProject(n[0]))}}},beforeprogressbarresize:(t,n,r)=>!App.Infra.TypeOf.ProjectTemplate&&(0!=a.doBasicEditChecks(n)&&("Project Space Hold Cancel"!=e.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0].data.Policy&&1!=App.Infra.TypeOf.Experiment)),afterprogressbarresize:function(e,t,a){100===t.data.PercentDone&&t.setReadOnly(!0)},onzoomToFit:function(){var e=this.getGantt(),t=e.timeAxis.mainUnit;e.timeAxis.mainUnit="w",e.zoomToFit(),e.timeAxis.mainUnit=t},onUndo:function(){var t=this.getGantt();if(t.undoManager.undo(),0===t.undoManager.getUndoQueue().length){var a=e.getCmp("tBarActionRedo");a.isDisabled()&&(a.enable(),a.setTooltip(App.Nls["emxProgramCentral.Gantt.Redo"]))}},onRedo:function(){this.getGantt().undoManager.redo()},onZoomOut:function(){var e=this.getGantt();e.zoomKeepsOriginalTimespan=!1,e.zoomOut(),e.zoomKeepsOriginalTimespan=!0},onZoomIn:function(){var e=this.getGantt(),t=e.getTaskStore().data.items[0].getDuration();e.maxZoomLevel=t>=10?16:25,e.getCurrentZoomLevelIndex()==e.maxZoomLevel&&alert(App.Nls["emxProgramCentral.Gantt.maxZoomLevel"]),e.zoomIn()},onExpandAll:function(e,t){var n,r=this.getGantt();new UWA.Promise((function(t,o){if(e.scope)n=e.scope.rec;else if(r.getSelectionModel().selected.items.length)n=r.getSelectionModel().selected.items[0];else{let e=r.getTaskStore().getRootNode().childNodes[0];r.getSelectionModel().select(e),n=e}a.isReadyToExpand(n,t,0)})).then((function(t){r.setLoading(!1),r.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]),setTimeout((function(){if(console.time("expand"),App.Gantt.toolbar||(App.Gantt.toolbar={expandAll:{expanded:!1}}),App.Gantt.toolbar.expandAll.expanded=!0,n)if(1===n.data.depth)r.expandAll();else{var t=r.lockedGrid.getSelectionModel().selected.items;t&&t.forEach((e=>{e.expand(!0)}))}else r.expandAll();r.setLoading(!1),App.Gantt.toolbar.expandAll.expanded=!1,console.timeEnd("expand"),e.scope&&e.scope.done&&e.scope.done()}),50)}))},onExpandNLevelHandler:function(e){var t,n=this.getGantt();new UWA.Promise((function(r,o){var i=0;if(e.scope)t=e.scope.rec,0!=e.level&&(i=t.data.depth-1+e.level);else{var l=n.getSelectionModel(),s=l&&l.selected&&l.selected.items;if(s.length&&0!=e.level){let a=1;s&&s.forEach((e=>{e.data.depth>a&&(a=e.data.depth,t=e)})),i=a-1+e.level}else{let e=n.getTaskStore().getRootNode().childNodes[0];l.select(e),t=e}}a.isReadyToExpand(t,r,i)})).then((function(t){n.setLoading(!1),n.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]),setTimeout((function(){console.time("expand"),App.Gantt.toolbar?App.Gantt.toolbar.expandAll.expanded=!0:App.Gantt.toolbar={expandAll:{expanded:!0}};var t=n.lockedGrid.getSelectionModel(),r=t&&t.selected&&t.selected.items;r&&r.length?r&&r.forEach((t=>{a.selectiveExpandFromRMB(t,e.level)})):a.selectiveExpand(n,e.level),n.setLoading(!1),App.Gantt.toolbar.expandAll.expanded=!1,console.timeEnd("expand"),e.done&&e.done()}),100)}))},onHighlightCrit:function(t){var a=this.getGantt(),n=a.getSchedulingView();if(t.pressed||t.checked){for(var r,o=(f=e.getCmp("bbarObjectCount")).getValue(),i=App.Infra.Columns,l=!1,s=0,c=i.length;s<c;s++){var d=i[s].columns;if(null!=d){for(var p=0,g=d.length;p<g;p++){if("TotalFloat"==d[p].dataIndex){r=App.Infra.Columns[s].text,l=!0;break}}if(1==l)break}}var m=r.split("(");let t=App.Nls["emxProgramCentral.Gantt.CriticalPath"]+"("+m[1];f.setValue(t+" "+o),a.setLoading(App.Nls["emxProgramCentral.Gantt.ComputingCriticalPath"]||"Computing Critical Path"),setTimeout((function(){n.highlightCriticalPaths(!0),a.setLoading(!1)}),50)}else{var f=e.getCmp("bbarObjectCount");n.unhighlightCriticalPaths(!0);var u=App.Nls["emxProgramCentral.Common.Objects"];f.setValue(a.getStore().getRange().length+" "+u)}},onPrint:function(){this.getGantt().print()},onCollapseGanttChart:function(e){if(1==e.hidden)return;var t=this.getGantt();let r=t.parentView;r&&r.dispatchEvent("closePropertyPanel");var o=e.icon,i=enoviaServer.computeUrl("/common/images/"),l=i+"I_HideChart_32.png",s=i+"I_ShowChart_32.png";t.lockedGrid.getWidth()>n.gantt.lockedGrid.width&&o.contains(s)||o.contains("iconActionImportDesignSyncModule.png")?(t.normalGrid.setCollapsed(!1),t.lockedGrid.setWidth(n.gantt.lockedGrid.width),a.enableButtons(n.toolbarBtnListToEnableDisable),e.setIcon(l),e.overflowText=App.Nls["emxProgramCentral.Gantt.Toolbar.CollapseChart"],e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.CollapseChart"]),e.fireEvent("iconchange",e,s,l)):(t.lockedGrid.setWidth(t.ownerGrid.getWidth()+t.normalGrid.getWidth()),t.normalGrid.collapse(!0),a.disableButtons(n.toolbarBtnListToEnableDisable),e.setIcon(s),e.overflowText=App.Nls["emxProgramCentral.Gantt.Toolbar.ExpandChart"],e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.ExpandChart"]),e.fireEvent("iconchange",e,l,s))},onSave:function(){var t=this.getGantt();if(t.getCrudManager().sync(),!0===e.getCmp("tBarActionZoomToFit").pressed){var a=t.timeAxis.mainUnit;t.timeAxis.mainUnit="w",t.zoomToFit(),t.timeAxis.mainUnit=a}this.filter()},onReset:function(){var t=this.getGantt();App.Infra.OnReset=!0,t.getCrudManager().reject(),e.ComponentQuery.query("#dpmresourceutilizationpanel")[0].getStore().rejectChanges()},togglePlanView:function(t){if(1!=t.hidden){var a=t.pressed;void 0===a&&(a=t.checked);var n=this.getView(),r=enoviaServer.computeUrl("/common/images/"),o=r+"I_HidePlanActual32.png",i=r+"I_ShowPlanActual32.png";if(App.Infra.BaselineRequired=a,App.Infra.ViewId!==App.Infra.Views.VIEW_STATUS_REPORT){var l=n.taskStore.getRoot().childNodes[0].get("scheduleBasedOn"),s=n.getColumns();for(let e=0,t=s.length;e<t;e++)"BaselineDuration"!==s[e].name&&"BaselineStartDate"!==s[e].name&&"BaselineEndDate"!==s[e].name||s[e].setVisible(a),"TotalFloat"!==s[e].name&&"FreeFloat"!==s[e].name||s[e].setVisible(!a),"ExpectedEndDate"===s[e].name&&"Forecast"===l&&s[e].setVisible(a)}if(n.baselineVisible=App.Infra.BaselineRequired,n.setReadOnly(a),n.getView().refresh(),a){if(n.showBaseline(),App.Infra.ReadOnly=a,enoviaServer.viewId=App.Nls.viewStore[2].viewId,t.setTooltip(App.Nls.viewStore[0].name),t.setIcon(o),null===n.getTaskStore().data.items[0].data.BaselineStartDate&&!1===App.Infra.isCustomizedEnvironment&&alert(App.Nls["emxProgramCentral.Gantt.AlertForForecastCalculation"]),0==App.Infra.isCustomizedEnvironment){for(var c,d=(A=e.getCmp("bbarObjectCount")).getValue(),p=App.Infra.Columns,g=!1,m=0,f=p.length;m<f;m++){var u=p[m].columns;if(void 0!==u){for(var C=0,h=u.length;C<h;C++){if("BaselineDuration"===u[C].dataIndex){c=App.Infra.Columns[m].text,g=!0;break}}if(!0===g)break}}var v=c.split("(");let t=App.Nls["emxProgramCentral.Gantt.Forecast"]+"("+v[1];A.setValue(t+" "+d)}e.getCmp("tBarActionCalculateFloatAndCriticalPath").setHidden(!0),e.getCmp("tBarActionRollUpTask").setHidden(!0),e.getCmp("tBarGanttTaskCreation").setHidden(!0)}else{if(n.hideBaseline(),App.Infra.ReadOnly=a,enoviaServer.viewId=App.Nls.viewStore[0].viewId,t.setTooltip(App.Nls.viewStore[2].name),t.setIcon(i),0==App.Infra.isCustomizedEnvironment){var A=e.getCmp("bbarObjectCount"),k=App.Nls["emxProgramCentral.Common.Objects"];A.setValue(n.getStore().getRange().length+" "+k)}e.getCmp("tBarActionCalculateFloatAndCriticalPath").setHidden(!1),e.getCmp("tBarActionRollUpTask").setHidden(!1),e.getCmp("tBarGanttTaskCreation").setHidden(!1)}var T=e.ComponentQuery.query("panel#GanttRefinementPanel")[0];T&&T.isVisible()&&(T.hide(),this.showRefinement())}},toggleView:function(t){var n=this;0!=App.Infra.Load.Level?(App.Infra.ViewId==App.Infra.Views.VIEW_STATUS_REPORT&&(App.Infra.LoadStatusActualData=!0),new UWA.Promise((function(t,n){var r=e.ComponentQuery.query("#dpmprojectgantt")[0];a.getStoreTaskExpandStatus(r.taskStore),a.isReadyToExpand(undefined,t,0)})).then((function(e){n.togglePlanView(t)}))):n.togglePlanView(t)},changeIcon:function(e,t){var a=enoviaServer.computeUrl("/common/images/")+t;t=a||"";var n=e,r=n.btnIconEl,o=n.icon||"";n.icon=a,t!==o&&(r&&r.setStyle("background-image",t?"url("+t+")":""),n.fireEvent("iconchange",n,o,a))},toggleRollUpTaskView:function(e){if(1!=e.hidden){var t=e.pressed;null==t&&(t=e.checked);var a=this.getView(),n=enoviaServer.computeUrl("/common/images/"),r=n+"I_ShowRollupTask32.png",o=n+"I_HideRollupTask32.png";a.setShowRollupTasks(t),t?(e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.hideRollUpTasks"]),e.setIcon(o)):(e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.showRollUpTasks"]),e.setIcon(r))}},showRefinement:function(){var t=e.ComponentQuery.query("panel#GanttRefinementPanel")[0];t.show(),t.setScrollY(0)},showForm:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0];let a=t.parentView;a&&a.dispatchEvent("closePropertyPanel");var n=t.crudManager;if(n.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;n.reject()}var r=e.ComponentQuery.query("#ganttConfigPanel")[0];r.reset(),r.show();for(var o=t.getPlugins(),i=0,l=o.length;i<l;i++){if("RMBMenu"===o[i].id){o[i].disable();break}}},showTaskCreationForm:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0];let n=t.parentView;n&&n.dispatchEvent("closePropertyPanel");var r=t.crudManager;if(r.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;r.reject()}var i=e.ComponentQuery.query("#ganttTaskCreationPanel")[0],l=t.lockedGrid.getSelectionModel().selected.items;if(0===l.length)alert(App.Nls["emxFramework.Common.PleaseSelectitem"]);else if(1!==l.length)alert(App.Nls["emxFramework.Common.PleaseSelectOneItemOnly"]);else{var d=a.getGanttItem(i,"insertradio");!a.isValidAddSubTask(l[0])||l[0].isMilestone()&&l[0].isLeaf()?(d.items.items[1].disable(!0),d.items.items[0].enable(!0),d.items.items[0].setValue(!0)):a.isValidAddTaskAbove(l[0])?(d.items.items[0].enable(!0),d.items.items[1].enable(!0),d.items.items[1].setValue(!0)):(d.items.items[0].disable(!0),d.items.items[1].enable(!0),d.items.items[1].setValue(!0));var p=l[0].data.ConstraintType,g=t.taskStore.getRoot().childNodes[0];if("ProjectSpace"!=l[0].data.EnglishType&&"ProjectConcept"!=l[0].data.EnglishType&&"Experiment"!=l[0].data.EnglishType||(p="As Late As Possible"==l[0].data.defaultConstraintType?"aslateaspossible":"assoonaspossible"),""!==p)a.getGanttItem(i,"constrainttype").setValue(p);else if("Project Finish Date"===g.get("ScheduleFrom")){a.getGanttItem(i,"constrainttype").setValue("aslateaspossible")}let n=a.getGanttItem(i,"deliverablesInheritance"),u=s.get("DPM_DisableOwnershipInheritance");void 0===u&&(u=App.Infra.disableOwnershipInheritance),"true"!==u&&!0!==u||(n.items.items[1].setValue(!0),n.items.items[0].disable(!0));var m=o.getSubTypePolicyAndBadcharsURL();r.viewCollection.getDataModelDetails({model:App.Infra.contextInfo,fields:m.fields,include:m.include,customParams:m.customParams,donotPersist:!0,doNotCache:!0,refresh:!0}).then((function(e){f(JSON.parse(JSON.stringify(e)))}));var f=function(t){App.Infra.PoliciesAndTypes=t.subTypesAndPolicies[0];var n=App.Infra.PoliciesAndTypes.gateMilestoneTypes,r=n.substr(1,n.length-2).split(", ");App.Infra.PoliciesAndTypes.gateMilestoneTypes=r;var o=(l=App.Infra.PoliciesAndTypes.AllTypes).substr(1,l.length-2).split(", ");App.Infra.PoliciesAndTypes.taskTypeRange=c.getFieldRangeItems("tasks","taskTypes");var i,l=e.create("Ext.data.Store",{fields:["abbr","name"],data:(i=new Array,App.Infra.PoliciesAndTypes.taskTypeRange.forEach((e=>{"isatask"===e.helpinfo&&-1!==o.indexOf(e.value)&&i.push({abbr:e.value,name:e.display})})),i)});e.getCmp("type").bindStore(l);var s=e.ComponentQuery.query("#ganttTaskCreationPanel")[0];a.getGanttItem(s,"type").setValue("Task"),a.getGanttItem(s,"duration").durationUnit="d","Manual"===App.Infra.PoliciesAndTypes.schedule&&(e.getCmp("constrainttype").setHidden(!0),e.getCmp("constraintdate").setHidden(!0)),s.show(),s.setScrollY(0),e.getCmp("tBarganttConfiguration").disable()};window.isODTRunning&&(this.type,method="GET",e.Ajax.request({url:URL,method:method,async:!1,success:function(e){e=JSON.parse(e.responseText.trim()),f(e)}}))}},openTaskinCollabTask:function(e){if(e.scope)var t=e.scope.rec;else t=this.getGantt().lockedGrid.getSelectionModel().selected.items[0];if(t){var a={ids:t.getId(),x3dPlatformId:window.widget.getValue("x3dPlatformId")};l.getTransientWidgetInstance().showWidget("ENOTASK_AP","",a)}},openTask:function(e){var t=this.getGantt();if(e.scope)var a=e.scope.rec;else a=t.lockedGrid.getSelectionModel().selected.items[0];if(a){var n=a.getId();n.indexOf("_")>=0&&(n=n.split("_")[0]);var r="../../common/emxNavigator.jsp?physicalId="+n;window.isIFWE&&(r=enoviaServer.computeUrl("/common/emxNavigator.jsp?physicalId=")+n),window.open(r)}},resetCache:function(){if(App.Gantt.filter.filterBy)for(var e in App.Gantt.filter.filterBy)"Name"!==e&&delete App.Gantt.filter.filterBy[e]},resetFilter:function(){if(this.getView().reset(),enoviaServer.resetRefinement=!0,this.resetCache(),this.filter(),0==e.Object.getSize(App.Gantt.filter.filterBy)){var t=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(t,"iconActionFilter.png")}},hide:function(){this.getView().hide()},filter:function(){var t=e.ComponentQuery.query("panel#GanttRefinementPanel")[0],a=["PercentDone","Duration","BaselineDuration","TotalFloat","FreeFloat","Deviation"],n=t.getValues(),r=App.Gantt.filter.fields;for(var o in this.resetCache(),n)if(App.Gantt.filter.filterBy){var i=n[o],l=!1;if(i instanceof Array){if(""!=i.join(""))if(a.includes(o))for(var s=0,c=t.items.items.length;s<c;s++){if("cid"+o==t.items.items[s].id){var d=t.items.items[s].items.items[0];d.minValue.toString()==i[0]&&d.maxValue.toString()==i[1]?l=!1:(l=!0,i=i.join("@"));break}}else""!=i.join("")&&("datefield"==r[o].fieldDataType?(l=!0,i[0]=i[0]+"#"+e.getCmp(o+"_from_date").getValue(),i[1]=i[1]+"#"+e.getCmp(o+"_to_date").getValue(),i=i.join("@")):(l=!0,i=i.join("@")))}else i+""==""&&"Symbol"!=o&&"Pattern"!=o&&"Color"!=o||(l=!0);if(l)if(App.Gantt.filter.filterBy[o]){var p=App.Gantt.filter.filterBy[o];p=p+"@"+i.toString(),App.Gantt.filter.filterBy[o]=p}else App.Gantt.filter.filterBy[o]=i.toString()}var g=App.Gantt.filter.filterBy;g&&Object.keys(g).length>0?this.getView().store.filterTreeBy():(this.getView().store.clearTreeFilter(),App.Gantt.filter.filterBy={});var m=e.ComponentQuery.query("#tBarActionRefine")[0];e.Object.getSize(App.Gantt.filter.filterBy)>0?this.changeIcon(m,"iconActionFiltersApplied.png"):e.Object.isEmpty(App.Gantt.filter.filterBy)&&this.changeIcon(m,"iconActionFilter.png")},filterByName:function(t,a){a.getKey()===a.ESC&&(delete App.Gantt.filter.filterBy.Name,t.reset());var n=t.getValue();if(n.length>0){App.Gantt.filter.filterBy.Name=n,this.getGantt().getTaskStore().filterTreeBy();var r=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(r,"iconActionFiltersApplied.png")}else if(delete App.Gantt.filter.filterBy.Name,this.getGantt().getTaskStore().filterTreeBy(!0),0==e.Object.getSize(App.Gantt.filter.filterBy)){r=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(r,"iconActionFilter.png")}},find:function(a,n,r){var o=this.getView(),i=o.getTaskStore();a.focus(!1);var l=this;this.finder=new t({field:a,view:o,store:i,newValue:n,oldValue:r}),e.Function.defer((function(){0!=App.Infra.Load.Level?l.finder.ExpandAndFind(l,!1):l.finder.find(!1,!1)}),500)},clear:function(e){e.focus(!1),this.finder.reset()},previous:function(e){e.focus(!1);this.finder.find(!0,!0)},next:function(e){e.focus(!1);this.finder.find(!1,!0)},calculateFloatData:function(){var t=this.getGantt();let a=t.crudManager,n=a.viewCollection;if(a.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var r=o.getFloatValuesURL();App.Infra.contextInfo;n.getDataModelDetails({model:App.Infra.contextInfo,fields:r.fields,include:r.include,customParams:r.customParams,donotPersist:!0,doNotCache:!0,refresh:!0}).then((function(e){i(e)})),t.setLoading(!1),t.setLoading(App.Nls["emxProgramCentral.Gantt.CalculatingRollUp"]);var i=function(t){var a=e.ComponentQuery.query("#dpmprojectgantt")[0],n=a.getTaskStore();let r=t.get("getFloatValues");for(var o=JSON.parse(JSON.stringify(r)),i=App.Infra.Columns,l=0,s=o.length;l<s;l++){var c=o[l],d=c.id;if("Last Modified"==d){var p=!1;for(let e=0,t=i.length;e<t;e++){var g=i[e].columns;if(null!=g){for(let t=0,a=g.length;t<a;t++){if("TotalFloat"==g[t].dataIndex){i[e].text=c.lastModified,p=!0;break}}if(1==p)break}}}else{var m=c.totalFloat,f=c.freeFloat,u=n.getModelById(d);if(u){u.set("TotalFloat",m),u.set("FreeFloat",f),"0.0"==m?u.set("isOverallCritical","True"):u.set("isOverallCritical","False");let e=a.crudManager.viewCollection,t=e&&e.modelCache,n=e.getModelFromModelCache(d);n&&n.set("totalFloat",m),Object.values(t).forEach((e=>{let t=e.model;if(t.id===d){if(""==m)return;"0.0"==m?t.set("isOverallCritical","True"):t.set("isOverallCritical","False")}}))}}}a.crudManager.commit(),a.setLoading(!1)}},calculateForecastValues:function(){var t=this.getGantt();let a=t.crudManager,n=a.viewCollection;if(a.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var r=o.getCalculateForecastValuesURL();n.getDataModelDetails({model:App.Infra.contextInfo,fields:r.fields,include:r.include,customParams:r.customParams,donotPersist:!0,refresh:!0}).then((function(e){i(JSON.parse(JSON.stringify(e)))})),t.setLoading(!1),t.setLoading(App.Nls["emxProgramCentral.Gantt.CalculatingForecast"]);var i=function(t){for(var a=e.ComponentQuery.query("#dpmprojectgantt")[0],n=a.getTaskStore(),r=t.getForecastValues,o=App.Infra.Columns,i=0,l=r.length;i<l;i++){var s=r[i],c=s.id;if("Last Modified"==c){var d=!1;for(let e=0,t=o.length;e<t;e++){var p=o[e].columns;if(null!=p){for(let t=0,a=p.length;t<a;t++){if("BaselineDuration"==p[t].dataIndex){o[e].text=s.forecastUpdatedOn,d=!0;break}}if(1==d)break}}}else{var g=s.forecastStartDate,m=s.forecastFinishDate,f=s.forecastDuration,u=s.EstStartDate,C=s.EstFinishDate,h=s.EstDuration,v=n.getModelById(c);v&&(v.set("BaselineStartDate",g),v.set("BaselineEndDate",m),v.set("BaselineDuration",f),v.set("StartDate",u),v.set("EndDate",C),h.includes("d")&&v.set("Duration",h))}}a.crudManager.commit(),a.setLoading(!1)}},promoteSuccessor:function(){var t=this.getGantt();if(t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var a="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,promoteSuccessor";t.setLoading(!1),t.setLoading({msg:App.Infra.LoadText||t.L("loadingText")});r.ajaxRequest({url:a,type:"GET",dataType:"json",callback:function(t){for(var a=e.ComponentQuery.query("#dpmprojectgantt")[0],n=a.getTaskStore(),r=t.data[0].relateddata.promoteSuccessor,o=(App.Infra.Columns,0),i=r.length;o<i;o++){var l=r[o],s=l.id,c=l.dataelements.state,d=n.getModelById(s);d&&d.set("State",App.Nls[c])}a.crudManager.commit(),a.setLoading(!1)}})},onOutdent:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0],n=t.crudManager;if(n.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;n.reject()}var r=t.lockedGrid.getSelectionModel().selected.items,o=!0;if(r.length>0&&0==(r=a.isValidTaskIndentation(r,!0)).length&&(o=!1),o){var i=e.Array.filter(r,(function(e){return!e.isReadOnly()}));i&&i.forEach((e=>{let t=e&&e.id&&n.viewCollection.modelCache[e.id];t.getParent().getParent().insertBefore(t,t.getParent().getNextBrother())})),t.getTaskStore().outdent(i,(function(e,r){n.transport.sync.params.LeftIndent=!0,a.getStoreTaskExpandStatus(t.getTaskStore()),n.sync(),n.commit()}))}},onIndent:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0],n=t.crudManager;if(n.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;n.reject()}var r=t.lockedGrid.getSelectionModel().selected.items,o=!0;if(r.length>0&&0==(r=a.isValidTaskIndentation(r,!1)).length&&(o=!1),o){var i=e.Array.filter(r,(function(e){return e.previousSibling&&!e.previousSibling.isReadOnly()}));i&&i.forEach((e=>{let t=e&&e.id&&n.viewCollection.modelCache[e.id];t&&t.getPreviousBrother().addChild(t)})),t.getTaskStore().indent(i,(function(e,r){n.transport.sync.params.RightIndent=!0,a.getStoreTaskExpandStatus(t.getTaskStore()),n.sync(),n.commit()}))}},onShowHidePercentComplete:function(){App.Infra.showPercentComplete=!App.Infra.showPercentComplete;var t=e.getCmp("tBarActionShowHidePercentComplete");1==App.Infra.showPercentComplete?t.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.HidePercentComplete"]):t.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.ShowPercentComplete"]);for(var a=e.ComponentQuery.query("#dpmprojectgantt")[0],n=a.getSchedulingView(),r=a.taskStore.toArray(),o=1,i=r.length;o<i;o++)n.columnRenderer(null,null,r[o]);n.refreshView()},saveColumnConfiguration:function(t){var n,r=e.ComponentQuery.query("#dpmprojectgantt")[0],l=App.Nls["emxProgramCentral.Gantt.ColumnConfig.SaveColumnConfigurationMessage"];if(1==t?(n={columnconfig:{resetToDefault:"true"}},l=App.Nls["emxProgramCentral.Gantt.ColumnConfig.ResetToDefaultColumnConfigurationMessage"]):(App.Infra.isColumnReordered&&1==App.Infra.isColumnReordered&&a.cacheColumnIndex(),n={columnconfig:App.Infra.ColumnConfig}),void 0===n.columnconfig||""==n.columnconfig||"{}"==n.columnconfig)return l=App.Nls["emxProgramCentral.Gantt.ColumnConfig.NothingToSaveColumnConfigurationMessage"],void alert(l);let s=App.Infra.contextInfo;s.set({ganttConfig:JSON.stringify(n)});let c=o.getGanttConfigURL(),d=new i(s);r.crudManager.viewCollection.processSaveDataModel(d,{fields:c.fields,include:c.include,donotShowMessage:!window.Widget,isNew:!1,customParams:c.customParams,onComplete:function(e){App.Infra.ColumnConfig="",App.Infra.isColumnReordered=!1,alert(l)},onFailure:function(e){alert(App.Nls["emxProgramCentral.Gantt.ColumnConfig.FailureSaveColumnConfigurationMessage"])}})},resetToDefaultColumnConfiguration:function(){this.saveColumnConfiguration(!0)},onRemove:function(e){let t=this.getGantt().lockedGrid.getSelectionModel().selected.items[0],r=n.actionType.DELETE;"tBarRemove"===e.id&&(r=n.actionType.REMOVE_SUB_PROJECT),a.isValidRMBOperation(t,r)&&cpnl.syncOnAddRemoveTask(e,r)}})}));