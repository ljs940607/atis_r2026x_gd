define("DS/ENOGantt/Data/TaskStore",["UWA/Class","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/Data/ResponseUtil","DS/Foundation2/FoundationV2Data","DS/ENOGantt/URLStore","DS/ENOGantt/GanttUtil","DS/ENOProjectMgmtModels/Collections/Calendars","DS/ENOProjectMgmtModels/Collections/Projects"],(function(t,e,a,n,r,i,o,l){var s={patternMatches:function(t,e){return new RegExp(Ext.String.escapeRegex(t),"i").test(e)},dateMatchFound:function(t,e,a){var n=new Date(a[0].split("#")[1]),r=new Date(a[1].split("#")[1]),i=new Date(t.get(e));return i.setHours(0),i.setMinutes(0),i.setSeconds(0),isNaN(n)||isNaN(r)?isNaN(n)?i<=r:n<=i:n<=i&&i<=r}};return t.extend({init:function(t){let n=UWA.clone(t||{},!1);this.viewCollection=n.viewCollection,Ext.ClassManager.isCreated("DS.ENOGantt.Data.TaskModel")||Ext.define("DS.ENOGantt.Data.TaskModel",{extend:"Gnt.model.Task",autoCalculateCostForParentTask:!1,autoCalculatePercentDoneForParentTask:!0,useOwnCalendarAsConverter:!0,autoCalculateCost:!1,fields:i.getTaskAndProjectModelFields(),getEarlyStartDateDefaultValue:function(t){var e=this,a=t.taskStore||e.getTaskStore(!0),n=e.getProject();if(e.data.TaskProjectId){var r=a.getModelById(e.data.TaskProjectId).data;return r.ConstraintDate?r.ConstraintDate:a.getProjectStartDate()}return n?n.getStartDate():a.getProjectStartDate()},isEditable:function(t){if(0==i.doBasicEditChecks(this))return!1;if(!i.hasAccessOnTaskForRestrictAssignee(this)&&["StartDate","EndDate","Duration","PercentDone"].indexOf(t)<0)return!1;if(App.Infra.CustomeColumnDataIndex.includes(t))return App.Infra.customeColumnEditableData[t].isEditable;if(this.getReadOnly()&&this.data.State==App.Nls.Complete)return!1;if("root"==this.get("parentId"))return!1;return-1==["State","Status","TaskSequenceId","Type","Assignee","Deviation","FreeFloat","TotalFloat"].indexOf(t)&&("StartDate"==t?this.isStartDateEditable():"EndDate"==t?this.isEndDateEditable():"Duration"==t?this.isDurationEditable():"PercentDone"==t?this.isPercentDoneEditable():"Dependency"==t?this.isDependencyEditable():this.callParent(arguments))},isExpandable:function(){return!!this.get("expandable")&&!this.isLeaf()},isReadOnly:function(){var t=!1;return this.getReadOnly()&&(t=!0),t},isMilestone:function(t){var e=!1,a=this.get("EnglishType");return this.hasChildNodes()?e=!1:"Gate"!=a&&"Milestone"!=a||(e=!0),e},isStartDateEditable:function(){var t=App.Nls.Active,e=App.Nls.Review,a=App.Nls.Complete,n=this.get("State"),r=!this.isLeaf();return n!=t&&n!=e&&n!=a&&!r&&!App.Infra.TypeOf.ProjectTemplate},isEndDateEditable:function(){var t=App.Nls.Review,e=App.Nls.Complete,a=this.get("State"),n=!this.isLeaf();return a!=t&&a!=e&&!n&&!App.Infra.TypeOf.ProjectTemplate},isPercentDoneEditable:function(){return!!this.isLeaf()&&("Project Space Hold Cancel"!=Ext.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0].data.Policy&&1!=App.Infra.TypeOf.Experiment)},isDurationEditable:function(){var t=App.Nls.Review,e=App.Nls.Complete,a=this.get("State"),n=!this.isLeaf(),r=this.isMilestone();return 100!=this.get("PercentDone")&&a!=t&&a!=e&&!n&&!r},isDependencyEditable:function(){var t=App.Nls.Complete;return this.get("State")!=t},setStartDate:function(t,e,a,n){var r=this;null!=r.data.calculateDuration&&"Yes"==r.data.calculateDuration&&(e=!1),r.propagateChanges((function(n,i){r.setStartDateAndPinWithoutPropagation(t,e,a,i)}),n,null,!0)},setEndDate:function(t,e,a,n){var r=this;(r.get("State")==App.Nls.Active||null!=r.data.calculateDuration&&"Yes"==r.data.calculateDuration)&&(e=!1),r.propagateChanges((function(n,i){r.setEndDateAndPinWithoutPropagation(t,e,a,i)}),n,null,!0)}}),Ext.ClassManager.isCreated("DS.ENOGantt.Data.ProjectModel")||Ext.define("DS.ENOGantt.Data.ProjectModel",{extend:"Gnt.model.Project",autoCalculateCostForParentTask:!1,autoCalculatePercentDoneForParentTask:!1,autoCalculateCost:!1,AllowDependencies:!0,fields:i.getTaskAndProjectModelFields(),isExpandable:function(){return!!this.get("expandable")&&!this.isLeaf()},isEditable:function(t){return 0!=i.doBasicEditChecks(this)&&(App.Infra.CustomeColumnDataIndex.includes(t)?App.Infra.customeColumnEditableData[t].isEditable:!this.getReadOnly()&&("root"!=this.get("parentId")&&void 0))}}),Ext.define("MyDependencyStore",{override:"Gnt.data.DependencyStore",autoLoad:!0,proxy:{type:"memory",reader:{type:"json"}},getDependencyError:function(t,a,n,r,i){var o=this.callParent(arguments);o<=0&&-2==o&&(o=0);var l=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(o>=0){if(t instanceof e.model.Dependency)n=t.getType(),a=t.getTargetId();else if(null==n){var s=this.model.getField(this.model.prototype.typeField).defaultValue;n=void 0!==s?s:this.model.Type.EndToStart}var d,p=App.Nls.Review,u=App.Nls.Active,c=App.Nls.Complete,f=l.taskStore.getModelById(a);f&&(d=f.data.State),d!==p&&d!==u||0!==n&&2!==n||(o=-101),1!==n&&3!==n||!f.hasChildNodes()||(o=-102),d===c&&(o=-104)}return o}}),Ext.define("DS.ENOGantt.Data.TaskStore",{extend:"Gnt.data.TaskStore",requires:["DS.ENOGantt.Data.ProjectModel"],model:"DS.ENOGantt.Data.TaskModel",sortOnLoad:!1,autoNormalizeNodes:!1,scheduleByConstraints:!0,checkDependencyConstraint:!0,checkPotentialConflictConstraint:!0,keepExpandStateWhileFiltered:!0,allowExpandCollapseWhileFiltered:!0,scheduleBackwards:!0,RefinementUtil:s,listeners:{datachanged:function(t,e){var a=Ext.getCmp("bbarObjectCount");if(a){var n=App.Nls["emxProgramCentral.Common.Objects"];a.setValue(t.getRange().length+" "+n)}}},calendarManager:new e.data.CalendarManager({proxy:{type:"memory",reader:{type:"json"}},listeners:{}}),proxy:{type:"memory",reader:{type:"json"}},getCriticalPaths:function(){var t=[];if(this.toArray()[1].data.Id){let e=App.Infra.contextInfo;return(e&&e.getAllTasks())._models.forEach((e=>{if(e){let n=e.get("isOverallCritical");if(n&&"TRUE"===n.toUpperCase()){var a=this.getModelById(e.id);a&&t.push(a)}}})),t.length||alert(App.Nls["emxProgramCentral.Gantt.AlertForCriticalPath"]),Ext.Array.map(t,(function(t){return t.getCriticalPaths()}))}this.callParent(arguments)},find:function(t,e,n,r){var i=a.getGanttTableColumnArray(!1);if(i&&i.length>0){var o=i.length,l=this.toArray(),s=l.length;if(t){-1==(p=r-1)&&(p=s-1);for(var d=p;d>0;d--){if((c=l[d]).raw.visible&&this.performFind(e,c,o,i))return{model:c,index:d}}}else{d=p=r+1;for(var p,u=l.length;d<u;d++){var c;if((c=l[d]).raw.visible&&this.performFind(e,c,o,i))return{model:c,index:d}}}}},performFind:function(t,e,a,n){for(var r=!1,i=0;i<a;i++){var o=n[i],l=e.get(o.dataIndex);if(null!=l&&""!=l.toString()){if("datefield"==o.columnDataType){var s=o.format;l=Ext.util.Format.date(l,s)}if("Duration"==o.dataIndex&&(l=o.getValueToRender(l,null,e)),t.test(l)){r=!0;break}}}return r},filterTreeBy:function(t){this.callParent([{filter:function(e){if(e.isRoot())return!0;if("root"==e.get("parentId"))return App.Gantt.filter.FilterFieldTaskArray&&App.Gantt.filter.FilterFieldTaskArray.push(e),!0;if(e.get("ExternalTask"))return!1;if(e.parentNode&&!e.parentNode.isExpanded()&&!t)return!1;var a=App.Gantt.filter.filterBy,n=!0,r=App.Gantt.filter.filterField,i=["PercentDone","Duration","BaselineDuration","TotalFloat","FreeFloat","Deviation"];for(var o in a)if((!r||o!=r)&&a.hasOwnProperty(o)){var l=App.Gantt.filter.fields[o]?App.Gantt.filter.fields[o].fieldDataType:void 0,d=o,p=a[o].split("@"),u=e.get(d);if("Name"==o){var c=App.Gantt.filter.filterBy.Name;n=new RegExp(Ext.String.escapeRegex(c),"i").test(e.getName())}else if("datefield"==l){if(!(n=s.dateMatchFound(e,d,p)))break}else{if(!i.includes(o)){if(null!=u){if("numberfield"==l)if(u=Math.round(100*Number(u))/100,"Duration"==o)u=u+" "+App.Nls["emxProgramCentral.DurationUnits.Days"].toLowerCase();if(p.indexOf(u.toString())>=0)continue;n=!1;break}n=!1;break}if(!(n=this.doDeviationFilter(e,d,p,u)))break}}if(App.Gantt.filter.FilterFieldTaskArray){if(n){App.Gantt.filter.FilterFieldTaskArray.push(e);for(var f=e.parentNode;f;)App.Gantt.filter.FilterFieldTaskArray.push(f),f=f.parentNode;App.Gantt.filter.FilterFieldTaskArray.push(e)}return e.get("visible")}return n},checkParents:!0}])},doDeviationFilter:function(t,e,a,n){var r=a[0],i=a[1],o=App.Nls["emxProgramCentral.DurationUnits.Days"];if(null==n||""===n&&"PercentDone"!=e)return!1;"Deviation"==e&&(n=n.substring(0,n.indexOf(o)));var l=n;return l=Number.isInteger(parseFloat(l))?parseInt(l):parseFloat(l),isNaN(r)||isNaN(i)?isNaN(r)?i<=l:r<=l:r<=l&&l<=i}})},getStore:function(){return Ext.create("DS.ENOGantt.Data.TaskStore")}})}));