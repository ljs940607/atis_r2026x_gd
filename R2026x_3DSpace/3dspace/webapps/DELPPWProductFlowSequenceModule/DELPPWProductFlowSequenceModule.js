define("DS/DELPPWProductFlowSequenceModule/ProductFlowComponent",["UWA/Core"],(function(e){"use strict";return function(t,n){const i=["PROCESS","SERVICE","CONSTRUCTION"],o="RESOURCE",r="OPERATION",a="DELAssetsStructureLink";var s,l,c,d,u,p,f,m,g,h,y,P,I,b,w,v,k,E,N,L,C,x,T,A,D,R,S,V,F,M,O,_,$,G,B,U,j,W,H,z,Y,q,X,Q,J,K,Z,ee,te,ne,ie,oe,re,ae,se,le,ce,de,ue,pe,fe,me,ge,he,ye,Pe,Ie,be,we,ve,ke,Ee,Ne,Le,Ce,xe,Te,Ae,De,Re,Se=t.getComponent("EGraphCore"),Ve=t.getComponent("EGraphViews"),Fe=t.getComponent("EGraphIact"),Me=t.getComponent("EGraphUtils"),Oe=t.getComponent("ContextualMenuManager"),_e=t.getComponent("TooltipModel"),$e="SEQUENCE",Ge="North",Be="South",Ue="East",je="West",We="DELArrowDisplayExt.V_ArrowStartPosition",He="DELArrowDisplayExt.V_ArrowEndPosition",ze=!1,Ye=!1,qe=0,Xe=!1,Qe=0,Je=!1,Ke=!1,Ze={},et=!1,tt=[],nt=0;return C=!!e.is(n.readOnly)&&n.readOnly,A=e.is(n.nodes)?n.nodes:[],D=e.is(n.links)?n.links:[],x=e.is(n.nodeOptions)?n.nodeOptions:[],R=e.is(n.identifier)?n.identifier:"",S=e.is(n.getNodeContextMenu,"function")?n.getNodeContextMenu:null,V=e.is(n.getLinkContextMenu,"function")?n.getLinkContextMenu:null,F=e.is(n.getLinkedNodeContextMenu,"function")?n.getLinkedNodeContextMenu:null,O=e.is(n.onConnectingNodes)?n.onConnectingNodes:null,ie=e.is(n.onNodeDoubleClick,"function")?n.onNodeDoubleClick:null,de=e.is(n.onNodeSelectionChange,"function")?n.onNodeSelectionChange:null,c=e.is(n.onUpdateConnectionAttributes,"function")?n.onUpdateConnectionAttributes:null,d=e.is(n.onMultiplePositionChangeAlert,"function")?n.onMultiplePositionChangeAlert:null,xe=!!e.is(n.displayLinkedItemsEnabled)&&n.displayLinkedItemsEnabled,Te=!!e.is(n.displayLinkedResourcesEnabled)&&n.displayLinkedResourcesEnabled,l=function(){Ve.HTMLNodeView.call(this)},s=function(e){Ve.SVGEdgeView.call(this,e)},function(){}.prototype.onupdate=function(e){var t,n,i,o,r;t=e.cl1.c.aleft,o=e.cl1.c.atop,i=e.cl2.c.aleft,r=e.cl2.c.atop,n=.5*(t+i),e.set("path",[Se.PathCmd.M,t,o,Se.PathCmd.L,n,o,Se.PathCmd.L,n,r,Se.PathCmd.L,i,r])},s.prototype.createTextEdgeView=function(e,t,n){var i,o="http://www.w3.org/2000/svg";(i=document.createElementNS(o,"textPath")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.display.elt.id),i.setAttribute("startOffset","10%"),""===e.mark?i.appendChild(document.createTextNode("")):e.mark.hasOwnProperty(t)&&(i.appendChild(document.createTextNode(e.mark[t])),n++),this.display.text=document.createElementNS(o,"text"),this.display.text.setAttribute("dy",-14*(n-1)+12),this.display.text.grElt=e,Me.classListAdd(this.display.text,"edge-text"),this.display.text.appendChild(i),""!==i.innerHTML&&this.structure.root.appendChild(this.display.text)},s.prototype.oncreateDisplay=function(e){var t,n=this,i=0;Ve.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.id=Math.random(),this.display.elt.textContent="official",t="Type",Array.isArray(t)||(t=[t]),t.forEach((function(t){n.createTextEdgeView(e,t,i),i++}))},W=function(e){return/^(auto|0)$|^[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc|rem)$/.test(e)},ne=function(){return T===$e},G=function(){var t=e.createElement("div",{class:"input-node my-node"}),n=e.createElement("img",{class:"my-node-type-img"}),i=e.createElement("div",{class:"title-container"}),o=e.createElement("div",{class:"sub-title-container"}),r=e.createElement("div",{class:"my-node-container"}),a=e.createElement("div",{class:"my-node-col left"}),s=e.createElement("div",{class:"my-node-col right"}),l=e.createElement("div",{class:"myNodeLinkEdit"}),c=e.createElement("div",{class:"my-node-text"});return t.setStyles({width:"50px",height:"50px"}),c.setStyles({top:"0px"}),r.appendChild(n),r.appendChild(o),s.appendChild(c),t.appendChild(i),t.appendChild(r),t.appendChild(a),t.appendChild(s),t.appendChild(l),t},I=function(){var t=e.createElement("div",{class:"input-node my-node"}),n=e.createElement("div",{class:"my-node-container"}),i=e.createElement("img",{class:"my-node-type-img linked-node"}),o=e.createElement("div",{class:"sub-title-container"});return t.setStyles({width:"50px",height:"50px"}),n.appendChild(i),n.appendChild(o),t.appendChild(n),t},U=function(t,n){var i,o=n.grElt,r=n.clientPos[0],a=n.clientPos[1];e.is(o)&&!C&&(o.type===Se.Type.NODE?(e.is(o.gr.selection.first)&&o.gr.selection.first.PID!==o.PID?(_.removeFromSelection(o.gr.selection.first),_.addToSelection(o)):null===o.gr.selection.first&&_.addToSelection(o),F&&e.is(o.model.link)?i=F(o.model):S&&(i=S(o.model))):o.type===Se.Type.EDGE&&e.is(o.mark)&&V&&(i=V(o.mark)),e.is(i)&&(i=Array.isArray(i)?i:[i],Array.isArray(i)&&Oe.show({nodes:i},[r,a])))},Q=function(e,t,n){var i,o;return o=e===Se.BorderCstr.TOP||e===Se.BorderCstr.BOTTOM?125+70*t:45+70*t,i=new Se.Connector,!0===n&&(i.views.main=new Ve.SVGConnView("egraph_views_SVGConnView egraph_views_mySVGConnView")),i.multiset(["cstr","attach"],e,["cstr","offset"],o),i},J=function(t){e.is(t.connectors)||(t.connectors={}),Ye||(t.connectors.top=Q(Se.BorderCstr.TOP,0,!0),t.connectors.top.id="top_"+t.id,t.appendConnector(t.connectors.top),t.connectors.bottom=Q(Se.BorderCstr.BOTTOM,0,!0),t.connectors.bottom.id="bottom_"+t.id,t.appendConnector(t.connectors.bottom),t.connectors.left=Q(Se.BorderCstr.LEFT,0,!0),t.connectors.left.id="left_"+t.id,t.appendConnector(t.connectors.left),t.connectors.right=Q(Se.BorderCstr.RIGHT,0,!0),t.connectors.right.id="right_"+t.id,t.appendConnector(t.connectors.right)),t.connectors.topRight=Q(Se.BorderCstr.TOP,1,!1),t.connectors.topRight.id="topRight"+t.id,t.appendConnector(t.connectors.topRight),t.connectors.bottomRight=Q(Se.BorderCstr.BOTTOM,1,!1),t.connectors.bottomRight.id="bottomRight"+t.id,t.appendConnector(t.connectors.bottomRight)},we=function(t,n,i){var o,r,a="http://www.w3.org/2000/svg";(o=document.createElementNS(a,"textPath")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+t.display.elt.id),o.setAttribute("startOffset","50%"),""===n.mark||null===n.mark?o.appendChild(document.createTextNode("")):e.is(n.mark)&&n.mark.linkInfo.hasOwnProperty(i)&&(r=e.is(n.mark.linkInfo[i])&&"NULL"!==n.mark.linkInfo[i]?n.mark.linkInfo[i]:"",o.appendChild(document.createTextNode(r))),t.display.text=document.createElementNS(a,"text"),t.display.text.setAttribute("dy","-5"),t.display.text.grElt=n,t.display.text.setAttribute("data-id",t.display.elt.id),t.display.text.style.cssText="text-anchor: middle;",Me.classListAdd(t.display.text,"edge-text"),t.display.text.appendChild(o),""!==o.innerHTML&&t.structure.root.appendChild(t.display.text)},K=function(t,n,i){var o,r;return e.is(i)?(r="-productFlow",e.is(i.linkInfo.flowType)?r="-productFlow-"+i.linkInfo.flowType:e.is(i.linkInfo.subType)&&("DELLmiTimeConstraintCnx_FinishToStart"===i.linkInfo.subType||"DELLmiTimeConstraintCnx_StartToStart"===i.linkInfo.subType||"DELLmiTimeConstraintCnx_FinishToFinish"===i.linkInfo.subType)&&(r="-timeConstraint")):r="-linkedObject",(o=new Se.Edge).set("geometry",new Se.AutoBezierGeometry),o.views.main=new s("egraph_views_SVGEdgeView my-sec-edge-view"+r),o.mark=i,_.addEdge(t,n,o),o},Ee=function(t,n){var i,o,r,a,s=t.colorParams,l="headerBackgroundColor",c="headerTextColor",d="tileBackgroundColor",u="tileTextColor",p="Equal",f="NotEqual",m="LessThanOrEqual",g="GreaterThanOrEqual",h=function(t){switch(t.graphicalElement){case l:e.is(t.color)&&!i&&(i=t.color);break;case c:e.is(t.color)&&!o&&(o=t.color);break;case d:e.is(t.color)&&!r&&(r=t.color);break;case u:e.is(t.color)&&!a&&(a=t.color)}};return n.sort(((e,t)=>e.ruleNumber-t.ruleNumber)),n.forEach((function(n){var i;if(e.is(n.name)&&n.nodeType===t.nodeType){if(e.is(s[n.name])&&e.is(n.attributeValue))switch(i=e.is(s[n.name],"object")?s[n.name].name:s[n.name],/^[0-9]+$/.test(n.attributeValue)&&(n.attributeValue=parseFloat(n.attributeValue).toFixed(1)),n.attributeCondition){case p:(Array.isArray(i)?i.some((e=>e===n.attributeValue)):i===n.attributeValue)&&h(n);break;case f:(Array.isArray(i)?i.some((e=>e===n.attributeValue)):i===n.attributeValue)||h(n);break;case m:parseFloat(i)<=parseFloat(n.attributeValue)&&h(n);break;case g:parseFloat(i)>=parseFloat(n.attributeValue)&&h(n)}}else e.is(n.name)||n.nodeType!==t.nodeType||h(n)})),{headerBackgroundColor:i,headerTextColor:o,tileBackgroundColor:r,tileTextColor:a}},ue=function(t,n){var i,o="",r={headerContainer:n.querySelector(".title-container"),tileContainer:n.querySelector(".my-node-container")},a=function(n,i,r,a){var s,l,c,d,u,p=Array.isArray(n)?n:[n],f=new e.Element("div",{class:"my-node-line"}),m=0,g=100/p.length;e.is(i)&&(({headerBackgroundColor:s,headerTextColor:l,tileBackgroundColor:c,tileTextColor:d}=Ee(t,i)),(u=p.filter((t=>e.is(t.maxWidth)))).forEach((e=>m+=parseInt(e.maxWidth))),m<100&&(g=(100-m)/(p.length-u.length))),p.forEach((function(n){var i,u,p,m="",h=g,y="12px",P=new e.Element("span",{class:"my-node-word"});n.fontSize&&W(n.fontSize)&&(y=n.fontSize),n.maxWidth&&(h=n.maxWidth),s&&a.headerContainer.setStyles({backgroundColor:s}),c&&a.tileContainer.setStyles({backgroundColor:c}),r.className.contains("sub-title")?(p=n.color?n.color:d||"#3d3d3d",n.fontWeight&&(u=n.fontWeight)):(p=n.color?n.color:l||"#fff",u="bold"),i=e.is(n.dicoType)?n.dicoType+"."+n.name:n.name,e.is(t[i])&&(n.displayTitle&&(m=n.title+" : "),e.is(t[i],"object")?m+=t[i].nls:"NULL"!==t[i]?m+=t[i]:m+=""),""===m?P.destroy():(P.setText(m),P.setStyles({fontWeight:u,color:p,maxWidth:h+"%",fontSize:y}),o+=m,o+=" ",P.inject(f))})),e.is(f)&&(""!==f.innerText&&(o+="\n"),f.inject(r))};x.title&&((i=n.querySelector(".title-container")).innerHTML="",a(x.title,x.colors,i,r)),x.subtitles&&((i=n.querySelector(".sub-title-container")).innerHTML="",x.subtitles.forEach((function(e){a(e,x.colors,i,r)}))),n.tooltipInfos=new _e({shortHelp:o})},b=function(t,n){var i="",o=n.querySelector(".sub-title-container"),r=n.querySelector(".my-node-container");o.innerHTML="",e.is(t.name)&&function(n,o,r,a){var s,l,c,d,u=new e.Element("div",{class:"my-node-line"}),p=new e.Element("span",{class:"my-node-word linked-node"});({headerBackgroundColor:s,headerTextColor:l,tileBackgroundColor:c,tileTextColor:d}=Ee(t,o)),s||l||(c&&a.setStyles({backgroundColor:c}),d&&r.setStyles({color:d})),p.setText(n),i=n,p.inject(u),u.inject(r)}(t.name,x.colors,o,r),n.tooltipInfos=new _e({shortHelp:i})},j=function(t,n,r){var a=new Se.Node,s=t.id,c=Ye?35:90;return s=s.replace(new RegExp(",","g"),"_"),a.views.main=new l,a.model=t,a.PID=t.id,a.id="node_"+s,a.multiset("left",n,"top",r,"width",250,"height",c),J(a),l.prototype.buildNodeElement=function(t){var n,r,a,s=e.is(x.options.displayItemIcon)&&"Disabled"===x.options.displayItemIcon,l=e.is(x.options.displayResourceIcon)&&"Disabled"===x.options.displayResourceIcon;return e.is(t)&&(r=t.model.tileInfo,e.is(t.model.PPRType)&&C&&(Ye=!(!i.includes(t.model.PPRType)&&t.model.PPRType!==o)),(n=Ye?I():G()).addClassName("egraph_views_HTMLNodeView_Node "+r.className+" "+t.model.id),e.is(r.icon)&&e.is(r.icon.iconPath)&&(a=n.getElementsByClassName("my-node-type-img")[0],e.is(a)&&(a.crossOrigin="use-credentials",a.src=r.icon.iconPath+"?not-from-cache-please",!Ye&&e.is(x.options.displayIcon)&&"Disabled"===x.options.displayIcon?(a.style.display="none",n.getElementsByClassName("sub-title-container")[0].style.paddingLeft="20px"):(Ye&&i.includes(t.model.PPRType)&&s||t.model.PPRType===o&&l)&&(a.style.display="none",n.getElementsByClassName("sub-title-container")[0].style.paddingLeft="10px")))),e.is(r)&&e.is(r)&&(Ye?b(r,n):ue(r,n)),n},a},q=function(){var t,n,i=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","svg")),o=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","defs")),r=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","marker")),a=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","path"));i.appendChild(o),o.appendChild(r),r.appendChild(a),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("style","position:absolute;"),r.setAttribute("id","arrow-edge-end-marker"),r.setAttribute("markerWidth","10"),r.setAttribute("markerHeight","8"),r.setAttribute("refX","8"),r.setAttribute("refY","4"),r.setAttribute("orient","auto"),a.setAttribute("d","M 0 0 L 10 4 L 0 8"),a.setAttribute("fill","#777"),a.setAttribute("stroke","none"),a.setAttribute("z-index","10"),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker"),o.appendChild(t),(n=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-timeConstraintMarker"),o.appendChild(n),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-QuantityDistribution"),o.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Failed"),o.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Alternative"),o.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Scrapped"),o.appendChild(t),(H=e.createElement("div",{class:"canvas-gv",id:"canvas-"+R})).addEvent("contextmenu",(function(t){e.Event.stop(t)})),H.appendChild(i)},fe=function(t){Ve.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.id=Math.random(),this.display.elt.textContent="official",Ye||(e.is(t.mark)&&(this.display.elt.setAttribute("data-link-type-nls",t.mark.linkInfo.NLS),this.display.elt.setAttribute("data-link-from",t.mark.fromNodeId),this.display.elt.setAttribute("data-link-to",t.mark.toNodeId),this.display.elt.setAttribute("data-link-category",t.mark.linkInfo.flowType||"Good"),this.display.elt.setAttribute("data-link-isProductFlow",t.mark.linkInfo.isProductFlow)),x.options.displayInfoOnFlow&&("Disp_Info_Description"===x.options.displayInfoOnFlow?we(this,t,"description"):"Disp_Info_ReasonCode"===x.options.displayInfoOnFlow&&we(this,t,"reasonCode")))},ke=function(e){var t;return(t=new Fe.StateMachine(e,null,null,e.views.main)).rootState&&(ie&&(t.rootState.doubleClickOnNode=ie),t.rootState.oncontextmenu=U,t.rootState.onmouseup=m),t.state.onwheel=function(e,t){if(t.inside){const n=e.graphView;if(n.zoominc){const e=H.getBoundingClientRect();n.zoominc(.5*t.wheelDelta,t.clientPos[0]-e.x,t.clientPos[1]-e.y)}}},t},B=function(){var e;return Me.inherit(l,Ve.HTMLNodeView),Me.inherit(s,Ve.SVGEdgeView),s.prototype.oncreateDisplay=fe,(e=new Se.EGraph).setViewOpts({addTopologicalIds:!0}),e.addView("main",new Ve.HTMLGraphView(H)),e.setZoomOpts({customMgt:!0}),e.updateLock(),e},Y=function(){var e,t,n;for(n=new Me.BoundingRect,e=_.nodes.first;e;e=Se.dftNext(_,e))"node_page_aspect_ratio"!==e.id&&n.update(e,e.actualLeft-300,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight);t=Me.reframeViewpoint(_.views.main.getSize(),n,{padding:15,minSize:50,horizontal:-1,vertical:-1,aliasing:0,defaultVpt:_.views.main.vpt,maxScale:1}),_.views.main.setViewpoint(t,!0)},M=function(){var t,n,r,a,s,l=!0,p=!1;_.addChangeListener((function(f){var m,g,h,y,P,I,b={},w={},v=[],k=!1;if("edges"===f[0].path[0]&&!et&&(e.is(D[0])&&"LinearProductFlowCnx"===D[0].linkType&&(k=!0),m=f[0].child.cl2.c,g=f[0].child.cl1.c,null!==m&&null!==g&&e.is(m.node.model)&&e.is(g.node.model)&&!k)){if(g.node.PID===m.node.PID&&g.id!==m.id){if(null!==(h=f[0].child.prev)){for(P=h;P;P=P.prev)P.cl2.c.id!==g.id&&P.cl1.c.id!==g.id||!e.is(P.mark)||v.push(P);1===v.length?null!==(I=v[0])&&e.is(I.mark)&&(I.mark.toNodeId===m.node.model.id?(I.join(null,f[0].child,null,g),b[We]=I.mark.startAnchorPos,y=u(I.mark,m.id,!1),b[He]=y.anchorPositionValue,e.is(b)&&e.is(c,"function")&&(w={anchorPositionValues:b},c(I.mark.id,w,{refreshNodeLinks:!1}))):I.mark.fromNodeId===m.node.model.id&&(I.join(f[0].child,null,g,null),y=u(I.mark,m.id,!1),b[We]=y.anchorPositionValue,b[He]=I.mark.endAnchorPos,e.is(b)&&e.is(c,"function")&&(w={anchorPositionValues:b},c(I.mark.id,w,{refreshNodeLinks:!1})))):v.length>1&&e.is(d,"function")&&d()}}else e.is(f[0].child.geometry)||!O||C||(et=!0,O(g.node.model,m.node.model,g.id,m.id));setTimeout((function(){if(e.is(H))for(t=H.getElements("path"),n=0;n<t.length;n++)"official"!==(s=t[n]).innerHTML&&(r=window.getComputedStyle(s),"none"===r.getPropertyValue("marker-end")&&(s.parentElement.id.contains("arrow-edge-end-")||s.parentElement.removeChild(t[n])))}),500)}p=f.some((function(t){return"selection"===t.path[0]&&(a=t.child),"nodes"===t.path[0]&&"moved"===t.type&&(e.is(a)&&e.is(a.model)&&(i.includes(a.model.PPRType)||a.model.PPRType===o)&&a.addChangeListener((function(e){e.forEach((function(e){"updated"!==e.type||Xe||(e.object[e.name]=e.oldValue)}))})),!0)})),l||(l=f.some((function(e){return"selection"===e.path[0]})))})),_.addListener("update",(function(){var t,n,i,o,r,s=[];if(l&&!C){if(l=!1,Je)return void(Ke||(Je=!1));for(r=e.clone(Ze,!0),Ze={},t=_.selection.first;t;t=t.nextSel)n=t.model,Ze[t.PID]||(Ze[t.PID]=!0),r[t.PID]||(i=n);for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&!Ze[o]&&s.push(o);de&&(e.is(i)||s.length>0)&&de(i,s)}else{if(Xe)return void(Xe=!1);!p||Xe||C||e.is(a)&&e.is(a.model)&&e.is(a.model.linkedObjectsInfo)&&E(a)}m()}))},Z=function(e){var t,n={},i=0;for(e=Array.isArray(e)?e:[e],t=_.nodes.first;t&&(e.indexOf(t.PID)>-1&&(n[t.PID]=t,i++),i!==e.length);t=Se.dftNext(_,t));return n},ee=function(e){var t,n={},i=[];for(e=Array.isArray(e)?e:[e],t=_.nodes.first;t;t=Se.dftNext(_,t))e.indexOf(t.PID)>-1&&i.push(t);return i.length>0&&(n[e]=i),n},k=function(e,t){var n,i=[],o=0;for(t=Array.isArray(t)?t:[t],n=_.nodes.first;n&&(t.indexOf(n.PID)>-1&&n.id.contains(e)&&(i.push(n),o++),o!==t.length);n=Se.dftNext(_,n));return i},ae=function(t){var n,i=[];for(t=Array.isArray(t)?t:[t],n=_.edges.first;n;n=n.next)e.is(n.mark)&&t.indexOf(n.mark.id)>-1&&i.push(n);return i},oe=function(){D.forEach((function(t){var n,i,o,r=Z([t.fromNodeId,t.toNodeId]);o=function(e,n){switch(e){case Ge:return 0===n?r[t.fromNodeId].connectors.top:r[t.toNodeId].connectors.top;case Be:return 0===n?r[t.fromNodeId].connectors.bottom:r[t.toNodeId].connectors.bottom;case Ue:return 0===n?r[t.fromNodeId].connectors.right:r[t.toNodeId].connectors.right;case je:return 0===n?r[t.fromNodeId].connectors.left:r[t.toNodeId].connectors.left;default:return 0===n?r[t.fromNodeId].connectors.right:r[t.toNodeId].connectors.left}},e.is(t.startAnchorPos)&&e.is(t.endAnchorPos)?(n=o(t.startAnchorPos,0),i=o(t.endAnchorPos,1)):(n=r[t.fromNodeId].connectors.right,i=r[t.toNodeId].connectors.left),e.is(n)&&e.is(i)&&K(n,i,t)}))},Ce=function(t){var n,r=[],s=[],l=P();if(e.is(A))return A.forEach((function(c){var d,u;e.is(c.linkedObjectsInfo)&&(u=c.linkedObjectsInfo.filter((function(e){return t.includes(e.PPRType)})),e.is(u)&&u.length>0&&(e.is(t,"array")&&(t=u[0].PPRType),u=u.sort((function(e,n){var r;return i.includes(t)?(e=e.tileInfo.name.replace(/ *\([^)]*\) */g,""),r=(n=n.tileInfo.name.replace(/ *\([^)]*\) */g,"")).localeCompare(e)):t===o&&(e=e.tileInfo.name,n=n.tileInfo.name,r=e.localeCompare(n)),r})),u.sort(((e,t)=>e.link.linkType===a?-1:t.link.linkType===a?1:0)),e.is(l)&&(n=l.find((e=>e.instancePID===c.instancePID))),e.is(u)&&e.is(n)&&(d={nodeId:c.id,xPos:n.x,yPos:n.y,linkedObjectsInfo:[...u]},r.push(d),s.push(...u))))})),i.includes(t)||i===t?Ne=r:t===o&&(Le=r),s},re=function(){var t,n={},r={},a=[],s=0,l={},c={},d={},u=function t(n,i){var o=i;e.is(l[n])?o=l[n]:l[n]=o,e.is(d[n])&&d[n].forEach((function(n){e.is(l[n])||(t(n,o+1),c[n]=!1)})),0===o&&(c[n]=!0)},p=function i(o,a){for(t=l[o];e.is(n[t+","+Qe]);)Qe++;n[t+","+Qe]=o,r[o]={horizontal:t,vertical:Qe},e.is(d[o])&&d[o].forEach((function(t){e.is(r[t])||i(t,a.concat([t]))}))};D.forEach((function(t){e.is(d[t.fromNodeId])||(d[t.fromNodeId]=[]),d[t.fromNodeId].push(t.toNodeId)})),A.forEach((function(t){var i=t.xPos,o=t.yPos,l=t.id,c=i+","+o;e.is(i)&&e.is(o)&&(0===i&&0===o?(s++,e.is(n[c])?a.push(t):(n[c]=l,r[l]={vertical:i,horizontal:o})):(n[c]=l,r[l]={vertical:i,horizontal:o}))})),s===A.length&&(a=A,n={},r={}),a.forEach((function(e){u(e.id,0)})),(c=e.Object.keys(c).filter((function(e){return c[e]}))).forEach((function(e){p(e,[e]),Qe++})),A.forEach((function(e){var t,n,i;i=150*r[e.id].vertical,n=450*r[e.id].horizontal,t=j(e,n,i),_.addNode(t)})),xe&&(Ce(i),h(Ne)),Te&&(Ce(o),y(Le))},te=function(){return A.some((function(t){return-1===tt.indexOf(t.PPRType)&&tt.push(t.PPRType),e.is(t.parentId)}))?"HIERARCHY":$e},z=function(){if(!e.is(_)){_=B(),$=ke(_),T=te();try{ne()&&re(),oe(),me()}finally{_.updateUnlock()}M(),Y()}},se=function(t){var n,i,o,r,a,s={},l={},d=Z([t.fromNodeId,t.toNodeId]);2===e.Object.keys(d).length&&(e.is(t.startAnchorPos)&&e.is(t.endAnchorPos)?(o=t.startAnchorPos,r=t.endAnchorPos):""!==t.startAnchorSelectedId&&""!==t.endAnchorSelectedId?(o=t.startAnchorSelectedId,r=t.endAnchorSelectedId):e.is(d[t.fromNodeId].gr.edges.last)&&e.is(d[t.toNodeId].gr.edges.last)?(o=d[t.fromNodeId].gr.edges.last.cl1.c.id,r=d[t.toNodeId].gr.edges.last.cl2.c.id):(o=je,r=Ue),n=(a=u(t,o,!0)).connectorValue,s[We]=a.anchorPositionValue,i=(a=u(t,r,!1)).connectorValue,s[He]=a.anchorPositionValue,e.is(n)&&e.is(i)&&e.is(s)&&e.is(c,"function")&&(K(n,i,t),e.is(t.startAnchorPos)||e.is(t.endAnchorPos)||(l={anchorPositionValues:s,flowType:"Failed"===t.linkInfo.flowType?t.linkInfo.flowType:null},c(t.id,l,{refreshNodeLinks:!1})))),et=!1},le=function(t){var n,i,o;try{ne()&&(_.updateLock(),e.is(t.linkedObjectsInfo)?(i=t.yPos,o=t.xPos,qe=0,Ye=!0,t.linkedObjectsInfo.forEach((function(r,a){var s=i,l=v(a,o,r.PPRType);e.is(l)&&((n=j(r,s,l)).id+="##node_"+t.nodeId,_.addNode(n),w(n,r.PPRType,t.nodeId))}))):(n=j(t,0,150*Qe),Qe++,_.addNode(n)))}finally{_.updateUnlock()}},w=function(t,n,r){var a,s,l=Z([r])[r];i.includes(n)?(a=t.connectors.bottomRight,s=l.connectors.topRight):n===o&&(a=t.connectors.topRight,s=l.connectors.bottomRight),e.is(a)&&e.is(s)&&K(s,a,null)},ce=function(e){var t,n=Z([e]);for(t in n)n.hasOwnProperty(t)&&_.removeNode(n[t])},pe=function(t,n){var i=Z([t]);i=i[t],e.is(i)&&(i.model=e.extend(i.model,n),ue(i.model.tileInfo,i.view.elts.node))},ve=function(t){var n,r,a=Z([t]);for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(i.includes(a[n].model.PPRType)||a[n].model.PPRType===o?(r=ee([t]),e.is(r)&&r[n].length>0&&(Ze[n]=!0,Je=!0,r[n].forEach((function(e,t){Ke=t!==r[n].length-1,_.addToSelection(e)})))):(Ze[n]=!0,Je=!0,_.addToSelection(a[n])))},me=function(){A.forEach((function(e){e.preSelected&&ve(e.id)})),Je=!1},X=function(){var t,n,r,a=[];for(t=_.nodes.first;t;t=Se.dftNext(_,t))r=Math.round(t.left/450),n=Math.round(t.top/150),e.is(t.model)&&!i.includes(t.model.PPRType)&&t.model.PPRType!==o&&a.push({instancePID:t.model.instancePID,x:n,y:r});return a},P=function(){var t,n,r,a=[];for(t=_.nodes.first;t;t=Se.dftNext(_,t))r=t.left,n=t.top,e.is(t.model)&&!i.includes(t.model.PPRType)&&t.model.PPRType!==o&&a.push({instancePID:t.model.instancePID,x:n,y:r});return a},u=function(e,t,n){var i,o,r=Z([e.fromNodeId,e.toNodeId]);return t.includes("top_node")||t.includes(Ge)?(i=n?r[e.fromNodeId].connectors.top:r[e.toNodeId].connectors.top,o=Ge):t.includes("left_node")||t.includes(je)?(i=n?r[e.fromNodeId].connectors.left:r[e.toNodeId].connectors.left,o=je):t.includes("bottom_node")||t.includes(Be)?(i=n?r[e.fromNodeId].connectors.bottom:r[e.toNodeId].connectors.bottom,o=Be):(t.includes("right_node")||t.includes(Ue))&&(i=n?r[e.fromNodeId].connectors.right:r[e.toNodeId].connectors.right,o=Ue),{connectorValue:i,anchorPositionValue:o}},he=function(){var t,n,i,o,r,a,s="",l="",c="",d="";for(e.is(_.edges)&&(l=Pe()),e.is(x.options.displayInfoOnFlow)&&("Disp_Info_Description"===x.options.displayInfoOnFlow?c="description":"Disp_Info_ReasonCode"===x.options.displayInfoOnFlow&&(c="reasonCode")),t=_.edges.first;t;t=t.next)if(e.is(t)&&(i=Math.round(t.cl1.c.left),o=Math.round(t.cl1.c.top),r=Math.round(t.cl2.c.left),a=Math.round(t.cl2.c.top),e.is(t.mark))){if(e.is(t.mark.linkInfo)&&(n=e.is(t.mark.linkInfo.flowType)?t.mark.linkInfo.flowType:e.is(t.mark.linkInfo.isProductFlow)&&!1===t.mark.linkInfo.isProductFlow?"TimeConstraint":"Good",t.mark.linkInfo.hasOwnProperty(c)))if(e.is(t.mark.linkInfo[c])&&"NULL"!==t.mark.linkInfo[c]){d=t.mark.linkInfo[c],d=Re(d)}else d="";s+=ge(i,o,r,a,n,d)}return s=l+s},ye=function(){var t,n,i,o,r,a="";for(t=_.edges.first;t;t=t.next)e.is(t)&&(n=Math.round(t.cl1.c.left),i=Math.round(t.cl1.c.top),o=Math.round(t.cl2.c.left),r=Math.round(t.cl2.c.top),e.is(t.mark)||("linkedObject",a+=ge(n,i,o,r,"linkedObject","")));return a},Pe=function(){var e="#52957a",t="#cfc661",n="#bb7052",i="blue",o="#800080",r="#03e4d8";return`<defs>\n                <marker\n                id='Alternative'\n                orient="auto"\n                markerWidth='10'\n                markerHeight='8'\n                refX='10'\n                refY='4'\n                >\n                <path d='M 0 0 L 10 4 L 0 8' fill="${e}" stroke= "${e}"/>\n                </marker>\n            </defs>\n\n            <defs>\n                <marker\n                id='Scrapped'\n                orient="auto"\n                markerWidth='10'\n                markerHeight='8'\n                refX='10'\n                refY='4'\n                >\n                <path d='M 0 0 L 10 4 L 0 8' fill="${t}" stroke= "${t}"/>\n                </marker>\n            </defs>\n\n            <defs>\n                <marker\n                id='Failed'\n                orient="auto"\n                markerWidth='10'\n                markerHeight='8'\n                refX='10'\n                refY='4'\n                >\n                <path d='M 0 0 L 10 4 L 0 8' fill="${n}" stroke= "${n}"/>\n                </marker>\n            </defs>\n\n                <defs>\n                <marker\n                id='Good'\n                orient="auto"\n                markerWidth='10'\n                markerHeight='8'\n                refX='10'\n                refY='4'\n                >\n                <path d='M 0 0 L 10 4 L 0 8' fill="${i}" stroke= "${i}"/>\n                </marker>\n            </defs>\n\n            <defs>\n                <marker\n                id='QuantityDistribution'\n                orient="auto"\n                markerWidth='10'\n                markerHeight='8'\n                refX='10'\n                refY='4'\n                >\n                <path d='M 0 0 L 10 4 L 0 8' fill="${o}" stroke= "${o}"/>\n                </marker>\n            </defs>\n\n            <defs>\n                <marker\n                id='TimeConstraint'\n                orient="auto"\n                markerWidth='10'\n                markerHeight='8'\n                refX='10'\n                refY='4'\n                >\n                <path d='M 0 0 L 10 4 L 0 8' fill="${r}" stroke= "${r}"/>\n                </marker>\n            </defs>`},ge=function(e,t,n,i,o,r){var a;"Alternative"===o?a="#52957a":"Scrapped"===o?a="#cfc661":"Failed"===o?a="#bb7052":"Good"===o?(o="Good",a="blue"):"QuantityDistribution"===o?a="#800080":"linkedObject"===o?a="#b3b3b3":(o="TimeConstraint",a="#03e4d8");const s=`ID_${o}_${++nt}`;return`<path\n                id='${s}'\n                ${"linkedObject"!==o?`marker-end="url(#${o})"`:""}\n                stroke-width='3'\n                fill='${a}' stroke='${a}'\n                d='M${e},${t}, ${n} ,${i}'/>\n                <text>\n                <textPath xlink:href='#${s}' startOffset='50%' style='text-anchor:middle' alignment-baseline='text-after-edge'>${r}</textPath>\n                </text>`},Ie=function(e){var t,n=document.createElement("canvas");if(e.crossOrigin="use-credentials",n.width=e.width+15,n.height=e.height+15,t=n.getContext("2d"),0!==e.naturalWidth&&0!==e.naturalHeight)return t.drawImage(e,0,0),n.toDataURL("image/png")},be=function(t,n){var i="",o="";return e.is(t)&&(Array.isArray(t)?t:[t]).forEach((function(t){var r,a="";r=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name,e.is(n[r])&&(t.displayTitle&&(a=t.title+" : "),e.is(n[r],"object")?a+=n[r].nls:"NULL"!==n[r]?a+=n[r]:a+="",i+=a,""!==a&&(i+=" ")),""!==a&&(o+=a,o+="\n")})),{lineText:i,tooltipSVG:o}},De=function(t,n){var i;return e.is(n)&&(i=Ee(t,n)),i},Ae=function(t,n){var a=!0;return e.is(t.options)&&(a=(n!==r||!e.is(t.options.displayIcon)||"Disabled"!==t.options.displayIcon)&&!(i.includes(n)&&e.is(t.options.displayItemIcon)&&"Disabled"===t.options.displayItemIcon||n===o&&e.is(t.options.displayResourceIcon)&&"Disabled"===t.options.displayResourceIcon)),a},Re=function(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return e.replace(/[&<>"']/g,(e=>t[e]))},p=function(){var t,n;return _.updateLock(),f||(n=function(){Ve.HTMLNodeView.call(this)},Me.inherit(n,Ve.HTMLNodeView),(t=new Se.Node).views.main=new n,t.PID="page_aspect_ratio",t.id="node_"+t.PID,n.prototype.buildNodeElement=function(){var n=e.createElement("div");return n.addClassName("egraph_views_HTMLNodeView_Node "+t.id),n.setStyles({"pointer-events":"none","border-color":"black","border-style":"dashed","border-width":"medium","border-radius":"0",background:"0",position:"absolute"}),n},f=t),ze?ce(f.PID):_.addNode(f),ze=!ze,_.updateUnlock(),ze},m=function(){var e,t,n,i,o,r,a;if(ze){for(t=new Me.BoundingRect,e=_.nodes.first;e;e=Se.dftNext(_,e))"node_page_aspect_ratio"!==e.id&&t.update(e,e.actualLeft,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight);o=N/L,i=Math.abs(t.xmax-t.xmin),(n=Math.abs(t.ymax-t.ymin))>i?(r=n/o,t.xmin+r<t.xmax?n=i*o:i=r):(a=i*o,t.ymin+a<t.ymax?i=n/o:n=a),i+=40,n+=40,Number.isNaN(i)||Number.isNaN(n)||f.multiset("left",t.xmin-20,"top",t.ymin-20,"width",i,"height",n)}},g=function(e,t){isNaN(e)||isNaN(t)||(N=e,L=t,m())},E=function(t){var n,r,s,l,c,d=function(e,t){e=e.sort((function(e,n){var r;return e=e.model,n=n.model,i.includes(t)?(e=e.tileInfo.name.replace(/ *\([^)]*\) */g,""),r=(n=n.tileInfo.name.replace(/ *\([^)]*\) */g,"")).localeCompare(e)):t===o&&(e=e.tileInfo.name,n=n.tileInfo.name,r=e.localeCompare(n)),r}))};n=t.model.linkedObjectsInfo.map((e=>e.id)),e.is(n)&&(r=k(t.PID,n),e.is(r)&&r.length>0&&(s=r.filter((e=>i.includes(e.model.PPRType))),l=r.filter((e=>e.model.PPRType===o)),e.is(s)&&s.length>0&&(d(s,c=s[0].model.PPRType),s.forEach((function(n,i){var o=v(i,t.actualTop,c),r=t.actualLeft;e.is(o)&&e.is(r)&&(Xe=!0,n.multiset("left",r,"top",o))}))),e.is(l)&&l.length>0&&(d(l,o),l.sort(((e,t)=>e.model.link.linkType===a?-1:t.model.link.linkType===a?1:0)),l.forEach((function(n,i){var r=v(i,t.actualTop,o),a=t.actualLeft;e.is(r)&&e.is(a)&&(Xe=!0,n.multiset("left",a,"top",r))})))))},v=function(e,t,n){var r;return i.includes(n)?0===e?qe=r=t-50:r=qe-45*e:n===o&&(0===e?qe=r=t+105:r=qe+45*e),r},h=function(e){e.forEach((function(e){le(e)})),C||(Ye=!1)},y=function(e){e.forEach((function(e){le(e)})),C||(Ye=!1)},{init:function(){q()},inject:function(e){H.inject(e)},createGraphComponent:function(){z()},refreshNodeLinks:function(t,n){var i=e.is(n.anchorPositionValues)?n.anchorPositionValues:null,o=e.is(n.flowType)?n.flowType:null,r=ae(t);this.removeLink(t),r.forEach((function(t){e.is(i)&&(t.mark.startAnchorPos=i[We],t.mark.endAnchorPos=i[He]),e.is(o)&&(t.mark.linkInfo.flowType=o),se(t.mark)}))},destroy:function(){H.remove(),H.destroy(),H=void 0},addLink:function(e){se(e)},removeLink:function(e){ae(e).forEach((function(e){e.remove()}))},addNode:function(e){le(e)},removeNode:function(e){ce(e)},selectNode:function(e){ve(e)},generateSVGForGraph:function(){var t,n,a,s,l,c,d,u,p,f,m,g,h,y,P,I,b,w,v,k,E,N,L,C,T,A,D,R,S,V,F,M,O,$,G,B,U,j,W,H,z,Y,q,X,Q,J,K,Z,ee=-1,te="",ne=0,ie=0,oe=-50,re=-25,ae="",se="",le=[];for(z=document.createElementNS("http://www.w3.org/2000/svg","svg"),Y=document.createElementNS("http://www.w3.org/2000/svg","text"),z.setAttribute("style","fill-opacity:0;"),Y.setAttribute("id","svg_Text"),Y.setAttribute("font-size","10"),Y.setAttribute("font-weight","bold"),Y.setAttribute("font-family","Arial, sans-serif"),z.appendChild(Y),document.body.appendChild(z),q=document.getElementById("svg_Text"),X=_.view.vpt,e.is(X)&&X.length>0&&(Q=X[0],J=X[1],K=X[2]),t=_.nodes.first;t;t=Se.dftNext(_,t))if($="",V="",45,250,45,125,13,5,5,25,T=50,A=40,7,D=30,20,F="",M="",O="",S=[],"node_page_aspect_ratio"!==t.id){if(w=Math.round(t.left),v=Math.round(t.top),E=w,N=v,oe=w<oe?w:oe,re=v<re?v:re,ne=w>ne?w:ne,ie=v>ie?v:ie,ee++,L=t.model.id,s=t.model.tileInfo,l=t.model.PPRType,g=De(s,x.colors),y=e.is(g.headerBackgroundColor)?g.headerBackgroundColor:"#3d3d3d",P=e.is(g.headerTextColor)?g.headerTextColor:"#fff",I=e.is(g.tileBackgroundColor)?g.tileBackgroundColor:"#f1f1f1",b=e.is(g.tileTextColor)?g.tileTextColor:"black",r===l||"SYSTEM"===l)!0===(h=Ae(x,l))?(C=document.querySelectorAll(".my-node-type-img")[ee],e.is(C)&&(se=Ie(C),F=`<image x="${E+5}" y="${N+25}" width="75" height="75" style="image-rendering:optimizeQuality" xlink:href="${se}"/>`)):T=10,x.title&&(G=be(x.title,s),e.is(G.lineText)&&(k=G.lineText,W=Re(k),k.length>48&&(O="240")),e.is(G.tooltipSVG)&&($+=Re(G.tooltipSVG),$+="\n")),G="",x.subtitles&&x.subtitles.forEach((function(t){G=be(t,s),e.is(G.lineText)&&""!==(R=G.lineText)&&S.push(R),e.is(G.tooltipSVG)&&""!==G.tooltipSVG&&($+=Re(G.tooltipSVG),$+="\n")})),S.forEach((e=>{var t;M=e.length>40&&!0===h?"195":!1===h&&e.length>47?"235":"",t=Re(e),V+=""!==M?`<text x="${E+T}" y="${N+A}" text-anchor="start" font-family="sans-serif" font-weight="bold" font-size="10" fill="${b}" textLength="${M}" lengthAdjust="spacingAndGlyphs">${t}</text>`:`<text x="${E+T}" y="${N+A}" text-anchor="start" font-family="sans-serif" font-weight="bold" font-size="10" fill="${b}">${t}</text>`,S.length<=4?A+=15:A+=10})),B=`<g>\n                            <rect x="${E}" y="${N}" width="250" id="${L}" height="90" rx="3" ry="3" stroke="grey" stroke-width="1" fill="${I}" />\n                            <title>${$}</title>\n                            <rect x="${E}" y="${N}" width="250" id="${L}" height="20" rx="3" ry="3" fill="${y}" />`,j=`<circle cx="${E}" cy="${N+45}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                            <circle cx="${E+250}" cy="${N+45}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                            <circle cx="${E+125}" cy="${N}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                            <circle cx="${E+125}" cy="${N+90}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>`,U=""!==O?`<text x="${E+5}" y="${N+13}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${P}" textLength="${O}" lengthAdjust="spacingAndGlyphs">${W}</text>`:`<text x="${E+5}" y="${N+13}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${P}">${W}</text>`;else if(l===o||i.includes(l)){if(!0===(h=Ae(x,l))?(C=document.querySelectorAll(".my-node-type-img")[ee],e.is(C)&&(se=Ie(C),F=`<image x="${E+5}" y="${N+7}" width="25" height="20" style="image-rendering:optimizeQuality" xlink:href="${se}"/>`)):D-=25,e.is(s.name)){k=s.name;let t=(Z=k,e.is(q)&&(q.textContent=Z,H=q.getComputedTextLength()),H);W=Re(k),O=!0===h&&t+3>215?"215":!1===h&&t+3>235?"235":""}""!==W&&($+=W,U=""!==O?`<text x="${E+D}" y="${N+20}" text-anchor="start" font-family="Arial, sans-serif" font-weight="bold" font-size="10" fill="${b}" textLength="${O}" lengthAdjust="spacingAndGlyphs">${W}</text>`:`<text x="${E+D}" y="${N+20}" text-anchor="start" font-family="Arial, sans-serif" font-weight="bold" font-size="10" fill="${b}">${W}</text>`),B=`<g>\n                            <rect x="${E}" y="${N}" width="250" id="${L}" height="35" rx="3" ry="3" stroke="grey" stroke-width="1" fill="${I}" />\n                            <title>${$}</title>/>`}le.push([E,N,250,90]),te=te+(B+U+j+F+V)+"</g>"}else c=Math.round(t.left),u=Math.round(t.top),d=c+(f=Math.round(t.width))+20,p=u+(m=Math.round(t.height))+20,ae='preserveAspectRatio="xMinYMin" height="'+m+'" width="'+f+'"';const ce=function(e,t,n){const i=t,[o,r]=n;var a=[];e.forEach((([e,t,n,s])=>{[[e,t],[e+n,t],[e+n,t+s],[e,t+s]].forEach((([e,t])=>{const n=e*i+o,s=t*i+r;a.push([n,s])}))}));const s=a.map((e=>e[0])),l=a.map((e=>e[1]));let c=Math.min(...s)-15,d=Math.min(...l)-15;const u=Math.max(...s)+15-c,p=Math.max(...l)+15-d;return{minX:+c.toFixed(2),minY:+d.toFixed(2),width:+u.toFixed(2),height:+p.toFixed(2)}}(le,K,[Q,J]);return e.is(z)&&document.body.removeChild(z),-1===Math.sign(oe)&&(ne+=Math.abs(oe),oe+=-30),-1===Math.sign(re)&&(ie+=Math.abs(re),re+=-15),n=he(),a=ye(),te=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="${c||ce.minX.toFixed(2)} ${u-20||ce.minY.toFixed(2)} ${d||ce.width.toFixed(2)} ${p||ce.height.toFixed(2)}" ${ae}> <g transform = "translate(${Q}, ${J}) scale(${K})">`+a+te+n+"</g></svg>"},unselectNode:function(t){var n,r,a=Z([t]);for(n in a)a.hasOwnProperty(n)&&(i.includes(a[n].model.PPRType)||a[n].model.PPRType===o?(r=ee([t]),e.is(r)&&(a[n]=r[n].filter((e=>e.isSelected()&&Ze[n])),a[n].length>0&&(Ze[n]=!1,Je=!0,a[n].forEach((function(e,t){Ke=t!==a[n].length-1,_.removeFromSelection(e)}))))):a[n].isSelected()&&Ze[n]&&(Ze[n]=!1,Je=!0,_.removeFromSelection(a[n])))},updateNode:function(e,t){pe(e,t)},resizeTheGraph:function(){Y()},getCurentTilePosition:function(){return X()},getGraphDefaultToolbar:function(t){var n;return e.is(_)&&e.is($)&&(t=Array.isArray(t)?t:e.is(t)?[t]:[],n=$.generateToolbarModel(t)),n},togglePageAspectRatio:function(){return p()},updatePageAspectRatioValues:function(e,t){return g(e,t)},unlockEdgeCreation:function(){et=!1},displayLinkedItemsNodes:function(e){return h(e)},displayLinkedResourcesNodes:function(e){return y(e)},getTilesPositionWithoutOffset:function(){return P()}}}})),define("DS/DELPPWProductFlowSequenceModule/GraphPanel",["UWA/Core"],(function(e){"use strict";return function(t,n){var i,o,r,a,s,l,c=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext()),d=n.create("Element","div",{class:"EGraphView-panel-container"}),u=c.getImmersiveFrame(),p={};return i=function(){var e,t;o=n.create("Panel",{domId:r,identifier:"panel-EGraph"+r,position:{my:"center",at:"center"},title:a,immersiveFrame:u,content:d,minWidth:290,minHeight:250,width:700,height:400,snappableFlag:!1,resizableFlag:!0,closeButtonFlag:!0,useBordersFlag:!0,visibleFlag:!1,collapsibleFlag:!0,verticallyStretchableFlag:!0}),e=(window.screen.width-o.width)/2,t=(window.screen.height-o.height)/2,o.elements.container.style.left=e+"px",o.elements.container.style.top=t+"px",o.close=function(){s?s():o.hide()}},{init:function(t){p=e.extend(p,t),r=e.is(t.identifier)?t.identifier:"",a=e.is(t.title)?t.title:"",s=e.is(t.onClose,"function")?t.onClose:null,l=e.is(t.className)?t.className:""},destroy:function(){e.is(o)&&(o.destroy(),o=void 0)},show:function(){e.is(o)&&!1===o.visibleFlag&&o.show()},hide:function(){o.hide()},getContainer:function(){return d},buildSkeleton:function(){i(),d.addClassName(l)}}}})),define("DS/DELPPWProductFlowSequenceModule/ProductFlowSequenceModule",["UWA/Core","DS/DELPPWProductFlowSequenceModule/ProductFlowComponent","DS/DELPPWProductFlowSequenceModule/GraphPanel","text!DS/DELPPWProductFlowSequenceModule/assets/json/ProductFlowCustomParams.json"],(function(e,t,n,i){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","ResourceBehavior","SelectionBehavior","EditAttributeBehavior","LinkBehavior","ProductFlowLinkBehavior","RootsBehavior","DocumentBehavior","ProcessImplementBehavior"],creator:function(o,r,a,s,l,c,d,u,p,f,m){const g=["PROCESS","SERVICE","CONSTRUCTION"],h="RESOURCE",y=["SYSTEM","OPERATION"],P="process",I="item",b="resource",w="ProcessImplementLinkOcc",v="DELAssetsStructureLink";var k,E,N,L,C,x,T,A,D,R,S,V,F,M,O,_,$,G=["OPERATION","SYSTEM"],B=["DELAsmProcessCanUseCnx","DELAssetsStructureLink","ProcessImplementLinkOcc","ProcessImplementLink"],U=["ProcessImplementLinkOcc","ProcessImplementLink"],j=["DELAsmProcessCanUseCnx","DELAssetsStructureLink"],W="PPR-PERTVIEW",H=!1,z=!1,Y=!1,q=!1,X=!1,Q=!1,J=!0,K=!1,Z={},ee=!1,te={},ne=r.getComponent("Breadcrumb"),ie=r.getComponent("GeneratedToolbar"),oe=r.getComponent("ModalContainer"),re=r.getComponent("TooltipModel"),ae=r.create("WUXLoader",{showButtonFlag:!1}),se=e.createElement("div",{class:"pert-loading-cont"}),le=r.getComponent("WUXCommandsManager"),ce=u.getProductFlowRelationTypes(),de=function(t,n){var i,o;i=a.getParentInstancesFromCollection(t),e.is(i)&&i.length>0&&(o=i[0],n.unshift(o.id),e.is(o.get("isAggregatedBy"))&&de(o.get("isAggregatedBy"),n))},ue=function(e){var t=null;return y.includes(e)?t=P:g.includes(e)?t=I:h===e&&(t=b),t},pe=function(t,n,i,o){var r,s,l,c;e.is(n.colorParams)||(n.colorParams={}),s=t.name,c=a.getAttributeInfo(s),e.is(c)&&e.is(c.AuthorizedValues)&&"current"!==s?(e.is(o)&&(l=o.get(s)),e.is(l)||(l=i.get(s)),c.AuthorizedValues.forEach((function(e){e.NLS===l&&(l=e.Name)}))):l=function(t){var n;return"type"===t?e.is(i)&&e.is(o)&&(n=[i.get(t),o.get(t)]):(e.is(o)&&(n=t.includes("RelationType.")?o.get(t.replace("RelationType.","")):o.get(t),e.is(n,"string")&&"true"===n.toLowerCase()?n=!0:e.is(n,"string")&&"false"===n.toLowerCase()&&(n=!1)),e.is(n)||(e.is(i.get(t),"string")&&"true"===i.get(t).toLowerCase()?n=!0:e.is(i.get(t),"string")&&"false"===i.get(t).toLowerCase()&&(n=!1),n="NULL"!==n&&e.is(n)?n:i.get(t))),n}(s),r=l,n.colorParams[t.name]=e.is(r)?r:""},fe=function(){var t,n=new Map,i=!0;e.is(C)&&((t=C.getCurentTilePosition()).every((function(e){var t=e.x+","+e.y;return n.has(t)?(i=!1,o.warn(s.getNLSValue("ProductFlowLinkBehavior.TilePosition.Overlap")),!1):(n.set(t,!0),!0)})),i&&u.saveTilePositions(t))},me=function(e){var t,n;f.fetchDocuments(T,(function(i){t=i.map((function(e){return e.get("dataelements").title})),n=t.some((function(e,n){return t.indexOf(e)!==n})),e({isValid:n,values:t,documents:i})}))},ge=function(){var t;e.is(C)&&(t=C.generateSVGForGraph(),localStorage.setItem("app.MFNMGA.exportSVG_ODT",t));const n=new Blob([t],{type:'image/svg+xml;base64," + BinaryToBase64(ImageBinary)'}),i=new File([n],"Export_PFDView.svg",{type:'image/svg+xml;base64," + BinaryToBase64(ImageBinary)'});me((function(t){var n;if(t.isValid)o.warn(s.getNLSValue("ProductFlowView.MultipleDocIssue"));else if(-1!==(n=t.values.indexOf("Export_PFDView"))){let r=!0,l=a.getReferenceModel(T);if(e.is(l)&&!J){let e=a.getModelMaturity(l);"FROZEN"!==e&&"RELEASED"!==e||(r=!1)}r?f.modifyFile({id:t.documents[n].get("id")},{file:i,fileName:"Export_PFDView.svg"},"Export_PFDView"):o.warn(s.getNLSValue("ProductFlowView.DoNotCaptureSVG"))}else f.uploadDocument(T,{title:"Export_PFDView",policy:"Document Release",description:"",type:"Document",relInfo:{parentId:T,parentRelName:"Reference Document"}},[{comments:"",file:i}],(function(){var t,n;t="download",n=O,e.is(n)&&n.items.getChildren().forEach((function(e){e.options.id===t&&e.updateOptions({disabled:!1})}))}))}))},he=function(){me((function(e){var t;e.isValid?o.warn(s.getNLSValue("ProductFlowView.MultipleDocIssue")):-1!==(t=e.values.indexOf("Export_PFDView"))?f.downloadDocument(e.documents[t].get("id")):o.warn(s.getNLSValue("ProductFlowView.DocNotAvailableIssue"))}))},ye=function(){var t=[];if(e.is(C)&&e.is(V.pageAspectRatio)&&V.pageAspectRatio.length>0){let n,i=!1;e.is(sessionStorage.getItem(widget.id+"_pageAspectRatioLabel"))?(n=V.pageAspectRatio.find((e=>e.label===sessionStorage.getItem(widget.id+"_pageAspectRatioLabel"))),n=e.is(n)?n:V.pageAspectRatio[0]):n=V.pageAspectRatio[0],C.updatePageAspectRatioValues(n.height,n.width),i=C.togglePageAspectRatio(),sessionStorage.setItem(widget.id+"_isPageAspectRatioEnabled",i),t=V.pageAspectRatio.map((e=>e.label)),i?O.updateNodeModel("aspectRatioComboBox",{visibleFlag:!0,disabled:!1,possibleValues:t,grid:{data:n.label}}):O.updateNodeModel("aspectRatioComboBox",{visibleFlag:!1,disabled:!0})}},Pe=function(t){var n;e.is(V.pageAspectRatio)&&(n=V.pageAspectRatio.find((e=>e.label===t.getAttributeValue("data"))),e.is(C)&&e.is(n)&&(C.updatePageAspectRatioValues(n.height,n.width),sessionStorage.setItem(widget.id+"_pageAspectRatioLabel",n.label)))},Ie=function(t){var n,i=[],o=[],r=C.getTilesPositionWithoutOffset();if(e.is(N))return N.forEach((function(a){var s,l;e.is(a.linkedObjectsInfo)&&(l=a.linkedObjectsInfo.filter((function(e){return t.includes(e.PPRType)})),e.is(l)&&l.length>0&&(e.is(t,"array")&&(t=l[0].PPRType),l=l.sort((function(e,n){var i;return g.includes(t)?(e=e.tileInfo.name.replace(/ *\([^)]*\) */g,""),i=(n=n.tileInfo.name.replace(/ *\([^)]*\) */g,"")).localeCompare(e)):t===h&&(e=e.tileInfo.name,n=n.tileInfo.name,i=e.localeCompare(n)),i})),l.sort(((e,t)=>e.link.linkType===v?-1:t.link.linkType===v?1:0)),e.is(r)&&(n=r.find((e=>e.instancePID===a.instancePID))),e.is(l)&&e.is(n)&&(s={nodeId:a.id,xPos:n.x,yPos:n.y,linkedObjectsInfo:[...l]},i.push(s),o.push(...l))))})),g.includes(t)||g===t?_=i:t===h&&($=i),o},be=function(e){e.forEach((function(e){C.removeNode(e.id)}))},we=function(){var t=Ie(g);e.is(t)&&e.is(_)&&(_.map((e=>C.unselectNode(e.nodeId))),q?(be(t),q=!1):(be(t),C.displayLinkedItemsNodes(_),q=!0))},ve=function(){var t=Ie(h);e.is(t)&&e.is($)&&($.map((e=>C.unselectNode(e.nodeId))),X?(be(t),X=!1):(be(t),C.displayLinkedResourcesNodes($),X=!0))},ke=function(e,t){be(e),g.includes(t)?C.displayLinkedItemsNodes(_):t===h&&C.displayLinkedResourcesNodes($)},Ee=function(t){var n,i,o,r={entries:[]},a=e.is(t)?t:{},l="DELMGA_AP"===widget.getValue("appId")||"DELMGAS_AP"===widget.getValue("appId"),c="DELRME_AP"===widget.getValue("appId")||"DELRMEC_AP"===widget.getValue("appId"),d="DELSVR_AP"===widget.getValue("appId")||"DELSVRC_AP"===widget.getValue("appId"),u=!!e.is(localStorage.getItem("app.MFNMGA.customParams_ODT")),p=function(){return{id:"",dataElements:{typeRepresentation:"functionIcon",icon:{fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"2x",className:"action"},position:"far",category:"view"}}};We(),R=e.createElement("div",{class:"egraph-toobar"}),Le(x.id,x.path).inject(R),C&&((l||c||d||u)&&(r.entries.push(function(){let e=p();return e.id="displayLinkedItems",e.dataElements.icon.iconName="geometries-eye",e.dataElements.tooltip=new re({title:s.getNLSValue("GraphView.DisplayLinkedItems.Tooltip")}),e.dataElements.category="advancedTools",e.dataElements.value=we,e}()),r.entries.push(function(){let e=p();return e.id="displayLinkedResources",e.dataElements.icon.iconName="capable-resources-eye",e.dataElements.tooltip=new re({title:s.getNLSValue("GraphView.DisplayLinkedResources.Tooltip")}),e.dataElements.category="advancedTools",e.dataElements.value=ve,e}())),r.entries.push(function(){let e=p();return e.id="aspectRatioComboBox",e.dataElements.typeRepresentation="customEnumMember",e.dataElements.disabled=!0,e.dataElements.visibleFlag=!1,e.dataElements.category="advancedTools",e.onNodeUpdate=Pe,e}()),r.entries.push(function(){let t=p();return t.id="pageAspectRatio",t.dataElements.icon.iconName="group",t.dataElements.tooltip=new re({title:s.getNLSValue("GraphView.PageAspectRatio.Tooltip")}),t.dataElements.value=ye,t.dataElements.category="advancedTools",e.is(V)&&e.is(V.pageAspectRatio,"array")&&0!==V.pageAspectRatio.length||(t.dataElements.disabled=!0,t.dataElements.visibleFlag=!1),t}()),r.entries.push((i=C.getGraphDefaultToolbar({type:"ZoomFit",position:"far"}).entries[0],"zoomFit"===(o=e.clone(i)).id&&(o.dataElements.tooltip=new re({title:s.getNLSValue("GraphView.FitInAll.Tooltip")})),o)),r.entries.push(function(){let e=p();return e.id="refresh",e.dataElements.icon.iconName="refresh",e.dataElements.tooltip=new re({title:s.getNLSValue("GraphView.Refresh.Tooltip")}),e.dataElements.value=Ye,e}()),F||(r.entries.push(function(){let e=p();return e.id="screenshot",e.dataElements.tooltip=new re({title:s.getNLSValue("GraphView.Capture.Tooltip")}),e.dataElements.icon.iconName="camera",e.dataElements.value=ge,e}()),r.entries.push(function(){var e;e=(a.attachedDocuments||[]).map((function(e){return e.get("dataelements").title})).includes("Export_PFDView");let t=p();return t.id="download",t.dataElements.tooltip=new re({title:s.getNLSValue("GraphView.Download.Tooltip")}),t.dataElements.icon.iconName="download",t.dataElements.value=he,t.dataElements.disabled=!e,t}()),r.entries.push(function(){let e=p();return e.id="save",e.dataElements.icon.iconName="floppy",e.dataElements.tooltip=new re({title:s.getNLSValue("GraphView.SaveTilePosition.Tooltip")}),e.dataElements.value=fe,e}())),n=ie.prototype.createTreeDocument(r),(O=new ie({overflowManagement:"dropdown",direction:"horizontal",items:n})).elements.container.addClassName("graph-right-actions"),O.inject(R)),e.is(sessionStorage.getItem(widget.id+"_isPageAspectRatioEnabled"))&&"true"===sessionStorage.getItem(widget.id+"_isPageAspectRatioEnabled")&&ye(),R.inject(S,"top")},Ne=function(t){var n=t.model,i={objectId:n.referencePID};g.includes(n.PPRType)||n.PPRType===h||(e.is(M)&&(i.filterQuery=M),ee?(x.id=e.is(n.instancePID)?n.instancePID:n.referencePID,x.path=n.occcurancePath,Ye()):He(i).then((function(){x.id=e.is(n.instancePID)?n.instancePID:n.referencePID,x.path=n.occcurancePath,Ye()})))},Le=function(t,n){var i,r,l,c,d,u=e.createElement("div",{class:"egraph-navigator"}),p=[],f=function(e,t,n){l&&p.unshift({label:l.get("PLMEntity.V_Name"),icon:{iconPath:s.getIconURLFromKey(l.get("type")),iconSize:{width:"20px",height:"20px"}},id:t,path:n})};if(e.is(n,"string")&&(n=n.split(",")),0===n.length)f(0,(l=a.getReference(t)).get("PID"),[]);else for(d=n.length-1;d>=0;d--)c=n[d],l=a.getReferenceModel(c),f(0,c,n.slice(0,d+1)),0===d&&(r=a.getInstance(c),f(0,(l=a.getAggregatingReferenceModelFromInstance(r)).get("PID"),[]));return p.length>0&&(i=new ne({value:p,mode:ne.MODE.NAVIGATION})).addEventListener("selectionChange",(function(){var e;o.notify("EGraphNodeSelect",{selectedNodeIds:[x.id]}),z=!0,e=i.selectedValues[0],x=e,Ye()})),i.inject(u),u},Ce=function(){var t,n,i;return e.is(M)?t=M:e.is(x)&&(0===x.path.length?n=x.id:(i=a.getInstance(x.path[0]),n=(i=a.getReference(i.get("isAggregatedBy"))).get("PID")),n&&(t=p.getRootFilter(n),t=e.is(t)&&e.is(t.originalFilterQuery)?t.originalFilterQuery:void 0)),t},xe=function(t){var n,i,o,r,l=[],c={},d="",u=!!e.is(t.get("to"),"array"),f=u?t.get("to")[t.get("to").length-1]:t.get("to");if(n=a.getReferenceModel(f),e.is(n)){if(u&&!function(t,n){var i,o,r=a.getInstance(n);if(e.is(r)&&(i=a.getAggregatingReferenceModelFromInstance(r),e.is(i)))if(o=p.getRootFilter(i.id),e.is(o)&&e.is(o.originalFilterQuery)){if(o=o.originalFilterQuery,0===a.getFilteredInstancesFromCollection(t.id,o,{sort:!0}).length)return!1}else o=void 0;return!0}(n,f))return;return u&&g.includes(n.get("PPRTYPE"))&&(r=t.get("to"),i=o=f),(!u&&n.get("PPRTYPE")===h||g.includes(n.get("PPRTYPE")))&&(de(n.id,l),l.length>0?(r=l,i=o=l[l.length-1]):i=n.id),d=function(t,n,i){var o,r,l,c=[],d=a.getDisplayName(t),u=i.get("type");if(e.is(E)&&e.is(E[u])&&e.is(E[u].Attribute)){l=E[u].Attribute,l=e.is(l,"array")?l:[l];const t=E[u].separator||")(",a=s.getNLSValue("LinksUI.Link.JoinPattern");let p=!1,f=!1;for(o=0;o<l.length;o++)if(r=e.is(l[o].dicoType)?l[o].dicoType+"."+l[o].name:l[o].name,u!==w&&u!==w+"_inverse"||"PLMEntity.V_usage"!==r&&"ImplementLinkUsageFamily.V_Action"!==r){if(u!==w&&u!==w+"_inverse"||!r.contains("V_ContQuantity")&&!r.contains("V_UsageQuantityRatio"))if("DELAsmProcessCanUseCnx"===u&&"DELAsmProcessCanUseCnx.V_IsPreferred"===r){if("TRUE"!==i.get(r))return d;c.push("*")}else c.push(i[r]);else if(!p){let t=m.getQuantityInfoFromConnection(i.id);p=!0,e.is(t)?c.push(t):(t=m.getQuantityInfoFromModel(n),e.is(t)&&c.push(t))}}else if(!f){let e=m.getRoleFromModelOrComputed(i.id),t=m.getActionsFromConnection(i.id).map((function(e){return e.nlsText}));t.unshift(e.nlsText),c.push(t.join(a)),f=!0}d="("+c.join(t)+")"+d}return d}(n,o,t),c.id=i,c.instancePID=o,c.referencePID=n.id,c.occcurancePath=r,c.PPRType=n.get("PPRTYPE"),c.tileInfo={className:" EGraph_linkedObj_"+n.get("PPRTYPE"),name:d,nodeType:ue(n.get("PPRTYPE")),icon:{iconPath:s.getIconURLFromKey(n.get("type"))}},c.link={id:t.id,linkType:t.get("type")},e.is(V)&&e.is(V.colors)&&V.colors.colorParamsList.some((e=>e.nodeType===I||e.nodeType===b))&&V.colors.colorParamsList.forEach((function(t){var i;e.is(t.name)&&e.is(c.tileInfo.nodeType)&&t.nodeType===c.tileInfo.nodeType&&(i=a.getInstance(c.instancePID),pe(t,c.tileInfo,n,i))})),c}},Te=function(t,n){var i,o=[],r=[],s=[],l=n[n.length-1];if(e.is(t)&&r.push({id:t,path:n}),e.is(l)&&r.length>0&&(a.isNavigateOnDemand()?d.getRelations(r).then((function(){s=d.getImpactedConnections(l,!1,{relationTypes:B})})):s=d.getImpactedConnections(l,!1,{relationTypes:B})),s.length>0&&s.forEach((function(t){var r,a;e.is(t.get("from"),"array")?(r=n.length-t.get("from").length,a=n.slice(r),JSON.stringify(t.get("from"))===JSON.stringify(a)&&(i=xe(t),e.is(i)&&o.push(i))):(i=xe(t),e.is(i)&&o.push(i))})),o.length>0)return o},Ae=function(e){return void 0!==Z[e]?Z[e]:null},De=function(e,t){Z[e]=t},Re=function(t,n){var i={};return i.className=" EGraph_obj_"+t.get("PPRTYPE"),i.nodeType=ue(t.get("PPRTYPE")),i.icon={iconPath:s.getIconURLFromKey(t.get("type"))},[A.title].concat(A.subtitles).forEach((function(o){(Array.isArray(o)?o:[o]).forEach((function(o){var r,l,c,d,u,p,f,m,g;"SequenceNumber"===(l=e.is(o.dicoType)?o.dicoType+"."+o.name:o.name)?(e.is(n)&&(g=n.get("PID")),r=Ae(g)):(c=l,d=!0,m=a.getAttributeInfo(c),e.is(n)&&(u=c.includes("RelationType.")?n.get(c.replace("RelationType.","")):n.get(c)),"type"===c&&(u=t.get(c),d&&(u=s.getNLSValue(u))),!e.is(t.get(c),"string")||"true"!==t.get(c).toLowerCase()&&"false"!==t.get(c).toLowerCase()||(u=t.get(c).toLowerCase()),u="NULL"!==u&&e.is(u)?u:t.get(c),e.is(u)&&e.is(m)&&d&&(f=a.getMagnitude(m),e.is(f)&&""!==f&&([u,p]=u.split(" "),p=s.getNLSForUnit(f,p),e.is(p)&&""!==p&&(u=u+" "+p))),r=u),e.is(r)&&(i[l]=r)}))})),e.is(V)&&e.is(V.colors)&&V.colors.colorParamsList.some((e=>e.nodeType===P))&&V.colors.colorParamsList.forEach((function(o){e.is(o.name)&&e.is(i.nodeType)&&i.nodeType===o.nodeType&&pe(o,i,t,n)})),i},Se=function(t,n,i){var r,a,s=t.get("PPRTYPE");return r={id:i.toString(),PPRType:s,type:t.get("type"),instancePID:n.get("PID"),referencePID:t.get("PID"),occcurancePath:i,tileInfo:Re(t,n),linkedObjectsInfo:Te(t.id,i)},a="OPERATION"===s?"DELLmiOperationInstance.":"SYSTEM"===s?"DELLmiProductionSystemInstance.":"",e.is(n.get(a+"V_X2DPos"))&&e.is(n.get(a+"V_Y2DPos"))?(r.xPos=Number(n.get(a+"V_X2DPos")),r.yPos=Number(n.get(a+"V_Y2DPos"))):(r.xPos=0,r.yPos=0,o.debug(n.get("PID")+" V_X2DPos, V_Y2DPos are missing ")),r},Ve=function(t,n){var i,o,r,s,c,u,p,f,m,g=[],h={sort:!0},y=[],P=[],I=[];return c=function(e,t){return e.some((function(e){return e.id===t}))},u=function(e){return l.getSelectedInsts().findIndex((function(t){return t.get("isAggregatedBy")===r.get("PID")&&t.get("PID")===e}))>-1},p=function(t){var i=[],o=[];return t.forEach((function(t){var i,r,s,l,c;l=t.get("PID"),c=n.concat([l]),s=a.getReferenceModelFromInstance(t),e.is(s)&&G.indexOf(s.get("PPRTYPE"))>-1&&(i=u(l),g.push(l),(r=Se(s,t,c)).preSelected=i,o.push(r))})),a.getImpactedConnections(g,!1,{relationTypes:ce}).forEach((function(t){var n,r,a,s,l,u;o.every((function(i){return i.id.includes(t.get("from"))?n=i.id:i.id.includes(t.get("to"))&&(r=i.id),!(e.is(n)&&e.is(r))})),s=t.get("PID"),e.is(n)&&e.is(r)&&!c(i,s)&&(a=d.getLinkInfo(t),l=t.get("DELArrowDisplayExt.V_ArrowStartPosition"),u=t.get("DELArrowDisplayExt.V_ArrowEndPosition"),i.push({id:s,fromNodeId:n,toNodeId:r,linkType:t.get("type"),linkInfo:a,startAnchorPos:l,endAnchorPos:u}))})),{nodes:o,links:i}},r=a.getReferenceModel(t),ee?i=a.getInstancesFromCollection(r.get("PID"),h):(s=Ce(),i=s?a.getFilteredInstancesFromCollection(r.get("PID"),s,h):a.getInstancesFromCollection(r.get("PID"),h)),K&&(Z={},f=a.getSequenceNumber(n,r,{filterQuery:s}),De(r.get("PID"),f)),i.forEach((function(t,i){var o,r,s,l,c=t.get("PID");K&&De(c,""!==f?f+"."+(i+1):i+1),ee||(r=(o=n.concat([c]))[o.length-1],s=a.getReferenceModelFromInstance(t),l=d.getImpactedConnections(r,!1,{relationTypes:U}),e.is(s)&&G.indexOf(s.get("PPRTYPE"))>-1&&y.push({id:c}),e.is(l)&&!Q&&(I.push(...l.map((function(t){var n=null,i=[];return e.is(t.get("to"),"array")?n=t.get("to")[t.get("to").length-1]:"ProcessImplementLink"===t.get("type")?(de(t.get("to"),i),i.length>0&&(n=i[i.length-1])):n=t.get("to"),n}))),I=(I=[...new Set(I)]).filter((e=>null!==e))))})),ee?(o=p(i),Promise.resolve(o)):(P.push((m=I,new Promise((function(t,n){var i=function(){n()};e.is(m)&&0===m.length?t():e.is(m)?a.fetchInstancesAndTheirReferences(m,{onComplete:function(){Q=!0,t()},silentMode:"true",onFailure:i,onTimeout:i}):n()})))),P.push(function(t){return a.isNavigateOnDemand()?(t.push({id:x.id,path:x.path}),d.getRelations(t)):e.Promise.resolve()}(y)),Promise.allSettled(P).then((function(){return o=p(i)})))},Fe=function(t){var n="DisplayProperties",i=o.getAppContext();return{icon:"url("+s.getIconURLFromKey(n)+")",label:s.getNLSValue("Cmd.DisplayProperties.Title"),sensitivity:"enabled",callback:function(){var o=le.getCommandCheckHeader(n,i),r=a.getReferenceIdFromInstance(t.instancePID);e.is(o)&&!1===o.getState()&&(o.options.node={referencePID:r,instancePID:t.instancePID,absPath:t.occcurancePath},o.toggleState())}}},Me=function(e){return[{icon:"url("+s.getIconURLFromKey("GeneralDelete")+")",label:s.getNLSValue("LinksUI.DeleteLink"),sensitivity:"LinearProductFlowCnx"!==e.linkType?"enabled":"disabled",callback:function(){var t=d.getConnection(e.id);d.deleteConnection(t,{onFailure:function(){o.warn(s.getNLSValue("LinksUI.DeleteFailure"))},onComplete:function(){o.info(s.getNLSValue("LinksUI.DeleteSuccess"))},logMessage:s.getNLSValue("LinksUI.LogMessage")})}},{icon:"url("+s.getIconURLFromKey("EditAttribute")+")",label:s.getNLSValue("LinksUI.EditAttribute"),sensitivity:c.hasEditConfiguration(e.id)?"enabled":"disabled",callback:function(){c.editConfiguredAttributes(e.id)}},{icon:"url("+s.getIconURLFromKey("EditAnchorPositions")+")",label:s.getNLSValue("LinksUI.EditAnchorPositions"),sensitivity:"LinearProductFlowCnx"!==e.linkType?"enabled":"disabled",callback:function(){u.editAnchorPositions(e.id)}}]},Oe=function(t){var n=t.link,i=e.is(t.occcurancePath,"array")?t.occcurancePath.join(","):t.occcurancePath,r=o.getAppContext();return[{icon:"url("+s.getIconURLFromKey("GeneralDelete")+")",label:s.getNLSValue("LinksUI.DeleteLink"),sensitivity:B.includes(n.linkType)?"enabled":"disabled",callback:function(){var e=d.getConnection(n.id);d.deleteConnection(e,{onFailure:function(){o.warn(s.getNLSValue("LinksUI.DeleteFailure"))},onComplete:function(){o.info(s.getNLSValue("LinksUI.DeleteSuccess"))},logMessage:s.getNLSValue("LinksUI.LogMessage")})}},{icon:"url("+s.getIconURLFromKey("EditAttribute")+")",label:s.getNLSValue("LinksUI.EditAttribute"),sensitivity:c.hasEditConfiguration(n.id)?"enabled":"disabled",callback:function(){c.editConfiguredAttributes(n.id)}},{icon:"url("+s.getIconURLFromKey("DisplayProperties")+")",label:s.getNLSValue("Cmd.DisplayProperties.Title"),sensitivity:"enabled",callback:function(){var n=le.getCommandCheckHeader("DisplayProperties",r);e.is(n)&&!1===n.getState()&&(n.options.node={referencePID:t.id,instancePID:t.instancePID,absPath:i},n.toggleState())}}]},_e=function(t,n,i,r){var s={allowMove:!0},l=[];t&&(s.targetInstancePID=t.instancePID,s.targetInstancePIDsArray=t.occcurancePath,s.targetReferencePID=a.getReferenceIdFromInstance(t.instancePID),s.targetRootReferencePID=a.getInstance(t.occcurancePath[0]),s.targetRootReferencePID=e.is(s.rootReferencePID)?s.rootReferencePID.get("isAggregatedBy"):null,s.startAnchorId=i),n&&(s.instancePID=n.instancePID,s.instancePIDsArray=n.occcurancePath,s.referencePID=a.getReferenceIdFromInstance(n.instancePID),s.rootReferencePID=a.getInstance(n.occcurancePath[0]),s.rootReferencePID=e.is(s.targetRootReferencePID)?s.targetRootReferencePID.get("isAggregatedBy"):null,s.endAnchorId=r),"OPERATION"!==t.PPRType&&"SYSTEM"!==t.PPRType||"OPERATION"!==n.PPRType&&"SYSTEM"!==n.PPRType||(s.linkType=u.getProductFlowRelationTypeByTypes(t.type,n.type),s.isFromPERTView=!0,e.is(s.linkType)&&(s.unlockEdgeCreation=function(){C.unlockEdgeCreation()},l.push(s),o.notify("CreateLinkOrInstance",[l])))},$e=function(t,n){var i,r={};l.getSelections()[0].indexOf(x.id)>-1&&n.push(x.id),n.length>0&&(n=n.map((function(e){var t=e.split(",");return t[t.length-1]})),z=!0),r.selectedNodeIds=n,t&&(i=a.getReferenceIdFromInstance(t.instancePID),r.changed={nodeId:e.is(i)?i:t.id,childOccurencePath:e.is(t.occcurancePath)?t.occcurancePath:null,isSelected:!0},H=!0),o.notify("EGraphNodeSelect",r)},Ge=function(e,t,n){u.updateConnectionAttributes(e,t,n)},Be=function(){o.warn(s.getNLSValue("ProductFlowLinkBehavior.AnchorPosition.MultiplePositionChange"))},Ue=function(){e.is(D)&&Ze()},je=function(){e.is(C)&&(C.destroy(),C=void 0)},We=function(){e.is(R)&&(R.destroy(),R=void 0)},He=function(t){return t=t||{},new Promise((function(n){var i,o,r={};!!e.is(k.forceFetch)&&k.forceFetch&&e.is(t.objectId)?(i=t.objectId,o=function(){e.is(S)&&(ae.off(),oe.removeModal(se),se.remove()),n()},e.is(S)&&(se.inject(S),oe.createModal(se,ae.elements.container),ae.on()),e.is(k.expandLevel)&&(r.expandLevel=k.expandLevel),e.is(k.withLinks)&&(r.withLinks=k.withLinks),e.is(k.withLinksResolved)&&(r.withLinksResolved=k.withLinksResolved),e.is(k.relationTypes)&&(r.gridIDs=k.relationTypes),e.is(k.forceDBMode)&&(r.forceDBMode=k.forceDBMode),e.is(t.filterQuery)&&(r.filterQuery=t.filterQuery),a.getDescendantsFromServer([i],o,r)):n()}))},ze=function(){return Ve(x.id,x.path).then((function(e){N=e.nodes,L=e.links,T=a.isReference(x)?x.id:a.getReferenceIdFromInstance(x),je(),(C=new t(r,{nodes:N,links:L,readOnly:F,identifier:W,nodeOptions:A,displayLinkedItemsEnabled:q,displayLinkedResourcesEnabled:X,getNodeContextMenu:Fe,getLinkContextMenu:Me,getLinkedNodeContextMenu:Oe,onNodeDoubleClick:Ne,onConnectingNodes:_e,onNodeSelectionChange:$e,onUpdateConnectionAttributes:Ge,onMultiplePositionChangeAlert:Be})).init()}))},Ye=function(){return ze().then((function(){C.inject(S),C.createGraphComponent(),q&&(q=!1,we()),X&&(X=!1,ve()),f.fetchDocuments(T,(function(e){var t={};t.attachedDocuments=e||[],Ee(t)}))}))},qe=function(t,n,i){var o,r,s,l,c,u,p,f,m,y;Y||Array.isArray(t)||B.includes(t.get("type"))?Y||Array.isArray(t)||!B.includes(t.get("type"))||(u=e.is(t.get("from"),"array")?t.get("from")[t.get("from").length-1]:t.get("from"),p=a.isInstance(u)?N.find((e=>e.instancePID===u)):N.find((e=>e.referencePID===u)),e.is(p)&&(f=xe(t),p.linkedObjectsInfo.push(f),U.includes(t.get("type"))?(m=Ie(g),ke(m,m[0].PPRType)):j.includes(t.get("type"))&&(y=Ie(h),ke(y,h)))):(N.every((function(n){var i=t.get("from"),a=t.get("to");return i=Array.isArray(i)?i.join(","):i,a=Array.isArray(a)?a.join(","):a,n.id.includes(i)?o=n.id:n.id.includes(a)&&(r=n.id),!(e.is(o)&&e.is(r))})),e.is(o)&&e.is(r)&&(s=d.getLinkInfo(t),l=t.get("DELArrowDisplayExt.V_ArrowStartPosition"),c=t.get("DELArrowDisplayExt.V_ArrowEndPosition"),e.is(i.flowType)&&(s.flowType=i.flowType),C.addLink({fromNodeId:o,toNodeId:r,id:t.get("PID"),linkType:t.get("type"),linkInfo:s,startAnchorPos:l,endAnchorPos:c,startAnchorSelectedId:e.is(i.startAnchorId)?i.startAnchorId:"",endAnchorSelectedId:e.is(i.endAnchorId)?i.endAnchorId:""})))},Xe=function(t){(Array.isArray(t)?t:[t]).forEach((function(t){var n,i,o,r,s,l,c;C.removeLink(t.get("PID")),B.includes(t.get("type"))&&(i=e.is(t.get("from"),"array")?t.get("from")[t.get("from").length-1]:t.get("from"),o=e.is(t.get("to"),"array")?t.get("to")[t.get("to").length-1]:t.get("to"),r=a.isInstance(i)?N.find((e=>e.instancePID===i)):N.find((e=>e.referencePID===i)),e.is(r)&&(s=r.linkedObjectsInfo,e.is(s)&&-1!==(n=s.findIndex((e=>a.isInstance(o)?e.id===o:e.referencePID===o)))&&(C.removeNode(s[n].id),s.splice(n,1),U.includes(t.get("type"))?(l=Ie(g),ke(l,l[0].PPRType)):j.includes(t.get("type"))&&(c=Ie(h),ke(c,h)))))}))},Qe=function(t){var n,i,o,r,s,l,c=t.get("isInstanceOf"),d=t.get("PID"),u=a.getReferenceIdFromInstance(x.id);u||(u=x.id),t.get("isAggregatedBy")===u&&(a.isSystem(c)||a.isOperation(c))&&(n=a.getReference(c),K&&(l=Ce(),r=Ae(u),s=a.getTreeOrderPosition(u,d,{filterQuery:l}),De(d,r>0?r+"."+s:s)),i=x.path.concat([d]),o=Se(n,t,i),C.addNode(o),N.push(e.clone(o)))},Je=function(e){(Array.isArray(e)?e:[e]).forEach((function(e){var t=x.path.concat([e.get("PID")]).toString();C.removeNode(t)})),K&&Ye()},Ke=function(t){var n,i=t.changed,o=i.absPath.toString();""===o?o=i.nodeId:o.contains(",")&&(n=o.split(","),o=n[n.length-1]),e.is(C)&&(i.isSelected?(H||C.selectNode(o),H=!1):(z||C.unselectNode(o),z=!1))},Ze=function(){Ye()},et=function(e){C.refreshNodeLinks(e.linkPID,e)},tt=function(){},nt=function(){We(),je()},it=function(){Y=!0,je()},ot=function(t){(t=Array.isArray(t)?t:[t]).forEach((function(t){var n=Re(t);N.forEach((function(i,o){i.referencePID===t.get("PID")&&(N[o].tileInfo=e.clone(e.extend(N[o].tileInfo,n)),C.updateNode(N[o].id,N[o]))}))}))},rt=function(t){!e.is(x)||x.id!==t&&x.path[0]!==t||(Y=!Y&&Y,a.getDescendantsFromServer([t],(function(){e.is(R)||Ee(),Ye()}),{expandLevel:1,forceDBMode:!0}))},at=function(t){var i,a;t.showPanel&&(i=s.getNLSValue(t.titleGraph),(D=new n(o,r,s)).init({title:i,identifier:W,className:"PERTVIEW-panel-container",onClose:function(){e.is(t.toggleCmdId)?o.notify("toggleCmdCheckHeaderState",{cmdName:t.toggleCmdId,cmdState:!1}):D.hide()}}),S=D.getContainer(),a=l.getSelectionsWithPaths()[0][0],x={id:a.id,path:a.path},D.buildSkeleton(),D.show(),Ye())},st=function(t){var n;return t.displayAttributeName&&(t.displayTitle=!0,"type"===t.name?t.title=s.getNLSValue("Column.Type"):"SequenceNumber"===t.name?t.title=s.getNLSValue("Attribute.SequenceNumber"):(n=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name,t.title=s.getNLSValue(n))),t};return{name:"ProductFlowViewModule",listenTo:function(){return{select:Ke,connectionAdded:qe,connectionRemoved:Xe,instanceAdded:Qe,instanceRemoved:Je,refreshImpacted:Ze,ExpandFilterApplied:Ze,Hide:tt,HideAll:nt,refreshAll:it,refreshProductFlowView:Ue,addRootNode:rt,referenceChanged:ot,instanceChanged:Ue,refreshNodeLinks:et}},onStart:function(t,n){var o,r,s,l=[],c=function(t,n){return new Promise((o=>{a.webServiceGETRequest("resources/delmia/param/configuration/getAllParameters?domainID=DELUserExperience","GET",(function(t){var r="DisplayInformationOnFlowCombobox",a="DisplayIconCheckbox",s="DisplayIconforItemCheckbox",l="DisplayIconforResourceCheckbox",c="DELProcessFlowDiagramAttriutesListParam",d="DELProcessFlowDiagramColorListParam",u="DELProcessFlowDiagramAspectRatiosListParam";V={attributes:{displayInfoOnFlow:"",displayIcon:"",displayItemIcon:"",displayResourceIcon:"",attributeList:[]},colors:{colorParamsList:[]},pageAspectRatio:[]},te[P]||(te[P]=[]),te[b]||(te[b]=[]),te[I]||(te[I]=[]),e.is(localStorage.getItem("app.MFNMGA.customParams_ODT"))?V=e.Json.decode(i):e.is(t)&&t.length>0&&(t.forEach((function(t){switch(t.paramid){case r:V.attributes.displayInfoOnFlow=t.params.value;break;case a:V.attributes.displayIcon=t.params.value;break;case s:V.attributes.displayItemIcon=t.params.value;break;case l:V.attributes.displayResourceIcon=t.params.value;break;case c:e.is(t.params.attributeName)&&(te[P].push(t.params.attributeName),t.params.attributeName.contains("BusinessType.")&&(t.params.attributeName=t.params.attributeName.slice(t.params.attributeName.indexOf(".")+1))),V.attributes.attributeList.push({rowIndex:t.params.rowIndex?t.params.rowIndex:null,mergeWithPreviousRow:t.params.mergeWithPreviousRow?t.params.mergeWithPreviousRow:null,name:t.params.attributeName?t.params.attributeName:null,displayAttributeName:t.params.displayAttribute?t.params.displayAttribute:null,maxWidth:t.params.maxWidth?t.params.maxWidth:null});break;case d:e.is(t.params.attributeName)&&("DicoType"===t.params.attributeName&&(t.params.attributeName="type"),te[t.params.type].push(t.params.attributeName),t.params.attributeName.contains("BusinessType.")&&(t.params.attributeName=t.params.attributeName.slice(t.params.attributeName.indexOf(".")+1))),V.colors.colorParamsList.push({nodeType:t.params.type?t.params.type:null,graphicalElement:t.params.graphicalElement?t.params.graphicalElement:null,color:t.params.color?t.params.color:null,attributeValue:e.is(t.params.attributeValue)?t.params.attributeValue:null,ruleNumber:t.params.ruleNumber?t.params.ruleNumber:null,name:t.params.attributeName?t.params.attributeName:null,attributeCondition:t.params.attributeCondition?t.params.attributeCondition:null});break;case u:V.pageAspectRatio.push({label:t.params.aspectRatioName,width:t.params.aspectRatioWidth,height:t.params.aspectRatioHeight})}})),0===V.attributes.attributeList.length&&(V.attributes.attributeList=[{rowIndex:"1",mergeWithPreviousRow:null,name:"PLMEntity.V_Name",displayAttributeName:null,maxWidth:"90"},{rowIndex:"2",mergeWithPreviousRow:!0,name:"revision",displayAttributeName:null},{rowIndex:"3",mergeWithPreviousRow:null,name:"PLMInstance.PLM_ExternalID",displayAttributeName:null},{rowIndex:"4",mergeWithPreviousRow:null,name:"DELLmiOperationReference.V_EstimatedTime",displayAttributeName:!0}])),e.is(n,"function")&&n(),o()}),(function(){var n;e.is(t.displayNodeConfigXML)&&(n=d.getXMLValues(t.displayNodeConfigXML),e.is(n.Config.Preferences)&&e.is(n.Config.Preferences.Node)&&e.is(n.Config.Preferences.Node.Lines)&&e.is(n.Config.Preferences.Node.Lines.Line)&&n.Config.Preferences.Node.Lines.Line.forEach((function(e,t){var n=Array.isArray(e.Attribute)?e.Attribute:[e.Attribute];n=n.map(st),0===t?A.title=n:A.subtitles.push(n)}))),o()}))}))}(t,(function(){var t=0,n=[];A={title:[],subtitles:[],options:[],colors:[]},K=!1,e.is(V)&&e.is(V.attributes.attributeList)&&(V.attributes.attributeList.sort(((e,t)=>e.rowIndex-t.rowIndex)),V.attributes.attributeList.forEach((function(i){if(i=st(i),e.is(i.name)&&"SequenceNumber"===i.name&&(K=!0),1===parseInt(i.rowIndex)||0===t&&i.mergeWithPreviousRow)i.index=t,A.title.push(i);else if(i.mergeWithPreviousRow)i.index=t,n.push(i),parseInt(i.rowIndex)===V.attributes.attributeList.length&&A.subtitles.push(n);else{if(0!==t&&A.subtitles.push(n),parseInt(i.rowIndex)===V.attributes.attributeList.length)return void A.subtitles.push([i]);i.index=++t,n=[i]}})),te[I]=["PLMEntity.V_Name","PLMInstance.PLM_ExternalID"],te[b]=["PLMEntity.V_Name","PLMInstance.PLM_ExternalID","DELAsmProcessCanUseCnx.V_IsPreferred"],V.attributes.displayInfoOnFlow&&(A.options.displayInfoOnFlow=V.attributes.displayInfoOnFlow),V.attributes.displayIcon&&(A.options.displayIcon=V.attributes.displayIcon),V.attributes.displayItemIcon&&(A.options.displayItemIcon=V.attributes.displayItemIcon),V.attributes.displayResourceIcon&&(A.options.displayResourceIcon=V.attributes.displayResourceIcon)),e.is(V)&&e.is(V.colors.colorParamsList)&&(A.colors=V.colors.colorParamsList)})),u=new Promise((t=>{a.webServiceGETRequest("resources/delmia/param/configuration/getParameters?domainID=DigitalManufacturing&familyID=ProcessBehaviors&paramID=AllowPFDSVGUpdateForFrozenProcessCheckbox&argID=AllowPFDSVGUpdateForFrozenProcessArg","GET",(function(n){if(e.is(n)&&n.length>0){let e=n[0].value;J="Enabled"===e}t()}),(function(){J=!0,t()}))}));k=t=t||{},l.push(c),l.push(u),e.is(t.relationsDisplayAttributeConfigXML)&&(r=(o=d.getXMLValues(t.relationsDisplayAttributeConfigXML)).convert("DisplayAttributeDescriptionList.Type","name")||{},s=o.convert("DisplayAttributeDescriptionList.Relation","linkName")||{},E=e.merge(r,s)),Promise.all(l).then((()=>{at(t)})).catch((()=>{at(t)})).finally((()=>{n()}))},onStop:function(){e.is(C)&&(C.destroy(),C=void 0),e.is(D)&&(D.destroy(),D=void 0)},getAttributesToDisplay:function(){return te},createSequence:function(e){return He(e).then((function(){var t=e.objectId;return x={id:t,path:[]},M=e.filterQuery,ze()}))},createSequenceFrmJSON:function(t){var n,i,o=[],r=[],a=[];return ee=!0,q=!!e.is(t.displayLinkedItems)&&t.displayLinkedItems,X=!!e.is(t.displayLinkedResources)&&t.displayLinkedResources,e.is(t.objectId)&&(i=t.objectId),t.inputJSON.mfgProcessReferences.forEach((function(e){o.push(e)})),t.inputJSON.mfgProcessInstances.forEach((function(e){r.push(e)})),t.inputJSON.mfgResourceReferences.forEach((function(e){o.push(e)})),t.inputJSON.mfgResourceInstances.forEach((function(e){r.push(e)})),t.inputJSON.mfgItemReferences.forEach((function(e){o.push(e)})),t.inputJSON.mfgItemInstances.forEach((function(e){r.push(e)})),t.inputJSON.connections.forEach((function(e){a.push(e)})),new Promise((function(e,t){n={stackedReferences:o,stackedInstances:r,stackedConnections:a,silentMode:!0,onComplete:function(t){x={id:i,path:[]},e()},onFailure:function(){t()}},u.addToCollection(n)})).then((function(){return ze()}))},inject:function(e){S=e,C.inject(S),C.createGraphComponent(),Ee()},setReadOnly:function(e){F=e}}}}}));