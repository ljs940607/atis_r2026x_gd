define("DS/VCXWebExperienceLoader/VCXExperienceSaverBase",["UWA/Class","DS/VCXWebProperties/VCXPropertyServices","DS/WebRBTree/WebRBIterator"],(function(e,t,r){"use strict";return e.extend({init:function(){},_reformatObjectIDForPathOfId:function(e,t){var r,n=t.ComponentsMap.GetComponentFromID(e);n?t.getManager("VCXContextManager").getCat3DXIntegration()&&n.QueryInterface("CATI3DExperienceObject")?(r={}).pathOfIds=n.GetID().split(","):r=n.GetID():r="";return r},_MetaPropertiesDefToJson:function(e){var t=[],r=e.getManager("VCXMetaPropertyManager")._MetaPropertyDef;for(var n in r)if(r.hasOwnProperty(n)){var o=r[n],a=o.GetPropertyInfo(),i={name:n,type:o.GetType(),behavior:a.GetBehaviorType(),defaultLabel:o.GetDefaultLabel()};a.IsBounded()&&(i.bounds=a.GetBounds()),t.push(i)}return t},_PropertiesLinksToJson:function(e){var t=[];for(var r in e._links)if(e._links.hasOwnProperty(r)){var n=e._links[r];if(n)for(var o in n){var a=n[o];if(a)for(var i in a)if(a.hasOwnProperty(i)){var s=a[i];for(var l in s)if(s.hasOwnProperty(l)){var p={inID:r,inProp:o,outID:i,outProp:l};t.push(p)}}}}return t},_ComponentsMapToJson:function(e){var t=[],r=e.ComponentsMap.GetComponentTable();for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];if(0!==o.GetPersistency())continue;var a=o.GetType(),i={};i.objectID=n,i.objectType=a;var s=null;o.BuildLoadData&&(s=o.BuildLoadData()),s&&(i.objectData=s),t.push(i)}return t},_W3AISGNodeHolderToJson:function(e){var t=[],r=e.ComponentsMap.GetComponentTable();for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];if(2===o.GetPersistency())continue;var a={};a.objectID=n;var i=o.QueryInterface("W3AISGNodeHolder");if(i&&!i.isSelfManagedPathElement()){var s=o.QueryInterface("VCXIModelNavigable");if(s){var l=s.getAssetNavigable();if(l){var p=i.getRelativePathElement(l),f=this._BuildArrayIDsFromPathElement(p);a.PathElement=f,t.push(a)}}}}return t},_VCXIModelNavigableToJson:function(e){var t=[],r=e.ComponentsMap.GetComponentTable();for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];if(2===o.GetPersistency())continue;var a={};a.objectID=n;var i=o.QueryInterface("VCXIModelNavigable");if(i)if(i.isSelfOrganized()){var s=i.getWorkingRoot();s&&(a.WorkingRoot=s.GetObject().GetID(),t.push(a))}else{var l=i.getParent();l&&(a.NavigableParent=l.GetObject().GetID(),t.push(a))}}return t},_BuildArrayIDsFromPathElement:function(e){if(e){var t=[],r=e.externalPath;if(r)for(var n=0;n<r.length;n++){var o=r[n],a=o.persistentId,i=o.id;if(a)t.push(a.toString());else if(i)t.push(i.toString());else{var s=o.name;t.push(s)}}return t}},_NeutralsToJson:function(e,t){var r=[],n=e.getManager("VCXScenarioManager")._keyframer._Neutrals;const o=[];for(var a in n._map)if(n._map.hasOwnProperty(a)){var i=e.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(a);if(!i){console.log("WARNING this hashmodifiable does not exist : "+a);continue}var s=i.GetObject(),l=s.GetPersistency();if(2===l)continue;var p=n.GetPropertySet(a),f=null,c=s.QueryInterface("CATI3DExpVCXObjectConvertor");if(p&&c&&t){var u=p.Clone();c.UpdateVariablesFromNeutrals(u,t),f=this._PropSetToJson(u,e)}f||(f=this._PropSetToJson(p,e));let h=this._reformatObjectIDForPathOfId(s.GetID(),e);if(1!==l){let e={objectID:h,properties:f};r.push(e)}else f.forEach((e=>{"string"==typeof h&&(e.name="Singleton.Property."+h+"."+e.name),o.push(e)}))}return r.push({objectID:this._reformatObjectIDForPathOfId(e.getManager("VCXContextManager").getRootComponent().GetID(),e),properties:o}),r},_PropSetToJson:function(e,t){var r=[];for(var n in e._map)if(e._map.hasOwnProperty(n)){var o=e.GetProperty(n).GetPropertyValue(),a=o.GetType(),i=this._PropertyToJson(o,t);r.push({name:n,type:a,value:i})}return r},_PropMapToJson:function(e,t){var r={};for(var n in t._map)if(t._map.hasOwnProperty(n)){var o=t.GetPropertySet(n),a=e.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(n);if(!a){console.log("WARNING this hashmodifiable does not exist : "+n);continue}if(a){var i=a.GetObject().GetID(),s=this._PropSetToJson(o,e);r[i]=s}}return r},_PropertyToJson:function(e,r){return t.propertyValueToJson(e,(e=>this._reformatObjectIDForPathOfId(e,r)))},_ScenarioToJson:function(e,t){var r=[];t.GetListModifiables(r);const n=[];for(var o=[],a=0;a<r.length;a++){var i=r[a],s=e.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(i);if(!s){console.log("WARNING this hashmodifiable does not exist : "+i);continue}var l=s.GetObject().GetPersistency();if(2===l)continue;let p=t.GetObjectAnimation(i);if(1!==l){let t=this._TracksToJson(p,s,e);o.push(t)}else{let t=this._TracksToJson(p,s,e,s.GetObject().GetID());n.length?n[0].listTracks.push(...t.listTracks):n.push(t)}}return n.length&&o.push(...n),{name:t.GetName(),ID:t.GetID(),listMods:o}},_VisibilityToJson:function(e,t){for(var r=[],n=[],o=[],a=e.GetVisibles(),i=0;i<a.length;i++){var s=this._reformatObjectIDForPathOfId(a[i],t);r.push({objectID:s})}var l=e.GetInvisibles();for(i=0;i<l.length;i++){var p=this._reformatObjectIDForPathOfId(l[i],t);n.push({objectID:p})}var f=e.GetVisibleCollabs();for(i=0;i<f.length;i++){var c=this._reformatObjectIDForPathOfId(f[i],t);o.push({objectID:c})}return{listVisible:r,listInvisible:n,listVisibleCollabs:o}},_TracksToJson:function(e,t,r,n){var o=[];if(e){var a=[];e.GetListTrackNames(a);for(var i=0;i<a.length;i++){var s=a[i],l=e.GetTrack(s);n&&(s="Singleton.Property."+n+"."+s);var p=this._KeysToJson(l,s,r);o.push(p)}}let f;return f=n?r.getManager("VCXContextManager").getRootComponent():t.GetObject(),{objectID:this._reformatObjectIDForPathOfId(f.GetID(),r),listTracks:o}},_KeysToJson:function(e,t,n){for(var o="",a=[],i=e._treekeys,s=new r(i),l=s.next();null!==l;){var p=l.GetFrame(),f=l.GetValue();o||(o=f.GetType());var c=this._PropertyToJson(f,n);"VCXPropertyValueLink"==o&&""==c?console.log("warning VCXPropertyValueLink with no link is not saved"):a.push({time:p,value:c}),l=s.next()}return{name:t,type:o,listKeys:a}}})})),define("DS/VCXWebExperienceLoader/VCXExperienceLoaderBase",["UWA/Class","DS/VCXWebProperties/VCXPropertyServices","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebKernelCommands/VCXCmdChangeScenario","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebModifiables/VCXMetaPropertyDef","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdChangeSequence","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],(function(e,t,r,n,o,a,i,s,l,p,f,c,u){"use strict";return e.extend({InitLoader:function(e){this._experienceBase=e,e?(this._factory=e.Factory,this._scenarioManager=e.getManager("VCXScenarioManager"),this._ComponentsMap=e.ComponentsMap):console.log("VCXExperienceLoaderBase : experience base param missing!")},_reformatObjectIDForPathOfId:function(e){if(void 0===e)return e;if(e.pathOfIds){for(var t="",r=0;r<e.pathOfIds.length;r++)0!=r&&(t+=","),t+=e.pathOfIds[r];return t}return e},BuildVCXPropertyValue:function(e,r){return t.jsonToPropertyValue(e,r,this._reformatObjectIDForPathOfId)},BuildPathElementFromArray:function(e,t,r){function n(e,t){var n=null;if(r){if(n=e.getChildById(t))return n;var o;for(o=0;o<e.children.length;o++){if((n=e.children[o]).getPersistentId&&n.getPersistentId()===t)return n;if(n.id.toString()===t)return n}}return(n=e.getChildByName(t))||null}var o=t.QueryInterface("VCXIModelNavigable");if(o){var a=o.getAssetNavigable();if(a){var i=a.QueryInterface("W3AISGNodeHolder");if(i&&i.getPathElement()){var s,l=i.getPathElement().clone();for(s=0;s<e.length;s++){var p=n(l.getLastElement(),e[s]);p?l.addElement(p):console.error("BuildPathElementFromArray : CHILD NODE NOT FOUND !! ",e[s])}return l}}}return null},LoadScenarioSequences:function(e){for(var t=0;t<e.length;t++){var r=e[t].objectID,n=this._experienceBase.ComponentsMap.GetComponentFromID(r),o=new c(this._experienceBase);o._bIsLoading=!0,o.PushSequence(n),this._experienceBase.getManager("VCXCommandManager").Do(o);for(var a=e[t].listScenarioID,i=0;i<a.length;i++){var s=a[i],l=this._experienceBase.ComponentsMap.GetComponentFromID(s),p=new f(this._experienceBase);p._bIsLoading=!0,p.PushScenarioInSequence(l,n.GetID()),this._experienceBase.getManager("VCXCommandManager").Do(p)}}},LoadComponents:function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t].objectID,n=e[t].objectType;"VCXComponentVPMReference"===n&&(n="Model_VPMReference_Spec",console.warn("The type VCXComponentVPMReference is deprecated. Please resave the json."));var o=this._factory.BuildComponent(n);if(o){o.SetID(r),this._ComponentsMap.AddComponent(o);var a=e[t].objectData;a&&o.SetLoadData(a)}}},LoadW3AISGNodeHolder:function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t].objectID,n=this._reformatObjectIDForPathOfId(r),o=this._ComponentsMap.GetComponentFromID(n);if(o){var a=o.QueryInterface("W3AISGNodeHolder");if(a){var i=e[t].PathElement;if(i){for(var s=[],l=0;l<i.length;l++)s[l]=i[l];var p=this.BuildPathElementFromArray(s,o,1);if(p){if(p.getLastElement()&&p.getLastElement().children&&p.getLastElement()&&1===p.getLastElement().children.length){const e=p.getLastElement().children[0];e.productType&&e.productType.contains("Reference")&&p.addElement(p.getLastElement().children[0])}a.setPathElement(p)}}}}}},LoadVCXIModelNavigable:function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t].objectID,n=this._reformatObjectIDForPathOfId(r),o=this._ComponentsMap.GetComponentFromID(n);if(o){var a=o.QueryInterface("VCXIModelNavigable");if(a){var i=e[t].NavigableParent;if(i){var s=this._ComponentsMap.GetComponentFromID(i);if(s){var l=s.QueryInterface("VCXIModelNavigable");l&&a.setParent(l)}}else{var p=e[t].WorkingRoot;if(p){var f=this._ComponentsMap.GetComponentFromID(p);if(f){var c=f.QueryInterface("VCXIModelNavigable");c&&a.setWorkingRoot(c)}}}}}}},LoadMetaPropertiesDef:function(e){if(e)for(var t=this._experienceBase.getManager("VCXMetaPropertyManager"),r=0;r<e.length;r++){var n=e[r],o=new a(n.name,n.behavior,!0);n.bounds&&("VCXPropertyValueFloat"===n.type?o.SetBounds(parseFloat(n.bounds.valueMin),parseFloat(n.bounds.valueMax),parseFloat(n.bounds.step)):"VCXPropertyValueFloat"===n.type&&o.SetBounds(parseInt(n.bounds.valueMin),parseInt(n.bounds.valueMax),parseInt(n.bounds.step)));var i=new p(o,n.type);o.SetGroupId("Group.UserProperties"),o.Seti18nGroup(u),o.SetMetaPropertyDef(i),i.SetDefaultLabel(n.defaultLabel),t.AddMetaPropertyDef(i)}},LoadPropertiesLinks:function(e){if(e)for(var t=this._experienceBase.getManager("VCXLinkedPropertyManager"),r=0;r<e.length;r++)t.AddLink(e[r].inID,e[r].inProp,e[r].outID,e[r].outProp,null)},LoadNeutrals:function(e){const t=this._experienceBase.getManager("VCXContextManager").getRootComponent().GetID();for(var r=new l(this._experienceBase),n=0;n<e.length;n++){var o=e[n],a=this._reformatObjectIDForPathOfId(o.objectID),i=this._ComponentsMap.GetComponentFromID(a);if(i){var s=i.QueryInterface("VCXIModifiable");if(s){var p=o.properties;for(let e=0;e<p.length;e++){const n=p[e];let o=s;if(t===i.GetID()&&n.name.startsWith("Singleton.Property.")){const e=n.name.substring(19),t=e.indexOf("."),r=e.substring(0,t);let a=this._ComponentsMap.GetComponentFromID(r);if(o=a&&a.QueryInterface("VCXIModifiable"),!o)continue;n.name=e.substring(t+1)}const a=n.type,l=n.value,f=this.BuildVCXPropertyValue(a,l);f&&r.ChangeProperty(o,n.name,f)}}}else console.log("ERROR : component not found : "+a+"\n")}this._experienceBase.getManager("VCXCommandManager").Do(r)},LoadPropSet:function(e,t){for(var n=new r,i=0;i<e.length;i++){var s=e[i],l=this.BuildVCXPropertyValue(s.type,s.value);let r=null;r=t&&t.GetProperty(s.name)?t.GetProperty(s.name).GetPropertyInfo():new a(s.name);var p=new o(r,l);n.AddOrModifyProperty(p)}return n},LoadPropMap:function(e){var t=new n;for(var r in e)if(e.hasOwnProperty(r)){var o=this._ComponentsMap.GetComponentFromID(r);if(o){let n=o.QueryInterface("VCXIModifiable");var a=n.GetHashing(),i=e[r],s=this.LoadPropSet(i,n);t.AddOrModifyPropertySet(a,s)}else console.log("ERROR : LoadPropMap: component not found : "+r+"\n")}return t},LoadScenarios:function(e){const t=this._experienceBase.getManager("VCXContextManager").getRootComponent().GetID();for(var r=0;r<e.length;r++){var n=e[r],o=this._ComponentsMap.GetComponentFromID(n.ID);if(o){var a=new i(this._experienceBase);a.AddScenarios(o),this._experienceBase.getManager("VCXCommandManager").Do(a),o.SetName(n.name);for(var l=new s(this._experienceBase),p=n.listMods,f=0;f<p.length;f++){var c=p[f],u=this._reformatObjectIDForPathOfId(c.objectID);if(!(_=this._ComponentsMap.GetComponentFromID(u))){console.log("ERROR : LoadScenarios: component not found : "+u+"\n");continue}let e=_.QueryInterface("VCXIModifiable");if(e)for(var h=c.listTracks,d=0;d<h.length;d++){var m=h[d];let r=m.name,n=e;if(t===_.GetID()&&r.startsWith("Singleton.Property.")){const e=r.substring(19),t=e.indexOf("."),o=e.substring(0,t);let a=this._ComponentsMap.GetComponentFromID(o);if(n=a&&a.QueryInterface("VCXIModifiable"),!n)continue;r=e.substring(t+1)}var C=m.listKeys;if(C)for(var g=0;g<C.length;g++){var v=C[g],I=v.easing,b=v.value,D=this.BuildVCXPropertyValue(m.type,b);D&&l.ChangeKey(o,n,r,parseFloat(v.time),D,I)}}}this._experienceBase.getManager("VCXCommandManager").Do(l);var P=n.visibility;if(P){var y=P.listVisible;if(y)for(var M=0;M<y.length;M++){c=y[M],u=this._reformatObjectIDForPathOfId(c.objectID);(_=this._ComponentsMap.GetComponentFromID(u))&&o.GetVisibility().AddVisible(_)}var V=P.listInvisible;if(V)for(M=0;M<V.length;M++){c=V[M],u=this._reformatObjectIDForPathOfId(c.objectID);(_=this._ComponentsMap.GetComponentFromID(u))&&o.GetVisibility().AddInvisible(_)}var S=P.listVisibleCollabs;if(S)for(M=0;M<S.length;M++){var _;c=S[M],u=this._reformatObjectIDForPathOfId(c.objectID);(_=this._ComponentsMap.GetComponentFromID(u))&&o.GetVisibility().AddVisibleCollab(_)}}}else console.log("ERROR : LoadScenarios: scenario component not found : "+n.ID+"\n")}}})})),define("DS/VCXWebExperienceLoader/CATE3DXJSONProcessorExpTrackManager_Spec",["UWA/Class","DS/VCXWebExperienceLoader/VCXExperienceLoaderBase","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebProperties/VCXPropertyValueString"],(function(e,t,r,n){"use strict";return e.extend({init:function(){},Process:function(){var e=new t;e.InitLoader(this._object._experienceBase);var o=this.QueryInterface("CATI3DXAssetHolder")._getCache(),a=this._object._experienceBase.getManager("VCXScenarioManager");a.SetCurrentFrame(0),a.SetDefaultInterpolator("Actor.Hyperlink",0),a.SetDefaultInterpolator("Collab.Image.Doc.ID",0),e.LoadComponents(o.VCXObjects),e.LoadNeutrals(o.neutrals);for(var i=new r(this._object._experienceBase),s=0;s<o.ScenarioSequences.length;s++){var l=o.ScenarioSequences[s].objectID,p=this._object._experienceBase.ComponentsMap.GetComponentFromID(l).QueryInterface("VCXIModifiable"),f=o.ScenarioSequences[s].name,c=new n;c.SetValue(f),i.ChangeProperty(p,"Actor.Name",c)}var u=this._object._experienceBase.getManager("VCXCommandManager");for(var h in u.Do(i),e.LoadScenarios(o.listScenarios),a.GetScenarios()){if(a.GetScenarios().hasOwnProperty(h))a.GetScenarios()[h].SetEMSDirty(!1)}e.LoadScenarioSequences(o.ScenarioSequences)}})}));