define("DS/VCXWebPlatform/VCX3DSwymmServices",["require","exports","DS/SwymPublishForm/script/publish-form-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/UIKIT/Modal"],(function(e,t,r,s,n){"use strict";return class{static async get3DSwymmData(e){return this.publish3DSwymm({...e,customUpload:!0,returnJson:!0})}static async publish3DSwymm(e){return new Promise(((t,a)=>{let i={modal:null,publishForm:null},o=()=>{i&&(i.publishForm&&(i.publishForm.destroy(),i.publishForm=null),i.modal&&(i.modal.destroy(),i.modal=null))};i.publishForm=new r({title:e.strMediaFileName,contentTitle:e.titre,description:e.description,contentDescription:e.contentDescription,platformId:widget.getValue("x3dPlatformId"),mode:e.customUpload?"jsevent":"automatic",base64image:e.mediaURL,base64imageExtension:e.extension,onCancel:()=>{t(!1),o()},onContentCreated:()=>{t(!0),o()}}),e.customUpload&&i.publishForm.addEvents({StartUpload:r=>{var n=JSON.parse(r);console.log("Swym > Media > Start upload");var c=i.publishForm.getControl("titleInput")?i.publishForm.getControl("titleInput").getValue():"Published from xHighlight",l=i.publishForm.getControl("descriptionInput")?i.publishForm.getControl("descriptionInput").getValue():"";if(e.returnJson)return n.title=c,n.description=l,n.is_illustration="media"!==n.contentType||1!=i.publishForm._media_is_illustration,o(),void t(n);new s({},{urlRoot:n.platform_instance}).save({title:c,description:l,published:!0,community_id:n.community_id,userFile:new File([e.mediaBlob],e.strMediaFileName,{type:e.mediaBlob.type,lastModified:Date.now()}),fileName:e.strMediaFileName,is_illustration:!1},{onComplete:e=>{console.log("Swym > Media > Upload is successfull"),i.publishForm.createContent(e.get("mid"))},onFailure:()=>{console.log("Swym > Media > Upload failed"),o(),a()}})},ContentCreated:()=>{console.log("Swym > Media > Content creation successfull"),o(),t(!0)},CancelShare:()=>{o(),t(!1)}}),i.modal=new n({closable:!0,header:e.header,body:i.publishForm.render("publish_to_sywm_wrapper_id"),className:"swymm-modal"}),i.modal.elements.header&&i.modal.elements.header.getElements(".close")[0].addEvent("click",(()=>{o(),t(!1)})),i.modal.inject(document.body),i.modal.show()}))}}})),define("DS/VCXWebPlatform/VCXSearchServices",["require","exports","UWA/Utils/InterCom"],(function(e,t,r){"use strict";return class{static async SearchInApp(e,t,s){return new Promise(((n,a)=>{try{var i="vcx-3DSearch-InterCom",o="SearchComServer",c=new r.Socket(i),l={title:t,mode:"furtive",widget_id:widget.id,app_socket_id:i,default_with_precond:!0,show_precond:!1,multiSel:s,precond:e,tenant:widget.getValue("x3dPlatformId")};void 0===s&&(s=!1),c.subscribeServer(o),c.addListener("Selected_Objects_search",(e=>{c.dispatchEvent("UnregisterContext",l),c.unsubscribeServer(o),n(s?e.map((e=>({id:e.id,label:e["ds6w:label"]}))):{id:e[0].id,label:e[0]["ds6w:label"]})})),c.addListener("onCloseTransient",(()=>{c.dispatchEvent("UnregisterContext",l),c.unsubscribeServer(o),n(null)})),c.dispatchEvent("RegisterContext",l),c.dispatchEvent("InContextSearch",l)}catch(e){a(e)}}))}}})),define("DS/VCXWebPlatform/VCXPlatformServices",["require","exports","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","UWA/Core"],(function(e,t,r,s,n,a){"use strict";class i{static async getPlatformServices(e){return new Promise(((t,s)=>r.getPlatformServices({platformId:e,onComplete:function(e){t(e)},onFailure:function(e){s(new Error(e))}})))}static async listPlatformsIds(){return new Promise(((e,t)=>r.getServiceUrl({serviceName:"3DSpace",onComplete:function(t){e(t.map((function(e){return e.platformId})))},onFailure:function(e){t(new Error(e))}})))}static async getServiceUrl(e,t){return new Promise(((s,n)=>r.getServiceUrl({serviceName:e,platformId:t,onComplete:function(e){s(e)},onFailure:function(e){n(new Error(e))}})))}static async get3DSpaceURL(e){return this.getServiceUrl("3DSpace",e)}static async listSecurityContextInfos(e,t){return new Promise(((r,n)=>s.authenticatedRequest(e+"/resources/modeler/pno/person?current=true&select=collabspaces&select=preferredcredentials&tenant="+t,{method:"GET",type:"json",onComplete:function(e){r(e)},onFailure:function(e){n(new Error(e))}})))}static async extractCollabSpaceFromProduct(e,t){var r=e+"/resources/v1/modeler/documents/"+t;return new Promise(((e,t)=>{s.authenticatedRequest(r,{method:"GET",type:"json",onComplete:r=>{r&&r.data?e(r.data[0].dataelements.collabspace):t(new Error("Bad data format"))},onFailure:e=>{t(new Error(e))}})}))}static async GetTenantId(){let e=widget.getValue("x3dPlatformId");if(e)return e;let t=await this.listPlatformsIds();if(1===t.length)return widget.setValue("x3dPlatformId",t[0]),t[0];var r=new Error("Multi-tenant: unable to get the tenant, widget.getValue('x3dPlatformId') is undefined.");throw console.error(r),r}static isSSLConnexion(){return!0}static async CheckTenant(e){if(!e)throw new Error("Items missing");let t=await this.GetTenantId();if(t&&t===e.envId)return t;{let e=new Error("Multi-tenant : the tenant of the app & the collabspace are different (content cannot be opened)");throw e.criticity="Warning",e}}static async getObjectInfo(e,t){var r=t+"/resources/v2/e6w/service/ObjectInfo/"+e;return new Promise(((e,t)=>{try{s.authenticatedRequest(r,{method:"GET",type:"json",onComplete:r=>{r&&r.data?e(r.data[0]):t(new Error("Bad data format"))},onFailure:e=>{t(new Error(e))}})}catch(e){t(e)}}))}static async retrieveTransientToken(e){let t=await this.GetTenantId();return new Promise((function(r,a){var i=n.getApplicationConfiguration("app.urls.passport")+"/api/authenticated/cas/transient?service=";i+=encodeURIComponent("https://"+e.serviceUrl),i+="&tenant="+encodeURIComponent(t.trim()),s.authenticatedRequest(i,{method:"GET",type:"json",onComplete:function(t){r({...t,x3ds_service_url:e.serviceUrl})},onFailure:a})}))}static async retrieveLoginTicket(e,t){let r=await this.GetTenantId();var n=t+"/ticket/get?";n+="runasctx="+encodeURIComponent(e.context?e.context.trim():"preferred");var a=t;return a+="/resources/modeler/pno/person?current=true&select=preferredcredentials",n+="&tenant="+encodeURIComponent(r.trim()),a+="&tenant="+encodeURIComponent(r.trim()),new Promise((function(e,t){s.authenticatedRequest(a,{method:"GET",type:"json",proxy:"passport",onComplete:function(){s.authenticatedRequest(n,{headers:{Accept:"application/json","Accept-Language":null},method:"GET",type:"json",proxy:"passport",onComplete:function(t){e(t.ticket)},onFailure:function(e){t("Failed to retrieve login ticket "+e)}})}})}))}static async getSessionId(){const e=this.getUser(),t=await this.GetTenantId();return e.login+"_"+t}static getUser(){return this._cachedUser||(this._cachedUser=n.getUser()),this._cachedUser}static async _buildRequestData(e){const t=i.getUser(),r=null!=t&&void 0!==t.login?t.login:"";return{label:e.label||"3DSearch-"+r+"-"+(new Date).getTime(),locale:"en",order_field:e.order_field?e.order_field:"relevance",order_by:e.order_by?e.order_by:"desc",select_file:a.is(e.select_file,"array")?e.select_file:[],select_synthesis:e.select_synthesis?e.select_synthesis:e.select_predicate,select_predicate:e.select_predicate?e.select_predicate:["ds6w:label"],refine:e.refine,nresults:e.nresults||10,start:0,tenant:await i.GetTenantId(),query:e.query,source:e.source,specific_source_parameter:e.specific_source_parameter}}static _getQueryFromIds(e){e=Array.isArray(e)?e:[e];let t="";for(let r=0;r<e.length;r++)e[r]&&(0===r?t+="(physicalid:"+e[r]:(t+=" OR ",t+="physicalid:"+e[r]));return t+=")",t}static async getExperienceInfosByPhysicalIds(e,t){var r=t+i.WSInformation.search.url;const n=await i._buildRequestData({select_file:["icon","thumbnail_2d"],select_predicate:["ds6w:label","ds6w:type","type_icon_url","preview_url","name","ds6w:where/ds6w:context/ds6w:project","resourceid","physicalid","ds6wg:revision"],nresults:1e3,order_field:"ds6w:modified",query:i._getQueryFromIds(e)});return new Promise((e=>{const t={method:i.WSInformation.search.verb,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(n),type:"json",onComplete:t=>{try{let r={};t&&t.results&&t.results.forEach((e=>{let t={};if(e.attributes&&e.attributes.length>0)try{const r=new Map;e.attributes.map((e=>{r.set(e.name,e.value)})),t={thumbnail:r.get("preview_url")||"",label:r.get("ds6w:label")||"",experienceId:r.get("resourceid")||"",experienceName:r.get("name")||r.get("ds6w:label")||"",experienceRevision:r.get("ds6wg:revision")||"",experienceCollabSpace:r.get("ds6w:where/ds6w:context/ds6w:project"),experienceType:r.get("ds6w:what/ds6w:type")}}catch(e){}t.experienceId&&(r[t.experienceId]=t)})),e(r)}catch(r){console.error(t),e(null)}},onFailure:t=>{console.error(t),e(null)},onTimeout:t=>{console.error(t),e(null)},timeout:6e4};s.authenticatedRequest(r,t)}))}static xmqlFetchToArray(e){const t=[],r="fetch: ";let s,n,a,i=t,o=[t],c=null;if(e&&e.startsWith(r)){s=e.substring(7);for(let e=0;e<s.length;e++)switch(n=s[e],n){case"\n":case"\t":case"\r":break;case"{":c=null,a=[],i.push(a),o.push(a),i=a;break;case"}":null!==c&&(0===i.length&&i.push(c),c=null),o.pop(),i=o[o.length-1]||null;break;default:null===c?c=n:c+=n}if(1!==o.length)return null}return t}static async runRequest(e){const t=await this.GetTenantId();let r;r=e.wsArguments?e.wsInformation.url.replace(/\{(\w+)\}/g,(function(t){return e.wsArguments&&e.wsArguments[t.substring(1,t.length-1)]?e.wsArguments[t.substring(1,t.length-1)]:t})):e.wsInformation.url;let n=e.serverURL+r+"?tenant="+t;e.urlAdd&&(n+="&"+e.urlAdd);const a={Accept:e.wsInformation.Accept||"*/*","Content-Type":e.wsInformation["Content-Type"]||"application/json","Accept-Language":"en"};e.securityCtx&&(a.SecurityContext=encodeURIComponent(e.securityCtx),a.SecurityToken=encodeURIComponent(e.user.login+"|"+e.securityCtx+"|preferred"));const i=e.wsInformation.type||"JSON",o=e.wsInformation.outputType||i;return new Promise((t=>{const r={method:e.wsInformation.verb,authentication:"passport",proxy:"passport",type:i,headers:a,data:e.data,onComplete:r=>{try{if("JSON"===o){const s=JSON.parse(r);s.success&&s.csrf&&this.setCsrf(s.csrf.value,e.serverURL),t(s)}else t(r)}catch(e){console.error(r),t(null)}},onFailure:e=>{console.error(e),t(null)},onTimeout:e=>{console.error(e),t(null)},timeout:6e4};e.data&&(!e.data.csrf&&this.getCsrf(e.serverURL)&&(e.data.csrf={name:"ENO_CSRF_TOKEN",value:this.getCsrf(e.serverURL)}),"JSON"===r.type&&(r.data=JSON.stringify(e.data))),s.authenticatedRequest(n,r)}))}static async getLastIndexingDate(e,t,r){const s=this.getUser(),n={select_service:r};return this.runRequest({serverURL:e,securityCtx:"ctx::"+t,wsInformation:i.WSInformation.indexingDate,data:n,user:s,urlAdd:"SecurityContext="+encodeURIComponent(t)})}static async searchDocument(e,t,r){const s=this.getUser();return this.runRequest({serverURL:e,securityCtx:t,wsInformation:i.WSInformation.searchDocument,user:s,urlAdd:"searchStr="+r})}static async getDimensionsFromNames(e,t,r){if(0===r.length)return;const s=this.getUser();return this.runRequest({serverURL:e,securityCtx:t,wsInformation:i.WSInformation.dimensions,user:s,urlAdd:"$filter=dimensionName+eq+"+r.join(",")})}static async getReferenceSizes(e,t,r){if(0===r.length)return;let s='"';for(let e=0;e<r.length;e++)e>0&&(s+=","),s+=""+r[e];s+='" ","';const n=['<?xml version="1.0" encoding="utf-8"?>','<executeSequence xmlns="http://www.3ds.com/xmql/query">',"  <execute>","    <function>query_bus</function>","    <version>2.2.0</version>","    <params>",'      <param name="label">fetch</param>','      <param name="type">*</param>','      <param name="name">*</param>','      <param name="revision">*</param>','      <param name="vault">*</param>','      <param name="select">["physicalid","format.file.name","format.file.size","format.file.location"]</param>','      <param name="where">physicalid matchlist '+s+"</param>",'      <param name="dump">|</param>','      <param name="format">tcl</param>',"    </params>","  </execute>","</executeSequence>"].join("\n"),a=this.getUser();return this.xmqlFetchToArray(await this.runRequest({data:n,serverURL:e,securityCtx:t,wsInformation:i.WSInformation.mql,user:a}))}static async getNLSNamesPredicates(e,t,r){const s=this.getUser(),n=r;return this.runRequest({serverURL:e,securityCtx:"ctx::"+t,wsInformation:i.WSInformation.NLSNamesPredicates,data:n,user:s,urlAdd:"SecurityContext="+encodeURIComponent(t)})}static async getTypesHierarchy(e,t,r){const s=this.getUser(),n={types:r};return this.runRequest({serverURL:e,securityCtx:"ctx::"+t,wsInformation:i.WSInformation.typeshierarchy,data:n,user:s,urlAdd:"SecurityContext="+encodeURIComponent(t)})}static async accessPredicatesFromTypesExtensions(e,t,r){const s=this.getUser(),n=r.join(",");return this.runRequest({serverURL:e,securityCtx:"ctx::"+t,wsInformation:i.WSInformation.accessPredicates,data:n,user:s,urlAdd:"SecurityContext="+encodeURIComponent(t)})}static async retreiveDocumentFiles(e,t,r){const s=this.getUser();return this.runRequest({serverURL:e,securityCtx:t,user:s,wsInformation:i.WSInformation.retreiveDocumentFiles,wsArguments:{docId:r}})}static async _checkinToFCS(e){var t=e||{},r=t.ticketURL,s=this._getFCSFormData(t),n=new XMLHttpRequest;return n.open("POST",r,!0),new Promise(((e,t)=>{var r=()=>{t()};n.onloadend=()=>{200===n.status?e(n.responseText):r()},n.onabort=r,n.onerror=r,n.ontimeout=r,n.send(s)}))}static _getFCSFormData(e){var t=(e=e||{}).fileInfo||e.documentInfo&&e.documentInfo.fileInfo,r=t&&t.file,s=t&&t.fileName,n=new FormData;return n.append(e.ticketparamname,e.ticket),r&&n.append("file_0",r,s),n}static async requestTicket(e,t){const r=await e;if(r.success&&1===r.data.length){const e={ticketURL:r.data[0].dataelements.ticketURL,ticketparamname:r.data[0].dataelements.ticketparamname,ticket:r.data[0].dataelements.ticket,fileInfo:{}};return t&&(e.fileInfo={file:t,fileName:t.name}),this._checkinToFCS(e)}}static async checkinTicket(e,t,r){const s=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:s,data:{},wsInformation:i.WSInformation.checkinTicket}),r)}static async downloadDocumentTicket(e,t,r){const s=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:s,data:{},wsInformation:i.WSInformation.downloadDocumentTicket,wsArguments:{docId:r}}))}static async downloadFileTicket(e,t,r,s){const n=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:n,data:{},wsInformation:i.WSInformation.downloadFileTicket,wsArguments:{docId:r,fileId:s}}))}static async checkinDocumentTicket(e,t){const r=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:r,data:{},wsInformation:i.WSInformation.checkinDocumentTicket}))}static async checkoutTicket(e,t){const r=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:r,data:{},wsInformation:i.WSInformation.checkoutTicket}))}static async checkoutDocumentTicket(e,t,r){const s=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:s,data:{},wsInformation:i.WSInformation.checkoutDocumentTicket,wsArguments:{docId:r}}))}static async getFileVersions(e,t,r,s){const n=this.getUser();return this.runRequest({serverURL:e,securityCtx:t,user:n,wsInformation:i.WSInformation.getFileVersions,wsArguments:{docId:r,fileId:s}})}static async updateDocument(e,t,r,s,n,a){const o=this.getUser(),c={data:[{id:r,updateAction:"NONE",relateddata:{files:[{dataelements:{title:n,receipt:s},updateAction:a?"REVISE":"CREATE",id:a||""}]}}]};return this.runRequest({serverURL:e,securityCtx:t,user:o,wsInformation:i.WSInformation.updateDocument,data:c,urlAdd:"e6w-lang=en&e6w-timezone=-120",wsArguments:{docId:r}})}static async createDocumentFiles(e,t,r,s,n){const a=this.getUser(),o={data:[{id:r,updateAction:"NONE",relateddata:{files:[{dataelements:{title:n,receipt:s},updateAction:"CREATE"}]}}]};return this.runRequest({serverURL:e,securityCtx:t,user:a,data:o,wsInformation:i.WSInformation.createDocumentFiles,wsArguments:{docId:r}})}static async createDocument(e,t,r){const s=this.getUser(),n={data:[{type:"Document",dataelements:{name:r,policy:"Document Release",state:"IN_WORK",title:r,description:"Repository to store custom styles"}}]};return this.runRequest({serverURL:e,securityCtx:t,user:s,data:n,wsInformation:i.WSInformation.createDocument})}static async frustrumExpandV2(e,t,r,s,n){const a=n||{descending_condition:{uql:"availability:2"},descending_condition_object:{uql:'[ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"'},descending_condition_relation:{uql:'NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency")'}},o=this.getUser(),c={batch:{expands:[{label:o.login+"_xHighlight_"+Date.now(),root:{physical_id:r},filter:{and:{filters:[{prefix_filter:{prefix_path:[{physical_id_path:[r]}]}},{in_frustum:s}]}},graph:a,aggregation_processors:[{materials:{uql:'bo_46_plmentity_46_plm_95_externalid:"Applied%20Material"'}}]}]},outputs:{select_object:["ds6w:label","physicalid","ds6w:type","ds6w:globalType"],select_relation:["ds6w:label","physicalid","ds6w:type","ds6w:globalType","TreeOrder","matrixtxt"],select_pgp:["show","hide","color","opacity"],hits:{predefined_computation:["urlstream|mythumbnail2d|2dthb"]}}};return this.runRequest({serverURL:e,securityCtx:t,wsInformation:i.WSInformation.expandv2,data:c,user:o,urlAdd:"output_format=cvjson"})}static async fetchV2(e,t,r){const s=this.getUser(),n={physicalid:r,label:s.login+"_xHighlight_"+Date.now(),select_predicate:["ds6w:label","ds6w:type","name","policy","revision","stateNLS","title","typeNLS","ds6w:name","ds6w:policy","ds6w:revision","ds6w:stateNLS","ds6w:title","ds6w:typeNLS","bo.dsc_matref_rep_rendering.visappearance"],select_file:["thumbnail_2d"]};return this.runRequest({serverURL:e,securityCtx:t,wsInformation:i.WSInformation.fetch,data:n,user:s})}static async fetchWithCustomPredicates(e,t,r,s,n){const a=this.getUser();let o={physicalid:r,label:a.login+"_xHighlight_"+Date.now(),select_predicate:s,with_nls:!0};return n&&(o.select_unit=n),this.runRequest({serverURL:e,securityCtx:t,wsInformation:i.WSInformation.fetch,data:o,user:a})}static async expandV2(e,t,r,s){const n=s||{descending_condition:{uql:"availability:2"},descending_condition_object:{uql:'[ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"'},descending_condition_relation:{uql:'NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency")'}},a=this.getUser(),o={batch:{expands:[{label:a.login+"_xHighlight_"+Date.now(),root:{physical_id:r},filter:{and:{filters:[{prefix_filter:{prefix_path:[{physical_id_path:[r]}]}}]}},graph:n,aggregation_processors:[{materials:{uql:'bo_46_plmentity_46_plm_95_externalid:"Applied%20Material"'}}]}]},outputs:{select_object:["ds6w:label","physicalid","ds6w:type","ds6w:globalType","ds6w:kind","ds6wg:XCADOrientationExt.V_WorldOrientation","bo.PGPShowExtension.V_PGP_Show","bo.PGPColorExtension.V_PGP_ColorRGB.Asstring","bo.PGPOpacityExtension.V_PGP_Opacity","bo.PGPInheritanceExtension.V_PGP_Inheritance"],select_relation:["ds6w:label","physicalid","ds6w:type","ds6w:globalType","TreeOrder","matrixtxt","ro.PGPShowExtension.V_PGP_Show","ro.PGPColorExtension.V_PGP_ColorRGB.Asstring","ro.PGPOpacityExtension.V_PGP_Opacity","ro.PGPInheritanceExtension.V_PGP_Inheritance"],select_pgp:["show","hide","color","opacity"],hits:{predefined_computation:["urlstream|mythumbnail2d|2dthb","boundingbox"]}}};return this.runRequest({serverURL:e,securityCtx:t,wsInformation:i.WSInformation.expandv2,data:o,user:a,urlAdd:"output_format=cvjson"})}static getCsrf(e){return this.csrf&&this.csrf[e]}static setCsrf(e,t){return this.csrf=this.csrf||{},this.csrf[t]=e}static async fetchMaterials(e,t,r){const s=[];let n=0;r.forEach((e=>{s[n]||(s[n]=[]),s[n].length>900&&(s.push([]),n++),s[n].push(e)}));let a=[];for(n=0;n<s.length;n++){const r=await i.fetchV2(e,t,s[n]);r&&r.results&&(a=a.concat(r.results))}return a}}return i.WSInformation={indexingDate:{url:"/cvservlet/indexingdate",verb:"POST"},fetch:{url:"/cvservlet/fetch/v2",verb:"POST"},expandv2:{url:"/cvservlet/progressiveexpand/v2",verb:"POST"},progressiveExpand:{url:"/cvservlet/progressiveexpand",verb:"POST"},search:{url:"/search",verb:"POST"},searchv2:{url:"/cvservlet/progressiveexpand/v2",verb:"POST"},dimensions:{url:"/resources/dictionary/dimensions",verb:"GET"},accessPredicates:{url:"/resources/6WVocab/access/Predicates",verb:"POST",type:"TEXT",outputType:"JSON"},typeshierarchy:{url:"/resources/product/dico/gettypeshierarchy",verb:"POST"},NLSNamesPredicates:{url:"/resources/6WVocab/access/PredicateValue",verb:"POST"},createDocument:{url:"/resources/v1/modeler/documents",verb:"POST"},updateDocument:{url:"/resources/v1/modeler/documents",verb:"PUT"},reserveDocument:{url:"/resources/v1/modeler/documents/{docId}/reserve",verb:"PUT"},unreserveDocument:{url:"/resources/v1/modeler/documents/{docId}/unreserve",verb:"PUT"},searchDocument:{url:"/resources/v1/modeler/documents/search",verb:"GET"},getDocumentInformation:{url:"/resources/v1/modeler/documents/{docId}",verb:"GET"},updateDocumentInformation:{url:"/resources/v1/modeler/documents/{docId}",verb:"PUT"},deleteDocument:{url:"/resources/v1/modeler/documents/{docId}",verb:"DELETE"},retreiveDocumentFiles:{url:"/resources/v1/modeler/documents/{docId}/files",verb:"GET"},createDocumentFiles:{url:"/resources/v1/modeler/documents/{docId}/files",verb:"POST"},updateDocumentFiles:{url:"/resources/v1/modeler/documents/{docId}/files",verb:"PUT"},updateDocumentFile:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}",verb:"PUT"},deleteDocumentFile:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}",verb:"DELETE"},getFileVersions:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/versions",verb:"GET"},deleteFileVersion:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/versions/{versionId}",verb:"DELETE"},checkinTicket:{url:"/resources/v1/modeler/documents/files/CheckinTicket",verb:"PUT"},checkinDocumentTicket:{url:"/resources/v1/modeler/documents/{docId}/files/CheckinTicket",verb:"PUT"},downloadTicket:{url:"/resources/v1/modeler/documents/DownloadTicket",verb:"PUT"},downloadDocumentTicket:{url:"/resources/v1/modeler/documents/{docId}/files/DownloadTicket",verb:"PUT"},downloadFileTicket:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/DownloadTicket",verb:"PUT"},downloadVersionTicket:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/versions/{versionId}/DownloadTicket",verb:"PUT"},checkoutTicket:{url:"/resources/v1/modeler/documents/CheckoutTicket",verb:"PUT"},checkoutDocumentTicket:{url:"/resources/v1/modeler/documents/{docId}/files/CheckoutTicket",verb:"PUT"},checkoutFileTicket:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/CheckoutTicket",verb:"PUT"},mql:{url:"/i3dx/services/xmql",verb:"POST","Content-Type":"application/xml",Accept:"text/plain",type:"XML"}},i}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebPlatform/VCX3DDriveServices",["require","exports","DS/VCXWebPlatform/VCXPlatformServices","DS/WAFData/WAFData"],(function(e,t,r,s){"use strict";r=__importDefault(r),s=__importDefault(s);class n{static async _find3DDriveFile(e,t,r,s){const n=r+"/resources/3ddrive/v1/bos/"+s+"/contents?tenant="+t;let a=await this._authenticatedRequest(n,{method:"GET",type:"json"});for(let t=0;t<a.response.items.length;t++)if(a.response.items[t].title===e)return Promise.resolve(a.response.items[t].id);return Promise.resolve(null)}static async _authenticatedRequest(e,t){return new Promise(((r,n)=>{const a=t.onComplete;t.onComplete=(e,t)=>{a?.(e,t),r({response:e,responseHeaders:t})};const i=t.onFailure;t.onFailure=e=>{i?.(e),n(e)},s.default.authenticatedRequest(e,t)}))}static async getAuthTokens(e,t){const r=await n._authenticatedRequest(`${e}/resources/3ddrive/v1/bos/ticket?tenant=${t}`,{method:"GET",type:"json"}),s=r.response,a=r.responseHeaders?.["x-ds-csrftoken"];return{fcsTicket:s,csrfToken:a}}static async uploadFileInFCS(e,t,r){const s=new FormData;s.append(e.jobticket,e.ticket),s.append("file_0",t,r),s.append("__fcs__nohtml","true");return await n._authenticatedRequest(e.actionurl,{method:"POST",data:s})}static async CreateOrUpdateFile(e,t,r,s,a,i,o){let c,l,u=await this._find3DDriveFile(e,s,t,r);return u?(c=`${t}/resources/3ddrive/v1/bos/${u}?tenant=${s}`,l="PUT"):(c=`${t}/resources/3ddrive/v1/bos/${r}/contents?tenant=${s}`,l="POST"),await n._authenticatedRequest(c,{method:l,headers:{"Content-Type":"application/json","X-DS-CSRFTOKEN":a},data:JSON.stringify({type:"DriveFile",title:i,receipt:o.response.trim()})})}static async publish3DDrive(e,t,s,a){try{const i=s||await r.default.GetTenantId(),o=a||"DSROOT",c=new File([e],t,{type:e.type,lastModified:Date.now()}),l=await r.default.getServiceUrl("3DDrive",i),{fcsTicket:u,csrfToken:d}=await n.getAuthTokens(l,i),m=await n.uploadFileInFCS(u,c,t);await n.CreateOrUpdateFile(t,l,o,i,d,t,m),console.log("Experience "+t+" Saved"),console.log("Publish Media -> 3DDrive OK")}catch(e){console.error("error publishing to 3DDrive")}}}return n})),define("DS/VCXWebPlatform/VCX3DSpaceServices",["require","exports","DS/DocumentManagement/DocumentManagement","DS/VCXWebPlatform/VCXPlatformServices"],(function(e,t,r,s){"use strict";class n{static async Get3DSpaceURL(e=null){if(e||(e=await s.GetTenantId()),n._cache3DSpace)return n._cache3DSpace;let t=await s.get3DSpaceURL(e);if(e)return n._cache3DSpace=t,t;throw new Error("Tenant not found")}static UpdateWidgetPreferenceCollabspace(e){widget.hasPreference("Collaborative_Space")||widget.addPreference({type:"text",name:"Collaborative_Space",label:"",disabled:!0,defaultValue:e}),widget.setValue("Collaborative_Space",e)}static addWidgetPreferences(){if(widget&&widget.data&&widget.data.x3dPlatformId){var e=widget.data.x3dPlatformId;widget.addPreference({type:"list",name:"Platform",label:"",defaultValue:e,disabled:!0,options:[{label:e,value:e}]})}}static UpdateCollabSpaceInCloudIcon(e){if(widget){let t=e.role+"."+e.organization+"."+e.collabspace;n.UpdateWidgetPreferenceCollabspace(e.collabspace),widget.setValue("xPref_CREDENTIAL",t),widget.setValue("xPref_CREDENTIAL_raw",JSON.stringify(e))}}static async SetPreferredSecurityContext(e){e||(e=await n.GetPreferredSecurityContext()),widget.setValue("tenantAware",!0),n.UpdateCollabSpaceInCloudIcon(e)}static async GetPreferredSecurityContext(){if(widget&&widget.data&&widget.data.xPref_CREDENTIAL_raw)return JSON.parse(widget.data.xPref_CREDENTIAL_raw);let e,t=await n.GetSecurityContextInformations();if(Object.keys(t).length){let s=t;for(var r in s)if(s.hasOwnProperty(r)&&(n._cachePreferred&&n._cachePreferred.collabspace&&n._cachePreferred.collabspace.name&&r===n._cachePreferred.collabspace.name||!n._cachePreferred)&&s[r].highPrivilegeRoleOrga&&(e=s[r].highPrivilegeRoleOrga,e))return n.SetPreferredSecurityContext(e),e;throw new Error("You do not have any collabspace. Request an invitation to a collabspace.")}throw new Error("listSecurityContextInfos not found.")}static async GetSecurityContextInformations(){let e=await s.GetTenantId(),t=await n.Get3DSpaceURL(e);if(this._cacheCollabSpace)return this._cacheCollabSpace;let r=await s.listSecurityContextInfos(t,e);if(r&&r.preferredcredentials&&(n._cachePreferred=r.preferredcredentials),r&&r.collabspaces){for(var a={},i=0;i<r.collabspaces.length;i++){var o=r.collabspaces[i],c=o.name;if("Default"!==c||"Default"!==o.title){a[c]=o,a[c].securityContext=[];for(var l=0;l<o.couples.length;l++){var u=o.couples[l];a[c].securityContext.push({role:u.role.name,organization:u.organization.name,title:u.organization.title,nlsrole:u.role.nls})}var d=n._getHighestPrivilegeRoleOrga(a[c].securityContext);a[c].highPrivilegeRoleOrga=d,a[c].highPrivilegeRoleOrga.collabspace=c}}n._cacheCollabSpace=a}if(n._cacheCollabSpace)return n._cacheCollabSpace;throw new Error("listSecurityContextInfos not found.")}static async _getRoleOrgaFromCollabSpace(e){let t=await n.GetSecurityContextInformations();for(var r in t)if(t.hasOwnProperty(r)&&r===e)return t[r].highPrivilegeRoleOrga}static async getObjectSecurityContextFromExperienceID(e){let t=await n.Get3DSpaceURL(),r=await s.extractCollabSpaceFromProduct(t,e);return n._getRoleOrgaFromCollabSpace(r)}static _getHighestPrivilegeRoleOrga(e){if(e.length){for(var t=["VPLMProjectLeader","VPLMProjectAdministrator","VPLMCreator"],r=!0,s=0,n=[];r&&s<=2;)r=0===(n=e.filter((e=>e.role===t[s]))).length,s++;return n.length>0?n[0]:e[0]}console.warn("No security context found!")}static async publish3DSpace(e,t,r){let a=await s.GetTenantId(),i=await n.Get3DSpaceURL(a),o=await n.GetPreferredSecurityContext(),c={tenant:a,tenantUrl:i,securityContext:o.role+"."+o.organization+"."+o.collabspace};e.name=t,await n.PushBlob(c,e,r),console.log("Experience "+t+" Saved"),console.log("Publish Media -> 3Dspace OK")}static async PushBlob(e,t,r){var s=new File([t],t.name,{type:t.type,lastModified:Date.now()});let n={title:t.name,type:"Document",policy:"Document Release",fileInfo:{file:s}};r&&(n.relInfo={parentId:r,parentRelName:"Reference Document",parentDirection:"from"});try{await this.PushDocument(e,n)}catch(s){if(r)return await this.PushBlob(e,t,null);throw new Error("Impossible to write in the Collabspace")}}static async PushDocument(e,t){await new Promise((function(s,n){var a={...e,onComplete:s,onFailure:n};r.createDocument(t,a)}))}get(){}}return n})),define("DS/VCXWebPlatform/VCXIndexCheckHelper",["require","exports","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebIO/VCXLogServices"],(function(e,t,r,s,n){"use strict";var a;!function(e){e[e.LIMIT_TENTATIVES_REACHED=2]="LIMIT_TENTATIVES_REACHED",e[e.NEW_TENTATIVE=4]="NEW_TENTATIVE",e[e.SUCCESS_TENTATIVE=8]="SUCCESS_TENTATIVE",e[e.FAIL_TENTATIVE=16]="FAIL_TENTATIVE",e[e.STOP_TENTATIVE=32]="STOP_TENTATIVE"}(a||(a={}));const i=e=>{let t="",r=n.EMessageType.Regular;switch(e){case 2:t="Attempts of checking indexation reached 10",r=n.EMessageType.Info;break;case 4:t="New attempt of checking indexation sent",r=n.EMessageType.Info;break;case 16:t="An attempt of checking indexation failed",r=n.EMessageType.Error;break;case 8:t="Attempt of checking indexation succeeded",r=n.EMessageType.Success;break;case 32:t="Closing attempts of checking indexation",r=n.EMessageType.Info}n.log(t,r)};return class{constructor(){this._intervalID=null}async checkIndexing(e,t,n){let o=(new Date).getTime()/1e3;const c=await s.Get3DSpaceURL(),l=await s.GetPreferredSecurityContext(),u="ctx::"+l.role+"."+l.organization+"."+l.collabspace;this._intervalID&&this.unInitialize(),this._intervalID=window.setInterval((async()=>{const e=await r.getLastIndexingDate(c,u,["FTS"]);if(e&&e.hasOwnProperty("FTS")){i(a.NEW_TENTATIVE);const r=e.FTS.allvaultsacl;if(r>o){let e=!0;t&&(e=await t()),e?(i(a.SUCCESS_TENTATIVE),this.unInitialize(),n&&await n()):o=r}}else i(a.FAIL_TENTATIVE)}),6e4)}unInitialize(){this._intervalID&&(i(a.STOP_TENTATIVE),window.clearInterval(this._intervalID),this._intervalID=null)}}}));