define("DS/CAT3DWInfra/CAT3DWMutex",["UWA/Class","UWA/Core"],(function(e,t){"use strict";var r=e.extend({init:function(){let e=Promise.resolve();this.lock=()=>{let t;const r=new Promise((e=>{t=()=>e()})),n=e.then((()=>t));return e=r,n}}});return t.namespace("DS/CAT3DWInfra/CAT3DWMutex",r)})),define("DS/CAT3DWInfra/CAT3DWPreferenceManager",["UWA/Core","UWA/Controls/Abstract"],(function(e,t){"use strict";var r=t.singleton({defaultOptions:{myWidgetObject:null},init:function(e){this._parent(e),this._userPref={},this._initConst()},_initConst:function(){this.setPreferenceValue("ONPREMISE","ONPREMISE"),this.setPreferenceValue("TSTPROVIDER","TSTPROVIDER"),this.setPreferenceValue("CLOUD","CLOUD")},getPreferenceValue:function(e){return this._userPref[e]},setPreferenceValue:function(e,t){this._userPref[e]=t},setPreferenceValueAsBoolean:function(e,t){var r=typeof t;"object"===r&&null===t||"undefined"===r?this.setPreferenceValue(e,!1):"string"===r?"1"===(t=t.toLowerCase())||"true"===t?this.setPreferenceValue(e,!0):"0"===t||"false"===t?this.setPreferenceValue(e,!1):console.error("Can't convert value "+t+" for key "+e+" to boolean"):"number"===r?1===t?this.setPreferenceValue(e,!0):0===t?this.setPreferenceValue(e,!1):console.error("Can't convert value "+t+" for key "+e+" to boolean"):"boolean"===r?this.setPreferenceValue(e,t):console.error("Can't convert type "+r+" to boolean")},removePreference:function(e){e&&delete this._userPref[e]}});return e.namespace("DS/CAT3DWInfra/CAT3DWPreferenceManager",r)})),define("DS/CAT3DWInfra/CAT3DWQueuePromise",["UWA/Class","UWA/Promise"],(function(e,t){"use strict";var r="no",n="inprogress",i="finished",o=UWA.Class.extend({init:function(e){this._promises=[],this._promisesCount=0,this._resolveValues=[],this._promisesCompleted=0,this._nbThreads=0,this._delay=0,this._limit=0,this._wait=r,this._callback=e&&"function"==typeof e?e:function(){},this._nbPromises=35,this._timeoutValue=2e3},all:function(e,n,i){return Array.isArray(e)?0===e.length?t.resolve([]):(this._promises=e,this._promisesCount=this._promises.length,this._resolveValues=[],this._promisesCompleted=0,this._nbThreads=n||5,this._delay=i&&i.delay?i.delay:1e4,this._limit=i&&i.limit?i.limit:-1,this._wait=r,new t(function(e,t){this._runThreads(e,t)}.bind(this)).then(function(){return this._resolveValues}.bind(this))):t.reject(new Error("First parameter must be an array of promises."))},run:function(){return new t(this._callback)},_runThreads:function(e,t){for(var r=Math.min(this._promisesCount-this._promisesCompleted,this._nbThreads),n=0;n<r;n++)this._runNextPromise(e,t)},_runNextPromise:function(e,t){if(this._wait!==n){var a=this._promisesCount-this._promises.length;if(a!==this._promisesCount){if(this._limit>0&&this._wait===r&&a&&a%this._limit==0)return this._wait=n,void setTimeout(function(){this._wait=i,this._runThreads(e,t)}.bind(this),this._delay);this._wait=r;var s=this._promises.shift(),l=function(r,n){this._resolveValues[n]=r,this._promisesCompleted++,this._promises.length>0?this._runNextPromise(e,t):this._promisesCompleted===this._promisesCount&&e()}.bind(this);return s instanceof o?s.run().then(function(e,t){l(t,e)}.bind(this,a)).catch(t):void 0}}},sampleWithQueue:function(){return new t(function(e,t){for(var r=[],n=0;n<this._nbPromises;n++)r.push(new o(function(e,t,r){console.log("[QueuePromise sample] START SUCCESS : "+e),setTimeout((function(){console.log("[QueuePromise sample] END SUCCESS : "+e),t("youpiii"+e)}),this._timeoutValue)}.bind(this,n)));this.all(r,5,{limit:10,delay:1e4}).then((function(){console.log("%c [QueuePromise sample] Main promise OK","color:green"),e()})).catch((function(e){console.log("%c [QueuePromise sample] Main promise KO","color:red"),console.error(e),t()}))}.bind(this))}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWQueuePromise",o)})),define("DS/CAT3DWInfra/CAT3DW3DDriveUtils",["DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/WAFData/WAFData"],(function(e,t){"use strict";function r(e,t){return e+(e.match(/\?/)?"&":"?tenant="+encodeURIComponent(t))}function n(n){var i=n.url+"/resources/3ddrive/v1/bos",o=e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest;return new Promise((function(t,a){o(r(i+"/ticket",n.platformId),{proxy:e.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"GET",type:"json",onComplete:function(e,r){return t({body:e,headers:r})},onFailure:a})})).then((function(e){var t=e.body;return t.csrfToken=e.headers["x-ds-csrftoken"],t.tenant=n.platformId,t}))}return{saveFileTo3DDriveAtGivenTenant:function(i,o,a,s){return n(s).then((function(n){var l=new FormData;return l.append("__fcs__nohtml",!0),l.append(n.jobticket,n.ticket),l.append("file_0",o,i),fetch(n.actionurl,{proxy:e.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",body:l}).then((function(e){return e.text()})).then((function(e){return e.trim()})).then((function(o){return function(n,i,o,a,s){var l=s.url+"/resources/3ddrive/v1/bos",u=e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest;return new Promise((function(t,c){u(r(l+"/"+a+"/contents",s.platformId),{proxy:e.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",headers:{"Content-Type":"application/json","X-DS-CSRFTOKEN":o},onComplete:function(e){t(e)},onFailure:c,data:JSON.stringify({type:"Document",title:n,receipt:i})})}))}(i,o,n.csrfToken,a,s)}))}))},updateFileIn3DDriveAtGivenTenant:function(i,o,a,s){return n(s).then((function(n){var l=new FormData;return l.append("__fcs__nohtml",!0),l.append(n.jobticket,n.ticket),l.append("file_0",o,i),fetch(n.actionurl,{method:"POST",body:l}).then((function(e){return e.text()})).then((function(e){return e.trim()})).then((function(o){return new Promise((function(l,u){var c=s.url+"/resources/3ddrive/v1/bos";(e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest)(r(c+"/"+a,s.platformId),{proxy:e.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"PUT",type:"json",headers:{"Content-Type":"application/json","X-DS-CSRFTOKEN":n.csrfToken},onComplete:function(e){l(e)},onFailure:u,data:JSON.stringify({type:"Document",title:i,receipt:o})})}))}))}))},getFolderContentsInTenant:function(n,i){var o=i.url+"/resources/3ddrive/v1/bos",a=e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest;return new Promise((function(e,t){a(r(o+"/"+n+"/contents",i.platformId),{type:"json",onComplete:e,onFailure:t})}))},getFolderDataInTenantFromID:function(n,i){var o=i.url+"/resources/3ddrive/v1/bos",a=e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest;return new Promise((function(e,t){a(r(o+"/"+n,i.platformId),{type:"json",onComplete:e,onFailure:t})}))}}})),define("DS/CAT3DWInfra/CAT3DWUserPreferences",["UWA/Core","UWA/Controls/Abstract","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DSKCloudStorageInfra/CAT3DSKCloudStorageService"],(function(e,t,r,n){"use strict";var i=t.singleton({init:function(){this.PREFIX="",this._touchMode=r.getPreferenceValue("MobileMode"),this._appMode=r.getPreferenceValue("appMode"),this.initPrefix(),this.storagePool=window.localStorage,this._needToSaveInCloud=!1},initPrefix:function(){this.PREFIX="Desktop.","whiteboard"===this._appMode?this.PREFIX+="3DWhiteboard.":this.PREFIX+="3DSketch."},getPrefix:function(){return this.PREFIX},InitCloudRepository:function(e){this.mappingTable=JSON.parse(e),this._autoSaveIntervalToken=setInterval(function(){this._needToSaveInCloud&&(n.setUserPreference(JSON.stringify(this.mappingTable),(function(e){!0===e.success&&console.log("savepreference to cloud successful")})),this._needToSaveInCloud=!1)}.bind(this),3e4),this.storagePool={},this.storagePool.setItem=function(e,t){this.mappingTable[e]=t}.bind(this),this.storagePool.getItem=function(e){var t=this.mappingTable[e];return void 0===t&&(t=null),t}.bind(this)},setUserPreference:function(e,t){if(!e||null===e)return void console.error("Name of the local storage preference invalid!");let r=this.PREFIX+e;try{let e=JSON.stringify(t);this.storagePool.getItem(r)!==e&&(this.storagePool.setItem(r,e),this._autoSaveIntervalToken&&(this._needToSaveInCloud=!0))}catch(e){console.error(e)}},getUserPreference:function(e){if(!e||null===e)return void console.error("Name of the local storage preference invalid!");let t=this.PREFIX+e;try{return JSON.parse(this.storagePool.getItem(t))}catch(e){console.error(e)}}});return e.namespace("DS/CAT3DWInfra/CAT3DWUserPreferences",i)})),define("DS/CAT3DWInfra/CAT3DWMOBStylingHelper",["UWA/Core","UWA/Controls/Abstract","DS/CAT3DWInfra/CAT3DWPreferenceManager"],(function(e,t,r){"use strict";var n=t.singleton({defaultOptions:{myWidgetObject:null},init:function(e){this._parent(e),this.mobileScreenMaxWidth=579,this.mobileScreenMaxHeight=979,this.viewerMaxWidthForMediaPanelFullScreen=1300},getButtonDisplayDataForPanoplybar:function(){return"whiteboard"===r.getPreferenceValue("appMode")?{AddMedia:{mobile:"flex",notMobile:"none"},Diagram:{mobile:"none",notMobile:"flex"},Erase:{mobile:"none",notMobile:"flex"},Reframe:{mobile:"none",notMobile:"flex"},Selection:{mobile:"none",notMobile:"none"},QuickShapes_Sketch:{mobile:"none",notMobile:"none"},QuickShapes_SketchAddon:{mobile:"none",notMobile:"none"},QuickShapes_SketchAddon1:{mobile:"none",notMobile:"none"},QuickShapes_SketchReal:{mobile:"none",notMobile:"none"},SubText:{mobile:"none",notMobile:"none"},SubTextOnDiagram:{mobile:"none",notMobile:"none"},Sketch:{mobile:"none",notMobile:"none"},SketchAddon:{mobile:"none",notMobile:"none"},SketchAddon1:{mobile:"none",notMobile:"none"},SketchReal:{mobile:"none",notMobile:"none"},highlighter:{mobile:"none",notMobile:"none"},Erase:{mobile:"none",notMobile:"none"}}:{AddMedia:{mobile:"flex",notMobile:"none"},Erase:{mobile:"none",notMobile:"flex"},Reframe:{mobile:"none",notMobile:"flex"},Selection:{mobile:"none",notMobile:"none"}}},isScreenDimensionMobilePhone:function(){return window.innerWidth<=this.mobileScreenMaxWidth&&window.innerHeight<=this.mobileScreenMaxHeight||window.innerHeight<=this.mobileScreenMaxWidth&&window.innerWidth<=this.mobileScreenMaxHeight},getIsMediaPanelCoveringFullScreen:function(){return this.viewer3D.offsetWidth<=this.viewerMaxWidthForMediaPanelFullScreen},set3DViewerUI:function(e){this.viewer3D=e}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWMOBStylingHelper",n)})),define("DS/CAT3DWInfra/CAT3DWLocalStorageManager",["UWA/Class","DS/CAT3DWInfra/CAT3DWPreferenceManager"],(function(e,t){"use strict";var r=e.extend({init:function(){this.PREFIX="3DSketch",this.SEPARATOR="-"},setItem:function(e,t){try{window.localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error(e)}},getItem:function(e,t){return JSON.parse(window.localStorage.getItem(e))},removeItem:function(e,t){window.localStorage.removeItem(e)},setPrefixedItem:function(e,t,r){try{window.localStorage.setItem(this._buildPrefixedKey(e,r),JSON.stringify(t))}catch(e){console.error(e)}},getPrefixedItem:function(e,t){return JSON.parse(window.localStorage.getItem(this._buildPrefixedKey(e,t)))},removePrefixedItem:function(e,t){window.localStorage.removeItem(this._buildPrefixedKey(e,t))},_buildPrefixedKey:function(e,r){var n,i=this.PREFIX,o=!1,a=t.getPreferenceValue("swymTenant").toUpperCase();if(!r)throw new Error("The options object is not defined");return!0===r.tenant&&r.widget&&r.widget.id?(i+=this.SEPARATOR+a+this.SEPARATOR+r.widget.id,o=!0):!0===r.tenant?(i+=this.SEPARATOR+a,o=!0):r.widget&&r.widget.id&&(i+=this.SEPARATOR+r.widget.id,o=!0),!0===o?n=i+this.SEPARATOR+e:Logger.error("Either the tenant or the widget should be specified in the options object"),n}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWLocalStorageManager",r)})),define("DS/CAT3DWInfra/CAT3DWLogger",["DS/CAT3DWInfra/CAT3DWPreferenceManager"],(function(e){"use strict";const t={Collab:"Collab",Swym:"Swym",Picking:"Picking",History:"History"},r={[t.Collab]:"MediumVioletRed",[t.Swym]:"DodgetBlue",[t.Picking]:"GoldenRod",[t.History]:"SeaGreen"};let n,i,o=null;function a(t,a,s){if(void 0===n){const t=e.getPreferenceValue("debug")||"true"===e.getPreferenceValue("debugUrl");i=e.getPreferenceValue("ODTMode"),n=t||i,o=i&&window.parent&&window.parent.console?window.parent.console:window.console}if(n)if(i){let e="";a&&(e=a.toUpperCase?a.toUpperCase()+" ":a+" "),o[s](e+t)}else{let e=function(e){let t=r[e];return t||"white"}(a);"white"===e?o[s]("%c"+(a?a+" ":"")+t,"background-color: "+e+"; color: black; padding: 3px 6px; border-radius: 12px;"):o[s]("%c"+(a?a+"%c ":"%c")+t,"background-color: "+e+"; color: white; padding: 3px 6px; border-radius: 12px;","color: "+e)}}return{log:function(e,t){a(e,t,"log")},warn:function(e,t){a(e,t,"warn")},error:function(e,t){a(e,t,"error")},trace:function(e,t){a(e,t,"trace")},Category:t}})),define("DS/CAT3DWInfra/CAT3DWPlateformServices",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient","DS/PlatformAPI/PlatformAPI","DS/WAFData/WAFData","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/RTConvAPI/RTConvAPI","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWPlateformServices"],(function(e,t,r,n,i,o,a,s,l,u){"use strict";var c=t.singleton({defaultOptions:{myWidgetObject:null},init:function(e){this._parent(e),this._debugMode=s.getPreferenceValue("debug")||"true"===s.getPreferenceValue("debugUrl"),this._count=0},getUserID:function(){return o.getUser().login},getGrantedRoles:function(e){return n.getGrantedRoles((t=>{e(t)}))},getUserData:function(){return o.getUser()},getOrCreateSessionID:function(e){return new r((function(t,r){var n="";c.cacheSessionId||("local"==e?(n+="x3DPhoto",n+="/",n+=Date.now(),n+=Math.floor(10*Math.random())):(n+=c.getUserID(),n+="/",n+=s.getPreferenceValue("ServiceName"),n+="/",null!==s.getPreferenceValue("WidgetID")?n+=s.getPreferenceValue("WidgetID"):(n+=Date.now(),n+=Math.floor(10*Math.random())),n=n.replace(/\s+/g,"")),c.cacheSessionId=n),t(c.cacheSessionId)}))},get3DSpace:function(e){return new r((function(t,r){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - get3DSpace"),n.getServiceUrl({serviceName:"3DSpace",platformId:e,onComplete:function(e){c.cacheUrl3DSpace=e,1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - get3DSpace"),t(e)},onFailure:function(e){r(new Error("Internal Error - get3DSpace failed"))}})}))},get3DSearch:function(e){var t=e?e.toUpperCase():null;return new r((function(e,r){n.getServiceUrl({serviceName:"3DSearch",platformId:t,onComplete:function(r){var n="";t?n=r:r&&r.length&&r[0]&&(console.warn("get3DSearch : PlatformId/Tenant is null so first url of the list is returned"),n=r[0].url),e(n)},onFailure:function(e){e&&console.warn(e),r(new Error("Internal Error - get3DSearch failed"))}})}))},get3DDrive:function(e){var t=e?e.toUpperCase():null;return new r((function(e,r){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - get3DDrive"),n.getServiceUrl({serviceName:"3DDrive",platformId:t,onComplete:function(r){1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - get3DDrive");var n="";t?n=r:r&&r.length&&r[0]&&(console.warn("get3DDrive : PlatformId/Tenant is null so first url of the list is returned"),n=r[0].url),c.cacheUrl3DDrive=n,e(n)},onFailure:function(e){e&&console.warn(e),c.cacheUrl3DDrive="",r(new Error("Internal Error - get3DDrive failed"))}})}))},getDFA:function(e){var t=e?e.toUpperCase():null;return new r((function(e,r){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - getDFA"),n.getServiceUrl({serviceName:"derivedformataccess",platformId:t,onComplete:function(r){1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - getDFA");var n="";t?n=r:r&&r.length&&r[0]&&(console.warn("getDFA : PlatformId/Tenant is null so first url of the list is returned"),n=r[0].url),e(n)},onFailure:function(e){e&&console.warn(e),r(new Error("Internal Error - getDFA failed"))}})}))},get3DDesign:function(e){return new r((function(t,r){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - get3DDesign"),n.getServiceUrl({serviceName:"3ddesignlinux",onComplete:function(r){var n="";for(var i in r)if(""!=e&&r[i].platformId==e){n=r[i].url;break}if(""==n||!n){console.log("WARNING: 3DXEnginering app has not been found on tenant "+e);for(i=0;i<r.length&&""==n;)n=r[i].url,i++}c.cacheUrl3DDesign=n.substring(n.indexOf("https://")+8),1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - get3DDesign"),t(r)},onFailure:function(e){r(new Error("Internal Error - get3DDesign failed"))}})}))},getx3DPhoto:function(e){return new r((function(t,r){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - getx3DPhoto"),n.getServiceUrl({serviceName:"x3dphoto",onComplete:function(r){var n="";for(var i in r)if(""!=e&&null!=e&&r[i].platformId.toLowerCase()==e){n=r[i].url;break}if(""==n||!n){console.log("WARNING: x3DPhoto app has not been found on tenant "+e);for(i=0;i<r.length&&""==n;)n=r[i].url,i++}c.cacheUrl3DPhoto=n.substring(n.indexOf("https://")+8),1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - getx3DPhoto"),t(r)},onFailure:function(e){r(new Error("Internal Error - getx3DPhoto failed"))}})}))},getAiAgent:function(e){return new r((async function(t,r){const n=o.getApplicationConfiguration("app.urls.registry"),a=await i.getServicesByPlatform({platforms:[e],services:["AIAssistantInfra"],config:{url:n}});let s="";for(let t in a)if(""!==e&&void 0!==e&&a[t].id.toLowerCase()===e){s=a[t].services[0].url;break}""===s&&r(a),c.cacheUrlAIAssistantInfra=s.substring(s.indexOf("https://")+8,s.length-4),t(a)}))},get3DPassport:function(e){return new r((function(t,r){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - get3DPassport"),n.getServiceUrl({serviceName:"3DPassport",platformId:e.toUpperCase(),onComplete:function(e){e&&e[0]&&e[0].url&&(e=e[0].url);var r=e.replace(/^https?:\/\//,"");c.cacheUrl3DPassport=r,1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - get3DPassport"),t(e)},onFailure:function(e){r(new Error("Internal Error - get3DPassport failed"))}})}))},getCollabSpaceList:function(t,n){return new r((function(r,i){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - getCollabSpaceList");var o={timeout:15e3,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null},proxy:"passport",onComplete:function(e){for(var t=[],i=0;i<e.length;i++){var o={name:e[i].name,context:e[i].contexts[0]};t.push(o)}t.name=n,1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - getCollabSpaceList"),r(t)},onFailure:function(e){i(new Error("Internal Error - getCollabSpaceList failed"))}},a=t+"/resources/enocsmrest/collabspaces?";n&&(a+="tenant="+n),e.Data.request(a,o)}))},getTransientTicket:function(){return new r((function(e,t){var r="https://"+c.cacheUrl3DPassport+"/api/authenticated/cas/transient";a.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(r){r?e(r.x3ds_reauth_url):t()},onFailure:function(){t()}})}))},getLoginTicket:function(t,n,i){return new r((function(r,o){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - getLoginTicket");var a={timeout:15e3,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null},proxy:"passport",onComplete:function(e){var n={loginTicket:e.ticket,url3DSpace:t};c.cacheloginTicket=e.ticket,1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - getLoginTicket"),r(n)},onFailure:function(e){o(new Error("Internal Error - GetLoginTicket failed"))}},l=t+"/ticket/get?";l+=n?"runasctx="+n:"runasctx=preferred",i&&(l+="&tenant="+i),l=encodeURI(l),e.Data.request(l,a)}))},setPartID:function(e){c.cachePartId=e},getPassportTicket:function(e,t,r){var n="https://"+c.cacheUrl3DDesign,i=e.passportURL;a.authenticatedRequest(i+"/login?service="+n,{method:"GET",headers:{Accept:"application/json"},onComplete:function(e){var r=JSON.parse(e).access_token;t(n,r)},onFailure:function(e){r("message"),console.log(e)}})},logIn3DDrive:function(){return new e.Promise((function(e,t){var r="https://"+c.cacheUrl3DPassport+"/login?service="+encodeURIComponent(c.cacheUrl3DDrive+"/resources/3ddrive/v1/bos/DSROOT?withactions=true&tenant="+c.cacheTenantID.toUpperCase()+"&serverId=MT_Metadata_0&xrequestedwith=xmlhttprequest");a.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(r){var n=r.x3ds_service_redirect_url;a.authenticatedRequest(n,{onComplete:function(t){e(t)},onFailure:function(e,r,n){t(e)}})},onFailure:function(e,r,n){t(e)}})}))},logInX3DPhoto:function(t){return new e.Promise((function(e,r){var n=c.cacheUrl3DPassport,i=n.split("/"),o="https://"+(i=0===i.length?n:i[0])+"/login?service=https://"+encodeURIComponent(c.cacheUrl3DPhoto+t);a.authenticatedRequest(o,{method:"GET",type:"json",onComplete:function(t){var r=t.x3ds_service_redirect_url;e(r)},onFailure:function(e,t,n){r(e)}})}))},logInAIAgent:function(t){return new e.Promise((function(e,r){var n=c.cacheUrl3DPassport,i=n.split("/"),o="https://"+(i=0===i.length?n:i[0])+"/login?service=https://"+encodeURIComponent(c.cacheUrlAIAssistantInfra+t);a.authenticatedRequest(o,{method:"GET",type:"json",onComplete:function(t){var r=t.x3ds_service_redirect_url;e(r)},onFailure:function(e,t,n){r(e)}})}))},getFileListInRoot3DDrive:function(){return new e.Promise(function(e,t){var r=c.cacheUrl3DDrive+"/resources/3ddrive/v1/bos/DSROOT/contents?tenant="+c.cacheTenantID.toUpperCase();a.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(t,r){var n=Object.keys(r).filter((function(e){return-1!==e.search(/x-ds-csrftoken/i)}));this._csrfDrive=r[n[0]],e(t.items)}.bind(this),onFailure:function(e,r,n){t(e)}})}.bind(this))},get3DSwym:function(e){var t=e?e.toUpperCase():null;return new r((function(r,i){e||i(new Error('Cannot get Swym url. Missing parameter "platformId".')),n.getServiceUrl({serviceName:"3DSwym",platformId:t,onComplete:function(e){var n="";t?n=e:e&&e.length&&e[0]&&(console.warn("get3DSwym : PlatformId/Tenant is null so first url of the list is returned"),n=e[0].url),r(n)},onFailure:function(e){e&&console.warn(e),i(new Error("Internal Error - get3DSwym failed"))}})}))},getUsersGroupServiceUrl:function(e){var t=e?e.toUpperCase():null;return new r((function(e,r){1==s.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - getUsersGroupServiceUrl"),n.getServiceUrl({serviceName:"usersgroup",platformId:t,onComplete:function(r){1==s.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - getUsersGroupServiceUrl");var n="";t?n=r:r&&r.length&&r[0]&&(console.warn("getUsersGroupServiceUrl : PlatformId/Tenant is null so first url of the list is returned"),n=r[0].url),e(n)},onFailure:function(e){e&&console.warn(e),r(new Error("Internal Error - getUsersGroupServiceUrl failed"))}})}))},getCsrfToken:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return new r((function(r,n){if(!e)return console.warn("Internal Error - getCsrfToken failed because url is null"),void n(new Error("Internal Error - getCsrfToken failed"));t(e+"/api/index/tk",{method:"GET",type:"json",onComplete:function(t){r({token:t.result.ServerToken,url:e})},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - getCsrfToken failed"))}})}))},getMedia:function(e){if(e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._getMedia(e)}.bind(this));this._getMedia(e)},_getMedia:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return e.mediaId?e.url?void t(e.url+"/api/media/get",{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({request_id:"0",params:{id_media:e.mediaId}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(r){if(window.localStorage.getItem("3DWhiteboard.DownloadMediaAndQueries")||window.localStorage.getItem("3DSketch.DownloadMediaAndQueries")){(function(e){return new Promise((function(t){var r=JSON.parse(JSON.stringify(e));r.result.play.download_original_url.transient_url=r.result.orig_name,r.result.play.view.forEach((e=>{e.transient_url=r.result.orig_name}));var n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r)),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",e.result.id_media+".json"),document.body.appendChild(i),i.click(),window.open(e.result.play.download_original_url.transient_url_as_attachment),t()}))})(r)}var n=r.result;n.play&&n.play.wake_up_url&&""!==n.play.wake_up_url?t(n.play.wake_up_url,{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"GET",type:"json",onComplete:function(){e.onSuccessCB(n)},onFailure:function(t){t&&this._debugMode&&console.warn(t),e.onFailCB(new Error("Internal Error - getMedia failed"))}.bind(this)}):e.onSuccessCB(n)}.bind(this),onFailure:function(t){t&&this._debugMode&&console.warn(t),e.onFailCB(new Error("Internal Error - getMedia failed"))}.bind(this)}):(console.warn("Internal Error - getMedia failed because url is null"),void e.onFailCB(new Error("Internal Error - getMedia failed"))):(console.warn("Internal Error - getMedia failed because media ID is null"),void e.onFailCB(new Error("Internal Error - getMedia failed")))},getCurrentUser:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return new r((function(r,n){return e.url?e.token?void t(e.url+"/api/user/getcurrent",{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(e){r(e.result)},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - getCurrentUser failed"))}}):(console.warn("Internal Error - getCurrentUser failed because token is null"),void e.onFailCB(new Error("Internal Error - getCurrentUser failed"))):(console.warn("Internal Error - getCurrentUser failed because url is null"),void e.onFailCB(new Error("Internal Error - getCurrentUser failed")))}))},addMedia:function(e){if(e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._uploadMediaToSwym(e)}.bind(this));this._uploadMediaToSwym(e)},editMedia:function(e){if(e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,e.userFile?this._uploadMediaToSwym(e):this._updateMediaToSwym(e)}.bind(this));e.userFile?this._uploadMediaToSwym(e):this._updateMediaToSwym(e)},getDriveFile:function(e){if(e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._getDriveFile(e)}.bind(this));this._getDriveFile(e)},_getDriveFile:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;if(!e.objectId)return console.warn("Internal Error - _getDriveFile failed because object ID is null"),void e.onFailCB(new Error("Internal Error - _getDriveFile failed"));if(!e.url)return console.warn("Internal Error - _getDriveFile failed because url is null"),void e.onFailCB(new Error("Internal Error - _getDriveFile failed"));var r=e.url+"/resources/3ddrive/v1/bos/"+e.objectId,n=r+"/fileurl";e.platformId&&(r+="?tenant="+e.platformId.toUpperCase(),n+="?tenant="+e.platformId.toUpperCase()),t(r,{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"GET",type:"json",onComplete:function(r){t(n,{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"GET",type:"json",onComplete:function(t){var n=r;n.fileUrl=t.url,e.onSuccessCB(n)},onFailure:function(t){t&&console.warn(t),e.onFailCB(new Error("Internal Error - _getDriveFile failed"))}})},onFailure:function(t){t&&console.warn(t),e.onFailCB(new Error("Internal Error - _getDriveFile failed"))}})},getSpaceFile:function(e){let t=JSON.parse(JSON.stringify(e.asset));t.serverurl=e.url,t.tenant=e.platformId;require(["DS/3DSpaceDocumentConnector/3DSpaceDocumentConnector"],(function(r){(new r).open(t,(function(t){e.onSuccessCB(t)}),(function(t){t&&console.warn(t),e.onFailCB(new Error("Internal Error - getSpaceFile failed"))}))}))},getCommunities:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return new r((function(r,n){if(!e.url)return console.warn("Internal Error - getCommunities failed because url is null"),void n(new Error("Internal Error - getCommunities failed"));if(!e.token)return console.warn("Internal Error - getCommunities failed because token is null"),void n(new Error("Internal Error - getCommunities failed"));var i=e.page?e.page:1,o=e.limit?e.limit:10;t(e.url+"/api/community/listmycommunities/limit/"+o+"/page/"+i+"/creation_granted_for/media",{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(e){r(e.result)},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - getCommunities failed"))}})}))},getConversations:function(e){return new r((function(t,r){if(!e.url)return console.warn("Internal Error - getConversations failed because url is null"),void r(new Error("Internal Error - getConversations failed"));if(!e.token)return console.warn("Internal Error - getConversations failed because token is null"),void r(new Error("Internal Error - getConversations failed"));let n=s.getPreferenceValue("swymTenant");l.listConv({platformId:n}).then((e=>{t(e)}))}))},listMedia:function(e){return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._listMedia(e)}.bind(this))},_listMedia:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return e.community_id?e.token?e.limit?e.page?void t(e.url+"/api/media/list",{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({params:{community_id:e.community_id,limit:e.limit,page:e.page}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(t){e.onSuccessCB(t)},onFailure:function(t){t&&console.warn(t),e.onFailCB(new Error("Internal Error - listMedia failed"))}}):(console.warn("Internal Error - listMedia failed because page is null"),void e.onFailCB(new Error("Internal Error - listMedia failed"))):(console.warn("Internal Error - listMedia failed because limit is null"),void e.onFailCB(new Error("Internal Error - listMedia failed"))):(console.warn("Internal Error - listMedia failed because token is null"),void e.onFailCB(new Error("Internal Error - listMedia failed"))):(console.warn("Internal Error - listMedia failed because community_id is null"),void e.onFailCB(new Error("Internal Error - listMedia failed")))},search:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return new r((function(r,n){return e.url?e.token?void t(e.url+"/api/exalead/search?xrequestedwith=xmlhttprequest",{method:"POST",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},data:JSON.stringify({params:{legacyFormat:e.legacyFormat,query:e.query,contentType:e.contentType,refineUsingQuery:e.refineUsingQuery,nresults:e.nresults,start:e.start}}),timeout:15e3,onComplete:function(e){var t=JSON.parse(e);r(t)},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - search failed"))},onTimeout:function(){n(new Error("Internal Error - search timed out"))}}):(console.warn("Internal Error - search failed because token is null"),void n(new Error("Internal Error - search failed"))):(console.warn("Internal Error - search failed because url is null"),void n(new Error("Internal Error - search failed")))}))},deleteMedia:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return new r((function(r,n){return e.url?e.token?e.mediaId?void t(e.url+"/api/media/delete",{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({params:{id_media:e.mediaId}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(e){r()},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - deleteMedia failed"))}}):(console.warn("Internal Error - deleteMedia failed because url is null"),void n(new Error("Internal Error - deleteMedia failed"))):(console.warn("Internal Error - deleteMedia failed because token is null"),void n(new Error("Internal Error - deleteMedia failed"))):(console.warn("Internal Error - deleteMedia failed because url is null"),void n(new Error("Internal Error - deleteMedia failed")))}))},checkIfMediaExists:function(e){if(e.returnPromise)return new r(function(t){e.onSuccessCB=t,e.onFailCB=t,this._getMedia(e)}.bind(this));this._getMedia(e)},searchMedia:function(t){return new Promise((function(r,n){if(!t.url)return console.warn("Internal Error - searchMedia failed because url is null"),void n(new Error("Internal Error - searchMedia failed"));if(!t.platform_id)return console.warn("Internal Error - searchMedia failed because platform_id is null"),void n(new Error("Internal Error - searchMedia failed"));if(!t.current_user)return console.warn("Internal Error - searchMedia failed because current_user is null"),void n(new Error("Internal Error - searchMedia failed"));if(!t.search_data)return console.warn("Internal Error - searchMedia failed because search_data is null"),void n(new Error("Internal Error - searchMedia failed"));var i={label:"6WTagger-"+t.current_user+"-"+(new Date).getTime(),query:"",with_synthesis:!0,source:[t.source],select_predicate:["ds6w:media","ds6w:community","ds6w:label","ds6w:modified","swym:publicationState","ds6w:containerUid","ResourceURL","ds6w:type","ds6w:dataSource"],tenant:t.platform_id.toUpperCase(),nresults:t.page_size,start:t.page};if(t.order_field&&(i.order_field=t.order_field,i.order_by=t.order_by?t.order_by:"desc"),t.search_data.user&&(i.query+='[ds6w:responsibleUid]:("'+t.search_data.user+'")'),t.search_data.media_type&&(""!==i.query&&(i.query+=" AND "),t.search_data.media_type instanceof Array?(i.query+="(",t.search_data.media_type.forEach((e=>{"("!==i.query.slice(-1)&&(i.query+=" OR "),i.query+="swym"===t.source?'[ds6w:type]:"swym:'+e+'"':"[ds6w:type]:("+e+")"})),i.query+=")"):i.query+="swym"===t.source?'[ds6w:type]:("swym:'+t.search_data.media_type+'")':"[ds6w:type]:("+t.search_data.media_type+")"),t.search_data.rightsOfUser){let{edit:e,owner:r}=t.search_data.rightsOfUser;!0===e&&!1===r&&(i.query+=`(NOT [ds6w:responsibleUid]:("${t.search_data.rightsOfUser.userlogin}"))`)}t.search_data.threadID&&""!==i.query&&(i.query+=" AND ",i.query+="(",i.query+='community_id:("'+t.search_data.threadID+'")',i.query+=" OR ",i.query+='[ds6w:containerUid] :("'+t.search_data.threadID+'")',i.query+=")"),t.search_data.extensions&&(""!==i.query&&(i.query+=" AND "),i.query+="[ds6w:docExtension]:(",t.search_data.extensions.forEach((e=>{"("!==i.query.slice(-1)&&(i.query+=" OR "),i.query+=e})),i.query+=")"),t.search_data.label&&(""!==i.query&&(i.query+=" AND "),i.query+='([ds6w:label]:"'+t.search_data.label+'" OR [ds6w:label]:(*'+t.search_data.label+"*))"),t.search_data.label2&&s.getPreferenceValue("AppleVisionPro")&&(""!==i.query&&(i.query+=" AND "),i.query+='([ds6w:label]:"'+t.search_data.label2+'")'),t.exclude_internal_media&&"drive"!==t.source&&(""!==i.query&&(i.query+=" AND "),i.query+='NOT ( [ds6w:label]:"3DWhiteboard-InternalMedia*" OR [ds6w:label]:"3DSketch-InternalMedia*" )'),"swym"===t.source&&(i.specific_source_parameter={swym:{withDraft:t.include_draft,moderationMode:!1}}),"drive"===t.source&&(""!==i.query&&(i.query+=" AND "),i.query+="("+t.current_user+') AND [ds6w:dataSource]:"3DDrive"'),"3dspace"===t.source&&(""!==i.query&&(i.query+=" AND "),i.query+="("+t.current_user+")");var o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:e.Json.encode(i),url:t.url+"/search",onComplete:function(e){r(JSON.parse(e))},onFailure:function(e){r(e)}};a.authenticatedRequest(o.url,o)}))},searchMediaDrive:function(e){return new Promise((function(t,r){if(!e.url)return console.warn("Internal Error - searchMedia failed because url is null"),void r(new Error("Internal Error - searchMedia failed"));if(!e.platform_id)return console.warn("Internal Error - searchMedia failed because platform_id is null"),void r(new Error("Internal Error - searchMedia failed"));var n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},url:e.url+"/resources/3ddrive/v1/bos/"+(e.folderID?e.folderID:"DSROOT")+"/contents?tenant="+e.platform_id+"&page="+e.page+"&limit="+e.page_size+(e.folderID&&e.order?"&sort="+e.order:""),onComplete:function(e){t(JSON.parse(e))},onFailure:function(e){t(e)}};a.authenticatedRequest(n.url,n)}))},fetchFilePreviewDrive:function(e){return new Promise((function(t,r){if(!e.url)return console.warn("Internal Error - searchMedia failed because url is null"),void r(new Error("Internal Error - searchMedia failed"));if(!e.platform_id)return console.warn("Internal Error - searchMedia failed because platform_id is null"),void r(new Error("Internal Error - searchMedia failed"));if(!e.additionnalData||!e.additionnalData.medias)return console.warn("Internal Error - searchMedia failed because media to fetch preview for is null"),void r(new Error("Internal Error - searchMedia failed"));var n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},url:e.url+"/resources/3ddrive/v1/bos/previews?ids=",onComplete:function(e){t(JSON.parse(e))},onFailure:function(e){t(e)}};e.additionnalData.medias.forEach((e=>{n.url+=e.id+","})),n.url+="?tenant="+e.platform_id,a.authenticatedRequest(n.url,n)}))},searchMediaSpace:function(e){return new Promise((function(t,r){if(!e.url)return console.warn("Internal Error - searchMedia failed because url is null"),void r(new Error("Internal Error - searchMedia failed"));if(!e.platform_id)return console.warn("Internal Error - searchMedia failed because platform_id is null"),void r(new Error("Internal Error - searchMedia failed"));var n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},url:e.url+"/resources/enocsmrest/collabspaces"+(e.folderID?"/"+e.folderID+"/contents":"")+"?tenant="+e.platform_id+"&page="+e.page+"&limit="+e.page_size+(e.folderID&&e.order?"&sort="+e.order:""),onComplete:function(e){t(JSON.parse(e))},onFailure:function(e){t(e)}};a.authenticatedRequest(n.url,n)}))},fetchFilePreviewSpace:function(e){return new Promise((function(t,r){if(!e.url)return console.warn("Internal Error - searchMedia failed because url is null"),void r(new Error("Internal Error - searchMedia failed"));if(!e.platform_id)return console.warn("Internal Error - searchMedia failed because platform_id is null"),void r(new Error("Internal Error - searchMedia failed"));if(!e.additionnalData||!e.additionnalData.medias)return console.warn("Internal Error - searchMedia failed because media to fetch preview for is null"),void r(new Error("Internal Error - searchMedia failed"));var n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},url:e.url+"/resources/3ddrive/v1/bos/previews?ids=",onComplete:function(e){t(JSON.parse(e))},onFailure:function(e){t(e)}};e.additionnalData.medias.forEach((e=>{n.url+=e.id+","})),n.url+="?tenant="+e.platform_id,a.authenticatedRequest(n.url,n)}))},callPlatformWebService:function(e){if(e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._callPlatformWebService(e)}.bind(this));this._callPlatformWebService(e)},_callPlatformWebService:function(e){var t=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return e.api?e.token?e.params?e.url?void t(e.url+e.api,{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({request_id:"0",params:e.params}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(t){e.onSuccessCB(t)},onFailure:function(t){t&&this._debugMode&&console.warn(t),e.onFailCB(new Error("Internal Error - callPlatformWebService failed"))}.bind(this)}):(console.warn("Internal Error - callPlatformWebService failed because url is null"),void e.onFailCB(new Error("Internal Error - callPlatformWebService failed"))):(console.warn("Internal Error - callPlatformWebService failed because postparams is null"),void e.onFailCB(new Error("Internal Error - callPlatformWebService failed"))):(console.warn("Internal Error - callPlatformWebService failed because token is null"),void e.onFailCB(new Error("Internal Error - callPlatformWebService failed"))):(console.warn("Internal Error - callPlatformWebService failed because api is null"),void e.onFailCB(new Error("Internal Error - callPlatformWebService failed")))},forwardMediaSwym:function(t){let r=t.platformUrl,n=t.token,i=t.community_uri,o=t.content_uri,s=t.timeout||3e4;return new Promise(((t,l)=>{let u={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":n},type:"json",data:e.Json.encode({community_uri:i,content_uri:o,timeout:s}),url:r+"/api/media/forward",onComplete:function(e){t(e)},onFailure:function(e){t(e)}};a.authenticatedRequest(u.url,u)}))},getPersonalSpace:function(e){let t=e.url,r=e.token;return new Promise(((e,n)=>{let i={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":r},type:"json",url:t+"/api/personalspace",onComplete:function(t){e(t)},onFailure:function(t){e(t)}};a.authenticatedRequest(i.url,i)}))},getThreadTitleFromId:function(e){return new Promise(((t,r)=>{if(e.includes("community:rt")){let r=s.getPreferenceValue("swymTenant"),n=e.split("community:rt:")[1];l.getConv({dmId:n,platformId:r}).then((e=>{s.setPreferenceValue("threadType",e.community_type.toLowerCase());let r=e.topic?e.topic:u.get("conversationTitle");t(r)}))}else this.get3DSwym(s.getPreferenceValue("swymTenant")).then(c.getCsrfToken.bind(this)).then((n=>{var i={id:e},o=n.url,a=n.token;this.callPlatformWebService({url:o,params:i,api:"/api/community/get",token:a,returnPromise:!1,onSuccessCB:function(e){if(s.setPreferenceValue("threadType",e.result.community_type.toLowerCase()),"community"===e.result.community_type.toLowerCase())t(e.result.title);else if("dm"===e.result.community_type.toLowerCase()){let r=e.result.topic?e.result.topic:u.get("conversationTitle");t(r)}else if("personalspace"===e.result.community_type.toLowerCase()){let e=u.get("personalSpaceTitle");t(e)}},onFailCB:function(){r(new Error("[CAT3DWChooseThread] - getThreadTitle failed"))}})})).catch((e=>{console.log(e)}))}))},getUserGroups:function(e){return new Promise(function(t){var r=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;if(!e.usersGroupUrl)return void console.warn("Internal Error - getUserGroups failed because usersGroupUrl is null");if(!e.userID)return void console.warn("Internal Error - getUserGroups failed because userID is null");if(!e.person_ident)return void console.warn("Internal Error - getUserGroups failed because person_ident is null");let n=e.skip?e.skip:0,i=e.top?e.top:50,o="?person_ident="+e.person_ident;o+="&skip="+n,o+="&top="+i,r(e.usersGroupUrl+"/3drdfpersist/resources/v1/usersgroup/users/locate"+o,{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({users:[e.userID]}),headers:{"Content-Type":"application/json"},onComplete:function(e){t(e)},onFailure:function(e){console.warn("Failed to get user groups"),t(null)}.bind(this)})}.bind(this))},_getDFSTicket:function(e){let t=s.getPreferenceValue("M3DEMobile"),n=t?a.proxifiedRequest:a.authenticatedRequest,i=e.edit?{tickets_request:["original"]}:{container_id:e.container_id,is_illustration:e.is_illustration,tickets_request:["original"]},o=`${e.url}/api/v2/media/${e.edit?e.mediaId:""}`;return new r((function(r,a){if(!e.url)return console.warn("Internal Error - getDFSTicket failed because url is null"),void a(new Error("Internal Error - getDFSTicket failed"));n(o,{proxy:t?"passport":void 0,method:e.edit?"PUT":"POST",data:JSON.stringify(i),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(e){let t=JSON.parse(e),n=t.result.tickets_info?.at(0)??null,i=t.result.subject6wuri??null;r({ticket:n,subject6wuri:i})},onFailure:function(e){e&&console.warn(e),a(new Error("Internal Error - getDFSTicket failed"))}})}))},_uploadMediatoDFS:function(e,t){let n=new FormData;n.append("__fcs__nohtml","true"),n.append("__fcs__jobTicket",e.exportString),n.append("file_0",t);let i=s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;return new r((function(t,r){if(!e.actionURL)return console.warn("Internal Error - uploadMediatoDFS failed because url is null"),void r(new Error("Internal Error - uploadMediatoDFS failed"));i(e.actionURL,{responseType:"text",type:"media",method:"POST",data:n,timeout:432e5,onComplete:function(e){t(e)},onFailure:function(e){e&&console.warn(e),r(new Error("Internal Error - uploadMediatoDFS failed"))}})}))},_updateMediaToSwym:function(e,t,r){let n=t?r.subject6wuri:e.mediaId,i=t?{container_id:e.container_id,publication_state:e.publishMode?"PUBLISHED":"DRAFT",receipts:[t],title:e.title}:{tickets_request:["original"]};return new Promise((function(t,r){(s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest)(e.url+"/api/v2/media/"+n,{proxy:s.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"PUT",type:"json",data:JSON.stringify(i),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},timeout:432e5,onComplete:function(t){if(t.errorcode){var r={error:new Error("Internal Error - uploadMediaToSwym failed")};return e.onFailCB(r),void console.warn("Internal Error - uploadMediaToSwym failed")}e.onSuccessCB(t)},onFailure:function(t,r){t&&console.warn(t);var n=new Error("Internal Error - uploadMediaToSwym failed");r&&r.errorcode&&(n.errorcode=r.errorcode);var i={error:n};e.onFailCB(i)},onTimeout:function(t){t&&console.warn(t);var r=new Error("Internal Error - uploadMediaToSwym timeout");r.isTimeout=!0;var n={error:r};e.onFailCB(n)}})}))},_uploadMediaToSwym:function(e){let t=s.getPreferenceValue("threadId");t&&(e.container_id=t),this._getDFSTicket(e).then(function(t){this._uploadMediatoDFS(t.ticket,e.userFile).then(function(r){this._updateMediaToSwym(e,r,t)}.bind(this))}.bind(this))},getAIAssistants:function(){return new e.Promise((function(e,t){let r="https://"+c.cacheUrlAIAssistantInfra+"/api/v1/assistants?latest=true";(s.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest)(r,{method:"GET",timeout:5e4,headers:{"content-type":"application/json"},onComplete:function(t){let r=t?JSON.parse(t):"";e(r)},onFailure:function(e,r,n){t(e)}})}))}});return e.namespace("DS/CAT3DWInfra/CAT3DWPlateformServices",c)})),define("DS/CAT3DWInfra/CAT3DWUserGroupService",["UWA/Class","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager"],(function(e,t,r){"use strict";var n=e.extend({init:function(){this._usersGroupServiceUrl=null,this._groups=new Map},getGroups:async function(e){if(!this._groups.has(e)){this._usersGroupServiceUrl||(this._usersGroupServiceUrl=await t.getUsersGroupServiceUrl(r.getPreferenceValue("swymTenant")));let n=20,i=n,o=0,a=await this._callGetUserGroups(e,i,o),s=[];for(a&&a.total_groups&&a.users&&a.users.length&&(s=a.users[0].groups);a.total_groups!==a.groups_browsed;)o=i+0,i+=n,a=await this._callGetUserGroups(e,i,o),a.users&&a.users.length&&(s=s.concat(a.users[0].groups));this._groups.set(e,s)}let n=this._groups.get(e);return Promise.resolve(n)},_callGetUserGroups:async function(e,r,n){return await t.getUserGroups({usersGroupUrl:this._usersGroupServiceUrl,userID:e,person_ident:"loginid",skip:n,top:r})},isMemberOfGroup:function(e,t){let r=!1,n=t;n.indexOf("uuid")<=-1&&(n="uuid:"+n);for(let t=0;t<e.length;t++)e[t]===n&&(r=!0);return r}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWUserGroupService",n)})),define("DS/CAT3DWInfra/CAT3DWFileServices",["UWA/Class","DS/CAT3DWInfra/CAT3DWPreferenceManager","WebappsUtils/WebappsUtils","text!DS/CAT3DWInfra/assets/CAT3DWFileTypes.json"],(function(e,t,r,n){"use strict";var i=e.extend({init:function(){this._fileTypes=JSON.parse(n),this._unsupportedKey="UNSUPPORTED",this._errorImageName="xl_thumb_error.png",this._processingImageName="xl_thumb_waiting_processing.png",this._defaultMaxSize=5e7},getMaxSize:function(e){if(!e)return console.warn("[CAT3DWFileServices] iType paramater is undefined"),this._defaultMaxSize;if(!i.prototype.platformSupportedExtensions)return console.warn("[CAT3DWFileServices] Platform supported extensions/maxsize list is undefined"),this._defaultMaxSize;let t=i.prototype.platformSupportedExtensions.maxsize;return t[e]?t[e]:this._defaultMaxSize},getReadableMaxSize:function(e){var t=this.getMaxSize(e);if(!t)return"";var r=["Bytes","KB","MB","GB","TB"],n=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return 0===n?t+" "+r[n]:(t/Math.pow(1024,n)).toFixed(1)+" "+r[n]},setPlatformSupportedExtensions:function(e){i.prototype.platformSupportedExtensions=e},getPlatformSupportedExtensions:function(){return i.prototype.platformSupportedExtensions},dispose:function(){this._fileTypes=null,this._unsupportedKey=null,this._errorImageName=null,this._processingImageName=null},getSupportedExtensions:function(e){if(!e)return this._fileTypes[this._unsupportedKey].extensions;for(var t in this._fileTypes)if(this._fileTypes[t].label===e)return this._fileTypes[t].extensions;return this._fileTypes[this._unsupportedKey].extensions},getSupportedExtensionsSanInternal:function(e){if(!e)return this._fileTypes[this._unsupportedKey].extensions;for(var t in this._fileTypes)if(this._fileTypes[t].label===e){let e=this._fileTypes[t].extensions;if(this._fileTypes[t].internalextensions)for(let r=0;r<this._fileTypes[t].internalextensions.length;r++){let n=e.indexOf(this._fileTypes[t].internalextensions[r]);n>-1&&e.splice(n,1)}return e}return this._fileTypes[this._unsupportedKey].extensions},getTypeObjFromExtension:function(e){if(!e)return this._fileTypes[this._unsupportedKey];for(var t in this._fileTypes)for(var r=0;r<this._fileTypes[t].extensions.length;r++)if(this._fileTypes[t].extensions[r]===e)return this._fileTypes[t];return this._fileTypes[this._unsupportedKey]},extractExtensionFromName:function(e){return e?e.match(/\.([^.]*)$/)[1].toLowerCase():null},extractTitleFromName:function(e){return e?e.replace(/\.([^.]*)$/,""):null},getExtensionFromMIMEType:function(e){return"video/x-msvideo"===e?"avi":"image/bmp"===e?"bmp":"image/gif"===e?"gif":"image/jpeg"===e?"jpeg":"video/mpeg"===e?"mpeg":"image/png"===e?"png":"application/pdf"===e?"pdf":"image/svg+xml"===e?"svg":"image/webp"===e?"webp":void 0},getErrorImageName:function(){return this._errorImageName},getProcessingImageName:function(){return this._processingImageName},getErrorImagePlaceholderUrl:function(){return r.getWebappsAssetUrl("CAT3DWInfra","placeholders/"+this._errorImageName)},getProcessingImagePlaceholderUrl:function(){return r.getWebappsAssetUrl("CAT3DWInfra","placeholders/"+this._processingImageName)},createInternalTitle:function(){return this._createMediaTitle("-InternalMedia ")},createTitle:function(){return this._createMediaTitle("-Media ")},_createMediaTitle:function(e){var r="",n=this.getNowDate();return"whiteboard"===t.getPreferenceValue("appMode")?r+="3DWhiteboard":r+="3DSketch",r+=e+n},createProjectTitle:function(){var e="";return"whiteboard"===t.getPreferenceValue("appMode")?e+="My 3DWhiteboard":e+="My 3DSketch",e},getProjectExtension:function(){var e="";return"whiteboard"===t.getPreferenceValue("appMode")?e+="3dwb":e+="3dskt",e},getNowDate:function(){var e="",t=new Date;return e+=t.toLocaleString("default",{month:"short"})+" ",e+=t.getDate()+" ",e+=t.getFullYear()+" ",e+=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}}),o=JSON.parse(n);for(var a in o)i["TYPE_"+a.toUpperCase()]=o[a].label,i["FORMAT_"+o[a].format.toUpperCase()]=o[a].format;return i.STATUS_OK="fileok",i.STATUS_KO="fileko",i.STATUS_PROCESSING="fileprocessing",i.VIDEO_STREAM_BEST="best",i.VIDEO_STREAM_UPPERMEDIUM="uppermedium",i.VIDEO_STREAM_LOWERMEDIUM="lowermedium",i.VIDEO_STREAM_LOWEST="lowest",i})),define("DS/CAT3DWInfra/CAT3DW3DDriveServices",["UWA/Class","UWA/Promise","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWQueuePromise","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfra/CAT3DWFileServices","DS/WAFData/WAFData"],(function(e,t,r,n,i,o,a){"use strict";return e.extend({init:function(e){this.initPlatform(e),this._fileServices=new o},initPlatform:function(e){this._platformId=e.platformId,this._platformUrl=e.platformUrl,this._platformId||this._platformUrl||console.warn("[3DDriveServices] A platformId or a platformUrl must be provided")},getFile:function(e){return new t(function(t,r){this.getFiles([e],null).then((function(e){t(e[0])})).catch((function(e){e&&console.log(e),r(new Error("Get file failed"))}))}.bind(this))},getFiles:function(e,i){return new t(function(o,a){if(!e){var s="Can't get files, list of files is null";return console.warn(s),i&&(i=null),void a(new Error(s))}(function(){return this._platformUrl?new t(function(e){e(this._platformUrl)}.bind(this)):r.get3DDrive(this._platformId)}).bind(this)().then(function(t){var s=Math.round(90/e.length);this._inc=0;for(var l=[],u=function(e,n){e&&!e.associatedData&&(e.associatedData={}),e&&e.objectId?r.getDriveFile({url:t,objectId:e.objectId,platformId:this._platformId,returnPromise:!1,onSuccessCB:function(e,t){this._inc++;var r=this._inc*s<=100?this._inc*s:100;i&&i(r),t.processed_file_id=e.objectId,t.associatedData=e.associatedData,n(t)}.bind(this,e),onFailCB:function(e){this._inc++;var t=this._inc*s<=100?this._inc*s:100;i&&i(t),n({processed_file_id:e.objectId,associatedData:e.associatedData})}.bind(this,e)}):n({processed_file_id:null,associatedData:e?e.associatedData:{}})}.bind(this),c=0;c<e.length;c++)l.push(new n(u.bind(this,e[c])));(new n).all(l,5,{delay:600,limit:5}).then(function(e){i&&(i=null);var t=this._parseDriveGetFilesData(e);o(t)}.bind(this)).catch((function(e){i&&(i=null),e&&console.log(e),a(new Error("Get files failed"))}))}.bind(this))}.bind(this))},_parseDriveGetFilesData:function(e){if(!e||!e.length)return[];for(var t=[],r={},n=0;n<e.length;n++)if(e[n]&&e[n].processed_file_id)if(e[n].id||!e[n].processed_file_id){var a=this._fileServices.getTypeObjFromExtension(e[n].extension);(r={objectId:e[n].id,status:o.STATUS_OK,title:e[n].title,extension:e[n].extension,format:a.format,type:a.label,url:e[n].fileUrl,size:e[n].size,associatedData:e[n].associatedData}).url&&i.getPreferenceValue("M3DEMobile")&&(r.url=UWA.Data.proxifyUrl(r.url,{proxy:"passport"})),t.push(r)}else t.push({objectId:e[n].processed_file_id,status:o.STATUS_KO,format:o.FORMAT_2D,type:o.TYPE_IMAGE,url:this._fileServices.getErrorImagePlaceholderUrl(),title:"Error",extension:this._fileServices.extractExtensionFromName(this._fileServices.getErrorImageName()),size:0,associatedData:e[n].associatedData});else t.push({objectId:null,status:null,format:o.FORMAT_NONE,type:null,url:null,associatedData:e[n]?e[n].associatedData:{}});return t},getDFAFiles:function(e,s){return new t(function(t,l){if(!e){var u="Can't get files, list of files is null";return console.warn(u),s&&(s=null),void l(new Error(u))}(function(){return r.getDFA(this._platformId)}).bind(this)().then(function(r){if(r){var u=Math.round(90/e.length);this._inc=0;var c=[],d=function(e,t){var n=void 0,l=this._fileServices.extractExtensionFromName(e.title);if(this._fileServices.getSupportedExtensions(o.TYPE_OFFICE).indexOf(l)>-1&&(n="pdf"),n){var c=r+"/api/v2/modeler/dsdo/DerivedOutputs/locate?withSyncStatus=yes",d={specificationFilter:[{format:n,filterConversionParams:[{key:"streamId",value:"visualization"}]}],referencedObject:[{source:"3DDRIVE",id:e.objectId,type:"DriveFile"}]};d.specificationFilter[0].notifyIfMissing=!0;var f=i.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;f(c,{method:"POST",headers:{"Content-Type":"application/json",SecurityContext:"preferred"},type:"json",data:JSON.stringify(d),onComplete:function(e,n){if(n.derivedOutputs&&n.derivedOutputs[0]&&n.derivedOutputs[0].derivedOutputFormats&&n.derivedOutputs[0].derivedOutputFormats[0]&&n.derivedOutputs[0].derivedOutputFormats[0].lastConversionResult&&!0===n.derivedOutputs[0].derivedOutputFormats[0].lastConversionResult.isSync&&"OK"===n.derivedOutputs[0].derivedOutputFormats[0].lastConversionResult.status){var i=r+"/api/v2/modeler/dsdo/DerivedOutputs/"+n.derivedOutputs[0].id+"/DerivedOutputFiles/"+n.derivedOutputs[0].derivedOutputFormats[0].id+"/DownloadTicket";f(i,{method:"GET",headers:{"Content-Type":"application/json"},type:"json",onComplete:function(e,r){var n=r.data[0].dataelements,i=n.ticketURL+"?__fcs__jobTicket="+encodeURIComponent(n.ticket)+"&jobTicket=__fcs__jobTicket&__fcs__attachment=true";this._inc++;var o=this._inc*u<=100?this._inc*u:100;s&&s(o),e.orignalUrl=e.url,e.orignalType=e.type,e.orignalExtension=e.extension,e.url=i,e.type="pdf",e.extension="pdf",e.title=this._fileServices.extractTitleFromName(e.title)+".pdf",e.DFAStatus="CONVERSION_OK",t(e)}.bind(this,e),onFailure:function(e,r){this._inc++;var n=this._inc*u<=100?this._inc*u:100;s&&s(n),e.DFAStatus="CONVERSION_INPROCESS",t(e)}.bind(this,e)})}else{this._inc++;var o=this._inc*u<=100?this._inc*u:100;s&&s(o),e.DFAStatus="CONVERSION_INPROCESS",t(e)}}.bind(this,e),onFailure:function(e,r){this._inc++;var n=this._inc*u<=100?this._inc*u:100;s&&s(n),e.DFAStatus="CONVERSION_INPROCESS",t(e)}.bind(this,e)})}else t(e)}.bind(this);for(f=0;f<e.length;f++)c.push(new n(d.bind(this,e[f])));(new n).all(c,5,{delay:600,limit:5}).then(function(e){s&&(s=null),t(e)}.bind(this)).catch((function(e){s&&(s=null),e&&console.log(e),l(new Error("Get files failed"))}))}else{console.log("DFA not present.");for(var f=0;f<e.length;f++)e[f].DFAStatus="CONVERSION_UNAVAILABLE";t(e)}}.bind(this))}.bind(this))}})})),define("DS/CAT3DWInfra/CAT3DW3DSpaceServices",["UWA/Class","UWA/Promise","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWQueuePromise","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfra/CAT3DWFileServices","DS/WAFData/WAFData","DS/WebUtils/WebServices"],(function(e,t,r,n,i,o,a,s){"use strict";return e.extend({init:function(e){this.initPlatform(e),this._fileServices=new o},initPlatform:function(e){this._platformId=e.platformId,this._platformUrl=e.platformUrl,this._platformId||this._platformUrl||console.warn("[3DSpaceServices] A platformId or a platformUrl must be provided")},getFile:function(e){return new t(function(t,r){this.getFiles([e],null).then((function(e){t(e[0])})).catch((function(e){e&&console.log(e),r(new Error("Get file failed"))}))}.bind(this))},getFiles:function(e,o){return new t(function(a,l){if(!e){var u="Can't get files, list of files is null";return console.warn(u),o&&(o=null),void l(new Error(u))}(function(){return this._platformUrl?new t(function(e){e(this._platformUrl)}.bind(this)):r.get3DSpace(this._platformId)}).bind(this)().then(function(t){var u=Math.round(90/e.length);this._inc=0;for(var c=[],d=function(e,n){if(e&&!e.associatedData&&(e.associatedData={}),e&&e.physicalid)if("VPMReference"===e.dtype||"Drawing"===e.dtype&&i.getPreferenceValue("Activate3DSpaceDrawing")){this._inc++;var a=this._inc*u<=100?this._inc*u:100;o&&o(a);let r={};r.associatedData=e.associatedData,r.spaceData={},r.spaceData.contextId=e.contextId,r.spaceData.dtype=e.dtype,r.spaceData.type=e.type,r.spaceData.physicalid=e.physicalid,r.spaceData.provider=e.provider,r.spaceData.requiredAuth=e.requiredAuth,r.spaceData.tenant=e.tenant,r.spaceData.serverURL=t,r.spaceData.displayPreview=e.displayPreview,r.processed_file_id=e.physicalid,r.title=e.displayName+".3dSpace",r.extension="3dSpace",n(r)}else"DOCUMENTS"!==e.dtype&&"Document"!==e.dtype&&"CONTROLLED DOCUMENTS"!==e.dtype?s.getParentsType({serverUrl:t,tenant:e.tenant,contextid:e.contextId,physicalid:e.physicalid,dtype:e.dtype,onFailure:function(t){this._inc++;var r=this._inc*u<=100?this._inc*u:100;o&&o(r),n({processed_file_id:e.physicalid,associatedData:e.associatedData})},onComplete:function(r){let a,s=!1;for(var l=r.length;l--;)if(a=r[l],a&&("VPMReference"===a||"Drawing"===a&&i.getPreferenceValue("Activate3DSpaceDrawing"))){s=!0;break}this._inc++;var c=this._inc*u<=100?this._inc*u:100;if(o&&o(c),s){let r={};r.associatedData=e.associatedData,r.spaceData={},r.spaceData.contextId=e.contextId,r.spaceData.dtype=e.dtype,r.spaceData.parentType=a,r.spaceData.type=e.type,r.spaceData.physicalid=e.physicalid,r.spaceData.provider=e.provider,r.spaceData.requiredAuth=e.requiredAuth,r.spaceData.tenant=e.tenant,r.spaceData.serverURL=t,r.spaceData.displayPreview=e.displayPreview,r.processed_file_id=e.physicalid,r.title=e.displayName+".3dSpace",r.extension="3dSpace",n(r)}else n({processed_file_id:e.physicalid,associatedData:e.associatedData})}}):r.getSpaceFile({url:t,asset:e,platformId:this._platformId,onSuccessCB:function(e,t){this._inc++;var r=this._inc*u<=100?this._inc*u:100;o&&o(r),t.processed_file_id=e.physicalid,t.associatedData=e.associatedData,t.type=this._fileServices.extractExtensionFromName(t.filename),t.extension=this._fileServices.extractExtensionFromName(t.filename),t.title=t.filename,n(t)}.bind(this,e),onFailCB:function(e){this._inc++;var t=this._inc*u<=100?this._inc*u:100;o&&o(t),n({processed_file_id:e.physicalid,associatedData:e.associatedData})}.bind(this,e)});else n({processed_file_id:null,associatedData:e?e.associatedData:{}})}.bind(this),f=0;f<e.length;f++)c.push(new n(d.bind(this,e[f])));(new n).all(c,5,{delay:600,limit:5}).then(function(e){o&&(o=null);var t=this._parseDriveGetFilesData(e);a(t)}.bind(this)).catch((function(e){o&&(o=null),e&&console.log(e),l(new Error("Get files failed"))}))}.bind(this))}.bind(this))},_parseDriveGetFilesData:function(e){if(!e||!e.length)return[];for(var t=[],r={},n=0;n<e.length;n++)if(e[n]&&e[n].processed_file_id){var a=this._fileServices.getTypeObjFromExtension(e[n].extension);(r={physicalid:e[n].id,status:o.STATUS_OK,title:e[n].title,extension:e[n].extension,format:a.format,type:a.label,url:e[n].url,size:e[n].size,associatedData:e[n].associatedData,spaceData:e[n].spaceData}).url&&i.getPreferenceValue("M3DEMobile")&&(r.url=UWA.Data.proxifyUrl(r.url,{proxy:"passport"})),t.push(r)}else t.push({physicalid:null,status:null,format:o.FORMAT_NONE,type:null,url:null,associatedData:e[n]?e[n].associatedData:{}});return t},getDFAFiles:function(e,s){return new t(function(t,l){if(!e){var u="Can't get files, list of files is null";return console.warn(u),s&&(s=null),void l(new Error(u))}(function(){return r.getDFA(this._platformId)}).bind(this)().then(function(r){if(r){var u=Math.round(90/e.length);this._inc=0;var c=[],d=function(e,t){var n=void 0,l=this._fileServices.extractExtensionFromName(e.title);if(this._fileServices.getSupportedExtensions(o.TYPE_OFFICE).indexOf(l)>-1&&(n="pdf"),n){var c=r+"/api/v2/modeler/dsdo/DerivedOutputs/locate?withSyncStatus=yes",d={specificationFilter:[{format:n,filterConversionParams:[{key:"streamId",value:"visualization"}]}],referencedObject:[{source:"3DDRIVE",id:e.objectId,type:"DriveFile"}]};d.specificationFilter[0].notifyIfMissing=!0;var f=i.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest;f(c,{method:"POST",headers:{"Content-Type":"application/json",SecurityContext:"preferred"},type:"json",data:JSON.stringify(d),onComplete:function(e,n){if(n.derivedOutputs&&n.derivedOutputs[0]&&n.derivedOutputs[0].derivedOutputFormats&&n.derivedOutputs[0].derivedOutputFormats[0]&&n.derivedOutputs[0].derivedOutputFormats[0].lastConversionResult&&!0===n.derivedOutputs[0].derivedOutputFormats[0].lastConversionResult.isSync&&"OK"===n.derivedOutputs[0].derivedOutputFormats[0].lastConversionResult.status){var i=r+"/api/v2/modeler/dsdo/DerivedOutputs/"+n.derivedOutputs[0].id+"/DerivedOutputFiles/"+n.derivedOutputs[0].derivedOutputFormats[0].id+"/DownloadTicket";f(i,{method:"GET",headers:{"Content-Type":"application/json"},type:"json",onComplete:function(e,r){var n=r.data[0].dataelements,i=n.ticketURL+"?__fcs__jobTicket="+encodeURIComponent(n.ticket)+"&jobTicket=__fcs__jobTicket&__fcs__attachment=true";this._inc++;var o=this._inc*u<=100?this._inc*u:100;s&&s(o),e.orignalUrl=e.url,e.orignalType=e.type,e.orignalExtension=e.extension,e.url=i,e.type="pdf",e.extension="pdf",e.title=this._fileServices.extractTitleFromName(e.title)+".pdf",e.DFAStatus="CONVERSION_OK",t(e)}.bind(this,e),onFailure:function(e,r){this._inc++;var n=this._inc*u<=100?this._inc*u:100;s&&s(n),e.DFAStatus="CONVERSION_INPROCESS",t(e)}.bind(this,e)})}else{this._inc++;var o=this._inc*u<=100?this._inc*u:100;s&&s(o),e.DFAStatus="CONVERSION_INPROCESS",t(e)}}.bind(this,e),onFailure:function(e,r){this._inc++;var n=this._inc*u<=100?this._inc*u:100;s&&s(n),e.DFAStatus="CONVERSION_INPROCESS",t(e)}.bind(this,e)})}else t(e)}.bind(this);for(f=0;f<e.length;f++)c.push(new n(d.bind(this,e[f])));(new n).all(c,5,{delay:600,limit:5}).then((function(e){s&&(s=null),t(e)})).catch((function(e){s&&(s=null),e&&console.log(e),l(new Error("Get files failed"))}))}else{console.log("DFA not present.");for(var f=0;f<e.length;f++)e[f].DFAStatus="CONVERSION_UNAVAILABLE";t(e)}}.bind(this))}.bind(this))}})})),define("DS/CAT3DWInfra/CAT3DW3DSwymMediaServices",["UWA/Controls/Abstract","UWA/Core","UWA/Promise","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWQueuePromise","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfra/CAT3DWFileServices","DS/PlatformAPI/PlatformAPI"],(function(e,t,r,n,i,o,a,s){"use strict";return e.singleton({init:function(){this._runningTokenRequest=null,this._token=null,this._tokenCreationTime=0,this._tokenExpirationTime=1e4,this._maxNbGet=5,this._maxNbGetDelay=500,this._listOfMediaToGet=[],this._nbRunningGet=0,this._getStartTime=0,this._getIntervalToken=void 0,this._objectsToNotify=new Map},initWithTenant:function(e){this._platformId=e.platformId,this._platformUrl=e.platformUrl,this._fileServices=new a,this._errorImageName=this._fileServices.getErrorImageName();let t=o.getPreferenceValue("swymTenant");this.platformtopicCreation="tenant_"+t+"_processing_results",s.subscribe(this.platformtopicCreation,this.platformCallback.bind(this)),this._platformId||this._platformUrl||console.warn("A platformId or a platformUrl must be provided")},dispose:function(){this._platformId=null,this._platformUrl=null,this._fileServices&&this._fileServices.dispose(),this._fileServices=null,this._errorImageName=null,this._runningTokenRequest=null,this._token=null,this._tokenCreationTime=null,this._tokenExpirationTime=null,this._maxNbGet=null,this._maxNbGetDelay=null,this._listOfMediaToGet=[],this._nbRunningGet=null,this._getStartTime=null,this._getIntervalToken=null,this._objectsToNotify=null,s.unsubscribe(this.platformtopicCreation)},getToken:function(e){return this._runningTokenRequest?this._runningTokenRequest.then((e=>e)):Date.now()-this._tokenCreationTime>this._tokenExpirationTime?(this._tokenCreationTime=Date.now(),this._runningTokenRequest=n.getCsrfToken(e),this._runningTokenRequest.then((e=>(this._runningTokenRequest=null,this._token=e,e)))):new Promise((e=>{e(this._token)}))},getPlatformUrl:function(){return this._platformUrl?new r(function(e){e(this._platformUrl)}.bind(this)):n.get3DSwym(this._platformId)},requestSingleMedia:function(e,t=!0){return new Promise((r=>{this._listOfMediaToGet.push({media:e,callback:e=>{if(t){var n=this._parseSwymGetMediasData([e]);r(n[0])}else r(e)}}),this._processListOfMedia()}))},getMediaWhenProcessed:function(e){let t=this._objectsToNotify.get(e.mediaID);if(t)t.push(e.object);else{let t=[];t.push(e.object),this._objectsToNotify.set(e.mediaID,t)}},platformCallback:function(e){if(e.uri){let t=this._objectsToNotify.get(e.uri);t&&(t.forEach((function(t){t.platformCallback(e)})),this._objectsToNotify.delete(e.uri))}},_processListOfMedia:function(){Date.now()-this._getStartTime>this._maxNbGetDelay&&(this._getStartTime=Date.now(),this._nbRunningGet=0);let e=null;for(;this._nbRunningGet<this._maxNbGet&&this._listOfMediaToGet.length>0;)this._nbRunningGet++,e=this._listOfMediaToGet.shift(),this._runGetMedia(e.media,e.callback);0===this._listOfMediaToGet.length?(clearInterval(this._getIntervalToken),this._getIntervalToken=void 0):this._getIntervalToken||(this._getIntervalToken=setInterval(this._processListOfMedia.bind(this),this._maxNbGetDelay))},_runGetMedia:function(e,t){this.getPlatformUrl().then(this.getToken.bind(this)).then((r=>{n.getMedia({url:r.url,mediaId:e.mediaId,token:r.token,returnPromise:!1,onSuccessCB:r=>{r.processed_media_id=e.mediaId,r.associatedData=e.associatedData,t(r)},onFailCB:()=>{t({processed_media_id:e.mediaId,associatedData:e.associatedData})}})}))},getMedia:function(e){return new r(function(t,r){this.getMedias([e],null).then((function(e){t(e[0])})).catch((function(e){e&&console.log(e),r(new Error("Get media failed"))}))}.bind(this))},getMedias:function(e,t,o){return new r(function(a,s){if(!e){var l="Can't get medias, list of medias is null";return console.warn(l),t&&(t=null),void s(new Error(l))}(function(){return this._platformUrl?new r(function(e){e(this._platformUrl)}.bind(this)):n.get3DSwym(this._platformId)}).bind(this)().then(n.getCsrfToken.bind(this)).then(function(r){var l=Math.round(100/e.length);this._inc=0;for(var u=[],c=0;c<e.length;c++)u.push(new i(function(e,i){e&&!e.associatedData&&(e.associatedData={}),e&&e.mediaId?n.getMedia({url:r.url,mediaId:e.mediaId,token:r.token,returnPromise:!1,onSuccessCB:function(e,r){this._inc++;var n=this._inc*l<=100?this._inc*l:100;t&&t(n),r.processed_media_id=e.mediaId,r.associatedData=e.associatedData,i(r);var a=this._parseSwymGetMediasData([r]);o&&o(a[0])}.bind(this,e),onFailCB:function(e){this._inc++;var r=this._inc*l<=100?this._inc*l:100;t&&t(r),o&&o(e),i({processed_media_id:e.mediaId,associatedData:e.associatedData})}.bind(this,e)}):i({processed_media_id:null,associatedData:e?e.associatedData:{}})}.bind(this,e[c])));(new i).all(u,5,{delay:600,limit:5}).then(function(e){t&&(t=null);var r=this._parseSwymGetMediasData(e);a(r)}.bind(this)).catch((function(e){t&&(t=null),e&&console.log(e),s(new Error("Get medias failed"))}))}.bind(this)).catch((function(e){t&&(t=null),e&&console.log(e),s(new Error("Get medias failed"))}))}.bind(this))},setMedia:function(e){return new r(function(t,r){this.setMedias([e],null).then((function(e){t(e[0])})).catch((function(e){e&&console.log(e),r(new Error("Set media failed"))}))}.bind(this))},setMedias:function(e,t){return new r(function(a,s){if(!e){var l="Can't set medias, list of medias is null";return console.warn(l),t&&(t=null),void s(new Error(l))}(function(){return this._platformUrl?new r(function(e){e(this._platformUrl)}.bind(this)):n.get3DSwym(this._platformId)}).bind(this)().then(n.getCsrfToken.bind(this)).then(function(r){var l=Math.round(100/e.length);this._inc=0;for(var u=[],c=0;c<e.length;c++)u.push(new i(function(e,i){if(e){var a={url:r.url,token:r.token,returnPromise:!1,userFile:e.userFile,title:e.title,mediaId:e.mediaId,edit:e.edit,publishMode:e.publishMode,is_illustration:e.is_illustration,onSuccessCB:function(e,r){r.associatedData=e.associatedData;var n=this._parseSwymSetMediaData(r);this._inc++;var o=this._inc*l<=100?this._inc*l:100;t&&t(o,n),i(n)}.bind(this,e),onFailCB:function(e,r){this._inc++;var n=this._inc*l<=100?this._inc*l:100;r.associatedData=e.associatedData;var o=this._parseSwymSetMediaData(r);t&&t(n,o),i(o)}.bind(this,e)};o.getPreferenceValue("ODTMode")&&(a.type=e.associatedData.mediaObj.getType()),e.edit?n.editMedia(a):n.addMedia(a)}else i()}.bind(this,e[c])));(new i).all(u,3,{delay:2e3,limit:3}).then((function(e){t&&(t=null),a(e)})).catch((function(e){t&&(t=null),e&&console.log(e),s(new Error("Set medias failed"))}))}.bind(this)).catch((function(e){t&&(t=null),e&&console.log(e),s(new Error("Set medias failed"))}))}.bind(this))},deleteMedia:function(e){return new r(function(t,r){this.getPlatformUrl().then(n.getCsrfToken.bind(this)).then((i=>{n.deleteMedia({token:i.token,url:i.url,mediaId:e.subject6wuri}).then((function(){t()})).catch((function(){r(new Error("Delete media failed"))}))})).catch((function(){r(new Error("Delete media failed"))}))}.bind(this))},_parseSwymGetMediasData:function(e){if(!e||!e.length)return[];for(var r=[],n={},i=0;i<e.length;i++)if(e[i]&&e[i].processed_media_id)if(e[i].associatedData&&!0===e[i].associatedData.fullData)r.push(e[i]);else if(e[i].subject6wuri||!e[i].processed_media_id){if(n={published:parseInt(e[i].published),mediaId:e[i].subject6wuri,threadId:e[i]._community?e[i]._community.subject6wuri:void 0,title:e[i].title,orig_name:e[i].orig_name,extension:this._fileServices.extractExtensionFromName(e[i].orig_name),format:e[i].media_type===a.TYPE_3DMODEL||"sketch"===e[i].media_type?a.FORMAT_3D:a.FORMAT_2D,associatedData:e[i].associatedData},(e[i].media_type===a.TYPE_3DMODEL||"sketch"===e[i].media_type)&&this._fileServices.getSupportedExtensions(a.TYPE_3DMODEL).indexOf(n.extension)>-1)n.type=a.TYPE_3DMODEL,"processed"===e[i].status&&(e[i].play["3d_streams"].length&&(n.url=e[i].play["3d_streams"][0].transient_url),n.extension=e[i].play.download_original_url.format,n.urlAsAttachment=e[i].play.download_original_url.transient_url_as_attachment,n.url||(n.url=e[i].play.download_original_url.transient_url));else if(e[i].media_type===a.TYPE_IMAGE&&this._fileServices.getSupportedExtensions(a.TYPE_IMAGE).indexOf(n.extension)>-1)n.type=a.TYPE_IMAGE,"processed"===e[i].status&&(n.url=e[i].play["2d_streams"][0].transient_url);else if((e[i].media_type===a.TYPE_VIDEO||"animatedPicture"===e[i].media_type)&&this._fileServices.getSupportedExtensions(a.TYPE_VIDEO).indexOf(n.extension)>-1){if(n.type=a.TYPE_VIDEO,"processed"===e[i].status)if((e[i].play.av_streams?e[i].play.av_streams.length:0)&&(n.url=e[i].play.av_streams[0].transient_url,n.streams=e[i].play.av_streams),n.url||"animatedPicture"!==e[i].media_type||(n.type=a.TYPE_IMAGE,n.url=e[i].play.view[0].transient_url),e[i].play.download_original_url&&(n.download_original_url=e[i].play.download_original_url.transient_url),e[i].preview&&e[i].preview.thumbnails){var s=e[i].preview.thumbnails;n.thumbnailURL=s[s.length-1].transient_url,n.thumbnailURL&&o.getPreferenceValue("M3DEMobile")&&(n.thumbnailURL=t.Data.proxifyUrl(n.thumbnailURL,{proxy:"passport"}))}}else if("document"===e[i].media_type)if("processed"===e[i].status){n.type=a.TYPE_UNSUPPORTED,n.url=null;for(var l=e[i].play.doc_streams,u=0;u<l.length;u++)l[u].format===a.TYPE_PDF&&(n.type=a.TYPE_PDF,n.url=l[u].transient_url)}else n.type=a.TYPE_DOCUMENT;else n.type=a.TYPE_UNSUPPORTED,n.url=null;if(n.type===a.TYPE_UNSUPPORTED){var c=e[i].play;c["3d_streams"]?n.url=c["3d_streams"][0].transient_url:c["2d_streams"]?n.url=c["2d_streams"][0].transient_url:c.av_streams?n.url=c.av_streams[0].transient_url:c.doc_streams&&(n.url=c.doc_streams[0].transient_url),n.url&&o.getPreferenceValue("M3DEMobile")&&(n.url=t.Data.proxifyUrl(n.url,{proxy:"passport"}))}var d=e[i].play.view;d&&(n.previewurl=d[0].transient_url,n.previewurl&&o.getPreferenceValue("M3DEMobile")&&(n.previewurl=t.Data.proxifyUrl(n.previewurl,{proxy:"passport"}))),"processed"===e[i].status?(n.status=a.STATUS_OK,n.size=e[i].size,n.url&&o.getPreferenceValue("M3DEMobile")&&(n.url=t.Data.proxifyUrl(n.url,{proxy:"passport"}))):(n.status=a.STATUS_PROCESSING,n.url=this._fileServices.getProcessingImagePlaceholderUrl(),n.size=0),r.push(n)}else r.push({published:0,mediaId:e[i].processed_media_id,status:a.STATUS_KO,format:a.FORMAT_2D,type:a.TYPE_IMAGE,url:this._fileServices.getErrorImagePlaceholderUrl(),title:"Error",orig_name:this._errorImageName,extension:this._fileServices.extractExtensionFromName(this._errorImageName),size:0,associatedData:e[i].associatedData});else r.push({published:0,mediaId:null,status:null,format:a.FORMAT_NONE,type:null,url:null,associatedData:e[i]?e[i].associatedData:{}});return r},_parseSwymSetMediaData:function(e){var t={associatedData:e.associatedData};if(e.error)t.error=e.error;else{var r=e.result._community?e.result._community:e.result.container;t.threadId=r.id,t.mediaId=e.result.subject6wuri,t.media=e.result}return t}})})),define("DS/CAT3DWInfra/CAT3DWWidgetDataServices",["UWA/Core","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfra/CAT3DW3DSwymMediaServices"],(function(e,t,r){"use strict";var n={isAllowed:function(){let e=t.getPreferenceValue("isWidgetContext"),r="whiteboard"===t.getPreferenceValue("appMode").toLowerCase();return Boolean(e&&r&&window.widget)},getMediaOnWidget:function(){return new Promise((async(e,t)=>{if(!1===this.isAllowed())return void e(null);let n,i,o=widget.getValue("X3DContentId"),a=widget.getValue("beInputs"),s=widget.getValue("savedData");if(o){widget.deleteValue("X3DContentId"),o=JSON.parse(o);let t=o?.data?.items;if(!t?.length)return void e(null);n=t[0].objectId.split(":").slice(-1)[0]}else if(a){let t=JSON.parse(a);if(!t.length)return void e(null);n=t[0].outputId.split(":").slice(-1)[0]}else{if(!s)return void e(null);s=JSON.parse(JSON.stringify(s)),"1.0"===s.version?n=s.savedMedia.id:"2.0"===s.version&&(n=s.mediaId)}i=await r.requestSingleMedia({mediaId:n},!1),e(i)}))},setMediaOnWidget:function(e){if(!1===this.isAllowed()||!e)return;let t=widget.getValue("savedData");t=t?JSON.parse(JSON.stringify(t)):{},Object.hasOwnProperty.call(t,"savedMedia")&&delete t.savedMedia,t.mediaId=e,t.version="2.0",widget.setValue("savedData",t)},clearMediaOnWidget:function(){!1!==this.isAllowed()&&widget.setValue("savedData","")}};return e.namespace("DS/CAT3DWInfra/CAT3DWWidgetDataServices",n)})),define("DS/CAT3DWInfra/CAT3DWUrlServices",["UWA/Class","UWA/Core","DS/CAT3DWInfra/CAT3DWPreferenceManager"],(function(e,t,r){"use strict";var n=e.extend({init:function(){this._urlAppliParams={}},dispose:function(){this._urlAppliParams=null},isValidHttpUrl:function(e){var t;try{if(!e.contains("."))return!1;(e=e.trim()).startsWith("http://")||e.startsWith("https://")||(e="https://"+e),t=decodeURIComponent(e),t=new URL(t)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol},generateUrlWithSuffix:function(e){if(!this.isValidHttpUrl(e))return e;var t,n=window.location.host.split(".");t=r.getPreferenceValue("isMDE")||window.ds&&window.ds.isMDE?e.contains("%3F")?"%26sketch":"3Fsketch":e.contains("?")?"&sketch":"?sketch";var i=n[0];null!=i&&i.length>0?t+="_"+i.toLowerCase().replace(/[^a-z0-9-_]/g,""):t+="_localhost";return e+t},parseUrl:function(e){var t=null;t=e?(t=e.split("?"))[1]:window.location.search.substr(1),this._urlAppliParams=this._getURLParams(t)},getURLParam:function(e){return this._urlAppliParams[e.toLowerCase()]},getURLParamAsBoolean:function(e){var t=this._urlAppliParams[e.toLowerCase()],r=typeof t;return("object"!==r||null!==t)&&"undefined"!==r&&("string"===r?"1"===t||"true"===t:"number"===r?1===t:"boolean"===r&&t)},_getURLParams:function(e){var t={};if(e)for(var r,n=e.split("&"),i=0;i<n.length;i++)1===(r=n[i].split("=")).length?t[r[0].toLowerCase()]=!0:r[1].includes("base64")||this._isUrl(r[1])?t[r[0].toLowerCase()]=r[1]:t[r[0].toLowerCase()]=r[1].toLowerCase();return t},_isUrl:function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}});return t.namespace("DS/CAT3DWInfra/CAT3DWUrlServices",n)})),define("DS/CAT3DWInfra/CAT3DWInitWidget",["UWA/Class","UWA/Core","DS/CAT3DWInfraVC/CAT3DWNavigationController","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfra/CAT3DWUrlServices","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/RuntimeView/NLSManager","DS/UWPClientCode/I18n","DS/Usage/TrackerAPI"],(function(e,t,r,n,i,o,a,s,l){"use strict";var u=e.extend({init:function(){this._viewParams={myWidgetObject:null,container:null},this._urlServices=new i,this._parent(),window.ThreeDSketchVersion="1.24"},initODTWidget:function(e){this._urlServices.parseUrl(e.uwaUrl),this.widget=e,this.widget.body.empty(),this._appContainer=t.createElement("div",{id:"webapp-container"}).inject(this.widget.body),this.widget.setTitle(""),this.initialize()},initFrame:function(e,r){r.coreview&&n.setPreferenceValue("callCollab",!0),this._urlServices.parseUrl(e.uwaUrl),this.widget=e,this.widget.body.empty(),this._appContainer=t.createElement("div",{id:"webapp-container"}).inject(this.widget.body),e.addEvent("onResetSearch",function(e){this._WidgetNavigationViewController.onSearch(e)}.bind(this)),e.addEvent("onSearch",function(e){this._WidgetNavigationViewController.onSearch(e)}.bind(this)),e.addEvent("onResize",function(){this.onResize()}.bind(this)),e.addEvent("onRefresh",function(){this.onRefresh()}.bind(this));let i=r.model,o=null,a=null;if(i&&(o=i.media_id?i.media_id:i.id_media,i._community?a=i._community.subject6wuri:i.community&&(a=i.community.id)),r.edit&&i&&!r.coreview?r.coreview={action:"initCoreview",silentCoreview:!0,collabExperienceOrigin:!0,collabType:"coreview",data:{communityUri:a,mediaId:o,room_id:o},noCall:!0,room_id:o,channel:"collab.im.ds.com",threadId:a,threadType:"dm"}:r.widgetAppContext&&n.setPreferenceValue("coreviewFromCall",!0),r)for(var s in r)n.setPreferenceValue(s,r[s]);this.initialize(),this.onWidgetReady();var u=n.getPreferenceValue("isMDE"),c=n.getPreferenceValue("swymTenant");u?"whiteboard"===n.getPreferenceValue("appMode")?l.trackPageEvent({eventCategory:"3DWhiteboard_OpenFrom",eventAction:"3DWhiteboard_OpenFromM3DE",eventLabel:"3DWhiteboard opened from M3DE",appID:"X3DWHTB_AP",tenant:c,persDim:{pd1:window.ThreeDSketchVersion}}):l.trackPageEvent({eventCategory:"3DSketch_OpenFrom",eventAction:"3DSketch_OpenFromM3DE",eventLabel:"3sketch opened from M3DE",appID:"CAT3DSKT_AP",tenant:c,persDim:{pd1:window.ThreeDSketchVersion}}):"whiteboard"===n.getPreferenceValue("appMode")?(this.widget.setTitle("3DWhiteboard"),l.trackPageEvent({eventCategory:"3DWhiteboard_OpenFrom",eventAction:"3DWhiteboard_OpenFromSwym",eventLabel:"3DWhiteboard opened from Swym",appID:"X3DWHTB_AP",tenant:c,persDim:{pd1:window.ThreeDSketchVersion}})):(this.widget.setTitle("3DSketch"),l.trackPageEvent({eventCategory:"3DSketch_OpenFrom",eventAction:"3DSketch_OpenFromSwym",eventLabel:"3sketch opened from Swym",appID:"CAT3DSKT_AP",tenant:c,persDim:{pd1:window.ThreeDSketchVersion}}))},initialize:function(){var e;this._viewParams.myWidgetObject=this.widget,this._viewParams.container=this._appContainer,this._waitTopBar=!1,this.widget?e=this.widget.getValue("lang"):s=s.getCurrentLanguage(),require.config({config:{i18n:{locale:e}}}),window.dsLang=e,n.setPreferenceValue("lang",e),e&&n.setPreferenceValue("langLocalizedName",s.getSupportedLanguages()[e].localizedName),a.init(),a.DEFAULT_LANGUAGE=n.getPreferenceValue("lang"),this._WidgetNavigationViewController=new r({NavigationControllerName:"WidgetNavigationContoller"}),this.widget?(this.widget.controller=this._WidgetNavigationViewController,n.setPreferenceValue("WidgetID",this.widget.id),this.widget.uwaUrl?(this._WidgetNavigationViewController.SetTopBarAccess(this.widget.id,"3DDashboard"),n.setPreferenceValue("StandAloneWidget",!1)):(n.setPreferenceValue("StandAloneWidget",!0),n.setPreferenceValue("MobileMode",this._urlServices.getURLParamAsBoolean("MOBILE"))),n.setPreferenceValue("ODTMode",this.widget.getValue("ODTMode"))):n.setPreferenceValue("StandAloneWidget",!1);var t=this._urlServices.getURLParam("debug"),i=!1;(t||this.widget&&"true"===(t=this.widget.getValue("DebugMode")))&&(i=!0),i&&n.setPreferenceValue("DebugMode",i),n.setPreferenceValue("PickingDebug",this._urlServices.getURLParamAsBoolean("pickingdebug")),"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?n.setPreferenceValue("DeviceTouch",!0):n.setPreferenceValue("DeviceTouch",!1),this._setCrossOrigin("use-credentials")},onWidgetLoad:function(){if(this._waitTopBar)var e=setInterval(function(){this._waitTopBar||(clearInterval(e),this.onWidgetReady())}.bind(this),100);else this.onWidgetReady()},onWidgetReady:function(){(n.getPreferenceValue("StandAloneWidget")||n.getPreferenceValue("ODTMode"))&&require(["DS/Core/Core"],(function(e){e.setFullscreen()}));"undefined"===n.getPreferenceValue("ODTMode")&&this.onResize()},onResize:function(e){this.setWidget(e),this._WidgetNavigationViewController.onResize()},setWidget:function(e){this.widget=e},onRefresh:function(e){e.isEdit||(this.setWidget(e),this._WidgetNavigationViewController.onRefresh())},onDestroy:function(){this._WidgetNavigationViewController.onDestroy()},initTopBarMobile:function(e,t){this._waitTopBar=!0;require({baseUrl:"../"},["DS/TopFrame/TopFrame","DS/TopBar/TopBar","css!TopBar/TopBar.css","css!TopFrame/TopFrame.css","css!i3DXCompass/i3DXCompass.css"],function(r,i){var o={userId:"CUO",userName:"CUO",brand:"",lang:n.getPreferenceValue("lang"),transparentMode:!0,baseImgPath:"../plugins/Compass/html/",baseHtmlPath:"../plugins/Compass/images/",application:e,activateFederatedSearch:!1,useTagger:!1,startupParams:{instantMessaging:[{id:"TENANTID",displayName:"TENANTID",url:"default6WTagsServicesURL"}],swym:[{id:"TENANTID",displayName:"TENANTID",url:"default6WTagsServicesURL"}]}};r.init(o),i.MainMenuBar.setActiveMenuProviders([e,"3DShapeWeb"]),this._waitTopBar=!1;var a=document.getElementsByClassName("profile-picture");a.length&&a[0].addClassName("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-topbar-user"),t&&t()}.bind(this));var r=document.getElementsByClassName("module moduleUwa windowed-view");r.length&&r[0].setStyle("padding-top","43px")},_setCrossOrigin:function(e){n.setPreferenceValue("CrossOrigin",e);var t=null;switch(e){case"anonymous":t=!1;break;case"use-credentials":t=!0;break;default:t=null}n.setPreferenceValue("UseCredentials",t)}});return t.namespace("DS/CAT3DWInfra/CAT3DWInitWidget",u)}));