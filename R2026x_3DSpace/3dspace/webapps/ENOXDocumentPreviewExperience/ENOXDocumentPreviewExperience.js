define("DS/ENOXDocumentPreviewExperience/DocumentPreviewExperience",["UWA/Promise","DS/3DPlay/3DPlay","DS/3DPlayExperienceModule/3DPlayExperience","DS/ApplicationFrame/FrameWindow3D","DS/CoreEvents/ModelEvents","i18n!DS/ENOXDocumentPreviewExperience/assets/nls/ENOXDocumentPreviewExperience"],(function(e,t,n,i,o,a){return n.extend({init:async function(t){var n=this;widget&&(widget.previewExperience=this),this.docuMultiFileLoaded=e.deferred(),t.FrameWindow=i,this._parent(t),this.documentModelEvents=new o,n.originalAssetObj=t.input.asset.originalAsset;const a=n.originalAssetObj.serverurl;require.config({paths:{"DS/DocumentCommands":a+"/webapps/DocumentCommands","DS/DocumentCommonInfra":a+"/webapps/DocumentCommonInfra","DS/DocumentFiles":a+"/webapps/DocumentFiles","DS/DocumentWebEdition":a+"/webapps/DocumentWebEdition","DS/DocumentMultiFilePreview":a+"/webapps/DocumentMultiFilePreview","DS/DocumentPreview":a+"/webapps/DocumentPreview"}}),require(["DS/DocumentMultiFilePreview/MultiFilePreviewComponent"],(function(e){n.multiFilePreviewComponent=new e({document:n.originalAssetObj.physicalid,platformUrls:{"3DSpace":n.originalAssetObj.serverurl},modelEvents:n.documentModelEvents,tenant:n.originalAssetObj.tenant,securityContext:n.originalAssetObj.contextid||n.originalAssetObj.contextId,documentManagedByPreview:!0,hideNextPrev:!0,enableFavoriteToggle:!1,toolBarVisibility:!1,mode:"ReadMode",uaSource:"3DPlay"}),n.multiFilePreviewComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),n.multiFilePreviewComponent.close=function(){n.multiFilePreviewComponent.destroy(),n.multiFilePreviewComponent=void 0},n.multiFilePreviewComponent.inject(t.container),n.docuMultiFileLoaded.resolve()}))},isOnCloud:function(){return!(!this.originalAssetObj.tenant||"onpremise"==this.originalAssetObj.tenant.toLowerCase())},loadAsset:function(e,t){var n=this;this.docuMultiFileLoaded.promise.then((()=>{n.updateRequired&&(n.originalAssetObj=e.asset.originalAsset,n.multiFilePreviewComponent.setOptions({document:n.originalAssetObj.physicalid,platformUrls:{"3DSpace":n.originalAssetObj.serverurl},modelEvents:n.documentModelEvents,tenant:n.originalAssetObj.tenant,securityContext:n.originalAssetObj.contextid||n.originalAssetObj.contextId}),n.multiFilePreviewComponent.updateDocument(n.originalAssetObj.physicalid,void 0)),n.frmWindow.getTree().hide(),n.frmWindow.getActionBar().hide(),n.updateRequired=!0,n.toggleSplash(!1)}))},onPreCreate:function(e,t,n){this.createToolBarActions()},onPostCreate:function(e,t,n){var i=this;this.docuMultiFileLoaded.promise.then((()=>{i.addPreviewEvents(),i.refreshPreviewTitle()}))},dispose:function(){this.EventDisposer.dispose(),this.EventDisposer=null,this.disposeFunctions=null,t.removeCallbacks(this.args.ctx),void 0!==this.frmWindow&&null!==this.frmWindow&&(void 0!==this.frmWindow.dispose&&null!==this.frmWindow.dispose&&this.frmWindow.dispose(),this.frmWindow=null),void 0!==this.PanelManager&&null!==this.PanelManager&&void 0!==this.PanelManager.dispose&&null!==this.PanelManager.dispose&&this.PanelManager.dispose(),this.multiFilePreviewComponent&&this.multiFilePreviewComponent.close(),this.triptych&&this.triptych.getContent().destroy(),this.UIManager.dispose(),this.UIManager=null},addPreviewEvents:function(){var e=this;this.multiFilePreviewComponent.previewedDocumentStatusModel.addEvent("onChange",(function(t,n){e.refreshPreviewTitle(t)})),this.documentModelEvents.addEventListener("enox-file-node-selection-changed",(t=>{e._3dplayhelperaccess=void 0,e.refreshPreviewTitle(void 0)})),this.documentModelEvents.addEventListener("ENO-DOCM-MultiFilePreview-Loaded",(t=>{e._3dplayhelperaccess=t._3dplayhelperaccess,e.refreshPreviewTitle(void 0),e.hideDefaultInformation()})),this.documentModelEvents.addEventListener("Docm-MultiFilePreview-rightContainer",(t=>{e.lightBoxInformationCommandAccess&&e.lightbox&&("Collapsed"==t.action&&(e.lightBoxInformationCommandAccess.selected=!1),"Expanded"==t.action&&(e.lightBoxInformationCommandAccess.selected=!0),e.lightbox.update())}))},hideDefaultInformation:function(){var e=this;if(e._3dplayhelperaccess&&e._3dplayhelperaccess.frmWindow&&e._3dplayhelperaccess.frmWindow.getActionBar){var t=e._3dplayhelperaccess.frmWindow.getActionBar();t&&t.onActionBarOpen((function(){if(t._afr||t._afr.getCurrentSection){var e=t._afr.getCurrentSection();(e||Array.isArray(e._items))&&e._items.forEach((e=>{e.options&&"RightSidePanel"==e.options.Name&&e.hide()}))}}))}},refreshPreviewTitle:function(e){var t=this;e||(e=this.multiFilePreviewComponent.previewedDocumentStatusModel);var n=e.getPreviewedDocument(),i=e.getPreviewedDocumentSelectedFile(),o="",a="";n&&(o=n.title||n.name||n.dataelements.title||n.dataelements.name),i&&(a=i.dataelements.title||i.dataelements.name),t.lightbox&&t.lightbox._lightbox&&(t.lightbox._lightbox.title=o+" | "+a)},createToolBarActions:function(){var e=this;e.onLightboxReady=()=>{e.docuMultiFileLoaded.promise.then((()=>{e.lightbox.useDefaultActions(!1),e.isOnCloud()&&this.lightbox.addAction({name:a.get("COMMENTS"),text:a.get("COMMENTS"),fonticon:"comment",handler:t=>{e.documentModelEvents.publish({event:"show-facet-in-properties",data:{facetName:"social"}})}}),e.lightbox.addAction({name:a.get("COPY_LINK"),text:a.get("COPY_LINK"),fonticon:"link",handler:t=>{e.documentModelEvents.publish({event:"3DPlay-DocumentManagement-Execute-Action",data:{command:"copylink"}})}}),e.lightbox.addAction({name:a.get("SHARE"),text:a.get("SHARE"),fonticon:"share-alt",handler:t=>{e.documentModelEvents.publish({event:"3DPlay-DocumentManagement-Execute-3DPlayHelper-Action",data:{command:"PublishTo3DSwym"}})}}),e.lightbox.addAction({name:a.get("DOWNLOAD"),text:a.get("DOWNLOAD"),fonticon:"download",items:[{text:a.get("DOWNLOAD_FILE"),name:a.get("DOWNLOAD_FILE"),fonticon:"download",handler:t=>{e.documentModelEvents.publish({event:"3DPlay-DocumentManagement-Execute-Action",data:{command:"download-file"}})}},{text:a.get("DOWNLOAD_DOCUMENT"),name:a.get("DOWNLOAD_DOCUMENT"),fonticon:"download",handler:t=>{e.documentModelEvents.publish({event:"3DPlay-DocumentManagement-Execute-Action",data:{command:"download-document"}})}}]}),e.lightbox.addAction({name:a.get("INFORMATION"),text:a.get("INFORMATION"),fonticon:"info",handler:t=>{e.lightBoxInformationCommandAccess=t,e.documentModelEvents.publish({event:"3DPlay-DocumentManagement-Execute-Action",data:{command:"information",action:"Open"}})}}),e.lightbox.addAction({name:a.get("MORE"),text:a.get("MORE"),fonticon:"chevron-down",items:[{text:a.get("SAVE_SCREENSHOT"),name:a.get("SAVE_SCREENSHOT"),fonticon:"picture-export",handler:t=>{e.documentModelEvents.publish({event:"3DPlay-DocumentManagement-Execute-3DPlayHelper-Action",data:{command:"SaveScreenShot"}})}},{text:a.get("PRINT_SCREENSHOT"),name:a.get("PRINT_SCREENSHOT"),fonticon:"print",handler:t=>{e.documentModelEvents.publish({event:"3DPlay-DocumentManagement-Execute-3DPlayHelper-Action",data:{command:"PrintScreenShot"}})}}]}),e.lightbox.update(),e.refreshPreviewTitle(void 0)}))}}})}));