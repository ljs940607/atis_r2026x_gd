/*!  COPYRIGHT DASSAULT SYSTEMES 2023   */
function VIOApp(e){"use strict";var t={initialize:function(e){return this.widget=e.widget,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this},onLoad:function(){this.widget.setValue("tenantAware",!0),this.__buildDOM(),require(["DS/VIOCtrlCenterApp/components/AppCtrlCmp"],(e=>{this.appCtrl=new e({appConf:"DS/VIOCtrlCenterApp/assets/conf/app.json",target:this.elements.mainBody}),this.appCtrl.initialize().then((()=>{require("DS/VIOCtrlCenterApp/utils/AppUtils").publish({event:"DS/VIOAppMgt/InitDone"})}))}))},onRefresh:function(){this.appCtrl&&this.appCtrl.refresh()},__buildDOM:function(){if(!this.elements){this.elements={};var e=this.elements.mainBody=UWA.createElement("div");this.elements.mainBody.classList.add("vioctrl-root"),this.elements.mainBody.classList.add("vio-appMainBody"),this.elements.mainBody.style.position="absolute",this.elements.mainBody.style.height="100%",this.elements.mainBody.style.width="100%",this.elements.mainBody.style["overflow-y"]="auto",this.widget.setBody(e)}}};return t.initialize(e),t}function timeout(e){return new Promise((t=>setTimeout(t,e)))}define("DS/VIOCtrlCenterApp/views/ViewUtils",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp","DS/Utilities/Dom","DS/Controls/ModalContainer","DS/Controls/Loader"],(function(e,t,n,s){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.elements={},this.currentTarget=null,this)}return i.prototype.spanRequired=function(){var e=t.createElement("span",{class:"eno-required"});return e.innerText="*",e},i.prototype.mask=function(e,t){null!==this.currentTarget&&this.currentTarget!==e&&this.unmask(this.currentTarget),this.currentTarget=e,void 0===this.elements.loader&&(this.elements.loader=new s({})),this.elements.loader.on(t),n.createModal(e,this.elements.loader.getContent())},i.prototype.unmask=function(e){this.currentTarget===e&&(this.currentTarget=null,this.elements.loader.off(),n.removeModal(e))},new i})),define("DS/VIOCtrlCenterApp/utils/PlatformURL",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(e){"use strict";var t=null;function n(e){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}return n.prototype.initialize=async function(){return new Promise((function(n,s){null===t?e.getPlatformServices({onComplete:function(e){t=e,n()},onFailure:function(e){s(e)}}):n()}))},n.prototype.getPlatformId=function(){return"undefined"!=typeof widget&&null!==widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},n.prototype.getTenantInfo=function(e){for(var n={},s=0;s<t.length;s++)if(t[s].platformId===e){n=t[s];break}return n},n.prototype.getPlatformURL=function(e){if(!1===Array.isArray(t))throw new Error("Platform services not initialize yet");var n=this.getPlatformId(),s=this.getTenantInfo(n);return void 0===s[e]?(console.error("No "+e+" URL available for the tenant ["+n+"]"),null):s[e]},n.prototype.getGrantedRoles=async function(){return new Promise((t=>{e.getGrantedRoles((e=>{t(e)}))}))},new n})),define("DS/VIOCtrlCenterApp/utils/AppUtils",["DS/Utilities/UUID","DS/CoreEvents/ModelEvents","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(e,t,n,s){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.mapCmp=new Map,this.mdlEvts=new t,this.notifManager=n,s.setNotificationManager(this.notifManager),s.setStackingPolicy(5),this)}return i.prototype.setComponent=function(e,t){this.mapCmp.set(e,t)},i.prototype.getComponent=function(e){return this.mapCmp.get(e)},i.prototype.publish=function(e){if(this.mdlEvts)return this.mdlEvts.publish(e)},i.prototype.subscribe=function(e,t){if(this.mdlEvts)return this.mdlEvts.subscribe(e,t)},i.prototype.unsubscribe=function(e){if(this.mdlEvts)return this.mdlEvts.publish(e)},i.prototype.displayNotif=async function(e){if(this.notifManager){e=UWA.extend({level:"info",message:"default Message",sticky:!1},e),this.notifManager.addNotif(e)}},i.prototype.loadAMD=async function(e){return new Promise((t=>{require([e],(e=>{t(e)}))}))},new i})),define("DS/VIOCtrlCenterApp/utils/AppCntProxy",["i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp.json","DS/PlatformAPI/PlatformAPI","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/utils/PlatformURL"],(function(e,t,n,s){"use strict";function i(e){return"object"==typeof i.instance?i.instance:(i.instance=this,this.notInitialize=!0,this.appInfos={currentUser:void 0,widgetId:void 0,x3dAppId:void 0,x3dSharedId:void 0,settings:{}},this)}return i.prototype.initialize=async function(e){!0===this.notInitialize&&(delete this.notInitialize,this.appCntProxy=widget,this.appInfos.lang=this.appCntProxy.lang,this.appInfos.widgetId=this.appCntProxy.id,this.appInfos.x3dAppId=this.appCntProxy.getValue("x3dAppId")?this.appCntProxy.getValue("x3dAppId"):this.appCntProxy.getValue("appId"),this.appInfos.x3dSharedId=this.appCntProxy.getValue("x3dSharedId")?this.appCntProxy.getValue("x3dSharedId"):this.getAppId(),this.appInfos.currentUser=t.getUser(),this.appInfos=UWA.extend(this.appInfos,e,!0),this.appCntProxy.addEvent("endEdit",(e=>{e&&!1===e.submitted||n.publish({event:"DS/ENXPreference/update",data:{preferences:this.appCntProxy.getPreferences()}})})),this.__launchResize=!0,this.appCntProxy.addEvent("onResize",(async()=>{!0===this.__launchResize&&(this.__launchResize=!1,setTimeout((()=>{n.publish({event:"DS/App/resize",data:{}})}),200),setTimeout((()=>{this.__launchResize=!0}),750))})),await Promise.all([this.__initGrantedRoles(),s.initialize()]),this.appCntProxy.addEvents({endEdit:this.__onEndEditPref.bind(this)}))},i.prototype.getLang=function(){return this.appInfos.lang},i.prototype.getUser=function(){return this.appInfos.currentUser},i.prototype.getUserLogin=function(){var e=this.getUser(),t="";return void 0!==e&&(t=e.login),t},i.prototype.getUserName=function(){var e=this.getUser(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t},i.prototype.getWidgetId=function(){return this.appInfos.widgetId||"undefined"==typeof widget||null===widget||(this.appInfos.widgetId=widget.id),this.appInfos.widgetId},i.prototype.getAppId=function(){return this.appInfos.x3dAppId},i.prototype.getSharedId=function(){return this.appInfos.x3dSharedId},i.prototype.getRequestLabel=function(){return this.getUserLogin()+"-"+this.getAppId()+"-"+Date.now()},i.prototype.getProperty=function(e){return this.appInfos[e]},i.prototype.__onEndEditPref=function(){},i.prototype.__initGrantedRoles=async function(){return new Promise((e=>{s.getGrantedRoles().then((t=>{this.grantedRoles=t,e()}))}))},new i})),define("DS/VIOCtrlCenterApp/components/AppCtrlCmp",["DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/utils/AppCntProxy"],(function(e,t){"use strict";class n{constructor(e){this.options=e||{},this.options=Object.assign({currentView:null},this.options)}}return n.prototype.initialize=async function(){let n=await e.loadAMD("text!"+this.options.appConf),s=JSON.parse(n);await t.initialize(s),e.setComponent("AppCtrl",this);let i=t.getProperty("components");for(let t=0;t<i.length;t++){let n=i[t],s=new(await e.loadAMD(n.amd))(this.options);await s.initialize()}},n.prototype.refresh=async function(){await e.getComponent("AppModel").refresh(),await e.getComponent("AppView").refresh(),e.publish({event:"DS/App/refresh/done"})},n})),define("DS/VIOCtrlCenterApp/ws/AppsMngtWS",["DS/VIOCtrlCenterApp/utils/PlatformURL"],(function(e){"use strict";function t(){}return t.prototype.getCredits=async function(t){var n=e.getPlatformURL("3DCompass")+"/resources/AppsMngt/credits?platform="+e.getPlatformId()+"&offset=0&os=windows&sort_direction=asc&limit=100";return this.executeRequest(n,{method:"GET",headers:{Accept:"application/json","Accept-Language":"en"}},"myapps/credits/get")},t})),define("DS/VIOCtrlCenterApp/ws/VisMgtWS",["DS/VIOCtrlCenterApp/utils/PlatformURL","DS/VIOCtrlCenterApp/utils/AppCntProxy"],(function(e,t){"use strict";function n(){}return n.prototype.getConsumption=async function(n){let s={period:n.period,contentLength:t.getProperty("nbRecord")},i=e.getPlatformURL("3dvisucontentjobmgmt")+"/api/v1/admin/license/usage",o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(s)},r=await this.executeRequest(i,o,"visjob/registeredrep");if(r.info)return r;{var a={evolutions:{total:[],used:[]}};let e,t;for(let n=0;n<r.Usages.length;n++){let s=r.Usages[n],i=new Date(s.date).getTime();a.evolutions.total.push([i,s.available]),a.evolutions.used.push([i,s.used]),n===r.Usages.length-1&&(t=s.available,e=s.used)}let s=Math.min(new Date(n.period.end).getTime(),(new Date).getTime());return a.evolutions.total.push([s,t]),a.evolutions.used.push([s,e]),a}},n.prototype.getRegisteredRep=async function(){let t=e.getPlatformURL("3dvisucontentjobmgmt")+"/api/v1/admin/registeredrep";return this.executeRequest(t,{method:"GET",headers:{Accept:"application/json"}},"visjob/registeredrep")},n})),define("DS/VIOCtrlCenterApp/ws/WSAccess",["i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/WAFData/WAFData","DS/VIOCtrlCenterApp/ws/AppsMngtWS","DS/VIOCtrlCenterApp/ws/VisMgtWS","DS/VIOCtrlCenterApp/utils/AppUtils"],(function(e,t,n,s,i){"use strict";function o(){return"object"==typeof o.instance?o.instance:(o.instance=this,this)}function r(e){return"string"==typeof e&&"{"===e.charAt(0)?JSON.parse(e):e}return o.prototype=Object.assign(o.prototype,n.prototype),o.prototype=Object.assign(o.prototype,s.prototype),o.prototype.__executeRequest=function(e,n,s){return t.authenticatedRequest(e,n)},o.prototype.executeRequest=async function(t,n,s){return new Promise(((o,a)=>{n.onComplete=function(e){var t={success:!0};e&&(t=r(e)),o(t)},n.onFailure=function(e,t){t&&(t=r(t)),a(t)},n.onTimeout=function(t,n){n&&(n=r(n)),i.displayNotif({level:"error",message:e.errors.requesttimeout,sticky:!0}),a(n)},this.__executeRequest(t,n,s)}))},new o})),define("DS/VIOCtrlCenterApp/views/NoToken",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp.css","i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppCntProxy","DS/VIOCtrlCenterApp/ws/WSAccess","DS/Utilities/Dom"],(function(e,t,n,s,i){"use strict";const o="notoken";function r(e){this.options=Object.assign({model:null},e),this.elements={},this.elements.container=i.createElement("div",{class:o+"-main "})}return r.prototype.initialize=async function(){return this.__buildUX()},r.prototype.getDOM=function(){return this.elements.container},r.prototype.__buildUX=async function(){this.elements.content=i.createElement("div",{class:o+"-content"}),this.elements.container.appendChild(this.elements.content),this.elements.noVIOContent=i.createElement("div",{class:o+"-no-vio-content"}),this.elements.noVIOContent.title=t.noTokenTooltip,this.elements.content.appendChild(this.elements.noVIOContent);let e=i.createElement("div",{class:o+"-no-vio"});this.elements.noVIOContent.appendChild(e),e.innerText=t.noToken;let r=i.createElement("div",{class:o+"-no-vioIcon "});r.appendChild(i.generateIcon({iconName:"tokens-delete",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"3x",className:o+"-icon "})),this.elements.noVIOContent.appendChild(r);let a=await s.getRegisteredRep(),l=UWA.Element.create("div",{class:o+"-registeredrep"}),p=UWA.Element.create("h1",{class:o+"-rep-label"});p.innerText=t.registeredrepLabelNoToken,l.appendChild(p);let d=UWA.Element.create("h2",{class:o+"-rep-value"});d.innerText=new Intl.NumberFormat(n.getLang(),{}).format(a.registeredRep),l.appendChild(d),this.elements.content.appendChild(l)},r})),define("DS/VIOCtrlCenterApp/components/AppViewCmp",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp.css","i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppCntProxy","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/views/ViewUtils","DS/VIOCtrlCenterApp/ws/WSAccess"],(function(e,t,n,s,i,o){"use strict";class r{constructor(e){this.options=e||{},this.options=Object.assign({},this.options),this.elements={},this.elements.views={}}}return r.prototype.initialize=async function(){let e=this.options.target;this.elements.container=UWA.Element.create("div",{class:"vio-ctrl-app"}),e.appendChild(this.elements.container);let n=s.getComponent("AppModel");if(!0===n.isTokenAvailable()){i.mask(this.elements.container,t.loadingApp);let e=await s.loadAMD("DS/VIOCtrlCenterApp/views/Summary");this.elements.summary=new e({model:n}),this.elements.container.appendChild(this.elements.summary.getDOM());let o=await s.loadAMD("DS/VIOCtrlCenterApp/views/TokensHistory");this.elements.tokensHistory=new o({model:n}),this.elements.container.appendChild(this.elements.tokensHistory.getDOM()),await Promise.all([this.elements.summary.initialize(),this.elements.tokensHistory.initialize()]),this.elements.tokensHistory.redraw(),i.unmask(this.elements.container)}else{let e=new(await s.loadAMD("DS/VIOCtrlCenterApp/views/NoToken"))({model:n});this.elements.container.appendChild(e.getDOM()),this.elements.container.classList.add("notoken"),await e.initialize()}s.subscribe({event:"DS/App/resize"},(async()=>{await this.refresh(),s.publish({event:"DS/App/resize/done"})})),s.setComponent("AppView",this)},r.prototype.refresh=async function(){let e=s.getComponent("AppModel");if(this.elements.tokensHistory&&this.elements.tokensHistory.destroy(),this.elements.container.innerHTML="",!0===e.isTokenAvailable()){i.mask(this.elements.container,t.loadingRefresh);let n=await s.loadAMD("DS/VIOCtrlCenterApp/views/Summary");this.elements.summary=new n({model:e}),this.elements.container.appendChild(this.elements.summary.getDOM());let o=await s.loadAMD("DS/VIOCtrlCenterApp/views/TokensHistory");this.elements.tokensHistory=new o({model:e}),this.elements.container.appendChild(this.elements.tokensHistory.getDOM()),await Promise.all([this.elements.summary.initialize(),this.elements.tokensHistory.initialize()]),this.elements.tokensHistory.redraw(),i.unmask(this.elements.container)}else{let t=new(await s.loadAMD("DS/VIOCtrlCenterApp/views/NoToken"))({model:e});this.elements.container.appendChild(t.getDOM()),this.elements.container.classList.add("notoken"),await t.initialize()}},r})),define("DS/VIOCtrlCenterApp/components/AppModelCmp",["i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppCntProxy","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/ws/WSAccess"],(function(e,t,n,s){"use strict";class i{constructor(e){this.options=e||{},this.options=Object.assign({tokensAvailable:!1},this.options)}}return i.prototype.initialize=async function(){try{let e=await s.getCredits(),i=t.getProperty("token2track"),o=null,r=0;do{let t=e.data[r];t&&t.id===i?(o=t,this.options.tokensAvailable=!!o.total):r++}while(null===o&&r<e.data.length);this.options.tokenInfos=o||{},n.setComponent("AppModel",this)}catch(e){console.warn("## AppModelCmp.initialize: getCredits fails")}},i.prototype.refresh=async function(){try{let e=await s.getCredits(),n=t.getProperty("token2track"),i=null,o=0;do{let t=e.data[o];t&&t.id===n?(i=t,this.options.tokensAvailable=!!i.total):o++}while(null===i&&o<e.data.length);this.options.tokenInfos=i||{}}catch(e){console.warn("## AppModelCmp.refresh: getCredits fails")}},i.prototype.isTokenAvailable=function(){return this.options.tokensAvailable},i.prototype.getFreeToken=function(){return this.options.tokenInfos.free},i.prototype.getTotalToken=function(){return this.options.tokenInfos.total},i.prototype.getUsedToken=function(){return this.options.tokenInfos.used},i.prototype.getExpireDate=function(){return this.options.tokenInfos.expireLong},i})),define("DS/VIOCtrlCenterApp/views/TokensHistory",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp.css","i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/ws/WSAccess","DS/Utilities/Dom","DS/VENHighChart/UIHighCharts","DS/Controls/DatePicker","DS/Utilities/DateUtils"],(function(e,t,n,s,i,o,r,a){"use strict";const l="tokens-history",p=function(e,t){const n=new Date(e);return n.setFullYear(e.getFullYear()-t),n},d=function(e){let t=e.toLocaleString("en").split(","),n=t[0].split("/"),s=t[1].contains("AM")?"T00:00:00.000Z":"T23:59:59.000Z";return n[2]+"-"+("0"+n[0]).slice(-2)+"-"+("0"+n[1]).slice(-2)+s};function h(e){this.options=e||{},this.options.currentLayout=e.defaultLayout?e.defaultLayout:"chart",this.options.beginDate=new Date,this.options.beginDate.setDate(this.options.beginDate.getDate()-30),this.options.beginDate.setHours(0,0,0),this.options.endDate=new Date,this.options.endDate.setHours(23,59,59),this.options=Object.assign({model:null},this.options),this.elements={},this.elements.container=i.createElement("div",{class:l+"-main"})}return h.prototype.initialize=async function(){await this.__buildUX()},h.prototype.destroy=function(){this.elements.dateFromPicker.destroy(),this.elements.dateToPicker.destroy(),this.elements.container.innerHTML=""},h.prototype.getDOM=function(){return this.elements.container},h.prototype.redraw=function(){this.elements.consumptionCharts&&(this.elements.consumptionCharts.reflow(),this.switchConsumptionView(this.options.currentLayout))},h.prototype.__buildUX=async function(){this.elements.header=i.createElement("h2",{class:l+"-hdr"});let e=i.createElement("div",{class:l+"-hdr-title"});this.elements.header.appendChild(e),e.innerText=t.tokensHistory,await this.__setupHighchartsOpts(),this.elements.usage=i.createElement("div",{class:l+"-content"}),this.elements.usageCmd=i.createElement("div",{class:l+"-usageCmd"}),this.__buildUsageInterval(),this.elements.usage.appendChild(this.elements.usageCmd),this.elements.container.appendChild(this.elements.header),this.elements.container.appendChild(this.elements.usage);let n=i.createElement("div",{class:l+"-chart"}),s=this.elements.lineChart=i.createElement("div",{class:l+"-lineChart"});this.elements.consumption=i.createElement("div",{class:l+"-consumption"}),s.appendChild(this.elements.consumption),n.appendChild(s),this.elements.usage.appendChild(n),this.__addConsumptionEvo()},h.prototype.__addConsumptionEvo=async function(){let e=this.options.model.getTotalToken();if(this.options.evolution=await s.getConsumption({period:{begin:d(this.options.beginDate),end:d(this.options.endDate)},precision:100,tempTotal:e}),this.options.evolution.info){this.elements.consumption.innerHTML="";let e=i.createElement("div",{class:l+"-nodata"}),n=i.createElement("div",{class:l+"-nodata-msg"});n.innerText=t.noDataConsumed,e.appendChild(n),this.elements.consumption.appendChild(e)}else this.elements.consumption.innerHTML="",this.switchConsumptionView(this.options.currentLayout)},h.prototype.__setupHighchartsOpts=async function(){return new Promise(((e,n)=>{var s=0,i=setInterval((()=>{void 0!==o&&(o.setOptions,1)?(o.setOptions({lang:{months:t.months,shortMonths:t.shortMonths,weekdays:t.weekdays},title:{align:"left",style:{fontSize:"14px",fontWeight:"bold"}},credits:{enabled:!1},exporting:{enabled:!1},legend:{labelFormat:"{y} {name}",layout:"proximate",align:"right",legendSymbol:"lineMarker",style:{fontSize:"10px"}}}),clearInterval(i),e()):100===++s&&(clearInterval(i),n())}),100)}))},h.prototype.switchConsumptionView=function(e){let s=this.options.evolution,i=s.evolutions.used?Math.max(n.getComponent("AppModel").getTotalToken(),s.evolutions.used[s.evolutions.used.length-1][1]):n.getComponent("AppModel").getTotalToken(),r=this.elements.lineChart.getBoundingClientRect();if("chart"===e){let e={chart:{type:"areaspline",height:r.height-40,width:r.width-40,renderTo:this.elements.consumption},title:{text:null},tooltip:{shared:!0,formatter:function(){let e=new Date(this.key),t='<p class="enx-graph-tooltip">'+a.formatDateToString(e,{timePrecision:"min"})+"</p><br/>",n="";for(let e=0;e<this.points.length;e++)n+='<span style="color:'+this.points[e].color+'">&#x2022;  </span>'+this.points[e].series.name+": <b>"+this.points[e].y+"</b><br/>";return t+=n,t}},xAxis:{type:"datetime",labels:{formatter:e=>{const t=new Date(e.value);return a.formatDateToString(t)}}},yAxis:{visible:!0,max:i,title:{text:t.tokens}},plotOptions:{line:{marker:{enabled:!1,radius:2,states:{hover:{radius:4}}}},areaspline:{fillOpacity:1,marker:{enabled:!1,states:{hover:{enabled:!0,radius:4}}},lineWidth:1,states:{hover:{lineWidth:1}},threshold:null,size:"100%"}},series:[{type:"areaspline",color:"#78BEFA",name:t.used,data:s.evolutions.used},{type:"line",color:"#EA4F37",name:t.total,data:s.evolutions.total}]};this.elements.consumptionCharts=new o.Chart(e)}},h.prototype.__buildUsageInterval=function(){let e=i.createElement("div",{class:l+"-fromLabel"});e.innerText=t.fromLabel,this.elements.usageCmd.appendChild(e);let n=i.createElement("div",{class:l+"-fromDate"});this.elements.usageCmd.appendChild(n);let s=this.options.endDate?new Date(this.options.endDate):new Date;s.setHours(0,0,0);let o=p(new Date,1);o.setHours(0,0,0);let a=this.elements.dateFromPicker=new r({value:this.options.beginDate,minValue:o,maxValue:s});a.addEventListener("change",(e=>{this.options.beginDate=e.dsModel.value,this.options.beginDate.setHours(0,0,0),this.__addConsumptionEvo()})),n.appendChild(a.getContent());let d=i.createElement("div",{class:l+"-toLabel"});d.innerText=t.toLabel,this.elements.usageCmd.appendChild(d);let h=i.createElement("div",{class:l+"-toDate"});this.elements.usageCmd.appendChild(h);let c=p(new Date,1);c.setHours(23,59,59);let u=this.elements.dateToPicker=new r({value:this.options.endDate,minValue:c,maxValue:new Date});u.addEventListener("change",(e=>{this.options.endDate=e.dsModel.value,this.elements.dateFromPicker.maxValue=new Date(this.options.endDate),this.options.endDate.setHours(23,59,59),this.elements.dateFromPicker.maxValue.setHours(0,0,0),this.__addConsumptionEvo()})),h.appendChild(u.getContent())},h})),define("DS/VIOCtrlCenterApp/views/Summary",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp.css","i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppCntProxy","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/ws/WSAccess","DS/Utilities/Dom","DS/Controls/ProgressBar","DS/Controls/TooltipModel","DS/Utilities/DateUtils"],(function(e,t,n,s,i,o,r,a,l){"use strict";const p="summary";function d(e){this.options=Object.assign({model:null},e),this.elements={},this.elements.container=o.createElement("div",{class:p+"-main "}),this.options.usage=100*this.options.model.getUsedToken()/this.options.model.getTotalToken()}return d.prototype.initialize=async function(){return this.__buildUX()},d.prototype.getDOM=function(){return this.elements.container},d.prototype.__buildUX=async function(){this.elements.hdr=o.createElement("h2",{class:p+"-hdr"}),this.elements.hdrTitle=o.createElement("h2",{class:p+"-hdr-title"}),this.elements.hdrTitle.innerText=t.summaryTitle,this.elements.hdr.appendChild(this.elements.hdrTitle),this.elements.hdrIcon=o.createElement("h2",{class:p+"-hdr-icon"}),this.elements.hdrIcon.tooltipInfos=new a({shortHelp:t.tokenUsageInfos}),this.elements.hdrIcon.appendChild(o.generateIcon({iconName:"clock-attention",fontIconFamily:WUXManagedFontIcons.Font3DS,className:p+"-hdr-icon "})),this.elements.hdr.appendChild(this.elements.hdrIcon),this.elements.container.appendChild(this.elements.hdr),this.elements.content=o.createElement("div",{class:p+"-content"}),this.elements.container.appendChild(this.elements.content);let e="info";this.options.usage>91?e="high-attention":this.options.usage>70&&(e="warning"),this.elements.statusContent=o.createElement("div",{class:p+"-status-content"}),this.elements.content.appendChild(this.elements.statusContent);let d=o.createElement("div",{class:p+"-status"});this.elements.statusContent.appendChild(d),d.innerText=t.tokenStatus;let h=o.createElement("div",{class:p+"-statusIcon "+e+"Status"});h.appendChild(o.generateIcon({iconName:100===this.options.usage?"tokens-delete":"tokens",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x",className:p+"-icon "})),this.elements.statusContent.appendChild(h);let c=o.createElement("div",{class:p+"-exp-date"}),u=new Date(this.options.model.getExpireDate());c.innerText=t.replace(t.expDate,{expDate:l.formatDateToString(u)}),this.elements.statusContent.appendChild(c),this.elements.infosContent=o.createElement("div",{class:p+"-infos-content"}),this.elements.content.appendChild(this.elements.infosContent);let m=o.createElement("div",{class:p+"-infos"});this.elements.infosContent.appendChild(m),m.innerText=t.tokenUsage,this.elements.usageBar=new r({displayStyle:"lite",value:this.options.usage,touchMode:!0,emphasize:e}),this.elements.usageBar.getContent().addClassName(p+"-usagebar"),this.elements.infosContent.appendChild(this.elements.usageBar.getContent());let C=o.createElement("div",{class:p+"-usageInfos"}),g=o.createElement("div",{class:p+"-usageToken"}),f=o.createElement("div",{class:p+"-usageUsed"});f.innerText=this.options.model.getUsedToken();let y=o.createElement("div",{class:p+"-usageSlash"});y.innerText="/";let A=o.createElement("div",{class:p+"-usageTotal"});A.innerText=this.options.model.getTotalToken(),g.appendChild(f),g.appendChild(y),g.appendChild(A),C.appendChild(g);let D=100*this.options.model.getUsedToken()/this.options.model.getTotalToken();D=Math.round(100*D)/100;let I=o.createElement("div",{class:p+"-used-percent"});I.innerText=t.replace(t.percentUsed,{percentUsed:D}),C.appendChild(I);let v=100*this.options.model.getFreeToken()/this.options.model.getTotalToken();v=Math.round(100*v)/100;let w,S=o.createElement("div",{class:p+"-rem-percent"});S.innerText=t.replace(t.percentRemaining,{remaining:this.options.model.getFreeToken(),percentRem:v}),C.appendChild(S),this.elements.infosContent.appendChild(C);try{w=await i.getRegisteredRep()}catch(e){s.displayNotif({level:"error",message:t.failedRegisterObject})}let O=UWA.Element.create("div",{class:p+"-registeredrep"}),V=UWA.Element.create("h1",{class:p+"-rep-label"});V.innerText=t.registeredrepLabel,O.appendChild(V);let b=UWA.Element.create("h2",{class:p+"-rep-value"});w&&w.registeredRep?b.innerText=new Intl.NumberFormat(n.getLang(),{}).format(w.registeredRep):(b.innerText=t.noRegisteredrep,b.classList.add(p+"-issue-registeredrep")),O.appendChild(b),this.elements.content.appendChild(O)},d}));