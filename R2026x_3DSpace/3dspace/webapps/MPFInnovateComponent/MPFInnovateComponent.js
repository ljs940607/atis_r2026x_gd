define("DS/MPFInnovateComponent/offers/OfferPageDataLoader",["DS/MPFOfferModel/OfferFactory","DS/MPFCartModel/CartFactory","DS/MPFCountryModel/CountryFactory","DS/MPFCountryModel/CountryModel","DS/MPFUtils/StorageUtils","DS/MPFError/ValidationError","DS/MPFClickAndBuyComponent/ErrorPage"],(function(e,t,n,s,r,a,i){"use strict";return class{constructor({companies:e,allCountries:t,openedCountries:n,countryFactory:s,stateMachine:r,cartFactory:a,offerFactory:i,service:o}){this.companies=e,this.stateMachine=r,this.cartFactory=a,this.offerFactory=i,this.service=o,this.allCountries=t,this.openedCountries=n,this.countryFactory=s}async loadData(){const r=this.offerFactory.createModel(e.Types.PUBLIC_OFFER_V2,{id:this._getOfferIdFromUrl()});await r.fetchPromise({country:this.stateMachine.getCountry()});const o=r.getCountries(),c=this.countryFactory.createCollection(n.Types.BUYER,[],{comparator:s.Fields.NAME}),l=this.companies.size(),h=this.companies.map((e=>e.getAddress().getCountry())),d=this.openedCountries.size();for(let e=0;e<d;e++){const t=this.openedCountries.at(e),n=t.getIso3();o.includes(n)&&(0===l||h.includes(n))&&c.push(t)}const p=this.stateMachine.getCountry();if(0===c.size())throw new a("Offer is not available in company's country",{errorCode:i.Errors.UNAVAILABLE_IN_COUNTRY});if(c.size()>0){const e=c.at(0).getIso3();c.getCountryWithIso3(p)||(this.stateMachine.setCountry(e),await r.fetchPromise({country:e}))}return{cart:this.cartFactory.createModel(t.Types.ME),offer:r,countries:c}}_getOfferIdFromUrl(){const e=new URL(window.location.href).pathname.split("/"),t=e.indexOf("buy");if(t>0)return e[t-1]}}})),define("DS/MPFInnovateComponent/cartPhases/PricingTileBE",["UWA/Core","UWA/Utils","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/MPFServices/ObjectService","DS/MPFUtils/FormatUtils","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFView/FieldNumberInputV2","i18n!DS/MPFInnovateComponent/assets/nls/CartPhases"],((e,t,n,s,r,a,i,o,c,l,h)=>{"use strict";return n.extend({className:"mpf-pricing-tile mpf-pricing-tile-be",setup({cart:e,cartPhase:n,locale:s,innovateOfferId:a}={}){r.requiredOfPrototype(e,i,"options.cart must be a CartModel"),r.requiredOfPrototype(n,o,"options.cartPhase must be a CartPhaseModel"),this.cart=e,this.cartPhase=n,this.innovateOfferId=a,this.offers=null,this.activeOffer=null,this.locale=s||window.dsLang||t.Client.Locale.lang,this.licensingSchemesInputs=this._createLicensingSchemeInputs(),this.licensingSchemesSection=this._createLicensingSchemeSection(),this.quantitySection=this._createQuantitySection(),this.priceSection=this._createPriceSection(),this.quantitySection.input.disable(),this.listenTo(this.cartPhase,`onChange:${o.Fields.QUANTITY}`,this._updatePrice.bind(this))},render(){return this.container.setContent({tag:"div",class:"mpf-tile",html:[this.licensingSchemesSection,this.quantitySection.render(),this.priceSection]}),this},destroy(){this._parent()},update(e){const t=e&&e.getStandardOffer(),n=t&&t.getOffers();if(n){this.offers=n;const e=n.map((e=>e.getLicensingScheme()));this.quantitySection.input.enable(),this._updateAvailableLicensingScheme(e)}else this.reset()},reset(){this.offers=null,this.activeOffer=null,this.quantitySection.input.disable(),this.licensingSchemesInputs.forEach((e=>{e.uncheck(),e.disable()}));this.priceSection.getElement(".mpf-price").setText("-");this.priceSection.getElement(".mpf-price-periodicity").setText("-")},_updateAvailableLicensingScheme(e=[]){this.licensingSchemesInputs.forEach((t=>{e.includes(t.getValue())?t.enable():t.disable()}));const t=this.licensingSchemesInputs.find((e=>!e.isDisabled()));t.check(),this._onLicencingSchemeUpdate(t.getValue())},_createLicensingSchemeSection(){return e.createElement("div",{html:[{tag:"h5",class:"mpf-tile-title",text:h.get("pricing")},...this.licensingSchemesInputs]})},_createLicensingSchemeInputs(){return[new s({name:"mpf-be-licencing-scheme",value:c.RevTypes.QRC,className:"primary mpf-be-licencing-scheme",label:h.get("quarterlySubscription"),disabled:!0,checked:this.cartPhase.getPeriodicity()===c.RevTypes.QRC,events:{onChange:this._onLicencingSchemeUpdate.bind(this,c.RevTypes.QRC)}}),new s({name:"mpf-be-licencing-scheme",value:c.RevTypes.YSC,className:"primary mpf-be-licencing-scheme",label:h.get("yearlySubscription"),disabled:!0,checked:this.cartPhase.getPeriodicity()===c.RevTypes.YSC,events:{onChange:this._onLicencingSchemeUpdate.bind(this,c.RevTypes.YSC)}})]},_onLicencingSchemeUpdate(e){this.activeOffer=this.offers.find((t=>t.getLicensingScheme()===e)),this.cartPhase.unset(o.Fields.OFFER_ID),this.cartPhase.set(o.Fields.SKU_ID,this.activeOffer.id),this.cartPhase.set(o.Fields.INNOVATE_OFFER_ID,this.innovateOfferId),this.cartPhase.set(o.Fields.PRICE,this.activeOffer.getPricelistPrice().toString()),this._updatePrice()},_updatePrice(){this.priceSection.getElement(".mpf-price").setText(this._getPriceText());const e=this.priceSection.getElement(".mpf-price-periodicity");this.activeOffer.getLicensingScheme()===c.RevTypes.QRC?e.setText(h.get("quarter")):e.setText(h.get("year"))},_getPriceText(){const e=this.activeOffer?parseFloat(this.activeOffer.getPricelistPrice())*parseInt(this.quantitySection.getValue()):parseFloat(this.cartPhase.getTotalNetAmount()),t=this.activeOffer?this.activeOffer.getPricelistCurrency():this.cart.getCurrency();return e?a.formatPrice(e,{currency:t}):"-"},_createQuantitySection(){return new l({model:this.cartPhase,fieldName:o.Fields.QUANTITY,fieldLabel:h.get("quantity"),min:1,max:9999,readOnly:!this.cartPhase.isEditable()})},_createPriceSection(){const t=this.cartPhase.getPeriodicity();let n;return n=t?t===c.RevTypes.QRC?h.get("quarter"):h.get("year"):"-",e.createElement("div",{class:"mpf-tile",html:[{tag:"h5",text:h.get("price")},{tag:"p",html:[{tag:"span",class:"mpf-price",text:this._getPriceText()},{tag:"span",class:"mpf-separator",html:"&nbsp;/&nbsp;"},{tag:"span",class:"mpf-price-periodicity",text:n}]},{tag:"p",text:h.get("excludingTaxes")}]})}})})),define("DS/MPFInnovateComponent/checkout/ContractHelper",["DS/MPFShopModel/ShopServiceModel","DS/MPFTCContractModel/TCContractModel","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory"],(function(e,t,n,s){"use strict";return class{constructor({cart:e,shop:t,service:n,billingAddressHelper:s,tcContractFactory:r,tcDocumentFactory:a}){this.cart=e,this.shop=t,this.service=n,this.billingAddressHelper=s,this.tcContractFactory=r,this.tcDocumentFactory=a}needsTcSignature(){return!this.tcContracts.hasSignedContractOfType(t.DOCUMENT_TYPES.DS_BUYERS)||!this.tcContracts.hasSignedContractOfType(t.DOCUMENT_TYPES.DATA_PRIVACY)}needsScSignature(){return!!this.scContract&&this.scContract.getCurrentState()===t.STATUS.draft}async signContracts(){const e=[],n=this.billingAddressHelper.getBuyer().get("id");this.needsTcSignature()&&[t.DOCUMENT_TYPES.DS_BUYERS,t.DOCUMENT_TYPES.DATA_PRIVACY].forEach((s=>{e.push(this.tcContracts.findCurrentContractOfType(s,n).savePromise({[t.Fields.CURRENT_STATE]:t.STATUS.inEffect},{patch:!0}))})),this.needsScSignature()&&e.push(this.scContract.savePromise({[t.Fields.CURRENT_STATE]:t.STATUS.inEffect},{patch:!0}))}async fetchContractsAndDocuments(){const[{tcContracts:e,tcDocument:t,ppDocument:n},{scContract:s,scDocument:r}]=await Promise.all([this._fetchTcContractsAndDocs(),this._fetchScContractAndDoc()]);return this.tcContracts=e,this.scContract=s,[t,n,r]}async _fetchTcContractsAndDocs(){const e=this.tcContractFactory.createCollection(n.Types.TERMS_AND_CONDITIONS);await e.fetchPromise({type:[t.TcTypes.DS_BUYER,t.TcTypes.DATA_PRIVACY]});const r=this.tcDocumentFactory.createModel(s.Types.DS_BUYERS),a=this.tcDocumentFactory.createModel(s.Types.PRIVACY_POLICY);return e.hasSignedContractOfType(t.TcTypes.DS_BUYER)&&e.hasSignedContractOfType(t.TcTypes.DATA_PRIVACY)||await Promise.all([r.fetchPromise(),a.fetchPromise()]),{tcContracts:e,tcDocument:r,ppDocument:a}}async _fetchScContractAndDoc(){let r=await this.tcContractFactory.createModel(n.Types.CUSTOM_TC_SELLER,null,{parentResourceId:this.cart.get("id")}).fetchPromise();if(!r||!r.getDocumentID()){const s=await this.tcContractFactory.createCollection(n.Types.CONSUMED_CONTRACTS).fetchPromise(),a=this.billingAddressHelper.getBuyer().get("id"),i=this.shop.get("owner").match(/[A-Z0-9]{32}$/)[0];if(r=s.find((e=>e.getConsumerID()===a&&e.getDocumentType()===t.DOCUMENT_TYPES.DEFAULT_SALES_CONDITIONS&&e.getSupplierID()===i&&e.getCurrentState()!==t.STATUS.archived&&e.getSigningRevision()===e.getActiveRevision())),r)r.dataProxy=this.tcContractFactory.getDataProxy(n.Types.CONTRACTS);else{const s=this.shop.getService(this.service)[e.Fields.CONTRACT_DOCUMENTS];s&&s.length>0&&(r=this.tcContractFactory.createModel(n.Types.EXISTING_DOCUMENT,{[t.Fields.DOCUMENT_ID]:s[0].id,[t.Fields.SUPPLIER_ID]:i,[t.Fields.CONSUMER_ID]:a,[t.Fields.CURRENT_STATE]:t.STATUS.draft}),await r.savePromise())}}if(r&&!r.isNew()){const e=this.tcDocumentFactory.createModel(s.Types.DOCUMENTS,{id:r.getDocumentID()});return await e.fetchPromise(),{scContract:r,scDocument:e}}return{}}_findContractIn(e,n,s){if(e)for(let r=e.length-1;r>=0;r--){const a=e.at(r);if(a.getConsumerID()===n&&a.getDocumentType()===t.DOCUMENT_TYPES.DEFAULT_SALES_CONDITIONS&&a.getSupplierID()===s&&a.getCurrentState()!==t.STATUS.archived&&a.getSigningRevision()===a.getActiveRevision())return a}}}})),define("DS/MPFInnovateComponent/cartPhases/InnovatePhaseItemSummary",["UWA/Core","UWA/Class/View","DS/MPFUtils/FormatUtils","DS/MPFCartPhaseComponent/TimelineArrow","DS/MPFCartModel/CartItemModel","i18n!DS/MPFInnovateComponent/assets/nls/CartPhases","css!DS/MPFInnovateComponent/MPFInnovateComponent"],(function(e,t,n,s,r,a){"use strict";return t.extend({className:"mpf-innovate-phase-item-summary",setup:function(e){this.cart=e.cart,this.cartPhase=e.cartPhase},render:function(){return this.container.setContent([this._createLine1(),this._createLine2(),this._createLine3(),this._createLine4()]),this},destroy:function(){this.cart=null,this.cartPhase=null,this._parent(),this.container=null},_createLine1:function(){return e.createElement("div",{class:"mpf-line-1",html:[this._createPhaseNumber(),this._createDeliverableOptions()]})},_createPhaseNumber:function(){return e.createElement("div",{class:"mpf-phase-number",text:a.get("phaseNumber",{number:this.cartPhase.getNumber()})+a.get(":")})},_createDeliverableOptions:function(){let t;return t=this.cart.isSelfOrder()?e.createElement("div",{html:[{tag:"span",text:"-"},{tag:"span",html:"&nbsp;|&nbsp;"},{tag:"span",text:"-"}]}):e.createElement("div",{html:[{tag:"span",text:a.get("businessExperience")},{tag:"span",html:"&nbsp;|&nbsp;"},{tag:"span",text:a.get("onDemand")}]}),t},_createLine2:function(){return e.createElement("div",{class:"mpf-other-line",html:[this._createDescription()]})},_createDescription:function(){return e.createElement("div",{text:this.cartPhase.getDescription()})},_createLine3:function(){return e.createElement("div",{class:"mpf-other-line",html:[{tag:"div",class:"mpf-arrows",html:[this._createStartDate(),this._createDeliveryDate()]}]})},_createStartDate:function(){const e=this.cartPhase.getStartDate().split(" ")[0];return new s({label:a.get("startDate")+a.get(":")+" "+e}).render()},_createDeliveryDate:function(){const e=this.cartPhase.getEndDate().split(" ")[0];return new s({label:a.get("deliveryDate")+a.get(":")+" "+e,isChevron:!0}).render()},_createLine4:function(){return e.createElement("div",{class:"mpf-other-line",html:[this._createPriceOption(),this._createPrice()]})},_createPriceOption:function(){let t;return t=this.cart.isSelfOrder()?e.createElement("div",{class:"mpf-price-label",text:a.get("price")+a.get(":")+" One-time payment -"}):e.createElement("div",{class:"mpf-price-label",html:[{tag:"span",text:a.get("price")},{tag:"span",html:`${a.get(":")}&nbsp;`},{tag:"span",text:this.cartPhase.getPeriodicity()===r.RevTypes.YSC?a.get("yearly"):a.get("quarterly")},{tag:"span",html:"&nbsp;- "}]}),t},_createPrice:function(){return e.createElement("div",{class:"mpf-price",text:n.formatPrice(parseFloat(this.cartPhase.getTotalNetAmount()),{currency:this.cart.getCurrency()})})}})})),define("DS/MPFInnovateComponent/BuyBusinessExperienceHeader",["UWA/Class/View","DS/MPFOfferModel/InnovateOfferHelper","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n){"use strict";const s=Object.freeze({GO_BACK:"goBack"}),r=e.extend({className:"mpf-buy-business-experience-header",setup(){},render({offer:e,title:r,displayNavBar:a=!0}={}){let i,o,c;return r?(i=r,c=r):e?(i=n.get("checkout+title",{title:e.getTitle()}),o=n.get("by+Shop",{shop:t.isDsOffer(e)?"Dassault SystÃ¨mes":e.getShopName()}),c=e.getTitle()):(i=n.get("checkout+title",{title:n.get("cart")}),c=n.get("myCart")),this.container.setContent([a&&{tag:"div",class:"mpf-nav-bar",html:[{tag:"div",class:"mpf-back-button",html:[{tag:"span",class:"fonticon fonticon-left-open"}],events:{click:this.dispatchEvent.bind(this,s.GO_BACK)}},{tag:"div",class:"mpf-nav-bar-title",text:i},o&&{tag:"div",class:"mpf-nav-bar-subtitle",text:o}]},{tag:"div",class:"mpf-header",text:c}]),this},destroy(){this._parent(),this.container=null}});return r.Events=s,r})),define("DS/MPFInnovateComponent/myCart/ProductInfoModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Spinner","DS/MPFServices/ObjectService","DS/MPFCompassPlatformServices/CompassPlatformServices","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n,s,r,a,i){"use strict";const o=Object.freeze({}),c=t.extend({className:"mpf-product-modal",setup(){this.modal=new n,this.spinner=new s},render(){return this.container.setContent([this.modal]),this},show({offer:e}){this.modal.setBody(this.spinner.show()),this.modal.show(),this._fetchOfferInfo(e).then((e=>{e?this.modal.setBody(this._generateProductPage(e)):this._renderErrorPage()})).catch((e=>{console.error(e),this._renderErrorPage()}))},hide(){this.modal.hide()},destroy(){this.modal.destroy(),this._parent(),this.container=null},_generateProductPage(){},_fetchOfferInfo(e){const t=e.getRole();if(t){const e=t.slice(0,t.lastIndexOf("-"));return new Promise((t=>{a.getPortfolioRole(e,t)}))}return Promise.reject(new Error("No role trigram found"))},_renderErrorPage(){this.modal.setBody([{tag:"div",class:"mpf-error-tile",html:[{tag:"div",class:"fonticon fonticon-help"},{tag:"div",class:"mpf-error-message",text:i.get("failedToLoadProductInfo")}]}])},_createHeader:()=>({tag:"h3",text:i.get("subscriptionInformation")}),_createBody:()=>[{tag:"h3",text:i.get("subscriptionsAndRenewals_title")},{tag:"p",text:i.get("subscriptionsAndRenewals_text")},{tag:"h3",text:i.get("needMoreInfo_title")},{tag:"p",html:i.get("needMoreInfo_text",{faq:e.createElement("a",{text:i.get("faq"),href:"https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase",target:"_blank"}).outerHTML})}],_createFooter(){}});return c.Events=o,c})),define("DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine",["DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFUtils/StorageUtils"],(function(e,t){"use strict";const n=Object.freeze({...e.Pages,PLATFORM_SELECTION:"platformSelection"}),s=e.extend({init(e){return this._parent({doChangeUrls:!1,...e})},changePage(n,s){this.page!==n&&(this.page=n,t.storeCurrentPage(this.service,this.page),this.dispatchEvent(e.Events.PAGE_CHANGE_REQUESTED,s))},updateUrl(){},clearPage(){t.clearCurrentPage(this.service)},setCountry(e){this.setCountryInLocalStorage(e)}});return s.getInitialPage=function(n){return t.getCurrentPage(n)||e.Pages.OFFER},s.Pages=n,s.Events=e.Events,s})),define("DS/MPFInnovateComponent/cartPhases/InnovatePhaseFooter",["UWA/Class/View","i18n!DS/MPFInnovateComponent/assets/nls/CartPhases"],((e,t)=>{"use strict";return e.extend({className:"mpf-cart-phase-total-footer mpf-innovate-phase-footer",setup(e){},render(){return this.container.setContent({tag:"p",class:"mpf-message",text:t.get("businessExperiencefooterNotice")}),this},destroy(){this._parent()}})})),define("DS/MPFInnovateComponent/checkout/InnovateCheckoutSkeleton",["UWA/Class/View"],(function(e){"use strict";const t=Object.freeze({}),n=e.extend({className:"mpf-innovate-checkout-page-skeleton",setup(){},render(){return this.container.setContent([{tag:"div",class:"mpf-checkout-section mpf-order-summary-section"},{tag:"div",class:"mpf-checkout-section mpf-billing-address-section"},{tag:"div",class:"mpf-checkout-section mpf-terms-and-conditions-section"},{tag:"div",class:"mpf-checkout-section mpf-payment-section"}]),this},destroy(){this._parent(),this.container=null}});return n.Events=t,n})),define("DS/MPFInnovateComponent/myCart/InnovateSubscriptionInfoModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/MPFServices/ObjectService","i18n!DS/MPFInnovateComponent/assets/nls/SubscriptionInfo"],(function(e,t,n,s,r){"use strict";const a=Object.freeze({}),i=t.extend({className:"mpf-innovate-subscription-info-modal",setup(){this.modal=new n({header:this._createHeader(),footer:this._createFooter()})},render(){return this.container.setContent([this.modal]),this},show({offer:e}){this.modal.setBody(this._createBody(e)),this.modal.show()},hide(){this.modal.hide()},destroy(){this.modal.destroy(),this._parent(),this.container=null},_createHeader:()=>({tag:"h4",text:r.get("subscriptionInformation")}),_createBody:t=>[{tag:"h4",text:r.get("subscriptionsAndRenewals_title")},{tag:"p",text:r.get("subscriptionsAndRenewals_text")},{tag:"h4",text:r.get("needMoreInfo_title")},{tag:"p",html:r.get("needMoreInfo_text",{faq:e.createElement("a",{text:r.get("faq"),href:"https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase",target:"_blank"}).outerHTML})}],_createFooter(){}});return i.Events=a,i})),define("DS/MPFInnovateComponent/cartPhases/DeliverableInput",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/MPFServices/ObjectService","DS/MPFCartPhaseModel/CartPhaseModel","i18n!DS/MPFInnovateComponent/assets/nls/CartPhases"],(function(e,t,n,s,r,a,i,o){"use strict";const c=Object.freeze({ON_TYPE_CHANGE:"onTypeChange",BUSINESS_EXPERIENCE_ID_UPDATE:"businessExperienceIdUpdate"}),l=Object.freeze({BUSINESS_EXPERIENCE:"businessExperience",SERVICE:"service"}),h=t.extend({className:"mpf-deliverable-input",setup({cartPhase:e,offers:t}={}){a.requiredOfPrototype(e,i,"options.cartPhase must be a CartPhaseModel"),this.cartPhase=e,this.offers=t,this.state=l.BUSINESS_EXPERIENCE,this.businessExperienceIdInput=null},render(){const e=[{tag:"div",class:"mpf-deliverable-toggles",html:[this._createToggle(l.BUSINESS_EXPERIENCE,o.get("businessExperience"),"business-experience",!1),this._createToggle(l.SERVICE,o.get("service"),"service",!0)]}];return this.state===l.BUSINESS_EXPERIENCE?e.push(this._getBusinessExperienceInput()):e.push(this._createSelectInput()),this.container.setContent(e),this},destroy(){this.cartPhase=null,this.offers=null,this._parent(),this.container=null},showError(t){this.cleanError(),e.createElement("p",{class:"mpf-error",text:t}).inject(this.container)},cleanError(){this.container.getElements(".mpf-error").forEach((e=>e.remove()))},_onToggleClick(e){this.state!==e&&(this.state=e,this.render(),this.dispatchEvent(c.ON_TYPE_CHANGE,this.state))},_createToggle(e,t,s,r){return new n({className:"primary",value:e,label:t,disabled:r,checked:this.state===e,name:s,events:{onClick:this._onToggleClick.bind(this,e)}})},_createSelectInput(){return new s({name:"deliverable",options:this._getSelectOptions(),placeholder:!1,disabled:this.state===l.BUSINESS_EXPERIENCE,events:{onChange:e=>{const t=e.target.value;this.cartPhase.setOfferId(t)}}})},_getSelectOptions(){return this.state===l.SERVICE?this._filterServiceOffers().map((e=>({value:e.get("id"),label:e.getTitle(),group:o.get(e.getCategories()[0].name+"Service"),selected:e.get("id")===this.cartPhase.getOfferId()}))):[{value:"BE",label:o.get("onDemandBusinessExperience")}]},_sortServiceOffers(){},_filterServiceOffers(){return this.offers.filter((e=>e.getCategories().filter((e=>"businessExperiences"!==e.name)).length>0))},_getBusinessExperienceInput(){return this.businessExperienceIdInput||(this.businessExperienceIdInput=new r({value:this.cartPhase.getRole()||""}),this.listenTo(this.businessExperienceIdInput,"onChange",this._businessExperienceIdUpdate.bind(this))),this.businessExperienceIdInput},_businessExperienceIdUpdate(){const e=this.businessExperienceIdInput.getValue();this.dispatchEvent(c.BUSINESS_EXPERIENCE_ID_UPDATE,e)}});return h.Events=c,h.States=l,h})),define("DS/MPFInnovateComponent/offers/OfferPageSkeleton",["UWA/Class/View"],(function(e){"use strict";const t=Object.freeze({}),n=e.extend({className:"mpf-offer-page-skeleton",setup(){},render(){return this.container.setContent([{tag:"div",class:"mpf-nav-bar"},{tag:"div",class:"mpf-header mpf-flash"},{tag:"div",class:"mpf-main",html:[{tag:"div",class:"mpf-country-select mpf-flash"},{tag:"div",class:"mpf-description mpf-flash"},{tag:"div",class:"mpf-select-indication mpf-flash"},{tag:"div",class:"mpf-product-container mpf-flash",html:[{tag:"div",class:"mpf-product"},{tag:"div",class:"mpf-product mpf-selected"}]}]},{tag:"div",class:"mpf-subscription-info mpf-flash",html:[{tag:"div",class:"mpf-title"},{tag:"div",class:"mpf-info-section"},{tag:"div",class:"mpf-info-section"},{tag:"div",class:"mpf-info-section"}]}]),this},destroy(){this._parent(),this.container=null}});return n.Events=t,n})),define("DS/MPFInnovateComponent/quoteRequest/ContactPhoneNumberComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Text","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","i18n!DS/MPFInnovateComponent/assets/nls/QuoteRequest","css!DS/MPFInnovateComponent/MPFInnovateComponent"],(function(e,t,n,s,r,a){"use strict";const i=Object.freeze({ON_CHANGE:"onChange"}),o="mpf-invalid",c=t.extend({className:"mpf-contact-phone-number-component",setup(e){s.requiredOfPrototype(e.me,r,"options.me must be a PersonModel"),this.me=e.me,this.inputPhoneNumber=this._createInput(),this.inputPhoneNumberContainer=this._createInputContainer(),this.errorContainer=this._createErrorContainer()},render(){return this.container.setContent([{tag:"h4",class:"mpf-title",text:this.me.getFullName()},{tag:"label",attributes:{for:"phone"},class:"mpf-phone-number",text:a.get("phoneNumber")},this.inputPhoneNumberContainer,this.errorContainer]),this},destroy(){this._parent(),this.container=null,this.inputPhoneNumberContainer=null,this.inputPhoneNumber=null,this.errorContainer=null},async save(){if(this.validatePhoneInput()&&""!==this.inputPhoneNumber.getValue())try{await this.me.savePromise({[r.Fields.PHONE_NUMBER]:this.inputPhoneNumber.getValue()},{patch:!0})}catch(e){console.error(e)}},_onChange(){""===this.inputPhoneNumber.getValue()&&this.removeError()},_createInputContainer(){return e.createElement("div",{class:"mpf-input",html:this.inputPhoneNumber})},_createInput(){return new n({name:r.Fields.PHONE_NUMBER,placeholder:a.get("enterPhoneNumber"),attributes:{type:"tel",id:"phone",name:"phone"},events:{onChange:this._onChange.bind(this)}})},validatePhoneInput(){const e=this.inputPhoneNumber.getValue();return""===e||/[0-9+\- ]{5,20}/.test(e)?(this._removeError(),!0):(this._showError(a.get("phoneNumberInvalid")),!1)},_createErrorContainer:()=>e.createElement("div",{class:"mpf-error"}),_showError(e){this.inputPhoneNumberContainer.addClassName(o),this.errorContainer.setText(e)},_removeError(){this.inputPhoneNumberContainer.removeClassName(o),this.errorContainer.empty()}});return c.Events=i,c})),define("DS/MPFInnovateComponent/platformSelection/InfoPanel",["UWA/Class/View"],(function(e){"use strict";const t=Object.freeze({ON_CLOSE:"onClose"}),n=e.extend({className:"mpf-info-panel",setup(){},render({icon:e,title:n,body:s,button:r}){return this.container.setContent([{tag:"span",class:"mpf-close-icon fonticon fonticon-wrong",events:{click:this.dispatchEvent.bind(this,t.ON_CLOSE)}},e&&{tag:"div",class:"mpf-icon-container",html:[{tag:"span",class:`fonticon fonticon-${e}`}]},{tag:"div",class:"mpf-header",text:n},{tag:"div",class:"mpf-main",html:s},r&&{tag:"div",class:"mpf-button-container",html:[r]}]),this},destroy(){this._parent(),this.container=null}});return n.Events=t,n})),define("DS/MPFInnovateComponent/bidding/SalesConditionsCard",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","i18n!DS/MPFInnovateComponent/assets/nls/InnovateTermsAndConditions","css!DS/MPFInnovateComponent/MPFInnovateComponent"],((e,t,n,s,r,a,i,o,c)=>{"use strict";const l=t.extend({className:"mpf-nda-card mpf-bidding-card",setup({salesConditionDocument:e}={}){this.salesConditionDocument=e,this.title=this._createTitle(),this.body=this._createBody()},render(){return this.container.setContent([this.title,this.body]),this},destroy(){this._parent()},_createTitle:()=>e.createElement("h5",{class:"mpf-title",text:c.get("salesConditions")}),_createBody(){return this.salesConditionDocument?this._createDocumentLink():this._createNoDocumentMessage()},_createNoDocumentMessage:()=>e.createElement("p",{class:"mpf-message",text:c.get("noDocumentAvailable")}),_createDocumentLink(){return e.createElement("a",{class:"mpf-bidding-link",target:"_blank",href:this.salesConditionDocument.getDocUrl(),html:[{tag:"span",text:this.salesConditionDocument.getDocName()},{tag:"span",class:"fonticon fonticon-download"}]})}});return l.fromCartId=async(e,{service:t}={})=>{const n=t||r.INNOVATE,c=await s.fetchPromise({service:n}),h=a.getInstance(c),[d,p]=await h.getFactories([a.Types.TC_CONTRACT,a.Types.TC_DOCUMENT]),u=d.createModel(i.Types.CUSTOM_TC_SELLER);let m;u.setParentResourceId(e),await u.fetchPromise(),u.isNew()||(m=p.createModel(o.Types.DOCUMENTS,{id:u.getDocumentID()}),await m.fetchPromise());return new l({salesConditionDocument:m})},l})),define("DS/MPFInnovateComponent/InnovateTracker",["DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/DimensionMapping","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModelHelper"],(function(e,t,n,s,r){"use strict";const a=Object.freeze({OFFER:"Offer Page",MY_CART:"Cart Page",TENANT:"Tenant Page",CHECKOUT:"Checkout Page"}),i=Object.freeze({COUNTRY_CHANGED:"CountryChanged",YSC:"YearlySubTypeSelected",MSC:"MonthlySubTypeSelected",QRC:"QuarterlySubTypeSelected",QSC:"QuarterlySubTypeSelected",ADD_TO_CART:"addToCart",REASSURE_PAYMENT:"ReassurePayment",PAYMENT_MORE_INFO:"PaymentMoreInfo",CART_MORE_ITEMS:"CartMoreItems",QUANTITY_CHANGED:"QuantityChanged",ITEM_REMOVED:"ItemRemoved",SHOW_SUBSCRIPTION_INFO:"showSubscriptionInfo",GO_TO_PAYMENT:"GoToPayment",BACK:"back",SELECT_TENANT:"SelectTenant",TENANT_SELECTED:"TenantSelected"});class o{constructor(){this.service=s.INNOVATE,this.buyerType="company"}sendPage({cart:n,offers:s,offer:a,url:i,title:o}){const c=e.createPageBuilder({url:i}).setTitle(o);n?(r.addTrackerInformation(c,n),s&&this._completeDimensions(c,s,n)):a&&(c.addDimension(t.OFFER_NAME,a.getTitle()),this._addNoCartDimensions(c,a)),c.addDimension(t.MARKETPLACE_SERVICE,this.service).addDimension(t.BUYER_TYPE,this.buyerType).send()}sendEvent({category:n,action:s,cart:a,offers:i,offer:o,label:c,personalValue:l={}}={}){const h=e.createEventBuilder({category:n,action:s});c&&h.setLabel(c),l&&h.addPersonalValue(l.key,l.value),a?(r.addTrackerInformation(h,a),i&&this._completeDimensions(h,i,a)):o&&(h.addDimension(t.OFFER_NAME,o.getTitle()),this._addNoCartDimensions(h,o)),h.addDimension(t.MARKETPLACE_SERVICE,this.service).addDimension(t.BUYER_TYPE,this.buyerType).send()}_addNoCartDimensions(e,n){e.addDimension(t.SHOP_ID,n.getShopId()).addDimension(t.CURRENCY,n.getCurrency()).addDimension(t.ROLES,n.getRole()).addDimension(t.LICENSING_SCHEME,n.getLicensingScheme()).addDimension(t.OFFER_IDS,n.get("id"))}_completeDimensions(e,s,r){const a=e.dimensionsBuilder.dimensions,i=[];s.size()>0&&(i.push({key:t.SHOP_ID,value:s.first().getShopId()}),i.push({key:t.CURRENCY,value:s.first().getCurrency()}));r.getItems().length>0&&(i.push({key:t.ROLES,value:this._getItemsRoles(s)}),i.push({key:t.OFFER_IDS,value:this._getItemsOfferIds(s)}),i.push({key:t.LICENSING_SCHEME,value:s.first().getPeriodicityFromSkuId(r.getItems()[0].getSkuId())})),i.forEach((t=>{a[n[t.key]]||e.addDimension(t.key,t.value)}))}_getItemsRoles(e){return e.filter((e=>e.getRole())).reduce(((e,t)=>{const n=t.getRole();return e.includes(n)||e.push(n),e}),[]).join(",")}_getItemsOfferIds(e){return e.filter((e=>e.get("id"))).reduce(((e,t)=>{const n=t.get("id");return e.includes(n)||e.push(n),e}),[]).join(",")}}return o.Titles=a,o.Events=i,o})),define("DS/MPFInnovateComponent/myCart/MyCartPageSkeleton",["UWA/Class/View","DS/MPFServices/ObjectService"],(function(e,t){"use strict";const n=Object.freeze({}),s=e.extend({className:"mpf-my-cart-page-skeleton",setup(){},render(){return this.container.setContent([{tag:"div",class:"mpf-nav-bar"},{tag:"div",class:"mpf-header mpf-flash"},{tag:"div",class:"mpf-country-select mpf-flash"},{tag:"div",class:"mpf-table-header mpf-flash"},{tag:"div",class:"mpf-product-line mpf-flash"},{tag:"div",class:"mpf-total-container mpf-flash"},{tag:"div",class:"mpf-payment-button mpf-flash"}]),this},destroy(){this._parent(),this.container=null}});return s.Events=n,s})),define("DS/MPFInnovateComponent/bidding/QuoteCard",["UWA/Core","UWA/Class/View","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartQuoteModel/CartQuoteFactory","i18n!DS/MPFInnovateComponent/assets/nls/Bidding","css!DS/MPFInnovateComponent/MPFInnovateComponent"],((e,t,n,s,r,a,i)=>{"use strict";const o=t.extend({className:"mpf-quote-card",setup({cartQuote:e}={}){this.cartQuote=e,this.body=this._createBody(),this.footer=this._createFooter()},render(){return this.container.setContent([this.body,this.footer]),this},destroy(){this._parent()},_createBody(){return e.createElement("div",{class:"mpf-body",html:[{tag:"span",class:this.cartQuote?"fonticon fonticon-doc-pdf":"fonticon fonticon-doc-delete"}]})},_createLink(){return e.createElement("div",{class:"mpf-footer",html:[{tag:"a",class:"mpf-link",href:this.cartQuote.getUrl(),target:"_blank",html:[{tag:"span",text:"Quote.pdf"},{tag:"span",class:"fonticon fonticon-download"}]}]})},_createNoDocument:()=>e.createElement("div",{class:"mpf-footer",html:{tag:"p",class:"mpf-text",html:[{tag:"span",text:i.get("quote")+": "},{tag:"span",text:i.get("noDocumentAvailable")}]}}),_createFooter(){return this.cartQuote?this._createLink():this._createNoDocument()}});return o.fromCartId=async function(e,{service:t}={}){const i=t||s.INNOVATE,c=await n.fetchPromise({service:i}),l=r.getInstance(c);let h=(await l.getFactory(r.Types.CART_QUOTE)).createModel(a.Types.CART_QUOTE);h.parentResourceId=e;try{await h.fetchPromise()}catch(e){console.error(e),h=void 0}return new o({cartQuote:h})},o})),define("DS/MPFInnovateComponent/bidding/NdaCard",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","i18n!DS/MPFInnovateComponent/assets/nls/InnovateTermsAndConditions","css!DS/MPFInnovateComponent/MPFInnovateComponent"],((e,t,n,s,r,a,i,o,c)=>{"use strict";const l=t.extend({className:"mpf-nda-card mpf-bidding-card",setup({ndaDocument:e}={}){this.ndaDocument=e,this.title=this._createTitle(),this.body=this._createBody()},render(){return this.container.setContent([this.title,this.body]),this},destroy(){this._parent()},_createTitle:()=>e.createElement("h5",{class:"mpf-title",text:c.get("nonDisclosureAgreement")}),_createBody(){return this.ndaDocument?this._createDocumentLink():this._createNoDocumentMessage()},_createNoDocumentMessage:()=>e.createElement("p",{class:"mpf-message",text:c.get("noDocumentAvailable")}),_createDocumentLink(){return e.createElement("a",{class:"mpf-bidding-link",target:"_blank",href:this.ndaDocument.getDocUrl(),html:[{tag:"span",text:this.ndaDocument.getDocName()},{tag:"span",class:"fonticon fonticon-download"}]})}});return l.fromCartId=async(e,{service:t}={})=>{const n=t||r.INNOVATE,c=await s.fetchPromise({service:n}),h=a.getInstance(c),[d,p]=await h.getFactories([a.Types.TC_CONTRACT,a.Types.TC_DOCUMENT]),u=d.createModel(i.Types.NDA);let m;u.setParentResourceId(e),await u.fetchPromise(),u.isNew()||(m=p.createModel(o.Types.DOCUMENTS,{id:u.getDocumentID()}),await m.fetchPromise());return new l({ndaDocument:m})},l})),define("DS/MPFInnovateComponent/bidding/InnovateStepProgressBar",["DS/MPFStepProgressBarComponent/StepProgressBarComponent","DS/MPFServices/ObjectService","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartPhaseModel/CartPhaseCollection","i18n!DS/MPFInnovateComponent/assets/nls/InnovateStepProgressBar"],(function(e,t,n,s,r){"use strict";const a=Object.freeze({}),i=["submitted","quoted","confirmed","processing","delivered"],o=new Map;o.set(n.States.DRAFT,0),o.set(n.States.SUBMITTED,0),o.set(n.States.ACCEPTED,1),o.set(n.States.PAYMENT_REFUSED,1),o.set("PENDING_PAYMENT",1),o.set("PAYMENT_INITIATED",1),o.set(n.States.PENDING_PROCESSING,2),o.set("PAYMENT_ACCEPTED",2),o.set("PAYMENT_COMPLETE",2),o.set(n.States.PROCESSING,3),o.set(n.States.READY,3),o.set(n.States.SHIPPED,3),o.set(n.States.DELIVERED,4);const c=e.extend({setup({phases:e}={}){t.requiredOfPrototype(e,s,"options.phases must be a CartPhaseCollection"),this.phases=e,this._parent({steps:i.map((e=>r.get(e))),activeStep:this._getActiveStepIndex(),infoSteps:[]}),this.listenTo(e,"onSync",this.render.bind(this))},render(){return this.setActiveStep(this._getActiveStepIndex()),this._parent()},setActiveStep(e){this.activeStep=e},destroy(){this.stopListening(),this.phases=null,this._parent(),this.container=null},_getActiveStepIndex(){const e=this.phases.getActivePhase();return e?o.get(e.getState()):0}});return c.Events=a,c})),define("DS/MPFInnovateComponent/offers/SubscriptionInfoComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","i18n!DS/MPFInnovateComponent/assets/nls/SubscriptionInfo"],(function(e,t,n,s){"use strict";const r=Object.freeze({}),a=t.extend({className:"mpf-subscription-info-component",setup(){},render(){return this.container.setContent([{tag:"div",class:"mpf-title",text:s.get("subscriptionInformation")},{tag:"div",class:"mpf-section-container",html:[this._renderGettingStartedSection(),this._renderSection(s.get("subscriptionsAndRenewals_title"),s.get("subscriptionsAndRenewals_text")),this._renderNeedMoreInfoSection()]}]),this},destroy(){this._parent(),this.container=null},_renderGettingStartedSection(){const e=[];for(let t=1;t<4;t++)e.push({tag:"li",text:s.get("gettingStarted_part"+t)});return this._renderSection(s.get("gettingStarted_title"),{tag:"div",class:"mpf-getting-started-content",html:[{tag:"div",class:"mpf-intro",text:s.get("gettingStarted_intro")},{tag:"ul",class:"mpf-list",html:e}]})},_renderNeedMoreInfoSection(){return this._renderSection(s.get("needMoreInfo_title"),s.get("needMoreInfo_text",{faq:this._createLink(s.get("faq"),"https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase")}))},_createLink:(t,n)=>e.createElement("a",{text:t,href:n,target:"_blank"}).outerHTML,_renderSection:(e,t)=>({tag:"div",class:"mpf-subscription-section",html:[{tag:"div",class:"mpf-section-title",text:e},{tag:"div",class:"mpf-section-content",html:t}]})});return a.Events=r,a})),define("DS/MPFInnovateComponent/myCart/MyInnovateCartHelper",["DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFPspModel/PspModel","DS/MPFUtils/StorageUtils"],(function(e,t,n,s,r,a){"use strict";const i=new Map;i.set("YSC","yearly"),i.set("QRC","quarterly"),i.set("QSC","quarterly"),i.set("MSC","monthly");const o=new Map;o.set("YSC","year"),o.set("QRC","quarter"),o.set("QSC","quarter"),o.set("MSC","month");const c=new Map;c.set("YSC","YSC"),c.set("QRC","QSC"),c.set("QSC","QSC"),c.set("MSC","MSC");return class{static getAdjectiveFromLicensingScheme(e){return i.get(e)}static getNounFromLicensingScheme(e){return o.get(e)}static getFrontEndSchemeName(e){return c.get(e)}static async checkMaxChargeCompliance({psp:e,country:t,cart:n,offers:s,service:a}){const i=n.getItems().reduce(((e,t)=>{const n=s.get(t.getInnovateOfferId());return e+=n.getPrice(n.getPeriodicityFromSkuId(t.getSkuId()))*t.getQuantity()}),0),o=s.at(0);await e.fetchPromise({service:a,country:t,licensorId:o.getShopLicensorId(),currency:o.getShopCurrency(),onPassportError(e,t){console.error(e);const n=window.location.href;window.location.href=t.replace("/logout","")+"/login?service="+encodeURIComponent(n)}});const c=parseFloat(e.get(r.Fields.MAX_CHARGE_AMOUNT));return isNaN(c)||i<=c}static async patchTenantId({cart:t,tenantId:n,service:s}){const r={[e.Fields.ONLINE_INSTANCE]:n};t.getState()===e.States.DRAFT&&(r[e.Fields.STATE]=e.States.SUBMITTED),await t.savePromise(r,{patch:!0}),a.storeCart(s,t)}static async deleteItem({cart:t,item:r,service:i}){if(r.isNew()){const n=t.getItems();n.splice(n.findIndex((e=>e.getName()===r.getName())),1);const s=n.reduce(((e,t)=>e+parseFloat(t.getTotalNetAmount())),0);t.setItems(n),t.set(e.Fields.NET_AMOUNT_TOTAL,s)}else{const e=new n;e.add(new s(s.Operations.REMOVE,"/cart-items/"+r.get("id"))),await t.megaPatch(e)}a.storeCart(i,t)}static async saveCart({cart:r,service:i}){r.isNew()&&await r.savePromise({[e.Fields.IS_SELF_ORDER]:!0},{onPassportError:this.redirectToLogin.bind(this)});const o=[],c={Currency:r.getCurrency()};r.isSelfOrder()||(c[e.Fields.IS_SELF_ORDER]=!0),o.push(new s(s.Operations.MODIFY,"/",c)),r.getItems().forEach((e=>{e.isNew()?o.push(new s(s.Operations.ADD,"/cart-items",{[t.Fields.INNOVATE_OFFER_ID]:e.getInnovateOfferId(),[t.Fields.SKU_ID]:e.getSkuId(),[t.Fields.QUANTITY]:e.getQuantity(),[t.Fields.TYPE]:e.getType()})):e.hasPendingChanges()&&o.push(new s(s.Operations.MODIFY,"/cart-items/"+e.get("id"),e.getPendingChanges()))}));const l=new n;l.addAll(o),await r.megaPatch(l),a.storeCart(i,r)}static redirectToLogin(e,t){console.error(e);const n=window.location.origin+window.location.pathname+window.location.hash;window.location.href=t.replace("/logout","")+"/login?service="+encodeURIComponent(n)}}})),define("DS/MPFInnovateComponent/cartPhases/PricingTileService",["UWA/Class/View","DS/UIKIT/Input/Toggle","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFView/FieldPriceInput","i18n!DS/MPFInnovateComponent/assets/nls/CartPhases"],(function(e,t,n,s,r,a,i){"use strict";const o=Object.freeze({}),c=e.extend({className:"mpf-pricing-tile",setup({cart:e,cartPhase:t}={}){n.requiredOfPrototype(e,s,"options.cart must be a CartModel"),n.requiredOfPrototype(t,r,"options.cartPhase must be a CartPhaseModel"),this.cart=e,this.cartPhase=t,this.priceInput=this._createPriceInput()},render(){return this.container.setContent([{tag:"div",class:"mpf-pricing-toggle-container",html:[]},this.priceInput.render()]),this},showError(e){this.priceInput.showError(e)},destroy(){this.stopListening(),this.priceInput.destroy(),this.priceInput=null,this.cart=null,this.cartPhase=null,this._parent(),this.container=null},_isSubscriptionAndCreditsEnabled:()=>!0,_onToggleClick(e){},_createToggle(e,n){return new t({className:"primary",value:e,name:e,label:n,checked:!0,type:"radio-2",events:{onClick:this._onToggleClick.bind(this,e)}})},_createPriceInput(){return new a({model:this.cartPhase,fieldName:r.Fields.PRICE,fieldLabel:i.get("price"),readOnly:!this.cartPhase.isEditable(),min:.5,max:999999.99,numberDecimals:2,currency:this.cart.getCurrency()})}});return c.Events=o,c})),define("DS/MPFInnovateComponent/quoteRequest/TCNDAComponent",["UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/File","DS/MPFUtils/FormatUtils","DS/MPFServices/ObjectService","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFTCContractModel/TCContractModel","DS/MPFTcDocumentModel/TcDocumentModel","DS/MPFTcContractComponent/TermsOfUseOrder","i18n!DS/MPFInnovateComponent/assets/nls/QuoteRequest","css!DS/MPFInnovateComponent/MPFInnovateComponent"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p){"use strict";const u=Object.freeze({ON_CHANGE:"onChange"}),m=Object.freeze({NDA:"NDA"}),C={[m.NDA]:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf"]},f=e.extend({className:"mpf-tcnda-component",setup(e){i.requiredOfPrototype(e.tcContractFactory,o,"options.tcContractFactory must be a TcContractFactory"),i.requiredOfPrototype(e.tcDocumentFactory,c,"options.tcDocumentFactory must be a TcDocumentFactory"),i.requiredOfPrototype(e.tcDocument,h,"options.tcDocument must be a TCDocumentModel"),i.requiredOfPrototype(e.privacyPolicyDocument,h,"options.privacyPolicyDocument must be a TCDocumentModel"),i.requiredOfPrototype(e.tcContract,l,"options.tcContract must be a TCContractModel"),i.requiredOfPrototype(e.privacyPolicyContract,l,"options.privacyPolicyContract must be a TCContractModel"),this.tcContractFactory=e.tcContractFactory,this.tcDocumentFactory=e.tcDocumentFactory,this.tcDocument=e.tcDocument,this.tcContract=e.tcContract,this.privacyPolicyDocument=e.privacyPolicyDocument,this.privacyPolicyContract=e.privacyPolicyContract,this.addNdaButton=this._createAddNdaButton(),this.TCAcceptance=this._createTCAcceptance(),this.alert=this._createAlert()},render({nda:e}={}){return e&&(this.nda=e),this.alert.hide(),this.container.setContent([this.alert,t.createElement("div",{class:"mpf-nda",html:[this.addNdaButton,this.nda?{tag:"span",class:"mpf-nda-file",text:this.nda.docName}:""]}),t.createElement("div",{class:"mpf-nda-info",html:p.get("ndaInfo")}),t.createElement("div",{class:"mpf-tc-acceptance",html:this.TCAcceptance.render()})]),this},isValid(){return this.TCAcceptance.isChecked()},async getNda({shopOwner:e,companyId:t}){let n,s;return this.nda&&(e=e.substring(e.lastIndexOf("/")+1,e.length),n=this.tcContractFactory.createModel(o.Types.EXISTING_DOCUMENT,{consumerID:e,documentID:this.nda.docID,supplierID:t}),await n.savePromise(),s=this.nda.documentModel),{ndaContract:n,ndaDocument:s}},destroy(){this.stopListening(),this.TCAcceptance&&this.TCAcceptance.destroy(),this.TCAcceptance=null,this.addNdaButton=null,this.nda=null,this.alert&&this.alert.destroy(),this.alert=null,this._parent(),this.container=null},_createAddNdaButton(){const e=new r({buttonText:p.get("addNda"),className:"mpf-nda-button",input:!1,name:m.NDA,events:{onChange:this._uploadFile.bind(this,m.NDA)},attributes:{title:p.get("addNda")}});return this._addIcon("attributes-add",e),e},_addIcon(e,n){t.createElement("span",{class:"fonticon fonticon-"+e}).inject(n.elements.button,"top")},_uploadFile(e,s){const r=this,a={};let i;const o=s.target.files[0];if(t.is(o)){const t=this._validateFile(e,o);t.ok?(e===m.NDA&&(i=this.tcDocumentFactory.createModel(c.Types.NEW_NDA),a.type=h.DocumentTypes.NDA),n.mask(this.container),i.saveDocument({file:o},a).then((function(t){n.unmask(r.container),r.render({nda:{docName:o.name,docID:i.getDocID()||Object.keys(i.get("documentIDs"))[0],docType:e,documentModel:t}})})).catch((function(){const e=o.type.indexOf("image")>-1?p.get("imageCantBeUploadedNDA"):p.get("uploadError");n.unmask(r.container),r.alert.add({className:"error",message:e}).show()})).finally((()=>{this.addNdaButton.clear()}))):r.alert.add({className:"error",message:t.message}).show()}},_validateFile(e,t){const n=this._validateFileSize(e,t.size),s=this._validateFileType(e,t.type);return{ok:n.ok&&s.ok,message:n.message||s.message}},_validateFileSize(e,t){const n={ok:!0};return e===m.NDA||e===m.SALES_CONDITIONS?(n.ok=!this.maxSpecificFileSize||t<=this.maxSpecificFileSize,n.ok||(n.message=p.get("fileExceedsMaxSize",{size:a.getReadableFileSize(this.maxSpecificFileSize)}))):e===m.OTHER&&(n.ok=!this.maxFileSize||t<=this.maxFileSize,n.ok||(n.message=p.get("fileExceedsMaxSize",{size:a.getReadableFileSize(this.maxFileSize)}))),n},_validateFileType(e,t){const n={},s=C[e];return n.ok=!s||s.includes(t),n.ok||(n.message=p.get("fileFormatNotSupported")),n},_onChange(){this.dispatchEvent(u.ON_CHANGE,{isValid:this.TCAcceptance.isChecked()})},_createTCAcceptance(){return new d({privacyPolicyDocument:this.privacyPolicyDocument,privacyPolicyContract:this.privacyPolicyContract,tcDocument:this.tcDocument,tcContract:this.tcContract,callback:this._onChange.bind(this)})},_createAlert:()=>new s({visible:!1})});return f.Events=u,f.DocTypes=m,f})),define("DS/MPFInnovateComponent/quoteRequest/NewCompanyCard",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFCountryModel/CountryCollection","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","i18n!DS/MPFInnovateComponent/assets/nls/QuoteRequest"],(function(e,t,n,s,r,a,i,o,c){"use strict";const l=Object.freeze({ON_SELECTED:"onSelected",ON_CHANGE:"onChange"}),h=e.extend({className:"mpf-new-company-card",domEvents:{click:"_cardClicked"},setup(e){s.requiredOfPrototype(e.newCompany,r,"options.newCompany must be a CompanyModel"),s.requiredOfPrototype(e.countries,a,"options.countries must be a CountryCollection"),this.newCompany=e.newCompany,this.countries=e.countries,this.availableCountries=e.availableCountries,this.noToggle=!0===e.noToggle,this.companyName=this._createCompanyName(),this.companyCountry=this._createCompanyCountry(),this.noToggle||(this.toggle=this._createToggle())},render(){return this.container.setContent([this.noToggle?"":this.toggle,t.createElement("div",{class:"mpf-new-company-inputs",html:[this.companyName.render(),this.companyCountry.render()]})]),this},select(){this.toggle.check(),this.container.addClassName("mpf-selected")},unselect(){this.toggle.uncheck(),this.container.removeClassName("mpf-selected")},resetValues(){this.companyName.resetValue(),this.companyCountry.resetValue()},isValid(){const e=this.companyName.validate(),t=this.companyCountry.validate();return e.isValid&&t.isValid},async save(){if(this.isValid()&&this.newCompany.isNew())try{await this.newCompany.savePromise({[r.Fields.NAME]:this.newCompany.getName(),[r.Fields.COUNTRY]:this.newCompany.getCountry()})}catch(e){console.error(e)}},destroy(){this.stopListening(),this.companyName&&this.companyName.destroy(),this.companyCountry&&this.companyCountry.destroy(),this.companyName=null,this.companyCountry=null,this.warningMessage=null,this.toggle&&(this.toggle=null),this._parent(),this.container=null},_createCompanyName(){const e=new i({model:this.newCompany,fieldName:r.Fields.NAME,fieldLabel:c.get("companyName"),placeholder:c.get("typeCompanyName"),required:!0,dynamicValidation:!0});return this.listenTo(e,i.Events.UPDATE,this.dispatchEvent.bind(this,l.ON_CHANGE)),e},_createCompanyCountry(){const e=new o({model:this.newCompany,fieldName:r.Fields.COUNTRY,fieldLabel:c.get("country"),placeholder:c.get("selectCountry"),required:!0,dynamicValidation:!0,selectableOptions:this._getCountriesOptions()});return this.listenTo(e,o.Events.UPDATE,(()=>{this._checkCountryIsOpened(),this.dispatchEvent(l.ON_CHANGE)})),e},_getCountriesOptions(){return this.countries.map((e=>({value:e.getIso3(),label:e.getName()})))},_createToggle:()=>new n({type:"radio",name:"address-selection",label:c.get("other"),className:"mpf-toggle primary"}),_checkCountryIsOpened(){const e=this.companyCountry.getValue(),t=this.availableCountries.find((t=>e===t));e&&!t?this.warningMessage?this.warningMessage.isHidden()&&this.warningMessage.show():this.warningMessage=this._createWarningMessage():this.warningMessage&&!this.warningMessage.isHidden()&&this.warningMessage.hide()},_createWarningMessage(){const e=t.createElement("span",{class:"fonticon fonticon-attention"}),n=t.createElement("div",{class:"mpf-warning-msg",html:[e,c.get("countryNotAvailable")]});return this.container.getElement(".mpf-select-v2 label").addContent(n),n},_cardClicked(){this.dispatchEvent(l.ON_SELECTED,{addressCard:this})}});return h.Events=l,h})),define("DS/MPFInnovateComponent/quoteRequest/TCNDAFactory",["DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFTCContractModel/TCContractModel","DS/MPFInnovateComponent/quoteRequest/TCNDAComponent"],(function(e,t,n,s,r,a,i,o){"use strict";class c{static async createComponent({service:a=t.INNOVATE}={}){const c=await e.fetchPromise({service:a}),l=n.getInstance(c),[h,d,p]=await l.getFactories([n.Types.PERSON,n.Types.TC_CONTRACT,n.Types.TC_DOCUMENT]),u=h.createModel(s.Types.ME),m=d.createCollection(r.Types.TERMS_AND_CONDITIONS);await Promise.all([u.fetchPromise(),m.fetchPromise({type:[i.TcTypes.DS_BUYER,i.TcTypes.DATA_PRIVACY]})]);const{doesNeedSignature:C,tcContract:f,privacyPolicyContract:g,tcDocument:y,privacyPolicyDocument:S}=await this.loadTermsOfUsePrivacyPolicyData({me:u,contracts:m,tcDocumentFactory:p});return new o({doesNeedSignature:C,tcContractFactory:d,tcDocumentFactory:p,tcDocument:y,tcContract:f,privacyPolicyDocument:S,privacyPolicyContract:g})}static async loadTermsOfUsePrivacyPolicyData({me:e,contracts:t,tcDocumentFactory:n}){const s="company"===e.getBuyerType()?e.getCompanyId():e.get("id"),r=this.findContract(t,i.DOCUMENT_TYPES.DATA_PRIVACY,s),o=this.findContract(t,i.DOCUMENT_TYPES.DS_BUYERS,s),c=r.getCurrentState()===i.STATUS.draft||o.getCurrentState()===i.STATUS.draft,l=n.createModel(a.Types.DS_BUYERS),h=n.createModel(a.Types.PRIVACY_POLICY);return c&&await Promise.all([l.fetchPromise(),h.fetchPromise()]),{doesNeedSignature:c,tcContract:o,privacyPolicyContract:r,tcDocument:l,privacyPolicyDocument:h}}static findContract(e,t,n){let s=e.find((function(e){return e.getDocumentType()===t&&e.getCurrentState()===i.STATUS.inEffect}));return s||(s=e.find((function(e){return e.getDocumentType()===t&&e.getCurrentState()===i.STATUS.draft&&e.getConsumerID()===n}))),s}}return c.Events=o.Events,c})),define("DS/MPFInnovateComponent/quoteRequest/ContactPhoneNumberFactory",["DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFInnovateComponent/quoteRequest/ContactPhoneNumberComponent"],(function(e,t,n,s,r){"use strict";class a{static async createComponent({service:a=t.INNOVATE}={}){const i=await e.fetchPromise({service:a}),o=n.getInstance(i),c=await o.getFactory(n.Types.PERSON),l=await c.createModel(s.Types.ME).fetchPromise();return new r({me:l})}}return a.Events=r.Events,a})),define("DS/MPFInnovateComponent/checkout/InnovateCheckoutDataLoader",["DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFOfferModel/OfferFactory","DS/MPFTenantModel/TenantFactory","DS/MPFUtils/StorageUtils","DS/MPFServices/MarketplaceServices","DS/MPFError/ValidationError","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFInnovateComponent/myCart/MyInnovateCartHelper"],(function(e,t,n,s,r,a,i,o,c){"use strict";const l=Object.freeze({NO_PLATFORM_ERROR:"noPlatformError",NO_ADMIN_ERROR:"noAdminError",TENANT_SELECTION:"tenantSelection",CHECKOUT:"checkout",END_PURCHASING:"endPurchasing"});class h{constructor({me:e,companies:t,openedCountries:n,offerFactory:s,cartFactory:r,tenantFactory:i,service:o=a.INNOVATE}){this.me=e,this.companies=t,this.openedCountries=n,this.cartFactory=r,this.offerFactory=s,this.tenantFactory=i,this.service=o}async loadData(){let n,a;const i=this.cartFactory.createModel(t.Types.ME,{});r.loadStoredCart(this.service,i),this.me.isNew()&&await this.me.fetchPromise({onPassportError:c.redirectToLogin.bind(this)});const o=this.companies.map((e=>e.getAddress().getCountry())),h=o.filter(((e,t)=>o.indexOf(e)===t));if(h.length>0)if(await this._loadOffersAndCompareCountries({cart:i,companyCountries:h}),i.getOnlineInstance())n=l.CHECKOUT;else{i.isNew()&&await i.savePromise({[e.Fields.IS_SELF_ORDER]:!0},{onPassportError:c.redirectToLogin.bind(this)}),a=this.tenantFactory.createCollection(s.Types.TENANTS,[],{parentResourceId:i.get("id")}),await a.fetchPromise();const t=a.filter((e=>e.isAdmin()));a.size()<1?n=l.NO_PLATFORM_ERROR:t.length<1?n=l.NO_ADMIN_ERROR:1===t.length?(i.setOnlineInstance(t[0].getId()),n=l.CHECKOUT):n=l.TENANT_SELECTION}else n=l.NO_PLATFORM_ERROR;return{step:n,cart:i,tenants:a}}async _loadOffersAndCompareCountries({cart:e,companyCountries:t}){const s=e.getItems(),a=s.map((e=>e.getInnovateOfferId())),c=a.filter(((e,t)=>a.indexOf(e)===t)),l=this.offerFactory.createCollection(n.Types.PUBLIC_OFFER_V2);r.loadStoredOffers(this.service,l);const h=c.filter((e=>!l.get(e)));h.length>0&&(await Promise.all(h.map((async e=>{const t=this.offerFactory.createModel(n.Types.PUBLIC_OFFER_V2);t.set("id",e),await t.fetchPromise(),l.push(t)}))),r.storeOffers(this.service,l));for(let e=0;e<s.length;e++){const n=s[e];if(l.get(n.getInnovateOfferId()).getCountries().filter((e=>t.includes(e)&&!!this.openedCountries.getCountryWithIso3(e))).length<1)throw new i("Offer is not available in company's country",{errorCode:o.Errors.UNAVAILABLE_IN_COUNTRY})}}}return h.Steps=l,h})),define("DS/MPFInnovateComponent/checkout/InnovateTermsAndConditions",["UWA/Class/View","UWA/String","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Input/Toggle","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFShopModel/ShopModel","DS/MPFTCContractModel/TCContractModel","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFInnovateComponent/checkout/ContractHelper","DS/MPFModalConfiguratorComponent/BillingAddressHelper","DS/MPFClickAndBuyComponent/checkout/LegalAgreementsSection","i18n!DS/MPFInnovateComponent/assets/nls/InnovateTermsAndConditions","css!DS/MPFInnovateComponent/MPFInnovateComponent"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p,u,m,C){"use strict";const f=Object.freeze({LOADING:"loading",LOADED:"loaded"}),g=Object.freeze({VALID_SECTION:"validSection",INVALID_SECTION:"invalidSection"}),y=e.extend({className:"mpf-innovate-terms-and-conditions",setup(e={}){i.requiredOfPrototype(e.cart,o,"options.cart must be a CartModel"),i.requiredOfPrototype(e.shop,c,"options.shop must be a ShopModel"),i.requiredOfPrototype(e.tcContractFactory,h,"options.tcContractFactory must be a TcContractFactory"),i.requiredOfPrototype(e.tcDocumentFactory,d,"options.tcDocumentFactory must be a TcDocumentFactory"),i.requiredOfPrototype(e.billingAddressHelper,u,"options.billingAddressHelper must be a BillingAddressHelper"),this.cart=e.cart,this.shop=e.shop,this.buyer=e.buyer,this.tcContractFactory=e.tcContractFactory,this.tcDocumentFactory=e.tcDocumentFactory,this.softwareAgreement=e.softwareAgreement,this.billingAddressHelper=e.billingAddressHelper,this.service=e.service||a.INNOVATE,this.contractHelper=this._createContractHelper(),this.isBusinessExperienceByDS=this.cart.isInnovateBusinessExperienceOrder(a.INNOVATE),this.isBusinessExperienceByDS?this.legalAgreementsSection=this._createLegalAgreementSection():(this.tcToggle=this._createTermsAndConditionsToggle(),this.scToggle=this._createSalesConditionsToggle()),this.state=e.state||f.LOADING},render(){if(this.state===f.LOADED){let e;this.isBusinessExperienceByDS?e=this.legalAgreementsSection.render():(e=[],this.contractHelper.needsTcSignature()&&e.push(this._renderTcToggleWithLabel()),this.contractHelper.needsScSignature()&&e.push(this._renderScToggleWithLabel())),this.container.setContent(e),s.unmask(this.container),this._publishValidity()}else this.container.setContent({tag:"div",class:"mpf-placeholder"}),s.mask(this.container),this._loadContracts();return this},isChecked(){const e=this.state===f.LOADED;let t;return t=this.isBusinessExperienceByDS?this.legalAgreementsSection.isChecked():(!this.contractHelper.needsTcSignature()||this.tcToggle.isChecked())&&(!this.contractHelper.needsScSignature()||this.scToggle.isChecked()),e&&t},save(){if(this.isChecked())return this.contractHelper.signContracts()},destroy(){this.cart=null,this.shop=null,this.billingAddressHelper=null,this.contractHelper=null,this.tcDocument=null,this.ppDocument=null,this.scDocument=null,this._parent(),this.container=null},async _loadContracts(){[this.tcDocument,this.ppDocument,this.scDocument]=await this.contractHelper.fetchContractsAndDocuments(),this.state=f.LOADED,this.render()},_publishValidity(){this.isChecked()?this.dispatchEvent(g.VALID_SECTION):this.dispatchEvent(g.INVALID_SECTION)},_renderTcToggleWithLabel(){return this._renderToggleWithLabel({toggle:this.tcToggle,label:t.format(C.get("tcText"),n.createElement("a",{text:C.get("termsOfUse"),href:this.tcDocument.getDocUrl(),target:"_blank"}).outerHTML,n.createElement("a",{text:C.get("privacyPolicy"),href:this.ppDocument.getDocUrl(),target:"_blank"}).outerHTML)})},_renderScToggleWithLabel(){return this._renderToggleWithLabel({toggle:this.scToggle,label:t.format(C.get("scText"),this.shop.getName(),n.createElement("a",{text:C.get("salesConditions"),href:this.scDocument.getDocUrl(),target:"_blank"}).outerHTML)})},_renderToggleWithLabel:({toggle:e,label:t})=>({tag:"div",class:"mpf-toggle-line",html:[e,{tag:"span",html:t}]}),_createContractHelper(){return new p({cart:this.cart,shop:this.shop,service:this.service,billingAddressHelper:this.billingAddressHelper,tcContractFactory:this.tcContractFactory,tcDocumentFactory:this.tcDocumentFactory})},_createTermsAndConditionsToggle(){return new r({type:"checkbox",label:"",className:"mpf-entry mpf-toggle primary mpf-tc-toggle",events:{onChange:this._publishValidity.bind(this)}})},_createSalesConditionsToggle(){return new r({type:"checkbox",label:"",className:"mpf-entry mpf-toggle primary mpf-sc-toggle",events:{onChange:this._publishValidity.bind(this)}})},_createLegalAgreementSection(){const e=new m({cart:this.cart,buyer:this.buyer,tcContractFactory:this.tcContractFactory,tcDocumentFactory:this.tcDocumentFactory,softwareAgreement:this.softwareAgreement});return this.listenTo(e,m.Events.VALID_SECTION,(()=>{this.dispatchEvent(g.VALID_SECTION)})),this.listenTo(e,m.Events.INVALID_SECTION,(()=>{this.dispatchEvent(g.INVALID_SECTION)})),e}});return y.Events=g,y})),define("DS/MPFInnovateComponent/cartPhases/InnovatePhaseItemCreator",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFOfferModel/OfferCollection","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldDateInput","DS/MPFInnovateComponent/cartPhases/DeliverableInput","DS/MPFInnovateComponent/cartPhases/PricingTileService","DS/MPFInnovateComponent/cartPhases/PricingTileBE","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFCompanyModel/CompanyFactory","i18n!DS/MPFInnovateComponent/assets/nls/CartPhases","css!DS/MPFInnovateComponent/MPFInnovateComponent"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p){"use strict";const u=Object.freeze({DELETE:"delete"}),m=Object.freeze({SERVICE_PHASE:"servicePhase",BUSINESS_EXPERIENCE_PHASE:"businessExperiencePhase"}),C=e.extend({className:"mpf-innovate-phase-item-creator",setup({cart:e,cartPhase:a,offers:i,minDate:o,maxDate:c,portfolioFactory:l,companyFactory:h,showDeleteButton:d}={}){t.requiredOfPrototype(e,n,"options.cart must be a CartModel"),t.requiredOfPrototype(a,s,"options.cartPhase must be a CartPhaseModel"),t.requiredOfPrototype(i,r,"options.offers must be an OfferCollection"),this.cart=e,this.cartPhase=a,this.offers=i,this.minDate=o,this.maxDate=c,this.portfolioFactory=l,this.companyFactory=h,this.portfolioPackCollection=null,this.shop=null,this.innovateItemOfferId=null,this.showDeleteButton=!1!==d,this.state=m.BUSINESS_EXPERIENCE_PHASE;const p=this._calculateMinAndMaxDates(this.cartPhase.getStartDate()&&new Date(this.cartPhase.getStartDate()),this.cartPhase.getEndDate()&&new Date(this.cartPhase.getEndDate()));this.nameInput=null,this.descriptionInput=this._createDescriptionInput(),this.deliverableInput=this._createDeliverableInput(),this.startDateInput=this._createStartDateInput(p),this.endDateInput=this._createEndDateInput(p),this.pricingServiceTile=null,this.pricingBETile=null},render(){return this.container.setContent([{tag:"div",class:"mpf-header",html:[{tag:"div",text:p.get("phaseNumber",{number:this.cartPhase.getNumber()})},this.showDeleteButton&&this.cartPhase.isEditable()&&this._renderTrashIcon()]},{tag:"div",class:"mpf-main",html:[this._renderLeftColumn(),this._renderRightColumn()]}]),this},_renderLeftColumn(){const e=[];return this.state===m.BUSINESS_EXPERIENCE_PHASE&&e.push(this._renderTile({content:this._getNameInput().render()})),e.push(this._renderTile({content:this.descriptionInput.render()})),e.push(this._renderTile({title:p.get("deliverable"),className:"mpf-deliverable",content:this.deliverableInput.render()})),e.push(this._renderTile({title:p.get("timeline"),className:"mpf-timeline",content:[this.startDateInput.render(),this._renderArrow(),this.endDateInput.render()]})),{tag:"div",class:"mpf-left-column",html:e}},_renderRightColumn(){const e=[];return this.state===m.BUSINESS_EXPERIENCE_PHASE?e.push(this._getPricingBETile().render()):e.push(this._getPricingServiceTile().render()),{tag:"div",class:"mpf-right-column",html:e}},getPhase(){return this.cartPhase},showErrors(e,t){e.getErrors().forEach(((e,n)=>{let r;switch(e.field){case s.Fields.DESCRIPTION:r=this.descriptionInput,this.descriptionInput.validate();break;case s.Fields.UNIT_NET_AMOUNT:r=this.pricingTile,this.pricingTile.showError(e.message);break;case s.Fields.START_DATE:r=this.startDateInput,this.startDateInput.showValidationErrors({isValid:!1,errors:[e]});break;case s.Fields.END_DATE:r=this.endDateInput,this.endDateInput.showValidationErrors({isValid:!1,errors:[e]})}t&&0===n&&r.focus&&r.focus()}))},destroy(){this._parent(),this.container=null},updateMinAndMaxDates(e){if(this.minDate=e.minDate,this.maxDate=e.maxDate,this.startDateInput&&this.endDateInput){const e=this.startDateInput.getDate(),t=this.endDateInput.getDate(),n=this._calculateMinAndMaxDates(e,t);this.startDateInput.setMinDate(n.startDateMin),this.startDateInput.setMaxDate(n.startDateMax),this.endDateInput.setMinDate(n.endDateMin),this.endDateInput.setMaxDate(n.endDateMax)}},_calculateMinAndMaxDates(e,t){const n={};return n.startDateMin=this.minDate,n.endDateMax=this.maxDate,n.startDateMax=!t||t>this.maxDate?this.maxDate:t,n.endDateMin=!e||e<this.minDate?this.minDate:e,n},_renderTile({title:e,className:t="",content:n}){const s=[];return e&&s.push({tag:"h5",class:"mpf-tile-title",text:e}),s.push({tag:"div",class:"mpf-tile-content",html:n}),{tag:"div",class:"mpf-tile"+(t?" "+t:""),html:s}},_renderTrashIcon(){return{tag:"span",class:"fonticon fonticon-trash",events:{click:this.dispatchEvent.bind(this,u.DELETE,this.cartPhase)}}},_renderArrow(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"viewBox","0 0 100 100");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttributeNS(null,"d","M 0 0 H 40 L 80 50 L 40 100 H 0 L 40 50 Z"),t.setAttributeNS(null,"fill","#d1d4d4"),e.appendChild(t),e},_getNameInput(){return this.nameInput||(this.nameInput=new a({className:"mpf-name mpf-entry-v2",model:this.cartPhase,fieldName:s.Fields.NAME,fieldLabel:p.get("name"),dynamicValidation:!0,readOnly:!this.cartPhase.isEditable()})),this.nameInput},_createDescriptionInput(){return new a({className:"mpf-description mpf-entry-v2",model:this.cartPhase,fieldName:s.Fields.DESCRIPTION,fieldLabel:p.get("description"),silent:!1,dynamicValidation:!0,readOnly:!this.cartPhase.isEditable()})},_createDeliverableInput(){const e=new o({cart:this.cart,cartPhase:this.cartPhase,offers:this.offers});return this.listenTo(e,o.Events.ON_TYPE_CHANGE,this._deliverableTypeChange.bind(this)),this.listenTo(e,o.Events.BUSINESS_EXPERIENCE_ID_UPDATE,this._businessExperienceIdUpdate.bind(this)),e},_deliverableTypeChange(e){e===o.States.BUSINESS_EXPERIENCE?this.state=m.BUSINESS_EXPERIENCE_PHASE:this.state=m.SERVICE_PHASE,this.render()},async _getBuyerCountry(){const e=this.companyFactory.createModel(d.Types.COMPANY,{id:this.cart.getCompanyID()});return await e.fetchPromise(),e.getCountry()},async _businessExperienceIdUpdate(e){this.portfolioPackCollection||(this.portfolioPackCollection=this.portfolioFactory.createPackCollection(h.Types.BY_TRIGRAM_V2)),this.portfolioPackCollection.productTrigram=e;try{this.deliverableInput.cleanError();const t=await this._getBuyerCountry();if(await this.portfolioPackCollection.fetchPromise({country:t}),0===this.portfolioPackCollection.size())throw new Error(`Business experience ${e} not found.`);this.pricingBETile.update(this.portfolioPackCollection)}catch(t){this.deliverableInput.showError(p.get("errorBusinessExperienceIdNotFound",{id:e})),this.pricingBETile.reset()}},_createStartDateInput(e){return new i({model:this.cartPhase,fieldName:s.Fields.START_DATE,fieldLabel:p.get("startDate"),readOnly:!this.cartPhase.isEditable(),min:e.startDateMin,max:e.startDateMax,renderDatePickerInside:!0,additionalClassName:"mpf-start-date"})},_createEndDateInput(e){return new i({model:this.cartPhase,fieldName:s.Fields.END_DATE,fieldLabel:p.get("deliveryDate"),readOnly:!this.cartPhase.isEditable(),min:e.endDateMin,max:e.endDateMax,renderDatePickerInside:!0,additionalClassName:"mpf-end-date"})},_getPricingBETile(){return this.pricingBETile||(this.pricingBETile=new l({cart:this.cart,cartPhase:this.cartPhase,innovateOfferId:this._getInnovateItemOfferId()})),this.pricingBETile},_getPricingServiceTile(){return this.pricingServiceTile||(this.pricingServiceTile=new c({cart:this.cart,cartPhase:this.cartPhase})),this.pricingServiceTile},_getInnovateItemOfferId(){if(!this.innovateItemOfferId){const e=(this.cart.getItems()||[]).find((e=>e.getInnovateOfferId()));this.innovateItemOfferId=e&&e.getInnovateOfferId()}return this.innovateItemOfferId}});return C.Events=u,C})),define("DS/MPFInnovateComponent/InnovateCountrySelect",["UWA/Class/View","DS/UIKIT/Input/Select","DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryCollection","DS/MPFTracker/Category","DS/MPFInnovateComponent/InnovateTracker"],(function(e,t,n,s,r,a){"use strict";const i=Object.freeze({ON_COUNTRY_CHANGE:"onCountryChange"}),o=e.extend({className:"mpf-innovate-country-select",setup({stateMachine:e,tracker:t}={}){this.stateMachine=e,this.tracker=t},render({countries:e}){return n.requiredOfPrototype(e,s,"options.countries must be a CountryCollection"),e.sort(),this.selectedCountry=this.stateMachine.getCountry(),this.container.setContent([new t({placeholder:!1,options:this._getOptions({countries:e}),events:{onChange:e=>{e&&e.target&&e.target.value!==this.stateMachine.getCountry()&&(this.stateMachine.setCountry(e.target.value),this.tracker&&this.tracker.sendEvent({category:r.CART,action:a.Events.COUNTRY_CHANGED,cart:this.cart,label:e.target.value}),this.dispatchEvent(i.ON_COUNTRY_CHANGE,{country:e.target.value}))}}})]),this},destroy(){this.stateMachine=null,this.tracker=null,this._parent(),this.container=null},_getOptions({countries:e}){const t=this.stateMachine.getCountry();return e.map((e=>{const n=e.getIso3();return{value:n,label:e.getName(),selected:n===t}}))}});return o.Events=i,o})),define("DS/MPFInnovateComponent/platformSelection/NoAdminPanel",["DS/MPFTenantModel/TenantCollection","DS/MPFInnovateComponent/platformSelection/InfoPanel","DS/MPFServices/ObjectService","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n,s){"use strict";const r=Object.freeze({...t.Events}),a=t.extend({setup({tenants:t}){n.requiredOfPrototype(t,e,"options.tenants must be a TenantCollection"),this.tenants=t,this._parent(),this.container.addClassName("mpf-no-admin-panel")},render(){return this._parent({icon:"attention",title:s.get("adminRoleRequired"),body:[{tag:"p",text:s.get("youAreMemberOfFollowingPlatforms")},{tag:"ul",html:[this.tenants.map((e=>({tag:"li",text:e.get("id")})))]},{tag:"p",text:s.get("contactAdminForPurchase")}]}),this},destroy(){this.tenants=null,this._parent(),this.container=null}});return a.Events=r,a})),define("DS/MPFInnovateComponent/platformSelection/PurchasePlatformPanel",["UWA/Core","DS/UIKIT/Input/Button","DS/MPFInnovateComponent/platformSelection/InfoPanel","DS/MPFServices/ObjectService","i18n!DS/MPFInnovateComponent/assets/nls/PurchasePlatformModal"],(function(e,t,n,s,r){"use strict";const a=Object.freeze({...n.Events}),i=n.extend({setup({platformPurchaseUrl:e}){this.platformPurchaseUrl=e,this._parent(),this.container.addClassName("mpf-purchase-platform-panel")},render(){return this._parent({icon:"attention",title:r.get("no3dexperiencePlatformFound"),body:[r.get("noPlatformText",{bold3d:e.createElement("span",{class:"mpf-bold",text:"3D"}).outerHTML})],button:new t({className:"primary",value:r.get("clickHereToGetStarted"),events:{onClick:()=>{window.open(this.platformPurchaseUrl,"_blank")}}})}),this},destroy(){this._parent(),this.container=null}});return i.Events=a,i})),define("DS/MPFInnovateComponent/platformSelection/TenantSelectionPanel",["DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFTenantModel/TenantCollection","DS/MPFInnovateComponent/platformSelection/InfoPanel","i18n!DS/MPFInnovateComponent/assets/nls/TenantSelectionModal"],(function(e,t,n,s,r,a,i){"use strict";const o=Object.freeze({...a.Events,ON_SELECT_TENANT:"onSelectTenant",ON_TENANT_SELECTED:"onTenantSelected"}),c=a.extend({setup({tenants:e}={}){n.requiredOfPrototype(e,r,"options.tenants must be a TenantCollection"),this.tenants=e,this._parent(),this.container.addClassName("mpf-tenant-selection-panel"),this.selectInput=this._createSelectInput()},render(){return this._parent({title:i.get("3dexperiencePlatformSelection"),body:[{tag:"div",class:"mpf-info-message",text:i.get("pleaseSelectOneOfYourPlatforms")},this.selectInput],button:new e({className:"primary",value:i.get("confirm"),events:{onClick:this._confirmSelection.bind(this)}})}),this},destroy(){this.tenants=null,this._parent(),this.container=null},_confirmSelection(){const e=this.selectInput.getValue()[0];this.dispatchEvent(o.ON_TENANT_SELECTED,{tenantId:e})},_createSelectInput(){return new t({placeholder:i.get("selectPlatform"),options:this.tenants.map((e=>({value:e.get("id")}))),events:{onChange:this.dispatchEvent.bind(this,o.ON_SELECT_TENANT)}})}});return c.Events=o,c})),define("DS/MPFInnovateComponent/myCart/ProductLine",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFUtils/StorageUtils","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartItemModel","DS/MPFOfferModel/OfferModel","DS/MPFTracker/Value","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine","DS/MPFInnovateComponent/myCart/MyInnovateCartHelper","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent","i18n!DS/MPFInnovateComponent/assets/nls/SubscriptionInfo"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p,u,m,C,f){"use strict";const g=Object.freeze({DELETE_ITEM:"deleteItem",ON_QUANTITY_CHANGE:"onQuantityChange",SHOW_SUBSCRIPTION_INFO:"showSubscriptionInfo",SHOW_ROLE_INFO:"showRoleInfo"}),y=t.extend({className:"mpf-product-line",setup({cart:t,item:n,offer:s,service:r}={}){i.requiredOfPrototype(t,c,"options.cart must be a CartModel"),i.requiredOfPrototype(n,h,"options.item must be a CartItemModel"),i.requiredOfPrototype(s,d,"options.offer must be an OfferModel"),this.cart=t,this.item=n,this.offer=s,this.service=r,this.alert=new a({visible:!1}),this.priceCell=e.createElement("div",{class:"mpf-price-cell"})},render(){this._updateProductPrice();const e=this.offer.getPeriodicityFromSkuId(this.item.getSkuId());return this.container.setContent([this.alert,{tag:"div",class:"mpf-table-row",html:[{tag:"div",class:"mpf-product-infos",html:[{tag:"span",class:"mpf-product-name",text:this.offer.getTitle()},this.offer.isDsBeOffer()&&{tag:"div",class:"mpf-product-number",text:this.offer.getRole()}]},{tag:"div",class:"mpf-licensing-scheme",html:[{tag:"div",text:C.get(m.getAdjectiveFromLicensingScheme(e))},{tag:"div",text:`(${m.getFrontEndSchemeName(e)})`}]},new s({className:"mpf-quantity",value:this.item.getQuantity(),min:1,max:1e7,step:1,events:{onChange:e=>{let t=1;e.target&&e.target.value&&!Number.isNaN(e.target.value)?t=e.target.value:e.target.value=1,this._onQuantityChange(t)}}}),{tag:"div",class:"mpf-unit-price",text:parseFloat(this.offer.getPrice(e)).toLocaleString(this.locale,{style:"currency",currency:this.offer.getCurrency(),currencyDisplay:"code"})+" / "+C.get(m.getNounFromLicensingScheme(e))},this.priceCell]},{tag:"div",class:"mpf-table-row",html:[{tag:"div",class:"mpf-subscription-info-link",html:[{tag:"span",class:"fonticon fonticon-help"},{tag:"span",class:"mpf-subscription-info-link-text",text:f.get("subscriptionInformation")}],events:{click:this.dispatchEvent.bind(this,g.SHOW_SUBSCRIPTION_INFO,{offer:this.offer})}},{tag:"div",class:"mpf-delete-button-container",html:new n({className:"error",icon:"trash",events:{onClick:this.dispatchEvent.bind(this,g.DELETE_ITEM)}})}]}]),this},destroy(){this.cart=null,this.item=null,this.offer=null,this._parent(),this.container=null},async _onQuantityChange(e){if(e!==parseInt(this.item.getQuantity())){const t={key:p.QUANTITY,value:e},n=e-this.item.getQuantity()>0?"added":"removed";if(this.item.isNew())this.item.setQuantity(e),o.storeCart(this.service,this.cart),this._updateProductPrice(),this.dispatchEvent(g.ON_QUANTITY_CHANGE,{eventLabel:n,personalValue:t});else{r.mask(this.container);const s=new l;s.addOperation(l.Operations.MODIFY,"/cart-items/"+this.item.get("id"),{[h.Fields.QUANTITY]:e});try{await this.cart.megaPatch(s),r.unmask(this.container);const e=this.cart.getItems().find((e=>e.get("id")===this.item.get("id")));this.item.set(e.omit()),o.storeCart(this.service,this.cart),this._updateProductPrice(),this.dispatchEvent(g.ON_QUANTITY_CHANGE,{eventLabel:n,personalValue:t})}catch(e){r.unmask(this.container),console.log(e),this.alert.add({className:"error",message:C.get("failedToUpdateCart")}).show()}}}},_updateProductPrice(){const e=this.offer.getPeriodicityFromSkuId(this.item.getSkuId());this.priceCell.setText((parseFloat(this.offer.getPrice(e))*this.item.getQuantity()).toLocaleString(this.locale,{style:"currency",currency:this.offer.getCurrency(),currencyDisplay:"code"})+" / "+C.get(m.getNounFromLicensingScheme(e)))}});return y.Events=g,y})),define("DS/MPFInnovateComponent/quoteRequest/CompanySelectionComponent",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFCompanyModel/CompanyCollection","DS/MPFCountryModel/CountryCollection","DS/MPFCompanyModel/CompanyFactory","DS/MPFInnovateComponent/quoteRequest/NewCompanyCard","DS/MPFAddressFormComponent/AddressCard","css!DS/MPFInnovateComponent/MPFInnovateComponent"],(function(e,t,n,s,r,a,i,o,c){"use strict";const l=Object.freeze({ON_SELECTED:"onSelected",ON_CHANGE:"onChange",IS_LOADED:"isLoaded"}),h=e.extend({className:"mpf-company-selection-component",setup(e){n.requiredOfPrototype(e.companyFactory,i,"options.companyFactory must be a CompanyFactory"),n.requiredOfPrototype(e.newCompany,s,"options.newCompany must be a CompanyModel"),n.requiredOfPrototype(e.countries,a,"options.countries must be a CountryCollection"),e.companies?(n.requiredOfPrototype(e.companies,r,"options.companies must be a CompanyCollection"),this.companies=e.companies):this.companies=[],this.companyFactory=e.companyFactory,this.newCompany=e.newCompany,this.countries=e.countries,this.availableCountries=e.availableCountries,this.newCompanyCard=this._createNewCompanyCard(),this.companiesList=this._createCompaniesList(),this.dispatchEvent(l.IS_LOADED)},render(){return this.container.setContent([t.createElement("div",{class:"mpf-companies-list",html:this.companiesList}),this.newCompanyCard.render()]),this},isValid(){return!(this.selectedCompany===this.newCompanyCard&&!this.selectedCompany.isValid())},async getCompanyId(){if(this.isValid()){if(this.selectedCompany===this.newCompanyCard)return await this.newCompanyCard.save(),this.newCompany.getId();{const e=this.selectedCompany.getLegalEntity();if(e.getId())return e.getId();{const t=this.companyFactory.createModel(i.Types.ME,{[s.Fields.NAME]:e.getName(),[s.Fields.SITE_ID]:e.getSiteId()});return await t.savePromise(),t.getId()}}}},destroy(){this.stopListening(),this.newCompanyCard&&this.newCompanyCard.destroy(),this.newCompanyCard=null,this._destroyCompaniesList(),this.selectedCompany=null,this._parent(),this.container=null},_destroyCompaniesList(){this.companiesList&&this.companiesList.forEach((e=>{e.destroy(),e=null})),this.companiesList=null},_createNewCompanyCard(){const e=new o({newCompany:this.newCompany,countries:this.countries,availableCountries:this.availableCountries,noToggle:0===this.companies.length});return this.companies.length>0?this.listenTo(e,o.Events.ON_SELECTED,this._cardSelection.bind(this)):this.listenTo(e,o.Events.ON_CHANGE,this._cardSelection.bind(this,{addressCard:e})),e},_createCompaniesList(){if(this.companies.length>0){const e=this.companies.map((e=>{const t=e.getAddress(),n=this.countries.getCountryWithIso3(t.getCountry()),s=n&&n.getName(),r=new c({address:t,legalEntity:e,country:s||n});return this.listenTo(r,c.Events.ON_SELECTED,this._cardSelection.bind(this)),r.render()}));return this.selectedCompany=e[0],this.selectedCompany.select(),e}return this.selectedCompany=this.newCompanyCard,""},_cardSelection({addressCard:e}){this.selectedCompany!==e&&(this.selectedCompany===this.newCompanyCard&&this.newCompanyCard.resetValues(),this.selectedCompany.unselect(),e.select(),this.selectedCompany=e),this.dispatchEvent(l.ON_CHANGE,{isValid:this.isValid()})}});return h.Events=l,h})),define("DS/MPFInnovateComponent/quoteRequest/CompanySelectionFactory",["DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCompanyModel/CompanyFactory","DS/MPFCountryModel/CountryFactory","DS/MPFInnovateComponent/quoteRequest/CompanySelectionComponent"],(function(e,t,n,s,r,a){"use strict";class i{static async createComponent({service:s=t.INNOVATE}={}){const r=await e.fetchPromise({service:s}),i=n.getInstance(r),[o,c]=await i.getFactories([n.Types.COMPANY,n.Types.COUNTRY]),[l,h,{countries:d,availableCountries:p}]=await Promise.all([this._fetchNewCompany({companyFactory:o}),this._fetchCompanies({companyFactory:o}),this._fetchCountries({countryFactory:c})]);return new a({companyFactory:o,newCompany:l,companies:h,countries:d,availableCountries:p})}static async _fetchNewCompany({companyFactory:e}){return await e.createModel(s.Types.ME)}static async _fetchCompanies({companyFactory:e}){return await e.createCollection(s.Types.ELIGIBLE_COMPANIES).fetchPromise()}static async _fetchCountries({countryFactory:e}){const t=await e.createCollection(r.Types.BUYER).fetchPromise();let n=await e.createCollection(r.Types.SP_PUBLIC_OPENED_COUNTRIES).fetchPromise();return n=n.map((e=>t.getCountryWithIso2(e.getIso2()).getIso3())),{countries:t,availableCountries:n}}}return i.Events=a.Events,i})),define("DS/MPFInnovateComponent/myCart/MyCartDataLoader",["DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryModel","DS/MPFCartModel/CartFactory","DS/MPFOfferModel/OfferFactory","DS/MPFCountryModel/CountryFactory","DS/MPFUtils/StorageUtils","DS/MPFError/ValidationError","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine"],(function(e,t,n,s,r,a,i,o,c){"use strict";return class{constructor({stateMachine:t,service:r,companies:a,allCountries:i,openedCountries:o,countryFactory:l,cartFactory:h,offerFactory:d}){e.requiredOfPrototype(t,c,"options.stateMachine must be a BuyBusinessExperienceStateMachine"),e.requiredOfPrototype(h,n,"options.cartFactory must be a CartFactory"),e.requiredOfPrototype(d,s,"options.offerFactory must be a OfferFactory"),this.stateMachine=t,this.service=r,this.companies=a,this.allCountries=i,this.openedCountries=o,this.countryFactory=l,this.cartFactory=h,this.offerFactory=d}async loadData(){const e=this.cartFactory.createModel(n.Types.ME,{});a.loadStoredCart(this.service,e);const c=e.getItems().map((e=>e.getInnovateOfferId())),l=c.filter(((e,t)=>c.indexOf(e)===t)),h=this.stateMachine.getCountry(),d=await Promise.all(l.map((e=>this.offerFactory.createModel(s.Types.PUBLIC_OFFER_V2,{id:e}).fetchPromise({country:h})))),p=this.companies.map((e=>e.getAddress().getCountry())),u=this.countryFactory.createCollection(r.Types.BUYER,[],{comparator:t.Fields.NAME});if(1===p.length){const e=p[0];for(let t=0;t<d.length;t++){if(!d[t].getCountries().includes(e)||!this.openedCountries.getCountryWithIso3(e))throw new i("Offer is not available in company's country",{errorCode:o.Errors.UNAVAILABLE_IN_COUNTRY})}u.push(this.allCountries.getCountryWithIso3(e))}else{const e=d[0],t=e&&[...e.getCountries().filter((e=>!!this.openedCountries.getCountryWithIso3(e)&&(0===p.length||p.includes(e))))];for(let e=1;e<d.length;e++){const n=d[e].getCountries();for(let e=n.length-1;e>0;--e){const s=n[e];t.includes(s)&&this.openedCountries.getCountryWithIso3(s)||t.splice(t.indexOf(s),1)}}t&&t.forEach((e=>u.push(this.allCountries.getCountryWithIso3(e))))}const m=this.offerFactory.createCollection(s.Types.PUBLIC_OFFER_V2,d);return a.storeOffers(this.service,m),{cart:e,offers:m,countries:u}}destroy(){this.cartFactory=null,this.offerFactory=null}}})),define("DS/MPFInnovateComponent/myCart/TotalPriceTile",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFOfferModel/OfferCollection","DS/MPFInnovateComponent/myCart/MyInnovateCartHelper","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n,s,r,a){"use strict";const i=Object.freeze({}),o=e.extend({className:"mpf-total-price-tile",setup({locale:e}){this.locale=e},render({cart:e,offers:i}={}){t.requiredOfPrototype(e,n,"options.cart must be a CartModel"),t.requiredOfPrototype(i,s,"options.offers must be an OfferCollection");const o=this._getFirstItemsScheme({cart:e,offers:i});return this.container.setContent([{tag:"div",text:a.get("totalSubscription")},{tag:"div",class:"mpf-total-price-container",html:[{tag:"div",class:"mpf-price",text:this._calcTotalPrice({cart:e,offers:i}).toLocaleString(this.locale,{style:"currency",currency:this._getCartCurrency({cart:e,offers:i}),currencyDisplay:"code"})+" / "+r.getNounFromLicensingScheme(o||"YSC")},{tag:"div",class:"mpf-tax-label",text:a.get("exclTaxes")}]}]),this},destroy(){this._parent(),this.container=null},_getFirstItemsScheme({offers:e,cart:t}){const n=t.getItems();if(n.length>0){const t=n[0];return e.get(t.getInnovateOfferId()).getPeriodicityFromSkuId(t.getSkuId())}},_calcTotalPrice:({cart:e,offers:t})=>e.getItems().reduce(((e,n)=>{const s=t.get(n.getInnovateOfferId()),r=s.getPeriodicityFromSkuId(n.getSkuId());return e+s.getPrice(r)*n.getQuantity()}),0),_getCartCurrency({cart:e,offers:t}){const n=e.getItems()[0];if(n){const e=n&&n.getInnovateOfferId(),s=e&&t.get(e);return s&&s.getCurrency()}return e.getCurrency()||"USD"}});return o.Events=i,o})),define("DS/MPFInnovateComponent/checkout/EndPurchasingPage",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFUrl/UrlUtils","DS/MPFUtils/StorageUtils","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFClickAndBuyComponent/checkout/ThankYouForPurchasePanel","DS/MPFInnovateComponent/BuyBusinessExperienceHeader","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine","i18n!DS/MPFInnovateComponent/assets/nls/EndPurchasingPage","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],((e,t,n,s,r,a,i,o,c,l,h,d)=>{"use strict";const p=Object.freeze({PAYMENT_COMPLETED:"paymentCompleted"}),u=Object.freeze({SUCCESS:"success",FAILURE:"failure",CANCELLED:"cancelled"}),m=e.extend({className:"mpf-end-purchasing-page",setup({stateMachine:e,cartFactory:n,service:s,me:a}){t.requiredOfPrototype(e,l,"options.stateMachine must be a BuyBusinessExperienceStateMachine"),t.requiredOfPrototype(n,i,"options.cartFactory must be a cartFactory"),t.requiredOfType(s,"string","options.service must be a string (see DS/MPFServices/MarketplaceServices)"),t.requiredOfPrototype(a,r,"options.me must be a PersonModel"),this.stateMachine=e,this.cartFactory=n,this.service=s,this.me=a,this.header=new c},async load(){this.cart=this.cartFactory.createModel(i.Types.ME,{}),s.loadStoredCart(this.service,this.cart),await this.cart.fetchPromise({expand:[a.Expands.CART_ITEMS]}),this.panel=new o({cart:this.cart,service:this.service,stateMachine:this.stateMachine,me:this.me})},render(){this.isPaymentOK=this._getOrderStatus()===u.SUCCESS;const e=[this.header.render({title:this.isPaymentOK?h.get("orderConfirmed"):h.get("orderFailed"),displayNavBar:!1}),this.panel.render({I18n:d})];return this.container.setContent(e),this},destroy(){this.stopListening(),this._parent(),this.container=null},_getOrderStatus(){let e;const t=[a.States.PAYMENT_COMPLETE,a.States.PAYMENT_ACCEPTED,a.States.DELIVERED].includes(this.cart.getState()),s=this.cart.get(a.Fields.PAYMENT_STATUS)===a.States.PAYMENT_ACCEPTED,r=new n(window.location.href).getValueParameter("orderStatus");return e=r===u.SUCCESS||t||s?u.SUCCESS:r===u.CANCELLED?u.CANCELLED:u.FAILURE,e}});return m.Events=p,m})),define("DS/MPFInnovateComponent/offers/OfferCard",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/MPFInnovateComponent/InnovateTracker","DS/MPFTracker/Category","DS/MPFTracker/Value","DS/MPFClickAndBuyComponent/orderList/SecureTransaction","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","i18n!DS/MPFInnovateComponent/assets/nls/OfferPage"],(function(e,t,n,s,r,a,i,o,c,l,h){"use strict";const d=Object.freeze({ON_SELECT:"onSelect",ON_ADD_TO_CART:"onAddToCart"}),p=i.OFFER,u=new Map;u.set("YSC","yearly"),u.set("QSC","quarterly"),u.set("QRC","quarterly"),u.set("MSC","monthly");const m=n.extend({className:"mpf-offer-card",domEvents:{click:"_onClick"},setup({offer:e,periodicity:t,locale:n,isDisabled:s,tracker:r}={}){this.offer=e,this.periodicity=t,this.locale=n,this.isDisabled=s,this.tracker=r,this.quantity=1,this.secureTransactionTile=this._createSecureTransaction(),this.totalPriceContainer=this._createTotalPriceContainer(),this.isDisabled&&this.container.addClassName("mpf-disabled")},render({selectedPeriodicity:e}){this._setTotalPrice(),this.isSelected=e===this.periodicity;const t=[{tag:"div",class:"mpf-offer-price",text:this.offer.getPrice(this.periodicity).toLocaleString(this.locale,{style:"currency",currency:this.offer.getShopCurrency(),currencyDisplay:"code"})}];return this.isSelected?(t.push({tag:"div",class:"mpf-selected-card-content",html:[{tag:"div",class:"mpf-quantity-label",text:h.get("quantity")},this._createQuantityInput(),this.totalPriceContainer,{tag:"div",class:"mpf-tax-info",text:h.get("excludingTaxesPaid+periodicity",{periodicity:h.get(u.get(this.periodicity))})},this._renderAddToCartButton(),this.secureTransactionTile.render({I18n:l})]}),this.container.addClassName("mpf-selected")):this.container.removeClassName("mpf-selected"),this.container.setContent([this._createHeader(),{tag:"div",class:"mpf-offer-card-body",html:t}]),this},destroy(){this.secureTransactionTile.destroy(),this.secureTransactionTile=null,this.totalPriceContainer=null,this.offer=null,this.cartItem=null,this.tracker=null,this._parent(),this.container=null},_onClick(){this.isDisabled||this.isSelected||(this.dispatchEvent(d.ON_SELECT),this.tracker&&this.tracker.sendEvent({category:p,action:a.Events[this.periodicity],offer:this.offer}))},_setTotalPrice(){const e=this.offer.getPrice(this.periodicity)*this.quantity;this.totalPriceContainer.setText(h.get("totalPrice",{price:e.toLocaleString(this.locale,{style:"currency",currency:this.offer.getShopCurrency(),currencyDisplay:"code"})}))},_createSecureTransaction(){const e=new c({moreInformationLink:"https://www.3ds.com/online-store/faq"});return this.listenTo(e,c.Events.SECURE_TRANSACTION_CLICKED,(()=>{this.tracker&&this.tracker.sendEvent({category:p,action:a.Events.REASSURE_PAYMENT,offer:this.offer})})),this.listenTo(e,c.Events.MORE_INFO_CLICKED,(()=>{this.tracker&&this.tracker.sendEvent({category:p,action:a.Events.PAYMENT_MORE_INFO,offer:this.offer})})),e},_createTotalPriceContainer:()=>e.createElement("div",{class:"mpf-total-price"}),_createHeader(){return{tag:"div",class:"mpf-card-header",html:[{tag:"div",class:"mpf-header-icon",html:[{tag:"span",class:"fonticon fonticon-"+(this.isSelected?"status-ok":"radiobutton-on")}]},{tag:"div",class:"mpf-header-text",html:h.get("periodicity+Subscription",{periodicity:e.createElement("span",{text:t.ucfirst(h.get(u.get(this.periodicity))),class:"mpf-bold"}).outerHTML})}]}},_createQuantityInput(){return new s({min:1,step:1,max:1e7,value:this.quantity,events:{onChange:e=>{const t=this.quantity;let n=parseInt(e.target.value),s={key:o.QUANTITY,value:1};Number.isNaN(n)?(e.target.value=1,n=1):s.value=n,this.quantity=n,this._setTotalPrice();const r=n-t>0?"added":"removed";this.tracker&&this.tracker.sendEvent({category:p,action:a.Events.QUANTITY_CHANGED,offer:this.offer,label:r,personalValue:s})}}})},_renderAddToCartButton(){return new r({className:"primary",value:h.get("addToCart"),events:{onClick:()=>{this.dispatchEvent(d.ON_ADD_TO_CART,{quantity:this.quantity});const e={key:o.QUANTITY,value:this.quantity};this.tracker&&this.tracker.sendEvent({category:p,action:a.Events.ADD_TO_CART,offer:this.offer,personalValue:e})}}})}});return m.Events=d,m})),define("DS/MPFInnovateComponent/BuyBusinessExperienceDataLoader",["DS/MPFServices/MarketplaceServices","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFCountryModel/CountryFactory","DS/MPFPspModel/PspFactory","DS/MPFUtils/StorageUtils","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine"],(function(e,t,n,s,r,a,i,o,c){"use strict";return class{constructor({service:e}){this.service=e,this._isLoaded=!1}isLoaded(){return this._isLoaded}async loadData({initialPage:s}){const r=await t.fetchPromise({service:this.service}),l=n.getInstance(r),[h,d,p,u,m,C,f,g]=await Promise.all([l.getFactory(n.Types.CART),l.getFactory(n.Types.CART_ITEM),l.getFactory(n.Types.OFFER),l.getFactory(n.Types.PERSON),l.getFactory(n.Types.COMPANY,{loadConstraints:!1}),l.getFactory(n.Types.TENANT),l.getFactory(n.Types.COUNTRY),l.getFactory(n.Types.PSP)]),y=g.createModel(i.Types.PARAM_PSP),[S,P,E,M]=await Promise.all([this._fetchMeWithoutError(u),this._fetchCompaniesWithoutError(m),f.createCollection(a.Types.BUYER).fetchPromise(),f.createCollection(a.Types.SP_PUBLIC_OPENED_COUNTRIES).fetchPromise()]);if(1===P.size()){const t=P.at(0).getAddress().getCountry();t&&o.storeCountry(e.INNOVATE,t)}M.forEach((e=>{e.set(E.getCountryWithIso2(e.getIso2()).omit())}));const v=new c({page:s,cookieKey:"swymlang",doChangeUrls:!1,service:e.INNOVATE,me:S,countries:E});return this._isLoaded=!0,{me:S,companies:P,stateMachine:v,allCountries:E,countryFactory:f,cartFactory:h,cartItemFactory:d,offerFactory:p,tenantFactory:C,openedCountries:M,psp:y}}_fetchMeWithoutError(e){const t=e.createModel(s.Types.ME);return new Promise(((e,n)=>{t.fetch({onComplete:async()=>{e(t)},onFailure:n,onPassportError:n=>{console.error(n),e(t)}})}))}_fetchCompaniesWithoutError(e){const t=e.createCollection(r.Types.ELIGIBLE_COMPANIES);return new Promise(((e,n)=>{t.fetch({onComplete:async()=>{e(t)},onFailure:n,onPassportError:n=>{console.error(n),e(t)}})}))}}})),define("DS/MPFInnovateComponent/myCart/ProductList",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFUtils/StorageUtils","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartPatchArray","DS/MPFOfferModel/OfferCollection","DS/MPFTracker/Category","DS/MPFInnovateComponent/InnovateTracker","DS/MPFInnovateComponent/myCart/ProductLine","DS/MPFInnovateComponent/myCart/TotalPriceTile","DS/MPFClickAndBuyComponent/orderList/GettingStarted","DS/MPFView/ConfirmationModal","DS/MPFInnovateComponent/myCart/InnovateSubscriptionInfoModal","DS/MPFInnovateComponent/myCart/ProductInfoModal","DS/MPFClickAndBuyComponent/orderList/SecureTransaction","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","i18n!DS/MPFClickAndBuyComponent/assets/nls/SubscriptionInformation","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p,u,m,C,f,g,y,S,P){"use strict";const E=Object.freeze({OPEN_CHECKOUT:"openCheckout",ITEM_DELETED:"itemDeleted",EMPTY_CART:"emptyCart"}),M=c.CART,v=t.extend({className:"mpf-product-list",setup({service:e,locale:t,tracker:n}={}){this.service=e,this.locale=t||"fr-FR",this.tracker=n,this.totalPriceTile=new d({locale:t}),this.confirmationModal=this._createConfirmationModal(),this.gettingStartedTile=new p,this.subscriptionInfoModal=new m,this.productInfoModal=new C},render({cart:e,offers:t}){s.requiredOfPrototype(e,a,"options.cart must be a CartModel"),s.requiredOfPrototype(t,o,"options.offers must be an OfferCollection"),this._destroyLines();const r=e.getItems();return this.productLines=r.map((n=>this._createProductLine({cart:e,item:n,offers:t}))),this.secureTransactionTile&&this.secureTransactionTile.destroy(),this.secureTransactionTile=this._createSecureTransactionTile(e,t),this.container.setContent([this.confirmationModal.render(),this.subscriptionInfoModal.render(),this.productInfoModal.render(),{tag:"div",class:"mpf-product-table",html:[this._renderTableHead(),this.productLines.map((e=>e.render()))]},{tag:"div",class:"mpf-footer",html:[this.gettingStartedTile.render({isRenewal:e.isRenewal(),I18n:S}),{tag:"div",class:"mpf-total-and-payment",html:[this.totalPriceTile.render({cart:e,offers:t}),{tag:"div",class:"mpf-button-container",html:[this.secureTransactionTile.render({I18n:y}),new n({disabled:r.length<1,className:"primary",value:P.get("goToPayment"),events:{onClick:()=>{this.tracker&&this.tracker.sendEvent({category:M,action:l.Events.GO_TO_PAYMENT,cart:e,offers:t}),this.dispatchEvent(E.OPEN_CHECKOUT)}}})]}]}]}]),this},destroy(){this.stopListening(),this._destroyLines(),this.secureTransactionTile&&this.secureTransactionTile.destroy(),this.confirmationModal.destroy(),this.secureTransactionTile=null,this.confirmationModal=null,this.tracker=null,this.cart=null,this._parent(),this.container=null},async _deleteItem({cart:e,item:t}){if(e.isNew()){const n=e.getItems();n.splice(n.findIndex((e=>e===t)),1)}else{const n=new i;n.addOperation(i.Operations.REMOVE,"/cart-items/"+t.get("id")),await e.megaPatch(n)}},_destroyLines(){this.productLines&&this.productLines.forEach((e=>{this.stopListening(e),e.destroy()})),this.productLines=null},_renderTableHead:()=>({tag:"div",class:"mpf-table-row mpf-table-head",html:[{tag:"span",text:P.get("products")},{tag:"span",text:P.get("pricingStructure")},{tag:"span",text:P.get("quantity")},{tag:"span",text:P.get("unitPriceTaxExcluded")},{tag:"span",text:P.get("priceTaxExcluded")}]}),_showConfirmationModal({cart:e,item:t,offers:n}){this.stopListening(this.confirmationModal),this.listenTo(this.confirmationModal,u.Events.CONFIRM,(async()=>{this.confirmationModal.setLoading(!0);try{await this._deleteItem({cart:e,item:t}),r.storeCart(this.service,e),this.confirmationModal.setLoading(!1),this.confirmationModal.hide(),this.tracker&&this.tracker.sendEvent({category:M,action:l.Events.ITEM_REMOVED,cart:e,offers:n}),this.render({cart:e,offers:n});const s=e.getItems().length;this.dispatchEvent(s>0?E.ITEM_DELETED:E.EMPTY_CART,t)}catch(e){this.confirmationModal.setLoading(!1),console.error(e),this.confirmationModal.showAlert({className:"error",message:P.get("failedToDeleteItem")})}}));const s=n.get(t.getInnovateOfferId()).getTitle();this.confirmationModal.setBody(P.get("itemDeletionConfirmationText",{itemName:s})),this.confirmationModal.show()},_createProductLine({cart:e,item:t,offers:n}){const s=new h({cart:e,item:t,offer:n.get(t.getInnovateOfferId()),service:this.service});return this.listenTo(s,h.Events.DELETE_ITEM,this._showConfirmationModal.bind(this,{cart:e,item:t,offers:n})),this.listenTo(s,h.Events.ON_QUANTITY_CHANGE,(({eventLabel:t,personalValue:s})=>{this.tracker&&this.tracker.sendEvent({category:M,action:l.Events.QUANTITY_CHANGED,cart:e,offers:n,label:t,personalValue:s}),this.totalPriceTile.render({cart:e,offers:n})})),this.listenTo(s,h.Events.SHOW_SUBSCRIPTION_INFO,(({offer:t})=>{this.tracker&&this.tracker.sendEvent({category:M,action:l.Events.SHOW_SUBSCRIPTION_INFO,cart:e,offers:n}),this._showSubscriptionInfos({offer:t})})),this.listenTo(s,h.Events.SHOW_ROLE_INFO,this._showRoleInfoModal.bind(this)),s},_showSubscriptionInfos({offer:e}){this.subscriptionInfoModal.show({offer:e})},_showRoleInfoModal({offer:e}){this.productInfoModal.show({offer:e})},_createConfirmationModal:()=>new u({header:P.get("confirmCartItemDeletion")}),_createSecureTransactionTile(e,t){const n=new f({moreInformationLink:"https://www.3ds.com/online-store/faq"});return this.listenTo(n,f.Events.SECURE_TRANSACTION_CLICKED,(()=>{this.tracker&&this.tracker.sendEvent({category:M,action:l.Events.REASSURE_PAYMENT,cart:e,offers:t})})),this.listenTo(n,f.Events.MORE_INFO_CLICKED,(()=>{this.tracker&&this.tracker.sendEvent({category:M,action:l.Events.PAYMENT_MORE_INFO,cart:e,offers:t})})),n}});return v.Events=E,v})),define("DS/MPFInnovateComponent/offers/OfferPage",["UWA/Class/View","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemFactory","DS/MPFUtils/StorageUtils","DS/MPFTracker/Category","DS/MPFInnovateComponent/InnovateTracker","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine","DS/MPFInnovateComponent/offers/OfferPageDataLoader","DS/MPFInnovateComponent/BuyBusinessExperienceHeader","DS/MPFInnovateComponent/InnovateCountrySelect","DS/MPFInnovateComponent/offers/OfferCard","DS/MPFInnovateComponent/offers/SubscriptionInfoComponent","i18n!DS/MPFInnovateComponent/assets/nls/OfferPage"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p,u,m,C,f){"use strict";const g=Object.freeze({BACK:"back"}),y=[a.RevTypes.MSC,a.RevTypes.QSC,a.RevTypes.QRC,a.RevTypes.YSC],S=[a.RevTypes.YSC,a.RevTypes.QRC,a.RevTypes.QSC,a.RevTypes.MSC],P=e.extend({className:"mpf-offer-page",setup({companies:e,stateMachine:t,service:r,tracker:a,allCountries:i,openedCountries:o,countryFactory:c,cartFactory:l,cartItemFactory:h,offerFactory:p,platformPurchaseUrl:u}={}){n.requiredOfPrototype(i,s,"options.allCountries must be a CountryCollection"),this.stateMachine=t,this.service=r,this.platformPurchaseUrl=u,this.cartItemFactory=h,this.companies=e,this.tracker=a,this.dataLoader=new d({companies:e,allCountries:i,openedCountries:o,countryFactory:c,stateMachine:t,service:r,cartFactory:l,offerFactory:p}),this.header=this._createHeader(),this.subscriptionInfo=new C,1!==this.companies.size()&&(this.countrySelect=this._createCountrySelect({stateMachine:t,tracker:a}))},load(){return this.dataLoader.loadData().then((({cart:e,offer:t,countries:n})=>{this.cart=e,this.offer=t,this.countries=n,this.selectedPeriodicity=this._generateDefaultPeriodicity({cart:e,offer:t})}))},render(){const e=this.stateMachine.getLanguage(),t=this.cart.getItems(),n=t.length>0&&this.offer.getPeriodicityFromSkuId(t[0].getSkuId());this._destroyOfferCards();const s=this.offer.getPeriodicities().sort(((e,t)=>S.indexOf(e)-S.indexOf(t)));return this.offerCards=s.map((t=>this._createOfferCard({periodicity:t,locale:e,isDisabled:n&&n!==t}))),this.container.setContent([this.header.render({offer:this.offer}),{tag:"div",class:"mpf-main",html:[this.countrySelect&&this.countrySelect.render({countries:this.countries}),{tag:"div",class:"mpf-description",text:this.offer.getData().tagline||""},{tag:"div",class:"mpf-plan-selection-container",html:[{tag:"div",class:"mpf-plan-selection-title",text:f.get("selectYourSubscriptionPlan").toUpperCase()},{tag:"div",class:"mpf-offer-card-container",html:this.offerCards.map((e=>e.render({selectedPeriodicity:this.selectedPeriodicity})))}]}]},this.subscriptionInfo.render()]),this.tracker&&this.tracker.sendPage({url:window.location.pathname,title:l.Titles.OFFER,offer:this.offer}),this},destroy(){this.stopListening(),this._destroyOfferCards(),this.countrySelect&&this.countrySelect.destroy(),this.subscriptionInfo.destroy(),this.countrySelect=null,this.subscriptionInfo=null,this.stateMachine=null,this.dataLoader=null,this.cartItemFactory=null,this.countries=null,this.companies=null,this.cart=null,this.offer=null,this.countries=null,this.tracker=null,this._parent(),this.container=null},_generateDefaultPeriodicity({cart:e,offer:t}){const n=e.getItems().length>0&&e.getItems()[0];return n?t.getPeriodicityFromSkuId(n.getSkuId()):y.find((e=>t.getPeriodicities().includes(e)))},_destroyOfferCards(){this.offerCards&&this.offerCards.forEach((e=>{this.stopListening(e),e.destroy()})),this.offerCards=null},_createHeader(){const e=new p;return this.tracker&&this.tracker.sendEvent({category:c.OFFER,action:l.Events.BACK,offer:this.offer}),this.listenTo(e,p.Events.GO_BACK,this.dispatchEvent.bind(this,g.BACK)),e},_createOfferCard({periodicity:e,isDisabled:t,locale:n}){const s=new m({offer:this.offer,periodicity:e,isDisabled:t,locale:n,tracker:this.tracker});return this.listenTo(s,m.Events.ON_SELECT,(()=>{this.selectedPeriodicity=e,this.offerCards.forEach((e=>e.render({selectedPeriodicity:this.selectedPeriodicity})))})),this.listenTo(s,m.Events.ON_ADD_TO_CART,(({quantity:t})=>{const n=this.cart.getItems(),s=n.find((t=>t.get(a.Fields.SKU_ID)===this.offer.getSkuId(e)));if(s){const e=parseInt(s.getQuantity());s.setQuantity(e+t)}else n.push(this.cartItemFactory.createModel(i.Types.CART_CART_ITEM,{[a.Fields.INNOVATE_OFFER_ID]:this.offer.get("id"),[a.Fields.SKU_ID]:this.offer.getSkuId(e),[a.Fields.QUANTITY]:parseInt(t),[a.Fields.TYPE]:a.Types.INNOVATE_REQUEST}));this.cart.set({ShopID:this.offer.getShopId(),[r.Fields.CURRENCY]:this.offer.getShopCurrency()}),this.cart.setItems(n),o.storeCart(this.service,this.cart),this.stateMachine.changePage(h.Pages.CART)})),s},_createCountrySelect({stateMachine:e,tracker:n}){const s=new u({stateMachine:e,tracker:n});return this.listenTo(s,u.Events.ON_COUNTRY_CHANGE,(({country:e})=>{t.mask(this.container),this.load({offerId:this.offer.get("id")}).then((()=>{t.unmask(this.container),this.render()}))})),s}});return P.Events=g,P})),define("DS/MPFInnovateComponent/platformSelection/OnePlatformPanel",["DS/UIKIT/Input/Button","DS/MPFInnovateComponent/platformSelection/InfoPanel","DS/MPFServices/ObjectService","DS/MPFTenantModel/TenantCollection","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n,s,r){"use strict";const a=Object.freeze({...t.Events,ON_TENANT_CONFIRMED:"onTenantConfirmed"}),i=t.extend({setup({tenants:e}){n.requiredOfPrototype(e,s,"options.tenants must be a TenantCollection"),this.tenants=e,this._parent(),this.container.addClassName("mpf-no-admin-panel")},render(){return this._parent({icon:"check",title:r.get("platformConfirmation"),body:[{tag:"p",text:r.get("youAreAdminOfPlatform")},{tag:"p",text:this.tenants.at(0).get("id")},{tag:"p",text:r.get("clickTheButtonToConfirm")}],button:new e({className:"primary",value:r.get("confirm"),events:{onClick:this.dispatchEvent.bind(this,a.ON_TENANT_CONFIRMED,{tenantId:this.tenants.at(0).get("id")})}})}),this},destroy(){this.tenants=null,this._parent(),this.container=null}});return i.Events=a,i})),define("DS/MPFInnovateComponent/myCart/MyCartPage",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFUtils/StorageUtils","DS/MPFCartModel/CartModel","DS/MPFInnovateComponent/myCart/MyCartDataLoader","DS/MPFInnovateComponent/myCart/MyInnovateCartHelper","DS/MPFInnovateComponent/BuyBusinessExperienceHeader","DS/MPFInnovateComponent/myCart/ProductList","DS/MPFInnovateComponent/InnovateCountrySelect","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine","DS/MPFInnovateComponent/InnovateTracker","DS/MPFTracker/Category","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p,u,m){"use strict";const C=Object.freeze({EMPTY_CART:"emptyCart"}),f=e.extend({className:"mpf-my-cart-page",setup({stateMachine:e,service:t,tracker:n,companies:s,allCountries:r,openedCountries:a,countryFactory:o,cartFactory:c,offerFactory:l,psp:h}={}){this.stateMachine=e,this.service=t,this.companies=s,this.psp=h,this.tracker=n,this.header=this._createHeader(),this.productList=this._createProductList(),this.dataLoader=new i({stateMachine:e,service:t,companies:s,allCountries:r,openedCountries:a,countryFactory:o,cartFactory:c,offerFactory:l}),this.alert=this._createAlert(),1!==this.companies.size()&&(this.countrySelect=this._createCountrySelect({stateMachine:e,tracker:n}))},load(){return this.dataLoader.loadData().then((({cart:e,offers:t,countries:n})=>{this.cart=e,this.offers=t,n&&(this.countries=n)}))},render(){return this.container.setContent([this.header.render(),this.alert,this.countrySelect&&this.countrySelect.render({countries:this.countries}),this.productList.render({cart:this.cart,offers:this.offers})]),this.tracker&&this.tracker.sendPage({cart:this.cart,offers:this.offers,url:window.location.pathname,title:p.Titles.MY_CART}),this},destroy(){this.stopListening(),this.countrySelect&&this.countrySelect.destroy(),this.productList.destroy(),this.dataLoader.destroy(),this.countrySelect=null,this.productList=null,this.dataLoader=null,this.alert=null,this.stateMachine=null,this.dataLoader=null,this.tracker=null,this.psp=null,this.cart=null,this.offers=null,this.countries=null,this.companies=null,this._parent(),this.container=null},_showError(e){this.alert.add({className:"error",message:e}).show()},_createHeader(){const e=new c;return this.listenTo(e,c.Events.GO_BACK,(()=>{this.tracker&&this.tracker.sendEvent({category:u.CART,action:p.Events.BACK,cart:this.cart}),this.stateMachine.changePage(d.Pages.OFFER)})),e},_createAlert:()=>new n({visible:!1,autoHide:!0,hideDelay:5e3}),_createProductList(){const e=new l({cart:this.cart,offers:this.offers,locale:this.stateMachine.getLanguage(),service:this.service,tracker:this.tracker});return this.listenTo(e,l.Events.EMPTY_CART,(()=>{r.clearCart(this.service),this.stateMachine.clearUrl(),this.dispatchEvent(C.EMPTY_CART)})),this.listenTo(e,l.Events.OPEN_CHECKOUT,(async()=>{t.mask(this.container),await o.checkMaxChargeCompliance({cart:this.cart,psp:this.psp,offers:this.offers,country:this.stateMachine.getCountry(),service:this.service})?(t.unmask(this.container),this.stateMachine.changePage(d.Pages.PLATFORM_SELECTION)):(t.unmask(this.container),this._showError(m.get("priceExceedsMaximum")))})),e},_createCountrySelect({stateMachine:e,tracker:n}){const s=new h({stateMachine:e,tracker:n});return this.listenTo(s,h.Events.ON_COUNTRY_CHANGE,(({country:e})=>{t.mask(this.container),this.load().then((()=>{t.unmask(this.container),this.cart.setCurrency(this.offers.at(0).getShopCurrency()),this.cart.set(a.Fields.COUNTRY,e),r.storeCart(this.service,this.cart),this.render()}))})),s}});return f.Events=C,f})),define("DS/MPFInnovateComponent/platformSelection/PlatformSelectionDataLoader",["DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFOfferModel/OfferFactory","DS/MPFTenantModel/TenantFactory","DS/MPFUtils/StorageUtils","DS/MPFServices/MarketplaceServices","DS/MPFError/ValidationError","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFInnovateComponent/myCart/MyInnovateCartHelper"],(function(e,t,n,s,r,a,i,o,c){"use strict";const l=Object.freeze({NO_PLATFORM_ERROR:"noPlatformError",NO_ADMIN_ERROR:"noAdminError",TENANT_SELECTION:"tenantSelection",CHECKOUT:"checkout"});class h{constructor({me:e,companies:t,openedCountries:n,offerFactory:s,cartFactory:r,tenantFactory:i,service:o=a.INNOVATE}){this.me=e,this.companies=t,this.openedCountries=n,this.cartFactory=r,this.offerFactory=s,this.tenantFactory=i,this.service=o}async loadData(){let n,a;const i=this.cartFactory.createModel(t.Types.ME,{});r.loadStoredCart(this.service,i),this.me.isNew()&&await this.me.fetchPromise({onPassportError:c.redirectToLogin.bind(this)});const o=this.companies.map((e=>e.getAddress().getCountry())),h=o.filter(((e,t)=>o.indexOf(e)===t));if(h.length>0)if(await this._loadOffersAndCompareCountries({cart:i,companyCountries:h}),i.getOnlineInstance())n=l.CHECKOUT;else{i.isNew()&&await i.savePromise({[e.Fields.IS_SELF_ORDER]:!0},{onPassportError:c.redirectToLogin.bind(this)}),a=this.tenantFactory.createCollection(s.Types.TENANTS,[],{parentResourceId:i.get("id")}),await a.fetchPromise();const t=a.filter((e=>e.isAdmin()));a.size()<1?n=l.NO_PLATFORM_ERROR:t.length<1?n=l.NO_ADMIN_ERROR:1===t.length?(i.setOnlineInstance(t[0].getId()),await this.saveSelection({tenantId:t[0].getId(),cart:i}),n=l.CHECKOUT):n=l.TENANT_SELECTION}else n=l.NO_PLATFORM_ERROR;return{step:n,cart:i,tenants:a}}async _loadOffersAndCompareCountries({cart:e,companyCountries:t}){const s=e.getItems(),a=s.map((e=>e.getInnovateOfferId())),c=a.filter(((e,t)=>a.indexOf(e)===t)),l=this.offerFactory.createCollection(n.Types.PUBLIC_OFFER_V2);r.loadStoredOffers(this.service,l);const h=c.filter((e=>!l.get(e)));h.length>0&&(await Promise.all(h.map((async e=>{const t=this.offerFactory.createModel(n.Types.PUBLIC_OFFER_V2);t.set("id",e),await t.fetchPromise(),l.push(t)}))),r.storeOffers(this.service,l));for(let e=0;e<s.length;e++){const n=s[e];if(l.get(n.getInnovateOfferId()).getCountries().filter((e=>t.includes(e)&&!!this.openedCountries.getCountryWithIso3(e))).length<1)throw new i("Offer is not available in company's country",{errorCode:o.Errors.UNAVAILABLE_IN_COUNTRY})}}async saveSelection({cart:e,tenantId:t}){await c.saveCart({cart:e,service:this.service}),await c.patchTenantId({cart:e,tenantId:t,service:this.service})}}return h.Steps=l,h})),define("DS/MPFInnovateComponent/platformSelection/TenantSelectionComponent",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFTenantModel/TenantCollection","DS/MPFInnovateComponent/platformSelection/InfoPanel","DS/MPFInnovateComponent/platformSelection/OnePlatformPanel","DS/MPFInnovateComponent/platformSelection/TenantSelectionPanel","DS/MPFInnovateComponent/platformSelection/NoAdminPanel","DS/MPFInnovateComponent/platformSelection/PurchasePlatformPanel","i18n!DS/MPFInnovateComponent/assets/nls/TenantSelectionModal","css!DS/MPFInnovateComponent/MPFInnovateComponent"],(function(e,t,n,s,r,a,i,o,c,l,h,d){"use strict";const p=Object.freeze({ON_CLOSE:"onClose",ON_TENANT_SELECTED:"onTenantSelected",ON_ERROR:"onError"}),u=e.extend({className:"mpf-tenant-selection-component",setup({cart:e,tenants:t,platformPurchaseUrl:n}={}){s.requiredOfPrototype(e,r,"options.cart must be a CartModel"),s.requiredOfPrototype(t,a,"options.tenants must be a TenantCollection"),s.requiredOfType(n,"string","options.platformPurchaseUrl must be a string"),this.cart=e,this.tenants=t,this.platformPurchaseUrl=n,this.alert=this._createAlert()},render(){this.panel&&(this.stopListening(this.panel),this.panel.destroy());const e=this.tenants.filter((e=>e.isAdmin()));return 0===this.tenants.size()?this.panel=this._createPurchasePlatformPanel():0===e.length?this.panel=this._createNoAdminPanel():1===e.length?this.panel=this._createOnePlatformPanel():e.length>1&&(this.panel=this._createTenantSelectionPanel()),this.container.setContent([this.alert,this.panel.render()]),this},async saveTenant({tenantId:e}){t.mask(this.container);try{await this.cart.savePromise({[r.Fields.ONLINE_INSTANCE]:e},{patch:!0}),t.unmask(this.container),this.dispatchEvent(p.ON_TENANT_SELECTED)}catch(e){t.unmask(this.container),console.error(e),this.alert.add({className:"error",message:d.get("failedToSaveSelection")}).show(),this.dispatchEvent(p.ON_ERROR,e)}},destroy(){this.stopListening(),this.panel&&this.panel.destroy(),this.tenants=null,this._parent(),this.container=null},_createAlert:()=>new n({visible:!1,autoHide:!0,hideDelay:5e3}),_createTenantSelectionPanel(){const e=new c({tenants:this.tenants});return this.listenTo(e,c.Events.ON_CLOSE,this.dispatchEvent.bind(this,p.ON_CLOSE)),this.listenTo(e,c.Events.ON_TENANT_SELECTED,this.saveTenant.bind(this)),e},_createOnePlatformPanel(){const e=new o({tenants:this.tenants});return this.listenTo(e,o.Events.ON_CLOSE,this.dispatchEvent.bind(this,p.ON_CLOSE)),this.listenTo(e,o.Events.ON_TENANT_CONFIRMED,this.saveTenant.bind(this)),e},_createNoAdminPanel(){const e=new l({tenants:this.tenants});return this.listenTo(e,l.Events.ON_CLOSE,this.dispatchEvent.bind(this,p.ON_CLOSE)),e},_createPurchasePlatformPanel(){const e=new h({platformPurchaseUrl:this.platformPurchaseUrl});return this.listenTo(e,h.Events.ON_CLOSE,this.dispatchEvent.bind(this,p.ON_CLOSE)),e}});return u.Events=p,u})),define("DS/MPFInnovateComponent/checkout/TenantSelectionComponent",["DS/MPFInnovateComponent/platformSelection/TenantSelectionComponent"],(function(e){"use strict";return e})),define("DS/MPFInnovateComponent/platformSelection/PlatformSelectionPage",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFTracker/Category","DS/MPFInnovateComponent/InnovateTracker","DS/MPFInnovateComponent/platformSelection/PlatformSelectionDataLoader","DS/MPFInnovateComponent/platformSelection/PurchasePlatformPanel","DS/MPFInnovateComponent/platformSelection/NoAdminPanel","DS/MPFInnovateComponent/platformSelection/TenantSelectionPanel","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p,u){"use strict";const m=Object.freeze({}),C=c.Steps,f=i.CART,g=e.extend({className:"mpf-platform-selection-page",setup({stateMachine:e,platformPurchaseUrl:t,me:n,companies:i,openedCountries:o,offerFactory:l,cartFactory:h,tenantFactory:d,service:p=s.INNOVATE,tracker:u}={}){r.requiredOfPrototype(n,a,"options.me must be a PersonModel"),this.stateMachine=e,this.platformPurchaseUrl=t,this.dataLoader=new c({me:n,companies:i,openedCountries:o,offerFactory:l,cartFactory:h,tenantFactory:d,service:p}),this.tracker=u,this.alert=this._createAlert()},async load(){return this.dataLoader.loadData({}).then((({step:e,cart:t,tenants:n})=>{if(this.step=e,this.step===C.CHECKOUT)return this.stateMachine.changePage(p.Pages.CHECKOUT),{renderPage:!1};switch(this.panel&&(this.stopListening(this.panel),this.panel.destroy()),e){case C.NO_PLATFORM_ERROR:this.panel=this._createPurchasePlatformPanel();break;case C.NO_ADMIN_ERROR:this.panel=this._createNoAdminPanel({tenants:n});break;case C.TENANT_SELECTION:this.panel=this._createTenantSelectionPanel({cart:t,tenants:n})}this.tracker&&this.tracker.sendPage({cart:t,url:window.location.pathname,title:o.Titles.TENANT})}))},render(){return this.container.setContent([this.alert,this.panel.render()]),this},destroy(){this.tracker=null,this._parent(),this.container=null},_createAlert:()=>new n({visible:!1,autoHide:!0,hideDelay:6e3}),_createPurchasePlatformPanel(){const e=new l({platformPurchaseUrl:this.platformPurchaseUrl});return this.listenTo(e,l.Events.ON_CLOSE,(()=>{this.stateMachine.changePage(p.Pages.CART)})),e},_createNoAdminPanel({tenants:e}){const t=new h({tenants:e});return this.listenTo(t,h.Events.ON_CLOSE,(()=>{this.stateMachine.changePage(p.Pages.CART)})),t},_createTenantSelectionPanel({cart:e,tenants:n}){const s=new d({tenants:n});return this.listenTo(s,d.Events.ON_CLOSE,(()=>{this.stateMachine.changePage(p.Pages.CART)})),this.listenTo(s,d.Events.ON_SELECT_TENANT,(()=>{this.tracker&&this.tracker.sendEvent({category:f,action:o.Events.SELECT_TENANT,cart:e})})),this.listenTo(s,d.Events.ON_TENANT_SELECTED,(async({tenantId:n})=>{t.mask(this.container);try{await this.dataLoader.saveSelection({tenantId:n,cart:e}),this.tracker&&this.tracker.sendEvent({category:f,action:o.Events.TENANT_SELECTED,cart:e,label:n}),t.unmask(this.container),this.stateMachine.changePage(p.Pages.CHECKOUT)}catch(e){let n;t.unmask(this.container),console.error(e),n=e&&e.response&&"OfferUnavailableInCountry"===e.response.errorCode?u.get("offerUnavailableInBuyerCountry"):u.get("failedToUpdateCart"),this.alert.add({className:"error",message:n}).show()}})),s}});return g.Events=m,g})),define("DS/MPFInnovateComponent/checkout/InnovateCheckoutPage",["UWA/Class/View","DS/UIKIT/Spinner","DS/MPFUtils/StorageUtils","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartFactory","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine","DS/MPFInnovateComponent/InnovateTracker","DS/MPFCheckoutPage/CheckoutPageFactory","DS/MPFInnovateComponent/myCart/MyInnovateCartHelper","i18n!DS/MPFInnovateComponent/assets/nls/MyInnovateCartComponent"],(function(e,t,n,s,r,a,i,o,c,l){"use strict";const h=Object.freeze({PAYMENT_COMPLETED:"paymentCompleted",PAYMENT_DECLINED:"paymentDeclined",OFFER_UNAVAILABLE_ERROR:"offerUnavailableError"}),d=e.extend({className:"mpf-innovate-checkout-page",setup({me:e,stateMachine:n,service:s,tracker:r,cartFactory:a}={}){this.me=e,this.stateMachine=n,this.service=s,this.cartFactory=a,this.tracker=r,this.spinner=new t},async load(){try{this.cart=this.cartFactory.createModel(r.Types.ME,{}),n.loadStoredCart(this.service,this.cart),this.me.isNew()&&await this.me.fetchPromise({onPassportError:c.redirectToLogin.bind(this)}),this.checkoutPage&&this.stopListening(this.checkoutPage),this.checkoutPage=await this._createCheckoutLauncher()}catch(e){let t;console.error(e),t=e&&e.response&&"OfferUnavailableInCountry"===e.response.errorCode?l.get("offerUnavailableInBuyerCountry"):l.get("failedToUpdateCart"),this.stateMachine.changePage(a.Pages.CART,{errorMessage:t})}},render(){return this.container.setContent([this.alert,this.checkoutPage.render()]),this.tracker&&this.tracker.sendPage({cart:this.cart,url:window.location.pathname,title:i.Titles.CHECKOUT}),this},destroy(){this.stopListening(),this.checkoutPage&&this.checkoutPage.destroy(),this.checkoutPage=null,this.stateMachine=null,this.tracker=null,this._parent(),this.container=null},async _createCheckoutLauncher(){const e=await o.createComponent({cartId:this.cart.get("id"),service:s.INNOVATE});return this.listenTo(e,o.Events.BACK_TO_CART,(async()=>{this.stateMachine.changePage(a.Pages.CART)})),this.listenTo(e,o.Events.PAYMENT_DONE,(async()=>{n.storeCart(this.service,this.cart),this.stateMachine.changePage(a.Pages.PAYMENT_RESULT)})),e}});return d.Events=h,d})),define("DS/MPFInnovateComponent/BuyBusinessExperienceComponent",["UWA/Class/View","DS/UIKIT/Spinner","DS/UIKIT/Alert","DS/MPFServices/MarketplaceServices","DS/MPFUtils/StorageUtils","DS/MPFServices/ObjectService","DS/MPFPspModel/PspModel","DS/MPFCompanyModel/CompanyCollection","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartItemFactory","DS/MPFOfferModel/OfferFactory","DS/MPFTenantModel/TenantFactory","DS/MPFInnovateComponent/offers/OfferPageSkeleton","DS/MPFInnovateComponent/offers/OfferPage","DS/MPFInnovateComponent/myCart/MyCartPageSkeleton","DS/MPFInnovateComponent/myCart/MyCartPage","DS/MPFInnovateComponent/platformSelection/PlatformSelectionPage","DS/MPFInnovateComponent/checkout/InnovateCheckoutSkeleton","DS/MPFInnovateComponent/checkout/InnovateCheckoutPage","DS/MPFInnovateComponent/checkout/EndPurchasingPage","DS/MPFInnovateComponent/InnovateTracker","DS/MPFClickAndBuyComponent/checkout/PaymentRedirectResultPage","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFInnovateComponent/BuyBusinessExperienceDataLoader","DS/MPFInnovateComponent/BuyBusinessExperienceStateMachine","css!DS/MPFInnovateComponent/MPFInnovateComponent"],(function(e,t,n,s,r,a,i,o,c,l,h,d,p,u,m,C,f,g,y,S,P,E,M,v,T,I){"use strict";const D=Object.freeze({EMPTY_CART:"emptyCart",RENDERED:"rendered",PURCHASE_ORDER_UPLOADED:"purchaseOrderUploaded",PAYMENT_COMPLETED:"paymentCompleted",PAYMENT_DECLINED:"paymentDeclined",BACK:"back"}),F=e.extend({className:"mpf-buy-business-experience-component",setup({platformPurchaseUrl:e,service:r=s.INNOVATE}){this.platformPurchaseUrl=e,this.service=r,this.tracker=new E,this.alert=new n({autoHide:!0,hideDelay:5e3,visible:!1}),this.dataLoader=new T({service:this.service}),this.spinner=new t,this.errorPage=new v,this.skeletons={[I.Pages.OFFER]:new u,[I.Pages.CART]:new C,[I.Pages.CHECKOUT]:new y}},loadGeneralData({initialPage:e}){return this.dataLoader.isLoaded()?Promise.resolve():this.dataLoader.loadData({initialPage:e}).then((({stateMachine:e,allCountries:t,countryFactory:n,cartFactory:s,cartItemFactory:r,offerFactory:u,tenantFactory:m,openedCountries:C,psp:f,me:g,companies:y})=>{a.requiredOfPrototype(e,I,"options.stateMachine must be a BuyBusinessExperienceStateMachine"),a.requiredOfPrototype(f,i,"options.psp must be a PspModel"),a.requiredOfPrototype(t,c,"options.allCountries must be a CountryCollection"),a.requiredOfPrototype(s,l,"options.cartFactory must be a CartFactory"),a.requiredOfPrototype(r,h,"options.cartItemFactory must be a CartItemFactory"),a.requiredOfPrototype(u,d,"options.offerFactory must be a OfferFactory"),a.requiredOfPrototype(m,p,"options.tenantFactory must be a TenantFactory"),a.requiredOfPrototype(y,o,"options.companies must be a CompanyCollection"),this.stateMachine=e,this.pages={[I.Pages.OFFER]:this._createOfferPage({companies:y,allCountries:t,openedCountries:C,countryFactory:n,cartFactory:s,cartItemFactory:r,offerFactory:u}),[I.Pages.CART]:this._createMyCartPage({companies:y,allCountries:t,openedCountries:C,countryFactory:n,cartFactory:s,offerFactory:u,psp:f}),[I.Pages.PLATFORM_SELECTION]:this._createPlatformSelectionPage({me:g,companies:y,openedCountries:C,offerFactory:u,cartFactory:s,tenantFactory:m}),[I.Pages.CHECKOUT]:this._createCheckoutPage({me:g,cartFactory:s}),[I.Pages.PAYMENT_RESULT]:this._createPaymentResultPage({cartFactory:s,me:g})},this.listenTo(this.stateMachine,I.Events.PAGE_CHANGE_REQUESTED,(async e=>{this.render(e)}))}))},render({errorMessage:e}={}){let t;return t=this.dataLoader.isLoaded()?this.stateMachine.getPage():I.getInitialPage(this.service),this.container.setContent([this.skeletons[t]?this.skeletons[t].render():{tag:"div",class:"mpf-spinner-container",html:[this.spinner.show()]}]),this._scrollToTop(),this.loadGeneralData({initialPage:t}).then((()=>this.pages[t].load())).then((({renderPage:n=!0}={})=>{n&&(this.container.setContent([this.alert,this.pages[t].render()]),e&&this.alert.add({message:e,className:"error"}).show(),this._scrollToTop(),this.dispatchEvent(D.RENDERED))})).catch((e=>{console.error(e);const t=e&&(e.errorCode||e.response&&e.response.errorCode);t&&this.errorPage.setError(t),this.errorPage.load().then((()=>{this.container.setContent([this.errorPage.render()])}))})),this},destroy(){this.stopListening(),this.stateMachine&&this.stateMachine.clearPage(),this.pages&&Object.keys(this.pages).forEach((e=>{this.pages[e].destroy(),this.pages[e]=null})),this.pages=null,Object.keys(this.skeletons).forEach((e=>{this.skeletons[e].destroy(),this.skeletons[e]=null})),this.skeletons=null,this.stateMachine=null,this.tracker=null,this._parent(),this.container=null},_scrollToTop(){this.container.scrollIntoView({behavior:"instant",block:"start"})},_createOfferPage({companies:e,allCountries:t,openedCountries:n,countryFactory:s,cartFactory:r,cartItemFactory:a,offerFactory:i}){const o=new m({stateMachine:this.stateMachine,service:this.service,tracker:this.tracker,companies:e,allCountries:t,openedCountries:n,countryFactory:s,cartFactory:r,cartItemFactory:a,offerFactory:i});return this.listenTo(o,m.Events.BACK,this.dispatchEvent.bind(this,D.BACK)),o},_createMyCartPage({companies:e,allCountries:t,openedCountries:n,countryFactory:s,cartFactory:r,offerFactory:a,psp:i}){const o=new f({stateMachine:this.stateMachine,service:this.service,tracker:this.tracker,companies:e,allCountries:t,openedCountries:n,countryFactory:s,cartFactory:r,offerFactory:a,psp:i});return this.listenTo(o,f.Events.EMPTY_CART,this.dispatchEvent.bind(this,D.EMPTY_CART)),o},_createPlatformSelectionPage({me:e,companies:t,openedCountries:n,offerFactory:s,cartFactory:r,tenantFactory:a}){return new g({stateMachine:this.stateMachine,platformPurchaseUrl:this.platformPurchaseUrl,tracker:this.tracker,me:e,companies:t,openedCountries:n,offerFactory:s,cartFactory:r,tenantFactory:a})},_createCheckoutPage({me:e,companies:t,openedCountries:n,cartFactory:s,offerFactory:r,tenantFactory:a,platformPurchaseUrl:i}){return new S({stateMachine:this.stateMachine,service:this.service,tracker:this.tracker,me:e,companies:t,openedCountries:n,cartFactory:s,offerFactory:r,tenantFactory:a,platformPurchaseUrl:i})},_createPaymentResultPage({cartFactory:e,me:t}){const n=new P({stateMachine:this.stateMachine,service:this.service,cartFactory:e,me:t});return this.listenTo(n,P.Events.PAYMENT_COMPLETED,(({isPaymentOk:e})=>{r.clearCart(this.service),this.stateMachine.clearPage(),this.stateMachine.clearUrl(),this.dispatchEvent(e?D.PAYMENT_COMPLETED:D.PAYMENT_DECLINED)})),n}});return F.Events=D,F}));