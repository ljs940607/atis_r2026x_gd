define("DS/VCXWebComposer/VCXNodeHolderRoot",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/Node3D"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){return this._sgNode||(this.getPathElement(),this._sgNode=this.GetObject()._experienceBase.getManager("VCXContextManager").getRootNode()),this._sgNode},getPathElement:function(){return this._pathElement||(this._pathElement=this.GetObject()._experienceBase.getManager("VCXContextManager").getRootPathElement()),this._pathElement},isSelfManagedPathElement:function(){return!1}})})),define("DS/VCXWebComposer/VCXExperience",["DS/CoreEvents/Events","UWA/Class","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebDressup/VCXCmdChangeDressup","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdReplaceScenario","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdUpdateThumbnail","DS/VCXWebIO/VCXFileServices","DS/WebappsUtils/WebappsUtils","DS/VCXWebIO/VCXLogServices","DS/VCXKeyFramer/VCXScenario","DS/VCXWebVisualization/VCXPublishRasterImage","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","i18n!DS/VCXWebComposer/assets/nls/VCXWebComposer","DS/VCXWebSystem/VCXMutex","DS/VCXWebExperienceBase/VCXContextManager","DS/VCXWebKernel/VCXNotificationManager"],(function(e,t,n,r,a,i,o,s,c,l,p,C,u,d,g,h,m,f,V,M,_,S,X,D,b,I){"use strict";var v=t.extend({init:function(){this._endLoadingDone=!1,this._parent(),this._viewMode=0,this.volatileNotSaved=!1,this._mutex_UpdateScenarioThumbnail=new D({keepOnlyLast:!0})},initialize:function(){this._endLoadingDone=!1,this._FrameLastScenarioID=null,this._FrameLastRender=-1,this._isPlayingGoTo=0,this._thumbnailFreeze=!1,this._cpt=0,this._time=0,this._moy=0;var t=this;this.event_VCX_PROPERTIES_CHANGED=e.subscribe({event:"VCX_PROPERTIES_CHANGED"},(function(e){var n=t._experienceBase.getManager("VCXScenarioManager");n&&!1===n.GetAutoKey()&&t.SetVolatileNotSaved(!0)})),this.event_VCX_SCENARIO_CHANGED=e.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},(function(e){t._endLoadingDone&&e&&t._experienceBase.getManager("VCXContextManager").getContextFromName("ExperienceIn3DPlay")&&"AnimationSmgID"===e._ID&&t._experienceBase.getManager("VCXAPIManager").PlayAnimation("AnimationSmgID")})),this.event_VCX_END_LOADING_DONE=e.subscribe({event:"VCX_END_LOADING_DONE"},(function(e){t._endLoadingDone=!0})),this._eventStartFreezeThumbnail=e.subscribe({event:"/VCX/Picker/Query/Start"},(()=>{this._thumbnailFreeze=!0})),this._eventEndFreezeThumbnail=e.subscribe({event:"/VCX/Picker/Query/End"},(()=>{this._thumbnailFreeze=!1})),this.event_VCX_UPDATE_THUMBNAIL=e.subscribe({event:"VCX_UPDATE_THUMBNAIL"},(function(e){var n=t._experienceBase.getManager("VCXScenarioManager");if(n&&n.GetAutoKey()){var r=e&&e.scenarioID;if(r){var a=t._experienceBase.ComponentsMap.GetComponentFromID(r);a&&t.UpdateScenarioThumbnail(a)}}})),this.event_onViewpointEndMove=e.subscribe({event:"/VISU/"},(e=>{if(e&&"@onViewpointEndMove"===e.eventType&&"controller"===e.from){var n=t._experienceBase.getManager("VCXScenarioManager");if(n&&n.GetCameraAutoKey()){var r=t._experienceBase.getManager("VCXContextManager").getActiveCamera(),a=r.QueryInterface("VCXIModifiable"),i=r.QueryInterface("VCXIViewpointController");if(i){var o=new _;i.fromViewpoint(o);var s=new c;s.AddOrModifyPropertySet(a.GetHashing(),o);var l=new u(t._experienceBase,!0);l.ChangePropertiesFromMap(s),t._experienceBase.getManager("VCXCommandManager").Push(l)}}}})),this.event_onVCX_END_TRANSITION=e.subscribe({event:"VCX_END_TRANSITION"},(()=>{this.UnSetIsPlaying();var e=t._experienceBase.getManager("VCXScenarioManager");if(e&&e.GetAutoKey()){const n=e.GetCurrentScenario();if(n){const e=t._experienceBase.ComponentsMap.GetComponentFromID(n);e&&e.GetDocDirty()&&t.UpdateScenarioThumbnail(e)}}}))},SetVolatileNotSaved:function(e){this.volatileNotSaved=e,this.volatileNotSaved},postInitialize:function(){this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer(),this._viewer.setLightOnViewpoint(!0),this._viewer.setAutoUpdateLights(!0),this._loadingOption&&(this._loadingOption.quickLoad(this._experienceBase),this._loadingOption.HideVCXGUI()),this.InitDocumentProperties()},unInitialize:function(){this._endLoadingDone=!1,delete this._viewer,e.unsubscribe(this.event_VCX_PROPERTIES_CHANGED),delete this.event_VCX_PROPERTIES_CHANGED,e.unsubscribe(this.event_VCX_SCENARIO_CHANGED),delete this.event_VCX_SCENARIO_CHANGED,e.unsubscribe(this.event_VCX_END_LOADING_DONE),delete this.event_VCX_END_LOADING_DONE,e.unsubscribe(this.event_VCX_UPDATE_THUMBNAIL),delete this.event_VCX_UPDATE_THUMBNAIL,e.unsubscribe(this._eventStartFreezeThumbnail),delete this._eventStartFreezeThumbnail,e.unsubscribe(this._eventEndFreezeThumbnail),delete this._eventEndFreezeThumbnail,e.unsubscribe(this.event_onViewpointEndMove),delete this.event_onViewpointEndMove,e.unsubscribe(this.event_onVCX_END_TRANSITION),delete this.event_onVCX_END_TRANSITION},update:function(e){const t=this._experienceBase.getManager("VCXScenarioManager");if(t&&t.AutoThumbnailUpdate&&this.RefreshThumbnails(),e.viewer.viewerID!==b.MAIN_VIEWER_ID)return;const n=[];this._loopWaits&&this._loopWaits.forEach(((e,t)=>{e.remainingLoop--,e.remainingLoop<0&&(e.deferredPromise.resolve(),n.push(t))})),n.forEach((e=>{this._loopWaits.splice(e,1)}))},EndLoadingDressups:function(){let e=f.generateUUID();f.memoryLog("VCXCmdChangeDressup",!0,e);var t=new a(this._experienceBase);f.memoryLog("VCXCmdChangeDressup",!1,e);for(var n=this._experienceBase.ComponentsMap.GetComponentFromType("VCXDressup_Spec"),r=0;r<n.length;r++)t.AddDressups(n[r]);this._experienceBase.getManager("VCXCommandManager").Do(t),e=f.generateUUID(),f.memoryLog("VCXDressupManager UpdateDressupList",!0,e,{N:n.length,parameterName:"dressup"}),this._experienceBase.getManager("VCXDressupManager").UpdateDressupList(),f.memoryLog("VCXDressupManager UpdateDressupList",!1,e,{N:n.length,parameterName:"dressup"})},EndLoadingViewpoints:function(){this._viewer.displayPoints(!0);for(var e=this._viewer.getViewpoints(),t=0;t<e.length;t++)this._experienceBase.getManager("VCXContextManager").isSupported("DefaultViewpointControler")||(e[t].setDefaultController(!0,"SIMPLE"),e[t].getControl().setRotationRolling(!1),this._experienceBase.getManager("VCXContextManager").isSupported("RotateAroundPoint")&&e[t].getControl().setRotationAroundPoint(!0)),window.widget&&window.widget.enopadViewer||(e[t].reframe("iso",0),e[t].reframe(null,0))},GotoScenarioAndWaitForConvergence:async function(e){var t=new n(this._experienceBase);t.GoToScenario(e),this._experienceBase.getManager("VCXCommandManager").Do(t),await this.waitLoops(1),await this.getAllActorsReadiness("all")},GoToScenarioWithInterpolation:async function(t,a){return new Promise((async i=>{const o=async()=>{var o=this._experienceBase.getManager("VCXScenarioManager"),s=o.GetScenarios()[t];if(!s)return console.log("SCENARIO NOT FOUND : "+t),a&&a(),void i();var c,l=!0;(0==o.GetTransitionTime()&&(l=!1),l)?((c=new r(this._experienceBase)).BuildTransitionTo(s),c.SetCallback((()=>{a&&a(),i()})),await this._experienceBase.getManager("VCXCommandManager").Push(c)):(e.publish({event:"VCX_BEGIN_TRANSITION",data:{maxframe:10,scenario:s}}),(c=new n(this._experienceBase)).GoToScenario(t),this._experienceBase.getManager("VCXCommandManager").Push(c),this.SetIsPlaying(),e.publish({event:"VCX_END_TRANSITION"}))};this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this._experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),this._experienceBase.getManager("VCXPulseManager").isActive()?this._experienceBase.getManager("VCXPulseManager").StopPulse(o):await o()}))},RefreshThumbnails:async function(){if(this.refreshingThumbnails)return;this.refreshingThumbnails=!0;const e=this._experienceBase,t=e.getManager("VCXScenarioManager");let r=!1;const a=t.GetScenarios();for(const e in a)if(a.hasOwnProperty(e)){a[e].GetDocDirty()&&(r=!0)}if(!r)return void(this.refreshingThumbnails=!1);const i=e.getManager("VCXVisuManager"),o=e.getManager("VCXCommandManager"),s=e.getManager("VCXContextManager"),c=e.getManager("VCXNotificationManager"),l=t.GetCurrentScenario(),p=s.getActiveViewport(),C=p&&p.QueryInterface("VCXIViewpointController"),u=p&&p.QueryInterface("VCXIModifiable"),d=new _;C.fromViewpoint(d);const h=d.Clone(),m=[];h.GetListPropertyNames(m),m.forEach((e=>{"Camera.Position"!==e&&(h.GetProperty(e).GetPropertyInfo()._bPersistent=!0)})),i.hideDecorations("refreshDirtyThumbnails",s.getMainViewer());const f=new Promise((async r=>{const a=t.GetScenarios();for(var i in a)if(a.hasOwnProperty(i)){var c=a[i];if(c.GetDocDirty()){const t=new n(e);t.GoToScenario(c.GetID()),o.Do(t),e._ManagerSet.update({viewer:s.getMainViewer(),viewpoint:s.getMainViewer().currentViewpoint});const r=new g(e,c,!0);await r.Do()}}r()})),V={strObjectName:"Scenarios",strAction:X["VCXExperience.RefreshingThumbnails"],maskDisplayAdd:I.FDisplayMode.LOADINGPANEL|I.FDisplayMode.CONSOLE,iPromise:f,maskDisplayEnd:!0};c.addProgressNotification(V),await f;const M=new n(e);M.GoToScenario(l),o.Do(M);const D=new S(t,o,!0);m.forEach((e=>{D.ChangeProperty(u,h.GetProperty(e).Clone())})),o.Do(D),C.toViewpoint(),i.showDecorations("refreshDirtyThumbnails",s.getMainViewer()),this.refreshingThumbnails=!1},capturePixels:async function(e){var t=this._experienceBase,n=new M,r=[165,118],a=1.5*r[0],i=1.5*r[1];return n.doThumbnailToDataUrl(t,a,i,e)},capturePIP:async function(){const e=this._experienceBase,t=e.getManager("VCXContextManager");if(t&&(t.isSupported("BetterSceneThumbnail")||t.isSupported("VCXPIPSupport"))){const t=e.getManager("VCXPaperManager").Ratio;var n=new M;let r;return await n.doHiRes(e,1024,1024*t,{mode:M.Mode.Current,quality:.8,usePaper:!0},(e=>{r=e.image})),r&&r.toDataUrl("image/png",.8)}return null},CaptureScenarioThumbnail:async function(t){if(this._thumbnailFreeze)return;let n=await this.capturePixels(),r=await this.capturePIP();var a=h.dataURLToBlob(n);let i=null;if(a){const e=this._experienceBase.getManager("VCXDocManager");e.RemoveDocument(t.GetDocId());var o=window.URL.createObjectURL(a),s=e.BuildPathFromString(o);(u=new C).SetValue("thumbnail.jpg"),s.SetFileName(u),i=e.AddOrModifyDoc(s,n,t.GetDocId()),t.SetDocId(t.GetDocId())}var c=r&&h.dataURLToBlob(r);let l=null;if(c&&t.GetPIPDocId){var p=this._experienceBase.getManager("VCXDocManager");p.RemoveDocument(t.GetPIPDocId().docID);var u;o=window.URL.createObjectURL(c),s=p.BuildPathFromString(o);(u=new C).SetValue("pip.jpg"),s.SetFileName(u),l=p.AddOrModifyDoc(s,r,t.GetPIPDocId().docID)}if(i||l){i&&t.SetDocId(i.GetValue()),l&&t.SetPIPDocId(l.GetValue());const e=t.QueryInterface("VCXIModifiable"),n=new d(this._experienceBase);n.CaptureNeutralProperties(e),n.Do()}t.SetDocDirty(!1),e.publish({event:"VCX_SCENARIO_REPLACED",data:t})},CaptureScenarioWithThumbnail:async function(t,n){var r,a;if(n){(r=this._experienceBase.Factory.BuildComponent("VCXScenario")).SetScenarioType(V.EScenarioType.Scenario),r.GetVisibility().SetMode(1);var i=r.GetVisibility();i&&(i.Empty(),r.SetVisibility(i)),r.SetPersistency(0),r.SetApplyNeutralAtGoToScenario(!0),r.SetZoomFitAll(!0)}else{var o=this._experienceBase.getManager("VCXContextManager").getActiveCamera();o||console.log("No Camera, scenario does not capture viewpoint..");var s=null;if(o){s=o.QueryInterface("VCXIModifiable");var c=o.QueryInterface("VCXIViewpointController");c&&c.fromViewpoint();var l=this._experienceBase.getManager("VCXScenarioManager")._keyframer._Neutrals.GetPropertySet(s.GetHashing()),p=s.GetProperties();l&&Object.keys(l._map).equals(Object.keys(p._map))||this._experienceBase.getManager("VCXScenarioManager").AddNeutrals(s,p)}var C={bIsPartialView:!1,visibilityMode:1,scenarioType:V.EScenarioType.Scenario,persistency:0};r=this._experienceBase.getManager("VCXScenarioManager").CaptureCurrentView(C)}if(t)a=t;else{a="Scene "+Object.keys(this._experienceBase.getManager("VCXScenarioManager").GetScenarios()).length.toString()}r.SetName(a);var u=r.QueryInterface("VCXIModifiable"),g=new d(this._experienceBase);return g.CaptureNeutralProperties(u),g.Do(),e.publish({event:"VCX_RENDER_PROCESSING",data:{status:!0}}),await this.CaptureScenarioThumbnail(r),e.publish({event:"VCX_RENDER_PROCESSING",data:{status:!1}}),r},UpdateScenario:function(e){return this.CaptureScenarioWithThumbnail(e.GetName()).then((t=>{var n=new s(this._experienceBase);n.ReplaceScenario(e,t),this._experienceBase.getManager("VCXCommandManager").Push(n),this._experienceBase.getManager("VCXGUIManager").deleteTimeline()}))},ClearTimerScenarioUpdate:function(){this._UpdateScenarioThumbnailTimer&&window.clearTimeout(this._UpdateScenarioThumbnailTimer),this._UpdateScenarioThumbnailTimer=null},_UpdateScenarioThumbnail:async function(t){return this._mutex_UpdateScenarioThumbnail.runExclusive((async()=>{var n=this._experienceBase.getManager("VCXExperience");let r=this._experienceBase.getManager("VCXEWSManager");if(await n.getAllActorsReadiness(),(!r||r.IsExperienceEWSReady())&&this._endLoadingDone){var a,i=this._experienceBase.getManager("VCXScenarioManager");if(i.GetCurrentScenario()===t.GetID())try{if(e.publish({event:"VCX_RENDER_PROCESSING",data:{status:!0}}),console.log("updating thumbnail"),this._experienceBase.getManager("VCXContextManager").update({viewer:this._viewer,viewpoint:this._viewer.currentViewpoint}),!i.GetCameraAutoKey()){(u=this._experienceBase.getManager("VCXVisuManager"))&&(u.CameraControlsViewpoint=!0,u.CameraEasingTime=0),a=new S(this._experienceBase);for(var o=this._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec"),s=0;s<o.length;s++){var c=new _;o[s].QueryInterface("VCXIViewpointController").fromViewpoint(c);var l=o[s].QueryInterface("VCXIModifiable");for(var p in c._map)if(c._map.hasOwnProperty(p)){var C=c.GetProperty(p);a.ChangeProperty(l,C)}i.UpdateProperties(l.GetHashing())}}if(await this.CaptureScenarioThumbnail(t),!this._experienceBase.isValid||!this._endLoadingDone)return;var u;if(!i.GetCameraAutoKey())this._experienceBase.getManager("VCXCommandManager").Do(a),(u=this._experienceBase.getManager("VCXVisuManager"))&&(u.CameraControlsViewpoint=!1,u.CameraEasingTime=null);e.publish({event:"VCX_RENDER_PROCESSING",data:{status:!1}})}catch(e){console.warn(e)}}}))},UpdateScenarioThumbnail:async function(e,t){if(!e||this._experienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode")||!this._endLoadingDone)return;const n=this._experienceBase.getManager("VCXVisuManager");if(!n||!n.getNonVisibleSpaceState())if(this.ClearTimerScenarioUpdate(),t){let t=this._experienceBase.getManager("VCXContextualContentManager");t&&t.contextualShortcutToolbarCtrl&&t.contextualShortcutToolbarCtrl.isContextualBarDisplayed()&&await new Promise((e=>{t.contextualShortcutToolbarCtrl.contextualBarContextualMenuObserver(!1,"wux-afr-contextual-bar",e)})),await this._UpdateScenarioThumbnail(e)}else this._UpdateScenarioThumbnailTimer=window.setTimeout((()=>this.UpdateScenarioThumbnail(e,!0)),1e3)},CreateNewScenario:async function(e,t){return this.CaptureScenarioWithThumbnail("",t).then((t=>{for(var n="",r="",a=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),i=0;i<a.length;i++){var s=a[i];s.IsKindOf("VCXScenarioSequence")||s.IsKindOf("VCXScenario")&&(r=s.GetID())}var c=new o(this._experienceBase),l=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(r);if(l){var p=this._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(r);c.InsertScenarioInSequence(t,l.GetID(),p),{scenario:t,sequenceId:l.GetID(),prevIndex:l.GetIndexOfScenario(p)}}else{if(n=this._experienceBase.getManager("VCXGUIManager").GetActiveSequenceId());else{var C=this._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(!C[0])return;n=C[0].GetID()}var u=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n),d=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),g=u.GetIndexOfScenario(d);c.InsertScenarioInSequence(t,n,g+1),{scenario:t,sequenceId:n,prevIndex:this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n).GetListScenariosId().length-1}}return e?this._experienceBase.getManager("VCXCommandManager").Do(c):this._experienceBase.getManager("VCXCommandManager").Push(c),this._experienceBase.getManager("VCXContextManager").renderAll(),t}))},InitImagePanels:async function(){if(console.log("InitImagePanels"),-1==this._experienceBase.getManager("VCXDocManager").GetDefaultImageIndex()){var t=m.getWebappsAssetUrl("VCXWebVisualization","texture/I_VCX_DefaultTexture.png"),n=new Image;return n.crossOrigin="Anonymous",new Promise(((r,a)=>{n.onload=()=>{if(!this._experienceBase.Factory)return;const t=document.createElement("CANVAS"),a=t.getContext("2d");t.height=n.height,t.width=n.width,a.drawImage(n,0,0);var i=t.toDataURL("image/png"),o=h.dataURLToBlob(i),s=window.URL.createObjectURL(o),c=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(s,"I_VCX_DefaultTexture.png"),p=this._experienceBase.getManager("VCXDocManager").AddOrModifyDocInt(c);if(this._experienceBase.getManager("VCXDocManager").actorDocManager){var C=this._experienceBase.getManager("VCXDocManager").actorDocManager.QueryInterface("VCXIModifiable"),d=new l(p),g=C.GetProperty("DocManager.defaultIndex");g.SetPropertyValue(d);var m=new u(this._experienceBase,!0);m.ChangeProperty(C,g),this._experienceBase.getManager("VCXCommandManager").Do(m)}else this._experienceBase.getManager("VCXDocManager").SetDefaultImageIndex(p);e.publish({event:"VCX_IMAGE_INIT_DONE"}),r(n)},n.onerror=e=>{a(e)},n.src=t}))}},InitDocumentProperties:function(){var e=new d(this._experienceBase),t=this._experienceBase.getManager("VCXScenarioManager").QueryInterface("VCXIModifiable");e.ChangeProperty(t,"ScenarioManager.FPS",new p(30)),e.ChangeProperty(t,"ScenarioManager.InterFramesMax",new l(10)),e.ChangeProperty(t,"ScenarioManager.startScenarioId",new C(""));this._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable");var n=this._experienceBase.getManager("VCXCommandManager").QueryInterface("VCXIModifiable");e.ChangeProperty(n,"CommandManager.maxSize",new l(500)),this._experienceBase.getManager("VCXCommandManager").Do(e)},SetViewMode:function(e){this._viewMode=e},GetViewMode:function(){return this._viewMode},_addManager:function(e,t,n,r,a){var i=this._experienceBase.Factory.BuildComponent(e);return i?(i.SetID(e+"ID"),i.SetPersistency(t),n.addManager(e,i,a),r.push(i),i):(console.error("Can't create manager "+e),null)},waitLoops:async function(e){this._loopWaits||(this._loopWaits=[]);const t={remainingLoop:e,deferredPromise:UWA.Promise.deferred()};return this._loopWaits.push(t),t.deferredPromise.promise},SetIsPlaying:function(){this._isPlayingGoTo=1},UnSetIsPlaying:function(){this._isPlayingGoTo=0},GoToScenarioContext:function(){this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();return!this._isPlayingGoTo},getAllActorsReadiness:async function(e="main"){let t=[];return Object.values(this._experienceBase.ComponentsMap.GetComponentTable()).forEach((n=>{let r=n&&n.QueryInterface("VCXIReadiness");if(r){let n=r.isReady(e);n&&t.push(n)}})),this.readinessPromise||(this.readinessPromise=[]),t.length?(this.readinessPromise[e]||(this.readinessPromise[e]=UWA.Promise.deferred()),Promise.allSettled(t).then((()=>{this.getAllActorsReadiness(e)})),this.readinessPromise[e].promise):(this.readinessPromise[e]&&(this.readinessPromise[e].resolve(),this.readinessPromise[e]=null),!0)}});return Object.defineProperty(v.prototype,"componentType",{enumerable:!0,get:function(){return"VCXExperience"}}),v}));var __decorate=this&&this.__decorate||function(e,t,n,r){var a,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebComposer/VCXCommandControllerManager",["require","exports","DS/VCXWebComponents/VCXWebComponentBaseExperience","DS/ApplicationFrame/CommandsManager","DS/VCXWebSystem/VCXEvent","DS/CoreEvents/Events","DS/VCXWebSystem/VCXCommandHelperEnum"],(function(e,t,n,r,a,i,o){"use strict";n=__importDefault(n),r=__importDefault(r),a=__importDefault(a),i=__importDefault(i),o=__importDefault(o);let s={show:["enable","onExecute"],enable:["onExecute"],onExecute:[]};class c extends n.default{constructor(){super(...arguments),this.commandFilters=new Map,this.defaultCommandFilters=new Map}initialize(){}unInitialize(){}registerDefaultAvailabilityFilter(e,t="show"){let n=this._buildParam([],e,t);for(let e of n.actions){let t=this.defaultCommandFilters.get(e)??{filters:[]};if(n.filters.find((e=>!(e instanceof c.AFilter))))throw new Error("You can't use a callback as Default Availability, we couldn't override it, so it's not possible");t.filters.push(...n.filters),this.defaultCommandFilters.set(e,t)}}registerAvailabilityCommands(e,t=[],n="show"){let r=this._buildParam(e,t,n);for(let e of r.actions)for(let t of r.cmds){let n=this.commandFilters.get(t)??new Map,a=n.get(e)??{filters:[]};a.filters.push(...r.filters),n.set(e,a),this.commandFilters.set(t,n)}}_buildParam(e,t,n){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]),t.filter((e=>e instanceof c.AFilter)).forEach((e=>e.initialize(this._experienceBase)));let r=0;for(;r!==n.length;){let e=Array.from(n);r=e.length;for(let t of n)s[t]&&e.push(...s[t]);n=Array.from(new Set(e))}return{cmds:e,filters:t,actions:n}}onPreBeginCmd(e){if(e){let t=e.getId(),n=this._getSelectionFilter();l(t,this._computeFilters(t,"onExecute").filter((e=>!(e instanceof c.RunningCommandFilter))),n,"onExecute")||e.setCancel(!0)}}onEndCommand(){setTimeout(this.evaluateCommandsAvailability.bind(this),100)}evaluateCommandsAvailability(){let e=this._getSelectionFilter();this.commandFilters.forEach(((t,n)=>{const r=l(n,this._computeFilters(n,"show"),e,"show");this._setEnable(n,r)}))}_getSelectionFilter(){return this._experienceBase.getManager("VCXSelectionManager").getSelectionContext({scenariosFilter:"selected"})}_computeFilters(e,t){let n=this.commandFilters.get(e)?.get(t)?.filters??[],r=this.defaultCommandFilters.get(t)?.filters??[],a=n.filter((e=>e instanceof c.AFilter)).map((e=>Object.getPrototypeOf(e))),i=r.filter((e=>!a.includes(Object.getPrototypeOf(e))));return n.concat(i)}_setEnable(e,t){let n=r.default.getCommand(e);n&&t?n.enable():n&&!t&&n.disable()}}__decorate([a.default.subscribeAll],c.prototype,"initialize",null),__decorate([a.default.unsubscribeAll],c.prototype,"unInitialize",null),__decorate([a.default.Handler("/WUX/AFR/CMD/_Context/PRE_BEGIN")],c.prototype,"onPreBeginCmd",null),__decorate([a.default.Handler("/WUX/AFR/CMD/_Context/END")],c.prototype,"onEndCommand",null),__decorate([a.default.Handler(["VCX_END_LOADING_DONE","VCX_SELECTION_COMPONENTSLIST_ADD","VCX_SELECTION_COMPONENTSLIST_REMOVE","VCX_SELECTED_ACTORS_EMPTY","/WUX/AFR/CMD/_Context/POST_BEGIN"])],c.prototype,"evaluateCommandsAvailability",null),Object.defineProperty(c.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCommandControllerManager"}});let l=(e,t,n,r)=>t?.every((t=>{if(t instanceof c.AFilter){let n=t.doFiltering(e);return n||"onExecute"!==r||t.onCancel(e),n}return t(n)??!0}));return function(e){class t{constructor(){this._experienceBase=null}initialize(e){this._experienceBase=e}onCancel(e){}}e.AFilter=t;e.SelectionFilter=class extends t{constructor(e){super(),this.options=e}doFiltering(e){const t=this._experienceBase?.getManager("VCXSelectionManager"),{type:n,minCount:r=1,maxCount:a=1/0,preFilterCb:i,customSelectionCallback:o}=this.options;let s=this.options.strictSelection,c=t?.GetComponentsFromSelection("CSO")||[];return i&&(c=c.filter(i),s=!1),o?o(c):!(s&&n&&!c.every((e=>e.IsKindOf(n))))&&(n&&(c=c.filter((e=>e.IsKindOf(n)))),!(c.length<r||c.length>a))}};e.RunningCommandFilter=class extends t{constructor(e){super(),this.runningCmd=e}doFiltering(e){return r.default.getCommand(this.runningCmd).isRunning()}};e.NoShowSpaceFilter=class extends t{constructor(e){super(),this.forceState=e}doFiltering(e){const t=this._experienceBase?.getManager("VCXVisuManager"),n=t.getNonVisibleSpaceState();return!(!this.forceState&&t)||!n}onCancel(e){this._experienceBase&&this._experienceBase.getManager("VCXVisuManager").getNonVisibleSpaceState()&&i.default.publish({event:"VCX/Cmd/Step",data:{name:"VisibleSpace",requestedStep:o.default.Step.WARN}})}}}(c||(c={})),c})),define("DS/VCXWebComposer/VCXISelectBehavior",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("DS/VCXWebComposer/VCXLoadServices",["UWA/Class","DS/CoreEvents/Events","DS/WebComponentModeler/WebComponentBase","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebDressup/VCXCmdChangeDressup","DS/CATCXPModel/interfaces/CATI3DXAssetProperties","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebPlatform/VCXPlatformServices","DS/WebRBTree/WebRBIterator","DS/VCXWebSystem/VCXEnums","DS/VCXWebIO/VCXLogServices","DS/Visualization/IdPath","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertyValueString","i18n!DS/VCXWebEWS/assets/nls/VCXWebEWS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernel/VCXNotificationManager","DS/VCXWebKernelCommands/VCXCmdChangeComponent"],(function(e,t,n,r,a,i,o,s,c,l,p,C,u,d,g,h,m,f,V,M,_,S){"use strict";let X=e.singleton({Initialize:function(e){this._experienceBase=e,this._isLoadingVisu=!1},UnInitialize:function(){this._experienceBase=null,this._isLoadingVisu=!1,this._creationList=null},_RemoveDeprecatedLinks:async function(e,t){console.log("==================== _RemoveDeprecatedLinks");let n=this._experienceBase.getManager("VCXScenarioManager");if(n){e.impactedComponents||(e.impactedComponents={}),e.impactedComponentsInverted||(e.impactedComponentsInverted={}),n.ResetLinksTo(t,e.impactedComponents,e.impactedComponentsInverted,!1,null);for(let t in e.impactedComponents)if(e.impactedComponents.hasOwnProperty(t)){let e=this._experienceBase.ComponentsMap.GetComponentFromID(t);e&&(e.isImpactedByUpdate=!0)}let r=this._experienceBase.ComponentsMap.GetComponentFromType("VCXScenario");for(let e=0;e<r.length;e++){let n=r[e].GetVisibility();if(n)for(let a in t)t.hasOwnProperty(a)&&(n._visibilityMap[a]&&(delete n._visibilityMap[a],r[e].SetBoostDirty()),n._visibilityMapCollab[a]&&(delete n._visibilityMapCollab[a],r[e].SetBoostDirty()))}}},_RemoveDeprecatedMaterialSingle:async function(e){if(!this._CheckOverrideAssetStatus(e,"CATI3DXAssetProperties")){e.isHasLinkBrokenFromUpdate=!0;let n=this._experienceBase.getManager("VCXCommandManager"),a=e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),i={};i.instanceName=a,i.referenceName="unknown",i.id=e.GetID(),console.log("deleting MATERIAL ["+a+"]");let o=e.QueryInterface("CATI3DExperienceObject").GetValueByName("appearance");n.StartTransaction();let s=new S(this._experienceBase);var t=new r(this._experienceBase);return s.RemoveComponents([e,o]),t.RemoveModifiables([e.QueryInterface("VCXIModifiable"),o.QueryInterface("VCXIModifiable")]),n.Push(s),n.Push(t),n.EndTransaction(),await this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().DeleteMaterial(e),i}},_RemoveDeprecatedMaterial:async function(e,t){console.log("==================== _RemoveDeprecatedMaterial"),e.deletedMaterials||(e.deletedMaterials=[]);let n=this._experienceBase.ComponentsMap.GetComponentFromType("CXPCoveringMaterial_Spec");for(let r=0;r<n.length;r++){const a=await this._RemoveDeprecatedMaterialSingle(n[r]);a&&(t[a.id]=!0,e.deletedMaterials.push(a))}return t},_RemoveDeprecatedAmbianceSingle:async function(e){let t=!this._CheckOverrideAssetStatus(e,"CATI3DXAssetProperties");if(!t){let n=e.QueryInterface("CATI3DXAmbienceAsset");try{await n.getAmbience()||(t=!0)}catch(e){t=!0,console.error(e)}}if(t){let t=e.QueryInterface("CATI3DExperienceObject");if(!t)return console.log("_RemoveDeprecatedAmbianceSingle : CATI3DExperienceObject FAILED !!!!!!!!!!!!!!!!!!!"),UWA.Promise.resolve();e.isHasLinkBrokenFromUpdate=!0;let n=t.GetValueByName("_varName");console.log("deleting AMBIENCE ["+n+"]");let r=new a(this._experienceBase);r.RemoveDressups(e),this._experienceBase.getManager("VCXCommandManager").Do(r);let i={instanceName:"unknown",referenceName:"unknown"};return i.instanceName=n,i.id=t.GetObject().GetID(),i}},_RemoveDeprecatedSelectionSet:async function(e,t){let n=this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec"),r=this._experienceBase.ComponentsMap.GetComponentFromType("VCXGroupSelectionSet_Spec"),a=this._experienceBase.getManager("VCXScenarioManager");for(let e of n){let t=e.QueryInterface("VCXIModifiable"),n=a.GetNeutrals(t.GetHashing());if(n){let e=n.GetProperty("Actor.ListActors"),t=e.GetPropertyValue().GetValue();t=t.filter((e=>this._experienceBase.ComponentsMap.GetComponentFromID(e.GetValue()))),e.SetPropertyValue(new s(t)),n.AddOrModifyProperty(e)}}let i=r[0];if(i){let e=i.QueryInterface("VCXIModifiable"),t=a.GetNeutrals(e.GetHashing()).GetProperty("Actor.ListActors").GetPropertyValue().GetValue().map((e=>e.GetValue()));for(let e of n)t.includes(e.GetID())||await this._experienceBase.getManager("VCXSelectionSetManager").DeleteSelectionSets([e])}return t},_RemoveDeprecatedAmbiance:async function(e,t){console.log("==================== _RemoveDeprecatedAmbiance"),e.deletedAmbiences||(e.deletedAmbiences=[]);let n=this._experienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec");for(let r=0;r<n.length;r++){const a=await this._RemoveDeprecatedAmbianceSingle(n[r]);a&&(t[a.id]=!0,e.deletedAmbiences.push(a))}return t},_DeleteOverrideWithSameParent:async function(e){let t=this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel();await t.DeleteOverrides(e),console.log("## Number of overrides deleted = "+e.length)},_CheckOverrideAssetStatus(e,t){const n=e.QueryInterface(t);if(n){return n.getAssetStatus()!==i.AssetStatus.StatusBroken}return!1},_RemoveDeprecatedOverride:async function(e,t){if("Model_VPMReference_Spec"===e.GetObject().GetType())return;if(e.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&e.GetPersistency()===n.EPersistencyType.notPersistent)return;let a=e.QueryInterface("CATI3DExperienceObject"),i=e.QueryInterface("CATI3DXOverrideAssetProperties");if(a&&i){let t=a.GetValueByName("_varName"),n=!this._CheckOverrideAssetStatus(e,"CATI3DXOverrideAssetProperties");try{if(n){e.isHasLinkBrokenFromUpdate=!0;let n=e.QueryInterface("VCXIModifiable");if(n){let e=[];e.push(n);let t=new r(this._experienceBase);t.RemoveModifiables(e),this._experienceBase.getManager("VCXCommandManager").Do(t)}let i={instanceName:"unknown",referenceName:"unknown"};return i.instanceName=t,i.id=a.GetObject().GetID(),{delOverideDesc:i,iOverrideToDelete:a}}}catch(n){e.isHasLinkBrokenFromUpdate=!0;let i=e.QueryInterface("VCXIModifiable");if(i){let e=[];e.push(i);let t=new r(this._experienceBase);t.RemoveModifiables(e),this._experienceBase.getManager("VCXCommandManager").Do(t)}let o={instanceName:"unknown",referenceName:"unknown"};return o.instanceName=t,o.id=a.GetObject().GetID(),{delOverideDesc:o,iOverrideToDelete:a}}}},_RemoveDeprecatedOverrides:async function(e){console.log("==================== _RemoveDeprecatedOverrides"),e.deletedOverides||(e.deletedOverides=[]);let t={},n=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer");console.log("_RemoveDeprecatedOverrides : current VCXComponentOccurrenceComposer number = "+n.length);let r=[];for(let a=0;a<n.length;a++){const i=await this._RemoveDeprecatedOverride(n[a],e.ProductStructures);i&&(e.deletedOverides.push(i.delOverideDesc),r.push(i.iOverrideToDelete),t[i.iOverrideToDelete.GetObject().GetID()]=!0)}if(console.log("## Number of overrides to delete = "+r.length),0===r.length)return t;let a={};for(let e=0;e<r.length;e++){let t=r[e],n=t.GetParent();if(n){let e=n.GetID();void 0===a[e]&&(a[e]=[]),a[e].push(t)}}let i=[];for(let e in a)i.push(this._DeleteOverrideWithSameParent(a[e]));let o=UWA.Promise.all(i),s={strObjectType:m["ProgressNotification.Updating2"],maskDisplayAdd:_.FDisplayMode.LOADINGPANEL|_.FDisplayMode.CONSOLE,iPromise:o};return this._experienceBase.getManager("VCXNotificationManager").addProgressNotification(s),await o,console.log("## all overrides removed"),t},_rotatexSolidWProduct:function(e){console.log("rotate the product");const t=new g(this._experienceBase);t.SetAutoKey(!0);let n=e.QueryInterface("VCXIModifiable"),r=n.GetProperty("Actor.Position").GetPropertyValue(),a=r.GetFrame(),i=f.rotateMatrixAroundX(a.GetValue(),Math.PI/2);i=f.rotateMatrixAroundY(i,Math.PI/2),r.SetFrame(new V(i)),t.ChangePropertyValue(n,"Actor.Position",r);let o=new M(this._experienceBase);this._experienceBase.getManager("VCXCommandManager").Do(t),o.CaptureNeutralProperties(n),this._experienceBase.getManager("VCXCommandManager").Do(o)},_RemoveDeprecatedComponents:async function(e){let t=await this._RemoveDeprecatedOverrides(e);return t=await this._RemoveDeprecatedAmbiance(e,t),t=await this._RemoveDeprecatedMaterial(e,t),t=await this._RemoveDeprecatedSelectionSet(e,t),this._RemoveDeprecatedLinks(e,t)},buildNavigableFromActorAsset:function(e){const t=e.QueryInterface("VCXIModelNavigable");let n=e.QueryInterface("CATI3DX3DActorAsset"),r=e.QueryInterface("CATI3DExperienceObject"),a=n&&n.getVisuOverrideChildren();if(a)for(const e of a){e.QueryInterface("VCXIModelNavigable").setParent(t),X.buildNavigableFromActorAsset(e)}if(r&&r.HasVariable("materialsRef"))for(let e of r.GetValueByName("materialsRef")){e.QueryInterface("VCXIModelNavigable").setParent(t),this.buildNavigableFromActorAsset(e)}if(r&&r.HasVariable("appearance")){r.QueryInterface("CATI3DExperienceObject").GetValueByName("appearance").QueryInterface("VCXIModelNavigable").setParent(t)}},setComponentAttributes:async function(e,t){if(!e._pid&&t.productIndex){let n;if("Model_VPMReference_Spec"===e.componentType||"Model_VPMReference_Spec"===e.GetType())n=t.productIndex.getRefInstRoot();else{const r=e.QueryInterface("CATI3DXOverrideAssetProperties");if(!r)return;const a=r&&await r.getPathOfPhysicalId(),i=t.productIndex.getPathOfIDsFromPathOfInstances(a);n=i&&t.productIndex.getRefInstNode(i)}n&&n.setComponentAttributes(e)}},createComponentsFromPoInstances:async function(e){},createComponentsFromPOIds:async function(e,r){if(!e||e.length<1)return;const a={},i=[];for(const t of e)if(t&&t.ids&&t.ids){let e=r.productIndex.getRefInstNode(t.ids);for(;e;){if(e.isReference()){const t=e.getPathOfIDs();var o=t.toString();let r=this._experienceBase.ComponentsMap.getComponentFromIDPath(t,!0);(!r||r.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&r.GetPersistency()===n.EPersistencyType.notPersistent)&&(a&&a[o]||this._creationList&&this._creationList[o]||(i.push(e.getPathOfInstances()),a[o]={poid:t,index:i.length-1}))}e=e.parent}}const s=[];if(i.length>0){let e=this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel();const n=u.generateUUID();u.memoryLog("CreateOverridesProduct cmd",!0,n,{N:i.length,parameterName:"pathsOfIds"});const o=await e.CreateOverridesProduct(i,r);if(u.memoryLog("CreateOverridesProduct cmd",!1,n,{N:i.length,parameterName:"pathsOfIds"}),o.length===i.length)for(const e in a){this._creationList||(this._creationList={});const n=o[a[e].index];this._experienceBase.ComponentsMap.getComponentFromIDPath(a[e].poid,!0).setPersistentComponent(n),s.push(n),await X.setComponentAttributes(n,r),t.publish({event:"VCX_COMPONENT_CREATED",data:{component:n,product:r}});this._experienceBase.getManager("VCXScenarioManager").ConsiderNewComponent(n),this._creationList[e]=n}}return t.publish({event:"VCX_COMPONENTS_CREATED",data:{components:s,product:r}}),s},createComponentFromPathElement:async function(e,t){const n=window.widget&&widget.enopadViewer,r=n&&n.getController(),a=r&&r.buildArrayFromPath(e),i=a&&await this.createComponentsFromPOIds([new d(a)],t);return i&&i[0]&&i[0][i.length-1]},createComponents:async function(e){const t={};for(const r of e)if(r.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&r.GetPersistency()===n.EPersistencyType.notPersistent){let e=r.QueryInterface("VCXIModelNavigable");for(;e&&!e.GetObject().IsKindOf("Model_VPMReference_Spec");)e=e.getParent();const n=e&&e.GetObject().IsKindOf("Model_VPMReference_Spec")&&e.GetObject();if(n){const e=r.QueryInterface("W3AISGNodeHolder").getPathOfIDs(),a=e&&n.productIndex.getRefInstNode(e.ids);a&&(t[n.GetID()]||(t[n.GetID()]={product:n,pathOfInstances:[]}),t[n.GetID()].pathOfInstances.push(new d(a.getPathOfIDs())))}}for(const e in t)await this.createComponentsFromPOIds(t[e].pathOfInstances,t[e].product)},GetNeutralsFromVariables:function(e){let t={};if(e)for(let n=0;n<e.length;n++){let r=e[n];if(r){t[r.GetID()]=r}}else t=this._experienceBase.ComponentsMap.GetComponentTable();let r=this._experienceBase.getManager("VCXScenarioManager");for(let e in t)if(t.hasOwnProperty(e)){let a=t[e];if(a.GetPersistency()!==n.EPersistencyType.notPersistent){let e=a.QueryInterface("CATI3DExpVCXObjectConvertor");if(e){let t=a.QueryInterface("VCXIModifiable"),n=t.GetHashing(),i=r.GetNeutrals(n);i||(i=new o);let s=i.Clone();e.GetNeutralsFromVariables(s),s.GetPropertyNumber()>0&&r.AddNeutrals(t,s)}}}},FillNeutralPropertiesFromIndex:function(e){let t=e.component;const n=e.getData("ds6w:label"),r=e.parent?.getData("ds6w:label"),a=r&&r.trim().length?n+" ("+r+")":n,i=t.QueryInterface("VCXIModifiable"),o=new g(this._experienceBase);o.SetAutoKey(!0),o.ChangePropertyValue(i,"Actor.Name.ReferenceTitle",new h(n)),o.ChangePropertyValue(i,"Actor.Name.InstanceTitle",new h(r)),i.GetProperty("Actor.Name").GetPropertyValue().GetValue()||o.ChangePropertyValue(i,"Actor.Name",new h(a)),this._experienceBase.getManager("VCXCommandManager").Do(o)},_getMapAssetFromFileList:function(e){let t={};if(e.files)for(let n=0;n<e.files.length;n++){let r=e.files[n];t[r.name]=window.URL.createObjectURL(r)}return t},_filterPIdByTypes:async function(e,t){let n=[];const r=[],a=[],i=[],o={products:a,materials:n,ambiances:r,experiences:i};for(const t of e)n.push(...t.readStringArray("materialIds")),a.push(...t.readStringArray("physicalIds")),r.push(...t.readStringArray("ambienceIds")),i.push(...t.readStringArray("experienceIds"));return t.products=a.length,t.materials=n.length,t.ambiences=r.length,t.presentations=i.length,o},_convertBlobToArrayBuffer:async function(e){return new UWA.Promise(((t,n)=>{let r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=n,r.readAsArrayBuffer(e)}))},getDocIdInPropertyValuetree:function(e,t){var n=e.GetType();if("VCXPropertyValueHyperLinkId"===n)(r=e.GetValue())>=0&&(t[r]=!0);else if("VCXPropertyValueDocId"===n){var r;(r=e.GetValue())>=0&&(t[r]=!0)}else if(e instanceof s)for(var a=0;a<e._value.length;a++){var i=e._value[a];i&&this.getDocIdInPropertyValuetree(i,t)}},removeUselessDocuments:function(){console.log("Cleaning DocManager (removeUselessDocuments)");var e={},t=this._experienceBase,n=t.ComponentsMap.GetComponentTable();for(var r in n)if(n.hasOwnProperty(r)){var a=n[r].QueryInterface("VCXIModifiable");if(a)if(C=a.GetProperties())for(var i in C._map){var o=C._map[i].GetPropertyValue();this.getDocIdInPropertyValuetree(o,e)}}var s=t.getManager("VCXScenarioManager"),c=s._keyframer._Neutrals;for(var l in c._map)if(c._map.hasOwnProperty(l)){var C=c.GetPropertySet(l);for(var u in C._map)if(C._map.hasOwnProperty(u)){o=C.GetProperty(u).GetPropertyValue();this.getDocIdInPropertyValuetree(o,e)}}console.log("docids in tracks");var d=s.GetScenarios();for(var g in d)if(d.hasOwnProperty(g)){var h=d[g],m=[];h.GetListModifiables(m);for(var f=0;f<m.length;f++){l=m[f];var V=h.GetObjectAnimation(l);if(V){var M=[];V.GetListTrackNames(M);for(var _=0;_<M.length;_++){u=M[_];for(var S=V.GetTrack(u)._treekeys,X=new p(S),D=X.next();null!==D;){o=D.GetValue();this.getDocIdInPropertyValuetree(o,e),D=X.next()}}}}}var b=0,I=t.getManager("VCXDocManager"),v=I.GetDefaultImageIndex();-1!=v&&(e[v]=!0),console.log("nbdocs used = "+Object.keys(e).length),console.log(e);var y=I.GetDocMapClone();for(var x in y)y.hasOwnProperty(x)&&(e[x]||(I.RemoveDocument(x),b++));console.log("Nb Docs Removed = "+b)},FindComponentFromPathOfPID:function(e,t){let n=t.QueryInterface("VCXIModelNavigable");if(n){let t,r=e.toString(),a=r.replaceAll(",","|");if(n.traverse(((e,n,r)=>{let i=e.GetObject();i._hashPathID&&i._hashPathID.endsWith(a)&&(t=i,r.stop=!0)}),null,{}),t)return{fromPID:t};let i=[];return n.traverse((e=>{e.GetObject()._refid===r&&i.push(e.GetObject())})),{fromRefID:i}}}});return X})),define("DS/VCXWebComposer/VCXISensible",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("DS/VCXWebComposer/VCXComponentSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement"],(function(e,t,n){"use strict";return e.extend({getPathElement:function(){if(!this._pathElement){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");return e&&e.isEnopadLoaderUsed()?this.GetObject()._experienceBase.getManager("VCXCAT3DXModelManager").QueryInterface("VCXILoadHelper").getPathElement(this):this._parent()}return this._pathElement},setPathOfIDs:function(e){this._parent(e),this.GetObject()._experienceBase.ComponentsMap.addToHashTree(this.GetObject())},isSelfManagedPathElement:function(){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");return!!e&&e.isEnopadLoaderUsed()}})})),define("DS/VCXWebComposer/VCXUserInputControllerManager",["UWA/Core","DS/Core/Core","DS/Core/PointerEvents","DS/CoreEvents/Events","UWA/Class","DS/VisuEvents/EventsManager","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/ApplicationFrame/CommandsManager"],(function(e,t,n,r,a,i,o,s,c,l){"use strict";var p=a.extend({init:function(){},update:function(){this._dirtyCursorPosition.isDirty&&(this.inputContext.mousePosition={x:this._dirtyCursorPosition.x,y:this._dirtyCursorPosition.y},this._dirtyCursorPosition.isDirty=!1)},initialize:function(){this._visuEvents={},this._wuxEvents={},this._dirtyCursorPosition={isDirty:!1,x:0,y:0},this.onKeyDown=this._onKeyDown.bind(this),this.onMouseMove=this._onMouseMove.bind(this),this._updateInputContext=this.__updateInputContext.bind(this),this.dblClickToken=null,this.rightClickToken=null,this.simpleClickToken=null,this.dressupEdition=null,this.inputContext={mousePosition:{x:0,y:0},lastInteractedElement:void 0,vcxContext:void 0,vcxContextType:void 0,vcxAppContext:void 0},this.touchHoldActive=!1},_onKeyDown:function(t){if(!t.repeat){var n=e.Event.whichKey(t);if(!this.keyIsDown[n])switch(n){case"up":case"down":case"left":case"right":this.dressupEdition||r.publish({event:"VCX_ARROW_INPUT",data:{context:this.getInputContext(),key:n}})}}},postInitialize:function(){this._ApiCBDoubClick=null;const t=this._experienceBase.getManager("VCXContextManager");this._visuEvents.dblClickToken=i.addEvent(t.getMainViewer().div,"onPrimaryPointerDoubleClick",(e=>{this._onDblClkCanvasZoomFitEvent(e)})),t&&t.isSupported("VCXCreateOverridesOnDemand"),this._visuEvents.simpleClickToken=i.addEvent(this._experienceBase.getManager("VCXContextManager").getFrameWindow().elements.container,"onPrimaryPointerUpUnique",(e=>{this.touchHoldActive?this.touchHoldActive=!1:this._onClickUpdateFocusEvent(e,"onLeftClick")})),document.addEventListener("keydown",this.onKeyDown),this.keyIsDown=[],this.onKeyUp=t=>{var n=e.Event.whichKey(t);this.keyIsDown[n]&&(this.keyIsDown[n]=!1)},document.addEventListener("keyup",this.onKeyUp),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener(n.POINTERUP,this._updateInputContext)},__updateInputContext:function(e){this.inputContext.lastInteractedElement=e.target,this.inputContext.vcxContext=e.target.closest("[data-vcxContext]"),this.inputContext.vcxContextType=this.inputContext.vcxContext&&this.inputContext.vcxContext.dataset.vcxcontext,r.publish({event:"VCX/Context/Update",data:{...this.inputContext,mousePosition:{x:e.clientX,y:e.clientY}}})},setInnerAppContext:function(e){this.inputContext.vcxAppContext=e},getInputContext:function(){return this.inputContext},_onMouseMove:function(e){this._dirtyCursorPosition&&(this._dirtyCursorPosition.isDirty=!0,this._dirtyCursorPosition.x=e.clientX,this._dirtyCursorPosition.y=e.clientY)},RegisterDoubleClickCB:function(e){this._ApiCBDoubClick=e},_onDblClkCanvasZoomFitEvent:function(e){if(!this._experienceBase.getManager("VCXContextManager").cmdIsRunning){var t=s.GetPathElementFromEvent(e,this._experienceBase),n=t&&s.GetModifiableFromPathElement(t,this._experienceBase);if(n)if(n.GetObject().IsDressup)return;if(e&&e.from&&Array.isArray(e.from)&&e.from[0].view){if(e.from[0].view.className.includes("Part_List_Row"))return}var r=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(r)if(t&&n){var a=t.getBoundingSphere(r);r.currentViewpoint.reframe(null,750,a),this._ApiCBDoubClick&&this._ApiCBDoubClick(n._object._ID)}else t||(r.currentViewpoint.reframe(null,750),this._ApiCBDoubClick&&this._ApiCBDoubClick(null))}},_onClickUpdateFocusEvent:function(e,t){var n=e.from[0].view.closest(".Content")&&e.from[0].view.closest(".Content").getAttribute("data-type");this._experienceBase.getManager("VCXContextManager").getMainViewer();if("viewer"===n){var a=s.GetPathElementFromEvent(e,this._experienceBase),i=a&&s.GetModifiableFromPathElement(a,this._experienceBase);r.publish({event:"VCX_EditMode_PartList_Hide_UI",data:null}),i||r.publish({event:"VCXActiveCardMATERIAL",data:null})}},ZoomFitSelection:function(e){var t=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(t){var n=[];if(e.length>0)for(var r=0;r<e.length;++r){var a=this._experienceBase.ComponentsMap.GetComponentFromID(e[r]);a&&n.push(a)}else n=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();if(n&&0<n.length){var i=c.getBBoxInWorldFromComponents(n).getBoundingSphere();t.currentViewpoint.reframe(null,750,i)}else t.currentViewpoint.reframe(null,750)}},unInitialize:function(){for(let e in this._wuxEvents)this._wuxEvents.hasOwnProperty(e)&&r.unsubscribe(this._wuxEvents[e]);for(let e in this._visuEvents)this._visuEvents.hasOwnProperty(e)&&i.removeEventFromToken(this._visuEvents[e]);this._visuEvents=null,this._wuxEvents=null,this.onKeyDown&&(document.removeEventListener("keydown",this.onKeyDown),this.onKeyDown=null),this.onMouseMove&&document.removeEventListener("mousemove",this.onMouseMove),this._updateInputContext&&document.removeEventListener(n.POINTERUP,this._updateInputContext),this.onKeyUp&&(document.removeEventListener("keyup",this.onKeyUp),this.onKeyUp=null),this._ApiCBDoubClick=null},_runCommand:function(e){var t=this._experienceBase.getManager("VCXContextManager").getFrameWindow()._experienceBase;t.getManager("VCXCommandManager").StartTransaction();var n=t.getManager("VCXContextManager").getContext(),r=l.getCommand(e,n);r&&r.begin(),t.getManager("VCXCommandManager").EndTransaction()}});return Object.defineProperty(p.prototype,"componentType",{enumerable:!0,get:function(){return"VCXUserInputControllerManager"}}),p})),define("DS/VCXWebComposer/VCXBlobDumper",["UWA/Class","DS/VCXWebIO/VCXFileServices"],(function(e,t){"use strict";return e.extend({init:function(){this._mapDataB64={}},ConvertBlobsFromDocManager:function(e,t){this._mapDataB64={};var n={},r=e.getManager("VCXDocManager").GetDocMapClone();for(var a in r)if(r.hasOwnProperty(a)){var i=r[a];if(0===i.GetPathType().GetValue())i.GetValueURL().GetValue().indexOf("blob:")>=0&&(n[a]=i)}this.BlobsToB64(n,t)},BlobsToB64:function(e,n){var r=Object.keys(e).length;if(0!==r){var a=this,i=function(e,t){r--,e=e||"",a._mapDataB64[t]=e,0===r&&n()};for(var o in e)if(e.hasOwnProperty(o)){var s=e[o],c=s.GetValueURL().GetValue(),l=s.GetFileName().GetValue();t.BlobURLToBase64(c,l,i,o)}}else n()},GetMapOfData:function(){return this._mapDataB64}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebComposer/CATE3DExpVCXObjectConvertorOccurrence",["require","exports","DS/VCXWebEWS/VCXBaseVCXCXPConvertor","DS/Visualization/ThreeJS_DS"],(function(e,t,n,r){"use strict";n=__importDefault(n),r=__importDefault(r);class a extends n.default{_computeTab(){return[...super._computeTab(),{variableName:"opacity",propertyName:"Actor.Opacity",conversionDirection:n.default.ConversionType.NFV,NFVFunction:(e,t)=>(t.SetValue(e[0]/255),!0)},{variableName:"color",propertyName:"Actor.Color",conversionDirection:n.default.ConversionType.NFV,NFVFunction:([e],t)=>(t.SetValue(e._value?e._value:e),!0)},{variableName:["_varposition","_pivot"],propertyName:"Actor.Position",NFVFunction:(e,t)=>{let n=t,[a,i]=e;if(a&&a.length){let e=(new r.default.Matrix4).set(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0,0,0,1);n.GetFrame().SetValue(e)}if(i&&i.length){let e=(new r.default.Matrix4).set(i[0],i[3],i[6],i[9],i[1],i[4],i[7],i[10],i[2],i[5],i[8],i[11],0,0,0,1);n.GetPivot().SetValue(e)}return!0},VFNFunction:e=>{let t=e;var n=t.GetFrame().GetValue().elements,r=t.GetPivot().GetValue().elements;return[[n[0],n[1],n[2],n[4],n[5],n[6],n[8],n[9],n[10],n[12],n[13],n[14]],[r[0],r[1],r[2],r[4],r[5],r[6],r[8],r[9],r[10],r[12],r[13],r[14]]]}}]}}return Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"CATE3DExpVCXObjectConvertorOccurrence"}}),a})),define("DS/VCXWebComposer/VCXExperienceLoader",["UWA/Utils","DS/CoreEvents/Events","DS/VCXWebExperienceLoader/VCXExperienceLoaderBase","DS/VCXWebKernelCommands/VCXCmdChangeSequence","DS/VCXWebIO/VCXFileServices","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdGoToScenario"],(function(e,t,n,r,a,i,o){"use strict";return n.extend({InitLoader:function(e){this._parent(e.experienceBase),this._options=e},Load:async function(e,n){if(n&&console.error("CB deprecated"),e){this.InitLoader(e);var r=this._experienceBase.getManager("VCXContextManager");r.setSupported("UseTraverseGraph",!1),r.useTraverseGraph=!1,r.setContextFromName("Cat3DXIntegration",!1),r._rootInfos={componentType:"VCXComponentOccurrenceComposer",productType:"Reference3D",name:"Experience",id:"VCX_Root"};r.getRootComponent();return this._experienceBase.getManager("VCXGUIManager").InitGUI(),new Promise((async n=>{let r=t.subscribe({event:"VCX_ASSET_LOADED"},(async a=>{e=null,t.unsubscribe(r),await this.on3dxmlLoaded(this,a),n("3dxml")}));if(this._experienceBase._mapAssetsBlob=e.mapAssets,e.jsonFile){await this.LoadJSON();var a=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentAssetOccurrenceComposer");this._numOfAsset=a.length,this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties();var i=this._experienceBase.getManager("VCXContextManager");i.getContextFromName("ProdHighMode")&&i.getCat3DXIntegration()?await this.EndLoadJSON():e.loading3DXML||n("json")}else if(this._arrayAssets=[],this._bIsCADLoading=!0,e.mapAssets){var o=e.mapAssets;for(var s in this._numOfAsset=Object.keys(o).length,o)if(o.hasOwnProperty(s)){var c=this.CreateAsset(s);this._arrayAssets.push(c);var l=c.QueryInterface("VCXIModifiable");l&&this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralPropertiesOneModifiable(l.GetHashing())}this._experienceBase.getManager("VCXScenarioManager").UpdateProperties()}}))}console.error("Have to use iOptions")},CreateAsset:function(t){var n=0,r=t.split(".")[1];"3dxml"===r||"smggeom"===r.toLowerCase()&&(n=1);var a=this._experienceBase.Factory.BuildComponent("VCXComponentAssetOccurrenceComposer");if(a){this._experienceBase.ComponentsMap.AddComponent(a),a.SetAssetID(t);var o=t.split(".")[0]+"-"+e.getUUID().substr(0,18);a.SetNodeID(o),a.SetAssetType(n);var s=this._experienceBase.getManager("VCXContextManager").getRootComponent().QueryInterface("VCXIModelNavigable");a.QueryInterface("VCXIModelNavigable").setParent(s);var c=a.QueryInterface("VCXIModifiable"),l=new i(this._experienceBase);return l.CaptureNeutralProperties(c),l.Do(),a}console.error("Can't create component")},BuildComponentsFromAssets:function(e){for(let t=0;t<e.length;t++){var n=e[t],r=n.QueryInterface("W3AISGNodeHolder"),a=r.getSGNode(),o=r.getPathElement(),s=n.QueryInterface("VCXIModelNavigable"),c={attributeToUse:"productType",componentTypeForRootNode:"VCXComponentOccurrenceComposer",Instance3D:"VCXComponentOccurrenceComposer",Reference3D:null,InstanceRep:"VCXComponentMesh",defaultType:null,componentTypeFromFunction:function(e){if(!e)return null;var t=null;if("Instance3D"===e.productType){var n=e.getChildren();if(!n||!n.length)return null;for(let e=0;e<n.length;e++){if("InstanceRep"===n[e].productType)return"VCXComponentMesh"}if(n[0]&&n[0].children&&n[0].children[0]&&"InstanceRep"===n[0].children[0].productType)return"VCXComponentMesh";t="VCXComponentOccurrenceComposer"}else console.log("Unknown DS type");return t}};this._experienceBase.BuildComponentsFromNodeEXT(a,o,s,c)}for(var l=new i(this._experienceBase),p=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),C=0;C<p.length;C++){var u=p[C];if(u){var d=u.QueryInterface("VCXIModifiable");d&&l.ChangeProperty(d,"Actor.Name",d.GetProperty("Actor.Name").GetPropertyValue())}}this._experienceBase.getManager("VCXCommandManager").Do(l),t.publish({event:"VCX_ASSETS_ADDED",data:e})},on3dxmlLoaded:async function(e,n){if(e._experienceBase.getManager("VCXPaperManager").updatePaper({x:1896,y:798}),e._numOfAsset--,0===e._numOfAsset){if(delete this._experienceBase._mapAssetsBlob,e._bIsCADLoading){if(e.BuildComponentsFromAssets(e._arrayAssets),0===e._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec").length){var a=e._experienceBase.Factory.BuildComponent("CXPCameraActor_Spec");a.SetID("CameraActorId"),e._experienceBase.ComponentsMap.AddComponent(a)}if(0===e._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec").length){var o=e._experienceBase.Factory.BuildComponent("VCXViewport_Spec");o.SetID("ViewportActorId"),e._experienceBase.ComponentsMap.AddComponent(o)}if(0===e._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec").length&&e._experienceBase.getManager("VCXContextManager").isSupported("PartList")){var s=e._experienceBase.Factory.BuildComponent("VCXPartList_Spec");s.SetID("PartListID"),s.SetPersistency(1),e._experienceBase.ComponentsMap.AddComponent(s)}if(0===e._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentGround").length){var c=e._experienceBase.Factory.BuildComponent("VCXComponentGround");c&&(c.SetID("GroundActorId"),e._experienceBase.ComponentsMap.AddComponent(c))}if(0===e._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0).length){var l=e._experienceBase.Factory.BuildComponent("VCXScenarioSequence");l.SetName("Sequence 1");var p=l.QueryInterface("VCXIModifiable"),C=new i(e._experienceBase);C.CaptureNeutralProperties(p),e._experienceBase.getManager("VCXCommandManager").Do(C);var u=new r(e._experienceBase);u.PushSequence(l),e._experienceBase.getManager("VCXCommandManager").Do(u)}e._experienceBase.getManager("VCXExperience").EndLoadingDressups(),e._experienceBase.getManager("VCXGUIManager").RefreshGUI(),e._experienceBase.getManager("VCXGUIManager").setUpTrees(),t.publish({event:"VCX_END_LOADING_DONE"})}else{for(var d=e._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),g=0;g<d.length;g++){var h=d[g];h&&h.SetIsMesh(!0)}await e.EndLoadJSON()}return e._options=null,e._experienceBase=null,e._factory=null,e._scenarioManager=null,e._ComponentsMap=null,e._arrayAssets=null,"3dxml"}e._options=null,e._experienceBase=null,e._factory=null,e._scenarioManager=null,e._ComponentsMap=null,e._arrayAssets=null},LoadJSON:async function(e){return e&&console.error("CB deprecated"),new Promise(((e,t)=>{var n=new FileReader;n.onload=()=>{this.filevarJson=JSON.parse(n.result);var t=this._experienceBase.getManager("VCXScenarioManager");t.SetCurrentFrame(0),t.SetDefaultInterpolator("Actor.Hyperlink",0),t.SetDefaultInterpolator("Collab.Image.Doc.ID",0),this.LoadComponents(this.filevarJson.VCXObjects).then((async()=>{this.LoadVCXIModelNavigable(this.filevarJson.VCXIModelNavigable),this.LoadMetaPropertiesDef(this.filevarJson.MetaPropertiesDef),this.LoadPropertiesLinks(this.filevarJson.PropertiesLinks),this.LoadNeutrals(this.filevarJson.neutrals),await this.ResolveProductAssetsHolder(this.filevarJson.VCXAssetsHolder),e()}))},n.readAsText(this._options.jsonFile)}))},LoadComponents:function(e,t){var n=[];if(this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration()){if(e)for(var r=0;r<e.length;r++){var a=e[r].objectID,i=e[r].objectType,o=this._factory.BuildComponent(i);if(o){o.SetID(a),this._ComponentsMap.AddComponent(o);var s=e[r].objectData;s&&o.SetLoadData(s)}else n.push({objectType:i,objectID:a})}return this.BuilComponentsAsync(n)}return this._parent(e),UWA.Promise.resolve()},BuilComponentsAsync:function(e){for(var t=this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel(),n=[],r=0;r<e.length;r++){var a=e[r],i=a.objectType,o=a.objectID;n.push(t.getFactory().BuildComponent(i,o))}return UWA.Promise.all(n)},ResolveProductAssetsHolder:async function(e){var t=[];if(e){this._experienceBase.getManager("VCXContextManager").getRootNode();for(var n=0;n<e.length;n++){var r=e[n].objectID,a=this._reformatObjectIDForPathOfId(r),i=this._ComponentsMap.GetComponentFromID(a);if(i&&(i.IsKindOf("Model_VPMReference_Spec")||i.IsKindOf("VCXComponentVPMReference"))){i.QueryInterface("W3AISGNodeHolder").getSGNode();var o=e[n].linkDescription;i.QueryInterface("CATI3DXAssetHolder").setLinkDescription(o),o&&t.push(this._experienceBase.getManager("VCXCAT3DXModelManager").LoadProduct(i))}}}await UWA.Promise.all(t)},EndLoadJSON:async function(e){e&&console.error("CB deprecated");this._experienceBase.getManager("VCXContextManager").getMainViewer().getRootNode();if(this.LoadW3AISGNodeHolder(this.filevarJson.W3AISGNodeHolder),this.LoadScenarios(this.filevarJson.listScenarios),this.filevarJson.DocManager){var n=this.filevarJson.DocManager.array;if(n&&0!==n.length)for(var r=0;r<n.length;r++){var i=n[r],s=i.type,c=i.value,l=i.docID,p=this.BuildVCXPropertyValue(s,c);null!==p&&this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(p,void 0,l,!1)}}var C=this.filevarJson.EmbeddedData;if(C&&0!==C.length)for(var u in C)if(C.hasOwnProperty(u)){var d=this._experienceBase.getManager("VCXDocManager").GetPropPath(u);if(d){var g=C[u];if(""!==g){var h=a.dataURLToBlob(g),m=window.URL.createObjectURL(h);console.log(u+":"+m),d.GetValueURL().SetValue(m)}}else console.log("unable to get propPath of "+u)}var f=this.filevarJson.ScenarioSequences;this.LoadScenarioSequences(f);var V=this._experienceBase.getManager("VCXContextManager");if(V.getContextFromName("ProdHighMode")&&V.getCat3DXIntegration())return this._experienceBase.getManager("VCXCAT3DXModelManager").OnEndLoading(!1);if(0===this._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec").length){var M=this._experienceBase.Factory.BuildComponent("CXPCameraActor_Spec");M.SetID("CameraActorId"),this._experienceBase.ComponentsMap.AddComponent(M)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec").length){var _=this._experienceBase.Factory.BuildComponent("VCXViewport_Spec");_.SetID("ViewportActorId"),this._experienceBase.ComponentsMap.AddComponent(_)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec").length&&this._experienceBase.getManager("VCXContextManager").isSupported("PartList")){var S=this._experienceBase.Factory.BuildComponent("VCXPartList_Spec");S.SetID("PartListID"),S.SetPersistency(1),this._experienceBase.ComponentsMap.AddComponent(S)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentGround").length){var X=this._experienceBase.Factory.BuildComponent("VCXComponentGround");X&&(X.SetID("GroundActorId"),this._experienceBase.ComponentsMap.AddComponent(X))}this._experienceBase.getManager("VCXExperience").EndLoadingDressups(),this._experienceBase.getManager("VCXGUIManager").RefreshGUI(),this._experienceBase.getManager("VCXGUIManager").setUpTrees();var D;D=(f=this._experienceBase.getManager("VCXSequenceManager").GetListSequences())[0].GetListScenariosId()[0];var b=new o(this._experienceBase);b.GoToScenario(D),this._experienceBase.getManager("VCXCommandManager").Do(b),this._experienceBase.getManager("VCXScenarioManager").SetAutoKey(!0),t.publish({event:"VCX_END_LOADING_DONE"})}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebComposer/Model_VPMReference_Spec",["require","exports","DS/VCXWeb3DMaster/VCXComponentOccurrenceComposer"],(function(e,t,n){"use strict";n=__importDefault(n);class r extends n.default{CallDispose(){let e=window.widget&&window.widget.enopadViewer&&window.widget.enopadViewer.getController();e&&e&&e.removeRoots({pids:[this._pid]},!0,!0),super.CallDispose()}}return Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"Model_VPMReference_Spec"}}),r})),define("DS/VCXWebComposer/VCXILoadHelper",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("DS/VCXWebComposer/CATE3DExperienceObjectNavigable",["UWA/Core","DS/CAT3DExpModel/extensions/CATE3DExperienceObject","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject"],(function(e,t,n){"use strict";return t.extend({_dispatchVariableEvent:function(e,t){this._parent(e,t)},_SetChildrenNavigable:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this._SetNavigable(e[t]);else e&&e.QueryInterface&&this._SetNavigable(e)},_SetNavigable:function(e){var t=this.QueryInterface("VCXIModelNavigable"),n=e.QueryInterface("VCXIModelNavigable");n&&!n.isSelfOrganized()&&n.getParent()!==t&&n.setParent(this.QueryInterface("VCXIModelNavigable"))}})})),define("DS/VCXWebComposer/VCXASensible",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(){},_getMeshesFromPathElement:function(e){var t=e.getLastElement(!0),n=[];if(t.excludeFromCSO)n.push(t);else{t.traverse((e=>(e.excludeFromCSO&&n.push(e),!1)),!1)}return n},_setOrGetXSOAble:function(e,t,n){if("boolean"==typeof e)if("CSO"===t||"HSO"===t||"PSO"===t)if(e&&"boolean"!=typeof n)console.warn("A boolean is required as third argument for this method when first is defined as 'set'.");else{var r=this.GetObject().QueryInterface("W3AISGNodeHolder");if(r){for(var a=r.getPathElement(),i=this._getMeshesFromPathElement(a),o=null,s=0;s<i.length;++s){var c=i[s];if(e)"CSO"===t?c.excludeFromCSO(!n):"HSO"===t?c.excludeFromHSO(!n):c.excludeFromPSO(!n);else{var l=!("CSO"===t?c._excludeFromCSO:"HSO"===t?c._excludeFromHSO:c._excludeFromPSO);if(null===(o="boolean"!=typeof o?l:o===l?o:null))break}}return e?void 0:o}console.warn("Object do not possess a nodeHolder interface")}else console.log("Second argument should be one of the following : CSO | HSO | PSO");else console.log("First argument should be a boolean")},_setXSOAble:function(e,t){this._setOrGetXSOAble(!0,e,t)},_getXSOAble:function(e){return this._setOrGetXSOAble(!1,e)},setSelectable:function(e){this._setXSOAble("CSO",e)},setHighlightable:function(e){this._setXSOAble("HSO",e)},setPreHighlightable:function(e){this._setXSOAble("PSO",e)},getSelectable:function(){return this._getXSOAble("CSO")},getHighlightable:function(){return this._getXSOAble("HSO")},getPreHighlightable:function(){return this._getXSOAble("PSO")}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebComposer/VCXDressupGrpsDescription",["require","exports","i18n!DS/VCXWebComposer/assets/nls/VCXWebComposer"],(function(e,t,n){"use strict";n=__importDefault(n);return class{static GetDescription(e){return[{name:"Annotations",nlsName:n.default["TreeNode.Annotations"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_LabelLeaf.png"},order:10,allowEmpty:!0},{name:"Callouts",nlsName:n.default["TreeNode.Callouts"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_CalloutLeaf.png"},order:20,allowEmpty:!0},{name:"Grids",nlsName:n.default["TreeNode.Grids"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Grids.png"},order:30,allowEmpty:!0},{name:"AssociativePaths",nlsName:n.default["TreeNode.AssociativePaths"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Associative_Path.png"},order:40,allowEmpty:!0},...e.isSupported("CameraDisplay")?[{name:"Cameras",nlsName:n.default["TreeNode.Cameras"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Camera.png"},order:45,allowEmpty:!0}]:[],{name:"Sections",nlsName:n.default["TreeNode.Sections"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_SectionLeaf.png"},order:50,allowEmpty:!0},{name:"Diggers",nlsName:n.default["TreeNode.Diggers"],icon:{moduleName:"VCXWebDigger",fileName:"I_VCX_Panel_Tree_Digger.png"},order:60,allowEmpty:!0},{name:"Markups",nlsName:n.default["TreeNode.Markups"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Markup.png"},order:70,allowEmpty:!0},{name:"Measurements",nlsName:n.default["TreeNode.Measurements"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Measurements.png"},order:80,allowEmpty:!0},{name:"Hotspots",nlsName:n.default["TreeNode.Hotspots"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Hotspot.png"},order:90,allowEmpty:!0},{name:"Panels",nlsName:n.default["TreeNode.Panels"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Image2DLeaf.png"},order:100,allowEmpty:!0},{name:"MagnetLine",nlsName:n.default["TreeNode.MagnetLine"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_MagnetLines.png"},order:110,allowEmpty:!0},...e.isSupported("PartList")?[{name:"PartList",nlsName:n.default["TreeNode.PartList"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_PartListLeaf.png"},order:120,allowEmpty:!0}]:[],...e.isSupported("Paths")?[{name:"Paths",nlsName:n.default["TreeNode.Paths"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Paths.png"},order:130,allowEmpty:!0}]:[],...e.isSupported("EnvironmentDisplay")?[{name:"Environment",nlsName:n.default["TreeNode.Environment"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Environment.png"},order:140,allowEmpty:!0}]:[],...e.isSupported("ViewpointCamera")?[{name:"ViewpointCamera",nlsName:n.default["TreeNode.ViewpointCamera"],icon:{moduleName:"VCXWebDressup",fileName:"I_VCX_Panel_Tree_Camera.png"},order:150,allowEmpty:!0}]:[]]}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebComposer/VCXALoadHelper",["require","exports","DS/VCXWebComponents/WebExtensionBaseExperience"],(function(e,t,n){"use strict";n=__importDefault(n);class r extends n.default{GetType(){return"VCXALoadHelper"}async BulkOverrides(e){}getPathElement(e){return null}async AddProductAndUpdate(e,t){var n=e.QueryInterface("W3AISGNodeHolder");await n.buildSGNode()}async RemoveProduct(e){}}return r})),define("DS/VCXWebComposer/VCXWebDictionary",[],(function(){"use strict";var e={VCXCAT3DXModelManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXILoadHelper:"DS/VCXWebComposer/VCXALoadHelper",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXExperience:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXActorDocManager:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableActorDocManager"},VCXComponentAssetOccurrenceComposer:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableAssetOccurrenceComposer",VCXIModifiableView:"DS/VCXWeb3DMaster/VCXModifiableViewOccurrenceComposer",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",VCXIModelNavigable:"DS/VCXWeb3DMaster/VCXNavigableAssetOccurrenceComposer",W3AISGNodeHolder:"DS/VCXWeb3DMaster/VCXSGNodeHolderAssetOccurrenceComposer"},VCXComponentOccurrenceComposer:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableOccurrenceComposer",VCXIPrepareRenderToTexture:"DS/VCXWebVisualization/VCXOccurrenceComposerPrepareRenderToTexture",VCXIModifiableView:"DS/VCXWeb3DMaster/VCXModifiableViewOccurrenceComposer",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXComponentMarker:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableMarker",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView"},VCXComponentHotspot:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableHotspot",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList"},VCXSelectionSet_Spec:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionSet",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeSelectionSet",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXGroupSelectionSet_Spec:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionSet",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeGroupSelectionSet",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXComponentGroupHotspot:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableGroupActorList",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXImageManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXGUIManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebGUI/VCXModifiableGUIManager",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXGUIManager0:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebGUI/VCXModifiableGUIManager",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXGUIManager1:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebGUI/VCXModifiableGUIManager",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXNotificationManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXSelectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionManager"},VCXSelectManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXWebSelectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMultiUserInputManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMaterialManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXPaperManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXManipulatorManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXHyperlinkManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXStylesManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView",VCXIModifiable:"DS/VCXWebStyles/VCXModifiableStylesManager"},VCXComponentStyle:{VCXIModifiable:"DS/VCXWebStyles/VCXModifiableStyle",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeStyle"},VCXVisuManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXDragDropManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXRobotAdapter:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXVolatileGhostingManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXPulseManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXAPIManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMarkerManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXHotspotManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXSelectionSetManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXDRMManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebKernel/VCXModifiableDRMManager",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView"},VCXAnalyticsTrackerAppManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXUserInputControllerManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXCommandControllerManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"}},t={W3AIManager:"DS/WebApplicationBase/W3AIManager",VCXITreeNode:"DS/VCXWebTreeGUI/VCXITreeNode",VCXISensible:"DS/VCXWebComposer/VCXISensible",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXIPulseBehavior",VCXIVisibility:"DS/VCXWebVisibility/VCXIVisibility",VCXIViewpointController:"DS/VCXWebVisualization/VCXIViewpointController",VCXISelectBehavior:"DS/VCXWebComposer/VCXISelectBehavior",VCXIContextualContent:"DS/VCXWebKernel/VCXIContextualContent",VCXIModifiableFormatPainter:"DS/VCXWebModifiables/VCXIModifiableFormatPainter",VCXIReadiness:"DS/WebApplicationBase/VCXIReadiness",VCXILoadHelper:"DS/VCXWebComposer/VCXILoadHelper",VCXICuttableObject:"DS/VCXWebKernel/VCXICuttableObject"},n={VCXActorDocManager:"DS/VCXWebKernel/VCXActorDocManager",VCXVolatileComponentOccurrenceComposer:"DS/VCXWebEWS/VCXVolatileComponentOccurrenceComposer",VCXComponentOccurrenceComposer:"DS/VCXWeb3DMaster/VCXComponentOccurrenceComposer",VCXComponentAssetOccurrenceComposer:"DS/VCXWeb3DMaster/VCXComponentAssetOccurrenceComposer",VCXComponentMarker:"DS/VCXWebKernel/VCXComponentMarker",VCXComponentHotspot:"DS/VCXWebKernel/VCXComponentHotspot",VCXSelectionSet_Spec:"DS/VCXWebKernel/VCXSelectionSet_Spec",VCXComponentSelectionSet:"DS/VCXWebKernel/VCXSelectionSet_Spec",VCXComponentGroupHotspot:"DS/VCXWebKernel/VCXComponentGroupHotspot",VCXGroupSelectionSet_Spec:"DS/VCXWebKernel/VCXGroupSelectionSet_Spec",VCXComponentGroupSelectionSet:"DS/VCXWebKernel/VCXGroupSelectionSet_Spec",VCXExperience:"DS/VCXWebComposer/VCXExperience",VCXImageManager:"DS/VCXWebVisualization/VCXImageManager",VCXPaperManager:"DS/VCXWebVisualization/VCXPaperManager",VCXManipulatorManager:"DS/VCXWebVisualization/VCXManipulatorManager",VCXHyperlinkManager:"DS/VCXWebComposer/VCXHyperlinkManager",VCXHyperlinkManagerBase:"DS/VCXWebDocManager/VCXHyperlinkManagerBase",VCXStylesManager:"DS/VCXWebStyles/VCXStylesManager",VCXComponentStyle:"DS/VCXWebStyles/VCXComponentStyle",VCXSelectionManager:"DS/VCXWebKernel/VCXSelectionManager",VCXSelectManager:"DS/VCXWebKernel/VCXSelectManager",VCXWebSelectionManager:"DS/VCXWebKernel/VCXWebSelectionManager",VCXMultiUserInputManager:"DS/VCXWebKernel/VCXMultiUserInputManager",VCXMaterialManager:"DS/VCXWebVisualization/VCXMaterialManager",VCXAnalyticsTrackerAppManager:"DS/VCXWebKernelTools/VCXAnalyticsTrackerAppManager",VCXVisuManager:"DS/VCXWebVisualization/VCXVisuManager",VCXDragDropManager:"DS/VCXWebDragDrop/VCXDragDropManager",VCXRobotAdapter:"DS/VCXWebVisualization/VCXRobotAdapter",VCXVolatileGhostingManager:"DS/VCXWebVolatileGhosting/VCXVolatileGhostingManager",VCXPulseManager:"DS/VCXWebPulseManager/VCXPulseManager",VCXHotspotManager:"DS/VCXWebComposer/VCXHotspotManager",VCXSelectionSetManager:"DS/VCXWebComposer/VCXSelectionSetManager",VCXAPIManager:"DS/VCXWebKernel/VCXAPIManager",VCXDRMManager:"DS/VCXWebKernel/VCXDRMManager",VCXNotificationManager:"DS/VCXWebKernel/VCXNotificationManager",VCXMarkerManager:"DS/VCXWebKernel/VCXMarkerManager",VCXUserInputControllerManager:"DS/VCXWebComposer/VCXUserInputControllerManager",VCXGUIManager:"DS/VCXWebGUI/VCXGUIManager",VCXGUIManager0:"DS/VCXWebGUI/VCXGUIManager0",VCXGUIManager1:"DS/VCXWebGUI/VCXGUIManager1",VCXCAT3DXModelManager:"DS/VCXWebComposer/VCXCAT3DXModelManager",VCXCommandControllerManager:"DS/VCXWebComposer/VCXCommandControllerManager"};return{GetDictionary:function(){return{interfaces:t,components:n,extensions:e}}}})),define("DS/VCXWebComposer/VCXASelectBehavior",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(){this._selectMode=0},GetSelectMode:function(){return this._selectMode},SetSelectMode:function(e){this._selectMode=e},GetListForSelection:function(){var e=[],t=this.GetObject();if(0===this._selectMode)e.push(t);else if(null!==this._selectMode&&void 0!==this._selectMode){var n=t.QueryInterface("VCXIModelNavigable");if(n)for(var r=n.getChildren(),a=0;a<r.length;a++){var i=r[a];if(i){var o=i.GetObject();e.push(o)}}1===this._selectMode||2===this._selectMode&&e.push(t)}return e}})})),define("DS/VCXWebComposer/VCXRenderedLifecycleExperienceHelper",["require","exports","DS/VCXWebIO/VCXRenderedEventHelper"],(function(e,t,n){"use strict";return class extends n{constructor(e,t){super(e),this.experienceBase=t}unInitialize(){super.unInitialize(),this.experienceBase=null}generateRenderedObject(){const e=super.generateRenderedObject();let t=[];for(let r in e){const a={name:e[r].start?e[r].start.name:"",id:r,ts:e[r].start?e[r].start.ts:Date.now(),cat:this._projectName,ph:e[r].start?e[r].start.type===n.EEventType.START?"b":"e":"",pid:0,tid:0},i={name:e[r].end?e[r].end.name:"",id:r,ts:e[r].end?e[r].end.ts:Date.now(),cat:this._projectName,ph:e[r].end?e[r].end.type===n.EEventType.END?"e":"b":"",pid:0,tid:0};t.push(a),t.push(i)}return t}}})),define("DS/VCXWebComposer/VCXWebActorListManager",["DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertyValueLink","UWA/Class"],(function(e,t,n){"use strict";var r=n.extend({initialize:function(){},postInitialize:function(){},unInitialize:function(){},disposeComponentsActorListFromType:function(e){for(var t=this._experienceBase.ComponentsMap.GetComponentFromType(e),n=0;n<t.length;++n){var r=t[n];r&&r.CallDispose()}},associateComponentAndActorListToMapCache:function(e,t){var n=e.GetID(),r=this.getComponentsActorListMapCache();if(r){r[n]||(r[n]={});var a=t.GetID();r[n][a]||(r[n][a]=t)}},dissociateComponentAndActorListFromMapCache:function(e,t){var n=e.GetID(),r=this.getComponentsActorListMapCache();if(r&&r[n])if(t){var a=t.GetID();r[n][a]&&(delete r[n][a],0===Object.keys(r[n]).length&&delete r[n])}else delete r[n]},addActorsListToComponentActorList:function(n,r){for(var a="",i=(r.GetID(),r.QueryInterface("VCXIModifiable")),o=i.GetProperty("Actor.ListActors"),s=o.GetPropertyValue().GetValue(),c=[],l=0;l<s.length;++l){var p=s[l];c.push(p.Value)}for(var C=[],u=0;u<n.length;++u){a=n[u].GetID();c.indexOf(a)<0&&C.push(a)}if(C.length>0){for(var d=0;d<C.length;++d){a=C[d];var g=new t;g.SetValue(a),s.push(g),this.associateComponentAndActorListToMapCache(a,hotspotID)}var h=o.Clone();h.GetPropertyValue().SetValue(s);var m=this._experienceBase.getManager("VCXCommandManager"),f=new e(this._experienceBase);return f.ChangeProperty(i,h),m.Push(f),!0}return!1},removeActorsListFromComponentActorList:function(t,n){n.GetID();for(var r=n.QueryInterface("VCXIModifiable"),a=r.GetProperty("Actor.ListActors"),i=a.GetPropertyValue().GetValue(),o=[],s=0;s<i.length;++s){var c=i[s];o.push(c.Value)}for(var l=0,p=0;p<t.length;++p){var C=t[p],u=C.GetID(),d=o.indexOf(u);-1!==d&&(i[d]=null,this.dissociateComponentAndActorListFromMapCache(C,n),++l)}if(l>0){var g=i.filter((function(e){return null!==e})),h=a.Clone();h.GetPropertyValue().SetValue(g);var m=this._experienceBase.getManager("VCXCommandManager"),f=new e(this._experienceBase);return f.ChangeProperty(r,h),m.Push(f),!0}return!1},removeActorsListFromAllComponentsActorListOfAKind:function(e,t){for(var n=[],r=(this.getComponentsActorListMapCache(),this._experienceBase.ComponentsMap.GetComponentFromType(t)),a=0;a<r.length;++a){var i=r[a];this.removeActorsListFromComponentActorList(e,i)&&n.push(i)}return n},isComponentBelongingToMapCache:function(e){var t=this.getComponentsActorListMapCache();if(t)return!!t[e.GetID()]},getListOfComponentActorListOwningComponent:function(e){var t=[],n=this.getComponentsActorListMapCache();if(n){var r=e.GetID();if(n[r])for(var a=Object.keys(n[r]);0<a;++a){var i=a[0];n[r][i]&&t.push(n[r][i])}return t}}});return Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXWebActorListManager"}}),r})),define("DS/VCXWebComposer/VCXUIHyperlink",["UWA/Class","DS/VisuEvents/EventsManager","UWA/Controls/Lightbox","DS/UIBehaviors/ContextualMenuManager","DS/VCXWebIO/VCXFileWriter","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebIO/VCXPixelImage"],(function(e,t,n,r,a,i,o,s){"use strict";return e.extend({init:function(e){this._experienceBase=e,this._vcxGuiManager=e.getManager("VCXGUIManager"),this._cursorStyle=document.body.style.cursor,this.onVisuEventMouse=this.onVisuEvent.bind(this)},setActive:function(e){this.UnsubscribeEvent(),e&&this.SubscribeEvent()},onVisuEvent:function(e){var t=this._experienceBase.getManager("VCXHyperlinkManager");if(t&&t.GetActiveInteraction()){for(var n=!1,r=t.GetSortedInteractableObjects(),a=0;a<r.length;a++){var s=this._experienceBase.ComponentsMap.GetComponentFromID(r[a]).QueryInterface("VCXIModifiable"),c=o.getDisplayPriority(s);if(c<-7)break;if(c<=6||c>=10){n=!0;break}if(o.isModifiableUnderMouse(s,e))return void this.onChangeMouseStyle(s)}if(n)if(s=i.GetModifiableFromEvent(e,this._experienceBase))return void this.onChangeMouseStyle(s)}this.onChangeMouseStyle(null)},SubscribeEvent:function(){var e=this._experienceBase.getManager("VCXContextManager").getMainViewer().div;t.addEvent(e,"onPrimaryPointerMoveUnique",this.onVisuEventMouse)},UnsubscribeEvent:function(){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer();e&&t.removeEvent(e.div,"onPrimaryPointerMoveUnique",this.onVisuEventMouse)},onChangeMouseStyle:function(e){var t=!1;if(e){var n=null,r=e.GetObject().GetID(),a=null;if(this._experienceBase.getManager("VCXHotspotManager")&&(a=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(r,!0)),a){n=a.QueryInterface("VCXIModifiable").GetProperty("Actor.Hyperlink").GetPropertyValue().GetValue()}else{var i=e.GetProperty("Actor.Hyperlink").GetPropertyValue().GetValue();n=parseInt(i,10)}n>=0&&(t=!0)}let o=this._vcxGuiManager.GetCursor();t?""===o&&this._vcxGuiManager.SetCursor("pointer"):""!==o&&this._vcxGuiManager.SetCursor("")},CreateMediaDiv:function(e,t){var n=this;VCXFileServices.BlobURLToBase64(e,t,(function(r){r.indexOf("data:image")>-1?("img",n.OpenImage(e,t)):r.indexOf("data:application/octet-stream")>-1?a.saveAs(r,t):window.open(e,"Download")}))},OpenImage:function(e,t){var n=this;const a=new s;a.loadFrom(e,(function(){size={height:a.getPixelHeight(),width:a.getPixelWidth()};var i=n.CreateDiv(e,t,size);i.styles.width=size.width,i.styles.height=size.height,n._myMedia=UWA.createElement("img",{id:i.id,title:i.title,src:i.src,styles:i.styles}),r.onReady({target:n._myMedia,nodes:i.nodes}),n._myMedia.addEventListener("click",(function(e){e.stopPropagation&&e.stopPropagation()})),n._lightbox.addContent(n._myMedia)}))},CreateDiv:function(e,t,r){var a=this._vcxGuiManager._uiLayer;this._lightbox=new n,this._lightbox.inject(a),this._lightbox.getInnerElement().style.zIndex="15",this._lightbox.open();var i=this;return{id:"myMedia",title:"Click right to save",src:e,styles:{position:"absolute",left:"50%",bottom:"50%",color:"#888888",width:r.width+"px",height:r.height+"px",marginLeft:-.5*r.width+"px",marginBottom:-.5*r.height+"px",zIndex:"15"},nodes:[{label:"Save  as...",callback:function(){i.LaunchContextMenu(0,e,t)}},{label:"Open  in new tab...",callback:function(){i.LaunchContextMenu(1,e,t)}}]}},LaunchContextMenu:function(e,t,n){0===e?a.saveAs(t,n):1===e&&window.open(t)}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebComposer/VCXRefInstNodeIndex",["require","exports","DS/Visualization/IdPath","DS/TreeModel/TreeNodeModel","DS/VCXWebSystem/VCXMathTools","DS/VCXWebVisibility/VCXIVisibility"],(function(e,t,n,r,a,i){"use strict";a=__importDefault(a),i=__importDefault(i);return class{constructor(e,t){this.hidden=!1,this.parent=null,this.instances=null,this._sizes=null,this.reference=null,this._3DViewerCtrl=void 0,this.materialApplication=null,this.appliedMaterial=null,this.product=e,this.id=t.resourceid,this.type=t["ds6w:type"],this.globalType=t["ds6w:globalType"],this.hidden="FALSE"===t["ro.PGPShowExtension.V_PGP_Show"]||"FALSE"===t["bo.PGPShowExtension.V_PGP_Show"],this.data=t}setParent(e){this.parent=e}setInstance(e,t){this.instances||(this.instances={}),this.instances[e]=t,t.setParent(this)}setReference(e){this.reference=e,e.setParent(this)}getSizes(){if(!this._sizes){this._sizes=[];const e=e=>{e&&e.forEach(((e,t)=>{this._sizes&&!this._sizes[t]&&(this._sizes[t]=0),this._sizes&&(this._sizes[t]+=e)}))},t=this.getData("files");if(t&&t.forEach(((e,t)=>{this._sizes&&(this._sizes[t]=e.size)})),this.reference&&e(this.reference.getSizes()),this.instances)for(const t in this.instances)e(this.instances[t].getSizes())}return this._sizes}getPathOfIDs(){return this.parent?[...this.parent.getPathOfIDs(),this.id]:[this.id]}getPathOfInstances(){return this.parent?"VPMInstance"===this.type?[...this.parent.getPathOfInstances(),this.id]:this.parent.getPathOfInstances():"VPMInstance"===this.type?[this.id]:[]}getTreeNodeModel(e){const t=new r({label:this.getData("ds6w:label"),grid:{tree:this.getData("ds6w:label"),pid:this.id,type:this.type,id:!this.reference&&this.component?this.component.GetID():"",local:!this.reference&&this.component?this.component.GetPersistency():2,materialApplication:this.materialApplication?.material,appliedMaterial:this.appliedMaterial?.material,fileSize:this.getSizes()&&a.default.formatFileSize(this.getSizes()[0])}});if(this.instances)for(const n in this.instances){const r=this.instances[n].getTreeNodeModel(e);t.addChild(r);let a=this.instances[n].reference?.getTreeNodeModel(e);a&&r.addChild(a)}return t}getData(e){return this.data[e]}isMesh(){return!!this.get3DShape()&&this.instances&&1===Object.keys(this.instances).length}isReference(){return!this.reference}get3DShape(){if(this.instances)for(const e in this.instances)if(this.instances&&"VPMRepInstance"===this.instances[e].type)return this.instances[e]?.reference}setComponentAttributes(e){if(!e)return;this.component=e,e._refid=this.id,e._pid=this.id,e.SetIsMesh(this.isMesh());e.QueryInterface("W3AISGNodeHolder").setPathOfIDs(new n(this.getPathOfIDs()));const t=this.get3DShape();if(e._thumbURL=t&&(t.mythumbnail2d||t.urlstream||t["2dthb"]),this.hidden||this.parent&&this.parent.hidden){e.QueryInterface("VCXIVisibility")._visible=i.default.EVisState.Hidden}if(this.appliedMaterial){e._MaterialDescription={physicalID:this.appliedMaterial.material,connectedTo:"ref"};let t=e._experienceBase.ComponentsMap.GetComponentFromID("VCXInternalMaterial_Spec_"+this.appliedMaterial.material);t?(t.QueryInterface("VCXIMaterialCache").addComponentFromWhereApplied(e.GetID(),!0),e.originalMaterial=t.GetID()):console.warn("No internal Material ?")}e.refInstNode=this}set component(e){this._component=e}get component(){return this.reference?this.reference.component:(this._component||(this.component=this.product._experienceBase.ComponentsMap.getComponentFromIDPath(this.getPathOfIDs(),!0)),this._component)}isVPMReference(){return"ds6w:Part"===this.globalType}getWorldMatrix(e){if(void 0===this._3DViewerCtrl){const e=window.widget.enopadViewer;this._3DViewerCtrl=e?e&&e.getController():null}if(this._3DViewerCtrl)return this._3DViewerCtrl.getWorldMatrix(this.getPathOfIDs());const t=this.component;return t?t.QueryInterface("W3AISGNodeHolder").getPathElement().getWorldMatrix(e):void 0}traverse(e){if(e&&(e({node:this}),this.reference&&this.reference.traverse(e),this.instances))for(const t in this.instances)this.instances[t].traverse(e)}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebComposer/VCXModelNavigableRoot",["require","exports","DS/WebApplicationBase/VCXAModelNavigable"],(function(e,t,n){"use strict";n=__importDefault(n);class r extends n.default{getWorkingRoot(){return this}}return r})),define("DS/VCXWebComposer/VCXNodeHolderAssetOccurrenceComposer",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/Node3D"],(function(e,t){"use strict";return e.extend({init:function(){},getPathElement:function(){if(!this._pathElement){const e=this.GetObject()._experienceBase.getManager("VCXContextManager"),t=widget.enopadViewer,n=t&&t.getController();return e&&e.isEnopadLoaderUsed()&&this.GetObject().productIndex?n.buildPathFromArray([this.GetObject().productIndex.productID],!0):this._parent()}return this._pathElement},setPathOfIDs:function(e){this._parent(e),this.GetObject()._experienceBase.ComponentsMap.addToHashTree(this.GetObject())},buildSGNode:function(){if(!this._sgNode){this._sgNode=new t({name:"LoadedAsset"}),this._sgNode.productType="Instance3D"}var e=this.QueryInterface("VCXIModelNavigable");if(e){var n=e.getParent();if(n){var r=n.QueryInterface("W3AISGNodeHolder");r&&(r.getSGNode().addChild(this._sgNode),this._pathElement=r.getPathElement().clone(),this._pathElement.addElement(this._sgNode))}}return this._sgNode},isSelfManagedPathElement:function(){return!0}})})),define("DS/VCXWebComposer/VCXSelectionSetManager",["DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebActorListManager"],(function(e,t){"use strict";var n=t.extend({initialize:function(){this._mapCacheComponentSelectionSet=null,this.isAuthoring=!1,this.selectionsSet=null},postInitialize:function(){this._mapCacheComponentSelectionSet={},this._eventTokens||(this._eventTokens={})},unInitialize:function(){for(var t in this._eventTokens)this._eventTokens.hasOwnProperty(t)&&this._eventTokens[t]&&e.unsubscribe(this._eventTokens[t]);for(let e of this.getConcernedComponentActorListType())this.disposeComponentsActorListFromType(e);this._mapCacheComponentSelectionSet=null,this.selectionsSet=null},getConcernedComponentActorListType:function(){return["VCXComponentSelectionSet","VCXSelectionSet_Spec"]},getComponentsActorListMapCache:function(){return this._mapCacheComponentSelectionSet},addComponentToMapSelectionSet:function(e,t){this.associateComponentAndActorListToMapCache(e,t)},removeComponentFromMapSelectionSet:function(e,t){this.dissociateComponentAndActorListFromMapCache(e,t)},addActorsListToSelectionSet:function(e,t){e.forEach((e=>this.addComponentToMapSelectionSet(e,t)))},removeActorsListFromSelectionSet:function(e,t){this.removeActorsListFromComponentActorList(e,t)},removeActorsListFromAllSelectionSets:function(e){for(let t of this.getConcernedComponentActorListType())this.removeActorsListFromAllComponentsActorListOfAKind(e,t)},isComponentBelongingToASelectionSet:function(e){return this.isComponentBelongingToMapCache(e)},getSelectionSetListFromComponent:function(e){return this.getListOfComponentActorListOwningComponent(e)}});return Object.defineProperty(n.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSelectionSetManager"}}),n})),define("DS/VCXWebComposer/VCXExperienceSaver",["DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/VCXWebIO/VCXFileWriter","DS/VCXWebComposer/VCXBlobDumper","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebIO/VCXFileServices"],(function(e,t,n,r,a){"use strict";return e.extend({init:function(){this._parent(),this._blobDumper=new n},Save:function(e,t){var n=this;this._blobDumper.ConvertBlobsFromDocManager(e,(function(){n.SaveToJson(e,t)}))},SaveToJson:function(e,n){var i={FileVersion:1};i.VCXObjects=this._ComponentsMapToJson(e),i.W3AISGNodeHolder=this._W3AISGNodeHolderToJson(e),i.VCXIModelNavigable=this._VCXIModelNavigableToJson(e),i.MetaPropertiesDef=this._MetaPropertiesDefToJson(e),i.ScenarioSequences=this._SequencesToJson(e),i.neutrals=this._NeutralsToJson(e),i.listScenarios=this._ScenariosToJson(e),i.DocManager=this._DocManagerToJson(e),i.EmbeddedData=this._EmbeddedDataToJson();var o=JSON.stringify(i,null,4),s="data:text/json;charset=utf8,"+encodeURIComponent(o),c="SaveExperience";if(e&&e.getManager("VCXContextManager")){var l=e.getManager("VCXContextManager").getRootComponentName();if(l)c=l;else{var p=new Date;c+="-",c+=p.getUTCFullYear(),c+=p.getUTCMonth(),c+=p.getUTCDate(),c+=p.getUTCHours(),c+=p.getUTCMinutes(),c+=p.getUTCSeconds()}}e.getManager("VCXContextManager").getContextFromName("ProdHighMode")?c+=".exprd":c+=".json";var C=e.getManager("VCXCAT3DXModelManager");if(C){var u=e.getManager("VCXContextManager").GetApplicationMode();if(C&&2===u)return void r.publish3DSpace(a.dataURLToBlob(s),c).then((function(){console.log("Experience "+c+" Saved"),n&&n()}))}t.saveAs(s,c),n&&n()},_GetStartingScenario:function(e){var t=e.getManager("VCXSequenceManager").GetListSequences();if(0!==t.length)for(var n=t[0].GetListScenariosId(),r=0;r<n.length;r++){var a=n[r];if(0===e.ComponentsMap.GetComponentFromID(a).GetPersistency())return a}else console.log("VCXExperienceSaver: The sequence list is empty !");return""},_SequencesToJson:function(e){for(var t=[],n=e.getManager("VCXSequenceManager").GetListSequences(),r=0;r<n.length;r++){var a=n[r],i={objectID:a.GetID(),listScenarioID:a.GetListScenariosId()};t.push(i)}return t},_ScenariosToJson:function(e){var t=[],n=e.getManager("VCXScenarioManager").GetScenarios();for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];if(0!==a.GetPersistency())continue;var i=this._ScenarioToJson(e,a),o=a.GetVisibility(),s=this._VisibilityToJson(o,e);i.visibility=s,t.push(i)}return t},_DocManagerToJson:function(e){for(var t={},n=[],r=e.getManager("VCXDocManager").NumberOfDoc(),a=0;a<r;a++){var i=e.getManager("VCXDocManager").GetPropPath(a);if(i)if(i.GetValueBool())if(i.GetValueBool().GetValue()){var o=this._PropertyToJson(i,e);n.push({docID:a,type:"VCXPropertyValuePath",value:o})}}e.getManager("VCXDocManager").QueryInterface("VCXIModifiable");return t.array=n,t},_EmbeddedDataToJson:function(){return this._blobDumper.GetMapOfData()},DumpScenario:function(e,n){var r=this._ScenarioToJson(e,n),a=n.GetVisibility(),i={Scenario:r,Visibility:this._VisibilityToJson(a,e)},o=JSON.stringify(i,null,4),s="data:text/json;charset=utf8,"+encodeURIComponent(o);t.saveAs(s,"Scenario.json")},DumpComponentsMapContent:function(e,n){var r=[],a=[],i=[],o=e.ComponentsMap.GetComponentTable();for(var s in o)if(o.hasOwnProperty(s)){var c=o[s],l=c.GetType(),p=c.GetLoadData(),C={};C.objectID=s,C.objectType=l;p=null;var u=c.QueryInterface("W3AISGNodeHolder");if(u){var d=u.getPathElement();p=this._BuildArrayIDsFromPathElement(d)}p&&p.length>0&&(C.objectData=p);var g=c.GetPersistency();0===g?r.push(C):1===g?a.push(C):2===g&&i.push(C)}var h={Persistency0:r,Persistency1:a,Persistency2:i},m=JSON.stringify(h,null,4),f="data:text/json;charset=utf-8,"+encodeURIComponent(m),V="";return V=n?n+".json":"ComponentsMap.json","record"===e.odt||t.saveAs(f,V),{obj:h,url:f,filename:V}},DumpArray:function(e,t,n){var r={MyArray:t};return this.DumpObject(e,r,n)},DumpPropertyMap:function(e,t,n){var r=this._PropMapToJson(e,t);return this.DumpObject(e,r,n)},DumpObject:function(e,n,r){var a={};n.toJSON=function(){var e=Object.keys(this);e.sort();for(var t=0;t<e.length;t++){var n=e[t];"toJSON"!==n&&(a[n]=this[n])}return a};var i=JSON.stringify(n,null,4),o="data:text/json;charset=utf-8,"+encodeURIComponent(i),s="";return s=r?r+".json":"MapObject.json","record"===e.odt||"replay"===e.odt||t.saveAs(o,s),{obj:a,url:o,filename:s}},_DumpPropMapDiff:function(e,t,n){for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];for(var i in a)if(a.hasOwnProperty(i)){var o=a[i].vcxPropertyRef,s=a[i].vcxProperty;e[r][i].vcxPropertyRef=this._PropertyToJson(o.GetPropertyValue(),n),e[r][i].vcxProperty=this._PropertyToJson(s.GetPropertyValue(),n)}}this.DumpObject(e,t)}})})),define("DS/VCXWebComposer/VCXHyperlinkManager",["DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebDocManager/VCXHyperlinkManagerBase","DS/VCXWebComposer/VCXUIHyperlink","DS/VCXWebKernel/VCXCmdGoToMarker","DS/WebRBTree/WebRBIterator"],(function(e,t,n,r,a,i){"use strict";var o=n.extend({initialize:function(){this._parent(),this._strEventToListen="onPrimaryPointerClick",this._tokens={}},postInitialize:function(){this._parent(),this._active=!1,this._vcxUIHyperlink=new r(this._experienceBase),this._tokens={}},unInitialize:function(){this._parent();for(let e of Object.keys(this._tokens))t.unsubscribe(this._tokens[e]);this._vcxUIHyperlink&&(this._vcxUIHyperlink.UnsubscribeEvent(),this._vcxUIHyperlink=null),this._active=!1},setActive:function(e){this._active=e,this._vcxUIHyperlink&&this._vcxUIHyperlink.setActive(e),this._active&&this._experienceBase.getManager("VCXSelectManager").switchOnSensibilityForAllHyperlinks()},isActive:function(){return this._active},ObjectHasHyperlink:function(e){var t=e.QueryInterface("VCXIModifiable"),n=null;return t&&(n=t.GetProperty("Actor.Hyperlink")),!!n&&parseInt(n.GetPropertyValue().GetValue(),10)>=0},OpenHyperlink:function(e,t){if(this._active){var n=null,r=e.GetObject().GetID(),a=null;if(this._experienceBase.getManager("VCXHotspotManager")&&(a=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(r,!0)),a){var i=a.QueryInterface("VCXIModifiable");n=this._getPropertyPathFromModifiable(i)}else n=this._getPropertyPathFromModifiable(e);var o=-1;if(n)o=n.GetPathType().GetValue();if(0===o){var s="",c=n.GetValueURL().GetValue();c.indexOf("blob:")<0&&(s=c.toLowerCase()),s.indexOf("scenario://")>=0?this.OpenScenarioFromOrder(s,t):this.OpenDocument(o,n,t)}else if(1===o){var l=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink());l&&this.OpenScenario(l.GetID(),t)}else if(2===o){(C=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink())).IsKindOf("VCXComponentMarker")?this.GoToMarker(C,!1,!0,t):C.IsKindOf("VCXScenario")&&this.PlayScenario(C,t)}else if(3===o){var p=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink());p&&this.GoToMarker(p,!1,!1,t)}else if(4===o){var C;(C=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink()))&&C.IsKindOf("VCXComponentMarker")?this.GoToMarker(C,!0,!1,t):C&&C.IsKindOf("VCXScenario")&&this.PlayMarkerSequence(C,t)}else console.log("[VCXHyperlinkeManager]: mode not found. Failed launch hyperlink.")}else t&&t()},OpenDocument:function(e,t,n){var r=this._getHyperlinkInfosFromProperty(t),a=r.url,i=r.filename;a.indexOf("blob:")>-1?this._vcxUIHyperlink.CreateMediaDiv(a,i):window.open(a);n&&n(a)},OpenScenarioFromOrder:function(e,t){var n=e.substring(11),r=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),a=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(r);if(a){this._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0);var i="",o=n.toLowerCase();if("previous"===o)i=this._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(r);else if("next"===o)i=this._experienceBase.getManager("VCXSequenceManager").GetNextScenarioId(r);else if("first"===o)i=a.GetListScenariosId()[0];else if("last"===o){var s=a.GetListScenariosId();i=s[s.length-1]}""!==i&&this.OpenScenario(i,t)}else console.log("Sequence not found !")},OpenScenario:function(e,t){this._experienceBase.getManager("VCXExperience").GoToScenarioContext()&&this._experienceBase.getManager("VCXExperience").GoToScenarioWithInterpolation(e,t)},PlayScenario:function(n,r){if(n);else{let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();n=this._experienceBase.ComponentsMap.GetComponentFromID(e)}var a=()=>{n.HasAnimation()&&(e.Selection.PSOManager.empty(),t.publish({event:"VCX_START_PLAY"}),this._experienceBase.getManager("VCXContextManager")&&("0"==this._experienceBase.getManager("VCXContextManager").getUrlVars().boost||n.BuildAnimatedModifiablesSets(this._experienceBase.getManager("VCXScenarioManager")._keyframer)),this._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!0),this._tokens.tokenStopPulse&&(t.unsubscribe(this._tokens.tokenStopPulse),delete this._tokens.tokenStopPulse),this._tokens.tokenStopPulse=t.subscribe({event:"VCX_Timeline_STOP_PLAY"},(()=>{t.unsubscribe(this._tokens.tokenStopPulse),delete this._tokens.tokenStopPulse,n.SetSequenceMaxFrame(null)})),this._tokens.tokenEndPlayScenario&&(t.unsubscribe(this._tokens.tokenEndPlayScenario),delete this._tokens.tokenEndPlayScenario),this._tokens.tokenEndPlayScenario=t.subscribe({event:"VCX_SCENARIO_END_REACHED"},(()=>{t.unsubscribe(this._tokens.tokenEndPlayScenario),delete this._tokens.tokenEndPlayScenario,r&&r()})))},i=()=>{this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()!==n.GetID()?this.OpenScenario(n.GetID(),a):a()};this._active&&this._experienceBase.getManager("VCXPulseManager")?this._experienceBase.getManager("VCXPulseManager").StopPulse(i):i()},PlayMarkerSequence:function(e,t){var n=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),r=this._experienceBase.ComponentsMap.GetComponentFromID(n),a=0;e.IsKindOf("VCXComponentMarker")?a=e.QueryInterface("VCXIModifiable").GetProperty("Actor.TimePos").GetPropertyValue().GetValue():e.IsKindOf("VCXScenario")?r=e:a=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();var o=null,s=r.GetTrackMarkers();if(s)for(var c=s._treekeys,l=new i(c),p=l.next();null!==p;){var C=p.GetFrame();parseInt(C)>a?(o=C,p=null):(p=l.next())}o&&r.SetSequenceMaxFrame(o),this.PlayScenario(r,t)},GoToMarker:function(e,t,n,r){var i=new a(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);i.GoToMarker(e.GetID()),i.SetCallback(r),this._experienceBase.getManager("VCXCommandManager").Push(i),t?this.PlayMarkerSequence(e,r):n&&this.PlayScenario(null,r)}});return Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXHyperlinkManager"}}),o})),define("DS/VCXWebComposer/VCXHotspotManager",["DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebActorListManager","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertyValueVector","DS/VisuEvents/EventsManager","DS/WebRBTree/WebRBIterator"],(function(e,t,n,r,a,i,o,s){"use strict";var c=n.extend({initialize:function(){this._mapHotspotsHLFromTree={},this._mapHotspotsHLFromViewport={},this._mapHotSpotCompIdFromSmgXmlAndRealCompID={},this._mapCacheForPreghlight={}},postInitialize:function(){var e=this;this._eventTokens||(this._eventTokens={}),this._eventTokens._tokenScenarioChanged=t.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},(function(){for(var t in e._mapHotspotsHLFromTree)if(e._mapHotspotsHLFromTree.hasOwnProperty(t)){var n=e._experienceBase.ComponentsMap.GetComponentFromID(t);e.DeactivateAllHotspots(),e.ActivateHotspotFromTree(n)}})),this._eventTokens._tokenPSO=t.subscribe({event:"/VISU/"},(function(t){"@onMoveEvent"===t.eventType&&(t.from?e.onMouseOver(t,e):"@pickNothing"===t.eventID&&e.DeactivateAllHotspots(!0))}))},unInitialize:function(){if(this.DeactivateAllHotspots(),this.DeactivateAllHotspots(!0),this._mapHotspotsHLFromTree={},this._mapHotspotsHLFromViewport={},this._mapHotSpotCompIdFromSmgXmlAndRealCompID={},this._mapCacheForPreghlight={},this._eventTokens){for(var e in this._eventTokens)this._eventTokens.hasOwnProperty(e)&&this._eventTokens[e]&&t.unsubscribe(this._eventTokens[e]);delete this._eventTokens}for(let e of this.getConcernedComponentActorListType())this.disposeComponentsActorListFromType(e)},getConcernedComponentActorListType:function(){return["VCXComponentHotspot"]},getComponentsActorListMapCache:function(){return this._mapCacheForPreghlight},addComponentToMapPrehighlight:function(e,t){var n=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(!n){var r=this._experienceBase.getManager("VCXContextManager");if(r.getContextFromName("OpenSMGXML")){var a=r.getContextFromName("SmgXmlRoot");if(a){var i=a.GetComponentsMap();i.has(e)&&(n=i.get(e)),n&&(this._mapHotSpotCompIdFromSmgXmlAndRealCompID[e]=n.GetID())}}}n&&this.associateComponentAndActorListToMapCache(n,t)},removeComponentFromMapPrehighlight:function(e,t){var n=this._experienceBase.ComponentsMap.GetComponentFromID(e);this.dissociateComponentAndActorListfromMapCache(n,t)},addActorsListToHotspot:function(e,t){},removeActorsListFromHotspot:function(e,t){this.removeActorsListFromComponentActorList(e,t)},removeActorsListFromAllHotspots:function(e){for(let t of this.getConcernedComponentActorListType())this.removeActorsListFromAllComponentsActorListOfAKind(e,t)},getHotspotsListFromComponent:function(e){return this.getListOfComponentActorListOwningComponent(e)},GetEnabledHotspotFromComponentID:function(e,t){var n=null,r=this.getComponentsActorListMapCache()[e];for(var a in r){if(r.hasOwnProperty(a))if((n=this._experienceBase.ComponentsMap.GetComponentFromID(a)).QueryInterface("VCXIModifiable").GetProperty("Actor.Enable").GetPropertyValue().GetValue())return n}if(t){var i=this._experienceBase.ComponentsMap.GetComponentFromID(e).QueryInterface("VCXIModelNavigable").getParent();if(i)return this.GetEnabledHotspotFromComponentID(i.GetObject().GetID(),t)}},onMouseOver:function(t,n){var r=t.from;if(r){const t=this._experienceBase.getManager("VCXSelectManager").GetComponentFromPathElement(r);if(t){var a=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(t.GetID());a?(e.Selection.PSOManager.empty(!0),this._mapHotspotsHLFromViewport[a.GetID()]||(this.DeactivateAllHotspots(!0),this.ActivateHotspotFromViewport(a))):this.DeactivateAllHotspots(!0)}}},onClickEmptySpace:function(e,t){a.GetPathElementFromEvent(e,t._experienceBase)||(t.DeactivateAllHotspots(),t.DeactivateAllHotspots(!0))},ActivateHotspotFromTree:function(e){if(e&&e.IsKindOf("VCXActorList_Spec")){var t=this,n=e.QueryInterface("VCXIModifiable");o.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().div,"onPrimaryPointerClick",(function(e){t.onClickEmptySpace(e,t)}));var a=new r(this._experienceBase);if(a.AddToSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(a),n.GetProperty("Actor.Enable").GetPropertyValue().GetValue())if(this._experienceBase.getManager("VCXSelectionManager").keepHotspotsSelectable){if(!this._mapHotspotsHLFromTree[e.GetID()]){var s=n.GetProperty("Actor.Color").GetPropertyValue(),c=n.GetProperty("Actor.ListActors").GetPropertyValue();if(s&&c){var l=s.GetThreeColor(),p=this.createColorHL(l);this._mapHotspotsHLFromTree[e.GetID()]=p,this.addActorsToColorHL(p,c);var C=new i([p]);n.OnChangeProperty("highlight.color",C)}}}else this._mapHotspotsHLFromTree[e.GetID()]=null;else this._mapHotspotsHLFromTree[e.GetID()]=null}},ActivateHotspotFromViewport:function(e){if(e&&e.IsKindOf("VCXComponentHotspot")){var t=e.QueryInterface("VCXIModifiable");if(t.GetProperty("Actor.Enable").GetPropertyValue().GetValue())if(this._experienceBase.getManager("VCXSelectionManager").keepHotspotsSelectable){var n=t.GetProperty("Actor.Color").GetPropertyValue(),r=t.GetProperty("Actor.ListActors").GetPropertyValue();if(n&&r){var a=n.GetThreeColor(),i=this.createColorHL(a);this.AddToMapViewport(e.GetID(),i),this.addActorsToColorHL(i,r)}}}},createColorHL:function(e){var t=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(t&&e){var n={color:e,outlineColor:e,intensity:.5};return t.createHighlightSet(n,!1,!1,!0)}},addActorsToColorHL:function(e,t){if(e)for(var n=e.getColorHighlight(),r=t.GetValue(),a=0;a<r.length;a++){var i=r[a],o=this._experienceBase.ComponentsMap.GetComponentFromLink(i);if(!o){var s=i.GetValue();if(this._mapHotSpotCompIdFromSmgXmlAndRealCompID.hasOwnProperty(s)){var c=this._mapHotSpotCompIdFromSmgXmlAndRealCompID[s];o=this._experienceBase.ComponentsMap.GetComponentFromID(c)}}var l=o.QueryInterface("W3AISGNodeHolder").getPathElement();e.add(l,{highlightColor:n})}},DeactivateAllHotspots:function(e){if(e){for(var t in this._mapHotspotsHLFromViewport)if(this._mapHotspotsHLFromViewport.hasOwnProperty(t))if(this._mapHotspotsHLFromTree[t]);else{var n=this._experienceBase.ComponentsMap.GetComponentFromID(t);this.DeactivateHotspotFromViewport(n)}}else for(var t in this._mapHotspotsHLFromTree)if(this._mapHotspotsHLFromTree.hasOwnProperty(t)){n=this._experienceBase.ComponentsMap.GetComponentFromID(t);this.DeactivateHotspotFromTree(n)}},DeactivateHotspotFromTree:function(e){if(e){var t=new r(this._experienceBase);t.RemoveFromSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(t);var n=this._mapHotspotsHLFromTree[e.GetID()];n&&(this.removeActorsFromColorHL(n),this._experienceBase.getManager("VCXContextManager").renderAll()),delete this._mapHotspotsHLFromTree[e.GetID()],0===Object.keys(this._mapHotspotsHLFromTree).length&&o.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().div,"onPrimaryPointerClick",this.onVisuEvent)}},DeactivateHotspotFromViewport:function(e){var t=this._mapHotspotsHLFromViewport[e.GetID()];t&&(this.removeActorsFromColorHL(t),this._experienceBase.getManager("VCXContextManager").renderAll()),this.RemoveFromMapViewport(e.GetID())},removeActorsFromColorHL:function(e){e&&e.clearAll()},UpdateHotspotsHyperlinks:function(){for(var e=this._experienceBase.getManager("VCXScenarioManager").GetScenarios(),t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentHotspot"),n=0;n<t.length;n++){var r=t[n].QueryInterface("VCXIModifiable"),a=this._experienceBase.getManager("VCXScenarioManager").GetNeutrals(r.GetHashing()).GetProperty("Actor.Hyperlink");if(a){var i=this._experienceBase.getManager("VCXDocManager").GetPropPath(a.GetPropertyValue().GetValue());if(i)if(1===i.GetPathType().GetValue()){var o=i.GetValueLink().GetValue(),c=this._getScenarioIDFromName(o);i.GetValueLink().SetValue(c)}}for(var c in e)if(e.hasOwnProperty(c)){var l=e[c].GetObjectAnimation(r.GetHashing());if(l){var p=l.GetTrack("Actor.Hyperlink");if(p)for(var C=p._treekeys,u=new s(C),d=u.next();null!==d;){var g=d.GetValue().GetValue(),h=this._experienceBase.getManager("VCXDocManager").GetPropPath(g);if(h)if(1===h.GetPathType().GetValue()){o=h.GetValueLink().GetValue(),c=this._getScenarioIDFromName(o);h.GetValueLink().SetValue(c)}d=u.next()}}}}},_getScenarioIDFromName:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);if(t[e])return e;for(var n in t){if(t.hasOwnProperty(n))if(e===t[n].GetName())return n}},AddToMapViewport:function(e,t){this._mapHotspotsHLFromViewport[e]=t},RemoveFromMapViewport:function(e){delete this._mapHotspotsHLFromViewport[e]}});return Object.defineProperty(c.prototype,"componentType",{enumerable:!0,get:function(){return"VCXHotspotManager"}}),c})),define("DS/VCXWebComposer/VCXGraphicalLifecycleExperienceHelper",["require","exports","DS/VCXWebComposer/VCXRenderedLifecycleExperienceHelper","UWA/Core"],(function(e,t,n,r){"use strict";return class extends n{constructor(e,t){super(e,t);const n=this.experienceBase.getManager("VCXNotificationManager"),a=this.experienceBase.getManager("VCXContextManager");this._notifyEnd=()=>{n&&n.addNotification({level:"info",title:"End Capture Events",message:"Output json file is ready"})};["3ds.com:8176","localhost","devops"].find((e=>a.getMainURL().includes(e)))&&r.Element.addEvent.call(document,"keydown",(e=>{"e"===r.Event.whichKey(e)&&this.experienceBase&&null===this.experienceBase._parentBase&&(this._endCaptureDate=Date.now(),this.downloadGeneratedObject(),this._notifyEnd())}))}downloadGeneratedObject(){let e=this.generateRenderedObject();const t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=this._projectName+".json",a.click(),URL.revokeObjectURL(r)}generateRenderedObject(){let e=super.generateRenderedObject();if(this.experienceBase&&this.experienceBase._childrenBase){const t=this.experienceBase._childrenBase;if(t&&t.all.length)for(let n of t.all)n._helperLifecycle&&(e=e.concat(n._helperLifecycle.generateRenderedObject()))}return e}unInitialize(){}}})),define("DS/VCXWebComposer/VCXWebAppHelper",["UWA/Class","DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXContextManager","DS/VCXWebComposer/VCXWebDictionary","DS/VCXWebDressup/VCXWebDressupDictionary","DS/VCXWebVisualization/VCXVisuManager","DS/VCXWebComposer/VCXDressupGrpsDescription","DS/VCXWebComposer/VCXRenderedLifecycleExperienceHelper","DS/VCXWebComposer/VCXGraphicalLifecycleExperienceHelper","text!DS/VCXWebComposer/assets/base/VCXComposerManagersDescription.json"],(function(e,t,n,r,a,i,o,s,c,l,p){"use strict";var C=e.extend({init:function(e){this.supportWebApplicationBase=!1,this._composerManagersDescription=null,this._supportLifecycleExperienceBase=localStorage.getItem("DebugSupportWebApplicationBase"),this.options=UWA.extend({},e,!0)},_buildConditionToAddComposerManager:function(e,t){if("object"!=typeof e||null==e)return!0;for(const n in e){if("^or"===n)return Object.values(e[n]).some((e=>this._buildConditionToAddComposerManager(e,t)));if("^and"===n)return Object.values(e[n]).every((e=>this._buildConditionToAddComposerManager(e,t)));if(e[n]&&"object"==typeof e[n]&&"value"in e[n])return t?e[n].value===this._experienceBase.getManager("VCXContextManager").getContextFromName(n):e[n].value===this._experienceBase.getManager("VCXContextManager").isSupported(n)}return!0},_addComposerManagersFromMode:function(e){const t=0===e?"webApplicationBaseMode":1===e?"experienceBaseMode":2===e?"biMode":"experienceBaseMode";if(this._composerManagersDescription&&this._composerManagersDescription.hasOwnProperty(t)){let n={};for(let r in this._composerManagersDescription[t]){const a={...this._composerManagersDescription[t][r].initialize_options,mode:e},i=this._composerManagersDescription[t][r].context,o=this._buildConditionToAddComposerManager(i,!0),s=this._composerManagersDescription[t][r].support,c=this._buildConditionToAddComposerManager(s,!1);o&&c&&(n[r]=a)}this._experienceBase.BuildAddManagers(n)}},_prepareListManagers:function(){this._parent(),this._declareComposerManagers(p)},addComposerManagers:function(){this._addComposerManagersFromMode(0),this._addComposerManagersFromMode(1),this._addComposerManagersFromMode(2)},addComposerManagersExperienceBase:function(){this._addComposerManagersFromMode(1),this._addComposerManagersFromMode(2)},addComposerManagersWebApp:function(){this._experienceBase.CheckNoChildYet&&this._experienceBase.CheckNoChildYet()&&this._addComposerManagersFromMode(0),this._addComposerManagersFromMode(2)},_declareComposerManagers:function(e){try{const t=JSON.parse(e);this._composerManagersDescription||(this._composerManagersDescription={});for(let e in t){this._composerManagersDescription.hasOwnProperty(e)||(this._composerManagersDescription[e]={});for(let n in t[e])this._composerManagersDescription[e][n]=t[e][n]}}catch(e){console.warn(e)}},_setContextApp:function(){const e=this._experienceBase.getManager("VCXContextManager");return!(!e||!e.setSupported)&&(e.setSupported("SupportWebApplicationBase",this.supportWebApplicationBase),!0)},disposeExperienceBase:function(){return this._VCXActionBarLoadRequest&&n.unsubscribe(this._VCXActionBarLoadRequest),this._VCXActionBarLoadRequest=null,this._RunLoopStarted&&n.unsubscribe(this._RunLoopStarted),this._RunLoopStarted=null,UWA.Promise.resolve()},AddDictionaryDescription:function(e){if(e&&e.GetDictionary&&e.GetDictionary())return this._experienceBase.AddDictionaryDescription(e.GetDictionary())},onPostCreate:async function(e){return this._experienceBase=e,this.supportWebApplicationBase?this._experienceBase._parentBase?this.addComposerManagersExperienceBase():this.addComposerManagersWebApp():this.addComposerManagers(),this._declareDressupGroups(s),this.SetHelperLifecycle(e),this._experienceBase},_declareDressupGroups:function(e){const t=this._experienceBase.getManager("VCXDressupManager"),n=this._experienceBase.getManager("VCXContextManager");e&&t&&e.GetDescription&&e.GetDescription(n).forEach((e=>{t.RegisterDressupGroup(e,!1)}))},_declareGUIComponents:async function(e,t){const n=this._experienceBase.getManager("VCXContextManager");t&&e.SetGUIAppDescription&&t.GetDescription&&e.SetGUIAppDescription(t.GetDescription(n)),t&&e.SetGUIConditionsCallback&&(t.GetDynamicConditionsForComponents?e.SetGUIConditionsCallback(t.GetDynamicConditionsForComponents(n)):e.SetGUIConditionsCallback({}))},addDictionaries:async function(){await this._parent(),await this.AddDictionaryDescription(a),await this.AddDictionaryDescription(i)},SetHelperLifecycle:function(e){if(this._supportLifecycleExperienceBase){let t=null;t=localStorage.getItem("DebugNotificationLifecycle")?new l("ManagersLifecycle",e):new c("ManagersLifecycle",e),e.SetHelperLifecycle(t)}},onFinished:function(e,r){var a=this;if(this._RunLoopStarted=n.subscribe({event:"/W3A/ManagerSet/RunLoopStarted"},(function(){a.options.onAppInitialize&&(a.options.onAppInitialize(a,a._experienceBase),a.options.onAppInitialize=null),n.unsubscribe(a._RunLoopStarted),delete a._RunLoopStarted})),t.setFullscreen(),a._experienceBase&&a._experienceBase._ManagerSet&&a._experienceBase._ManagerSet.getVersions&&console.log(this._experienceBase._ManagerSet.getVersions().length+" managers loaded !"),this._experienceBase.getManager("VCXGUIManager")){var i=this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();i&&i.clearInitWidget()}return void 0!==r&&this.supportWebApplicationBase&&(r?this._experienceBase._parentBase?n.publish({event:"VCX/EXP/CREATE",data:{}}):n.publish({event:"VCX/WEBAPP/CREATE",data:{}}):n.publish({event:"VCX/EXP/CLOSE",data:{}})),UWA.Promise.resolve()},getOptions:function(){return C.getOptions()}});return C.getOptions=function(){return window.useAsyncExperienceBase=!0,window.enableNewTrapSelection=!0,window.IR551190=!0,window.IR551201=!0,window.WUXEnableGSSOCache=!0,{viewerOptions:o.getViewerOptions(),uiOptions:{displayTree:!1,preserveActionBarHeight:!0}}},C})),define("DS/VCXWebComposer/VCXProductIndex",["require","exports","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebComposer/VCXRefInstNodeIndex"],(function(e,t,n,r){"use strict";class a{constructor(e){this.productID=e,this._partTypes=[]}get partTypes(){return this._partTypes}async fetch(e,t,r,i){const o=await n.expandV2(e,t,this.productID,i);if(this._partInfo=o&&o.results&&a.buildGraphFromExpandResult(o&&o.results),!o||!o.results||!this._partInfo)return!1;if(o&&o.results&&o.results.forEach((e=>{if(e&&e.resourceid){let t=e["ds6w:kind"];if(t){let e=t.split(",").map((e=>e.trim()));for(const t of e)this._partTypes||(this._partTypes=[]),this._partTypes.includes(t)||this._partTypes.push(t)}this._partInfo[e.resourceid]=e}e.materials_info&&(this._materials_info=e.materials_info),e.pgp_output&&(this._pgp_output=e.pgp_output)})),this._partInfoRoot=this._partInfo[this.productID],this._partTree=this.getInstRefTreeFromReference(this._partInfoRoot,r),this._pgp_output&&this._pgp_output.pgp_hide&&this._pgp_output.pgp_hide.forEach((e=>{const t=this.getRefInstNode(e);t&&(t.hidden=!0),console.log(t)})),this._materials_info&&this._materials_info.materials){let r=await n.fetchMaterials(e,t,this._materials_info.materials.map((e=>e.resourceid)));this._materials_info||(this._materials_info={materialMap:{}}),this._materials_info.materialMap||(this._materials_info.materialMap={}),r&&r.forEach((e=>{const t={};e.attributes&&e.attributes.forEach((e=>{t[e.name]=e.value}));const n=t.resourceid;n&&(this._materials_info.materialMap[n]=t)}))}const s=[];for(let e in this._partInfo)"3DShape"!==this._partInfo[e]["ds6w:type"]&&"VPMRepReference"!==this._partInfo[e]["ds6w:type"]||s.push(e);const c=await n.getReferenceSizes(e,t,s);return c&&c.forEach((e=>{const t=e[3][0][0],n=t&&this._partInfo[t];if(n){n.files=[];for(let t=0;t<e[4]?.length;t++)n.files.push({fileName:e[4][t][0],size:parseFloat(e[5][t][0]),extension:e[6][t][0]})}})),!0}async generateMaterialAndFillRefInstNode(e){if(this._materials_info&&this._materials_info.materials_overload){let t=this._materials_info.materials_overload.filter((e=>{let t=this._partInfo[e.path[e.path.length-1]];return t&&"3DShape"!=t["ds6w:type"]}));t=t.filter((e=>this._materials_info.materialMap[e.material]&&"dsc_matref_ref_Covering"===this._materials_info.materialMap[e.material]["ds6w:type"]));let n=t.map((e=>e.material));for(let t of n)await e._experienceBase.getManager("VCXMaterialManager").createInternalMaterial({physicalID:t},[],e);this.computeMaterialsApplication(t)}}computeMaterialsApplication(e){let t=new Map;this._partTree.traverse((e=>{let n=t.get(e.node.id)??[];n.push(e.node),t.set(e.node.id,n)}));for(let n of e){let e=t.get(n.path[n.path.length-1]);if(e)for(let t of e){let e=t;for(let r=n.path.length-1;r>=0&&e?.id===n.path[r];r--)if(e=e?.parent?.parent??null,0===r){(!t.materialApplication||t.materialApplication.path.length<n.path.length)&&(t.materialApplication=n);break}}}this._partTree.traverse((e=>{let t=e.node;t.materialApplication&&(t.isReference()&&!t.appliedMaterial&&(t.appliedMaterial=t.materialApplication),t.reference&&(t.reference.appliedMaterial=t.materialApplication))}));let n=(e,t,r)=>{e.appliedMaterial&&(r?t<=e.appliedMaterial.path.length?t=e.appliedMaterial.path.length:e.appliedMaterial=null:t=e.appliedMaterial.path.length,r=!0),e.instances&&Object.values(e.instances).forEach((e=>{e.reference&&n(e.reference,r?t+1:0,r)}))};n(this._partTree,0,!1),this._partTree.traverse((e=>{let t=e.node;t.appliedMaterial&&"3DShape"===t.type&&t.parent?.parent&&(t.parent.parent.appliedMaterial=t.appliedMaterial)})),t.clear()}getPathOfIDsFromPathOfInstances(e){return a.getPathOfIDsFromPathOfInstancesAndRefTree(this._partTree,e,0)}static getPathOfIDsFromPathOfInstancesAndRefTree(e,t,n){if(!e)return null;if(!(t.length>n))return[e.id];const r=t[n],i=e?.instances[r]?.reference,o=a.getPathOfIDsFromPathOfInstancesAndRefTree(i,t,n+1);return o?[e.id,r,...o]:null}getRefInstNode(e){let t=this._partTree;for(let n=0;n<e.length;n++){if(!t)return null;if(t.id!==e[n])return null;if(n===e.length-1)return t;if(t.reference)t=t.reference;else{if(n+1>=e.length)return t;t=t.instances&&t.instances[e[n+1]]}}return null}getRootTreeNodeModel(){return this._treeInstRefRoot||(this._treeInstRefRoot=this._partTree.getTreeNodeModel(this._materials_info)),this._treeInstRefRoot}getRefInstRoot(){return this._partTree}static buildGraphFromExpandResult(e){const t={};return e&&e.forEach((e=>{if(e&&e.resourceid){let n;n=t[e.resourceid]?{...t[e.resourceid],...e}:e,t[n.resourceid]=n,n.from&&(t[n.from]?n.fromObj=t[n.from]:n.fromObj={resourceid:n.from},n.fromObj.tos||(n.fromObj.tos=[]),n.fromObj.tos.push(n)),n.to&&(t[n.to]?n.toObj=t[n.to]:n.toObj={resourceid:n.to},n.toObj.froms||(n.toObj.froms=[]),n.toObj.froms.push(n))}})),t}static isInstRefTreeComplete(e,t){if(void 0!==t._isComplete)return t._isComplete;if(e&&e.instances&&Object.keys(e.instances).length){if(t&&t.instances&&Object.keys(t.instances).length){if(Object.keys(e.instances).length===Object.keys(t.instances).length){for(let n in t.instances)if(!a.isInstRefTreeComplete(e.instances[n].reference,t.instances[n].reference))return t._isComplete=!1,!1;return t._isComplete=!0,!0}return t._isComplete=!1,!1}return t._isComplete=!1,!1}return t._isComplete=!0,!0}traverseTree(e){return a.iterateThroughInstRefTree(this._partTree,e)}static iterateThroughInstRefTree(e,t){let n=!e||t&&t(e);if(!n)for(let r in e.instances){if(n)continue;const i=e.instances[r];n=t&&t(i),n||a.iterateThroughInstRefTree(i.reference,t)}}getSmartSelection(e,t){const n=[];if(!e)return console.warn("No partial tree"),n;if(this._partTree.id!==e.id)return console.error("Unexepected ref comparaison"),n;if(this._partTree.instances&&Object.keys(this._partTree.instances).length&&e&&e.instances&&Object.keys(e.instances).length)if(a.isInstRefTreeComplete(this._partTree,e))n.push([...t,this._partTree.id]);else for(let r in e.instances)n.push(...this.getSmartSelection(e.instances[r].reference,[...t,this._partTree.id,r]));return n}isIndexed(){return!0}async fillMaterialsInfo(e,t){let n=this._materials_info&&this._materials_info.materialMap;return!!n&&(t.type=n[e]["ds6w:type"],t.typeNLS=n[e]["ds6w:type"],t.name=n[e].name,t.title=n[e]["ds6w:label"],t.image=n[e].preview_url,!0)}getInstRefTreeFromReferenceID(e,t){return this.getInstRefTreeFromReference(this._partInfo[e],t)}getInstRefTreeFromReference(e,t){if(!e||!e.resourceid)return null;const n=new r(t,e);return e.tos&&e.tos.forEach((e=>{const a=new r(t,e);n.setInstance(a.id,a);const i=this.getInstRefTreeFromReference(e.toObj,t);i&&a.setReference(i)})),n}addMetaAttributesToPartInfo(e,t){if(e&&this._partInfo[e])for(let n of t)this._partInfo[e][n.name]=n.value}}return a})),define("DS/VCXWebComposer/VCXCAT3DXModelManager",["DS/CoreEvents/Events","UWA/Class","DS/VCXWebIO/VCXLogServices","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeSequence","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebComposer/VCXLoadServices","DS/WebComponentModeler/WebComponentBase","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebComposer/VCXProductIndex","DS/VCXWebKernel/VCXNotificationManager","i18n!DS/VCXWebEWS/assets/nls/VCXWebEWS"],(function(e,t,n,r,a,i,o,s,c,l,p,C,u,d,g,h,m){"use strict";let f=t.extend({initialize:function(){p.Initialize(this._experienceBase),window.widget&&widget.enopadViewer&&(this._tokenEnopadStartProgressiveLoad=widget.enopadViewer.getController().subscribe({event:"onStartProgressiveLoad"},(async e=>{this._deferredP||(this._deferredP=UWA.Promise.deferred(),this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({maskDisplayAdd:h.FDisplayMode.PROGRESSSPINNER,iPromise:this._deferredP.promise}),this.QueryInterface("VCXIReadiness").registerDomainPromise("visu",this._deferredP.promise))})),this._tokenEnopadEndProgressiveLoad=widget.enopadViewer.getController().subscribe({event:"onEndProgressiveLoad"},(e=>{this._deferredP&&(this._deferredP.resolve(),this._deferredP=null),this._experienceBase.getManager("VCXContextManager").partHasMoved=!0})),this._tokenEnopadRepresentationLoaded=widget.enopadViewer.getController().subscribe({event:"onRepresentationLoaded"},(e=>{this._experienceBase.getManager("VCXContextManager").partHasMoved=!0})))},postInitialize:function(){this.products=[],this.event_VCX_PRODUCT_ADDED=e.subscribe({event:"VCX_PRODUCT_ADDED"},(e=>{e&&e.product&&(this.products[e.product.GetID()]=e.product)})),this.event_VCX_PRODUCT_PREREMOVE=e.subscribe({event:"VCX_PRODUCT_PREREMOVE"},(e=>{e&&e.product&&delete this.products[e.product.GetID()]})),this.event_VCX_NewLink=e.subscribe({event:"/VCXWebProperties/VCXPropertyValueLink/NewLink"},(e=>{if(e&&e.newValue){const t=this._experienceBase.ComponentsMap.GetComponentFromID(e.newValue);t&&t.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&t.GetPersistency()===C.EPersistencyType.notPersistent&&!t.isRegisteredToPersistent()&&t.registerToPersistent()}}))},getInitPhase:function(){return 3},unInitialize:function(){p.UnInitialize(),this.products=[],e.unsubscribe(this.event_VCX_PRODUCT_ADDED),delete this.event_VCX_PRODUCT_ADDED,e.unsubscribe(this.event_VCX_PRODUCT_PREREMOVE),delete this.event_VCX_PRODUCT_PREREMOVE,e.unsubscribe(this.event_VCX_NewLink),delete this.event_VCX_NewLink,window.widget&&widget.enopadViewer&&(this._tokenEnopadStartProgressiveLoad&&(widget.enopadViewer.getController().unsubscribe(this._tokenEnopadStartProgressiveLoad),this._tokenEnopadStartProgressiveLoad=null),this._tokenEnopadEndProgressiveLoad&&(widget.enopadViewer.getController().unsubscribe(this._tokenEnopadEndProgressiveLoad),this._tokenEnopadEndProgressiveLoad=null),this._tokenEnopadRepresentationLoaded&&(widget.enopadViewer.getController().unsubscribe(this._tokenEnopadRepresentationLoaded),this._tokenEnopadRepresentationLoaded=null),this._spinner&&(this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(this._spinner),this._spinner=null))},getProducts:function(){return this.products},getProductFromPID:function(e){for(const t in this.getProducts()){const n=this.getProducts()[t];if(n&&n.productIndex&&n.productIndex.getRefInstRoot()&&n.productIndex.getRefInstRoot().id===e)return n}return null},getProductFromComponent:function(e){let t=e.QueryInterface("VCXIModelNavigable");for(;t&&!t.GetObject().productIndex;)t=t.getParent();return t.GetObject().productIndex?t.GetObject():null},LoadProduct:async function(t){let n={},r=this._experienceBase.getManager("VCXExperience");if(r&&r.updateLogData&&(n=r.updateLogData),!t)throw new Error("Missing product Actor");const a=this._experienceBase.getManager("VCXContextManager");if(!t.productIndex&&a.isSupported("VCXProductIndexSupport")){const e=await d.Get3DSpaceURL(),n=await d.GetPreferredSecurityContext(),r="ctx::"+n.role+"."+n.organization+"."+n.collabspace;let a=await t.QueryInterface("CATI3DXAssetProperties").getPhysicalId();if(t.productIndex=new g(a),!await t.productIndex.fetch(e,r,t))throw new Error("Product is not indexed");await t.productIndex.generateMaterialAndFillRefInstNode(t)}var i=t.QueryInterface("VCXIModelNavigable"),o=a.getRootComponent().QueryInterface("VCXIModelNavigable");i.setParent(o),i.getChildren()&&i.getChildren().length||p.buildNavigableFromActorAsset(t);let s=this.QueryInterface("VCXILoadHelper").AddProductAndUpdate(t,n);e.publish({event:"VCX_PRODUCT_ADDED",data:{product:t}});let c=this._experienceBase.getManager("VCXNotificationManager"),l={strObjectType:m["ProgressNotification.ProductStructure"],maskDisplayAdd:h.FDisplayMode.CONSOLE|h.FDisplayMode.LOADINGPANEL,iPromise:s};c.addProgressNotification(l),await s;const C=t.QueryInterface("VCXIModelNavigable"),u=[];C.traverse((e=>{u.push(e.GetObject())}),!0);let f=new Promise((async e=>{for(let e of u)await p.setComponentAttributes(e,t);e()})),V={strObjectType:m["ProgressNotification.SetComponentAttributes"],maskDisplayAdd:2,iPromise:f};c.addProgressNotification(V),await f},RetrieveExperienceFromServer:async function(){let e=await this._experienceBase.getManager("VCXEWSManager").IsExperienceStarted();if(!(e.isExperienceStarted||this._experienceBase.getManager("VCXContextManager").isSupported("EWS_NewCache")&&"NOT_CONNECTED_CACHE_EXISTS"===e.cacheStatus))throw this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"error",title:m["Notification.Error"],message:m["Notification.Recovering.Message"]}),new Error(m["Notification.Recovering.Message"]);{let t=null;t=this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strAction:m["ProgressNotification.Recovering"],strObjectName:e.experienceName,maskDisplayAdd:h.FDisplayMode.CONSOLE|h.FDisplayMode.LOADINGPANEL,maskDisplayEnd:!0});try{let e;if(this._experienceBase.getManager("VCXContextManager").isSupported("EWS_NewCache")){let t=await d.GetPreferredSecurityContext();e=await this.Get3DSpaceOptionsForFactory(t)}let n=await this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().RetrieveExperienceFromServer(e);if(!n)throw new Error("No Experience Object");{await this._LoadExperienceModel(n),this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(t);let e=this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();e&&e.endLoadingExperience()}}catch(e){throw console.error(e),this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(t),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"error",title:m["Notification.Error"],message:m["Notification.Recovering.Message"]}),new Error(e)}}},_LoadExperienceModel:async function(e){if("true"===localStorage.getItem("EWS_AuthoringV2")&&e)try{e.QueryInterface("CATI3DExperienceObject").GetValueByName("scenariosKF")[0].QueryInterface("CATI3DXJSONProcessor").Process()}catch(e){throw new Error("Experience wasn't initialized, can't restore")}let t={},n=this._experienceBase.getManager("VCXExperience");n&&(t=n.updateLogData={}),t.newOverides=[],t.deletedOverides=[],t.deletedMaterials=[],t.deletedAmbiences=[],t.impactedComponents={},t.impactedComponentsInverted={},t.hasImpactOnScenario=!1;let r=this._experienceBase.ComponentsMap.GetComponentFromType("Model_VPMReference_Spec");if(0===r.length&&(r=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentVPMReference")),0!==r.length)for(let e=0;e<r.length;e++){let t=r[e];await this.LoadProduct(t)}await this.OnEndLoading(!1,{products:r})},OnEndLoading:async function(t,r){const a={onAssetAdded:n.generateUUID(),createDressupsBases:n.generateUUID(),CreateEnvironnementObjects:n.generateUUID(),initActorDocManager:n.generateUUID(),initFromResourcesManager:n.generateUUID(),EndLoadingDressups:n.generateUUID(),EndLoadingViewpoints:n.generateUUID(),GetNeutralsFromVariables:n.generateUUID(),OnEndLoadingShared:n.generateUUID()};let i=this._experienceBase.getManager("VCXContextManager");i.partHasMoved=!0;let o=this._experienceBase.getManager("VCXExperience");if(r)for(let t in r)if(r.hasOwnProperty(t)){let n=r[t];if("products"===t){const t=this._experienceBase.getManager("VCXScenarioManager");for(let r=0;r<n.length;r++){let a=n[r];if(a.productIndex&&i&&i.isSupported("VCXCreateOverridesOnDemand")&&i.isSupported("VCXCreateLocalActors")){const n=[],r=[];a.productIndex.traverseTree((e=>{if(e.isVPMReference()){const n=e.getPathOfIDs();if(n){const i=this._experienceBase.ComponentsMap.GetComponentFromExternalPath(n,!0);if(i)e.component=i,e.setComponentAttributes(i,a),p.FillNeutralPropertiesFromIndex(e);else{const n=this._experienceBase.Factory.BuildComponent("VCXVolatileComponentOccurrenceComposer");if(this._experienceBase.ComponentsMap.AddComponent(n),e.setComponentAttributes(n),e.component.SetPersistency(C.EPersistencyType.notPersistent),e.parent&&e.parent.parent&&e.parent.parent.component){e.component.QueryInterface("VCXIModelNavigable").setParent(e.parent.parent.component.QueryInterface("VCXIModelNavigable"))}else{e.component.QueryInterface("VCXIModelNavigable").setParent(a.QueryInterface("VCXIModelNavigable"))}p.FillNeutralPropertiesFromIndex(e),n._isVolatileListeningToProperties=!0,t.ConsiderNewComponent(n)}r.push(e.component)}}}));let i=Promise.all(n);await i,e.publish({event:"VCX_COMPONENTS_CREATED",data:{components:r,product:a}})}}}}if(o._endLoadingDone){n.memoryLog("onAssetAdded",!0,a.onAssetAdded);let i=[];if(t&&r){for(let e in r)if(r.hasOwnProperty(e)){let t=r[e];for(let e=0;e<t.length;e++){t[e].QueryInterface("VCXIModelNavigable").traverse((e=>{i.push(e.GetObject())}))}}p.GetNeutralsFromVariables(i),e.publish({event:"VCX_ASSETS_ADDED",data:i});const t=this._experienceBase.getManager("VCXScenarioManager");i.forEach((e=>{"Model_VPMReference_Spec"!==e.componentType&&t.ConsiderNewComponent(e)}))}return void n.memoryLog("onAssetAdded",!1,a.onAssetAdded)}let s=this._experienceBase.getManager("VCXNotificationManager"),c=s.addProgressNotification({strObjectType:m["ProgressNotification.Dressups"],maskDisplayAdd:h.FDisplayMode.CONSOLE|h.FDisplayMode.LOADINGPANEL});n.memoryLog("createDressupsBases",!0,a.createDressupsBases),this._experienceBase.getManager("VCXDressupManager").createDressupsBases(),n.memoryLog("createDressupsBases",!1,a.createDressupsBases),n.memoryLog("CreateEnvironnementObjects",!0,a.CreateEnvironnementObjects),await this.CreateEnvironnementObjects(),n.memoryLog("CreateEnvironnementObjects",!1,a.CreateEnvironnementObjects);let l=s.addProgressNotification({strObjectType:m["ProgressNotification.DocManager"],maskDisplayAdd:h.FDisplayMode.CONSOLE|h.FDisplayMode.LOADINGPANEL});n.memoryLog("initActorDocManager",!0,a.initActorDocManager),t&&await this._experienceBase.getManager("VCXDocManager").initActorDocManager(),n.memoryLog("initActorDocManager",!1,a.initActorDocManager),n.memoryLog("initFromResourcesManager",!0,a.initFromResourcesManager),t||this._experienceBase.getManager("VCXContextManager").IsLocalMode()&&!this._experienceBase.getManager("VCXContextManager").getUseResourcesManager()||await this._experienceBase.getManager("VCXDocManager").initFromResourcesManager(),n.memoryLog("initFromResourcesManager",!1,a.initFromResourcesManager),this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(l),n.memoryLog("EndLoadingDressups",!0,a.EndLoadingDressups),o.EndLoadingDressups(),n.memoryLog("EndLoadingDressups",!1,a.EndLoadingDressups),n.memoryLog("EndLoadingViewpoints",!0,a.EndLoadingViewpoints),o.EndLoadingViewpoints(),n.memoryLog("EndLoadingViewpoints",!1,a.EndLoadingViewpoints),n.memoryLog("GetNeutralsFromVariables",!0,a.GetNeutralsFromVariables),p.GetNeutralsFromVariables(),n.memoryLog("GetNeutralsFromVariables",!1,a.GetNeutralsFromVariables),n.memoryLog("OnEndLoadingShared",!0,a.OnEndLoadingShared);try{let r=await this.OnEndLoadingShared(t);if(n.memoryLog("OnEndLoadingShared",!1,a.OnEndLoadingShared),this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(c),t){let t=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();e.publish({event:"VCX_UPDATE_THUMBNAIL",data:{scenarioID:t}})}return r}catch(e){throw this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(c),e}},OnEndLoadingShared:async function(t){let a=this._experienceBase.getManager("VCXExperience"),p="",C=this._experienceBase.getManager("VCXScenarioManager").QueryInterface("VCXIModifiable");if(t){if(this._experienceBase.getManager("VCXGUIManager").InitGUI(),0===this._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0).length){let e=this._experienceBase.Factory.BuildComponent("VCXScenarioSequence");e.SetName("Sequence 1");let t=e.QueryInterface("VCXIModifiable"),n=new r(this._experienceBase);n.CaptureNeutralProperties(t),this._experienceBase.getManager("VCXCommandManager").Do(n);let a=new o(this._experienceBase);a.PushSequence(e),this._experienceBase.getManager("VCXCommandManager").Do(a)}p=(await a.CreateNewScenario(!0)).GetID();let e=new l(p),t=new s(new c("ScenarioManager.startScenarioId",2),e),n=new i(this._experienceBase,!0);n.ChangeProperty(C,t),this._experienceBase.getManager("VCXCommandManager").Do(n)}else{let e=n.generateUUID();n.memoryLog("RestoreNeutralProperties",!0,e),this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties(),n.memoryLog("RestoreNeutralProperties",!1,e),await this._experienceBase.getManager("VCXExperience").getAllActorsReadiness(),this._experienceBase.getManager("VCXGUIManager").InitGUI()}await a.InitImagePanels(),this._experienceBase.getManager("VCXGUIManager").RefreshGUI(),this._experienceBase.getManager("VCXPaperManager").updatePaper({propagateEvent:!0});let u=n.generateUUID();n.memoryLog("VCXGUIManager setUpTrees",!0,u),this._experienceBase.getManager("VCXGUIManager").setUpTrees(),n.memoryLog("VCXGUIManager setUpTrees",!1,u),this._experienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode")||this._experienceBase.getManager("VCXScenarioManager").SetAutoKey(!0),console.log("VCXExperience::OnEndLoading end"),setTimeout((()=>{document.querySelector("div.wux-windows-immersive-frame").dispatchEvent(new Event("resize"))}),500);let d=this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();if(d&&d.endLoadingExperience(),p=C.GetProperty("ScenarioManager.startScenarioId").GetPropertyValue().GetValue(),!this._experienceBase.ComponentsMap.GetComponentFromID(p)){let e=this._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(e.length){let t=e[0].GetListScenariosId();if(t.length){p=t[0];let e=new s(new c("ScenarioManager.startScenarioId",2),new l(p)),n=new i(this._experienceBase,!0);n.ChangeProperty(C,e),this._experienceBase.getManager("VCXCommandManager").Do(n)}}}this._GoToPreferredSceneAtStart(p),await this._experienceBase.getManager("VCXExperience").getAllActorsReadiness(),e.publish({event:"VCX_END_LOADING_DONE"})},_GoToPreferredSceneAtStart:function(e){if(e){let t=n.generateUUID();n.memoryLog("GoToScenario",!0,t);let r=new a(this._experienceBase);r.GoToScenario(e),this._experienceBase.getManager("VCXCommandManager").Do(r),n.memoryLog("GoToScenario",!1,t)}},ApplyMaterial:function(e,t,n){let r=e.PLMMaterialID&&this._experienceBase.ComponentsMap.GetComponentFromID(e.PLMMaterialID),a=this._experienceBase.ComponentsMap.GetComponentFromID(e.originalMaterial);e._updateApplied(r??a,t??a),e.PLMMaterialID=t?t.GetID():"";let i=[],o=e._experienceBase.getManager("VCXContextManager");t&&t.QueryInterface("CATI3DXAssetProperties")?i.push((async()=>{e.PLMMaterial=await t.QueryInterface("VCXIMaterialCache").getMaterialVisu(),e.PLMMaterialID===(t?t.GetID():"")&&(e.PLMMaterial.force=!0,o.useTraverseGraph?o.traverseGraphMustBePerformed=!0:(e.OverrideMaterial(e.PLMMaterial,e.localColorIsDefined?e.localColor:null,null,!1),e.setDirtyFlag(u.FDirty.Material,!1)),o.renderAll(),o=null)})()):(e.PLMMaterial=null,o.useTraverseGraph?o.traverseGraphMustBePerformed=!0:(e.OverrideMaterial(null,e.localColorIsDefined?e.localColor:null,null,!1),e.setDirtyFlag(u.FDirty.Material,!1)),o.renderAll(),o=null,i.push(UWA.Promise.resolve())),(n||window.iApplyOnServer)&&i.push(this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().ApplyMaterial(e,t));let s=UWA.Promise.all(i),c=e.QueryInterface("VCXIReadiness");return c&&c.registerPromise(s),s},InsertAmbience:function(e,t,n){throw new Error("Not implemented here")},InsertMaterial:function(e,t,n,r,a){throw new Error("Not implemented here")},InsertMaterials:async function(e,t){throw new Error("Not implemented here")},InsertProduct:async function(e,t,n){throw new Error("Not implemented here")},Get3DSpaceOptionsForFactory:async function(e){if(this._experienceBase.getManager("VCXContextManager").IsLocalMode()||this._experienceBase.odt||"true"===this._experienceBase.getManager("VCXContextManager").getUrlVars().tstProvider)return{role:"VPMADMIN",organization:"ADMIN",collabSpace:"DEFAULT",force:1};if(e){let t={};if("string"==typeof e){let n=e.split(".");t.role=n[0],t.organization=n[1],t.collabspace=n[2]}else t=e;return{role:t.role,organization:t.organization,collabSpace:t.collabspace,force:1}}throw new Error("Security context missing.")},LoadExperienceFromPhysicalID:async function(e,t,n){let r=await this.Get3DSpaceOptionsForFactory(n);return await this._experienceBase.getManager("VCXEWSManager").CloseExperience(),new Promise((async(t,n)=>{try{let n=await this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().LoadExperience(e,r);await this._LoadExperienceModel(n),t(n)}catch(e){n(e)}}))},CreateExperience:async function(e,t){if(this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().GetExperience())return this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().GetExperience();e||(e="NewExperience");let n=this._experienceBase.getManager("VCXEWSManager").GetScenarioType();if(!n)throw new Error("The experience scenario type is not defined");await this._experienceBase.getManager("VCXEWSManager").CloseExperience();let a=await this.Get3DSpaceOptionsForFactory(t),i=await this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().CreateExperience(e,n,a);if(i){i.SetPersistency(1);let t=i.QueryInterface("VCXIModifiable"),n=new l(e);t.OnChangeProperty("Actor.Name",n);let a=new r(this._experienceBase);return a.CaptureNeutralProperties(t),this._experienceBase.getManager("VCXCommandManager").Do(a),i}throw new Error("create 3DX experience failed")},CreateEnvironnementObjects:async function(e){},GetSecurityContext:function(){return this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().GetSecurityContext()},CreateActor:function(e,t,n){return this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().CreateActor(e,t,n)},DeleteActor:function(e){return e.IsKindOf("AmbienceModel_Spec")?this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().DeleteAmbience(e):e.IsKindOf("CXPCoveringMaterial_Spec")?this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().DeleteMaterial(e):this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().DeleteActor(e)}});return Object.defineProperty(f.prototype,"componentType",{enumerable:!0,get:()=>"VCXCAT3DXModelManager"}),f}));