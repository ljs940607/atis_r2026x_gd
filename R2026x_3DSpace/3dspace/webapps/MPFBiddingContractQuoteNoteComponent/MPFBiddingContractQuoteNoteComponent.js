define("DS/MPFBiddingContractQuoteNoteComponent/BiddingContractSection",["UWA/Class/View","css!DS/MPFBiddingContractQuoteNoteComponent/MPFBiddingContractQuoteNoteComponent"],(function(t){"use strict";return t.extend({className:"mpf-bidding-contract-section",setup:function(t={}){t.additionalClassName&&this.container.addClassName(t.additionalClassName)},render:function(){return this.container.setContent([{tag:"div",class:"mpf-section-header",html:[{tag:"div",class:"mpf-section-title",html:this.createTitle()},{tag:"div",class:"mpf-section-link",html:this.createLink()}]},{tag:"div",class:"mpf-section-body",html:this.createBody()}]),this},destroy:function(){this._parent(),this.container=null},createTitle:function(){},createBody:function(){},createLink:function(){}})})),define("DS/MPFBiddingContractQuoteNoteComponent/InvoiceSection",["UWA/Core","UWA/Class/View","UWA/Promise","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemCollection","DS/MPFCartModel/CartModelHelper","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFInvoiceModel/InvoiceDocumentFactory","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent","css!DS/MPFBiddingContractQuoteNoteComponent/MPFBiddingContractQuoteNoteComponent"],(function(t,e,o,n,i,s,r,c,a,d,l,u,h,m,y){"use strict";var p={NOT_AVAILABLE:"notAvailable",UPLOAD_AVAILABLE:"uploadAvailable",ALREADY_UPLOADED:"alreadyUploaded"},C=e.extend({className:"mpf-invoice-section",setup:function(t){t||(t={}),this._parent(t),this._checkPrototypes(t),this.sellerView=!0===t.sellerView,this.cart=t.cart,this.cartItems=t.cartItems,this.invoiceDocument=t.invoiceDocument,this.invoiceDocumentFactory=t.invoiceDocumentFactory,this.stateMachine=this._createStateMachine(),this.title=this._createTitle(),this.button=this._createButton(),this.downloadButton=this._createDownloadButton(),this.inputFile=this._createInputFile(),this.message=this._createMessage()},render:function(){return this.container.setContent([this.title,this.downloadButton,this.button,this.message]),this},_updateContent:function(t){this.stateMachine.changeState(t),this.downloadButton=this._createDownloadButton(),this.button=this._createButton(),this.message=this._createMessage(),this.render()},_createMessage:function(){var e;return this.stateMachine.getState()===p.NOT_AVAILABLE?e=y.get("invoiceNotAvailable"):this.stateMachine.getState()===p.ALREADY_UPLOADED?e=t.createElement("div",{html:[t.createElement("span",{class:"fonticon fonticon-check"}),this.invoiceDocument.getDocName()]}):this.stateMachine.getState()===p.UPLOAD_AVAILABLE&&(e=y.get("noInvoiceYet")),t.createElement("div",{class:"mpf-bidding-message",html:e})},_createButton:function(){if(this.sellerView){if(this.stateMachine.getState()===p.ALREADY_UPLOADED)return this._createDeleteInvoiceButton();if(this.stateMachine.getState()===p.UPLOAD_AVAILABLE)return this._createUploadInvoiceButton()}},_createInputFile:function(){var t,e=this;if(this.sellerView)return new s({events:{onChange:function(i){return r.mask(e.container),t=i.target.files[0],e.invoiceDocument=e.invoiceDocumentFactory.createModel(m.Types.CART_INVOICE_DOCUMENT),e.invoiceDocument.parentResourceId=e.cart.get("id"),e.invoiceDocument.saveFile(t).then((function(){var t={};return t[d.Fields.BUYER_INVOICE_DOCUMENT_PID]=e.invoiceDocument.id,o.all([e.cart.savePromise(t,{patch:!0}),e.invoiceDocument.fetchPromise()])})).then((function(){e._updateContent(p.ALREADY_UPLOADED),r.unmask(e.container),n.publish("MPCartTimeline",{event:"refresh",cartId:e.cart.id})}))}}})},_createUploadInvoiceButton:function(){return new i({className:"default",value:y.get("uploadInvoice"),events:{onClick:this._uploadInvoiceHandler.bind(this)}})},_uploadInvoiceHandler:function(){this.inputFile.elements.input.click()},_createDeleteInvoiceButton:function(){return new i({className:"default",value:y.get("deleteInvoice"),events:{onClick:this._updateContent.bind(this,p.UPLOAD_AVAILABLE)}})},_createDownloadButton:function(){if(this.stateMachine.getState()===p.ALREADY_UPLOADED)return t.createElement("a",{class:"mpf-bidding-link",target:"_blank",href:this.invoiceDocument.getDocUrl(),html:y.get("download")})},_createTitle:function(){return t.createElement("div",{class:"mpf-bidding-title",text:y.get("invoice")})},_createStateMachine:function(){var t;return t=u.isConfirmed(this.cart)?""!==this.cart.getBuyerInvoiceDocumentPid()?p.ALREADY_UPLOADED:p.UPLOAD_AVAILABLE:p.NOT_AVAILABLE,new a({state:t,states:[p.NOT_AVAILABLE,p.UPLOAD_AVAILABLE,p.ALREADY_UPLOADED],transitions:[{from:p.UPLOAD_AVAILABLE,to:p.ALREADY_UPLOADED},{from:p.ALREADY_UPLOADED,to:p.UPLOAD_AVAILABLE}]})},_checkPrototypes:function(t){c.requiredOfPrototype(t.cart,d,"options.cart must be a CartModel"),c.requiredOfPrototype(t.cartItems,l,"options.cartItems must be a CartItemCollection"),c.requiredOfPrototype(t.invoiceDocumentFactory,m,"options.invoiceDocumentFactory must be an InvoiceDocumentFactory"),""!==t.cart.getBuyerInvoiceDocumentPid()&&c.requiredOfPrototype(t.invoiceDocument,h,"options.invoiceDocument must be an InvoiceDocumentModel")}});return C.States=Object.freeze(p),C})),define("DS/MPFBiddingContractQuoteNoteComponent/NDASection",["UWA/Core","DS/MPFServices/ObjectService","DS/MPFTcDocumentModel/TcDocumentModel","DS/MPFBiddingContractQuoteNoteComponent/BiddingContractSection","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent"],(function(t,e,o,n,i){"use strict";return n.extend({setup:function(e={}){e.additionalClassName="mpf-nda-section",this._parent(e),this._checkPrototypes(e),this.ndaDocument=e.ndaDocument,this.ndaExist=t.is(this.ndaDocument)},createBody:function(){return this.ndaExist?i.get("attachedNda"):i.get("noNda")},createLink:function(){if(this.ndaExist)return t.createElement("a",{class:"mpf-bidding-link",target:"_blank",href:this.ndaDocument.getDocUrl(),html:i.get("download")})},createTitle:function(){return i.get("nda")},_checkPrototypes:function(n){t.is(n.ndaDocument)&&e.requiredOfPrototype(n.ndaDocument,o,"options.ndaDocument must be a TCDocumentModel")}})})),define("DS/MPFBiddingContractQuoteNoteComponent/QuoteSection",["UWA/Core","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFBuyer/BuyerType","DS/MPFCountryModel/CountryCollection","DS/MPFPersonModel/PersonModel","DS/MPFCompanyModel/CompanyModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemCollection","DS/MPFCartModel/CartModelHelper","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFAddressModel/AddressCollection","DS/MPFAddressModel/AddressFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartItemFactory","DS/MPFCartQuoteComponent/CartQuoteDownloadLink","DS/MPFBuyerAddressComponent/BuyerAddressBook","DS/MPFBiddingContractQuoteNoteComponent/BiddingContractSection","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent"],(function(t,e,o,n,i,s,r,c,a,d,l,u,h,m,y,p,C,D,F,M,f){"use strict";return M.extend({setup:function(t={}){t.additionalClassName="mpf-quote-section",this._parent(t),this.sellerView=!0===t.sellerView,this._checkPrototypes(t),this.me=t.me,this.buyerType=t.buyerType,this.company=t.company,this.addresses=t.addresses,this.cart=t.cart,this.cartItems=t.cartItems,this.cartQuote=t.cartQuote,this.addressFactory=t.addressFactory,this.companyFactory=t.companyFactory,this.cartFactory=t.cartFactory,this.cartItemFactory=t.cartItemFactory,this.countries=t.countries,this.orderStatus=this.cartItems.first().getState(),this.buyerAddressBook=this._createBuyerAddressBook()},render:function(){return this._parent(),t.is(this.buyerAddressBook)&&this.container.addContent(this.buyerAddressBook.render()),this},_createBuyerAddressBook:function(){const e=this.orderStatus!==a.STATUS.submitted,o=t.is(this.cart.get("BillTo"))&&""!==this.cart.get("BillTo");if(e&&!o&&!this.sellerView){const t=new F({model:this.addresses,me:this.me,buyer:this.buyerType===n.COMPANY?this.company:this.me,addressFactory:this.addressFactory,companyFactory:this.companyFactory,cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory,isBillingAddress:!0,countries:this.countries,countryReadOnly:this.buyerType===n.COMPANY});return this.listenTo(t,"onSelected",this._newBillingAddressHandler.bind(this)),t}},createTitle:function(){return f.get("quote")},createBody:function(){var e,o;return e=this.orderStatus!==a.STATUS.submitted,o=l.isPaidByDirectPurchase(this.cart,this.cartItems),this.cart.getState()===c.States.CANCELLED?f.get("noQuoteOrderCancelled"):e||o?[t.createElement("span",{class:"fonticon fonticon-check"}),t.createElement("span",{text:f.get("quoteReady")})]:f.get("noQuote")},createLink:function(){const e=this.cart.getState()!==c.States.CANCELLED,o=this.orderStatus!==a.STATUS.submitted,n=l.isPaidByDirectPurchase(this.cart,this.cartItems);if(e&&(o||n)){const e=t.is(this.cart.get("BillTo"))&&""!==this.cart.get("BillTo");return this.sellerView?e?this._getDownloadQuoteComponent():this._sellerErrorDownloadButton():e?this._getDownloadQuoteComponent():this._createBuyerAddressBookButton()}},_getDownloadQuoteComponent:function(){const t=new D({quote:this.cartQuote,label:f.get("download")});return t.render(),t},_sellerErrorDownloadButton:function(){return t.createElement("span",{text:f.get("download"),events:{click:this._displayErrorQuoteMessage.bind(this)}})},_newBillingAddressHandler:function(t){if(t.ok)return e.mask(this.container),this.cart.savePromise({BillTo:t.selectedAddress.get("id")},{patch:!0}).then((()=>{this.render()}))},_displayErrorQuoteMessage:function(){this.container.getElement(".mpf-section-body").setContent([t.createElement("span",{class:"fonticon fonticon-wrong"}),f.get("errorQuoteSeller")])},_createBuyerAddressBookButton:function(){return t.createElement("span",{text:f.get("download"),events:{click:this.buyerAddressBook.show.bind(this.buyerAddressBook)}})},_checkPrototypes:function(t){o.requiredOfPrototype(t.countries,i,"options.countries must be a CountryCollection"),o.requiredOfPrototype(t.me,s,"options.me must be a PersonModel"),o.requiredOfPrototype(t.cart,c,"options.cart must be a CartModel"),o.requiredOfPrototype(t.cartItems,d,"options.cartItems must be a CartItemCollection"),o.requiredOfPrototype(t.cartQuote,u,"options.cartQuote must be a CartQuoteModel"),o.requiredOfPrototype(t.addressFactory,m,"options.addressFactory must be an AddressFactory"),o.requiredOfPrototype(t.companyFactory,y,"options.companyFactory must be a CompanyFactory"),o.requiredOfPrototype(t.cartFactory,p,"options.cartFactory must be a CartFactory"),o.requiredOfPrototype(t.cartItemFactory,C,"options.cartItemFactory must be a CartItemFactory"),this.sellerView||(o.requiredOfPrototype(t.addresses,h,"options.addresses must be an AddressCollection"),this.buyerType===n.COMPANY&&o.requiredOfPrototype(t.company,r,"options.company must be a CompanyModel"))}})})),define("DS/MPFBiddingContractQuoteNoteComponent/NotesSection",["UWA/Core","DS/UIKIT/Popover","DS/MPFServices/ObjectService","DS/MPFNoteModel/NoteModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemCollection","DS/MPFView/FieldTextInputV2","DS/MPFBiddingContractQuoteNoteComponent/BiddingContractSection","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent"],(function(t,e,o,n,i,s,r,c,a){"use strict";return c.extend({setup:function(t={}){o.requiredOfPrototype(t.note,n,"options.note must be a NoteModel"),o.requiredOfPrototype(t.cartItems,s,"options.cartItems must be a CartItemCollection"),t.additionalClassName="mpf-notes-section mpf-horizontal",this._parent(t),this.note=t.note,this.cartItems=t.cartItems},createTitle:function(){const o=t.createElement("span",{class:"fonticon fonticon-info"});return new e({target:o,position:"bottom",body:a.get("infoNotes"),trigger:"hover touch"}),[a.get("notes"),o]},createBody:function(){return this.internalReferenceInput&&this.internalReferenceInput.destroy(),this.privateNotesInput&&this.privateNotesInput.destroy(),this.internalReferenceInput=this._createInternalRefernceInput(),this.privateNotesInput=this._createPrivateNotesInput(),[this.internalReferenceInput.render(),this.privateNotesInput.render()]},destroy(){this.internalReferenceInput&&this.internalReferenceInput.destroy(),this.privateNotesInput&&this.privateNotesInput.destroy(),this.internalReferenceInput=null,this.privateNotesInput=null,this.note=null,this.cartItems=null,this._parent(),this.container=null},_createInternalRefernceInput(){const t=this.cartItems.first().getState();return new r({model:this.note,fieldLabel:a.get("internalReference"),fieldName:n.Fields.INTERNAL_REFERENCE,saveOnChange:!0,dynamicValidation:!0,readOnly:!(t===i.STATUS.draft||t===i.STATUS.submitted||t===i.STATUS.accepted)})},_createPrivateNotesInput(){return new r({model:this.note,fieldLabel:a.get("privateNotes"),fieldName:n.Fields.PRIVATE_NOTES,saveOnChange:!0,dynamicValidation:!0,multiline:!0,multilineRows:4})}})})),define("DS/MPFBiddingContractQuoteNoteComponent/DeliveryTrackingSection",["UWA/Core","DS/UIKIT/Popover","DS/MPFBiddingContractQuoteNoteComponent/BiddingContractSection","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFView/AsyncValidationTextInput","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent"],((t,e,o,n,i,s,r,c,a)=>{"use strict";const d=Object.freeze({NOT_AVAILABLE:"notAvailable",READ_ONLY:"readOnly",EDIT:"edit"});return o.extend({className:"mpf-bidding-contract-section mpf-delivery-tracking-section",setup(t){this.me=t.me,this.shop=t.shop,this.cart=t.cart,this.cartItems=t.cartItems,this.company=t.company,this._parent(t)},destroy(){this.stopListening(),this.me=null,this.shop=null,this.cart=null,this.cartItems=null,this._parent(),this.container=null},createTitle(){const o=t.createElement("span",{class:"fonticon fonticon-info"});return new e({target:o,position:"bottom",body:a.get("deliveryTrackingInfo"),trigger:"hover touch"}),[a.get("deliveryTracking"),o]},createBody(){const t=this.cartItems.getDeliveryServiceItems();let e;switch(this._initState()){case d.READ_ONLY:e=this._createReadOnlyView({deliveryItems:t});break;case d.EDIT:e=this._createEditView({deliveryItems:t});break;default:e=this._createNotAvailableView()}return e},createLink(){},async _save(t,e,{value:o}){const n=new r,i=t.get("id"),s=new c(c.Operations.MODIFY,`/cart-items/${i}`,{[e]:o});n.add(s);try{return await this.cart.megaPatch(n,{parse:!1,silent:!0}),{isValid:!0}}catch(t){return console.error(t),{isValid:!1,errorMessage:a.get("failedToSaveChanges")}}},_initState(){let t;const e=this.cart.getGlobalState();if(e===n.GlobalStates.SHIPPED){const e=this.company&&this.me.isAdminOfThisEMP(this.company.getEmpProjectName());t=this.shop.id===this.cart.getShopId()&&(this.me.isSeller()||e)?d.EDIT:d.READ_ONLY}else t=e===n.GlobalStates.DELIVERED?d.READ_ONLY:d.NOT_AVAILABLE;return t},_createNotAvailableView:()=>t.createElement("div",{class:"mpf-message-box",text:a.get("deliveryTrackingNotAvailable")}),_createEditView({deliveryItems:e}){return e.map((e=>{const o=new s({model:e,fieldName:i.Fields.DELIVERY_TRACKING_NUMBER,fieldLabel:a.get("number"),iconClass:"floppy",asyncValidation:this._save.bind(this,e,i.Fields.DELIVERY_TRACKING_NUMBER)}),n=new s({model:e,fieldName:i.Fields.DELIVERY_TRACKING_PROVIDER,fieldLabel:a.get("provider"),iconClass:"floppy",asyncValidation:this._save.bind(this,e,i.Fields.DELIVERY_TRACKING_PROVIDER)});return t.createElement("div",{class:"mpf-delivery-infos mpf-horizontal",html:[o.render(),n.render()]})}),this)},_createReadOnlyView:({deliveryItems:e})=>e.map((e=>t.createElement("dl",{class:"mpf-delivery-tracking",html:[{tag:"dt",class:"mpf-key",text:a.get("number")},{tag:"dd",class:"mpf-value",text:e.get(i.Fields.DELIVERY_TRACKING_NUMBER)||"-"},{tag:"dt",class:"mpf-key",text:a.get("provider")},{tag:"dd",class:"mpf-value",text:e.get(i.Fields.DELIVERY_TRACKING_PROVIDER)||"-"}]})))})})),define("DS/MPFBiddingContractQuoteNoteComponent/BiddingContractQuoteNoteComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFBuyer/BuyerType","DS/MPFView/EmptyView","DS/MPFCountryModel/CountryCollection","DS/MPFPersonModel/PersonModel","DS/MPFTcDocumentModel/TcDocumentModel","DS/MPFTCContractModel/TCContractModel","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemCollection","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFNoteModel/NoteModel","DS/MPFAddressModel/AddressCollection","DS/MPFAddressModel/AddressFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartItemFactory","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFInvoiceModel/InvoiceDocumentFactory","DS/MPFBiddingContractQuoteNoteComponent/NDASection","DS/MPFBiddingContractQuoteNoteComponent/QuoteSection","DS/MPFTcContractComponent/SellerSalesConditionsOrder","DS/MPFBiddingContractQuoteNoteComponent/NotesSection","DS/MPFBiddingContractQuoteNoteComponent/DeliveryTrackingSection","css!DS/MPFBiddingContractQuoteNoteComponent/MPFBiddingContractQuoteNoteComponent"],(function(t,e,o,n,i,s,r,c,a,d,l,u,h,m,y,p,C,D,F,M,f,S,P,I,g,v,A,_,T,N,b){"use strict";return e.extend({className:"col-md-12 container-fluid mpf-bidding-contract-quote-note",setup:function(t={}){this._parent(t),this.sellerView=!0===t.sellerView,this.service=t.service||n.MAKE,this._checkPrototypes(t),this.buyerType=t.buyerType,this.countries=t.countries,this.me=t.me,this.ndaDocument=t.ndaDocument,this.salesContract=t.salesContract,this.salesDocument=t.salesDocument,this.cart=t.cart,this.cartItems=t.cartItems,this.cartQuote=t.cartQuote,this.addresses=t.addresses,this.company=t.company,this.shop=t.shop,this.addressFactory=t.addressFactory,this.companyFactory=t.companyFactory,this.cartFactory=t.cartFactory,this.cartItemFactory=t.cartItemFactory,this.tcDocumentFactory=t.tcDocumentFactory,this.tcContractFactory=t.tcContractFactory,this.invoiceDocument=t.invoiceDocument,this.invoiceDocumentFactory=t.invoiceDocumentFactory,this.note=t.note,this.ndaSection=this._createNdaSection(),this.salesDocument&&(this.salesConditionsSection=this.createSellerSalesConditionsSection()),this.quoteSection=this._createQuoteSection(),this.notesSection=this.shop?this._createNotesSection():s.getInstance(),this.deliveryTrackingSection=this._createDeliverySection(),this.listenTo(this.cart,"onSync",this._onSync.bind(this)),this.listenTo(this.cartItems,"onChange:"+m.Fields.STATE,this.render.bind(this))},render:function(){const e=[this.ndaSection.render()],o=[];return t.is(this.shop)&&!this.shop.isInternal()&&(e.push(this.quoteSection.render()),t.is(this.salesConditionsSection)&&o.push(this.salesConditionsSection.render())),e.push(this.deliveryTrackingSection.render()),o.push(this.notesSection.render()),this.container.setContent([{tag:"div",class:"col-md-6 mpf-left-column",html:e},{tag:"div",class:"col-md-6 mpf-right-column",html:o}]),this},destroy(){this.stopListening(),this.ndaSection.destroy(),this.quoteSection.destroy(),this.notesSection.destroy(),this.deliveryTrackingSection.destroy(),this.salesConditionsSection&&this.salesConditionsSection.destroy(),this.ndaSection=null,this.quoteSection=null,this.notesSection=null,this.salesConditionsSection=null,this.cart=null,this.cartItems=null,this.countries=null,this.cartQuote=null,this.addresses=null,this.company=null,this.shop=null,this.note=null,this.addressFactory=null,this.companyFactory=null,this.cartFactory=null,this.cartItemFactory=null,this.tcDocumentFactory=null,this.tcContractFactory=null,this.invoiceDocument=null,this.invoiceDocumentFactory=null,this._parent(),this.container=null},_onSync(){this.cartItems.reset(this.cart.getItems()),this.render()},_createNdaSection(){return new A({ndaDocument:this.ndaDocument})},_createNotesSection(){return new N({note:this.note,cartItems:this.cartItems})},_createDeliverySection(){return new b({cart:this.cart,cartItems:this.cartItems,shop:this.shop,me:this.me,company:this.company})},_createQuoteSection(){return new _({sellerView:this.sellerView,buyerType:this.buyerType,countries:this.countries,me:this.me,cart:this.cart,cartItems:this.cartItems,cartQuote:this.cartQuote,company:this.company,addresses:this.addresses,addressFactory:this.addressFactory,companyFactory:this.companyFactory,cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory})},createSellerSalesConditionsSection(){return new T({service:this.service,sellerView:this.sellerView,shop:this.shop,tcContractFactory:this.tcContractFactory,tcDocumentFactory:this.tcDocumentFactory,salesContract:this.salesContract,salesDocument:this.salesDocument})},_checkPrototypes:function(e){o.requiredOfPrototype(e.countries,r,"options.countries must be a CountryCollection"),o.requiredOfPrototype(e.note,D,"options.note must be a NoteModel"),o.requiredOfPrototype(e.me,c,"options.me must be a PersonModel"),o.requiredOfPrototype(e.addressFactory,M,"options.addressFactory must be an AddressFactory"),o.requiredOfPrototype(e.companyFactory,f,"options.companyFactory must be a CompanyFactory"),o.requiredOfPrototype(e.cartFactory,S,"options.cartFactory must be a CartFactory"),o.requiredOfPrototype(e.cartItemFactory,P,"options.cartItemFactory must be a CartItemFactory"),o.requiredOfPrototype(e.cart,h,"options.cart must be a CartModel"),o.requiredOfPrototype(e.cartItems,y,"options.cartItems must be a CartItemCollection"),o.requiredOfPrototype(e.cartQuote,p,"options.cartQuote must be a CartQuoteModel"),o.requiredOfPrototype(e.tcContractFactory,I,"options.tcContractFactory must be a TCContractFactory"),o.requiredOfPrototype(e.tcDocumentFactory,g,"options.tcDocumentFactory must be a TCDocumentFactory"),o.requiredOfPrototype(e.invoiceDocumentFactory,v,"options.invoiceDocumentFactory must be an InvoiceDocumentFactory"),o.requiredOfPrototype(e.salesContract,d,"options.salesContract must be a TCContractModel"),t.is(e.shop)&&o.requiredOfPrototype(e.shop,u,"options.shop must be a ShopModel"),""!==e.cart.getBuyerInvoiceDocumentPid()&&o.requiredOfPrototype(e.invoiceDocument,C,"options.invoiceDocument must be an InvoiceDocumentModel"),t.is(e.ndaDocument)&&o.requiredOfPrototype(e.ndaDocument,a,"options.ndaDocument must be a TcDocumentModel"),t.is(e.salesDocument)&&o.requiredOfPrototype(e.salesDocument,a,"options.salesDocument must be a TcDocumentModel"),this.sellerView||(o.requiredOfPrototype(e.addresses,F,"options.addresses must be an AddressCollection"),this.buyerType===i.COMPANY&&o.requiredOfPrototype(e.company,l,"options.company must be a CompanyModel"))}})})),define("DS/MPFBiddingContractQuoteNoteComponent/BiddingContractQuoteNoteFactory",["UWA/Core","UWA/Class","UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFServices/MarketplaceServices","DS/MPFInvoiceModel/InvoiceDocumentFactory","DS/MPFBuyer/BuyerType","DS/MPFCompanyModel/CompanyHelper","DS/MPFCompanyModel/CompanyFactory","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFNoteModel/NoteFactory","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFBiddingContractQuoteNoteComponent/BiddingContractQuoteNoteComponent"],(function(t,e,o,n,i,s,r,c,a,d,l,u,h,m,y){"use strict";return e.extend({init:function(t){t||(t={}),this.service=t.service||s.MAKE,this.me=t.me,this.cart=t.cart,this.shop=t.shop,this.sellerView=t.sellerView},getComponent:function(){return this._getConnector().then(this._initFactories.bind(this)).then(this._initModelsAndCollections.bind(this)).then(this._fetchAllResources.bind(this)).then(this._fetchAddresses.bind(this)).then(this._buildComponent.bind(this))},_getConnector:function(){return n.fetchPromise({service:this.service})},_initFactories:function(t){return this.factoryDispenser=i.getInstance(t),o.all([this.factoryDispenser.getFactory(i.Types.COUNTRY),this.factoryDispenser.getFactory(i.Types.CART),this.factoryDispenser.getFactory(i.Types.TC_CONTRACT),this.factoryDispenser.getFactory(i.Types.TC_DOCUMENT),this.factoryDispenser.getFactory(i.Types.CART_ITEM),this.factoryDispenser.getFactory(i.Types.COMPANY),this.factoryDispenser.getFactory(i.Types.ADDRESS),this.factoryDispenser.getFactory(i.Types.CART_QUOTE),this.factoryDispenser.getFactory(i.Types.SHOP_SERVICE),this.factoryDispenser.getFactory(i.Types.INVOICE_DOCUMENT),this.factoryDispenser.getFactory(i.Types.NOTE)]).then((t=>{this.countryFactory=t[0],this.cartFactory=t[1],this.tcContractFactory=t[2],this.tcDocumentFactory=t[3],this.cartItemFactory=t[4],this.companyFactory=t[5],this.addressFactory=t[6],this.cartQuoteFactory=t[7],this.shopServiceFactory=t[8],this.invoiceDocumentFactory=t[9],this.noteFactory=t[10],this.companyFactory.addressFactory=this.addressFactory}))},_initModelsAndCollections:function(){return this.cartQuote=this.cartQuoteFactory.createModel(l.Types.CART_QUOTE),this.cartItems=this.cartItemFactory.createCollection("cart-items",this.cart.getItems()),this.cartQuote.parentResourceId=this.cart.id,this.cartItems.parentResourceId=this.cart.id,o.resolve()},_fetchAllResources:function(){return o.all([this._fetchCountries(),this._fetchCompany(),this._fetchInvoiceDocument(),this._fetchNote(),this._getNda(),this._getSellerSalesConditions()])},_fetchCountries:function(){return this.countries=this.countryFactory.createCollection("buyer"),this.countries.fetchPromise()},_fetchCompany:function(){let e;if(this.sellerView){const t=this.cart.getCompanyID();t&&(this.company=this.companyFactory.createModel(d.Types.COMPANY,{id:t}),e=this.company.fetchPromise())}else this.company=a.getCompanyFromPerson(this.me,this.companyFactory),t.is(this.company)&&(this.buyerType=c.COMPANY,e=this.company.fetchPromise());return e},_fetchInvoiceDocument:function(){return this.cart.getBuyerInvoiceDocumentPid()?(this.invoiceDocument=this.invoiceDocumentFactory.createModel(r.Types.CART_INVOICE_DOCUMENT),this.invoiceDocument.id=this.cart.getBuyerInvoiceDocumentPid(),this.invoiceDocument.parentResourceId=this.cart.get("id"),this.invoiceDocument.fetchPromise()):o.resolve()},_fetchNote:function(){return this.note=this.noteFactory.createModel(u.Types.CART,{id:""}),this.note.parentResourceId=this.cart.id,this.note.fetchPromise()},_getNda:function(){return this.ndaContract=this.tcContractFactory.createModel(h.Types.NDA),this.ndaContract.setParentResourceId(this.cart.get("id")),this.ndaContract.fetchPromise().then(this._getNdaDocument.bind(this))},_getNdaDocument:function(){return this.ndaContract.isNew()?o.resolve():(this.ndaDocument=this.tcDocumentFactory.createModel(m.Types.DOCUMENTS,{id:this.ndaContract.getDocumentID()}),this.ndaDocument.fetchPromise())},_getSellerSalesConditions:function(){return this.salesContract=this.tcContractFactory.createModel(h.Types.CUSTOM_TC_SELLER),this.salesContract.setParentResourceId(this.cart.get("id")),this.salesContract.fetchPromise().then(this._getSellerSalesConditionsDocument.bind(this))},_getSellerSalesConditionsDocument:function(){return this.salesContract.isNew()?t.is(this.shop)&&t.is(this.shop.getServices()["contract-documents"][0])?(this.salesDocument=this.tcDocumentFactory.createModel(m.Types.DOCUMENTS,{id:this.shop.getServices()["contract-documents"][0].id}),this.salesDocument.fetchPromise()):o.resolve():(this.salesDocument=this.tcDocumentFactory.createModel(m.Types.DOCUMENTS,{id:this.salesContract.getDocumentID()}),this.salesDocument.fetchPromise())},_fetchAddresses:function(){if(!this.sellerView){if(this.buyerType!==c.COMPANY)return this.addresses=this.addressFactory.createCollection("me"),this.me.addresses=this.addresses,this.addresses.fetchPromise();this.addresses=this.company.addresses,this.addresses.parentResourceId=this.company.get("id")}},_buildComponent:function(){return new y({service:this.service,sellerView:this.sellerView,buyerType:this.buyerType,countries:this.countries,me:this.me,ndaDocument:this.ndaDocument,salesContract:this.salesContract,salesDocument:this.salesDocument,cart:this.cart,cartItems:this.cartItems,cartQuote:this.cartQuote,company:this.company,shop:this.shop,addresses:this.addresses,addressFactory:this.addressFactory,companyFactory:this.companyFactory,cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory,tcContractFactory:this.tcContractFactory,tcDocumentFactory:this.tcDocumentFactory,invoiceDocument:this.invoiceDocument,invoiceDocumentFactory:this.invoiceDocumentFactory,note:this.note})}})}));