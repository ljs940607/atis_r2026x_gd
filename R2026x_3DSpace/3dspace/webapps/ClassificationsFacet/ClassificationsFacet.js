define("DS/ClassificationsFacet/InitClassificationCmpUI",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Class","text!DS/ClassificationsFacet/assets/classificationAppsRequire_setting.json"],(function(e,t,i){"use strict";return t.extend({init:function(){this.container=UWA.createElement("div",{class:"classificationPLMNewContainer"}),this.controller={}},setObjectId:function(e){this.objectId=e},getUI:function(t){var o=this;return function(e){var t=Promise.resolve();e.forEach((function(e){t=t.then(e)}))}([function(){if(t.isBookmark)return new Promise((function(e,s){var n=JSON.parse(i).facets.bookmarks.require;require([n],(function(e){o.plmNewFolderActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,appId:"Bookmarks",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:o.container,getClassificationAttributes:!1,isInformationPanel:t.isInformationPanel,objectId:o.objectId,securityContext:t.securityContext,tenant:t.tenant})}));const a=setInterval((function(){o.plmNewFolderActive&&(e(),clearInterval(a))}),100)}))},function(){if(t.isLibrary)return new Promise((function(e,s){var n=JSON.parse(i).facets.library.require;require([n],(function(e){o.plmNewLibraryActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,appId:"Libraries",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:o.container,getClassificationAttributes:!0,attributesReadOnly:!1,isInformationPanel:t.isInformationPanel,objectId:o.objectId,securityContext:t.securityContext,tenant:t.tenant})}));const a=setInterval((function(){o.plmNewLibraryActive&&(e(),clearInterval(a))}),100)}))},function(){if(t.isExportControl)return new Promise((function(s,n){e.getGrantedRoles((function(e){for(var s=0;s<e.length;s++)if(e[s]&&("IPS"===e[s].id||"IPA"===e[s].id||"InternalDS"===e[s].id)){var n=JSON.parse(i).facets.ipexportControl.require;require([n],(function(e){o.plmNewIPProtectionActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,appId:"IPExportControl",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:o.container,getClassificationAttributes:!0,attributesReadOnly:!0,isInformationPanel:t.isInformationPanel,objectId:o.objectId,securityContext:t.securityContext,tenant:t.tenant})}));break}}));const a=setInterval((function(){o.plmNewIPProtectionActive&&(s(),clearInterval(a))}),100)}))}]),this.container},getController:function(){return this.controller.plmNewFolderActive=this.plmNewFolderActive,this.controller.plmNewLibraryActive=this.plmNewLibraryActive,this.controller.plmNewIPProtectionActive=this.plmNewIPProtectionActive,this.controller}})})),define("DS/ClassificationsFacet/service/PLMNewCommonWebService",["UWA/Core","DS/WAFData/WAFData","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","i18n!DS/IPClassifyActive/assets/nls/IPClassifyActive","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyActive/utils/IPClassifyActiveUtil","DS/IPClassifyUXUtil/CredentialsView"],(function(e,t,i,o,s,n,a,r,l){"use strict";return{_orderField:"ds6w:label",_orderBy:"asc",getSetting:function(){return r.getSetting()},setSecurityContext:function(e){this._securityContext=e},get3DSpaceUrl:function(){return new Promise((function(e,t){n.get3DSpaceUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}))},getSearchInfo:function(){return{with_nls:!1,with_indexing_date:!0,select_predicate:["ds6w:label","ds6w:created","ds6w:reservedBy","relcount","taxonomies","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:type","physicalid","ds6w:classificationUsage"],select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25}},getShowContentInViewSetting:function(){return void 0!==window.showContentInView?window.showContentInView:this.getSetting().showContentInView},setOrder:function(e,t){this._orderField=e||this._orderField,this._orderBy=t||this._orderBy},getTenantID:function(){return window.tenantId||n.getTenantID()},getSecurityContext:function(){var e=l.getCredential();if(!e&&widget.hasPreference("Current_security_credentials")){var t=widget.getPreference("Current_security_credentials");void 0!==t.defaultValueNonNls&&null!==t.defaultValueNonNls&&t.hasOwnProperty("defaultValueNonNls")&&(e="ctx::"+t.defaultValueNonNls)}return window.securityContext||e||this._securityContext},getSelect_bo:function(){return["ds6w:label","ds6w:what/ds6w:type","physicalid","ds6w:when/ds6w:created","ds6w:when/ds6w:modified","ds6w:how/ds6w:classification","icon_2ddefaultthb.subtype"]},_getSecurityContext:function(e){var t=this,i=e,o="/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",s="GET",n=i.tenant?i.tenant:this.getTenantID();t.get3DSpaceUrl().then((function(e){var a=e+o+"&tenant="+n,r=widget.lang?widget.lang:widget.getValue("lang");return i.method=s,i.headers={Accept:"application/json","Accept-Language":r,"Content-Type":"application/json"},i.cache=-1,i.withoutSC=!0,t._executeRequest(a,i,!0)}))},fetchContent:function(e,t){return t.payload.specific_source_parameter=this.getSpecific_source_parameter_content(t.pid),t.payload.label=this.getLabel(),t.data=UWA.Json.encode(t.payload),this._executeRequest(e,t,"searchInFolder")},fetch2:function(e){var t=["type","label","ds6w:classification","icon_2ddefaultthb.subtype"],i={};UWA.extend(i,e);var o=e.ids,s=this;o.length&&s.get3DSpaceUrl().then((function(n){console.log(n);var a=n+"/cvservlet/fetch/v2",r=l.getCredential(),c=widget.lang?widget.lang:widget.getValue("lang");i.payload={physicalid:o,label:e.label},i.payload.select_predicate=t,i.query={SecurityContext:r},i.method="POST",i.headers={Accept:"application/json","content-type":"application/json","Accept-Language":c},i.withSecurityToken=!0,i.type="json",i.data=UWA.Json.encode(i.payload);s._executeRequest(a,i,"fetch")}))},flattenedSearch:function(e){var t={};if(UWA.extend(t,e),!UWA.is(t,"object"))throw new Error("Invalid inputs for FolderActiveWebService.searchInActiveBookmark");var i=e.searchKey?e.searchKey:this.generateSearchQuery(e.searchKey,e.pid,e.type),o=this;new Promise((function(e,t){n.get3DSearchUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})).then((function(s){var n=s+"/search",a=widget.lang?widget.lang:widget.getValue("lang");t.payload=o.getSearchInfo(),t.payload.locale=a,t.payload.order_by=o._orderBy,t.payload.order_field=o._orderField,t.payload.query='[ds6w:label]:("*'+i+'*")'+(e.appendQuery?" AND "+e.appendQuery:""),t.payload.tenant=e.tenant?e.tenant:o.getTenantID(),t.payload.resourceid_not_in=e.alreadyPresentIDs,t.payload.next_start=void 0,t.payload.nresults=void 0!==e.nresults?e.nresults:parseInt(nresults)||t.payload.nresults,t.payload.start=void 0,t.payload.source=["3dspace"],t.payload.login={"3dspace":{SecurityContext:o.getSecurityContext()}},t.payload.label=o.getLabel(),delete t.payload.specific_source_parameter,e.pid&&(t.payload.specific_source_parameter=o.getSpecific_source_parameter(e.pid,!0)),t.payload.specific_source_parameter={"3dspace":{additional_query:"AND "+o.getSearchQuery()}},o.getRefineSearch&&(t.payload.refine=o.getRefineSearch()),console.log(t.payload.specific_source_parameter);null!=e.next_start?t.payload.next_start=e.next_start:t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":a,SecurityContext:o._securityContext},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=3e6,o._executeRequest(n,t,"searchInFolder")}))},getLabel:function(e){return"IPNewPLMComponent-"+(window.dsUserLogin?window.dsUserLogin:"unknown")+"-"+(new Date).getTime()},getClassPaths:function(e){var t={};if(UWA.extend(t,e),!UWA.is(t,"object"))throw new Error("Invalid inputs for FolderActiveWebService.searchInActiveBookmark");var i=this;i.get3DSpaceUrl().then((function(o){console.log(o);var n=o+"/cvservlet/navigate",a=widget.lang?widget.lang:widget.getValue("lang"),r=null;e.plmNewContextProvider&&(r=e.plmNewContextProvider),t.payload={},t.payload.locale=a,t.payload.tenant=s.getPlatformId(),t.query={SecurityContext:r||l.getCredential(),tenant:s.getPlatformId()},t.payload.input_physical_ids=e.id,t.payload.attributes=["ds6w:label","physicalid","ds6w:type","ds6w:classification"],t.payload.version=3,t.payload.primitives=[{navigate_to_rel:{id:1}},{navigate_from_rel:{id:2}}],t.payload.patterns={GET_PARENT:[{id:2,iter:-1}]},t.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}},t.payload.source=["3dspace"];var c=new Date;t.payload.label=("PlmNewClassificationFacetNavigate"+c.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.timeout=12e4,t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":a},t.type="json",t.data=UWA.Json.encode(t.payload);i._executeRequest(n,t,"getClassPaths")}))},constructPath:function(e,t="idPathMap"){var i=[];const o=new Map,s=new Map;var n;return e.result.forEach((e=>{var t,a={label:(t=e.outputs.GET_PARENT?e.outputs.GET_PARENT[0]:e.input_object)["ds6w:label"],physicalid:t.physicalid,type:t["ds6w:type"]};i=this.constructPathChain(a,t.paths?t.paths[0]:void 0),n=this.extractPath(i),s.set(i[i.length-1].physicalid,i),o.set(i[i.length-1].physicalid,n)})),"idPathChainMap"===t?s:o},constructPathChain:function(e,t){var i=[];if(i.push(e),null==t||null==t||0==t.length)return i;for(let e=t.length-1;e>=0;e--){var o={label:t[e]["ds6w:label"],physicalid:t[e].physicalid,type:t[e]["ds6w:type"]};i.push(o)}return i},extractPath:function(e){var t=e[0].label;for(let i=1;i<e.length;i++)t=t+" > "+e[i].label;return t},_executeRequest:function(e,t,o){return this.requestList||(this.requestList={}),"getClassPaths"!=o&&"getClassPaths"!=o||(this.requestList[o]&&this.requestList[o].cancel(),this.requestList[o]=null),this.requestList[o]=i._executeRequest(e,t,o),this.requestList[o]}}})),define("DS/ClassificationsFacet/utils/PLMNewClassificationFacetData",["UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/TooltipModel","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel"],(function(e,t,i,o,s){return e.Class.extend({init:function(e){},buildSkeleton:function(e){},_generateSearchData:function(e,i,o){var n=this,a={0:new t};a[0].onPreExpand((function(e){e.data.onlyUI&&e.target.preExpandDone()}));var r={"ds6w:label":"label","ds6w:what/ds6w:type":"type",type_icon_url:"icon",resourceid:"id","ds6w:created":"created","ds6w:modified":"modified","ds6w:when/ds6w:created":"created","ds6w:when/ds6w:modified":"modified","ds6w:how/ds6w:classification":"folderClassification","icon_2ddefaultthb.subtype":"iconType",mxid:"mxid","ds6w:what/ds6w:classificationUsage":"classUsage"};return e.forEach((function(e){var t={},l=e.attributes;l?l.forEach((function(e){var i=r[e.name];i&&(t[i]=e.value),"type"===i&&(t.displayType=e.dispValue),"type_icon_url"===i&&(i.icon=e.value)})):Object.assign(t,e);var c={useAsyncPreExpand:!0};c.value={label:t.label,subLabel:s.loading,icon:[t.icon]},c.label=t.label,c.id=t.id,c.plmType=t.type,c.created=t.created,c.modified=t.modified,c.folderClassification=t.folderClassification,c.iconType=t.iconType,c.mxid=t.mxid,c.classUsage=t.classUsage;var d=e&&e.level?parseInt(e.level):1;c.icons=[i(t)],a[0].addChild(n._createTreeNodeModel(c,a[d-1],o))})),a[0]},createAutocompleteDataTree:function(e){var i=new t({shouldBeSelected:function(e){return e.isSelectable}});return i.getRoots().forEach((function(e,t){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){return e.options.label.localeCompare(t.options.label)>=1?1:-1}})})),i.pushUpdate(),i},_createTreeNodeModel:function(e,s,n,a,r){var l=s instanceof t;e&&e.publishOnConnect&&delete e.publishOnConnect,e&&e.folderClassification&&delete e.folderClassification,e&&e.children&&(e.children=[]),e.useAsyncPreExpand=!0;var c=new i(e);return c.id=e.id,c.plmType=e.plmType,e.isFavorite&&(c.isFavorite=!0),(e.isPersonal||!l&&s.isPersonal)&&(c.isPersonal=!0),e.isExisting&&(c.isExisting=e.isExisting),e.created&&(c.created=e.created),c.getID=function(){var e=this.id;return e&&""!==e||(e=this.plmType),e},c.getLabel=function(){return this.options.label},c.getType=function(){return this.plmType},c.mxid=e.mxid,c.label=e.label,c.options.oldLabel=e.label,c.pathId=(l?"root":s.pathId)+","+c.getID(),c.isSelectable=n(e.plmType),s.prepareUpdate(),l?s.addRoot(c):s.addChild(c,a),s.pushUpdate(),c.updateOptions({tooltip:new o({title:c.options.value&&c.options.value.label?c.options.value.label:c.options.label,shortHelp:r||c.options.label,mouseRelativePosition:!0})}),c}})})),define("DS/ClassificationsFacet/ClassificationFacet",["DS/EditPropWidget/facets/Common/FacetsBase","DS/ClassificationsFacet/InitClassificationCmpUI","DS/ClassificationProp/utils/ClassifPropControl","DS/IPClassifyUtil/IPClassifyUtility"],(function(e,t,i,o){"use strict";return e.extend({init:function(e){var t=this;this._parent(e);var s={};for(var n in e)s[n]=e[n];s.events=s.events?s.events:{},s.events.refreshActions=function(e){t.refreshActions()},o.get3DSpaceUrl(),null!=this.options.securityContextFromAppPreference&&null!=this.options.securityContextFromAppPreference?this.securityContext=this.options.securityContextFromAppPreference:this.options.securityContext?this.securityContext=this.options.securityContext:this.securityContext=widget.data.pad_security_ctx,i.setContext(this.securityContext),this.options=e,this.options.isBookmark=void 0===this.options.isBookmark||this.options.isBookmark,void 0===this.options.isLibrary||!0===this.options.isLibrary?(this.options.isLibrary=!0,i.setSearchQueryFilter(!0,!0)):this.options.isLibrary&&i.setSearchQueryFilter(this.options.isLibrary.definitionPurpose,this.options.isLibrary.categorizationPurpose),this.options.isExportControl=void 0===this.options.isExportControl||this.options.isExportControl,this.options.isInformationPanel=!0,i.setInformationPanel(!0),this.elements.container=UWA.createElement("div",{class:"classificationInformationContainer"}),this.options.isExternal&&(this.getModel=function(){return t._internalModel})},updateFacet:function(){this.elements&&this.elements.plmContainer&&this.elements.plmContainer.destroy();var e=this.getModel();(e&&e._attributes&&"relationship"==!e._attributes.metatype||e&&!e._innerModels)&&(e&&"relationship"===e.get("metatype")&&e.get("selReferenceID")&&(this.objectId=e.get("selReferenceID")),e&&e._attributes&&"relationship"!=e._attributes.metatype&&e._attributes.selReferenceID?this.objectId=e._attributes.selReferenceID:e&&e._attributes&&"relationship"!=e._attributes.metatype&&(this.objectId=e._attributes.objectId)),this.options.isInformationPanel=!0,i.setInformationPanel(!0),this.initUI=new t,this.initUI.setObjectId(this.objectId),i.setObjectId(this.objectId),this.options.securityContext=i.getContext(),this.elements.plmContainer=this.initUI.getUI(this.options),this.elements.plmContainer.inject(this.elements.container)},updateFacetExternal(e){this.setModel(e),this.updateFacet()},setModel:function(e){this._internalModel=e}})})),define("DS/ClassificationsFacet/PLMNewCommomCmpUXController",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/WUXAutoComplete/AutoComplete","DS/Controls/Button","DS/Controls/TooltipModel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Loader","DS/Controls/ModalContainer","DS/Controls/Accordeon","DS/ClassificationsFacet/utils/PLMNewClassificationFacetData","DS/TreeModel/TreeDocument","DS/Controls/Popup","DS/ClassificationProp/facets/Properties/Properties","DS/ClassificationProp/facets/Properties/PropertiesInfo","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/ClassifPropWidget","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/utils/ClassifPropControl","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/CredentialsView","css!DS/ClassificationsFacet/ClassificationsFacet.css"],(function(e,t,i,o,s,n,a,r,l,c,d,p,u,f,m,h,C,g,v,w,P,y,I,b,A){var S=e.extend(t,i,{name:"PLMNewCommomCmpUXController",classIdAndTitleMap:new Map,apiAttributesCall:[],_isProcessing:!1,securityContextMethod:null,isLoaded:!1,_createErrorContainerAlertIcon:()=>{},_updateErrorContainer:()=>{},init:function(e){this._parent(e),this._tenant=e.tenant;var t=this;this.elements.masterContainer=UWA.createElement("div",{class:"plmnew-masterContainer",id:e.appId}),t.counter=0,t.alreadySelectedNodes=[],t.alreadyPresentIDs=[],t.nodeRemoved,P.setProvider(t),"function"==typeof t.updateAttribute&&P&&P.setIPClassifyAlertProvider(b),this.domaincontainer=UWA.createElement("div",{class:"plmnew-domain-container"}).inject(this.elements.masterContainer),this.container=UWA.createElement("div",{class:"plmnew-container",id:e.appId+"plmnew-container"}).inject(this.domaincontainer);let i=e.container;this.elements.masterContainer.inject(i),this.isInformationPanel=e.isInformationPanel,void 0===this.isInformationPanel&&(this.isInformationPanel=P.getInformationPanel()),this.loader=new l,t.plmNewClassificationFacetData=new p,t.accordeonCon=UWA.createElement("div",{class:"plmnew-accordeon-container"}),this.isInformationPanel||t.accordeonCon.inject(t.elements.masterContainer);var o={className:"classification_attributes"};this.isInformationPanel?t.classifPropertiesUIInfo=new h(o,{readOnly:!0}).inject(this.elements.masterContainer):t.classifPropertiesUI=new m(o,{readOnly:!0}).inject(this.elements.masterContainer);var s=null;e.securityContext&&"string"==typeof e.securityContext&&(s=e.securityContext),s=s||A.getCredential(),t.classifPropertiesView=new g({typeOfDisplay:v.ALL,selectionType:v.NO_SELECTION,readOnly:e.attributesReadOnly,setEditButton:!1,context:{getSecurityContext:function(){return{SecurityContext:s}}}}),t.classifPropertiesView.inject(t.accordeonCon),t.classifPropModels=[],this.storageContainer=new u,t.previousPresentIds=[];var n=t._getComponentName();if(!0===e.isRefreshContainer&&this.isInformationPanel){let i=document.getElementById(t.options.appId+"-autocomplete-container");i&&i.remove();let o=document.getElementById(e.appId+"plmnew-container");o&&(o.removeChild(o.firstChild),t.container=o)}if(this.isInformationPanel){var a;let e=!0;I.get(n+"_accordeonPreference",(i=>{e=!i||"collapse"!=i.type,(a=new d({items:[{header:n,content:this.createPLMNewManagement(t.accordeonCon),expandedFlag:e}],style:"filled-separate"}).inject(this.container)).addEventListener("expand",(function(e){I.set(e.options.expanderTarget.header+"_accordeonPreference",{type:e.type},!0)})),a.addEventListener("collapse",(function(e){I.set(e.options.expanderTarget.header+"_accordeonPreference",{type:e.type},!0)}))}))}else this.createPLMNewManagement().inject(this.container)},_closePanel:function(){this.dialog&&this.dialog.close()},createAutocompleteComponent:function(e,t,i,a){var r=this,l=UWA.createElement("div",{class:"plmnew-autocomplete-container"});if(!r.isInformationPanel)UWA.createElement("div",{class:"plmnew-autocomplete-label",html:'<label id="plmnewLabel">'+e+"</label>"}).inject(l);var c=UWA.createElement("div",{class:"plmnew-autocomplete-line"}).inject(l),d=UWA.createElement("div",{class:"plmnew-autocomplete"}).inject(c),p=UWA.createElement("div",{class:"plmnew-button-browse"}).inject(c);r=this;function m(){if(!r.autoComplete.selectedItems||!r.autoComplete.selectedItems.length)return[];var e=[];return r.autoComplete.selectedItems.forEach((t=>{e.push(t.id)})),e}let h=new u;if(r.autoComplete=new o({elementsTree:h,placeholder:y.search,typeDelayBeforeSearch:400,keepSearchResultsFlag:!1,multiSearchMode:!0,minLengthBeforeSearch:0,allowFreeInputFlag:!1,selectedItems:[],popupSizeAdjustPolicy:f.SizeAdjustPolicyEnum.NoAdjust,columnOptions:{autoRowHeightFlag:!0,typeRepresentation:"detailedUser"},getChipInfo:function(e){return{label:e.options.label,icon:e.options.icons[0]}}}).inject(d),r.options.isInformationPanel||r._createErrorContainerAlertIcon(c,l),r.autoComplete.elementsTree=function(e){return e=e.trim().replace(/^\s+/g,""),r.autoComplete.customFilterMessage=y.autoCompleteFilterMessage.no_objects_found,function(e){return!!/[*+?();.,/|@!%#^~$'&_:-=<>\\[\]"]/g.test(e)&&(r.autoComplete.customFilterMessage="Special Characters * ( ) [ ] ; . , / | @ ! % # ^ ~ $ ' & _ : - = < > +  ? \\ \" are not allowed",!0)}(e)?new Promise((e=>{r.autoComplete.customFilterMessage="Special Characters * ( ) [ ] ; . , / | @ ! % # ^ ~ $ ' & _ : - = < > +  ? \\ \" are not allowed",e(new u)})):e.length>=3?new Promise((t=>{let i;var o=[];let s;r.storageContainer.removeRoots(),s="function"==typeof r.PLMNewCommonWebService.isPersonalBookAvailable&&r.PLMNewCommonWebService.isPersonalBookAvailable()?new Promise(((t,i)=>{r.PLMNewCommonWebService.folderTree({pid:"",isPersonalFolder:!0,isRoot:!0,section:"Personal",onComplete:function(i){let s=JSON.parse(i);s.folders&&s.folders.length>0&&s.folders[0].label.toLowerCase().includes(e.toLowerCase())?(o.push(s.folders[0].id),t(s.folders)):t(null)},onFailure:function(){console.log("Error getting Personal Bookmark"),t(null)}})})):Promise.resolve(),"function"==typeof r.PLMNewCommonWebService.getSpecificSearchQuery&&(i=r.PLMNewCommonWebService.getSpecificSearchQuery()),r.PLMNewCommonWebService.flattenedSearch({tenant:r._tenant,appendQuery:i,searchKey:e,alreadyPresentIDs:m(),nresults:5,//!
onComplete:async function(i){let a=await s;if(i.results||o.length>0){if(r.storageContainer.prepareUpdate(),a&&a.length>0&&(i.results&&i.results.length>4&&i.results.pop(),r.createAndInsert(r.storageContainer,a)),i.results&&r.createAndInsert(r.storageContainer,i.results),i.infos&&i.infos.nmatches>5){var l=r.enableBrowseOptionInList(e);r.storageContainer.addRoot(l)}r.storageContainer.pushUpdate(),i.results&&i.results.forEach((e=>{const t=e.attributes.find((e=>"physicalid"===e.name)).value;o.push(t)})),r.PLMNewCommonWebService.getClassPaths({id:o,plmNewContextProvider:r.options.securityContext,onComplete:function(e,t){const o=r.PLMNewCommonWebService.constructPath(e,"idPathMap");r.storageContainer.prepareUpdate(),r.storageContainer.getAllDescendants().forEach((e=>{o.has(e.id)&&e.updateOptions({tooltip:new n({title:e.options.value.label,shortHelp:o.get(e.id),mouseRelativePosition:!0}),subLabel:o.get(e.id),value:{subLabel:o.get(e.id)}})})),r.setClassNameForSearchData(i),"function"==typeof r.setClassUsageForSearchData&&(r.setClassPathForSearchData(i),r.setClassUsageForSearchData(o),P.getInformationPanel()?(r.classifPropertiesUIInfo.setClassPath(r.getClassPath()),r.classifPropertiesUIInfo.setClassUsage(r.getClassUsage())):(r.classifPropertiesUI.setClassPath(r.getClassPath()),r.classifPropertiesUI.setClassUsage(r.getClassUsage()))),r.storageContainer.pushUpdate()},onFailure:function(e){console.error(e)}})}t(r.storageContainer)},onFailure:function(e){console.error(e)}})})):new Promise((e=>{r.autoComplete.customFilterMessage=y.autoCompleteFilterMessage.minimum_3_characters_search,e(new u)}))},"function"==typeof r.getAdditionalNodesAtInit){let e=r.options.isInformationPanel;r.getAdditionalNodesAtInit(h,e,r.options.objectId).then((e=>{e&&e.forEach((e=>{"function"==typeof r.getInitIcon&&(e.icons=[r.getInitIcon(e)]),e.isExisting=!0,function(e){let t=r.plmNewClassificationFacetData._createTreeNodeModel(e,h,r.couldBeSelected,null,r._classPathMap&&r._classPathMap.get(e.id));r.saveNodes&&r.saveNodes(t);h.pushUpdate(),h.value=t;var i=h.getChildren().length;h.getNthRoot(i-1).select()}(e)}))})),"function"==typeof r.getAttributesandClassPathsForExistingClasses&&r.options.isInformationPanel&&(r.classifPropertiesUIInfo.setClassPath(r.getClassPath()),r.classifPropertiesUIInfo.setClassUsage(r.getClassUsage()),r.classifPropertiesUIInfo.setClassPath(r.getAttribute()))}async function g(e,t,i){await e.forEach((e=>{r.addToProcessingCall(v.bind(this,e,t,i.get(e)))}))}var v=function(e,t,i){r.autoComplete.selectedItems;let o=P.getInformationPanel();if(t)return new Promise((t=>{if(r.options.getClassificationAttributes){var s=new C({objectId:e});r.classifPropModels.push(s),w.publish("getnoClassificationAttribute",e,!0),o?r.classifPropertiesUIInfo.setClassIDandTitle(e,i):r.classifPropertiesUI.setClassIDandTitle(e,i),w.subscribe("getAttributesDone",(function(e){t()})),r.classifPropModels.length>0&&r.classifPropertiesView.initDatas(r.classifPropModels,"classificationAttiProp")}else t()}));var s=r.classifPropertiesView.controller._getModel(e);w.publish("getnoClassificationAttribute",e,!1);var n,a=r.classifPropModels.indexOf(s);-1!=a&&r.classifPropModels.splice(a,1),n=o?r.classifPropertiesUIInfo.getAccordeonFromID(e):r.classifPropertiesUI.getAccordeonFromID(e),r.classifPropModels.length>0&&r.classifPropertiesView.initDatas(r.classifPropModels,"classificationAttiProp"),n&&n._removeSection(e)};return r.autoComplete.addEventListener("change",(function(e){let t,i,o=r.isInformationPanel;if(e.dsModel._model.nodeModel_reset)e.dsModel._model.nodeModel_reset=!1;else{var s=e.dsModel._model.getSelectedNodes().length>0?e.dsModel._model.getSelectedNodes():r.autoComplete.selectedItems,n=s[s.length-1];if(n){const e=n.getID();if(null!=e&&"Browse"===e)return n._isSelected=!1,r.autoComplete.selectedItems=r.autoComplete.selectedItems.filter((e=>"Browse"!=e.getID())),void r.browseAssociations();t=!!n.isExisting&&n.isExisting}var a=m(),l=function(){if(!r.autoComplete.selectedItems||!r.autoComplete.selectedItems.length)return new Map;var e=new Map;return r.autoComplete.selectedItems.forEach((t=>{e.set(t.getID(),t.getLabel())})),e}(),c=!1;if(r.previousPresentIds.length<a.length){c=!0;var d=u(a,r.previousPresentIds);if(i=d,!d)return;r.saveNodes&&s.forEach((e=>{r.saveNodes(e)})),r.isConfirmModel&&r.isConfirmModel({removedIds:d,isNodeAdded:c,selectedIdsLabelMap:l}),P.setProvider(r),(r.isResetInProgress&&1!=r.isResetInProgress()||r.isAddAttributesSection&&1==r.isAddAttributesSection())&&(1==d.length?r.addToProcessingCall(v.bind(this,d[0],c,l.get(d[0]))):g(d,c,l))}else if(a.length<r.previousPresentIds.length){!0;var p=u(r.previousPresentIds,a);if(i=p,!p)return;r.isConfirmModel&&o&&r.isResetInProgress&&1!=r.isResetInProgress()?r.isConfirmModel({removedIds:p,isNodeAdded:c,selectedIdsLabelMap:l}):1==p.length?v(p[0],c,l.get(p[0])):g(p,c,l)}!t&&o&&i&&(r.isResetInProgress&&r.isResetInProgress()||function(e,t,i){let o={};o.classId=e,o.IDs=[r.options.objectId],t?"function"==typeof r.addContents&&r.addContents(o,i,{nodeHandler:v,multiNodeHandler:g}):"function"==typeof r.removeContents&&r.removeContents(o,{nodeHandler:v,multiNodeHandler:g})}(i,c,s)),o?n&&(n.isExisting=!1):r._updateErrorContainer(i,c,l),r.previousPresentIds=m()}function u(e,t){return e.filter((e=>!t.includes(e)))}})),new s({displayStyle:"lite",label:y.tooltip_browse,onClick:a,icon:{iconName:"open-in-a-new-window",fontIconFamily:1},showLabelFlag:!1}).inject(p).tooltipInfos=new n({shortHelp:y.tooltip_browse}),l.inject(i),r.autoComplete},createAndInsert:function(e,t){var i=this;result=i.plmNewClassificationFacetData._generateSearchData(t,(function(e){return i._getIcon(e)}),(function(e){return i.couldBeSelected(e)}));let o=[];Object.assign(o,result.getChildren()),o.forEach((function(t){e.prepareUpdate(),e.addChild(t),e.pushUpdate()}))},_processHandler:async function(e){await e.call(),console.log("api call success")},addToProcessingCall:function(e){var t=this;t.apiAttributesCall.push(e),0==t._isProcessing&&(t._isProcessing=!0,t.processCalls())},processCalls:async function(){var e=this;if(0!=e.apiAttributesCall.length)try{for(e._isProcessing=!0;e.apiAttributesCall.length>0;){let t=e.apiAttributesCall.shift();await e._processHandler(t)}}finally{e._isProcessing=!1}else e._isProcessing=!1},createAutocompleteDataTree:function(e){return this.plmNewClassificationFacetData.createAutocompleteDataTree(e)},insertInAutocomplete:function(e,t,i){var o=this;if(t.isSelectable=o.couldBeSelected(t.plmType),o.autoComplete.selectedItems.every((function(e){if(e.id!=t.id)return!0})))return o.plmNewClassificationFacetData._createTreeNodeModel(t.options,e._model,o.couldBeSelected,void 0,i)},setPossibleDatasAutocomplete:function(e,t){e.elementsTree=t},setPossibleDatasAutocompleteSer:function(e,t){e.elementsTree.addRoot(t)},setValuesAutocomplete:function(e,t){e.value=t},_setNodesIdTobeHighLighted:function(e){this._IdsTobeHighLighted=e},enableBrowseOptionInList:function(e){var t={useAsyncPreExpand:!0};return t.label=y.browse_more+" "+e,t.value={label:y.browse_more,subLabel:'There are some more results containing "'+e+'"',icon:"open-in-a-new-window"},t.id="Browse",t.plmType="Browse",t.enableBrowse=!0,t._isSelected=!0,t.getLabel=function(){return"Browse"},this.plmNewClassificationFacetData._createTreeNodeModel(t,new u,(function(e){return!0}))},createPLMNewManagement:function(e){var t=this,i=UWA.createElement("div",{class:"plmnew-autocompletes-container",id:t.options.appId+"-autocomplete-container"});t.autoCompleteName=t._autoCompleteName();t._autocompleteComponent(i);return void 0!==e&&e.inject(i),t.loader.off(),c.removeModal(this.elements.masterContainer),i},browseAssociations:function(e,t,i){this.onClickSelector()}});return S})),define("DS/ClassificationsFacet/PLMNewClassificationFacet",["DS/ENONewWidget/ENONew/View/Facet/ENONewFacetBase","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/utils/ClassifPropControl","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel","DS/ClassificationsFacet/InitClassificationCmpUI","DS/IPClassifyUtil/IPClassifyUtility","css!DS/ClassificationsFacet/ClassificationsFacet.css"],(function(e,t,i,o,s,n,a,r,l){return e.extend(i,o,{name:"PLMNewClassificationFacet",securityContext:null,init:function(e){var i=e;this._parent(e),this.isPLMNewOpen=!0,n.setIsPLMNewCreation(!0),l.get3DSpaceUrl(),this.initUI=new r,this.elements.container=this.initUI.getUI(e),this.plmNewCreationClass=t.createElement("div",{class:"IPClassificationCreationPanel"}).inject(this.elements.container),i.securityContext&&(securityContext=i.securityContext),this.listenToPublishedInfo((function(e,t){if("currentSecurityContext"===e){let e=t.value;securityContext=e}}))},plmNewContextProvider:function(){return securityContext},getUI:function(e){return this.elements.container},postCreation:function(e){var i=this;let o,n,r,l=e[0].identifier,c=new Map;var d;function p(e,t,i){e.length>0&&e.forEach((function(e){function o(e){let o=e.slice(4),s=t.get(o);c.has(i)||c.set(i.toString(),new Set),c.get(i).add(s)}"string"==typeof e&&e.startsWith("fail")?o(e):e&&e.value&&e.value.startsWith("fail")&&o(e.value)}))}if(i.IDsToClassify=[],i.IDsToBookmark=[],i.IDsToProtect=[],i.controller=this.initUI.getController(),i.plmNewFolderActive=i.controller.plmNewFolderActive,i.plmNewIPProtectionActive=i.controller.plmNewIPProtectionActive,i.plmNewLibraryActive=i.controller.plmNewLibraryActive,i.plmNewIPProtectionActive&&(r=!0===window.enableExportAttributes?new Promise((function(e,t){d=e,t})).then((function(e){var t=new s({objectId:l});"IP Export Control"==i.plmNewIPProtectionActive._getComponentName()&&(t.component="IP Export Control"),[].push(t),i.plmNewIPProtectionActive.classifPropertiesView.controller.skeleton.saveClassificationFacet(l,i.plmNewIPProtectionActive.classifPropModels,t,i.plmNewContextProvider())})).catch((e=>{console.log("data issue")})):new Promise((function(e,t){d=e,t}))),i.plmNewFolderActive&&i.plmNewFolderActive.saveRespectiveAssociations){i.plmNewFolderActive.folderActiveActionBar&&i.plmNewFolderActive.folderActiveActionBar.nestedMenuInContext.popover&&i.plmNewFolderActive.folderActiveActionBar.nestedMenuInContext.popover.dispatchEvent("close"),i.plmNewFolderActive.autoComplete&&i.plmNewFolderActive.autoComplete.selectedItems&&i.plmNewFolderActive.autoComplete.selectedItems.length>0&&(i.IDsToBookmark=i.plmNewFolderActive.autoComplete.selectedItems.map((function(e){return e.id})));let e=i.plmNewFolderActive.classIdAndTitleMap;n=new Promise((function(t){i.IDsToBookmark.length>0?i.plmNewFolderActive.saveRespectiveAssociations(l,i.IDsToBookmark,i.plmNewContextProvider).then((function(i){p(i,e,"BookmarksApp"),t()})):t()})).then((function(e){}))}if(i.plmNewLibraryActive&&i.plmNewLibraryActive.saveRespectiveAssociations){i.plmNewLibraryActive.libraryActiveActionBar&&i.plmNewLibraryActive.libraryActiveActionBar.nestedMenuInContext.popover&&i.plmNewLibraryActive.libraryActiveActionBar.nestedMenuInContext.popover.dispatchEvent("close"),i.plmNewLibraryActive.autoComplete&&i.plmNewLibraryActive.autoComplete.selectedItems&&i.plmNewLibraryActive.autoComplete.selectedItems.length>0&&(i.IDsToClassify=i.plmNewLibraryActive.autoComplete.selectedItems.map((function(e){return e.id})));let e=i.plmNewLibraryActive.classIdAndTitleMap;o=new Promise((function(t){i.IDsToClassify.length>0?i.plmNewLibraryActive.saveRespectiveAssociations.call(null,l,i.IDsToClassify,i.plmNewContextProvider).then((function(o){p(o,e,"LibraryApp");var n=new s({objectId:l});[].push(n),i.plmNewLibraryActive.classifPropertiesView.controller.skeleton.saveClassificationFacet(l,i.plmNewLibraryActive.classifPropModels,n,i.plmNewContextProvider()).then((function(e){t()}))})).catch((()=>{console.log("Some save operation failed")})):t()}))}return Promise.allSettled([o,n]).then((()=>{if(i.plmNewIPProtectionActive&&i.plmNewIPProtectionActive.saveRespectiveAssociations){i.plmNewIPProtectionActive.plmNewIPActionBar&&i.plmNewIPProtectionActive.plmNewIPActionBar.nestedMenuInContext.popover&&i.plmNewIPProtectionActive.plmNewIPActionBar.nestedMenuInContext.popover.dispatchEvent("close"),i.plmNewIPProtectionActive.autoComplete&&i.plmNewIPProtectionActive.autoComplete.selectedItems&&i.plmNewIPProtectionActive.autoComplete.selectedItems.length>0&&(i.IDsToProtect=i.plmNewIPProtectionActive.autoComplete.selectedItems.map((function(e){return e.id})));let e=i.plmNewIPProtectionActive.classIdAndTitleMap;i.IDsToProtect.length>0?i.plmNewIPProtectionActive.saveRespectiveAssociations.call(null,l,i.IDsToProtect).then((function(t){p(t,e,"ExportControlApp"),d()})):d()}})),new t.Promise((function(t){Promise.allSettled([n,o,r]).then((()=>{var o={errors:[{errorCode:"ENONEW_FACETS_POSTCREATION",errorMessages:[a.replace(a.get("classificationFailure_subtitle"),{plmnewtype:e[0].type})]}],status:"error",level:"error",title:a.replace(a.get("classificationFailure_title"),{plmnewtype:e[0].type}),subtitle:a.replace(a.get("classificationFailure_subtitle"),{plmnewtype:e[0].type}),message:[a.get("classificationFailure_message")],allowUnsafeHTML:!1,code:"error"};if(0==c.size){var s=a.replace(a.get("classificationSuccessMessage"),{plmnewtype:e[0].type});(o={}).code="200",o.message=[s]}0==i.IDsToBookmark.length&&0==i.IDsToClassify.length&&0==i.IDsToProtect.length&&(o=null),t(o)}))}))},destroy:function(){t.is(this.options.onDestroyCallback,"function")&&this.options.onDestroyCallback(this.options.tabId),this._parent()}})}));