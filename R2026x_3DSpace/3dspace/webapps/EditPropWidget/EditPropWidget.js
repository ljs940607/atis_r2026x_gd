define("DS/EditPropWidget/facets/Properties/EditPropController",["UWA/Class/Model","UWA/Core","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/facets/Properties/Properties","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropBaseUX/scripts/EditPropUtility","DS/EditPropWidget/utils/ClientBLUtils","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l,d,c,u,h,p,m,f,g,v,_){"use strict";var E=_.get("accordion_parameters");var w=o.extend({defaultOptions:{serverName:"",serverUri:"",displayType:u.STANDARD,extraNotif:!1,context:null},getListHandle:null,commitHandle:null,previewUrlHandle:null,init:function(e){var t=this;this._parent.apply(this,arguments),this.getListHandle={handle:null},this.commitHandle={handle:null},this.previewUrlHandle={handle:null};var i={};for(var n in e)i[n]=e[n];i.events=i.events?i.events:{},i.events.onNotification=function(e){t._setError(e.msg?e.msg:e.json,e.eventID,e.customClass)},i.events.onValidActivation=function(e){t._raiseEvent("disableSave",e)},i.events.validateValue=function(e){t.runBLForUI(e).then((function(){t.clientBLexecution=null}))},i.events.onAddActivation=function(e){t.switchAddButton(e)},t.parametersLoaded=!1,t.indexModeParameter=!!e.indexModeParameter,s.subscribe("onTableOpened",(function(e){e!=E||!1!==t.parametersLoaded||t.indexModeParameter||(t.parametersLoaded=!0,t._loadPLMParameters())})),i.events.refreshActions=function(e){t.refreshActions()},this._createUI(i)},isUIReadonly:function(){return this.editPropertiesUI.isReadonly()},_createUI:function(e){var t=this;e.className=this.getTabId(),e.eventThread=this.options.eventThread,this.editPropertiesUI=new c(e,this.getSharedOptions()),this.editPropertiesUI.subscribeEvt("editionSwitched",(function(e){t.switchSaveButton(!!e),t.editPropertiesUI.elements.boutonCancel&&(e?t.editPropertiesUI.elements.boutonCancel.show():t.editPropertiesUI.elements.boutonCancel.hide())}))},nothingToSave:function(){return!this.editPropertiesUI.saveIsNeeded()},onSave:function(){var e=this,t=e.runBLForUI();t&&t.then((function(t){if(!t){var i=e.editPropertiesUI.validateModel(),n=e.getModel();if(i)if(!0===e.options.updateSession){var s=n.changedValues,o=[];for(var a in s)if(null!=a){var r=s[a].value,l=s[a].valueDB;null!=r&&null!=l&&o.push({attribute:a,value:r,valueDB:l})}var d=JSON.stringify(o);"undefined"!=typeof dscef&&dscef.sendString('{"operation":"onOk","operationVersion":"1.0","attributes":'+d+"}")}else e._commitModels([n])}}))},getExtensions:function(){var e=this,t=e.getModel();let n=function(i,n){e.showLoader();new i(widget,e._parent,e.options,n,t,(function(){e._raiseAddExtensionEvent(t),e.hideLoader(),e.onRefresh()}),(function(t){e.hideLoader(),require(["DS/PADUtils/views/PADAlert"],(function(e){e.displayNotification({eventID:"string"==typeof type?type:"info",msg:t})}))}))};require(["DS/EditPropExtensions/UI/AddExtensionsWidget"],(function(s){var o=t.getTenant();let a=t.get("source");a||(a=t.get("sourceName")),i.getInstance({tenant:o,source:a}).getValidSecurityContext({context:e.options.context,onSuccess:function(e){n(s,e)},onFailure:function(t){e._setError(t)}})}),(function(){e._setError("AddExtensionWidget do not exist")}))},onAction:function(e){e===u.ACTION_SWITCH?this.switchEdition():e===u.ACTION_RESET&&(this.editPropertiesUI.resetDisplay(),this.refreshActions())},isActionAvailable:function(e){return e===u.ACTION_SWITCH?!this.editPropertiesUI.getComponentMode():e!==u.ACTION_RESET||this.editPropertiesUI.resizeActionActive()},switchEdition:function(){this.editPropertiesUI._switchEdition()},getButtons:function(){return this.editPropertiesUI.getButtons()},_getUI:function(){return this.editPropertiesUI},onLoad:function(){this.clearAllDatas()},updateFacet:function(){let e=this.getModel();e&&e.get("indexModeParameter")||this.onRefresh()},onRefresh:function(){this.loadModels(this.getModel(),{parameters:!0===this.parametersLoaded})},_cancelListRequest:function(){this.getListHandle&&this.getListHandle.handle&&(this.getListHandle.handle.cancel(),this.getListHandle.handle=null)},_cancelCommitHandle:function(){this.commitHandle&&this.commitHandle.handle&&(this.commitHandle.handle.cancel(),this.commitHandle=null)},_cancelPreviewUrlHandle:function(){this.previewUrlHandle&&this.previewUrlHandle.handle&&(this.previewUrlHandle.handle.cancel(),this.previewUrlHandle=null)},destroyComponent:function(){this._cancelCommitHandle(),this._cancelListRequest(),this._cancelPreviewUrlHandle(),this.clearAllDatas(),this._commandProxy&&this._commandProxy.destroy()},clearAllDatas:function(){var e=this.getModel();e&&e.destroy(),this.setModel(null)},_loadPLMParameters:function(){this.loadModels(this.getModel(),{parameters:!0,attributes:!1})},loadModels:function(t,i){window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_PrepareAjax"):window.top.performance.mark("start_PrepareAjax");var s=this;this.showLoader();var o=t;if(t){var r=h.getServiceForModel(t);if(!0===t.isTransientModel()||r&&!0===r.modelNeeded)this.setModel(o),this.editPropertiesUI.switchComponentMode(!0),this.trackPropInitUXEvent(t,this.getTabId()),this.editPropertiesUI.initData([this.getModel()]),this.hideLoader();else{var c=null;t instanceof e?(s.getModel(o.get("objectId"))||o.clearChangedValue(),c=o.getChangedValues()):o=new a(t),s.getModel(o.get("objectId"))||(s.setModel(o),o.clearChangedValue()),o.keys().forEach((function(e){var t=o.get(e);t instanceof l||"object"!=typeof t||"EditProp_listOfChange"===e||"label"===e||e.startsWith(u.MODEL_FACET_INFO_PREFIX)||e.startsWith(u.MODEL_DS_ATTR)||o.set(e,new l(t))})),s._resetModifFlag(o);var m=o.get("EditProp_listOfChange");if(m&&(o.setChangedValues(m),o.unset("EditProp_listOfChange")),c&&o.setChangedValues(c),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_PrepareAjax"):window.top.performance.mark("end_PrepareAjax"),i&&!1===i.loadModel)this.setModel(o),this.trackPropInitUXEvent(this.getModel(),this.getTabId()),this.editPropertiesUI.initData([this.getModel()],{properties:!0});else{window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_EP_AJAXRequest"):window.top.performance.mark("start_EP_AJAXRequest");var f=!1;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_EP_GetFromDistant"):window.top.performance.mark("start_EP_GetFromDistant"),p.getAsyncRead((function(e){!1===f&&(e?(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_EP_GetFromDistant"):window.top.performance.mark("end_EP_GetFromDistant"),f=!0,s._cancelListRequest(),s._onCompleteLoadModel(e)):function(){s._cancelListRequest();var e=n.getCancelObject();s.getListHandle.handle=e;var t=i&&!0===i.parameters,a=i&&!1!==i.attributes,r={handleRequest:{handle:e},modelList:[o],tenant:o.getTenant(),onComplete:function(i){s.hideLoader(),!1!==f||e.isCancelled()||(f=!0,console.log("Ajax 2"),!0===(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.isDebug:window.top.isDebug)&&console.log("Ajax 2 answered "+(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.now():window.top.performance.now())),s.getListHandle.handle=null,s._onCompleteLoadModel(i,{initTable:!t,buildBehavior:a?u.FORCE_DEFAULT:u.NO_CHANGES}))}};r.plmParams=t,r.attributes=a,r.readonly=s.isUIReadonly(),r.navigateToMain=s.getTabId()===u.FACET_PROPERTIES,r.ignoreKernelAccessChecks=!!s.options.ignoreKernelAccessChecks,d.getListOfAttributes(r)}())}))}}}else this.editPropertiesUI.clear(),this._onCompleteLoadModel({results:[]})},hide:function(){this._parent(),this.editPropertiesUI.clear()},_commitModels:function(e){var t=this;t.commitHandle.handle=null;let n=function(i){t.showLoader(),d.commitModels({handleRequest:t.commitHandle,serverName:t.options.serverName,serverUri:t.options.serverUri,modelList:e,tenant:e[0].getTenant(),securityContext:i&&i.SecurityContext?i.SecurityContext:"",onComplete:function(e){t.hideLoader(),t.commitHandle.handle=null,t._onCompleteCommit(e)}})};{let s=e[0].get("source");s||(s=e[0].get("sourceName")),i.getInstance({tenant:e[0].getTenant(),source:s}).getValidSecurityContext({context:this.options.context,onSuccess:function(e){n(e)},onFailure:function(e){t._setError(e,"error")}})}},_manageNotificationFromAnswer:function(e,t){var i=t,n="error",s="undefined";if(e)if(e.hasOwnProperty("error"))i=e.error;else if(e.hasOwnProperty("notification")){i=(o=e.notification).message,n=o.type?o.type:n,(s=o.code?o.code:"LCERR400101")&&(i={type:"LCERR400100"===s?"MainStaticError":n,message:o.message})}else if(e.hasOwnProperty("errors")&&e.errors.length>0){var o;i=(o=e.errors[e.errors.length-1]).message,n=o.type?o.type:n}else!1===e.success&&(i={message:_.get("Server error"),code:"ERROR"});if(i)if(void 0!==e&&void 0!==e.errors&&null!=e.errors&&2==e.errors.length&&void 0!==e.errors[0].code&&"1900068"===e.errors[0].code&&void 0!==e.errors[1]&&"1500188"!=e.errors[1].code){var a={level:"error",title:UWA.i18n("UpdateObjectfailed"),subtitle:UWA.i18n("UpdateObjectfailedSubtitle"),message:""};f.showMessageOnUI(a.level,a.title,a.subtitle,a.message,!1)}else s&&0==s.localeCompare("LCERR400100")?this._setMainError(i.message,i.type.toLowerCase(),i.customClass):this._setError(i,n.toLowerCase(),i.customClass);return{message:i,type:n.toLowerCase()}},_setError:function(e,t,i){t=t||"error",this._raiseNotification(e,t,i)},_setMainError:function(e,t,i){t=t||"mainstaticerror",this._raiseNotification(e,t,i)},_onCompleteCommit:function(e){var i=this,s="",o=!0,a=!1,r=!1,d=!1,c=null,u=null,h=e.transactionid;h&&(null!==(c=i.getModel(h))&&c.isMergedModel()?(c.resetAllErrors(),c.lockModel(!0),u=c.getMergingModels()):console.log(" --- >> The model retrieved from the update is not the same than the one which has been sent"));var p=e.results,g=!1,E=[],w={created:[],deleted:[],modified:[],ownerChanged:[]};if(e.modifiedObjectsBL&&e.modifiedObjectsBL.forEach((e=>{"Update"===e.action&&w.modified.push({physicalid:e.pid,operation:"update"})})),!1===e.success)i.editPropertiesUI.setError(e.error);else if(e.UXMessage){var b="";e.UXMessage.forEach((e=>{e&&(""!=b&&(b+="<br>"),b+=e)})),f.showMessageOnUI("error",UWA.i18n("UpdateObjectfailed"),UWA.i18n("contactYourAdmin"),b,!1)}else{if(p.forEach((function(e,t){var i=e.status;i<200||i>=300||e.body.oldInstancePhysicalid&&!1===d&&(d=!0)})),p.forEach((function(e,n){var c=!0,h=e.status,p=null;if(h<200||h>=300)p={message:_.get("Error during update"),code:"ERROR",customClass:"errorUpdate"};else{g=!0;var f=null,v=null,b=null,y=null;e.body.physicalid&&(v="object"==typeof e.body.physicalid?e.body.physicalid.value:e.body.physicalid,b=e.body.oldInstancePhysicalid,f=i.getModel(v),null!==u&&null===f&&(f=u[v]));var C=null;if(e.hasOwnProperty("RefreshUI")&&(C=e.RefreshUI.results.attributes),y=!1===d?null==C||null!=C&&0==C.length?{physicalid:v,operation:"update"}:{physicalid:v,operation:"update",attributes:e.RefreshUI.results.attributes}:null==C||null!=C&&0==C.length?{physicalid:v,oldInstancePhysicalid:b,operation:"update"}:{physicalid:v,oldInstancePhysicalid:b,operation:"update",attributes:e.RefreshUI.results.attributes},!1===d)if(null==f){if(null!=e.body.attrID&&null!=e.body.name&&null!=e.body.value){c=!1;var A=i.getModel();if(A)if(V=A.getAttributeFromField("attributeID",e.body.attrID.value,1)){var S=new l(t.clone(V));S.set("value",e.body.value.value),A.set(V.getIdentifier(),S),i._resetModifFlag(A,[V.getIdentifier()]),e.body.physicalid&&e.body.physicalid.value&&w.modified.push({physicalid:e.body.physicalid.value,operation:"update"})}}}else{f.resetAllErrors(),e.body&&e.body.errors&&e.body.errors.length>0?o=!1:(s=_.get("Modification successful"),o=i.options.extraNotif);var D=f.getAttributeFromField("isUXBLAttribute",!0);if(D){for(var I=[],P=0;P<D.length;P++){var T=D[P];T&&(I.push(T.getIdentifier()),f.unset(T.getIdentifier()))}f.clearChangedValue(I)}e.body;var M=f.values(),F=[],W=[],O=!1;for(var x in e.body){var N=e.body[x],R=i._manageNotificationFromAnswer(N);R&&R.message&&(o=!1);var U=N?"object"==typeof N?N.value:N:null,L=N?"object"==typeof N?N.valueDB:U:null;let n=N&&"object"==typeof N?N.dimensionType:null,s=N&&"object"==typeof N?N.unitName:null,r=null;null!=n&&null!=s&&(r=m.getDimensionUnitNLSName(n,s));var k=f.get(x);if(null==k&&null!=M&&(M=f.values()).every((function(e){var t=!0;return e instanceof l&&null!=e.get("select")&&e.get("select")===x&&(k=e,x=e.getIdentifier(),t=!1),t})),k){var V,j=!!k&&!0===k.get("multivalue");(V=t.clone(k)).setError(R.message,R.type,!0);var B="current"!=x&&"owner"!=x,q=null!==U&&("error"!==R.type||!R.message);if(q){if(B){var H=U;if(Array.isArray(U)&&(H=U.length>0?U[0]:""),"#DENIED!"===H){a=!0,O=!0;break}"description"==x&&(U=H),null==L&&(L=U);var z=U,Y=L;if(j){var X=null!=U;z=Array.isArray(U)?U:X?[U]:[],Y=Array.isArray(L)?L:X?[L]:[]}else{X=null!=U;z=Array.isArray(U)?U.length>0?U[0]:"":U||"",Y=Array.isArray(L)?L.length>0?L[0]:"":L||""}if(V.set("value",z),V.set("valueDB",Y),void 0!==V.get("dimension")&&null!==V.get("dimension")&&null!==r&&V.get("dimension")!==r&&null!==n&&null!==s){V.set("unitName",s),V.set("dimension",r);let e={valueDB:Y,dimension:r};i.updateValueStoredInTweakerMemory(x,e)}i.updateMenuOfMultiSel(x)}W.push(x)}f.attributeHasChanged(x)&&!q||F.push(x),V instanceof l||(V=new l(V)),f.set(x,V)}}i._resetModifFlag(f,F),f.saveInitialValues(W)}else r=!0,null==b&&(b=v),null==f&&null==(f=i.getModel(b))&&null!==u&&(f=u[b]),null!=f&&f.clearChangedValue(),E.push([v]);!O&&e.body&&e.body.errors&&e.body.errors.forEach((function(e){O=O||"unaccessible"===e.code})),c&&y&&(O?w.deleted.push(y):e.body&&e.body.owner?w.ownerChanged.push(y):w.modified.push(y))}i._manageNotificationFromAnswer(e.body,p)})),!0===d){var y=n.getWidgetPreference("changeControl"),C=null;null!=y&&""!==y.value&&y.value&&(C=y.value),require(["DS/WidgetServices/commandProxy/CommandProxy"],(function(e){e.publishSelect({data:{paths:E,pathsInst:!0,defaultFacetName:"instance",changeControl:C}})}))}!0===g&&require(["DS/PADUtils/PADCommandProxy"],(function(e){var t=[],i=[],n=[];w.modified.forEach((function(e){t.push(e.physicalid);var i=null,s=null;if(!0===d){i=e.physicalid,null==(s=e.oldInstancePhysicalid)&&(s=e.physicalid);var o=null;null!=i&&null!=s&&null!==(o={modified:i,previous:s})&&n.push(o)}})),w.ownerChanged.forEach((function(e){t.push({physicalid:e.physicalid,key:"ownerChanged"})})),w.deleted.forEach((function(e){i.push(e.physicalid)}));var s={modified:t};i.length>0&&(s.deleted=i);var o=null;o=n.length>0?{authored:n}:{authored:s};var a=e.create();a.authored({authored:!0}),a.refresh(o),a.destroy()}))}if(c&&setTimeout((function(){c.lockModel(!1)})),!0===r){b=_.get("instanceEvolved");i.editPropertiesUI.addInfo(b)}o&&""!=s&&i.editPropertiesUI.showNotification(s),!0===a&&this.onRefresh();var A={numberObjects:p?p.length:0,actionStatus:!0===g?v.success:v.failure};i.lastTrackerEvent=v.createValidationEventFromEvent(A,i.lastTrackerEvent),v.checkAndTrackPageEvent(i.lastTrackerEvent)},_buildFromResponse:function(e,t,i){var n=this,s={modifyAccess:!0,oneSuccess:!1,allAttributeAreRO:!0,plmparams:null};if(!1!==e.success){for(var o=e.transactionid,l=e.results,c=l?l.length:0,u=0;u<c;u++){var h=l[u];n._manageNotificationFromAnswer(h);var p=null;p=null!=o?o:n._getID(h);var f=n.getModel(p),g=n._getMetaType(h),v=null,_=!1;if(f&&f.isMergedModel()){v={};var E=h.ids,w=f.getMergingModels();E.forEach((function(e){var t=w[e];if(null==t){_=!0;var i=UWA.clone(f.getOptions());i.objectId=e,i.metatype=g,t=new a(i)}v[e]=t}))}if(_||null==f){if(!_){var b=n.getOccurrence();if(null===b)return console.log(" --- >> No current occurence"),{};if(null!==b.getModel(this.getTabId()))return console.log(" --- >> A model already exist for properties tab"),{};if(!f&&o)return console.log(" --- >> A merged model is returned for a single model"),{}}var y=n.getOccurrence().getAllModels(!0,!0);t={metatype:g,objectId:p};y&&y.length>0&&((t=UWA.clone(y[0].getOptions())).objectId=p,t.metatype=g),null!=v?(f=new r(t)).setMergingModels(v):f=new a(t),f.clearChangedValue()}if(h.isUXBLDeployed&&f.set("isUXBLDeployed",h.isUXBLDeployed),g&&f.set("metatype",g),n.setModel(f),h.extensions)for(var C in h.extensions)i[C]=h.extensions[C];var A=m.getPreviewUrl(h);n._cancelPreviewUrlHandle(),A||h.DomainCentric||d.getPreviewUrl({handleRequest:n.commitHandle,modelList:[f],tenant:f.getTenant(),onComplete:function(e){n.previewUrlHandle.handle=null,e.forEach((function(e){var t=n.getModel(e.id);null!=t&&e.preview&&(e.preview.indexOf("icons")<0||!t.get("type_icon_url"))&&t.set("previewUrl",e.preview)}))}});var S=m.fillFromServer(h,f,t);s.modifyAccess=!1!==S.modifyAccess&&s.modifyAccess,s.oneSuccess=s.oneSuccess||S.success,s.allAttributeAreRO=s.allAttributeAreRO&&S.allAttributeAreRO,s.plmparams=!1!==s.plmparams&&S.plmparams}n.editPropertiesUI._ManageValidButton()}return s},_onCompleteLoadModel:function(e,t){this.hideLoader(),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_EP_AJAXRequest"):window.top.performance.mark("end_EP_AJAXRequest"),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_EP_DataTreatement"):window.top.performance.mark("start_EP_DataTreatement"),t||(t={initTable:!0,buildBehavior:u.FORCE_DEFAULT});var i=e.options;i&&(void 0!==i.showSections&&this.editPropertiesUI.setOption("showSections",!0===i.showSections),void 0!==i.autoExpand&&this.editPropertiesUI.setOption("sectionAutoexpand",!0===i.autoExpand));var n=this,s={};this._manageNotificationFromAnswer(e);var o=this._buildFromResponse(e,t,s),a=o.modifyAccess&&!o.allAttributeAreRO&&(!this.isReadOnly()||"false"===this.isReadOnly());!0!==a&&!0!==t.initTable||(this.editPropertiesUI.switchComponentMode(!a),this.updateReadWriteAccess(a)),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_EP_DataTreatement"):window.top.performance.mark("end_EP_DataTreatement"),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_EP_DataDisplay"):window.top.performance.mark("start_EP_DataDisplay");var r=n.getModel(),l=o.oneSuccess&&r?[r]:[];n.showUXnotifs(r),this.editPropertiesUI.setAccordionProperties(s),l&&l.length>0&&(l[0].facet="prop"),l&&l.length>0&&this.trackPropInitUXEvent(l[0],this.getTabId()),this.editPropertiesUI.initData(l,{edition:t.buildBehavior,properties:!0});var d=!1;this._sharedOptions&&this._sharedOptions.editMode&&(d=!0),this.switchSaveButton(d),this.editPropertiesUI.elements.boutonCancel&&(d?this.editPropertiesUI.elements.boutonCancel.show():this.editPropertiesUI.elements.boutonCancel.hide()),o.plmparams&&n.editPropertiesUI.addSection({section:E},!0)},_getID:function(e){return e.physicalID},_getMetaType:function(e){return e.metatype},_resetModifFlag:function(e,t){e.clearChangedValue(t),this.editPropertiesUI._ManageValidButton()},changeAttributes:function(e){this.editPropertiesUI.changeAttributes(e)},trackPropInitUXEvent:function(e,t,i){if(e&&e instanceof a){var n=e._innerModels?Object.keys(e._innerModels).length:1,s=null;e&&e._attributes&&e._attributes.source&&(s=e._attributes.source);var o=null;1==n&&e._attributes&&e._attributes._DS_ATTR_type&&e._attributes._DS_ATTR_type.valueDB&&(o=e._attributes._DS_ATTR_type.valueDB),1==n&&!o&&e&&e._attributes&&e._attributes.type&&e._attributes.type.valueDB&&(o=e._attributes.type.valueDB),1==n&&!o&&e&&e._attributes&&e._attributes["ds6w:type"]&&(e._attributes["ds6w:type"].value||e._attributes["ds6w:type"].valueDB)&&(o=e._attributes["ds6w:type"].value||e._attributes["ds6w:type"].valueDB);let a="Information Properties Facet";a=t&&"instance"===t.toLowerCase()?"Information Instance Facet":"Information Properties Facet";var r={UXName:"Properties",UXContext:a,numberObjects:n,typeObjects:o};i&&i.domain&&(r.domainObjects=i.domain),s&&(r.source=s),i&&i.service&&(r.source=i.service),i&&i.relativePath&&(r.serviceName=i.relativePath),this.lastTrackerEvent=v.createInitActionEvent(r),v.checkAndTrackPageEvent(this.lastTrackerEvent)}},_raiseAddExtensionEvent:function(e){let t=this,i={authored:{modified:[{physicalid:e.get("objectId"),key:"addExtension"}]}};require(["DS/WidgetServices/commandProxy/CommandProxy"],(function(e){t._commandProxy=e.create({}),t._commandProxy.publishAddExtensionEvent(i)}))},updateValueStoredInTweakerMemory:function(e,t){let i=this._getUI();if(i&&"function"==typeof i.getFormSection){let n=i.getFormSection();if(n&&"function"==typeof n.getOrganizers){let i=n.getOrganizers();if(i&&"object"==typeof i)for(let n in i){let s=i[n];if(s&&s._forms){let i=s._forms;if(i&&Array.isArray(i))for(let n=0;n<i.length;n++){let s=i[n];if(s&&s.fields&&Array.isArray(s.fields)){let i=s.fields;for(let n=0;n<i.length;n++){let s=i[n];if(s&&s._idAttr&&s._idAttr===e&&s._tweaker&&s._tweaker.data&&s._tweaker.data.value&&s._tweaker.data.value.valueDB&&s._tweaker.data.value.dimension)return s._tweaker.data.value.valueDB=t.valueDB,s._tweaker.data.value.dimension=t.dimension,void(s._tweaker._updateUIAfterCommitOfModels=!0)}}}}}}}},getTypeValue(e){var t=e.get("_DS_ATTR_type");if(t||(t=e.get("type")),t)return t.valueDB},runBLForUI:function(e){var t=this;return console.log("vma12: runBLForUI"),this.clientBLexecution||(this.clientBLexecution=new UWA.Promise((function(i,n){var s=!1,o=t.getModel();if(e){function c(e,n){let o=t.getTypeValue(n);if(o)return e.push({type:o,objectId:n.get("objectId")}),!0;setTimeout((function(){console.error("type not found for client BL execution"),t.clientBLexecution=null,i(s)}))}var a=[];if(o.isMergedModel()){let u=o.getMergingModels();Object.keys(u).every((e=>{var t=u[e];return c(a,t)}))}else c(a,o);var r=g.getUIAttributesForBL(o),l={objectList:a,objectKind:"bus"===o.get("metatype")?"bus":"rel",attributes:r,modifiedAttribute:[e.get("path")]};d.runBusinessRuleForUI({brID:4,data:[l],modelList:[o],onSuccess:function(e){var n;e&&"success"===e.status&&(console.log("success"),e.result&&(n=g.setModifiedAttributes(o,e.result),Object.keys(n.updateUIAttribute).length>0&&t.editPropertiesUI.updateFormSection(n.updateUIAttribute,o),s=t.showUXnotifs(o),t.editPropertiesUI._ManageValidButton())),t.clientBLexecution=null,i(s)},onFailure:function(e){t.clientBLexecution=null,i(s)},onTimeout:function(){t._raiseNotification(_.get("UXBLTimeout"),"warning","timeout"),t.clientBLexecution=null,i(s)}})}else setTimeout((function(){t.clientBLexecution=null,i(s)}))}))),this.clientBLexecution},showUXnotifs:function(e,t){var i=this,n=!1;if(e){var s={},o=e.getAllAttributes();Object.keys(o).forEach((e=>{var a=o[e];if(a&&a.notif&&a.notif.sev&&a.notif.msg){let e=a.notif.sev;if(1==e&&(s[a.name]={notif:{sev:1,msg:a.notif.msg}}),t&&1!=e)return;var r;if(1==e&&a.visible&&(n=!0),1==e)return;2==e?r="warning":3==e&&(r="info");var l=a.label+": "+a.notif.msg;i._raiseNotification(l,r,a.name)}})),setTimeout((()=>{i.editPropertiesUI.updateFormSection(s)}))}return n},updateMenuOfMultiSel:function(e){let t=this;if(t.twFields=t._getTweakerFields(),!t.twFields)return;let i=t.twFields[e];if(i&&i._tweaker&&t.getModel()&&t.getModel()instanceof a&&t.getModel().isMergedModel()&&(i._tweaker._updateMenuInMultiSelUI=!0),i&&i._tweaker&&i._tweaker.twStrElement&&i._tweaker.twStrElement.possibleValues&&Array.isArray(i._tweaker.twStrElement.possibleValues)){let e=i._tweaker.twStrElement.possibleValues.length,t=i._tweaker.twStrElement.possibleValues[e-1];t&&"reset_value"===t.value&&!1===t.disabled&&(t.disabled=!0)}},_getTweakerFields:function(){let e=this._getUI(),t={};if(e&&"function"==typeof e.getFormSection){let i=e.getFormSection();if(i&&"function"==typeof i.getOrganizers){let e=i.getOrganizers();if(e&&"object"==typeof e)for(let i in e){let n=e[i];if(n&&n._forms){let e=n._forms;if(e&&Array.isArray(e))for(let i=0;i<e.length;i++){let n=e[i];if(n&&n.fields&&Array.isArray(n.fields)){let e=n.fields;for(let i=0;i<e.length;i++){let n=e[i];t[n._idAttr]=n}}}}}}}return t}});return w})),define("DS/EditPropWidget/UI/EditPropSkeleton",["UWA/Json","DS/EditPropWidget/UI/IDCardManager","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n){"use strict";var s="EditProp_MasterContain";return t.extend({defaultOptions:{className:"",typeOfDisplay:i.ALL,setEditButton:!1,displayType:i.STANDARD},init:function(e,t){var n=this;t.typeOfDisplay=t.typeOfDisplay?t.typeOfDisplay:i.ALL,t.displayType=t.displayType?t.displayType:i.STANDARD,t.className=t.className?t.className:"",t.className+=" "+s,t.className+=t.typeOfDisplay?" "+t.typeOfDisplay:"",t.name=s,t.showIdCard=void 0!==t.showIdCard?t.showIdCard:t.typeOfDisplay!==i.ONLY_EDIT_PROPERTIES,t.showFacets=t.typeOfDisplay===i.ALL,t.showExpander=t.typeOfDisplay===i.ALL,t.closeButton=i.isCloseButton(t),t.defaultFacetName=t.defaultFacetName?t.defaultFacetName:"",t.infoForFacet=t.infoForFacet?t.infoForFacet:null,t.indexModeParameter=!!t.indexModeParameter&&t.indexModeParameter,t.idCardOptions={events:{thumbnailClick:function(){n._getFirstPropertiesModel().get("activeThumbnail")?(n.elements.postIdCard&&n.elements.postIdCard.maskThumbnail(),require(["DS/ImageManager/ImageManager","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"],(function(e,t){n.elements.postIdCard&&n.elements.postIdCard.unmaskThumbnail();var i=n._getFirstPropertiesModel(),s=i?i.get("objectId"):null;!s||n.elements.imageManager&&n.elements.imageManager.getModelId()===s||(n.elements.imageManager&&n.elements.imageManager.destroy(),n.elements.imageManager=new e({modelId:s,tenantId:t.getTenantFromModel(i),events:{onPrimaryChange:function(e){(i=n._getFirstPropertiesModel()).set("previewUrl",e?e.url:"");var t=i?i.get("objectId"):null;t&&n.dispatchEvent("onPrimaryChange",{id:t,image:e}),n._updateThumbnailForModel(i)}}})),n.elements.imageManager&&n.elements.imageManager.execute()}))):n._isFacetAuthorized(i.FACET_VIEWS)&&n.selectFacet(i.FACET_VIEWS)}}},this._parent(e,t),this._sharedOptions.readOnly=!1!==t.readOnly,this.options.typeOfDisplay===i.ONLY_IDENTITY_CARD&&(this.options.setEditButton=!1),this.editMode=!0===t.editMode,this.options.typeOfDisplay===i.ALL&&(this.elements.containerError=this.elements.globalDiv),this.elements.mainError=UWA.createElement("div",{class:"EditProp_MainError"}).inject(this.elements.globalDiv).hide()},setReadonlyStatus:function(e){this._sharedOptions.readOnly=e,this.onRefresh()},setOccurrences:function(e){this.elements.imageManager&&(this.elements.imageManager.destroy(),delete this.elements.imageManager),this._parent(e)},_manageEvent:function(e){this._parent(e);var t=this._getCurrentSelectedFacet(),i=this._getFacetName(t);e.facet===i&&"switchMode"===e.eventID&&this.elements.postIdCard&&this._manageActionVisibility()},clearPanel:function(){this._parent(),this._getErrorManager((function(e){e.clearAllMessages()}))},_getErrorManager:function(e){var t=this;this.errorOverlay?e.call(null,this.errorOverlay):require(["DS/ErrorWidget/ErrorWidget"],(function(i){t.errorOverlay||(t.errorOverlay=new i(n.getWidgetObject(),t.elements.containerError,{className:"editProperties_errorManager"})),e.call(null,t.errorOverlay)}))},_addNotif:function(e){var t=e.msg,i=e.eventID,n=e.customClass;switch(i){case"mainstaticerror":t=t||e.json,this.showMainErrorArea(t);break;case"error":t=t||e.json,this._addError(t,n);break;case"warning":this._addWarning(t,n);break;case"success":this._addSuccess(t,n);break;default:this._addInfo(t,n)}},_addInfo:function(e,t){var i=this;this._getErrorManager((function(n){var s=n.addInfo(e,t);i.dispatchEvent("onNotification",s)}))},_addWarning:function(e,t){var i=this;this._getErrorManager((function(n){var s=n.addWarning(e,t);i.dispatchEvent("onNotification",s)}))},_addSuccess:function(e,t){var i=this;this._getErrorManager((function(n){var s=n.addSuccess(e,t);i.dispatchEvent("onNotification",s)}))},_addError:function(t,i){var n=this;this._getErrorManager((function(s){var o=t;if(null!=o&&("string"==typeof o||o instanceof String)&&o.includes("ErrorCode:1501009")){o={level:"error",title:UWA.i18n("InvalidCSCreationfailed"),subtitle:UWA.i18n("InvalidCSCreationFailedSubtitle"),message:UWA.i18n("NoAccessToCS")};var a=s.display(o)}else a=s.displayJSONError(e.encode(t),i);n.dispatchEvent("onNotification",a)}))},hideMainErrorArea:function(){this.elements.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.elements.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.elements.mainError)},clearAllMainError:function(){this.elements.mainError.setContent("")},showMainComponent:function(){this._parent(),this.hideMainErrorArea()}})})),define("DS/EditPropWidget/constants/EditPropConstants",[],(function(){"use strict";return{ONLY_IDENTITY_CARD:"editProp_onlyIC",ONLY_EDIT_PROPERTIES:"editProp_onlyProperties",ALL:"editProp_all",ALL_SELECTION:"allSelection",RESTRICTED_SELECTION:"restrictSelection",NO_SELECTION:"noSelection",MVA_SEP:"|",POPUP:"editProp_popup",TRANSIENT:"editProp_transient",STANDARD:"editProp_standard",DOCKABLE:"editProp_dockable",PINNED:"editProp_pinned",FORCE_READWRITE:"force_readWrite",FORCE_READONLY:"force_readonly",FORCE_DEFAULT:"force_default",NO_CHANGES:"no_changes",ACTION_SWITCH:"pencil",ACTION_REFRESH:"cw",ACTION_RESET:"reset",ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM:"swym_view_content_in_3dswym",ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM:"swym_view_community_in_3dswym",ACTION_SWYM_VIEW_USER_PROFILE:"swym_view_user_profile",ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM:"swym_view_survey_in_3dswym",ACTION_SHARING_FILTER_VIEW:"filter",ACTION_SHARING_DELETE:"deleteUser",ACTION_SHARING_ADD:"addUser",ACTION_SHARING_LIST_VIEW:"listView",FACET_NONE:"none",FACET_VIEWS:"views",FACET_PROPERTIES:"properties",FACET_iPROPERTIES:"iproperties",FACET_DOMAINPROPERTIES:"properties_domain",FACET_CONSTRUCTION:"construction",FACET_CONSTRUCTION_CUSTOM_ATTR:"construction_custom_attr",FACET_INSTANCE:"instance",FACET_iINSTANCE:"indexInstance",FACET_ACTIVITY:"activity",FACET_GENERALHISTORY:"history",FACET_SWYMCOMMENTS:"social",FACET_EBOM:"EBOMPart",FACET_SWYM_CONTENT:"swym_content",FACET_SWYM_COMMUNITY_PROPERTIES:"swym_community_properties",FACET_SWYM_USER_PROPERTIES:"swym_user_properties",FACET_SWYM_SURVEY_PROPERTIES:"swym_survey_properties",FACET_SPECIFICATIONS:"Specifications",FACET_Variability:"Variability",FACET_EFFECTIVITY:"Effectivity",FACET_CHANGE:"Change",FACET_iCHANGE:"iChange",FACET_ALTERNATE:"Alternate",FACET_IPPROTECTION:"IPProtection",FACET_CLASSIFICATIONS:"Classification",FACET_RICHCONTENT:"Rich Content Attr",FACET_COVERAGELINKS:"Coverage Links",FACET_DOCUMENTS:"documents",FACET_EXPORTED_DOCUMENTS:"export_documents_tab",FACET_FILES:"Files",FACET_PROXY:"proxyFacet",FACET_ADMIN:"adminFacet",FACET_RELATIONS:"relations",FACET_DERIVEDOUTPUT:"derivedoutputs",FACET_REVISIONS:"revisions",FACET_SHARING:"sharing",FACET_PHYSICSSIMULATION:"physicssimulation",FACET_POSTERRORANALYSIS:"postErrorAnalysis",FACET_PC_CONTENT:"product_configuration_content",FACET_FL_SPECIFICATION:"catfl_specification_document",FACET_FL_ATTACHEMENT:"catfl_attachement",FACET_CONTENTS:"contents",FACET_MEMBERS:"members",FACET_ATTACHMENT:"attachment",FACET_MBSE_USEDMODEL:"catmbse-usedmodel",FACET_MBSE_USINGMODEL:"catmbse-usingmodel",FACET_EQUIVALENTITEMS:"EquivalentItems",MODEL_INIT:"_Model_init",MODEL_FACET_INFO_PREFIX:"_DS_FACET_",MODEL_DS_ATTR:"_DS_ATTR_",METATYPE_BUS:"businessobject",METATYPE_REL:"relationship",METATYPE_PATH:"path",METATYPE_UNKNOWN:"unknown",MULTISEL_STD:"yes",MULTISEL_NO:"no",MULTISEL_MERGE:"merge",EP_RESPONSE_OK:"OK",EDITPROPINDEX_DIMENSION:"DSDim_",EDITPROPINDEX_DEFAULTTYPE:"TypeNotAvailable",COLLAPSE_IC_PREFERENCE:{type:"hidden",name:"editProperty_collapseIC",label:"is IC collapse",defaultValue:"false"},TYPES:{INTEGER:"integer",REAL:"real",TIMESTAMP:"timestamp",PERSON:"person",BOOLEAN:"boolean",ENUM:"enum"},MIN_WIDTH_FOR_TABLE:200,WIDTH_SWITCH_MODE:150,VARIABLES:{minWidthForTable:200},ACCORDION:{ATTRIBUTES:"Attributes"},isCloseButton:function(e){return e.closeButton||e.displayType!==this.STANDARD&&e.displayType!==this.PINNED}}})),define("DS/EditPropWidget/comm/CommManager",["UWA/Class"],(function(e){"use strict";return e.extend({subscriptions:[],lCurrentListId:[],_nbOfCancelReceived:0,_statusReady:"ready",_statusRunning:"running",_commName:null,_currentStatus:null,_currentListenStatus:null,init:function(e){this._currentStatus=null,this._currentListenStatus=null,this.subscriptions=[],this.lCurrentListId=[],this._nbOfCancelReceived=0,e||(e="default"),this._commName=e},getCommObject:function(e){var t=window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.EP_CommManager:window.top.EP_CommManager;return t||!0===e||(t={},window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.EP_CommManager=t:window.top.EP_CommManager=t),t},getCurrentComm:function(e){var t=this.getCommObject(e);return(t=t||{})[this._commName]||e||(t[this._commName]={callbacks:[]}),t[this._commName]},_removeCurrentComm:function(){this.getCommObject(!0)&&(window.dsDashboardWindow&&window.dsDashboardWindow.top?delete window.dsDashboardWindow.top.EP_CommManager[this._commName]:delete window.top.EP_CommManager[this._commName])},createRunningEvent:function(e){this.lCurrentListId=e,this._currentStatus={status:this._statusRunning,answer:this.lCurrentListId},this.getCurrentComm().status=this._currentStatus},createReadyEvent:function(e){this._currentStatus={status:this._statusReady,answer:e};var t=this.getCurrentComm();t.status=this._currentStatus,t.callbacks&&t.callbacks.length>0&&(t.callbacks.forEach((function(t){t.call(null,e)})),this._removeCurrentComm())},createListenEvent:function(e){var t=this.getCurrentComm(!0);t&&(t.status.status===this._statusReady?(e.call(null,t.status.answer),this._removeCurrentComm()):t.callbacks.push(e))},getCurrentListenStatus:function(){var e=this.getCurrentComm(!0),t=null;return e&&(t=e.status.status),t},destroy:function(){this._removeCurrentComm(),this._parent()}})})),define("DS/EditPropWidget/utils/AttributesUtils",["UWA/Array","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i){"use strict";return{defaultOptions:{},validateModels:function(e){for(var t=null,i=e.length,n=0;n<i;n++){var s=e[n];t=this._validateAllAttributes(s)}return t},validateAttributes:function(e,t,n){var s=this,o=[],a=[];return s.validValuesForBoolean={},s.validValuesForBoolean.true="true",s.validValuesForBoolean.false="false",s.validValuesForBoolean.TRUE="TRUE",s.validValuesForBoolean.FALSE="FALSE",s.validValuesForBoolean[i.true]=i.true,s.validValuesForBoolean[i.false]=i.false,t.forEach((function(t){if(t?t.name:null){!0!==t.get("error").server&&t.resetError();var i=t.valueDB,o=null;if(e.isMergedModel()){var r=Object.keys(i);r.length>0&&(o=r[0])}if(null!=o&&(i=i[o]),null!==(i=i||(!0===t.get("readOnly")?null:null!=o?t.value[o]:t.value))){var l=s.checkValueForAttribute(t,i,a,n);l&&l.message&&t.setError(l.message,l.type)}}})),a.length>0?a.forEach((function(e){var t={attrName:e.attrName,customClass:e.attrName&&e.attrName.length>0?"EP_Warning_"+e.attrName:"EP_Warning_Message",message:e.message,code:"ERROR",eventID:"warning"};o.push(t)})):o=null,o},checkValueForAttribute:function(n,s,o,a=!1){var r=this,l=n?n.name:null,d={message:null,type:null};if(l&&!0!==n.get("readOnly")&&!1!==n.get("visible")){var c=n.label;return c=c?c.toLowerCase():"",null!==s&&(Array.isArray(s)||(s=[s]),0==s.length&&!0===n.mandatory&&(d=r.addError(o,n,c,"MandatoryAttribute")),s.every((function(s){var l=null;if("function"==typeof n.validationFunction&&(l=n.validationFunction(n)),l&&((d=r.addError(o,n,n.label,l.message)).type=l.type),!0===n.mandatory){var u=s+"",h=new RegExp(" ","g");""===(u=u.replace(h,""))&&(d=r.addError(o,n,c,"MandatoryAttribute"))}if(a)return null===d.message;if("boolean"===n.type&&n.multivalue&&n.authorizedValues&&Array.isArray(n.authorizedValues)&&0===n.authorizedValues.length&&!r.validValuesForBoolean[s]){let e=i.replace(i.get("NotAValidBooleanValue"),{label:n.label,value:s,true:i.true,false:i.false});o.push({message:e,attrName:n.getIdentifier()}),d={message:e,type:"error"}}if(n.maxlength>0&&s.length>n.maxlength&&(d=r.addErrorWithValue(o,n,c,n.maxlength,"MaxLengthAttribute")),"real"===n.type||"integer"===n.type){u=s;if(UWA.is(s,"string")&&""!==n.unitName){var p=s.split(" ");2==p.length&&p[1]===n.dimension&&(u=p[0])}e.isArray(u)?u.forEach((function(e){isNaN(e)&&(d=r.addErrorWithValue(o,n,n.label,e,"NotaNumber"))})):isNaN(u)?d=r.addErrorWithValue(o,n,n.label,u,"NotaNumber"):"integer"===n.type&&u%1!=0&&(d=r.addErrorWithValue(o,n,n.label,u,"IntegerIsDecimal"))}if(""!==n.minval&&"unit"!==n.get("tw_type")){var m=parseFloat(n.minval),f=s;if(e.isArray(f))f.forEach((function(e){var t=parseFloat(e);t<m&&(d=r.addErrorWithValue(o,n,n.label,e,"OutOfMinVal")),n.minvalincluded||t!==m||(d=r.addErrorWithValue(o,n,n.label,e,"OutOfMinVal"))}));else(g=parseFloat(s))<m&&(d=r.addErrorWithValue(o,n,n.label,g,"OutOfMinVal")),n.minvalincluded||g!==m||(d=r.addErrorWithValue(o,n,n.label,g,"OutOfMinVal"))}if(""!==n.maxval&&"unit"!==n.get("tw_type")){var g,v=parseFloat(n.maxval);f=s;if(e.isArray(f))f.forEach((function(e){var t=parseFloat(e);t>v&&(d=r.addErrorWithValue(o,n,n.label,e,"OutOfMaxVal")),n.maxvalincluded||t!==v||(d=r.addErrorWithValue(o,n,n.label,e,"OutOfMaxVal"))}));else(g=parseFloat(s))>v&&(d=r.addErrorWithValue(o,n,n.label,g,"OutOfMaxVal")),n.maxvalincluded||g!==v||(d=r.addErrorWithValue(o,n,n.label,g,"OutOfMaxVal"))}var _=n.get("forbiddenChar");if(_){u=s;if(t.commonChar(u,_,!0)>0){var E=i.replace(i.get("ForbiddenCharacters"),{label:n.label,badChars:_});o.push({message:E,attrName:n.getIdentifier()}),d.message=E,d.type="error"}}if("unit"===n.get("tw_type")){let e=n.get("dimensionType"),i=n.get("dimension");if(e&&i){let s=t.getValue("DimensionsDictionary");if(e&&s){e.startsWith("DSDim_")&&(e=e.substring(6,e.length));let t=s.get(e),a=!1;if("object"!=typeof i||Array.isArray(i)){if(t&&t.Units&&Array.isArray(t.Units))for(let e=0;e<i.length;e++){let s=i[e],l=t.Units.filter((e=>e.label?e.label===s||e.NLSName===s:e.Name===s||e.NLSName===s));if(Array.isArray(l)&&l.length>0&&(a=!0),!a){d=r.addErrorWithValue(o,n,n.label,s,"NotAValidDimension");break}}}else{let e=Object.keys(i);for(let s=0;s<e.length;s++){let l=i[e[s]];if(t&&t.Units&&Array.isArray(t.Units))for(let e=0;e<l.length;e++){let i=l[e],s=t.Units.filter((e=>e.label?e.label===i||e.NLSName===i:e.Name===i||e.NLSName===i));if(Array.isArray(s)&&s.length>0&&(a=!0),!a){d=r.addErrorWithValue(o,n,n.label,i,"NotAValidDimension");break}}}}}}}return null===d.message}))),d}},getUXBLErrors(e){var t=[];if(!e)return t;var i=e.values();return i&&i.forEach((e=>{e&&e.name&&e.visible&&(UWA.is(e.uxBLerror,"object")?t.push(e.uxBLerror):UWA.is(e.notif,"object")&&1==e.notif.sev&&t.push(e.notif))})),t},_validateAllAttributes:function(e){var t=e.values();return this.validateAttributes(e,t)},addErrorWithValue:function(e,t,n,s,o){i.get(o);var a=i.replace(i.get(o),{label:n,value:s});return e.push({message:a,attrName:t.getIdentifier()}),{message:a,type:"error"}},addError:function(e,t,n,s){i.get(s);var o=i.replace(i.get(s),{label:n});return e.push({message:o,attrName:t.getIdentifier()}),{message:o,type:"error"}}}})),define("DS/EditPropWidget/buttonsBar/ButtonsBar",["UWA/Controls/Abstract","DS/Controls/TooltipModel","DS/Controls/Button","DS/UIKIT/DropdownMenu","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s){var o=e.extend({defaultOptions:{vertical:!1,minimumSize:0},init:function(e,o){this._parent(e),this.elements.container=UWA.createElement("div",{class:"buttonsBar "+(e.classname?e.classname:"")+(e.vertical?" vertical":"")}),this.options.minimumSize<0&&!o&&(o=this.elements.container),this.elements.previous=UWA.createElement("div",{class:"buttonsList"}),this.elements.comboButton=new i({value:"dropdownAction",tooltipInfos:new t({shortHelp:s.dropActions,mouseRelativePosition:!0}),icon:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite"}),this.elements.dropdown=new n({target:this.elements.comboButton.getContent(),items:[]}),this.elements.comboButton.hide(),this.elements.after=UWA.createElement("div",{class:"buttonsList"}),this.elements.previous.inject(this.elements.container),this.elements.comboButton.inject(this.elements.container),this.elements.after.inject(this.elements.container),this._limitingDiv=o,this._availableSize=0,this._sizeButtons=null,this._buttons={}},addButton:function(e,n){var s=new i({value:e.name,tooltipInfos:new t({shortHelp:e.text,mouseRelativePosition:!0}),icon:{iconName:e.icon,fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite",type:e.type,onClick:function(){e.handler&&e.handler()}});e.id&&(s.domId=e.id);var o=this.elements.after;!0!==e.after&&(o=this.elements.previous,this.elements.dropdown.addItem({text:e.text,name:e.name,fonticon:e.icon,handler:e.handler})),s.inject(o),this._buttons[e.name]={element:s,options:UWA.clone(e)},this._sizeButtons+=38,!1!==n&&this.refresh()},addButtons:function(e){var t=this;e.forEach((function(e){t.addButton(e,!1)})),this.refresh()},setButtons:function(e){this.elements.previous.empty(),this.elements.after.empty(),this.clearButtons(),this.addButtons(e)},destroy:function(){this.clearButtons(),this._parent.apply(this,arguments)},clearButtons:function(){for(var e in this._buttons)this._buttons[e].element.destroy(),this.elements.dropdown.removeItem(e);this._buttons={},this._sizeButtons=0},hideButton:function(e){var t=this._buttons[e];t&&(t.element.visibleFlag=!1),this._sizeButtons-=38,this.refresh()},showButton:function(e){var t=this._buttons[e];t&&(t.element.visibleFlag=!0),this._sizeButtons+=38,this.refresh()},updateButton:function(e,t){t.id=e,t.name=e;var i={id:e,name:e};t.text&&(i.text=t.text),t.icon&&(i.fonticon=t.icon),this.elements.dropdown.updateItem(i);var n=this._buttons[e];n&&(t.text&&(n.element.getModel().tooltipInfos.shortHelp=t.text),t.icon&&(n.element.getModel().icon={iconName:t.icon,fontIconFamily:WUXManagedFontIcons.Font3DS}))},onResize:function(){if(this._limitingDiv&&0!==this.options.minimumSize){var e=this._limitingDiv;this.options.minimumSize;if(this.options.minimumSize<0&&(e=this._limitingDiv.getParent(),0),e){var t=e.getSize(),i=this.options.vertical?t.height:t.width;this._availableSize=i-this.options.minimumSize}}this.refresh()},refresh:function(){if(this._limitingDiv&&this.options.minimumSize)if(0!==this._availableSize&&this._availableSize<this._sizeButtons){var e=null;for(var t in this._buttons)!0!==this._buttons[t].options.after&&(null!==e?(!1!==e&&(e.element.hide(),this.elements.comboButton.show()),e=!1,this._buttons[t].element.hide()):e=this._buttons[t])}else for(var t in this.elements.comboButton.hide(),this._buttons){var i=this._buttons[t];!1!==i.options._visible&&i.element.show()}},checkButtonVisibility:function(e){let t=!1;if(e){let i=this._buttons[e];i&&i.element&&!0===i.element.visibleFlag&&(t=!0)}return t}});return o})),define("DS/EditPropWidget/require/ModuleLoader",["UWA/Class","text!DS/EditPropWidget/assets/serviceModule/ModuleList.json"],(function(e,t){})),define("DS/EditPropWidget/changeAction/passThruJS",[],(function(){"use strict";return{onReady:function(e){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(t){var i={changeIsSetChecker:function(e){return e&&e.AuthoringContextHeader&&Object.keys(e.AuthoringContextHeader).length>0}},n=[],s=[];for(var o in t)"function"==typeof t[o]&&(n.push(t[o]),s.push(o));s.forEach((function(e,s){i[e]=function(i,o){if("init"!==e&&"constructor"!==e&&"initialize"!==e&&"undefined"==typeof enoviaServerAuthoringWidget)return console.log("Authoring context not initialized"),void("function"==typeof i?i({}):"function"==typeof o&&o({}));n[s].apply(t,arguments)}})),e.call(null,i)}),(function(){e.call(null,null)}))}}})),define("DS/EditPropWidget/models/HistoryObjectModel",[],(function(){"use strict";return function(e){for(var t in this.name="",this.type="",this.revision="",this.id="",e)this[t]=e[t];this.set=function(e,t){void 0!==t&&(this[e]=t)},this.get=function(e){return this[e]}}})),define("DS/EditPropWidget/models/EditPropAttributeModel",[],(function(){"use strict";return function(e){for(var t in this._identifier=null,this.isTransient=!1,this.name="",this.label="",this.select="",this.path="",this.value="",this.valueDB="",this.type="text",this.tw_type=null,this.authorizedValues=[],this.authorizedValuesNLS=[],this.authorizedValuesRequired=!0,this.dimension="",this.unitName=null,this.dimensionType=null,this.manipulationUnit=null,this.mksDBUnit=null,this.maxlength=-1,this.positionUI="0",this.positionIdentityCard=-1,this.sectionIdentityCard="",this.masked=!0,this.forbiddenChar=null,this.mandatory=!1,this.modified=!1,this.multiline=!1,this.multivalue=!1,this.multisel=!1,this.readOnly=!0,this.minval="",this.maxval="",this.minvalincluded=!1,this.maxvalincluded=!1,this.attributeID="",this.facet="",this.section="",this.extension="",this.group="Default",this.urlIcon=null,this.from=null,this.navType=null,this.relation=null,this.dbValues={value:"",valueDB:""},this.initialsValues={value:"",valueDB:"",dimension:""},this.error={message:null,type:"error"},this.keepformat=!1,this.displayAsEntered=null,this.validationFunction=function(){},e)this[t]=e[t];this.getIdentifier=function(){var e=this._identifier;return e||(e="",e+=this.facet?this.facet+"-":"",e+=this.path,this._identifier=e),e},this.set=function(e,t){void 0!==t&&(this[e]=t,"modified"!==e&&(this.modified=!0))},this.saveInitialValues=function(){for(var e in this.initialsValues)this.initialsValues[e]=UWA.clone(this[e]),this.dbValues.hasOwnProperty(e)&&(this.dbValues[e]=UWA.clone(this[e]))},this.resetError=function(){this.error={message:null,type:"error"}},this.setError=function(e,t,i){e&&(t||(t="error"),this.error={message:e,type:t,server:!0===i})},this.setUXBLError=function(e,t){e&&(t||(t="error"),this.uxBLerror={message:e,type:t})},this.resetUXBLError=function(){delete this.uxBLerror},this.resetInitialValues=function(){for(var e in this.initialsValues)this[e]=UWA.clone(this.initialsValues[e])},this.get=function(e){return this[e]},this.isSameValueSet=function(e){var t=!0;if(t=!(null===e.value||null===this.value||null===e.valueDB||null===this.valueDB))if(this.multisel){for(var i in this.value)if(!(t=t&&this._isSameValueSet(e.value[i],this.value[i],e.valueDB[i],this.valueDB[i])))break}else t=this._isSameValueSet(e.value,this.value,e.valueDB,this.valueDB,e.dimension,this.dimension);return!t},this._isSameValueSet=function(e,t,i,n,s,o){var a=!0;if("boolean"===this.type)a=i===n||(i+"").toLowerCase()===(n+"").toLowerCase();else{var r=e.length;if((a=null==t||r===t.length)&&null!=s&&null!=o&&(a=o.length===s.length),a){if("relation"!==this.type)for(var l=0;l<r&&(a=e[l]===t[l]);l++);if(a){a=(r=i.length)===(n?n.length:0);for(l=0;l<r&&(a=i[l]===n[l]);l++);}a&&(a=s===o)}}return a},this.getChangedIds=function(){var e={};if(!0===this.multisel)for(var t in this.value){var i=this.value[t],n=this.valueDB[t],s=s&&this._isSameValueSet(this.initialsValues.value[t],i,this.initialsValues.valueDB[t],n);s||(e[t]={value:i,valueDB:n})}else this.dimension?e.a={value:this.value,valueDB:this.valueDB}:e.a={value:this.value,valueDB:this.valueDB,dimension:this.dimension};return e},this.hasChanged=function(){return this.isSameValueSet(this.initialsValues)},this.applySort=!1}})),define("DS/EditPropWidget/controllers/EditPropUIController",["UWA/Class"],(function(e){"use strict";return e.extend({defaultOptions:{},init:function(e,t){this.editPropModelList=e,this._parent(t)},setModels:function(e){this.editPropModelList=e},getModels:function(){return this.editPropModelList},getModel:function(e){var t=null;return this.editPropModelList.every((function(i){var n=!0;return e==i.get("objectId")&&(t=i,n=!1),n})),t},getModifiedModels:function(){var e=[];return this.editPropModelList.forEach((function(t){if(!0!==t.get("isTransient")){var i=t.getChangedValues();Object.keys(i).length>0&&e.push(t)}})),e},getLabel:function(){var e="";return 1===this.editPropModelList.length&&(e=this.editPropModelList[0].get("label")),e}})})),define("DS/EditPropWidget/ajaxRequests/MultipleAsynchronousRequests",[],(function(){"use strict";return function(e,t){var i={},n=e.length,s=t;this.setAnswer=function(t,o){e.indexOf(t)>=0&&(void 0===i[t]&&n--,i[t]=o),n<=0&&null!==s&&s.call(this)},this.getAnswer=function(e){return i[e]}}})),define("DS/EditPropWidget/comm/EventManager",["UWA/Class"],(function(e){"use strict";var t=0,i=e.singleton({init:function(){this._parent.apply(this,arguments),this._events={},this._queueStack=[]},publish:function(e){var i=this,n={index:++t},s=this._events[e];Array.prototype.shift.apply(arguments);var o=arguments;s&&s.forEach((function(e){i._queueStack.push({callback:e,context:n,args:o})}));for(var a=null;a=this._queueStack.shift();)a.callback.apply(a.context,a.args)},subscribe:function(e,t){var i=this._events[e];i||(i=[],this._events[e]=i),i.push(t)},remove:function(e,t){var i=this._events[e];if(i){for(var n=-1;(n=i.indexOf(t))>=0;)i.splice(n,1);0==i.length&&delete this._events[e]}}});return i})),define("DS/EditPropWidget/constants/ConstantsMapping",["DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i){"use strict";var n={"3dspace":{name:"3DSpace",fedPrefix:"physicalid",require:"DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests",identifire:"pid:",path:"/resources"},"3dlifecycle":{name:"3dlifecycle",fedPrefix:"physicalid",require:"DS/EditPropWidget/ajaxRequests/3dlifecycleAjaxRequests",identifire:"pid:",path:"/resources"},"3ddrive":{name:"3DDrive",fedPrefix:"physicalid",isSource:!0,require:"DS/EditPropWidget/ajaxRequests/3DDriveAjaxRequest",identifire:"driveid:",path:"/resources"},"3dswym":{name:"3DSwym",fedPrefix:"resourceid",modelRequired:!0,modelNeeded:!0,require:"DS/SwymUnifiedSearch/script/customization/editprop-ajax-requests/swym-ajax-requests",identifire:""},fedsearch:{name:"3DSearch",require:"DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests"},www:{name:"www",require:"DS/IPClassifyUXUtil/ajaxRequests/wwwAjaxRequests",extensionsSupported:!1},sourcing:{name:"sourcing",fedPrefix:"physicalid",isSource:!0,require:"DS/ENOXSourcingUXInfra/PropertiesView/SourcingAjaxRequests",identifire:"pid:",path:"/resources"},cpq:{name:"cpq",fedPrefix:"physicalid",require:"DS/ENXCPQNavigation/service/CPQManagementAjaxServiceRequest",identifire:"pid:",path:"/resources"},domainCentric:{name:"domainCentric",require:"DS/EditPropWidget/ajaxRequests/i3dxAjaxRequests"},specbiomaterials:{name:"specbiomaterials",fedPrefix:"resourceid",isSource:!0,require:"DS/ENOXMaterial/properties/XDSMaterialPropertiesAjax",identifire:""}};return{getSupportedServices:function(){return n},getSupportedServicesArray:function(){var e=this.getSupportedServices(),t=[],i=[];for(var n in e){var s=e[n];!0!==s.modelRequired&&(s.isSource?t.push(s.id?s.id:n):i.push(s.name))}return{sources:t,services:i}},getServiceBySource:function(e){return n[e]},getServiceForModel:function(e){var t=null,i=null;if(e){if(i=e.get("_sourceId"),t=n[i],this.getDomainCentricFlag()&&(t=n.domainCentric),!0===e.get("indexModeParameter")&&(t=n.fedsearch),!t){var s=e.get("sourceName");s&&(i=s.toLowerCase(),t=n[i]),t||(s=e.get("source"))&&(i=s.toLowerCase(),t=n[i]),e.set("_sourceId",i)}null!=t&&(e.identifire=t.identifire?t.identifire:"",e.path=t.path?t.path:"")}return t},getMapping:function(t){var n={};return n[e.FACET_ACTIVITY]={require:"DS/EditPropWidget/facets/History/History",facet:{name:e.FACET_ACTIVITY,text:i.get("Activity"),icon:"clock"}},n[e.FACET_GENERALHISTORY]={require:"DS/EditPropWidget/facets/GeneralHistory/History",services:["3DSpace"],facet:{name:e.FACET_GENERALHISTORY,text:i.get("Activity"),icon:"clock"},options:t},n[e.FACET_VIEWS]={require:"DS/EditPropWidget/facets/3DPlay/3DPlayFacet",webInWin:!1,facet:{name:e.FACET_VIEWS,text:i.get("Views"),icon:"eye"},options:t},n[e.FACET_PROPERTIES]={alwaysCalled:!0,supportMerge:!0,require:"DS/EditPropWidget/facets/Properties/EditPropController",options:t,actions:[e.ACTION_SWITCH,e.ACTION_RESET],facet:{name:e.FACET_PROPERTIES,text:i.get("Properties"),icon:"attributes"},supportExtension:!0},n[e.FACET_iPROPERTIES]={alwaysVisible:!1,alwaysCalled:!0,require:"DS/EditPropWidget/facets/Properties/iPropertiesFacet",options:t,actions:[e.ACTION_RESET],facet:{name:e.FACET_iPROPERTIES,text:i.get("iProperties"),icon:"attributes"}},n[e.FACET_DOMAINPROPERTIES]={alwaysVisible:!1,alwaysCalled:!0,require:"DS/EditPropWidget/facets/DomainProperties/DomainPropertiesController",options:t,actions:[e.ACTION_RESET],facet:{name:e.FACET_DOMAINPROPERTIES,text:i.get("DomianProperties"),icon:"attributes"}},n[e.FACET_CONSTRUCTION]={options:t,require:"DS/BuildingUX/ConstructionFacet",facet:{name:e.FACET_CONSTRUCTION,text:i[e.FACET_CONSTRUCTION],icon:"building-office"}},n[e.FACET_CONSTRUCTION_CUSTOM_ATTR]={options:t,require:"DS/BuildingUX/ConstructionCustomAttrFacet",facet:{name:e.FACET_CONSTRUCTION_CUSTOM_ATTR,text:i[e.FACET_CONSTRUCTION_CUSTOM_ATTR],icon:"building-office-attention"}},n[e.FACET_RICHCONTENT]={require:"DS/ReqProperties/facets/RichAttribute/RichContentController",facet:{name:e.FACET_RICHCONTENT,text:i.get("RichContentTabName"),icon:"attributes"}},n[e.FACET_COVERAGELINKS]={require:"DS/ReqProperties/facets/LinkMgt/LinkMgtFacet",facet:{name:e.FACET_COVERAGELINKS,text:i.get("CoverageLinksTabName"),icon:"link-requirements-check"}},n[e.FACET_SWYMCOMMENTS]={require:"DS/EditPropWidget/facets/SwymComments/SwymComments",services:["comment"],content:null,facet:{name:e.FACET_SWYMCOMMENTS,text:i.get("Social"),icon:"comment"}},n[e.FACET_EBOM]={supportMerge:!0,require:"DS/EditPropWidget/facets/EBOMPart/EBOMPart",options:t,actions:[e.ACTION_SWITCH,e.ACTION_RESET],facet:{name:e.FACET_EBOM,text:i.get("EBOMPart"),icon:"table"}},n[e.FACET_EFFECTIVITY]={alwaysVisible:!1,roles:["CSV","InternalDS"],require:"DS/CfgWebAppEffectivityUX/facets/EffectivityFacet",options:t,facet:{name:e.FACET_EFFECTIVITY,text:i.Effectivity,icon:"survey"}},n[e.FACET_SPECIFICATIONS]={alwaysVisible:!1,require:"DS/CfgWebAppSpecificationsUX/facets/CfgSpecificationsFacet",options:t,facet:{name:e.FACET_SPECIFICATIONS,text:i.Specifications,icon:"properties"}},n[e.FACET_Variability]={alwaysVisible:!1,require:"DS/CfgWebAppXRevisionCommands/facets/CfgXRevisionVariabilityFacet",options:t,facet:{name:e.FACET_Variability,text:i.Variability,icon:"variants-and-options"}},n[e.FACET_CHANGE]={alwaysVisible:!1,options:t,require:"DS/ENOChgActionProp/facets/ChangePropertiesFacet",facet:{name:e.FACET_CHANGE,text:i.Change,icon:"change"}},n[e.FACET_iCHANGE]={alwaysVisible:!1,options:t,require:"DS/ENOChgActionProp/facets/iChangePropertiesFacet",facet:{name:e.FACET_iCHANGE,text:i.iChange,icon:"change"}},n[e.FACET_ALTERNATE]={alwaysVisible:!1,options:t,require:"DS/ENOXAlternateSubstitute/components/properties/js/AlternatePropertiesFacet",facet:{name:e.FACET_ALTERNATE,text:i.get("Alternate"),icon:"exchange"}},n[e.FACET_IPPROTECTION]={alwaysVisible:!1,supportMerge:!1,roles:["IPA","IPS","InternalDS"],options:t,require:"DS/ENOIPProtection/IPProtection/IPProtectionController",facet:{name:e.FACET_IPPROTECTION,text:i.IPProtection,icon:"vault"}},n[e.FACET_PROXY]={require:"DS/OSLCConsumer/facets/ProxyFacet",calledIfVisible:!0,facet:{name:e.FACET_PROXY,text:i.get("ProxyFacet"),icon:"link"}},n[e.FACET_INSTANCE]={supportMerge:!0,require:"DS/EditPropWidget/facets/Instance/InstanceFacet",options:t,actions:[e.ACTION_SWITCH,e.ACTION_RESET],facet:{name:e.FACET_INSTANCE,text:i.get("EP_instance"),icon:"attributes"},supportExtension:!0},n[e.FACET_iINSTANCE]={require:"DS/EditPropWidget/facets/Instance/IndexInstanceFacet",options:t,actions:[e.ACTION_RESET],facet:{name:e.FACET_iINSTANCE,text:i.get("EPIndex_instance"),icon:"attributes"}},n[e.FACET_SWYM_CONTENT]={alwaysVisible:!1,alwaysCalled:!1,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-content-facet",actions:[e.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM],facet:{name:e.FACET_SWYM_CONTENT,text:i.get("View"),icon:"eye"}},n[e.FACET_SWYM_SURVEY_PROPERTIES]={alwaysVisible:!1,alwaysCalled:!1,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-survey-properties-facet",actions:[e.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM],facet:UWA.merge({name:e.FACET_SWYM_SURVEY_PROPERTIES},n[e.FACET_PROPERTIES].facet)},n[e.FACET_SWYM_COMMUNITY_PROPERTIES]={alwaysCalled:!1,alwaysVisible:!1,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-community-properties-facet",actions:[e.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM],facet:UWA.merge({name:e.FACET_SWYM_COMMUNITY_PROPERTIES},n[e.FACET_PROPERTIES].facet)},n[e.FACET_SWYM_USER_PROPERTIES]={alwaysCalled:!1,alwaysVisible:!1,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-user-properties-facet",actions:[e.ACTION_SWYM_VIEW_USER_PROFILE],facet:UWA.merge({name:e.FACET_SWYM_USER_PROPERTIES},n[e.FACET_PROPERTIES].facet)},n[e.FACET_ADMIN]={require:"DS/PropertiesAdmin/PropertiesAdmin",facet:{name:e.FACET_ADMIN,text:i.get("AdminFacet"),icon:"cog"}},n[e.FACET_RELATIONS]={require:"DS/ENORIPE_Relations/views/RelationsTab",options:t,facet:{name:e.FACET_RELATIONS,text:i.get("relations_tab"),icon:"object-related"}},n[e.FACET_DERIVEDOUTPUT]={roles:["CSV","InternalDS"],supportMerge:!1,options:t,require:"DS/ENODODisplay/commands/facets/DerivedOutputFacet",facet:{name:e.FACET_DERIVEDOUTPUT,text:i.get("DerivedOutput"),icon:"derived-output"},actions:[{name:"generateDeriveOutput",text:i.get("generateDeriveOutputNLS"),icon:"derived-output"},{name:"refreshDOView",text:i.get("refreshDOViewNLS"),icon:"refresh"},{name:"bulkDownloadDO",text:i.get("bulkDownloadDONLS"),icon:"folder-zipped-download"}]},n[e.FACET_REVISIONS]={blockFromSearch:!0,options:t,require:"DS/ENOXVersionExplorerUtils/RevisionsTabFacet",facet:{name:e.FACET_REVISIONS,text:i.get("revisions_tab"),icon:"flow-branch-list"}},n[e.FACET_DOCUMENTS]={require:"DS/ReqProperties/facets/ReqDoc/ReqDocFacet",facet:{name:e.FACET_DOCUMENTS,text:i.get("documents_tab"),icon:"attach"}},n[e.FACET_EXPORTED_DOCUMENTS]={supportMerge:!1,options:t,require:"DS/DMUReadPersistence/DMUwebExportedDocumentsTab",facet:{name:e.FACET_EXPORTED_DOCUMENTS,text:i.get("export_documents_tab"),icon:"export"}},n[e.FACET_FILES]={alwaysVisible:!1,supportMerge:!1,blockFromSearch:!0,options:t,require:"DS/DocumentFiles/FilesFacet",facet:{name:e.FACET_FILES,text:i.Files,icon:"docs"}},n[e.FACET_SHARING]={blockFromSearch:!0,options:t,require:"DS/ENOSharingWebUI/ENOSharingWebUI",actions:[],facet:{name:e.FACET_SHARING,text:i.get("sharing_tab"),icon:"forward"}},n[e.FACET_PHYSICSSIMULATION]={options:t,visible:!0,alwaysVisible:!0,require:"DS/SPYUI/facets/PhysSimulationFacet",facet:{name:e.FACET_PHYSICSSIMULATION,text:i.get("physicssimulation_tab"),icon:"compass-simulation"}},n[e.FACET_POSTERRORANALYSIS]={visible:!0,blockFromSearch:!0,options:t,require:"DS/ENOLifecyclePostErrorAnalysis/ENOLifecyclePostErrorAnalysisUI",facet:{name:e.FACET_POSTERRORANALYSIS,text:i.get("postErrorAnalysis_tab"),icon:"parameters"}},n[e.FACET_PC_CONTENT]={require:"DS/PCOverview/js/PCOverviewFacet",supportMerge:!0,facet:{name:e.FACET_PC_CONTENT,text:i.get("pc_content_tab"),icon:"properties"}},n[e.FACET_FL_SPECIFICATION]={options:t,supportMerge:!1,require:"DS/CATFLWidgetProperties/facets/CATFLSpecificationDocumentFacet",facet:{name:e.FACET_FL_SPECIFICATION,icon:"doc-log",text:i.get("catfl_specification_document_tab")}},n[e.FACET_FL_ATTACHEMENT]={options:t,supportMerge:!1,require:"DS/CATFLWidgetProperties/facets/CATFLAttachementFacet",facet:{name:e.FACET_FL_ATTACHEMENT,icon:"attach",text:i.get("documents_tab")}},n[e.FACET_MEMBERS]={blockFromSearch:!0,options:t,supportMerge:!1,require:"DS/IssueCommon/facets/MembersFacet",facet:{name:e.FACET_MEMBERS,icon:"users",text:i.get("ISU_Members")}},n[e.FACET_CONTENTS]={blockFromSearch:!0,options:t,supportMerge:!1,require:"DS/IssueCommon/facets/ContentsFacet",facet:{name:e.FACET_CONTENTS,icon:"location",text:i.get("ISU_Contents")}},n[e.FACET_ATTACHMENT]={blockFromSearch:!0,options:t,supportMerge:!1,require:"DS/IssueCommon/facets/AttachmentFacet",facet:{name:e.FACET_ATTACHMENT,icon:"attach",text:i.get("ISU_Attachment")}},n[e.FACET_CLASSIFICATIONS]={blockFromSearch:!0,alwaysVisible:!1,supportMerge:!1,options:t,require:"DS/ClassificationsFacet/ClassificationFacet",facet:{name:e.FACET_CLASSIFICATIONS,text:i.Classifications,icon:"classification-book"}},n[e.FACET_MBSE_USEDMODEL]={supportMerge:!1,options:t,require:"DS/CATMBSEProperties/facets/CATMBSEUsedModelFacet",facet:{name:e.FACET_MBSE_USEDMODEL,text:i.get("catmbse-usedmodel_tab"),icon:"system-model-used"}},n[e.FACET_MBSE_USINGMODEL]={supportMerge:!1,options:t,require:"DS/CATMBSEProperties/facets/CATMBSEUsingModelFacet",facet:{name:e.FACET_MBSE_USINGMODEL,text:i.get("catmbse-usingmodel_tab"),icon:"system-model-using"}},n[e.FACET_EQUIVALENTITEMS]={supportMerge:!1,options:t,require:"DS/SourcingFacetNavigation/facets/EquivalentItemsFacet",facet:{name:e.FACET_EQUIVALENTITEMS,text:i.equivalent_items,icon:"equivalent-3dproduct"}},n},getDefaultFacets:function(i,n){var s=this.getMapping(),o=[e.FACET_PROPERTIES,e.FACET_DOMAINPROPERTIES,e.FACET_CONSTRUCTION,e.FACET_CONSTRUCTION_CUSTOM_ATTR,e.FACET_CLASSIFICATIONS,e.FACET_FILES,e.FACET_PC_CONTENT,e.FACET_iPROPERTIES,e.FACET_INSTANCE,e.FACET_CONTENTS,e.FACET_ATTACHMENT,e.FACET_MEMBERS,e.FACET_iINSTANCE,e.FACET_SHARING,e.FACET_VIEWS,e.FACET_EBOM,e.FACET_ACTIVITY,e.FACET_GENERALHISTORY,e.FACET_EFFECTIVITY,e.FACET_SPECIFICATIONS,e.FACET_Variability,e.FACET_CHANGE,e.FACET_iCHANGE,e.FACET_ALTERNATE,e.FACET_IPPROTECTION,e.FACET_PROXY,e.FACET_SWYMCOMMENTS,e.FACET_SWYM_CONTENT,e.FACET_SWYM_COMMUNITY_PROPERTIES,e.FACET_SWYM_USER_PROPERTIES,e.FACET_SWYM_SURVEY_PROPERTIES,e.FACET_RELATIONS,e.FACET_DERIVEDOUTPUT,e.FACET_REVISIONS,e.FACET_DOCUMENTS,e.FACET_EXPORTED_DOCUMENTS,e.FACET_RICHCONTENT,e.FACET_COVERAGELINKS,e.FACET_FL_SPECIFICATION,e.FACET_FL_ATTACHEMENT,e.FACET_MBSE_USEDMODEL,e.FACET_MBSE_USINGMODEL,e.FACET_ADMIN,e.FACET_POSTERRORANALYSIS,e.FACET_EQUIVALENTITEMS],a=o,r=t.isWebInWinEnvironment();return!0!==r&&!0!==i&&!0!==n||(a=[],o.forEach((function(e){var t=!0,o=s[e];!0===i&&(t=!o||!0===o.supportMerge),t&&!0===r&&(t=!1!==o.webInWin),t&&(!0===n?a.push(o):a.push(e))}))),a},getDomainCentricFlag:function(){return!0===this.domainCentric},setDomainCentricFlag:function(e){this.domainCentric=e}}})),define("DS/EditPropWidget/models/EditPropModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug","DS/WidgetServices/WidgetServices","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o){"use strict";return t.extend(i,{METATYPE_BUS:o.METATYPE_BUS,METATYPE_REL:o.METATYPE_REL,METATYPE_PATH:o.METATYPE_PATH,changedValues:{},_locked:!1,_lockedAttributes:[],_initProperties:{},defaults:{metatype:o.METATYPE_UNKNOWN,source:"3DSpace",sourceName:"",tenant:n.getTenantID(),objectId:"",label:"",labelAttribute:"",type_icon_url:"",previewUrl:"",isTransient:!1,_changeId:"",instrefid:"",indexModeParameter:"",i3dx:""},isMergedModel:function(){return!1},getOptions:function(){var e={};for(var t in this.defaults)e[t]=this.get(t);return e},lockModel:function(e){var t=this;this._locked=!0===e,this._locked||(this._lockedAttributes.forEach((function(e){var i=t.get(e);null!=i&&(i=new s(i),t.set(e,i))})),this._lockedAttributes=[])},isLocked:function(){return!0===this._locked},setFloatingAttribute:function(e,t,i){this.isLocked()?(this._attributes[e]=t,this._lockedAttributes.indexOf(e)<0&&this._lockedAttributes.push(e)):(!0!==i&&(t=new s(t)),this.set(e,t))},getComputedTitle:function(){return this.get("label")},setup:function(){for(var e in this._lockedAttributes=[],this._locked=!1,this.changedValues={},this._initProperties={},this.defaults)this._initProperties[e]=this.get(e)},getChangeId:function(){return this.get("_changeId")},getTenant:function(){return this.get("tenant")},saveInitialValues:function(e,t){var i=this,n=this.keys(),s=[];n.forEach((function(t){var n=i.get(t);null!==n&&"object"==typeof n&&"function"==typeof n.saveInitialValues&&(null==e||e.indexOf(t)>=0)&&(n.saveInitialValues(),s.push(t))})),!1!==t&&this._dispatchChangedAttributes(i,s,!1),this._clearChangedValue(e),this.modelSaved()},isTransientModel:function(){return this.get("isTransient")},getAttributeFromField:function(e,t,i){var n=this;i=i||0;var s=[];return this.keys().every((function(o){var a=n.get(o);return null!==a&&"object"==typeof a&&"function"==typeof a.get&&a.get(e)===t&&s.push(a),0===i||s.length<i})),1===i?s.length>0?s[0]:null:s},resetInitialValues:function(){var e=this;this.keys().forEach((function(t){var i=e.get(t);i&&"object"==typeof i&&"function"==typeof i.resetInitialValues&&(i.resetInitialValues(),e._dispatchResetAttribute(e,t),e._dispatchChangedAttributes(e,[t],!0))})),this._clearChangedValue()},resetAllErrors:function(e){var t=this;this.keys().forEach((function(i){var n=t.get(i);n&&"object"==typeof n&&"function"==typeof n.resetError&&(n.resetError(),!1!==e&&t._dispatchChangedAttributes(t,[i],!0))}))},clearChangedValue:function(e){this._clearChangedValue(e)},_clearChangedValue:function(e){var t=this;e?e.forEach((function(e){t._removeChangedValue(e)})):this.changedValues={}},removeChangedValue:function(e){this._removeChangedValue(e)},_removeChangedValue:function(e){this.changedValues[e]&&delete this.changedValues[e]},attributeHasChanged:function(e){return!!this.changedValues[e]},removeEvent:function(e,t){this.removeEvent2("onChange:"+e,t)},removeEvent2:function(e,t){var i=this._dispatchers[e];if(i)for(var n=i.bindings.length-1;n>=0;n--){i.bindings[n].listener===t&&i.bindings.splice(n,1)}},getChangedValues:function(){return this.changedValues},setChangedValues:function(e){"object"==typeof e&&(this.changedValues=e)},hasSameAttributesThan:function(e){var t=Object.keys(this._attributes),i=Object.keys(e._attributes),n=!1;return t.length===i.length&&(n=!0,t.every((function(e){return i.indexOf(e)<0&&(n=!1),n}))),n},onChange:function(e){var t=this._getChangedAttributes(e);t.length>0&&this._dispatchChangedAttributes(e,t,!1)},_getChangedAttributes:function(e){var t=e.changedAttributes(),i=[];for(var n in t){var o=t[n],a=!1;o instanceof s&&((a=o.hasChanged())?e.changedValues[n]=o:((a=void 0!==e.changedValues[n])&&delete e.changedValues[n],a=a||!this._previousAttributes[n]),a&&i.push(n))}return i},_dispatchChangedAttributes:function(e,t,i){var n=this,s=[];t.forEach((function(t){i&&n.dispatchEvent("onChange:"+t),s.push(e.get(t))})),this.dispatchEvent("onChangeAttributes",[e,s])},modelSaved:function(){this.dispatchEvent("onSave")},getAllAttributes:function(){return this._attributes},resetAttribute:function(t){let i=this.get(t.getIdentifier());i.resetInitialValues();var n=new s(e.clone(i));this.set(i.getIdentifier(),n,{silent:!1})},_dispatchResetAttribute:function(e,t){this.dispatchEvent("onReset:"+t)},getTypes:function(){let e=this.get(o.MODEL_DS_ATTR+"type");return e||(e=this.get("type")&&this.get("type").valueDB,e||(e=this.get("ds6w:type")&&this.get("type").valueDB)),e&&"object"==typeof e&&e.valueDB&&(e=e.valueDB),e||console.log("EditPropModel :: no type present in model"),e?[e]:[]}})})),define("DS/EditPropWidget/models/CommonAbstract",["DS/EditPropWidget/comm/EventManager","UWA/Controls/Abstract"],(function(e,t){var i=0,n=t.extend({_callbacks:{},init:function(e){i++,e&&!e.eventThread&&(e.eventThread="CT"+i),this._parent.apply(this,arguments),this._callbacks={}},publishEvt:function(t){var i=this._getEventThread(t);arguments[0]=i,e.publish.apply(e,arguments)},subscribeEvt:function(t,i,n){var s=this._getEventThread(t);arguments[0]=s,e.subscribe.apply(e,arguments),this._callbacks[s]=i},destroy:function(){for(var t in this._callbacks)e.remove(t,this._callbacks[t]);this._parent.apply(this,arguments)},_getEventThread:function(e){return(this.options.eventThread?this.options.eventThread+".":"")+e},_callMethodOnEach:function(e,t){var i=e,n=t;for(var s in Array.prototype.shift.apply(arguments),Array.prototype.shift.apply(arguments),i)i[s][n].apply(this,arguments)}});return n})),define("DS/EditPropWidget/comm/DistantAjax",["UWA/Class","DS/EditPropWidget/comm/CommManager","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t,i,n){"use strict";var s=!1;return"undefined"!=typeof dscef&&(s=dscef.isA2X),s||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.perfoIncrem:window.top.perfoIncrem=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.perfoIncrem?window.dsDashboardWindow.top.perfoIncrem:window.top.perfoIncrem?window.top.perfoIncrem:0),e.singleton({_isAsynchronous:!1,_valuesAsync:{},init:function(){this._isAsynchronous=!0===widget.getValue("asynchronousRequest")||"true"===widget.getValue("asynchronousRequest"),widget.setValue("asynchronousRequest","false"),this._valuesAsync={}},_getCommManager:function(e){e.call(this,t)},getAsyncRead:function(e){this._getAsync("read",e)},getAsyncFacetCheck:function(e){this._getAsync("facetCheck",e)},_getAsync:function(e,t){this._isAsynchronous?this._getCommManager((function(i){var n=new i(e);n.createListenEvent((function(e){t(e),n.destroy()})),setTimeout((function(){n.getCurrentListenStatus()||t(null)}),100)})):t(null)},_distantCall:function(e,t,i,n){this._getCommManager((function(o){var a=new o(e),r=!1;if(!s){var l=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_getAsync:"+l):window.top.performance.mark("start_getAsync:"+l)}this._getAsync(e,(function(e){e&&!s&&(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_getAsync:"+l):window.top.performance.mark("end_getAsync:"+l)),!1===r&&e&&e.discriminant===t&&(r=!0,i&&i(e?e.value:e))})),setTimeout((function(){!1===r&&(a.createRunningEvent(),n.call(this,(function(e){!1===r&&(r=!0,a.createReadyEvent({value:e,discriminant:t}),i&&i(e))})))})),setTimeout((function(){a&&a.destroy()}),12e4)}))},getRoles:function(e,t){var n=this;this._distantCall("role",e,t,(function(t){i.getGrantedRoles((function(e){t.call(n,e)}),e)}))},getServices:function(e,t){var n=this;this._distantCall("services",e,t,(function(e){i.getServicesUrl({onComplete:function(t){e.call(n,t)}})}))},launchMainRead:function(e,i){require(["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"],(function(n,s){var o=new t("read");o.createRunningEvent(e),n.getListOfAttributes({modelList:e,tenant:s.getTenantFromModel(e&&e.length>0?e[0]:null),handleRequest:{},navigateToMain:!0,securityContext:i.securityContext,index_mode:i.index_mode,ignoreKernelAccessChecks:"true"===i.ignoreKernelAccessChecks,onComplete:function(e){o.createReadyEvent(e)}}),setTimeout((function(){o&&o.destroy()}),12e4)}))},launchFacetsVisibility:function(e,t,n,s,o){var a=this,r=["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"];void 0===this._valuesAsync.facetCheck&&(this._valuesAsync.facetCheck=this._isAsynchronous);var l=this._valuesAsync.facetCheck&&!s,d=!1,c=0;n.handleRequest=n.handleRequest?n.handleRequest:{},n.handleRequest&&(n.handleRequest.handle=i.getCancelObject());var u=n.handleRequest.handle;s?r.push("DS/EditPropWidget/comm/CommManager"):l&&(c=200,this.getAsyncFacetCheck((function(e){1==d||u.isCancelled()||e&&(d=!0,a._valuesAsync.facetCheck=!1,n.onComplete(e))}))),require(r,(function(i,s,r){setTimeout((function(){if(!0!==d&&!u.isCancelled()){var l=null;r&&((l=new r("facetCheck")).createRunningEvent(e),setTimeout((function(){l&&l.destroy()}),12e4)),i.checkFacetsVisibility({handleRequest:n.handleRequest,context:n.context,tenant:s.getTenantFromModel(e),model:e,facets:t,sourceAppId:o,onComplete:function(e){l&&l.createReadyEvent(e),"function"==typeof n.onComplete&&!0!==d&&n.onComplete(e),d=!0,a._valuesAsync.facetCheck=!1}})}}),c)}))},launchMainReadFromIndexService:function(e,i){require(["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests"],(function(n){var s=new t("read");s.createRunningEvent({model:e,options:i});var o={modelList:[e],tenant:e.getTenant(),handleRequest:i.handleRequest,select_predicates:i.predicates,defService:i.service,onComplete:function(e){var t=s.getCurrentComm().status.answer.options;s.createReadyEvent({response:e,options:t})}};i.getPLMParameter&&(o.getPLMParameter=i.getPLMParameter),n.getListOfAttributes(o),setTimeout((function(){s&&s.destroy()}),12e4)}))},launchFacetsVisibilityFromIndexService:function(e,s,o){var a=this,r=new t("facetCheck");r.createRunningEvent({model:e,facets:s,options:o});var l={};void 0===a._valuesAsync.facetCheck&&(a._valuesAsync.facetCheck=a._isAsynchronous);var d=a._valuesAsync.facetCheck,c=!1;o.handleRequest=o.handleRequest?o.handleRequest:{},o.handleRequest&&(o.handleRequest.handle=i.getCancelObject());var u=o.handleRequest.handle;if(d&&(200,a.getAsyncFacetCheck((function(e){1==c||u.isCancelled()||e&&(c=!0,a._valuesAsync.facetCheck=!1,o.onComplete(e))}))),e.get("metatype")===n.METATYPE_BUS){l.id=e.get("objectId"),l.mains={},l.mains[e.get("objectId")]={id:e.get("objectId"),type:e.get("type"),metatype:"bus"};var h={};s.forEach((function(e){e.name&&e.name===n.FACET_iPROPERTIES?h[e.name]={available:!0}:h[e.name]={available:!1}})),l.facets=h,r&&r.createReadyEvent(l),"function"==typeof o.onComplete&&!0!==c&&o.onComplete(l),c=!0,a._valuesAsync.facetCheck=!1}else e.get("metatype")===n.METATYPE_REL&&require(["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/constants/ConstantsMapping"],(function(t,i){var d=i.getServiceBySource("3dspace");t.getInstanceDetails({modelList:[e],defService:d,onComplete:function(t){!function(t){if(t&&t.infos&&t.infos.status&&t.infos.status===n.EP_RESPONSE_OK){var i=null,d=null,u=null;t&&t.result&&t.result.length>0&&(t.result.forEach((function(e){for(var t in e)"outputs"===t&&e[t].RELATIONS&&e[t].RELATIONS&&e[t].RELATIONS.length>0&&e[t].RELATIONS.forEach((function(e){e.physicalid&&(i=e.physicalid),e["ds6w:type"]&&e["ds6w:type"],e.to&&e.to.physicalid&&e.to["ds6w:type"]&&(d=e.to.physicalid,u=e.to["ds6w:type"])}))})),l.mains={},l.mains[i]={id:d,type:u,metatype:"bus"});var h={};s.forEach((function(e){e.name&&e.name===n.FACET_iPROPERTIES?h[e.name]={available:!0}:h[e.name]={available:!1}})),l.facets=h,l.id=e.get("objectId"),r&&r.createReadyEvent(l),"function"==typeof o.onComplete&&!0!==c&&o.onComplete(l),c=!0,a._valuesAsync.facetCheck=!1}}(t)},primitives:[{navigate_to_rel:{id:1,mode:"return_rel"}}],patterns:{RELATIONS:[{id:1}]},attributes:["ds6w:type"]})}))}})})),define("DS/EditPropWidget/models/EditPropModelMerge",["UWA/Core","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropAttributeModel","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n){var s=t.extend({_innerModels:{},setup:function(){this._parent(),this._innerModels={}},getMergingModels:function(){return this._innerModels},getMergedModelIds:function(){var e=this.getMergingModels();return Object.keys(e)},setMergingModels:function(e){var t=this;if(this._innerModels)for(var i in this._innerModels){(n=this._innerModels[i])._callbackMerge&&n.removeEvent("onChangeAttributes",n._callbackMerge[t.get("objectId")])}for(var i in this._innerModels=e,this._innerModels){var n;(n=this._innerModels[i])._callbackMerge=n._callbackMerge?n._callbackMerge:{},n._callbackMerge[t.get("objectId")]=function(e,i){var n=e.get("objectId");i.forEach((function(e){var i=e.getIdentifier(),s=t.get(i);if(s){s.get("value")[n]=e.get("value"),s.get("valueDB")[n]=e.get("valueDB"),s.get("dimension")[n]=e.get("dimension"),t.setFloatingAttribute(i,s)}}))},n.addEvent("onChangeAttributes",n._callbackMerge[t.get("objectId")])}},isMergedModel:function(){return!0},set:function(e,t){t instanceof i&&t.set("multisel",!0),this._parent(e,t)},getComputedTitle:function(){var e=this.getMergedModelIds().length;return newLabel=n.replace(n.get("{0} objects selected"),{0:e}),newLabel},resetAllErrors:function(){var e=this;this.lockModel(!0);var t=this.getMergingModels();for(var i in t)t[i].resetAllErrors();setTimeout((function(){e.lockModel(!1)})),e._parent(!1)},clearChangedValue:function(e){var t=this;this.lockModel(!0);var i=this.getMergingModels();for(var n in i)i[n].clearChangedValue(e);setTimeout((function(){t.lockModel(!1)}))},resetInitialValues:function(){this._parent.apply(this,arguments);var e=this.getMergingModels();for(var t in e){var i=e[t];i.resetInitialValues.apply(i,arguments)}},getChangedValues:function(){var e={},t=this.getMergingModels();for(var i in t){var n=t[i];if(n){var s=n.getChangedValues();if(s)for(var o in s){var a=this.get(o);a&&(e[o]=a)}}}return e},_getChangedAttributes:function(e){var t=e.changedAttributes(),i=e.getChangedValues(),n=[];for(var s in t)null!==i[s]&&n.push(s);return n},resetAttribute:function(t){var n=this;let s=n.getMergingModels();n.lockModel(!0),t.resetInitialValues();var o=new i(e.clone(t));for(let e in s){var a=s[e];a&&a.resetAttribute(t)}n.set(t.getIdentifier(),o,{silent:!1}),setTimeout((function(){n.lockModel(!1)}))},getTypes:function(){let e=[],t=new Set;if("connection"==this.get("metatype")){let i=this.get("_DS_ATTR_label")&&this.get("_DS_ATTR_label").valueDB;if("object"==typeof i)for(let n in i)t.has(i[n])||(t.add(i[n]),e.push(i[n]))}else if(this._innerModels)for(let i in this._innerModels){let n=this._innerModels[i];if(n.getTypes&&"function"==typeof n.getTypes){let i=n.getTypes();if(Array.isArray(i)&&i.length>0){let n=i[0];t.has(n)||(t.add(n),e.push(n))}}}return 0==e.length&&console.log("EditPropModelMerge :: no type present in model"),e}});return s})),define("DS/EditPropWidget/facets/Properties/TweakerManager",["UWA/Core","UWA/Class","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/models/EditPropAttributeModel","DS/WidgetServices/WidgetServices","DS/WebappsUtils/WebappsUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r){var l="DEFAULT",d={};d[l]={type:l,from:function(e){return e.valueDB},to:function(e){return{valueDB:e.value,value:e.displayValue?e.displayValue:e.value}},extraOptions:function(e,t){var i=t.authorizedValuesNLS,n=t.authorizedValues,s=t.authorizedValuesGroup,o=t.authorizedValuesIcon,r=t.customSelect,c=t.sortedOptions,u=!0===t.autocomplete,h=i.length;if(h>0){var p=!1,m=t.get("tw_type"),f=d[m];f&&f.from||(f=d[l]);for(var g=[],v=[],_=0;_<h;_++){var E=i[_],w=n[_],b={label:E,value:w,group:s?s[_]:null};if(o&&o[_]){var y="icons/16/"+o[_]+".png",C=a.getWebappsAssetUrl("ENOCollabSharingCmds",y);b.icon=C}v.push(b),p||i[_]!==n[_]?p=!0:(w=f.from({value:E,valueDB:w}),E=null,g.push({label:E,value:w}))}return{autocomplete:u,sortedOptions:c,customSelect:r,trueEnum:p,data:{list:p?v:g,range_required:t.authorizedValuesRequired}}}}},d[n.TYPES.BOOLEAN]={type:n.TYPES.BOOLEAN,from:function(e){return!0===e.valueDB||"string"==typeof e.valueDB&&"true"===e.valueDB.toLowerCase()}},d[n.TYPES.RELATION]={type:n.TYPES.RELATION,from:function(e){return{id:e.valueDB,label:e.value&&e.value.label?e.value.label:""}},to:function(e){return{valueDB:e.value?e.value.id:"",value:e.value?e.value:""}},extraOptions:function(e,t){return{data:{rules:t.get("rules")}}}},d[n.TYPES.PERSON]={type:n.TYPES.PERSON,from:function(e){return{personID:e.valueDB,fullName:e.value}},to:function(e){return{valueDB:e.value.personID,value:e.value.fullName}},extraOptions:function(e){return{data:{objectIDs:e.isMergedModel()?e.getMergedModelIds():[e.get("objectId")]}}},check:function(e,t){if(null===t)return{message:r.UnvalidAttribute,type:"error"}}},d[n.TYPES.DATE]={type:n.TYPES.DATE,from:function(e){return o.formatDateObj(e.valueDB)},to:function(e){return{valueDB:o.convertDateToStandard(e.value,!0).valueDB,value:e.displayValue}}},d[n.TYPES.DATETIME]=d[n.TYPES.DATE],d[n.TYPES.BOOLEAN_WUX]=d[n.TYPES.BOOLEAN],d[n.TYPES.DATE_WUX]=d[n.TYPES.DATE],d[n.TYPES.DATETIME_WUX]=d[n.TYPES.DATE],d[n.TYPES.PERSON_WUX]=d[n.TYPES.PERSON],d[n.TYPES.UNIT]={type:n.TYPES.UNIT,from:function(e){return{valueDB:e.valueDB,dimension:e.dimension}},to:function(e){return{valueDB:e.value.valueDB,value:e.displayValue?e.displayValue:e.value.valueDB,dimension:e.value.dimension}}};var c=function(e){var t=d[e.get("tw_type")],i=null;if(t&&t.check){var n=e.get("valueDB");e.multisel&&(n=n[Object.keys(n)[0]]),Array.isArray(n)||(n=[n]),n.every((function(n){return null===(i=t.check(e,n))}))}return i};return t.extend({_sharedOptions:null,init:function(e,t){this._parent(e),this.elements={},this.elements.fields={},this._sharedOptions=t,this.onNotification=e.onNotification?e.onNotification:function(){},this.options=this.options?this.options:{},this._setEditable(e&&!0===e.editable)},isReadOnly:function(){var e=this._sharedOptions;return!e||!0===e.readOnly},clear:function(){for(var e in this.elements.fields)this._removeField(e);this.elements.fields={}},actionOnScroll:function(){for(var e in this.elements.fields){var t=this.elements.fields[e];t.field&&"function"==typeof t.field.actionOnScroll&&t.field.actionOnScroll()}},getValidationFunction:function(e){var t=d[e];if(t&&t.check)return c},_getValueForTweaker:function(e,t){var i=e,n=d[i];n&&n.from||(n=d[i=l]);return"boolean_wux"==e&&""==t.value&&""==t.valueDB?null:t.multisel?this.__getValueFromMultiselForConvert(n,t):this.__getValueFromStandardForConvert(n,t)},__getValueFromStandardForConvert:function(e,t){var i=!0===t.multivalue,n=e.type,s=t.value,o=Array.isArray(s)?s:[s],a=s,r=o;n===l&&t.readOnly||(a=t.valueDB,r=Array.isArray(a)?a:[a]);let d="";void 0!==t.dimension&&null!==t.dimension&&(d=t.dimension,d=Array.isArray(d)?d:[d]);for(var c=o.length,u=[],h=0;h<c;h++){var p=null;p="boolean"===t.type&&i?(!0===r[h]||r[h],r[h]):d.length>0?e.from({value:o[h],valueDB:r[h],dimension:d[h]}):e.from({value:o[h],valueDB:r[h]}),u.push(p)}return i?u:c>0?u[0]:null},__getValueFromMultiselForConvert:function(e,t){var i=t.value,n=t.valueDB;let s=t.dimension;var o={};for(var a in i){var r={value:i[a],valueDB:n[a],multivalue:t.multivalue,readOnly:t.readOnly};if(s){let e=s[a];r.dimension=e}var l=this.__getValueFromStandardForConvert(e,r);o[a]=l}return o},__getValueFromStandardFromTweaker:function(e,t){var i=t.value,n=t.displayValue,s={},o={},a=void 0;if(Array.isArray(i)){s=[],o=[],a=[];for(var r=i.length,l=0;l<r;l++){var d=e.to({value:i[l],displayValue:n[l]});s.push(d.value),o.push(d.valueDB),d.dimension&&a.push(d.dimension)}}else s=(d=e.to({value:i,displayValue:n})).value,o=d.valueDB,d.dimension&&(a=d.dimension,Array.isArray(a)||(a=[a]));return{value:s,valueDB:o,dimension:a}},__getValueFromMultiselFromTweaker:function(e,t,i){var n=t.value,s=t.displayValue;valueAttr={},valueDBAttr={};let o={};for(var a in n){i&&i.multivalue&&(n[a]=Array.isArray(n[a])?n[a]:[n[a]],s[a]=Array.isArray(s[a])?s[a]:[s[a]]);var r=this.__getValueFromStandardFromTweaker(e,{value:n[a],displayValue:s[a]});valueAttr[a]=r.value,valueDBAttr[a]=r.valueDB,void 0!==r.dimension&&null!==r.dimension&&(o[a]=r.dimension)}let l={value:valueAttr,valueDB:valueDBAttr};return Object.keys(o).length>0&&(l.dimension=o),l},_getValueFromTweaker:function(e,t,i){var n=d[e];n&&n.to||(n=d[l]);i.multivalue;var s={value:t.getValue(),displayValue:t.getDisplayValues()};return!0===i.multisel?this.__getValueFromMultiselFromTweaker(n,s,i):this.__getValueFromStandardFromTweaker(n,s)},_generateOptions:function(e,t,i){var n={units:i.dimension,minValue:i.minval,maxValue:i.maxval,minValueIncluded:i.minvalincluded,maxValueIncluded:i.maxvalincluded,multiline:i.multiline,multisel:i.multisel,icon:i.urlIcon,parameter:!!i.attributeID,multivalued:i.multivalue,mandatory:i.mandatory,readOnly:i.readOnly,applySort:i.applySort,type:i.type,placeholder:i.placeholder,disable:i.disable,keepformat:i.keepformat,displayAsEntered:i.displayAsEntered};this.isReadOnly()&&(n.editable=!1),"prop"===t.facet&&(n.prop=!0);var s=d[e];if(s&&s.extraOptions||(s=d[l]),s&&s.extraOptions){var o=s.extraOptions(t,i);for(var a in o)n[a]=o[a]}i.dropdownMode&&(n.dropdownMode=i.dropdownMode),i.dimensionType&&(n.dimensionType=i.dimensionType),n.hasDimension=!(!t.propertiesWidgetUI&&!t.newInfraUI||!i.dimensionType||!i.authorizedValues||0!==i.authorizedValues.length),n.newInfraUI=!!t.newInfraUI;let r=t.get("_sourceId");return r||(r=t.get("source")),r||(r=t.get("sourceName")),n.source=r,t.newInfraUI&&(n.newInfraUI=!!t.newInfraUI),n},_updateValue:function(e,t,i,n,s){if(e.isMergedModel()){var o=e.getMergingModels();for(var a in e.lockModel(!0),o)innerModel=o[a],s?this.__updateValue(innerModel,innerModel.get(t.getIdentifier()),i[a],n[a],s[a]):this.__updateValue(innerModel,innerModel.get(t.getIdentifier()),i[a],n[a]);setTimeout((function(){e.lockModel(!1)}))}else this.__updateValue(e,t,i,n,s)},__updateValue:function(e,t,i,n,s){var o=e.getChangedValues(),a=t.getIdentifier(),r=(t.value,t.valueDB),l=t.dimension,d=o[a];if(d)d.value,r=d.valueDB;var c=!1,u="",h="",p="",m="";if(null==n||null==n)u="";else if(Array.isArray(n)){u=[...n].sort().toString()}else u=n;if(null==r||null==r)h="";else if(Array.isArray(r)){h=[...r].sort().toString()}else h=r;if(null==s)p="";else if(Array.isArray(s)&&s.length>0){p=[...s].sort().toString()}else p=s;if(null==l)m="";else if(Array.isArray(l)&&l.length>0){m=[...l].sort().toString()}else m=l;if(c=u===h,null!=s&&null!=s&&(c=c&&m===p),!c&&e.isMergedModel()){c=!0;var f=e.getMergingModels();for(var g in f)c=c&&f[g]===r[g]}c||this._modelChangeValue(e,e.get(a),i,n,s)},_modelChangeValue:function(t,i,n,o,a){var r=new s(e.clone(i));return r.set("value",n),r.set("valueDB",o),null!=a&&null!=a&&Array.isArray(a)&&a.length>0&&r.set("dimension",a),t.set(i.getIdentifier(),r),r},_getOrCreateField:function(e){var t=this.elements.fields[e];return t||(t=this.elements.fields[e]={}),t},_addEventToField:function(e,t,i){var n=this._getOrCreateField(t);n.events||(n.events=[]),n.events.push(i),n.model=e},_addTweakerToField:function(e,t){this._getOrCreateField(e).field=t},_removeField:function(e){var t=this.elements.fields[e];t.field&&("function"==typeof t.destroy?t.destroy():"function"==typeof t.field.destroy&&t.field.destroy()),this._removeEvents(e),delete this.elements.fields[e]},_removeEvents(e){let t=this.elements.fields[e];t.events&&t.model&&t.events.forEach((function(i){t.model.removeEvent(e,i)}))},setError:function(e){},onNotification:function(e){},_manageOnChangeEvent:function(e,t,i,n){var s=function(){setTimeout((function(){i.elements.container?n.call():e.removeEvent(t,s)}))};this._addEventToField(e,t,s),e.addEvent("onChange:"+t,s)},_manageTweakerResetEvent:function(e,t,i,n){var s=function(){setTimeout((function(){i.elements.container?n.call():e.removeEvent(t,s)}))};this._addEventToField(e,t,s),e.addEvent("onReset:"+t,s)},_setEditable:function(e){this.editable=e&&!this.isReadOnly()},underEdition:function(){return this.editable&&!this.isReadOnly()},switchMode:function(e){for(var t in this._setEditable(e),this.elements.fields){var i=this.elements.fields[t];i&&i.field&&i.field.switchMode(this.underEdition())}},getTweakerFromId:function(e){return this.elements.fields[e]},getTweaker:function(e,t,s,o,a){var r=this,l=e.get(t),d=this._generateOptions(s,e,l);(e.webUxTweakers||e.propertiesWidgetUI||e.newInfraUI)&&!0===d.trueEnum?s=n.TYPES.ENUM_WUX:e.propertiesWidgetUI||e.webUxTweakers||e.newInfraUI||!0!==d.trueEnum||(s=n.TYPES.ENUM);var c=this._getValueForTweaker(s,l);if(d.value=c,d.events={changes:function(){var i=e.get(t);if(i){var n=r._getValueFromTweaker(s,this,i);r._updateValue(e,i,n.value,n.valueDB,n.dimension)}},notification:function(e){r.onNotification(e)},resetattribute:function(){var i=e.get(t);i&&e.resetAttribute(i)}},o)for(var u in o)d[u]=o[u];i.getTweaker(s,d,(function(i){r._addTweakerToField(t,i),r._manageOnChangeEvent(e,t,i,(function(){var n=e.get(t),o=r._getValueForTweaker(s,n);i.setValue(o)})),r._manageTweakerResetEvent(e,t,i,(function(){"function"==typeof i.resetUI&&i.resetUI()})),i.switchMode(r.underEdition()),a.call(this,i)}))}})})),define("DS/EditPropWidget/utils/DomainPropertiesUtils",["DS/EditPropWidget/constants/EditPropConstants","text!DS/EditPropWidget/assets/domainCentricDictionary/DomainCentricDictionary.json","text!DS/EditPropWidget/assets/settings/enoFacetsOptionsDomainCentric.json"],(function(e,t,i){"use strict";return t=JSON.parse(t),i=JSON.parse(i),{getDomainFromI3dx:function(e){if(!e)return null;let t=e.split("!");return t.length>0?t[0].substring(5):null},getServiceAndRelativePathFromDictionary:function(e){if(e){let i=t[e.toUpperCase()];if(i)return i}return null},checkIfDomainPropFacetToLoad:function(e){let t=this;if(!e)return!1;let i=t.getDomainFromI3dx(e);if(i){if(null!=t.getServiceAndRelativePathFromDictionary(i))return!0}return!1},checkFacetsVisibility:function(t,n){let s=t.facets,o=t.model;if(!o||!s)return void(n[e.FACET_DOMAINPROPERTIES]=!0);let a=o.get("i3dx");if(!a)return void(n[e.FACET_DOMAINPROPERTIES]=!0);let r=this.getDomainFromI3dx(a);r&&(r=r.toLowerCase(),s.map((e=>{let t=e.name,s=i[t];if(s){let e=s.authorizedDomains;if(e&&Array.isArray(e))if(e.length>0){-1!=e.indexOf(r)&&(n[t]=!0)}else n[t]=!0}})))}}})),define("DS/EditPropWidget/facets/Common/PropertiesDerived",["DS/EditPropWidget/facets/Properties/EditPropController","UWA/Controls/Abstract","UWA/Class","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices"],(function(e,t,i,n,s,o,a){"use strict";return e.extend({metatype:o.METATYPE_UNKNOWN,setOccurrence:function(e){var t=this,i=e?e.getOptions(this.getTabId()):null,o=e?e.getModel(this.getTabId()):null;if(i&&!o){if("object"==typeof i){var a=i.targets;if(null!=a){var r=[],l={};if(a.forEach((function(e){var i=new n({objectId:e.id,metatype:t.metatype});r.push(i),l[e.id]=i})),e.isMergedOccurrence()){var d=e.getMergePrefixe();(o=new s({objectId:d,metatype:t.metatype})).setMergingModels(l)}else if(r.length>0){d=r[0].get("objectId");o=new n({objectId:d,metatype:t.metatype})}e.setModel(this.getTabId(),o)}}}(null==e||e.getModel(this.getTabId()))&&this._parent(e)}})})),define("DS/EditPropWidget/facets/Instance/InstanceFacet",["DS/EditPropWidget/facets/Common/PropertiesDerived","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t){"use strict";return e.extend({metatype:t.REL})})),define("DS/EditPropWidget/facets/EBOMPart/EBOMPart",["DS/EditPropWidget/facets/Common/PropertiesDerived","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t){"use strict";return e.extend({metatype:t.BUS,init:function(e){var t={};for(var i in e)t[i]=e[i];t.readOnly=!0,this._parent(t)}})})),define("DS/EditPropWidget/models/OccurrenceModel",["UWA/Class/Model","DS/EditPropWidget/models/EditPropModel","UWA/Class/Debug"],(function(e,t,i){"use strict";return e.extend(i,{defaults:{isMerging:!1,modelPrefix:"00",secondaryOptionsForFacet:[]},isMergedOccurrence:function(){return!0===this.get("isMerging")},getMergePrefixe:function(){return this.get("modelPrefix")},getAllModels:function(e,i){var n=this._attributes,s=!0===e?[]:{};for(var o in n)if(n[o].model instanceof t&&(!0===e?s.push(n[o].model):s[o]=n[o].model,!0===i))break;return s},_getModelElement:function(e){var t=this.get(e);return t||(t={model:null,options:null}),t},setOptions:function(e,t){var i=this._getModelElement();i.options=t,this.set(e,i)},getOptions:function(e){var t=this.get(e);return t?t.options:null},setModel:function(e,t){var i=this._getModelElement();i.model=t,this.set(e,i)},getModel:function(e){var t=this.get(e);return t?t.model:null},setSecondaryOptionsForFacet:function(e){this.set("secondaryOptionsForFacet",e)},getSecondaryOptionsForFacet:function(){return this.get("secondaryOptionsForFacet")},getSharedInformationForFacet:function(){let e=this.get("sharedInformationForFacet");return e||null},setSharedInformationForFacet:function(e){this.set("sharedInformationForFacet",e)}})})),define("DS/EditPropWidget/facets/Common/FacetsCore",["DS/EditPropWidget/models/CommonAbstract"],(function(e){return e.extend({_sharedContext:null,destroyComponent:function(){},onResize:function(){},updateFacet:function(){},getButtons:function(){},onAction:function(e){},onSave:function(){},getExtensions:function(){},nothingToSave:function(){return!0},isActionAvailable:function(e){return!0},init:function(e){this._parent(e),this.elements||(this.elements={})},getTabId:function(){return this.options.tabId?this.options.tabId:""},onRefresh:function(){this.updateFacet()},getContext:function(){return this._sharedContext},switchSaveButton:function(e){this._raiseEvent("switchSave",e)},switchAddButton:function(e){this._raiseEvent("switchAdd",e)},refreshActions:function(){this._raiseEvent("updateActions")},updateReadWriteAccess:function(e){this._raiseEvent("updateRWA",e)},_raiseNotification:function(e,t,i){t=t||"error",this.dispatchEvent("onNotification",{msg:e,eventID:t,customClass:i})},_raiseEvent:function(e,t){e&&this.dispatchEvent("onEvent",{facet:this.getTabId(),eventID:e,value:t})},inject:function(e){var t=this.getUI();t&&(t.hide(),t.inject(e))},show:function(){return this.__callMethodOnUI("show")},hide:function(){return this.__callMethodOnUI("hide")},getOptimalSize:function(){return this.__callMethodOnUI("getSize")},__callMethodOnUI:function(e){var t=this._getUI(),i=t[e];return"function"!=typeof i&&(i=(t=this._getDOMUI())[e]),t?i.call(t):null},getUI:function(){return this._getUI()},_getDOMUI:function(){for(var e=this._getUI();"function"==typeof e.getContent;)e=e.getContent();return e},_getUI:function(){return this.elements?this.elements.container:null},showLoader:function(){this._raiseEvent("switchLoader",!0)},hideLoader:function(){this._raiseEvent("switchLoader",!1)},display:function(e){this.setContext(e),this.show()},setContext:function(e){this._sharedContext!==e&&(this._sharedContext=e,this.updateFacet())},_loadRuntimeFacet:function(e){this.dispatchEvent("runtimeFacetLoading",{facetsList:e})}})})),define("DS/EditPropWidget/facets/Common/FacetsBase",["DS/EditPropWidget/facets/Common/FacetsCore","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t){var i=e.extend({_lastUpdatedId:null,_sharedOptions:null,init:function(e,t){this._sharedOptions=t,this._parent.apply(this,arguments),this.elements||(this.elements={})},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var e=this.getSharedOptions();return!e||!0===e.readOnly},getOccurrence:function(){return this.getContext()},getModel:function(e){var i=null,n=this.getOccurrence();if(n&&(model=this.getOccurrence().getModel(this.getTabId())),e){if(model&&model.get("objectId")===e&&(i=model),!model&&n){var s=n.getAllModels();for(var o in s){var a=s[o];if(a&&a.get("objectId")===e){i=a;break}}}}else n&&(model||(model=this.getOccurrence().getModel(t.FACET_PROPERTIES)),model||(model=this.getOccurrence().getModel(t.MODEL_INIT)),i=model);return i},setContext:function(e){this.setOccurrence(e)},setOccurrence:function(e){var i;if((i=this.getOccurrence())&&e){var n=i.getModel(t.MODEL_INIT),s=i.getModel(t.FACET_PROPERTIES),o=e.getModel(t.MODEL_INIT),a=e.getModel(t.FACET_PROPERTIES);this.getModel();var r=e.getModel(this.getTabId())}if(this._setOccurrence(e),i=this.getOccurrence()){var l=this.getModel();if(!l)return;var d=l.get("objectId");"relationship"==l.get("metatype")&&(d=l.get("selReferenceID")),this.loadDomainFacet&&l.get("i3dx")&&(d=l.get("i3dx"));var c=!0;r&&n.get("objectId")===o.get("objectId")?(c=!1,i.setModel(this.getTabId(),r)):s&&a&&s.get("objectId")===a.get("objectId")?(c=!1,i.setModel(t.FACET_PROPERTIES,s)):n&&n.get("objectId")===o.get("objectId")&&(c=!1,i.setModel(t.MODEL_INIT,n)),(d!=this._lastUpdatedId||c)&&(this._lastUpdatedId=d,this.updateFacet())}},_setOccurrence:function(e){this._sharedContext=e},setModel:function(e){this.getTabId()===t.FACET_iPROPERTIES||this.getTabId()===t.FACET_DOMAINPROPERTIES?this.getOccurrence()&&this.getOccurrence().setModel(t.FACET_PROPERTIES,e):this.getOccurrence()&&this.getOccurrence().setModel(this.getTabId(),e)}});return i})),define("DS/EditPropWidget/facets/SwymComments/SwymComments",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","UWA/Class","DS/WidgetServices/WidgetServices","DS/UIKIT/Scroller","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o){return i.extend(t,e,{_socialView:null,init:function(e){this._socialView=null,this._parent(e),this._initUI()},_initUI:function(){this.elements.container=UWA.createElement("div",{class:"container_SwymComment"}),this.elements.content=UWA.createElement("div",{class:"content_SwymComment"}),this.elements.contentScroll=UWA.createElement("div",{class:"contentScroll_SwymComment"}),this.elements.contentScroll.inject(this.elements.content),this.elements.scroller=new s({element:this.elements.content}).inject(this.elements.container)},updateFacet:function(){this._socialView&&this._socialView.destroy();var e=this;this.elements.contentScroll.empty();var t=this.getModel();let i=e.getOccurrence(),s="";if(i){let e=i.getSharedInformationForFacet();e&&e.securityContextFromAppPreference&&(s=e.securityContextFromAppPreference)}if(t){var a=t.get("objectId");"relationship"==t.get("metatype")&&(a=t.get("selReferenceID"));let i=null;t.get("_DS_ATTR_type")&&t.get("_DS_ATTR_type").valueDB?i=t.get("_DS_ATTR_type").valueDB:null===i&&t.get("type")&&t.get("type").valueDB?i=t.get("type").valueDB:null===i&&t.get("ds6w:type")&&t.get("ds6w:type").valueDB&&(i=t.get("ds6w:type").valueDB),n.getServicesUrl({onComplete:function(r){Array.isArray(r)&&r.length>0&&(r=r[0]);var l=t.get("source")?t.get("source"):"3DSpace",d=r[l]?r[l]:r["3DSpace"],c=r["3DSwym"],u=t.identifire?t.identifire+a:a,h=t.path?d+t.path:d;if(d){var p=c||"https://dsext001-eu1-215dsi0708-3dswym.3dexperience.3ds.com",m=widget.data.parent_x3dAppId;m||(m=widget.data.appId);var f=n.getTenantID(),g={protocol:"3DXContent",version:"",source:"",widgetId:"",data:{items:[{envId:f=f||"OnPremise",serviceId:l,objectId:a,objectType:"",facet:"isSocial"}]}};i&&(g.data.items[0].objectType=i);let o={};s&&(o.SecurityContext=s),console.log(JSON.stringify(g)),console.log(encodeURI(JSON.stringify(g)));require(["DS/SocialToolbarVue/SocialToolbarVueUWAView"],(function(i){let n={platformId:f,urls:{service:h,swym:p,serviceCSRF:{name:"X-DS-CSRFTOKEN"},customHeaders:o},disableFeatures:{disableShare:!0},atInit:{nbCommentsToLoad:8},subjectUri:u,appForcedLinkUri:"/#app:ENOLCMT_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(g))};e._socialView=new i,e._socialView.render({props:n}),e.elements.contentScroll.empty(),e._socialView.inject(e.elements.contentScroll),e._socialView.listenTo(e._socialView,{onClickOnMedia(e){var i={annotation:e.annotation.annotation};t.clickOnAnnotationData(i,{clean:!0})}})}),(function(i){require(["DS/SocialToolbar/SocialToolbar"],(function(i){e._socialView=new i({commentProxyToken:{header:"X-DS-CSRFTOKEN"},customHeaders:o,events:{onMediaClick:function(e){var i={annotation:e.data.annotationFile};t.clickOnAnnotationData(i,{clean:!0})}},"3DSwymUrl":p,subjectURI:u,tenantId:f,serviceURL:h,enableShare:!1,appForcedLinkUri:"/#app:ENOLCMT_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(g))}),e.elements.contentScroll.empty(),e._socialView.inject(e.elements.contentScroll)}))}))}else e._raiseNotification(o.get("CannotFindServerAdress"),"error","SC_FindServer")}})}else UWA.createElement("div",{class:"SC_NoItems",text:o.get("NoItemSelected")}).inject(e.elements.contentScroll)},destroyComponent:function(){this._socialView&&this._socialView.destroy()},onResize:function(){},onRefresh:function(){this.updateFacet()}})})),define("DS/EditPropWidget/facets/GeneralHistory/History",["DS/EditPropWidget/facets/Common/FacetsBase","DS/WidgetServices/WidgetServices","DS/ENXHistoryUX/View/HistoryFacet","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s){"use strict";return e.extend({defaultOptions:{className:"",nbResults:5},init:function(e){this._parent(e),this.options=e,this._initUI()},_initUI:function(){var e=this;e.elements={};e.getModel();var t=UWA.createElement("div",{class:"EP_HistoryFacet_Container"});e.elements.container=t},updateFacet:function(e){var n=this,s=n.getModel();if(s.isMergedModel())return;let o=n.getOccurrence();if("connection"===s.get("metatype")&&o){let e=o.get("properties");e&&e.model&&(s=e.model)}let a="relationship"===s.get("metatype")?s.get("selReferenceID")?s.get("selReferenceID"):s.get("instrefid"):s.get("objectId"),r="";if(o){let e=o.getSecondaryOptionsForFacet();e&&Array.isArray(e)&&e.length>0&&e.forEach((function(e){"rel"===e.metatype&&(r=e.id)}));let t=o.get("_Model_init");if(t&&t.model){let e=t.model;e&&"function"==typeof e.get&&"relationship"===e.get("metatype")&&(e.get("instrefid")||e.get("selReferenceID"))&&(a=e.get("instrefid")?e.get("instrefid"):e.get("selReferenceID"),r=e.get("objectId"))}}t.get3DSpaceUrlAsync({onComplete:function(e){var s=t.getTenantID();s=s&&0!=s.length?"tenant="+s:"tenant=OnPremise";let o={id:[],connection:[],facetLang:t.getLanguage(),securityContext:n.options.securityContextFromAppPreference};a&&o.id.push(a),r&&o.connection.push(r),t.isReplayedODT()?window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.EP_ODTData={options:o}:window.top.EP_ODTData={options:o}:0===o.id.length&&0===o.connection.length||i.init(o,n.elements.container)}})}})})),define("DS/EditPropWidget/facets/Properties/EditPropBase",["UWA/Class","DS/UIKIT/Tooltip","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/facets/Properties/TweakerManager"],(function(e,t,i,n){"use strict";return e.extend({lTooltip:[],elements:{},_sharedOptions:null,init:function(e,t){var i=this;this._sharedOptions=t||{},this._parent(e),this.tweakerManager=new n({editable:!0===e.editMode,onNotification:function(e){i._manageError(e)}},t)},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var e=this.getSharedOptions();return!e||!0===e.readOnly},switchTweakersStatus:function(e){this.tweakerManager.switchMode(e)},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},_valueIsChanging:function(e,t){},setError:function(e){},_manageError:function(e,t){}})})),define("DS/EditPropWidget/ICard/IdCard",["UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/TooltipModel","DS/UIKIT/Mask","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServices/WidgetServices","DS/EditPropWidget/facets/Properties/TweakerManager","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/buttonsBar/ButtonsBar","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l,d,c,u){var h=function(){this.dispatchEvent("thumbnailClick")},p=e.extend({init:function(e){this._parent.apply(this,arguments),this._showThumbnailsCondition={},this._currentModel=null,this._titleAttr=null,this.elements.container=UWA.createElement("div",{class:"idCardContainer"}),this.elements.thumbnail=UWA.createElement("div",{class:"thumbnail"}),this.elements.attrContainer=UWA.createElement("div",{class:"attributes"}),this.elements.thumbnail.inject(this.elements.container),this.elements.attrContainer.inject(this.elements.container),this.elements.headerContainer=UWA.createElement("div",{class:"header-section"}),this.elements.titleContainer=UWA.createElement("div",{class:"title-section"}),this.elements.title=UWA.createElement("div",{class:"title"}),this.elements.revision=UWA.createElement("div",{class:"revision"}),this.elements.multititles=UWA.createElement("div",{class:"multititles"}),this.elements.title.inject(this.elements.titleContainer),this.elements.revision.inject(this.elements.titleContainer),this.elements.multititles.inject(this.elements.titleContainer),this.elements.actions=new c({classname:"actions-section",minimumSize:200},this.elements.titleContainer),this.elements.actions.inject(this.elements.headerContainer),this.elements.titleContainer.inject(this.elements.headerContainer),this.elements.detailsContainer=UWA.createElement("div",{class:"details-section"}),this.elements.headerContainer.inject(this.elements.attrContainer),this.elements.detailsContainer.inject(this.elements.attrContainer),this.elements.owner=UWA.createElement("span",{class:"owner"}),this.elements.date=UWA.createElement("span",{class:"lastModified text-muted"}),this.elements.owner.inject(this.elements.detailsContainer),this.elements.date.inject(this.elements.detailsContainer),this.tweakerManager=new r({},{readOnly:!1}),this._handlerThumbnailClick=h.bind(this);var t=this,i=[{icon:"expand-up",text:u.get("hideIDCard"),method:"show"},{icon:"expand-down",text:u.get("showIDCard"),method:"hide"}],n=a.getWidgetValue(l.COLLAPSE_IC_PREFERENCE.name),s=0===n||1===n?n:0;this.defaultAction={name:"actionHide",text:i[s].text,icon:i[s].icon,handler:function(){var e=i[s=s?0:1];t.defaultAction.text=i[s].text,t.defaultAction.icon=i[s].icon,a.setWidgetValue(l.COLLAPSE_IC_PREFERENCE.name,s),t._updateFromExpandButton(e)}},this.setActions(e.actions);e=i[s];this._updateFromExpandButton(e)},_updateFromExpandButton:function(e){this.showThumbnail("collapse","show"===e.method),this.elements.detailsContainer[e.method](),this.elements.multititles[e.method](),this.elements.actions.updateButton("actionHide",e)},setActions:function(e){this.elements.actions.setButtons(e),this.elements.actions.addButton(this.defaultAction)},fillFromModel:function(e){this.clearValues();var t=e.getAllAttributes();if(t)for(var i in t){var n=t[i];n instanceof d&&this.setValueForSection(e,n)}if(!e.get("labelAttribute")){var s=e.get(l.MODEL_DS_ATTR+"label");s&&this.setValueForSection(e,s)}},clearValues:function(){this.elements.container&&(this.elements.owner.empty(),this.elements.date.empty(),this.elements.title.empty(),this.elements.multititles.empty(),this.elements.revision.empty())},onResize:function(){this._manageThumbnailDisplay(),this.elements.actions.onResize(),this._computeTitle()},maskThumbnail:function(){var e=this.getThumbnailElement();e&&n.mask(e)},unmaskThumbnail:function(){var e=this.getThumbnailElement();e&&n.unmask(e)},changeThumbnail:function(e,t){this.elements.thumbnail.setStyle("background-image","url("+e+")");var i=this.getThumbnailElement();i&&(this.showThumbnail("url",!!e),!0===t&&i.addClassName("clickable"),i.removeEvent("click",this._handlerThumbnailClick),i.addEvent("click",this._handlerThumbnailClick))},showThumbnail:function(e,t){this._showThumbnailsCondition[e]!==t&&(this._showThumbnailsCondition[e]=t,this.__manageThumbnailDisplay())},_manageThumbnailDisplay:function(){var e=this.elements.container.getSize();showThumbnails=e.width>=350,this.showThumbnail("width",showThumbnails)},__manageThumbnailDisplay:function(){var e=!0;for(var t in this._showThumbnailsCondition)if(!(e=this._showThumbnailsCondition[t]))break;e?this.elements.container.removeClassName("noThumbnail"):this.elements.container.addClassName("noThumbnail")},getThumbnailElement:function(){return this.elements.thumbnail},injectValue:function(e,t,i,n){this.elements[i]&&this._injectValue(e,t,this.elements[i],n)},_injectValue:function(e,t,i,n){var o={readOnly:!0,value:e,postBuild:!1};if(n)for(var a in n)o[a]=n[a];i.empty(),s.getTweaker(t,o,(function(e){i.empty(),e.inject(i),n&&n.callback&&n.callback()}))},addRevision:function(){if(this.elements.title){var e=this.elements.title.getElementsByClassName("tw_ROValue_content");e&&e.length>0&&this.elements.revision.inject(e[0])}},_computeTitle:function(e){if(this._currentModel){var t=this,i=this._currentModel.getComputedTitle(),n=e;e||(n=this._currentModel.get(this._titleAttr)),n&&(this._titleAttr=n.getIdentifier(),i||(i=n.get("value")));var s=!!(this.elements.container.getSize().width>380);s?this.elements.container.removeClassName("smallSize"):this.elements.container.addClassName("smallSize");var a=this.elements.attrContainer.getSize().width/4,r=i.length>a,l=s,d=s;this.injectValue(i,o.TYPES.STRING,"title",{postBuild:r,maxCharacters:a,multiline:l,forHTML:d,callback:function(){t.addRevision()}})}},setValueForSection:function(e,t){var i=t.get("sectionIdentityCard"),n=!!i;if(n){this._currentModel=e;var s="title"===i;if(s&&(this._computeTitle(t),!0===e.isMergedModel()?this.elements.title.addClassName("EP_MergedTitle"):this.elements.title.removeClassName("EP_MergedTitle")),!0!==e.isMergedModel())if(s){var r=e.get("revision");r||(r=e.get("ds6w:revision")),r&&this.injectValue(" "+r.get("value"),o.TYPES.STRING,"revision")}else if("ownerName"===i)this.injectValue(t.get("value")+" ",o.TYPES.STRING,"owner");else if("date"===i){var l=t.get("value");l=l||t.get("valueDB"),computedDate=a.formatDateObj(l),this._injectValue(computedDate,o.TYPES.DATETIME,this.elements.date)}}return n},hideButton:function(e){e&&this.elements.actions.hideButton(e)},showButton:function(e){e&&this.elements.actions.showButton(e)},checkButtonVisibility:function(e){if(e)return this.elements.actions.checkButtonVisibility(e)}});return p})),define("DS/EditPropWidget/models/EditPropHistoryModel",["DS/EditPropWidget/models/HistoryObjectModel"],(function(e){"use strict";return function(t){for(var i in this.user="",this.date="",this.event="",this.eventNls="",this.objects=[],this._generationObjectList=function(){if(this.objects&&this.objects.length>0){var t=[];this.objects.forEach((function(i){var n=new e(i);t.push(n)})),this.objects=t}},t)this[i]=t[i];this.set=function(e,t){void 0!==t&&(this[e]=t),"objects"===e&&this._generationObjectList()},this.get=function(e){return this[e]},this._generationObjectList()}})),define("DS/EditPropWidget/UI/IDCardSkeleton",["UWA/Class/Model","DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/ICard/IdCard","DS/EditPropWidget/facets/Properties/EditPropController","DS/WidgetServices/MultipleAsynchronousRequests","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/buttonsBar/ButtonsBar","DS/EditPropWidget/constants/ConstantsMapping","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/Controls/TabBar","DS/Controls/TooltipModel","DS/PlatformAPI/PlatformAPI","DS/WidgetServicesUI/tweakers/TweakerWUXButton","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l,d,c,u,h,p,m,f,g,v,_,E,w){"use strict";var b=!1;"undefined"!=typeof dscef&&(b=dscef.isA2X);var y={"DS/EditPropWidget/facets/Properties/EditPropController":s},C="withMenuBar";b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.perfoIncrem:window.top.perfoIncrem=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.perfoIncrem?window.dsDashboardWindow.top.perfoIncrem:window.top.perfoIncrem?window.top.perfoIncrem:0);var A="EP-FacetLabelIcon",S={};S[i.ACTION_SWITCH]={name:i.ACTION_SWITCH,text:w.get("EditProp_boutonSwitchtoEdit"),icon:i.ACTION_SWITCH,id:"EDITPROP_PENCIL_EDIT_ICON"},S[i.ACTION_RESET]={name:i.ACTION_RESET,text:w.get("Reset display"),icon:i.ACTION_RESET},S[i.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM]={name:i.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM,text:w.get("ViewIn3DSwym"),icon:"level-down"},S[i.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM]={name:i.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM,text:w.get("ViewIn3DSwym"),icon:"level-down"},S[i.ACTION_SWYM_VIEW_USER_PROFILE]={name:i.ACTION_SWYM_VIEW_USER_PROFILE,text:w.get("ViewUserProfile"),icon:"level-down"},S[i.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM]={name:i.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM,text:w.get("ViewIn3DSwym"),icon:"level-down"},S[i.ACTION_SHARING_FILTER_VIEW]={name:i.ACTION_SHARING_FILTER_VIEW,text:w.get("filterMembers"),icon:"filter"},S[i.ACTION_SHARING_DELETE]={name:i.ACTION_SHARING_DELETE,text:w.get("deleteSharingMembers"),icon:"trash"},S[i.ACTION_SHARING_ADD]={name:i.ACTION_SHARING_ADD,text:w.get("addSharingMembers"),icon:"topbar-share"},S[i.ACTION_SHARING_LIST_VIEW]={name:i.ACTION_SHARING_LIST_VIEW,text:w.get("sharingListView"),icon:"alpha-sorting-a-z"},S[i.ACTION_SHARING_LARGE_TILE_VIEW]={name:i.ACTION_SHARING_LARGE_TILE_VIEW,text:w.get("sharingLargeTileView"),icon:"group"};i.FACET_NONE;var D=t.extend({_lFacets:[],_sharedContext:null,_sharedOptions:{},_RWAccess:!1,defaultOptions:{name:"",className:"",showIdCard:!0,showTopBar:!0,showFacets:!0,warningOnUnsaved:!0,closeButton:!0,noThumbnail:!1,facetLabel:!0,displayType:i.STANDARD},init:function(e,t){this._sharedOptions={},this.indexModeParameter=!!t.indexModeParameter,this.disableAddExtensionButton=!!t.disableAddExtensionButton,this._parent(t),this.options.actions&&this.options.actions.forEach((function(e){void 0===e.after&&"action_close_panel"===e.name&&(e.after=!0)})),this._sharedContext=t.sharedContext?t.sharedContext:null,this._lFacets=e,this.elements||(this.elements={}),this.loaderFacetList=[],this.idcardInit()},getTopBar:function(){return this.elements.manageButtonDiv},idcardInit:function(e){var t=this,s=this.elements.container=UWA.createElement("div",{name:this.options.name,class:this.options.className}),o="";!0===this.options.showTopBar&&(o=C);this.elements.globalDiv=UWA.createElement("div",{class:"IDCardGlobalContain "+o}).inject(s);var a=t.elements.mainInterface=UWA.createElement("div",{class:"IDCardMainInterface"}).inject(this.elements.globalDiv),r=this.elements.masterTable=UWA.createElement("div",{class:"IDCardMasterTable "}).inject(a),d=this.elements.topTable=UWA.createElement("div",{class:"IDCardTopTableContainer"});if(this.elements.bottomMainArea=UWA.createElement("div",{class:"IDCardBottomArea"}),this.elements.bottomInnerArea=UWA.createElement("div",{class:"IDCardInnerBottomArea"}),this.elements.bottomInnerArea.inject(this.elements.bottomMainArea),this.elements.actionArea=UWA.createElement("div",{class:"actionArea"}),this.elements.facetTopLineMsg=UWA.createElement("div",{class:"facetTopLineMsg"}),this.elements.bottomArea=UWA.createElement("div",{class:"facetContainer"}),this.elements.actionArea.inject(this.elements.bottomInnerArea),this.elements.facetTopLineMsg.inject(this.elements.bottomInnerArea),this.elements.bottomArea.inject(this.elements.bottomInnerArea),this.elements.tabContainer=UWA.createElement("div",{class:"tabMainContainer"}),d.inject(r),this.elements.tabContainer.inject(r),this.elements.bottomMainArea.inject(r),this.elements.buttonsBar=new l({vertical:!1,minimumSize:-1}),this.elements.buttonsBar.inject(this.elements.actionArea),delete this.elements.postIdCard,!0===this.options.showIdCard){var c={};this.options.idCardOptions&&(c=this.options.idCardOptions),c.actions=[],this.elements.postIdCard=new n(c),t.identityCardContainer=UWA.createElement("div",{class:"topTableElement identityCardCell infra"}).inject(d);var u=UWA.createElement("div",{class:"ICTableContainer ",events:{click:function(){let e={currentFacet:t.currentFacetName};g.publish(`PropHeaderActivated:${widget.id}`,e)}}}).inject(this.identityCardContainer);this.elements.postIdCard.inject(u),this.currentFacetName=null,this.defaultFacetName=null,this.infoForFacet=null,this._createTabs([]),this.elements.superModal=new h({renderTo:this.container})}this.elements.manageButtonDiv=UWA.createElement("div",{class:"skeleton_ManageButtonDiv"}).inject(r),this.elements.loadingArea=new p({visible:!1}),this.elements.loadingArea.inject(this.elements.manageButtonDiv);var m={className:"TopButtonValid",emphasize:"primary",setAttribute:{name:"TopButtonValid"},clickCallback:function(){t._saveAllFacets()}};if(!0===t.options.updateSession)m.label=w.get("EP_OK"),this.elements.boutonValid=v(m);else{m.label=w.get("EP_Ok"),this.elements.boutonValid=v(m)}this.elements.boutonValid.hide(),this.elements.boutonValid.inject(this.elements.manageButtonDiv),this.elements.facetButtonDiv=UWA.createElement("div",{class:"skeleton_FacetButtonDiv",html:{}}).inject(this.elements.manageButtonDiv);if(t.disableAddExtensionButton||require(["DS/EditPropExtensions/UI/AddExtensionsWidget"],(function(e){var i={className:"TopButtonAdd",label:w.get("EP_Add"),setAttribute:{name:"TopButtonAdd"},clickCallback:function(){t._loadExtensions()}};t.elements.boutonAdd=v(i),!1===t.editMode&&t.elements.boutonAdd.hide(),!0===t.options.updateSession&&t.elements.boutonAdd.hide(),t.elements.boutonAdd.inject(t.elements.manageButtonDiv)})),this.elements.facetButtonDiv=UWA.createElement("div",{class:"skeleton_FacetButtonDiv",html:{}}).inject(this.elements.manageButtonDiv),this.options.closeButton){var f={label:w.get("EP_Close"),className:"TopButtonClose",setAttribute:{name:"TopButtonClose"},clickCallback:function(){t.checkChangeAuthorized((function(){t.dispatchEvent("onCancel"),"undefined"!=typeof dscef&&dscef.sendString('{"operation":"onClose","operationVersion":"1.0"}'),t.options.displayType===i.TRANSIENT?require(["DS/TransientWidget/TransientWidget"],(function(e){e.closeWidget()})):t.dispatchEvent("onInnerCancel")}))}};this.elements.boutonCancel=v(f),this.elements.boutonCancel.inject(this.elements.manageButtonDiv)}},showInlineFacetErrors:function(e,t){this.facetTopLineMsg||(this.facetTopLineMsg={});var i=this.facetTopLineMsg[e];i?i.getElement(".facetErrorLine-text").setText(t):((i=UWA.createElement("div",{class:"facetErrorLine-content "+e})).inject(this.elements.facetTopLineMsg),this.facetTopLineMsg[e]=i,UWA.createElement("span",{class:"facetErrorLine-icon wux-ui-3ds wux-ui-3ds-error"}).inject(i),UWA.createElement("span",{class:"facetErrorLine-text",text:t}).inject(i));e===this.currentFacetName?i.show():i.hide()},destroyInlineFacetErrors:function(e){if(this.facetTopLineMsg){var t=this.facetTopLineMsg[e];t&&(t.destroy(),delete this.facetTopLineMsg[e])}},_switchFacet:function(e){g.publish(`${e}:${widget.id}`,e);var t=e!==this.currentFacetName;if(this.currentFacetName=e,t&&this._manageFacetLaunching(),t&&this.lastTrackerEvent){var i={actionName:"Activate Tab",pd18:e};this.lastTrackerEvent&&this.lastTrackerEvent.persDim.pd16&&(i.pd16=this.lastTrackerEvent.persDim.pd16),this.lastTrackerEvent=_.createActionEventFromEvent(i,this.lastTrackerEvent),_.checkAndTrackPageEvent(this.lastTrackerEvent)}this._switchAdd(!0)},_createTabs:function(e){var t=this;!0===this.options.showFacets&&(this.elements.tabs&&this.elements.tabs.getTabCount()>0&&(this.elements.tabs.destroy(),this.elements.tabs=null),this.elements.tabs||(this.elements.tabs=new m({displayStyle:"strip",centeredFlag:!0,showComboBoxFlag:!0,editableFlag:!1,multiSelFlag:!1,reorderFlag:!1}),this.elements.tabs.touchMode=a.isTouchDevice(),this.elements.tabs.onSelectTab((function(e){if(void 0!==e&&void 0!==e.index&&e.index>=0){var i=t.elements.tabs.getValueByIndex(e.index);t._switchFacet(i)}})),this.elements.tabs.inject(this.elements.tabContainer)),(e=e||this._lFacets).forEach((function(e){var i=t.elements.tabs.add({label:!0===t.options.facetLabel?e.facet.text:void 0,value:e.facet.name,allowClosableFlag:!1,icon:{iconName:e.facet.icon,fontIconFamily:1,className:A}});i.getModel().tooltipInfos=new f({shortHelp:e.facet.text,mouseRelativePosition:!1}),i.getContent().setAttribute("tab_name",e.facet.name)})),e.length>1?this.elements.tabs.show():this.elements.tabs.hide())},updateTabIcon:function(e,t){var i=this.elements.tabs;i&&i.updateTab(e,{icon:{iconName:t,fontIconFamily:1,className:A}})},_saveAllFacets:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&!1!==t._isVisible&&i.onSave()}))},_loadExtensions:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&!1!==t._isVisible&&i.getTabId()==e.currentFacetName&&i.getExtensions()}))},checkChangeAuthorized:function(e,t){var i=this;if(!0===this.options.warningOnUnsaved&&this._checkSaveForAllFacets()){this.elements.superModal.confirm(w.get("EP_checkValidClose"),w.get("EP_Confirmation"),(function(n){!0!==n&&!0!==t||e.call(i,n)}))}else e.call(this,!0)},_checkSaveForAllFacets:function(){var e=this,t=!1;return this._lFacets.every((function(i){var n=e._getFacetContent(i);return n&&!1!==i._isVisible&&(t=!n.nothingToSave()),!t})),t},getSharedContext:function(){return this._sharedContext},setSharedContext:function(e){this._sharedContext=e,this.onRefresh()},getContainer:function(){return this.elements.container},getMainTable:function(){return this.elements.bottomArea},getIdentityCardUI:function(){return this.elements.topTable},getCollapseICPreferenceName:function(){return i.COLLAPSE_IC_PREFERENCE.name},destroyComponent:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&i.destroyComponent()})),this.elements.tabs.destroy()},getOptimalSize:function(){var e=this._getCurrentFacetContent(),t=this._getSizeTopTable(),i={width:0,height:0};return e&&((i=e.getOptimalSize()).height+=t.height),i},_getSizeTopTable:function(){var e=this.elements.topTable.getSize();return"none"===this.elements.topTable.getStyle("display")&&(e={height:0,width:0}),e},_getThumbnailDiv:function(){return this.thumbnail||(this.thumbnail=this.elements.container.getElement(".thumbnail-section")),this.thumbnail},_refreshCurrentFacet:function(){var e=this._getCurrentSelectedFacet(),t=this._getFacetContent(e);t&&t.onRefresh()},onRefresh:function(){var e=this,t=this._getCurrentSelectedFacet();this._refreshCurrentFacet(),this._lFacets.forEach((function(i){(!0===i.alwaysCalled&&!1!==i._isVisible||!0===i.calledIfVisible&&!0===i._isVisible)&&e._getFacetName(i)!==e._getFacetName(t)&&e._loadFacet(i,!1,(function(){var t=e._getFacetContent(i);t&&t.onRefresh()}))}))},_manageThumbnailDisplay:function(){var e=this.elements.container.getSize(),t=!0!==this.options.noThumbnail&&e.height>=300;this.elements.postIdCard&&this.elements.postIdCard.showThumbnail("height",t)},onResize:function(e){var t=this._getCurrentFacetContent();t&&t.onResize(),this._manageThumbnailDisplay(),this.elements.postIdCard&&this.elements.postIdCard.onResize(),this.elements.buttonsBar.onResize()},_getFacetFromName:function(e){var t=null;return this._lFacets.every((function(i){return i.facet&&i.facet.name===e&&(t=i),!t})),t},getFacetContent:function(e){var t=this._getFacetFromName(e);return t?this._getFacetContent(t):null},_getFacetContent:function(e){return e&&e.content&&"object"==typeof e.content?e.content:null},_getCurrentFacetContent:function(){var e=this._getCurrentSelectedFacet();return e?this._getFacetContent(e):null},_getCurrentSelectedFacet:function(){var e=null,t=null;if(this.currentFacetName&&this.options.showFacets)(e=this.currentFacetName)&&this._lFacets.every((function(i){return i.facet&&i.facet.name===e&&(t=i),!t}));else{var n=null;if(this._lFacets.length>0&&(n=this._lFacets[0],this.indexModeParameter&&this._lFacets.every((function(e){return!e.facet||!e.facet.name||e.facet.name!==i.FACET_iPROPERTIES||(n=e,!1)})),this.loadDomainFacet&&this._lFacets.every((function(e){return!e.facet||!e.facet.name||e.facet.name!==i.FACET_DOMAINPROPERTIES||(n=e,!1)})),this._lFacets.every((function(e){var t=e.alwaysVisible;return t&&(n=e),!t}))),widget.getValue("X3DContentId")&&""!==widget.getValue("X3DContentId")){var s=JSON.parse(widget.getValue("X3DContentId"));if(s&&s.data&&Array.isArray(s.data.items)&&s.data.items.length>0){var o=s.data.items[0];if(o.facet&&"isSocial"===o.facet&&this._lFacets.length>0){n=this._lFacets[0];for(var a=0;a<this._lFacets.length;a++)this._lFacets[a].facet.name==i.FACET_SWYMCOMMENTS&&(n=this._lFacets[a])}}}t=n}return t},_updateFacets:function(){var e=this._getCurrentFacetContent();e&&e.display()},_hideAllFacetsContent:function(e){var t=this,i=e?this._getFacetName(e):null;this._lFacets.forEach((function(e){var n=t._getFacetContent(e);n&&t._getFacetName(e)!==i&&n.hide()}))},_manageFacetLaunching:function(e){if(!b){var t=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_launchFacets:"+t):window.top.performance.mark("start_launchFacets:"+t)}var i=this,n=this._getCurrentSelectedFacet(),s=this.getSharedContext();!0!==e&&this._launchFacet(),b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_Iterate:"+t):window.top.performance.mark("start_Iterate:"+t));var o=i._getFacetName(n);this.currentFacetName=o,this._lFacets.forEach((function(e){if((!0===e.alwaysCalled&&!1!==e._isVisible&&void 0!==e._isVisible||!0===e.calledIfVisible&&!0===e._isVisible)&&i._getFacetName(e)!==o){if(!b){var t=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_loadFacet:"+t):window.top.performance.mark("start_loadFacet:"+t)}i._loadFacet(e,!1,(function(){b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_loadFacet:"+t):window.top.performance.mark("end_loadFacet:"+t));var n=i._getFacetContent(e);n&&(n.loadDomainFacet=!!i.loadDomainFacet,n.setContext(s));var o=i._getCurrentSelectedFacet();i._getFacetName(o)===i._getFacetName(e)&&i.__launchFacet(o)}))}})),b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_Iterate:"+t):window.top.performance.mark("end_Iterate:"+t)),b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_launchFacets:"+t):window.top.performance.mark("end_launchFacets:"+t))},_launchFacet:function(){var e=this,t=this._getCurrentSelectedFacet();return this._hideAllFacetsContent(t),this._loadFacet(t,!0,(function(){e.__launchFacet(t)})),t},_loadFacet:function(e,t,n){var s=this,o="loading";if(e&&e.content!==o)if(e.content)n.call(s);else{if(e.content=o,!b){var r=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_prereqFacet:"+r):window.top.performance.mark("start_prereqFacet:"+r)}!function(e,t){var i=[],n=[];e.forEach((function(e){var t=y[e];t?n.push(t):i.push(e)})),i.length>0?require(i,(function(){for(var s=0;s<arguments.length;s++)e[i[s]]=arguments[s],n.push(arguments[s]);t.apply(null,n)})):t.apply(null,n)}([e.require],(function(o){b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_prereqFacet:"+r):window.top.performance.mark("end_prereqFacet:"+r)),e.content=null;var l=s._getCurrentSelectedFacet(),d=s._getFacetName(e)===s._getFacetName(l);if(!t||d){var c=e.options?e.options:{};if(Object.keys(c).length>0){var u=s.infoForFacet;if(c.infoForFacet,null!=u&&(e.options.infoForFacet=u),void 0===c.tenant||null===c.tenant){var h=s._getTenant();null===h&&(h=a.getTenantID()),e.options.tenant=h}}var p=c.events?c.events:{};p.onNotification=function(e){s._addNotif(e)},p.onEvent=function(e){s._manageEvent(e)},e.facet.name===i.FACET_DOMAINPROPERTIES&&(p.runtimeFacetLoading=function(e){s._manageRuntimeFacetVisibility(e)}),c.events=p,e.options=c,e.options.tabId=e.facet.name,e.options.eventThread=s.options.eventThread+"."+e.facet.name,e.content=new o(e.options,s._sharedOptions);var m=e.content.getUI(),f="function"==typeof m.addClassName?m:m.container?m.container:m.elements?m.elements.container:null;f&&f.addClassName("EP_tab_Container EP_tab_"+e.facet.name),e.content.getUI().inject(s.elements.bottomArea),d||e.content.hide(),s.publishEvt("facetLoaded",e),n.call(s)}}))}},_supportExtension:function(){let e=!0,t=!1,n=null;if("function"==typeof this.getOccurrences&&(n=this.getOccurrences()),n&&n.length>0){let t=n[0].getModel(i.MODEL_INIT);if(t){let i=d.getServiceForModel(t);i&&(e=!1!==i.extensionsSupported)}}let s=d.getMapping();return s&&s[this.currentFacetName]&&d.getMapping()[this.currentFacetName].supportExtension&&(t=!0),e&&t},_switchSave:function(e){e?this.elements.boutonValid.show():this.elements.boutonValid.hide()},_disableSave:function(e){this.elements.boutonValid&&(this.elements.boutonValid.disabled=e),this.elements.boutonAdd&&(this.elements.boutonAdd.disabled=!e)},_switchAdd:function(e){e&&!0!==this.options.updateSession&&this._supportExtension()?this.elements.boutonAdd&&this._sharedOptions.editMode&&this.elements.boutonAdd.show():this.elements.boutonAdd&&this.elements.boutonAdd.hide()},_manageActionVisibility:function(){var e=this,t=this._getCurrentSelectedFacet(),i=t?t.actions:null,n=[];i&&i.forEach((function(i){var s=i,o=i;"object"==typeof i?s=i.name:o={};var a=!0,r=e._getFacetContent(t);if(r&&(a=("pencil"!==s||"pencil"===s&&!0===r._RWAccess)&&r.isActionAvailable(s)),a){var l=S[s];for(var d in l)o[d]||(o[d]=l[d]);o.handler=function(){e._getCurrentFacetContent().onAction(s)},n.push(o)}}));i=this.options.actions;this.elements.postIdCard&&i&&i.length>0&&this.elements.postIdCard.setActions(i),this.elements.buttonsBar.setButtons(n),n.length>0?this.elements.buttonsBar.show():this.elements.buttonsBar.hide()},_manageInlineFacetErrors:function(){if(this.facetTopLineMsg){var e=this;this._lFacets.forEach((t=>{var i=e._getFacetName(t),n=e.facetTopLineMsg[i];n&&(e.currentFacetName===i?n.show():n.hide())}))}},_manageEvent:function(e){var t=this._getCurrentSelectedFacet(),i=this._getFacetName(t);if("switchSave"===e.eventID){var n=e.value;!0!==n&&(n=this._checkSaveForAllFacets()),this._switchSave(n)}else if("disableSave"===e.eventID){var s=e.value;this._disableSave(!s)}else if("switchAdd"===e.eventID){var o=e.value;this._switchAdd(o)}else if("switchLoader"===e.eventID){var a=e.value,r=this.loaderFacetList.indexOf(e.facet);!0===a&&r<0?this.loaderFacetList.push(e.facet):!1===a&&r>=0&&this.loaderFacetList.splice(r,1),this.loaderFacetList.length>0?this._displayLoadingArea():this._hideLoadingArea()}else e.facet===i&&"updateActions"===e.eventID?this._manageActionVisibility():"updateRWA"===e.eventID&&(this._updateRWA(e),this._manageActionVisibility())},_updateRWA:function(e){var t=this.getFacetContent(e.facet);t&&(t._RWAccess=e.value)},_hideLoadingArea:function(){this.elements.loadingArea.hide()},_displayLoadingArea:function(){this.elements.loadingArea.show()},__launchFacet:function(e){if(!b)var t=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;var i=this._getFacetContent(e);if(i){!0===this.options.showTopBar?this.elements.globalDiv.addClassName(C):this.elements.globalDiv.removeClassName(C);var n=i.getButtons();this.elements.facetButtonDiv.empty(),n&&n.inject(this.elements.facetButtonDiv),b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_displayFacets:"+t):window.top.performance.mark("start_displayFacets:"+t)),i.display(this.getSharedContext()),b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_displayFacets:"+t):window.top.performance.mark("end_displayFacets:"+t)),this._manageActionVisibility(),this._manageInlineFacetErrors()}},_getFacetName:function(e){return e&&e.facet?e.facet.name:""},_updateThumbnail:function(e,t){this.elements.postIdCard&&this.elements.postIdCard.changeThumbnail(e,t)},clearIdentityCard:function(){this.elements.postIdCard&&this.elements.postIdCard.clearValues()},getIdentityCard:function(){return this.elements.postIdCard},selectFacet:function(e){var t=this._getFacetFromName(e);if(this.elements.tabs&&t&&!1!==t._isVisible){var i=this.elements.tabs.getButtonFromValue(e);i&&(i.setProperties({checkFlag:!0}),this._switchFacet(e))}},clearPanel:function(){this._hideAllFacetsContent()},hideMainComponent:function(){this.elements.mainInterface.hide()},showMainComponent:function(){this.elements.mainInterface.show()},disableInputFields:function(e){this.getFacetContent(e)},_manageFacetVisibility:function(){var e=this;if(this._hideAllFacets(),!b){var t=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_facetVisibility:"+t):window.top.performance.mark("start_facetVisibility:"+t)}var n=new o(["B","C"],(function(){var n=this.getAnswer("B"),s=this.getAnswer("C"),o=e._facetCheck(this);if(!0===o.success){var a=e._getCurrentSelectedFacet();this.currentFacetName=e._getFacetName(a);var r=!0,l=null,d=!1;e._lFacets.forEach((function(t){var c=t.facet.name,u=a&&e._getFacetName(a)===c,h=t._isVisible||!0===t.alwaysVisible;h&&t.services&&t.services.forEach((function(e){n[e]||(h=!1)})),h&&t.roles&&(h=!1,t.roles.forEach((function(e){s.indexOf(e)>=0&&(h=!0)}))),!l&&h&&(l=c),h&&u&&(r=!1),t._isVisible=h,!0===e.indexModeParameter?"properties"===c||c===i.FACET_DOMAINPROPERTIES?t._isVisible=!1:"iproperties"===c&&(t._isVisible=!0):("iproperties"===c&&(t._isVisible=!1),!0===e.loadDomainFacet?"properties"===c?t._isVisible=!1:c===i.FACET_DOMAINPROPERTIES&&(t._isVisible=!0):"properties"===c?t._isVisible=!0:c===i.FACET_DOMAINPROPERTIES&&(t._isVisible=!1)),!0===o.refreshCurrent&&u&&!r&&(d=!0)})),e._facetVisibilityUpdate(),r&&e.selectFacet(l),!d&&o.refreshAction&&e._manageActionVisibility(),b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_facetVisibility:"+t):window.top.performance.mark("end_facetVisibility:"+t)),e._manageFacetLaunching(!d)}}));if(!0===e._queryFacets(n)){var s=e._getTenant();b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_visibilityUrl"):window.top.performance.mark("start_visibilityUrl")),r.getServices(s,(function(e){b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_visibilityUrl"):window.top.performance.mark("end_visibilityUrl")),n.setAnswer("B",e)})),b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_visibilityRole"):window.top.performance.mark("start_visibilityRole")),r.getRoles(s,(function(e){b||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_visibilityRole"):window.top.performance.mark("start_visibilityRole")),n.setAnswer("C",e)}))}},_getTenant:function(){return a.getTenantID()},_queryFacets:function(e){return!0},_facetCheck:function(e){return this._lFacets.forEach((function(e){e._isVisible=!0})),{success:!0}},_getPriorityFacetName:function(){var e=null;null===e&&(null!=(t=this.defaultFacetName)&&""!==t&&(e=t));if(null===e&&this.currentFacetName&&this.options.showFacets&&(e=this.currentFacetName),null===e){if(null!==this.options)var t=this.options.defaultFacetName;null!=t&&""!==t&&(e=t)}if(null===e&&widget.getValue("X3DContentId")&&""!==widget.getValue("X3DContentId")){var n=JSON.parse(widget.getValue("X3DContentId"));if(n&&n.data&&Array.isArray(n.data.items)&&n.data.items.length>0){var s=n.data.items[0];s.facet&&"isSocial"===s.facet&&(e=i.FACET_SWYMCOMMENTS)}}return null===e&&(e="properties"),e},_facetVisibilityUpdate:function(){var e=this;if(this.elements.tabs){var t=this._getPriorityFacetName(),i=e._getFacetFromName(t),n=this._getCurrentSelectedFacet();i!==n&&(n=i);var s=null,o=!1,a=[];this._lFacets.forEach((function(t){!1!==t._isVisible&&!1!==t.visible&&(!0===e.options.updateSession?"properties"===t.facet.name&&a.push(t):a.push(t),n===t&&(null===s&&(s=t),o=!0))})),null===s&&this._lFacets.forEach((function(e){!1!==e._isVisible&&!1!==e.visible&&null===s&&(s=e)})),this._createTabs(a),o&&n.content&&n.content.display?(this.selectFacet(n.facet.name),n.content.display(this.getSharedContext())):s&&this.selectFacet(s.facet.name)}},removeFacets:function(e){var t=[],i=this._getCurrentSelectedFacet(),n=!1;this._lFacets.forEach((function(s){e.indexOf(s.facet.name)<0?t.push(s):i&&i.facet.name===s.facet.name&&(n=!0)})),this._lFacets=t,this._facetVisibilityUpdate(),n&&this._manageFacetLaunching()},getOrAddFacets:function(e){var t=this,i=[];e.forEach((function(e){t._getFacetFromName(e.facet.name)||i.push(e)})),this.addFacets(i)},addFacets:function(e){if(e&&(!Array.isArray(e)||0!==e.length)){var t=this,i=!0;if(e&&Array.isArray(e)){var n={};t._lFacets.forEach((function(e){e.facet&&(n[e.facet.name]=!0)})),e.forEach((function(e){e.facet&&!n[e.facet.name]&&(e._isVisible=!0===e.alwaysVisible,i=i&&e._isVisible,void 0!==e.position?t._lFacets.splice(Math.min(e.position,Object.keys(t._lFacets).length-1),0,e):t._lFacets.push(e))}))}i?this._facetVisibilityUpdate():this._manageFacetVisibility()}},_hideAllFacets:function(){this._createTabs([])},_isFacetAuthorized:function(e){this._getCurrentModelType();var t=this._getFacetFromName(e);return t&&!1!==t._isVisible},changeAttributes:function(e){var t=this._getCurrentFacetContent();null!=t&&t.changeAttributes(e)},setIndexModeFlag:function(e){this.indexModeParameter=e},getIndexModeFlag:function(){return!0===this.indexModeParameter},_manageRuntimeFacetVisibility:function(e){let t=this,i=e&&e.facetsList;i&&Array.isArray(i)&&i.length>0&&(i.forEach((function(e){e.alwaysCalled=!1,e._isVisible=!0,t._lFacets.push(e);var i=t.elements.tabs.add({label:!0===t.options.facetLabel?e.facet.text:void 0,value:e.facet.name,allowClosableFlag:!1,icon:{iconName:e.facet.icon?e.facet.icon:"attributes",fontIconFamily:1,className:A}});i&&(i.getModel().tooltipInfos=new f({shortHelp:e.facet.text,mouseRelativePosition:!1}),i.getContent().setAttribute("tab_name",e.facet.name))})),i.length>1?this.elements.tabs.show():this.elements.tabs.hide())}});return D})),define("DS/EditPropWidget/UI/IDCardManager",["DS/EditPropWidget/UI/IDCardSkeleton","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l){"use strict";var d=!1;return"undefined"!=typeof dscef&&(d=dscef.isA2X),d||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.perfoIncrem:window.top.perfoIncrem=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.perfoIncrem?window.dsDashboardWindow.top.perfoIncrem:window.top.perfoIncrem?window.top.perfoIncrem:0),e.extend({_lOccurrences:[],_faceVisibilityHandler:null,defaultOptions:{multiselection:t.MULTISEL_MERGE},init:function(e,t){this._lOccurrences=[],this._faceVisibilityHandler={handle:null},this.sourceAppId=t.sourceAppId,this._parent(e,t)},getModels:function(){var e=this.getOccurrences(),i=[];return e&&e.forEach((function(e){var n=e.getModel(t.MODEL_INIT);n&&i.push(n)})),i},notifyClose:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&"function"==typeof i.onClose&&i.onClose()}))},getModel:function(e,t){var i=null;return(t?t.getAllModels(!0):this.getModels()).every((function(t){return e!==t.get("objectId")||(i=t,!1)})),i},_getFirstFacetModel:function(e){var t=null,i=this._getFirstOccurrence();return i&&(t=i.getModel(e)),t},_getFirstInitModel:function(){return this._getFirstFacetModel(t.MODEL_INIT)},_getFirstPropertiesModel:function(){return this._getFirstFacetModel(t.FACET_PROPERTIES)},getOccurrences:function(){return this._lOccurrences},_getFirstOccurrence:function(){return this._lOccurrences.length>0?this._lOccurrences[0]:null},getSharedContext:function(){return this._getFirstOccurrence()},setOccurrences:function(e){if(!d){var i=window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.perfoIncrem++:window.top.perfoIncrem++;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_setModelSkeleton:"+i):window.top.performance.mark("start_setModelSkeleton:"+i)}var n=this;this._clearAllFacetsModels(),this.modelHasChanged=!0;var s=e.length<=0,o=null;if(s||this.options.multiselection===t.MULTISEL_NO&&e.length>1||n.indexModeParameter&&this.options.multiselection&&e.length>1||n.loadDomainFacet&&e.length>1)o=l.get(s?"NoItemSelected":"TooManyObjectSelected");else if(e.length>1&&this.options.multiselection===t.MULTISEL_MERGE){var a,r=(a=e[0]).getModel(t.MODEL_INIT);if(r){var c=r.getMergingModels(),u=null,h=null;for(var p in c){var m=c[p],f=m.get("tenant"),g=m.get("source");if(null===u?u=f:u!==f&&(o=l.get("DifferentTenantsNotSupported")),null===h?h=g:h!==g&&(o=l.get("DifferentSourcesNotSupported")),null!==o)break}}}if(null!==o){if(this.clearIdentityCard(),this.showMainErrorArea(o),this.hideMainComponent(),this._lOccurrences=[],this.dispatchEvent("onTitleChanged",""),n.indexModeParameter)return}else this.showMainComponent(),(a=e[0]).addEvent("onChange:"+t.FACET_PROPERTIES,(function(){n._initializeIDCard(a)})),this._initializeIDCard(a),this._lOccurrences=e;d||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_setModelSkeleton:"+i):window.top.performance.mark("end_setModelSkeleton:"+i)),this._manageFacetVisibility(),this._manageFacetLaunching()},__queryFacets:function(e){var t=this;this._faceVisibilityHandler.handle&&(this._faceVisibilityHandler.handle.cancel(),this._faceVisibilityHandler.handle=null);var i=this._getFirstInitModel();if(i){var s=[],o=!1;t._lFacets.forEach((function(e){i.isMergedModel()&&!e.supportMerge||(s.push({name:e.facet.name,inheritance:e.inheritance}),o=o||e.services&&e.services.length>0)})),t.indexModeParameter?n.launchFacetsVisibilityFromIndexService(i,s,{context:this.options.context,handleRequest:this._faceVisibilityHandler,onComplete:function(i){i&&!1!==i.success?e.setAnswer("A",i):t._addNotif({msg:i?i.error.message:l["Error Server"],eventID:"error"})}}):n.launchFacetsVisibility(i,s,{context:this.options.context,handleRequest:this._faceVisibilityHandler,onComplete:function(i){i&&!1!==i.success?e.setAnswer("A",i):t._addNotif({msg:i?i.error.message:l["Error Server"],eventID:"error"})}},void 0,t.sourceAppId)}},_queryFacets:function(e){var t=this;e.addRequest("A");var n=this._getFirstInitModel();if(n){var s=i.getServiceForModel(n);n.get("isTransient")||!0!==s.modelNeeded?t.__queryFacets(e):(e.addRequest("Fed"),require(["DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests"],(function(i){i.fillModel({onComplete:function(i){var n=i.get("ds6w:type");if(n=n||i.get("ds6w:what/ds6w:type")){var s=n.get("valueDB");i.set("ds6w:what/ds6w:type_value",s)}i.set("preview_url",i.get("previewUrl")),t.__queryFacets(e),e.setAnswer("Fed",!0)}},n)})))}return!!n},_facetCheck:function(e){var i=this,n=e.getAnswer("A"),r=e.getAnswer("Fed"),l=n.id,d=n.facets,c=i._getFirstInitModel(),u=i._getCurrentSelectedFacet(),h=null!==c&&c.get("objectId")===l;!h&&null!==c&&c.get&&c.get("i3dx")&&(h=null!==c&&c.get("i3dx")===l);var p=null,m=!!r,f=!1;if(h&&n.notification)return this.clearIdentityCard(),this.showMainErrorArea(n.notification.message),this.hideMainComponent(),{success:!1};if(h){var g=i._getFirstOccurrence(),v=n.mains,_=v?v[l]:null,E=l,w="empty",b=null;_&&(E=_.id,w=_.type,b=_.metatype?"bus"==_.metatype?t.METATYPE_BUS:t.METATYPE_REL:t.METATYPE_UNKNOWN);var y=!1,C={};if(p=g.getModel(t.FACET_PROPERTIES),c.isMergedModel()){E=l,w="mergedObject";var A=c.getMergingModels(),S=p&&p.isMergedModel()?p.getMergingModels():null;for(var D in A){var I=A[D],P=v[D],T=null!=P&&P.id?P.id:D,M=t.METATYPE_UNKNOWN;if(M=P.metatype?"bus"==P.metatype?t.METATYPE_BUS:t.METATYPE_REL:M,w=P?P.type:"",!(S?S[T]:null)&&T!==D)y=!0,(W=UWA.clone(I.getOptions())).objectId=T,I=new s(W);I.set("metatype",M),I.set(t.MODEL_DS_ATTR+"type",{valueDB:w,isTransient:!0});var F=M===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;I.set(t.MODEL_DS_ATTR+"types",{valueDB:F?F[w]:null,isTransient:!0}),C[T]=I}p=g.getModel(t.FACET_PROPERTIES)}else null===p&&E===l&&(p=c);if(y||!p){var W,O=p||c,x=O.getAllAttributes();!0!==O.get("isTransient")&&(x=O.getOptions()),(W=UWA.clone(x)).objectId=E,b&&(W.metatype=b),W[t.MODEL_DS_ATTR+"type"]={valueDB:w,isTransient:!0};F=M===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;for(var N in W[t.MODEL_DS_ATTR+"types"]={valueDB:F?F[w]:null,isTransient:!0},W)x[N]instanceof a&&(W[N]=new a(W[N]));c.isMergedModel()?(p=new o(W)).setMergingModels(C):p=new s(W)}else if(p){p.set(t.MODEL_DS_ATTR+"type",{valueDB:w,isTransient:!0});F=M===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;p.set(t.MODEL_DS_ATTR+"types",{valueDB:F?F[w]:null,isTransient:!0})}g.setModel(t.FACET_PROPERTIES,p);d=n.facets;i._lFacets.forEach((function(e){var t=e.facet.name,n=d[t],s=n&&(!0===n||!0===n.available);(e._isVisible=s,!0===e.inheritance&&i._getFacetName(u)===t&&(f=!0),n&&n.information)&&(g.setOptions(t,n.information),i._getFacetName(u)===t&&(m=!0))}));let e=n.secondaryOptions;e&&Array.isArray(e)&&e.length>0&&g.setSecondaryOptionsForFacet(e);let r=[];if(v&&(Object.keys(v).map((e=>{let t=v[e];if(t&&t.id&&t.id!==e){let i={};i.connectionId=e,i.referenceId=t.id,r.push(i)}})),r.length>0)){let e=i.getOccurrences();if(e&&Array.isArray(e)&&e.length>0){let t=e[0],i=t.getSharedInformationForFacet();i?i.coupleInformation=[...r]:(i={},i.coupleInformation=[...r],t.setSharedInformationForFacet(i))}}}return{success:!!p,refreshCurrent:m,refreshAction:f}},_getTenant:function(){var e=this._getFirstInitModel(),t=null;return e&&(t=e.getTenant()?e.getTenant():this._parent()),t},_clearAllFacetsModels:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&i.setOccurrence(null)}))},_initializeIDCard:function(e){var i=this;if(e){var n=e.getModel(t.FACET_PROPERTIES);n&&(this._updateThumbnailForModel(n),this._hideExpanderinIDCard(n),this._showExpanderinIDCard(n),this.elements.postIdCard&&this.elements.postIdCard.fillFromModel(n),this.elements.postIdCard&&n.addEvent("onChangeAttributes",(function(e,t){var n=!1;t.forEach((function(t){t&&t instanceof a&&(n=i.elements.postIdCard.setValueForSection(e,t)||n)}))})),n.addEvent("onChange:label",(function(){var e=n?n.getComputedTitle():"";i.dispatchEvent("onTitleChanged",e),n.get(t.MODEL_DS_ATTR+"label")&&i.elements.postIdCard&&i.elements.postIdCard.setValueForSection(n,n.get(t.MODEL_DS_ATTR+"label"))})),n.addEvent("onChange:previewUrl",(function(){i._updateThumbnailForModel(this)})),n.addEvent("onChange:type_icon_url",(function(){i._updateThumbnailForModel(this)})))}},getTitle:function(){var e=this._getFirstOccurrence(),i=e?e.getModel(t.FACET_PROPERTIES):null;return i?i.getComputedTitle():""},_updateThumbnailForModel:function(e){if(!0!==this.options.noThumbnail){var i=e.get("previewUrl")?e.get("previewUrl"):e.get("type_icon_url");i=i||"";var n=this._isFacetAuthorized(t.FACET_VIEWS)||e.get("activeThumbnail");this._updateThumbnail(i,n)}},_getCurrentModelType:function(){var e=this.getModels(),t=e.length>0?e[0].get("type"):"",i=t;return t&&"object"==typeof t&&(i=(i=t.get("valueDB"))||t.get("value")),i},_hideExpanderinIDCard:function(e,t="actionHide"){e.isMergedModel()&&this.elements&&this.elements.postIdCard&&this.elements.postIdCard.checkButtonVisibility(t)&&this.elements.postIdCard.hideButton(t)},_showExpanderinIDCard:function(e,t="actionHide"){!e.isMergedModel()&&this.elements&&this.elements.postIdCard&&!this.elements.postIdCard.checkButtonVisibility(t)&&this.elements.postIdCard.showButton(t)}})})),define("DS/EditPropWidget/facets/Properties/PropertiesUIController",["DS/EditPropWidget/controllers/EditPropUIController","DS/EditPropWidget/utils/AttributesUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i){"use strict";return e.extend({defaultOptions:{},validateModels:function(e){return t.validateModels(e)},validateAttributes:function(e,i){return t.validateAttributes(e,i)},getUXBLErrors:e=>t.getUXBLErrors(e),resetValueOfModels:function(e){e||(e=this.getModels()),e.forEach((function(e){e.resetInitialValues()}))}})})),define("DS/EditPropWidget/facets/Instance/IndexInstanceFacet",["UWA/Core","DS/EditPropWidget/facets/Properties/iPropertiesFacet","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a){})),define("DS/EditPropWidget/utils/ClientBLUtils",["DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/utils/EditPropUtils"],(function(e,t){"use strict";var i=["name","description"];return{getUIAttributesForBL:function(n){var s=[],o=n.getAllAttributes();return Object.keys(o).forEach((n=>{var a=o[n];if(a instanceof e){if(!a.basicAttribute&&!a.forUIBL)return;if(a.basicAttribute&&!i.includes(a.get("path")))return;var r={name:a.get("path"),value:a.get("valueDB")};if(UWA.is(r.value)&&a.dimension&&a.dimensionType){var l=t.getDimensionUnitName(a.dimensionType,a.dimension);null!=l&&(r.unitName=l,r.dimensionType=a.dimensionType)}a.forUIBL&&(r.forUI=!0,null!=a.readOnly&&(r.isReadOnly=a.readOnly),null!=a.visible&&(r.visible=a.visible),null!=a.authorizedValues&&(r.range=a.authorizedValues),null!=a.blAccess&&(r.blAccess=a.blAccess),null!=a.notif&&(r.notif=a.notif),null!=a.displayAsEntered&&null!=a.displayAsEntered&&(r.displayAsEntered=a.displayAsEntered+""),a.manipulationUnit&&(r.manipulationUnit=a.manipulationUnit),a.mksDBUnit&&(r.mksDBUnit=a.mksDBUnit)),s.push(r)}})),s},setModifiedAttributes:function(t,i){var n=this,s=!1,o={};if(i)for(var a=0;a<i.length;a++){var r=i[a],l=t.getAttributeFromField("path",r.name)[0];if(l){var d={};if(UWA.is(r.range)&&!n.isSame(l.authorizedValues,r.range)){var c,u;l.originalAuthVal?(c=l.originalAuthVal.authVal,u=l.originalAuthVal.authValNLS):(c=l.range,u=l.rangeNLS);var h=[],p=[];if(c&&u&&c.length==u.length)for(a=0;a<r.range.length;a++){var m=r.range[a],f=c.findIndex((e=>e===m));f>-1?(h.push(c[f]),p.push(u[f])):(h.push(m),p.push(m))}else p=h=r.range;d.authorizedValues=h,d.authorizedValuesNLS=p,s=!0}UWA.is(r.visible)&&(n.isSame(l.visible,r.visible)||(d.visible=r.visible,s=!0)),UWA.is(r.isReadOnly)&&(n.isSame(l.isReadOnly,r.isReadOnly)||(d.readOnly=r.isReadOnly,s=!0)),UWA.is(r.value)&&(n.isSame(l.valueDB,r.value)||(l.authorizedValues&&l.authorizedValues.length>0?l.authorizedValues.includes(r.value)&&(d.value=r.value):d.value=r.value,s=!0)),UWA.is(r.unitName)&&(n.isSame(l.dimension,r.dimension)||(d.unitName=r.unitName,d.dimension=r.dimension,s=!0)),UWA.is(r.notif)&&(l.notif=r.notif,d.notif=r.notif),Object.keys(d).length>0&&(o[r.name]=d)}else{var g=new e;g.set("path",r.name),g.set("valueDB",r.value),g.set("unitName",r.unitName),g.set("dimension",r.dimension),g.set("isUXBLAttribute",!0),t.set(r.name,g)}}return{updateUIAttribute:o,refreshUI:s,notifs:[]}},isSame:function(e,t){return typeof e==typeof t&&(UWA.is(e,"array")&&UWA.is(t,"array")?e.length==t.length&&!(e.filter(((e,i)=>{if(t[i]!=e)return!0})).length>0):e==t)}}})),define("DS/EditPropWidget/facets/History/History",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","UWA/Class","DS/DataDragAndDrop/DataDragAndDrop","UWA/Json","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/WidgetServices/WidgetServices","DS/WidgetServices/UIInfra/UIInfra","DS/EditPropWidget/models/EditPropHistoryModel","DS/UIKIT/Spinner","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l,d,c,u,h,p){"use strict";return i.extend(t,e,{defaultOptions:{className:"",nbResults:5},pictureAPIConfig:{defaultSwym:"https://dsext001-eu1-215dsi0708-3dswym.3dexperience.3ds.com",pictureAPIPrefix:"/api/user/getpicture/login/",pictureAPISuffix:"/format/mini"},init:function(e){this._parent(e),this._initValues(),this._initUI()},_initValues:function(){this._mapItemToDrag={},this.currentStatus={noMoreHistory:!1,lastDate:null,model:null},this.request={getHistory:{handle:null}}},_initUI:function(){var e=this;this.elements={},this.elements.container=UWA.createElement("div",{class:"EP_MainHistoryContainer "+this.options.className}),this.elements.sub_container=UWA.createElement("div",{class:"EP_SS_MainHistoryContainer"}).inject(this.elements.container);var t=UWA.createElement("div",{class:"EP_HistoryFatherContainer"}).inject(this.elements.sub_container);this.elements.historyContainer=UWA.createElement("div",{class:"EP_HistoryContainer"}).inject(t);this.elements.scroller=new a({element:this.elements.sub_container}).inject(this.elements.container),this.elements.scroller.elements.content.addEventListener("scroll",(function(){e._actionOnScroll()})),this.elements.sSpinner=new u({className:"hist_small_spinner"}).inject(UWA.createElement("div",{class:"hist_small_spinner_container"}).inject(t)),this.elements.spinner=new u({className:"hist_spinner"}).inject(this.elements.container)},_actionOnScroll:function(){var e=this.elements.historyContainer.getSize(),t=this.elements.scroller.elements.content.getSize(),i=this.elements.sSpinner.elements.container.parentElement.getSize();this.elements.historyContainer.getPosition().y<=t.height-e.height-i.height+2&&this.loadHistory(this.currentStatus.model)},_hideAll:function(){!(this._getAllUIElements().length>0)&&this.elements.historyContainer.hide(),this.elements.spinner.hide(),this.elements.sSpinner.hide()},_showLoader:function(){this._getAllUIElements().length>0?this._showSmallSpinner():this._showMainSpinner()},_showSmallSpinner:function(){this.elements.sSpinner.show()},_showMainSpinner:function(){this._hideAll(),this.elements.spinner.show()},_hideSpinner:function(){this._hideAll(),this.elements.historyContainer.show()},_createChangeNameUI:function(e,t){var i=UWA.createElement("div",{class:"hist_modify_container"});if(t.info){var n=t.info.name;n=n||t.info.value;var s=t.info.was;e&&e.iconType&&UWA.createElement("div",{class:"hist_modify_container_image",html:{tag:"img",class:"EditProp_undraggable",width:"16px",src:e.iconType}}).inject(i);var a=UWA.createElement("div",{class:"hist_modify_container_txt"}).inject(i),r=UWA.createElement("span",{text:n||""}).inject(UWA.createElement("div",{class:"hist_modify_name"}).inject(a)),l=UWA.createElement("span",{text:s||""}).inject(UWA.createElement("div",{class:"hist_modify_name hist_oldName"}).inject(a));new o({delay:{show:400},position:"top left",target:l,body:s?s.escapeHTML():""}),new o({delay:{show:400},position:"top left",target:r,body:n?n.escapeHTML():""})}return i},_addHistory:function(e,t){var i=this,a=UWA.createElement("div",{class:"EP_HistoryElement"}).inject(this.elements.historyContainer),r=t.get("userId");r&&this._userPictureURL(r,{onComplete:function(e){var t=UWA.createElement("img",{tag:"img",class:"EditProp_undraggable img-circle",width:"45px",src:e}).inject(UWA.createElement("div",{class:"EP_HistoryPicture"}).inject(a));t.hide(),t.onload=function(e){a.addClassName("hist_withPicture"),t.show()}}});var c=UWA.createElement("div",{class:"EP_HistoryInfos"}).inject(a),u=t.get("objects"),h=t.get("eventNls"),m=t.get("time"),f=t.get("user"),g="";f||(g="Someone ");var v=u?u.length:0,_=v>1?"s":"",E=null,w="";switch(h){case"addFolder":w=p.replace(p.get(g+"added {0} folder"+_),{0:v});break;case"addContent":w=p.replace(p.get(g+"added {0} content"+_),{0:v});break;case"removeFolder":w=p.replace(p.get(g+"removed {0} folder"+_),{0:v});break;case"removeContent":w=p.replace(p.get(g+"removed {0} content"+_),{0:v});break;case"modify":var b=t.info.nameNls?t.info.nameNls:t.info.name;delete t.info.name,w=p.replace(p.get(g+"changed the attribute {0}"),{0:b}),E=this._createChangeNameUI(e,t);break;case"changeName":w=p.get(g+"changed the name"),E=this._createChangeNameUI(e,t);break;case"create":w=p.get(g+"create the object");break;default:w=p.get(g+"made some changes")}UWA.createElement("div",{html:[{tag:"span",class:"EP_history_user",text:f},{tag:"span",text:" "+w}]}).inject(c);var y=new Date(m).toLocaleString(l.getLanguage());UWA.createElement("div",{class:"EP_History_date",text:y}).inject(c),null!=E&&E.inject(c);var C=UWA.createElement("div",{class:"EP_History_ObjectList"}).inject(c),A=["Workspace","Workspace Vault"];u.forEach((function(t){var a=t.get("type");if(A.indexOf(a)<0){var r=t.get("name"),c=t.get("label");c=c||r;var u=t.get("id"),h=u||0===u,m=h?"exist":"hist_object_delete",f=t.get("iconType"),g=null;f&&(g=UWA.createElement("div",{class:"EP_History_type_icon",html:{tag:"img",width:"16px",class:"EditProp_undraggable",src:f}})),m+=null!==g?"":" withoutThumbnail";var v=UWA.createElement("div",{class:"EP_History_dragObj"}).inject(C);t=UWA.createElement("div",{class:"EP_History_ObjectElement "+m}).inject(v);g&&g.inject(t);var _=UWA.createElement("span",{class:"EP_History_ObjectName",text:c}).inject(t);if(new o({delay:{show:400},target:_,body:c}),h){var E={objectId:u,objectType:a,serviceId:e.source,envId:e.tenant},w=function(e,t,n){if(!t.hasClassName(b)||!0!==n){if(!0!==e.ctrlKey)i.elements.historyContainer.getElements("."+b).forEach((function(e){e.removeClassName(b)})),i._mapItemToDrag={};t.toggleClassName(b),t.hasClassName(b)?i._mapItemToDrag[u]=E:i._mapItemToDrag[u]&&delete i._mapItemToDrag[u]}},b="hist_objectSelected";t.addEvents({click:function(e){w(e,this)}}),n.draggable(t,{protocol:"3DXContent",version:"1.1",source:"ENOLCMT_AP",widget_id:l.getWidgetId(),data:void 0,start:function(e,n){w(n,t,!0),i._mapItemToDrag[u]=E;var o=[];for(var a in i._mapItemToDrag)o.push(i._mapItemToDrag[a]);var r={data:{items:o}},l=s.encode(r);n.dataTransfer.setData("text",l),d.createGhostDnD(n,{number:o.length,className:"Hist_ghost"})},stop:function(){}})}else new o({position:"bottom",delay:{show:400},target:t,body:p.get("This object is not accessible")})}}))},launchHistory:function(e){var t=e.length,i=!1;if(t===(this.currentStatus.model?this.currentStatus.model.length:0)){i=!0;for(var n=0;n<t&&!1!==(i=e[n].get("objectId")===this.currentStatus.model[n].get("objectId"));n++);}i||(this.clearHistory(),this.loadHistory(e))},clearHistory:function(){this._endOfRequest(),this.currentStatus.lastDate=null,this.currentStatus.noMoreHistory=!1,this._getAllUIElements().forEach((function(e){e.remove()}))},_getAllUIElements:function(){return this.elements.historyContainer.getElements(".EP_HistoryElement")},_userPictureURL:function(e,t){var i=this;l.get3DSwymUrlAsync({onComplete:function(n){var s=n||i.pictureAPIConfig.defaultSwym,o=s?s+i.pictureAPIConfig.pictureAPIPrefix+e+i.pictureAPIConfig.pictureAPISuffix:"";t.onComplete.call(null,o)}})},updateFacet:function(e){this.clearHistory(),this.loadHistory(this.getModel())},loadHistory:function(e){var t=this;null==e||Array.isArray(e)||(e=[e]),this.request.getHistory.handle&&e&&this.currentStatus.model&&(e.length!=this.currentStatus.model.length||e[0].get("objectId")!=this.currentStatus.model[0].get("objectId"))&&(this.request.getHistory.handle.cancel(),this.request.getHistory.handle=null);var i=null===this.currentStatus.lastDate;if(!1===t.currentStatus.noMoreHistory&&!this.request.getHistory.handle&&e){this.currentStatus.model=e,this._showLoader();var n=e[0].get("source"),s={modelList:e,tenant:e[0].getTenant(),nbResult:this.options.nbResults,onComplete:function(e){i&&t.clearHistory(),t._endOfRequest(),e.results?e.results.forEach((function(e){if(e.lastTime&&(t.currentStatus.lastDate=e.lastTime),e.history){var i={id:e.id,type:e.type,iconType:e.iconType,source:n,tenant:e.tenant};t.getModel(i.id)&&(0===e.history.length&&(t.currentStatus.noMoreHistory=!0),e.history.forEach((function(e){var n=new c(e);null!==n.info&&void 0!==n.info.name&&void 0!==n.info.was?n.info.name!==n.info.was&&t._addHistory(i,n):t._addHistory(i,n)})),t._actionOnScroll())}e.error&&t._setError({message:e.error})})):t._setError({message:p.get("can't find history")})},onFailure:function(e){t._endOfRequest(),t._setError(e)}};this.currentStatus.lastDate&&(s.lastDate=this.currentStatus.lastDate),s.handleRequest=this.request.getHistory,s.handleRequest.handle=l.getCancelObject().handler,r.getHistory(s)}},_endOfRequest:function(){this.request.getHistory.handle=null,this._hideSpinner()},_setError:function(e,t,i){this._raiseNotification(e,t,i)}})})),define("DS/EditPropWidget/utils/EditPropIndexDictionaryForUnits",["UWA/Core","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t,i,n,s){})),define("DS/EditPropWidget/facets/3DPlay/3DPlayFacet",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","UWA/Class","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a){return s.extend(t,e,{player3D:null,_3DViewLaunched:!1,init:function(e){this._parent(e),this._initUI()},_initUI:function(){var e=this;this.elements.container=UWA.createElement("div",{class:"container_3DPlay"}),this.elements.containerHDThumbnail=UWA.createElement("div",{class:"editProp_HDImageContainer",events:{click:function(){e._switchTo3DView(),e._3DViewLaunched=!0}}}),this.elements.containerHDThumbnail.inject(this.elements.container),this.elements.containerHDThumbnail.hide(),this.elements.container3DPlay=UWA.createElement("div",{class:"editProp_3DPlayContainer"}),this.elements.container3DPlay.inject(this.elements.container),this.elements.container3DPlay.hide()},_switchTo3DView:function(e){this.elements.containerHDThumbnail.hide(),this.elements.container3DPlay.show(),this._initPlayer(e)},_switchToHDThumbnail:function(e){this.elements.containerHDThumbnail.show(),this.elements.container3DPlay.hide()},destroyComponent:function(){this._stop3DPlayer()},onResize:function(){},_stop3DPlayer:function(){this.player3D&&(this.player3D.dispose(),this.player3D=null)},getIdentityCardUI:function(){return this.elements.topTable},_initPlayer:function(e){var t=this.getModel();if(t){var s=t.get("type");if(s||(s=t.get(i.MODEL_DS_ATTR+"type")),s){"object"==typeof s&&(s=(s=s.valueDB)||s.value);var r=t.get("objectId");if(this.currentId3DPlay===r&&this.player3D)return;this.elements.container3DPlay.setContent(a.get("3DPlay loading")),this._stop3DPlayer();var l={};!1!==e&&(l.loading="autoplay");var d=this;o.getSourceUrlAsync({platformId:n.getTenantFromModel(t),source:n.getSourceFromModel(t),onComplete:function(e){var i={container:d.elements.container3DPlay,input:{asset:{provider:"EV6",serverurl:e,physicalid:r,dtype:s,tenant:n.getTenantFromModel(t),requiredAuth:"passport",contextId:d.options.securityContextFromAppPreference},usage:"preview"},options:l};require(["DS/3DPlayHelper/3DPlayHelper"],(function(e){d.elements.container3DPlay.empty(),d.player3D=new e(i),d.currentId3DPlay=r}))}})}}},_handlerUpdateThumbnail:function(e){this._updateThumbnail(e)},updateFacet:function(){var e=this;this._3DViewLaunched=!1;var t=this.getModel();t&&(t.removeEvent2("onChange:previewUrl",e._handlerUpdateThumbnail),t.removeEvent2("onChange:type_icon_url",e._handlerUpdateThumbnail),t.addEvent("onChange:previewUrl",e._handlerUpdateThumbnail.bind(this,t)),t.addEvent("onChange:type_icon_url",e._handlerUpdateThumbnail.bind(this,t)),this._updateThumbnail(t)),this._stop3DPlayer(),this.onRefresh()},onRefresh:function(){var e=null,t=this.getModel();t&&(e=(e=t.get("previewUrl"))||t.get("type_icon_url"));e&&!0!==this._3DViewLaunched?this._switchToHDThumbnail():this._switchTo3DView(!1)},_updateThumbnail:function(e){var t=this;this._switchToHDThumbnail();var i=e.get("previewUrl");if(i=i||e.get("type_icon_url")){this.elements.HDThumbnail=UWA.createElement("div",{class:"editProp_BigThumbnail"});var n=new Image;n.onload=function(){this.naturalHeight<100?t._switchTo3DView(!1):t.elements.HDThumbnail.setStyle("background-image","url("+this.src+")")},n.src=i,this.elements.containerHDThumbnail.setContent(this.elements.HDThumbnail)}}})})),define("DS/EditPropWidget/EditPropWidgetHTML",["DS/EditPropWidget/EditPropWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel"],(function(e,t,i,n,s){window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_EP_HTMLProperties"):window.top.performance.mark("end_EP_HTMLProperties"),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_widgetLoading"):window.top.performance.mark("start_widgetLoading"),window.currentPropertiesOptions||(window.currentPropertiesOptions={});var o=null,a=!0,r="600",l=null,d={onLoad:function(){window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_widgetLoading"):window.top.performance.mark("end_widgetLoading"),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_managePref"):window.top.performance.mark("start_managePref");var c,u,h=this;if(!currentPropertiesOptions.selected)if(t.getUrlParameter("selected")){var p=t.getUrlParameter("meta")?t.getUrlParameter("meta"):null,m=t.getUrlParameter("tenant")?t.getUrlParameter("tenant"):null,f=t.getUrlParameter("source")?t.getUrlParameter("source"):null,g=t.getUrlParameter("sourceName")?t.getUrlParameter("sourceName"):null,v={objectId:t.getUrlParameter("selected")};p&&(v.metatype=p),m&&(v.tenant=m),f&&(v.source=f),g&&(v.sourceName=g),currentPropertiesOptions.selected=[new s(v)]}else{var _=t.getWidgetPreference("SelectedItem");if(null!=_&&"object"==typeof _&&(a="true"===t.getWidgetPreferenceValue("loadData")||!0===t.getWidgetPreferenceValue("loadData"),currentPropertiesOptions.selected=Array.isArray(_.value)?_.value:[],"undefined"!=typeof widget)){var E=void 0!==widget.getValue("X3DContentId")?JSON.parse(widget.getValue("X3DContentId")):null;if(null!==E){var w=E.data;if(null!==w){var b=[];if(w.items.length>0)for(null!==(y=w.items[0]).objectId&&void 0!==y.objectId&&b.push(y),itemsLength=b.length,itemsIndex=0;itemsIndex<itemsLength;itemsIndex++){var y;(v={objectId:(y=b[itemsIndex]).objectId,metatype:"businessobject"}).tenant=y.envId,v.source=y.serviceId,v.sourceName=y.serviceId,currentPropertiesOptions.selected=[new s(v)]}}}}}var C=!1;t.isWebInWinEnvironment()?(c=t.getUrlParameter("defaultFacetName"),u=t.getUrlParameter("infoForFacet"),C="true"===t.getUrlParameter("indexModeParameter")||!0===widget.getValue("indexModeParameter"),window&&window.COMPASS_CONFIG&&window.COMPASS_CONFIG.securityContext&&(l={value:window.COMPASS_CONFIG.securityContext},M=window.COMPASS_CONFIG.securityContext)):(c=widget.getValue("defaultFacetName"),u=widget.getValue("infoForFacet"),C="true"===widget.getValue("indexModeParameter")||!0===widget.getValue("indexModeParameter"),M=t.getWidgetValue("securityContextFromAppPreference")?t.getWidgetValue("securityContextFromAppPreference"):null,l=t.getWidgetPreference("securityContext")),t.setWidgetValue("x3dAppId","ENOLCMT_AP"),document.body.addClassName("editPropWidgetHTML");var A="true"===t.getUrlParameter("editMode");void 0===A&&(A="true"===t.getWidgetPreferenceValue("editProperties_editMode"));var S="true"===t.getUrlParameter("updateSession"),D="true"===t.getWidgetPreferenceValue("isTransient"),I=n.PINNED;D&&(I=n.TRANSIENT);var P="true"===t.getUrlParameter("readonly");P=P||"false"!==widget.getBool("readOnly")&&!1!==widget.getBool("readOnly");var T="true"===t.getUrlParameter("closeButton");window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_managePref"):window.top.performance.mark("end_managePref");var M=t.getWidgetValue("securityContextFromAppPreference")?t.getWidgetValue("securityContextFromAppPreference"):null,F=t.getWidgetValue("parent_x3dAppId")?t.getWidgetValue("parent_x3dAppId"):null,W=!!t.getWidgetValue("disableAddExtensionButton");let O=t.getWidgetValue("USE_APP_SECURTIYCONTEXT");O=!!O;let x=t.getWidgetValue("ignoreKernelAccessChecks");x="true"===x;let N=t.getWidgetValue("sharedInformationForFacet");window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_createProp"):window.top.performance.mark("start_createProp"),l=t.getWidgetPreference("securityContext");let R={readOnly:P,showTopBar:!0,setCloseButton:!0,closeButton:T,setEditButton:!0,displayType:I,selectionType:n.ALL_SELECTION,editMode:A,defaultFacetName:c,infoForFacet:u,indexModeParameter:C,updateSession:S,topClassHeight:"modal-content",securityContextFromAppPreference:M,sourceAppId:F,disableAddExtensionButton:W,USE_APP_SECURTIYCONTEXT:O,ignoreKernelAccessChecks:x,sharedInformationForFacet:N,events:{onTitleChanged:function(e){var t=e||""===e?e:o.getTitle();t=t&&"function"==typeof t.unescapeHTML?t.unescapeHTML():"",widget.setTitle(t)},onDataLoaded:function(){o.onResize(),setTimeout((function(){"undefined"!=typeof dscef&&dscef.sendString("DataLoaded"),!h.changeControlInitialized&&t.isChangeAvailable()&&(h.changeControlInitialized=!0,require(["DS/EditPropWidget/changeAction/passThruJS"],(function(e){e.onReady((function(e){var i=t.getWidgetPreference("changeControl"),n=!0;if(i&&i.value){var s=i.value;n=!e.changeIsSetChecker(s)}e.initialize(o.elements.container.elements.container,null,n?"hide":"show","bottom-left",{isEditable:!1}),enoviaServerAuthoringWidget.saveMode="change",n&&(!s||null==s.configurationRevision&&null==s.configurationRevision)||e.set(s)}))})))}))}}};l&&l.value&&(R.context={getSecurityContext:function(){return{SecurityContext:l.value}}}),o=new e(R),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_createProp"):window.top.performance.mark("end_createProp");var U=o.getTitle();widget.setTitle(U),widget.body.setContent(o);var L=widget.getView().type;let k;if("fullscreen"!=L&&"maximized"!=L&&d._setBodyHeight(r),currentPropertiesOptions&&currentPropertiesOptions.selected&&Array.isArray(currentPropertiesOptions.selected)&&currentPropertiesOptions.selected.length>0){let e=currentPropertiesOptions.selected[0];e instanceof s?(k=e.get("source"),k||(k=e.get("sourceName"))):(k=e.source,k||(k=e.sourceName))}let V="true"===t.getWidgetValue("isPinned");l&&l.value&&(O?i.getInstance({context:{getSecurityContext:function(){return{SecurityContext:l.value}}},source:k,widgetIsPinned:V}).getValidSecurityContext():i.getInstance({context:{getSecurityContext:function(){return{SecurityContext:l.value}}}}).getSecurityContext()),t.setWidgetValue("isPinned",V?"false":"true");var j=t.getWidgetPreference("isTransient");j&&"false"===j.value&&t.deleteWidgetValue("SelectedItem"),t.setWidgetValue("isTransient","false");var B=widget.body.getParent().getSize();d._setBodyHeight(B.height);var q=currentPropertiesOptions.selected?currentPropertiesOptions.selected:[];window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_initdata"):window.top.performance.mark("start_initdata"),o.initDatas(q,void 0,void 0,{loadModel:a}),window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_initdata"):window.top.performance.mark("end_initdata"),currentPropertiesOptions.component=o},onRefresh:function(){o.onRefresh()},onResize:function(e){var t=widget.body.getParent().getSize();d._setBodyHeight(t.height),o.onResize()},onDestroy:function(e){o.destroyComponent()},onViewChange:function(e){var t=e.height;"fullscreen"!==e.type&&"maximized"!==e.type&&(t=r),t&&d._setBodyHeight(r)},_setBodyHeight:function(e){e&&("auto"!==e&&(e+="px"),widget.body.setStyle("height",e))}};t.isReplayedODT()?setTimeout((function(){d.onLoad()})):widget.addEvent("onLoad",d.onLoad),widget.addEvent("onRefresh",d.onRefresh),widget.addEvent("onResize",d.onResize),widget.addEvent("onViewChange",d.onViewChange),window.addEventListener("unload",d.onDestroy),widget.setAutoRefresh(1e4)})),define("DS/EditPropWidget/ajaxRequests/3DDriveAjaxRequest",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/utils/EditPropUtils","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r){"use strict";var l={},d={},c={},u=function(e,t,i){var n=e[t];n?(!0==!n.multivalue&&(n.value=[n.value],n.valueDB=[n.valueDB],n.multivalue=!0),n.value.push(i.value),n.valueDB.push(i.valueDB)):e[t]=i};return{checkFacetsVisibility:function(e){var t={};if(null!=e.facets&&e.facets.length>0)for(var n=0;n<e.facets.length;n++){var s=e.facets[n].name;"properties"===s?t[i.FACET_PROPERTIES]=!0:"social"===s?t[i.FACET_SWYMCOMMENTS]=!0:t[i.FACET_PROPERTIES]=!0}else t[i.FACET_PROPERTIES]=!0;e.onComplete.call(this,{id:e.model.get("objectId"),facets:t})},getSourceId:function(e){var t=n.getSupportedServices(),i=void 0,s="",o=e.get("sourceName");return o&&(i=t[o.toLowerCase()]),i||(o=e.get("source"))&&(i=t[o.toLowerCase()]),i&&i.fedPrefix&&(s=i.fedPrefix),s},fillModel:function(e,t){var i=e.onComplete;return e.onComplete=function(e){e&&e.results&&e.results.length>0&&s.fillFromServer(e.results[0],t,{}),i.apply(this,[t])},e.modelList=[t],this.getListOfAttributes(e)},getIdFromModel:function(e){var t=this.getSourceId(e),i=e.get("objectId");return i=i||"",t&&0!==i.indexOf(t)?t+':"'+i+'"':i},_getModelType:function(e){var t,i=e.get("ds6w:type");t="string"==typeof i?i:i?i.get("valueDB"):"";var n=e.get("source");t||"3DSwym"!==n||0==e.get("objectId").indexOf("iam")&&(t="pno:Person");return t},getListOfAttributes:function(i){var n=i.modelList;i.securityContext;if(n.length){var s=n[0],o=s.get("objectId"),a="";if(o){a="/search";var r=[];s.get("sourceName")&&("3DDrive"===s.get("sourceName")?r.push("drive"):r.push(s.get("sourceName"))),i.model=s,i.idModel=o,i.onCompleteWS=this._onCompleteFederated.bind(this);var l=e.getLanguage(),d=e.getCancelObject();this.getMask({"ds6w:type":{valueDB:this._getModelType(s)}},(function(e){var n=[];e.Write.attributes.forEach((function(e){var t=e.name;n.push(t)}));var o=this.getIdFromModel(s),c={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!0,with_nls:!1,locale:l,query:o,tenant:t.getTenantFromModel(s),source:r,select_predicate:n,start:0,select_file:["icon","thumbnail_2d"]},u="PropertiesPanel-"+(window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();c.label=u,i.source="3DSearch",d.handler=t.createRequest(i,"POST",a,c)}));return d}}},getElementsNls:function(t,i){t&&t.length>0?a.getResourcesInfo(t.join(","),{tenantId:i.tenant,lang:e.getLanguage(),apiVersion:"R2018x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e),i.onComplete.call(this,{success:!1})}}):i.onComplete.call(this,null)},getValuesNls:function(t,i){t?a.getNlsOfPropertiesValues(JSON.stringify(t),{tenantId:i.tenant,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,{success:!1})}}):i.onComplete.call(this,null)},_callMask:function(e,t,i){var n=this;c[e]?i.call(n,c[e]):require([t],(function(t){(t=JSON.parse(t))[e]?c[e]=t[e]:c[e]=t,i.call(n,c[e])}))},getMask:function(e,t){var i=e["ds6w:type"];i&&"pno:Person"===i.valueDB?this._callMask("Person","text!DS/EditPropWidget/assets/masks/3DSwym/Person.json",t):this._callMask("Default","text!DS/EditPropWidget/assets/masks/Federated/default.json",t)},_onCompleteFederated:function(i,n){var s=this,o=i.results,a={source:"Federated"},c=[],h={};if(a.data=c,o&&o.length>0){var p={},m={},f={},g={},v=null,_=null,E=o[0],w={};for(var b in E.attributes.forEach((function(t){var i=t.name,n=i,s=t.value;s=void 0===s?"":s;var o="ds6w_facet"===t.format,r=o;if(o){var c=i.split("/");n=c[c.length-1]}if(o=o||"attribute"===t.format){v=!0===r?g:m,_=!0===r?f:p;var E=t.type,b=!1;if("date"===E){var y=Date.parse(s),C=new Date(y);C&&(s=(s=e.convertDateToStandard(C,!0)).valueDB,"ds6w:modified"!==n&&"ds6w:created"!==n||(E="datetime"))}else b="string"===E;0===s.indexOf(n)&&(s=s.replace(n+".",""));var A=void 0!==t.dispValue,S=A?t.dispValue:s;if(b&&!A){var D=d[n];S=s;var I=D?D[s]:null;if(I)S=I;else{var P=w[n];P||(P=[],w[n]=P),P.push(s)}}var T={name:n,selectable:n,path:i,type:E,value:S,valueDB:s,readOnly:!0,nls:n};"ds6w:label"===n&&(h=T);var M=l[n];M?(T.nls=M.nlsName,u(v,n,T)):u(_,n,T)}else"resourceid"===n?a.physicalID=s:a[i]=s})),f)p[b]||(p[b]=f[b]);for(var b in g)m[b]||(m[b]=g[b]);n.idModel&&(a.physicalID=n.idModel),a.computed={label:h};var y=Object.keys(p),C=new Promise((function(e){s.getElementsNls(y,{tenant:t.getTenantFromModel(n.model),onComplete:function(t){e(t)}})})),A=new Promise((function(e){s.getValuesNls(w,{tenant:t.getTenantFromModel(n.model),onComplete:function(t){e(t)}})}));Promise.all([C,A]).then((function(e){var i=e[0],o=e[1];if(i)if(!1!==i.success){var r=i||{};r.vocabularyElementNLSInfo&&r.vocabularyElementNLSInfo.forEach((function(e){var t=p[e.uri];"Predicate"===e.type?l[e.uri]=e:d[e.uri]=e,t&&e.nlsName&&(t.nls=e.nlsName,m[e.uri]=t)}))}else t._raiseError(i.error?i.error.message:"Error",n);for(var u in o){var h=m[u];if(h){var f=o[u];if(h.multivalue){var g=[];h.value.forEach((function(e){var t=f[e];g.push(t||e)})),h.value=g}else h.value=f[h.value]?f[h.value]:h.value}}s.getMask(m,(function(e){e.Write.attributes.forEach((function(e){var t=e.name,i=m[t];i&&c.push(i)})),n.onComplete.call(null,{results:[a]})}))}))}else t._raiseError(r.get("FedAjax_NotFound"),n)}}})),define("DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests",["DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests","DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests","DS/EditPropWidget/constants/ConstantsMapping","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n){"use strict";var s={checkFacetsVisibility:"_getDefaultFacetsVisibility"},o=i.getSupportedServices(),a=o["3dspace"];a&&(a.service=e);var r=o.fedsearch;return a&&(r.service=t),{_getAjaxService:function(e,t,s){var o=null;i.getSupportedServices();if(s)o=s;else if(e&&e.length>0){var a=e[0];o=i.getServiceForModel(a)}o?o.service?t.call(null,o,e):require([o.require],(function(i){o.service=i,t.call(null,o,e)})):t.call(null,{name:n.get("Unknown")},e)},_onSourceUnavailable:function(e,t){var i={message:n.replace(n.get("sourceUnavailable"),{label:"SourceName",value:t}),code:"SU"};e.onComplete.call(null,{success:!1,error:i})},_callMethodOnSource:function(e,t){var i=this,n=e.modelList;!Array.isArray(n)&&e.model&&(n=[e.model]),this._getAjaxService(n,(function(n,o){var a=n.service;if(a&&"function"==typeof a[t])a[t].call(a,e);else{var r=!0;o.forEach((function(e){r=r&&e.get("isTransient")}));var l=s[t];r&&l?i[l].call(i,e):i._onSourceUnavailable(e,n.name)}}),e.defService)},commitModels:function(e){this._callMethodOnSource(e,"commitModels")},getPreviewUrl:function(e){this._callMethodOnSource(e,"getPreviewUrl")},getHistory:function(e){this._callMethodOnSource(e,"getHistory")},checkFacetsVisibility:function(e){this._callMethodOnSource(e,"checkFacetsVisibility")},getListOfAttributes:function(e){this._callMethodOnSource(e,"getListOfAttributes")},_getDefaultFacetsVisibility:function(e){var t=e.model.get("objectId");e.onComplete.call(null,{id:t,facets:{properties:!0}})},getListOfExtensions:function(e){this._callMethodOnSource(e,"getListOfExtensions")},getInstanceDetails:function(e){this._callMethodOnSource(e,"getInstanceDetails")},fetchMask:function(e){this._callMethodOnSource(e,"fetchMask")},getListOfDimensions:function(e){this._callMethodOnSource(e,"getListOfDimensions")},getConvertedMKSValue:function(e){this._callMethodOnSource(e,"getConvertedMKSValue")},runBusinessRuleForUI:function(e){this._callMethodOnSource(e,"runBusinessRuleForUI")}}})),define("DS/EditPropWidget/utils/EditPropUtils",["DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/constants/ConstantsMapping","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r){"use strict";var l="type_icon_url",d=r.get("accordion_parameters"),c=function(e,t,i){var s=[];if(t){t.forEach((function(t,o){var a=function(e,t,i){var s=new n,o=null;i&&t.extension&&(o=i[t.extension]),o=o||{};var a=1;s.set("multisel",e.isMergedModel()),s.set("name",t.name),s.set("label",t.name+" (NLS not defined)"),s.set("path",t.selectable),s.set("select",t.selectable),s.set("select",t.select),s.set("type",t.type),t.speType&&s.set("type",t.speType),s.set("multiline",null!=t.multiline&&!1!==t.multiline);var r=null!=t.multivalue&&!1!==t.multivalue;s.set("multivalue",r);var l=t.value,c=t.valueDB;if(e.isMergedModel()||(l={r:l},c&&(c={r:c})),l)for(var u in l){var h=l[u],p=c?c[u]:p;!1===r?(h=null===h?"":h,p=null===p?"":p,Array.isArray(h)&&(h=h.length>0?h[0]:"",p&&(p=p.length>0?p[0]:"")),h=void 0===h?"":h):""!==h&&null!=h||(h=[],p=[]),l[u]=h,c&&(c[u]=p)}else if(e.isMergedModel()){var m=e.getMergingModels();for(var f in l={},c={},m){var g=m[f],v=!1===r?"":[];"boolean"===t.type&&(v=!1),l[g.get("objectId")]=v,c[g.get("objectId")]=v}}e.isMergedModel()||(l=l.r,c&&(c=c.r)),t.range&&("string"==typeof t.range&&(t.range=t.range.split(",")),s.set("authorizedValues",t.range)),t.rangeNLS&&("string"==typeof t.rangeNLS&&(t.rangeNLS=t.rangeNLS.split(",")),s.set("authorizedValuesNLS",t.rangeNLS)),void 0!==t.range_required&&s.set("authorizedValuesRequired",!0===t.range_required),t.originalAuthVal&&s.set("originalAuthVal",t.originalAuthVal);var _=!0;if(t.readOnly||"owner"!==t.selectable||(_=!1),"No"!==t.readOnly&&!1!==t.readOnly||(_=!1),s.set("readOnly",_),s.set("value",l),c?s.set("valueDB",c):s.set("valueDB",l),s.set("mandatory","Yes"===t.mandatory||!0===t.mandatory),s.set("label",t.nls),s.set("path",t.path),t.dimensionType){let i=e.isMergedModel(),n=t.dimension,o=t.unitName;if(i&&void 0===n&&void 0===o){let t={},i={},n=e.getMergingModels();for(let e in n)t[e]=[],i[e]=[];s.set("dimension",t),s.set("unitName",i)}else if(void 0===t.dimension&&null===t.dimension||"object"!=typeof t.dimension||Array.isArray(t.dimension))null!=t.dimension&&""!==t.dimension||(t.dimension=[]),null!=t.unitName&&""!==t.unitName||(t.unitName=[]),s.set("dimension",t.dimension),s.set("unitName",t.unitName);else{let e=t.dimension,i=t.unitName;for(let t in e){let n=e[t],s=i[t];e[t]=n,i[t]=s}s.set("dimension",e),s.set("unitName",i)}}s.set("dimensionType",t.dimensionType),t.manipulationUnit&&s.set("manipulationUnit",t.manipulationUnit),t.mksDBUnit&&s.set("mksDBUnit",t.mksDBUnit),s.set("maxlength",t.maxlength),s.set("forbiddenChar",t.forbiddenChar),t.minval&&(s.set("minval",t.minval),t.minvalincluded&&s.set("minvalincluded",t.minvalincluded)),t.maxval&&(s.set("maxval",t.maxval),t.maxvalincluded&&s.set("maxvalincluded",t.maxvalincluded)),t.attrID&&(s.set("attributeID",t.attrID),s.set("facet",d),s.set("section",d)),t.facet?(s.set("facet",t.facet),s.set("section",t.facet)):o.name&&!0!==o.deploymentExtension&&(s.set("facet",o.name),s.set("section",o.nameNLS?o.nameNLS:o.name)),t.facetName&&s.set("section",t.facetName),t.extension&&s.set("extension",t.extension),void 0!==t.from&&s.set("from",t.from),t.relation&&s.set("relation",t.relation),t.rules&&s.set("rules",t.rules),t.applysort&&s.set("applySort",t.applysort);var E=t.UIPosition,w=(a=1,1);o.deploymentExtension&&!0!==t.maskedByType&&(a=2),E||0===E||(w=2,E=0,s.set("masked",!1));var b=a+"-"+w+"-"+E;return s.set("positionUI",b),t.group&&"Default"!==t.group&&(s.set("group",t.group),s.set("groupNLS",t.groupNLS),s.set("groupWeight",t.groupWeight)),t.forUI&&(s.set("forUIBL",t.forUI),t.blAccess&&s.set("blAccess",t.blAccess)),t.uxNotif&&s.set("notif",t.uxNotif),UWA.is(t.visible)&&s.set("visible",t.visible),t.basicAttribute&&s.set("basicAttribute",t.basicAttribute),s.set("keepformat",t.keepformat),s.set("displayAsEntered",t.displayAsEntered),s.saveInitialValues(),s}(e,t,i),r=a.get("positionUI");r+="-"+o,a.set("positionUI",r),s.push(a)}))}return s};return{getModelFromSelectedNode:function(n,s){var o,a=null;null!=(o=!(o=n&&"function"==typeof n.getInstID?n.getInstID():null)&&n&&"function"==typeof n.getRelationID?n.getRelationID():o)&&Array.isArray(o)&&(o=o.length>0?o[0]:null);var r=!!o,l=r?"relationship":"businessobject";if((o=(o=o||n.getID())||n.id)===(n.plmType||n.getType&&n.getType()))return null;var d=!r&&n.metatype?n.metatype:l,c=n.source?n.source:null,u=n.tenant?n.tenant:null,h=!r&&n.type?n.type:null;let p=n.sourceName?n.sourceName:null,m=n.indexModeParameter?n.indexModeParameter:null;if(null===h&&!r&&n.options&&n.options.type&&(h=n.options.type),o){var f={metatype:d,objectId:o};u=u||i.getTenantID();let r=n.getI3DX?n.getI3DX():"";if(r&&(f.i3dx=r),r&&n.getAttributeValue){let e=n.getAttributeValue("i3dx");e&&(f.i3dx=e)}u&&(f.tenant=u),c&&(f.source=c),p&&(f.sourceName=p),void 0!==m&&(f.indexModeParameter=m),h&&(f.type=h,f[t.MODEL_DS_ATTR+"type"]=h),s&&(f.objectId&&(s.identifier=f.objectId),f.i3dx&&(s.i3dx=f.i3dx),f.metatype&&(s.metatype=f.metatype),f.type&&(s.type=f.type)),a=new e(f)}return a},getModelFromPath:function(i,n,s,o,a){var r=i.length,l=1==r||(s||r%2==0),d=l?r-1:r-2,c=i[d],u=n?n[c]:null,h="";n&&!l&&(u=n[h=i[d+1]]);var p={objectId:c,metatype:v=s||!l?"relationship":"businessobject"};if(o&&(o.source&&(p.source=o.source),o.sourceName&&(p.sourceName=o.sourceName),void 0!==o.indexModeParameter&&(p.indexModeParameter=o.indexModeParameter)),u){var m=u.source?u.source:null,f=u.type?u.type:null,g=u.tenant?u.tenant:null,v=l&&u.metatype?u.metatype:v;g&&(p.tenant=g),m&&(p.source=m),f&&(p[t.MODEL_DS_ATTR+"type"]=f),v&&(p.metatype=v),h&&(p.selReferenceID=h)}return o&&o.i3dx&&(p.i3dx=o.i3dx),a&&(p.objectId&&(a.identifier=p.objectId),p.i3dx&&(a.i3dx=p.i3dx),p.metatype&&(a.metatype=p.metatype),p[t.MODEL_DS_ATTR+"type"]&&(a.type=p[t.MODEL_DS_ATTR+"type"])),new e(p)},getPreviewUrl:function(e){var t=e.preview_url;return t||""},fillFromServer:function(e,t,o){var a={modifyAccess:!0,success:!1,allAttributeAreRO:!0,plmparams:!1};if(!1!==e.success){a.success=!0,a.modifyAccess=!1!==e.modifyAccess;var r=this.getPreviewUrl(e),d=e[l]||"",u=function(e){var t=e.type_icon_large_url;return t||""}(e);d===u&&(u="");var h=t.getChangedValues(),p={};r&&(p.previewUrl=r),u&&(p.type_icon_url=u),d&&(p.type_small_icon=d),e.thumbnailsRW&&(p.activeThumbnail=!0),a.allAttributeAreRO=function(e,t,n){var s=!0;n||(n={});var o=["owner","modified","branch.owner","branch.modified"];(i.getWidgetValue("index_mode")||"Federated"===t.source||!0===t.DomainCentric)&&(o=["ds6w:responsible","ds6w:modified"]);var a=n.type_small_icon,r=c(e,t.data,t.extensions),d=c(e,t.basicData,t.extensions);return c(e,t.groupData,t.extensions).forEach((function(t){s=s&&!0===t.get("readOnly"),t.facet=t.group,t.extension=t.group,t.name===l&&a!==t.value&&(n.type_icon_url=t.value),"type"===t.name&&t.set("urlIcon",a);var i=0,r=o.indexOf(t.name);t.get("positionUI")&&(i=t.get("positionUI")),!e.isMergedModel()&&r>=0&&(0===r||2===r?t.set("sectionIdentityCard","ownerName"):1===r||3===r?t.set("sectionIdentityCard","date"):t.set("positionIdentityCard",r)),!0===t.get("masked")&&(t.set("positionUI",i),n[t.getIdentifier()]=t)})),d.forEach((function(t){s=s&&!0===t.get("readOnly"),t.name===l&&a!==t.value&&(n.type_icon_url=t.value),"type"===t.name&&t.set("urlIcon",a);var i=0,r=o.indexOf(t.name);t.get("positionUI")&&(i=t.get("positionUI")),!e.isMergedModel()&&r>=0&&(0===r||2===r?t.set("sectionIdentityCard","ownerName"):1===r||3===r?t.set("sectionIdentityCard","date"):t.set("positionIdentityCard",r)),!0===t.get("masked")&&(t.set("positionUI",i),n[t.getIdentifier()]=t)})),r.forEach((function(t,i){s=s&&!0===t.get("readOnly"),"ds6w:type"===t.name&&t.set("urlIcon",a);var r=0,l=o.indexOf(t.name);t.get("positionUI")&&(r=t.get("positionUI")),!e.isMergedModel()&&l>=0&&(0===l||2===l?t.set("sectionIdentityCard","ownerName"):1===l||3===l?t.set("sectionIdentityCard","date"):t.set("positionIdentityCard",l)),t.set("positionUI",r),n[t.getIdentifier()]=t})),s}(t,e,p);var m=function(e){var t={},i=e.computed;if(i&&i.label){var n=i.label;if(n.value&&"object"==typeof n.value)for(var s in n.value){var o=n.value[s];n.value[s]=Array.isArray(o)&&o.length>0?o[0]:o}t.label=n.value,n.path&&(t.attributeId=n.path),!n.path&&n.name&&(t.attributeId=n.name)}return t}(e),f=m.label;f||(t.isMergedModel()?(f={},t.getMergedModelIds().forEach((function(e){f[e]=""}))):f=""),f&&(p.label=Array.isArray(f)?f[0]:f),m.attributeId&&p[m.attributeId]?(p.labelAttribute=m.attributeId,p[m.attributeId].set("sectionIdentityCard","title"),t.addEvent("onChange:"+m.attributeId,(function(){var e=t.get(m.attributeId);e&&t.set("label",e.valueDB)}))):p[s.MODEL_DS_ATTR+"label"]=new n({sectionIdentityCard:"title",value:f,valueDB:f,multisel:t.isMergedModel(),isTransient:!0,path:s.MODEL_DS_ATTR+"label"});var g={};for(var v in h)p[v]||(g[v]=h[v]);e.type&&(p.type?p.type.set("valueDB",e.type):p.type=e.type);var _=t.getAllAttributes();for(var v in _){var E=_[v];"object"==typeof E&&E instanceof n&&!E.isTransient&&(o.initTable||E.attributeID)&&delete _[v]}if(t.set(p),t&&t.isMergedModel()){var w=t.getMergingModels();for(var b in w){var y=w[b];y.clearChangedValue();var C=UWA.clone(p);for(var v in p){var A=p[v];if(A instanceof n){var S=new n(C[v]);S.set("value",A.get("value")[b]),S.set("valueDB",A.get("valueDB")[b]),S.set("multisel",!1),A.get("dimensionType")&&A.get("dimension")&&"object"==typeof A.get("dimension")&&A.get("unitName")&&"object"==typeof A.get("unitName")&&(S.set("dimension",A.get("dimension")[b]),S.set("unitName",A.get("unitName")[b])),S.saveInitialValues(),C[v]=S}}y.set(C),y.setChangedValues(g)}}t.clearChangedValue(),t.setChangedValues(g),function(e){!e.get("type")||"true"!==i.getWidgetValue("admin")||"CATProduct"!==e.get("type").value&&"CATPart"!==e.get("type").value||e.get("project")&&e.get("project").set("readOnly",!1)}(t),a.plmparams=!0===function(e){var t=e.PLMParametersAvailable;return t||!1}(e)}return a},getModelFromPathInIndexMode:function(i,n,s,o){let a="";i&&i.length>0&&(a=i[0]);let r="";n&&n.length>0&&(r=n[0]);let l=a;r&&(l=r);let d=s?s[l]:null,c={metatype:"businessobject"};if(o&&(o.source&&(c.source=o.source),o.sourceName&&(c.sourceName=o.sourceName),void 0!==o.indexModeParameter&&(c.indexModeParameter=o.indexModeParameter)),a&&(c.objectId=a),r&&(c.i3dx=r),d){let e=d.type?d.type:null;e&&(c[t.MODEL_DS_ATTR+"type"]=e,c.type=e)}return new e(c)},getDimensions:function(){let e=this;return new Promise((function(t,n){e._dictionary=new Map;var s=i.getCancelObject(),r=a.getServiceBySource("3dspace"),l=i.getLanguage(),d={tenant:i.getTenantID(),lang:l,handleRequest:{handle:s},defService:r,onComplete:function(n){n&&"object"==typeof n&&n.results&&n.results.length>0&&(n.results.forEach((function(t){e._dictionary.set(t.Name,t)})),i.setValue("DimensionsDictionary",e._dictionary),t(!0))},onFailure:function(e){var t="Exception in '/resources/dictionary/dimensions' ws";e&&e.error&&e.error.message&&(t+=` -> error Message = ${e.error.message}`),console.log(t),n(e)}};o.getListOfDimensions(d)}))},_getDictionary:function(){return this._dictionary&&this._dictionary.size>=0?this._dictionary:null},getDimensionUnitName:function(e,t){let i=this._getDictionary();if(null===i)return null;let n=e;e.startsWith("DSDim_")&&(n=e.substring(6,e.length)),n||(n=e);let s=i.get(n),o=[],a=[];return s&&s.Units&&Array.isArray(s.Units)&&t.map((e=>{e=e.trim(),o=s.Units.filter((t=>t.Name===e||t.label===e||t.NLSName===e)),o.length>0&&o[0].Name&&a.push(o[0].Name)})),a},getDimensionUnitNLSName:function(e,t){let i=this._getDictionary();if(null===i)return null;let n=e;e.startsWith("DSDim_")&&(n=e.substring(6,e.length)),n||(n=e);let s=i.get(n),o=[];return s&&s.Units&&Array.isArray(s.Units)&&t.map((e=>{e=e.trim();let t=s.Units.filter((t=>t.Name===e||t.label===e||t.NLSName===e));t.length>0&&t[0].NLSName&&o.push(t[0].NLSName)})),o},getUnits:function(e){let t=this._getDictionary();if(null===t)return null;let i=e;e.startsWith("DSDim_")&&(i=e.substring(6,e.length)),i||(i=e);let n=t.get(i),s=[];return n&&n.Units&&Array.isArray(n.Units)&&n.Units.forEach((e=>{let t="";e.label?t=`${e.NLSName} (${e.label})`:e.Name&&(t=`${e.NLSName} (${e.Name})`),s.push(t)})),s}}})),define("DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests",["DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/EditPropWidget/ajaxRequests/MultipleAsynchronousRequests","DS/EditPropBaseUX/scripts/EditPropUtility","DS/WAFData/WAFData","DS/EditPropWidget/utils/EditPropUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a){"use strict";return{createRequest:function(e,t,i,n){var s=this;e&&!1===e.withChange?s._createRequestWithAuthoringContext(e,t,i,n):require(["DS/EditPropWidget/changeAction/passThruJS"],(function(o){o.onReady((function(o){s._createRequestWithAuthoringContext(e,t,i,n,o)}))}))},_createRequestWithAuthoringContext:function(n,o,a,r,l){var d=this;if(n.handleRequest){if(n.handleRequest.handle&&"function"==typeof n.handleRequest.handle.isCancelled&&n.handleRequest.handle.isCancelled())return}else n.handleRequest={};var c=["A"];e.isChangeAvailable()&&l&&c.push("B"),!0===n.withSC&&c.push("C");var u=new i(c,(function(){var t=this.getAnswer("A"),i=this.getAnswer("B"),l=this.getAnswer("C");l=l||n.securityContext;var c=t+a,u={Accept:"application/json","content-type":"application/json"};if(u["Accept-Language"]=e.getLanguage(),i){var h="silent"===n.withChange&&"object"==typeof r;for(var p in i)h?void 0===r[p]&&(r[p]=i[p]):u[p]=i[p]}l&&(u.SecurityContext=encodeURIComponent(l));var m=n.contentType?n.contentType:"json";if(n.headers)for(var p in n.headers)u[p]=n.headers[p];var f={type:m,method:o,timeout:36e5,proxy:"passport",headers:u,cache:-1,onComplete:function(e){n.onCompleteWS(e,n)},onFailure:function(e,t,i){d._onFailure(e,t,i,n)},onTimeout:function(e){d._onTimeout(n)}};e.getWidgetValue("isStandalone")||(f.authentication="passport"),r&&(f.data="json"!==m?r:UWA.Json.encode(r)),n.handleRequest.handle=s.handleRequest(d._formatUrl(n.model,c),f)}));n.handleRequest.handle=e.getSourceUrlAsync({platformId:this.getTenantFromModel(n.model),source:n.source?n.source:this.getSourceFromModel(n.model),onComplete:function(e){u.setAnswer("A",e)}}),!0===n.withSC&&t.getInstance({tenant:this.getTenantFromModel(n.model),source:n.source?n.source:this.getSourceFromModel(n.model)}).getValidSecurityContext({onSuccess:function(e){u.setAnswer("C",e.SecurityContext)},onFailure:function(e){console.log(" -- >> Can't get the security context"),u.setAnswer("C",null)}}),e.isChangeAvailable()&&l&&l.get2((function(e){var t=null;l.changeIsSetChecker(e)&&(t=e.AuthoringContextHeader),e.errorMessage&&console.log("Change : "+e.errorMessage),u.setAnswer("B",t)}))},getTenantFromModel:function(t){var i=t?t.get("tenant"):null;return i=i||e.getTenantID()},getSourceFromModel:function(e){return e?e.get("source"):null},_formatUrl:function(e,t){var i=this.getTenantFromModel(e);return this._formatUrl2(i,t)},_formatUrl2:function(e,t){if(e){var i=t.indexOf("?");i<0&&(t+="?"),i>0&&i<t.length-1&&(t+="&"),t=t+="tenant="+e}return t},getExtraValues:function(e,t){var i={},n=[];return e.forEach((function(e){i[e]=!0})),t.forEach((function(e){i[e]||n.push(e)})),n},_createJSONModifiedAttribute:function(t){var i=this,n=[],s=["physicalid","modified"],a={},r={},l=t.getChangedValues(),d={},c={};for(var u in l){var h=t.get(u),p=h.facet;if("object"==typeof h&&!h.isTransient){var m=h.attributeID;if(null!=m&&m.length>0)this._addPLMParameterQuery(h,n);else{var f=h.getChangedIds();for(var g in f){var v=f[g];"a"===g&&(g=t.get("objectId"));var _=d[g];_||(_=[],d[g]=_),(T=c[g])||(T=[].concat(s),c[g]=T),T.push(h.select);var E=v.valueDB;!1!==E&&null==E&&(E=v.value);{var w=null;Array.isArray(E)||"string"==typeof E||(w=E.toString()),null===w&&(w=E);var b=null;if(null!==h.from){var y=null,C=null;if(h.multivalue?(y=i.getExtraValues(h.valueDB,h.initialsValues.valueDB),C=i.getExtraValues(h.initialsValues.valueDB,h.valueDB)):h.valueDB!==h.initialsValues.valueDB&&(y=h.initialsValues.valueDB?[h.initialsValues.valueDB]:null,C=h.valueDB?[h.valueDB]:null),C&&C.length>0&&(b={op:"connect",path:h.path,relation:h.relation,name:h.name,from:h.from,value:C}),y&&y.length>0){var A={op:"disconnect",path:h.path,relation:h.relation,from:h.from,name:h.name,value:y};b?_.push(A):b=A}}else b={op:"replace",path:h.path,value:w};p&&(b.facet=p);var S=h.get("unitName");let t=h.get("dimensionType");if(t){let n=h.get("dimension");if("object"!=typeof n||Array.isArray(n)||(n=n[g],S=S[g]),h.get("multivalue")&&(n=i._getDimensionLabel(n,t)),void 0!==n||null!==n&&Array.isArray(n)&&n.length>0){let s=[];n.forEach((n=>{let a="";if(o&&"function"==typeof o.getDimensionUnitName)a=o.getDimensionUnitName(t,n);else{let s=e.getValue("DimensionsDictionary");a=i._getDimensionUnitName(s,t,n)}s.push(a)})),s.length>0?b.unitName=s:b.unitName=n}b.dimensionType=h.get("dimensionType")}b&&_.push(b)}}}}}var D=t.get("metatype"),I="model/";I+="businessobject"==D||"bus"==D?"bus/":"EBOM"==D?"EBOM/":"rel/";var P=[];for(var g in d){var T;r={path:I+g,method:"PATCH",body:d[g]};if(t._innerModels){let e=t._innerModels[g].get("_DS_ATTR_type")&&t._innerModels[g].get("_DS_ATTR_type").valueDB;e||(e=t._innerModels[g].get("type")&&t._innerModels[g].get("type").valueDB),r.type=e}else{let e=t.get("_DS_ATTR_type")&&t.get("_DS_ATTR_type").valueDB;e||(e=t.get("type")&&t.get("type").valueDB),r.type=e}(T=c[g])&&(a={select:T},r.queryParams=a),P.push(r)}return{requests:P,plmParametersRequests:n}},_addPLMParameterQuery:function(e,t){var i=e.valueDB;!1===i||i||(i=e.value);var n=[],s=[],o={},a=null;if(Array.isArray(i)||"string"==typeof i||(a=i.toString()),null===a&&(a=i),n.push(e.name),s.push({op:"replace",path:e.path,value:a}),null!=n){var r={select:n};o.queryParams=r}o.body=s;var l="plmparameter/"+e.attributeID;o.path="model/"+l;o.method="PATCH",t.push(o)},_concatRequestListComposite:function(e,t){t.forEach((function(t,i){var n=!1;e.every((function(i,s){return t.path!=i.path||t.method!=i.method||(e[s].body=e[s].body.concat(t.body),e[s].queryParams.select=e[s].queryParams.select.concat(t.queryParams.select),n=!0,!1)})),!1===n&&e.push(t)}))},securityContextDispatcher:function(e,i){var n=this;if(e.securityContext)i.call(this,e);else{var s=null;s=t.getInstance({tenant:e.tenant,source:e.source?e.source:this.getSourceFromModel(e.model)}).getValidSecurityContext({context:e.context,onSuccess:function(t){e.securityContext=t.SecurityContext,i.call(n,e)},onFailure:function(t){n._onFailure(null,{error:t},null,e)}}),e.handleRequest&&s&&(e.handleRequest.handle=s)}},_onCompleteAttributes:function(e,t){t.onComplete.call(null,e)},_onCompleteCommit:function(e,t){t.onComplete.call(null,e)},_onFailure:function(e,t,i,s){var o={};if(null!=t&&t.hasOwnProperty("error")&&"EDITPROP_ERROR_0001"===t.error)o={message:a.get("UpdateFailedDueToFrozenModelConnected"),code:"ERROR"},this._raiseError(o,s);else if(null!=t&&t.hasOwnProperty("error")&&"ErrorCode:1500572"===t.error){var r={level:"error",title:UWA.i18n("InvalidCSCreationfailed"),subtitle:UWA.i18n("InvalidCSCreationFailedSubtitle"),message:UWA.i18n("NoAccessToCS")};n.showMessageOnUI(r.level,r.title,r.subtitle,r.message,!1)}else if(null!=t&&t.hasOwnProperty("error")&&"INF102"===t.error.code){r={level:"error",title:UWA.i18n("NoaccesstoApptitle"),subtitle:UWA.i18n("NoaccesstoAppDesc"),message:""};n.showMessageOnUI(r.level,r.title,r.subtitle,r.message,!1)}else{if(null!=t&&t.hasOwnProperty("error"))o=t.error;else if(null!=t&&!0===s.domainCentric){let e=a.get("An unexpected error occurred. Contact your administrator for support");if(t&&Array.isArray(t)&&t.length>0){let t=t[0];t&&t.errors&&Array.isArray(t.errors)&&t.errors.length>0&&t.errors[0]&&t.errors[0].detail&&(e=t.errors[0].detail)}o={message:e,code:"ERROR"}}else o={message:a.get("Error Server"),code:"ERROR"};this._raiseError(o,s)}},_raiseError:function(e,t){"object"!=typeof e&&(e={message:e}),t.onComplete.call(null,{success:!1,error:e})},_onTimeout:function(e){var t={message:a.get("ErrorTimeOut"),code:"TO"};this._raiseError(t,e)},_getDimensionUnitName:function(e,t,i){let n=t.startsWith("DSDim_")&&t.substring(6,t.length),s=e.get(n);i=i&&i.trim();let o=[],a="";return s&&s.Units&&Array.isArray(s.Units)&&(o=s.Units.filter((e=>e.label===i||e.Name===i))),o.length>0&&o[0].Name&&(a=o[0].Name),a},_getDimensionLabel:function(t,i){let n=e.getValue("DimensionsDictionary"),s=i.startsWith("DSDim_")&&i.substring(6,i.length),o=n.get(s),a=[],r=[];return o&&o.Units&&Array.isArray(o.Units)&&t.forEach((e=>{a=o.Units.filter((t=>t.label===e||t.NLSName===e||t.name===e)),a.length>0&&(a[0].label?r.push(a[0].label):r.push(a[0].name))})),r}}})),define("DS/EditPropWidget/ajaxRequests/i3dxAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/utils/EditPropUtils","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/EditPropWidget/utils/DomainPropertiesUtils","DS/EditPropBaseUX/scripts/EditPropUtility","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l,d){"use strict";var c={"ds6w:type":{type:"string",position:1},"ds6w:label":{type:"string",position:2},"ds6w:identifier":{type:"string",position:3},"ds6w:revision":{type:"string",position:4},"ds6w:description":{type:"string",position:5},"ds6w:created":{type:"date",position:6},"ds6w:modified":{type:"date",position:7},"ds6w:responsible":{type:"string",position:8},"ds6w:status":{type:"string",position:9}};return{checkFacetsVisibility:function(e){var t={};r.checkFacetsVisibility(e,t),e.onComplete.call(this,{id:e.model.get("i3dx"),facets:t})},getListOfAttributes:function(i){let n=this;var s=i.modelList;i.securityContext;if(s.length){var o=s[0],a=o.get("i3dx");if(a){let s=r.getDomainFromI3dx(a);if(s){let u=r.getServiceAndRelativePathFromDictionary(s.toUpperCase());if(null!=u){n.domainServiceAndRelativePathFromDictionary=u;let s=t.getTenantFromModel(o);n.isPropertiesReadPresent=!!u.propertiesread,n.isFetchPresent=!!u.fetchforproperties;var l="";if(n.isPropertiesReadPresent){let e=u.propertiesread.relativePath;i.source=u.propertiesread.service,l=e+"?tenant="+s,i.onCompleteWS=i.onComplete}else if(n.isFetchPresent){let e=u.fetchforproperties.relativePath;i.source=u.fetchforproperties.service,l=e+"?tenant="+s+"&include=ds6w:icon,ds6w:previewURL,ds6w:revision,ds6w:status",i.onCompleteWS=this._onCompletei3dx.bind(this)}var d="POST";i.model=o,i.idModel=a;e.getLanguage();var c=e.getCancelObject();i.domainCentric=!0}}var u={data:[{"ds6w:i3dx":a}]};return c.handler=t.createRequest(i,d,l,u),c}}},getElementsNls:function(t,i){t&&t.length>0?a.getResourcesInfo(t.join(","),{tenantId:i.tenant,lang:e.getLanguage(),apiVersion:"R2018x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls of all elements"+JSON.stringify(e)),i.onComplete.call(this,e)}}):i.onComplete.call(this,null)},getValuesNls:function(t,i){if(t){var n={};for(var s in t)Array.isArray(t[s])&&(n[s]=[],t[s].forEach((function(e){n[s].push({value:t[s][0],source:[i.service]})})));a.getNlsOfPropertiesValuesBySource(n,{tenantId:i.tenant,serviceName:i.service,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+JSON.stringify(e)),i.onComplete.call(this,e)}})}else i.onComplete.call(this,null)},_onCompletei3dx:function(e,i){var n=this,s=e.data,o={source:"",preview_url:"",DomainCentric:!0,type_icon_url:""};let a={},r=[],l={};var u=[];if(o.data=u,s&&s.length>0){var h=s[0];for(const e in h){const t=e;"ds6w:previewURL"===t&&(o.preview_url=h[t]),"ds6w:dataSource"===t&&(o.source=h[t]),"ds6w:icon"===t&&(o.type_icon_url=h[t]),c[t]&&n._createAttributeModel(t,a,r,l,h)}o.computed={label:a["ds6w:label"]?a["ds6w:label"]:{}};for(let e in c){a[e]||n._createAttributeModel(e,a,r,l)}var p=new Promise((function(e){n.getElementsNls(r,{tenant:t.getTenantFromModel(i.model),onComplete:function(t){e(t)},apiCalled:n.nlsNameApiCalledCounter})})),m=new Promise((function(e){var s=i.source?i.source:n.domainServiceAndRelativePathFromDictionary.service;s&&n.getValuesNls(l,{tenant:t.getTenantFromModel(i.model),service:s,onComplete:function(t){e(t)},apiCalled:n.nlsValueApiCalledCounter})}));Promise.all([p,m]).then((function(e){var t=e[0],n=e[1];if(t&&!1!==t.success){var s=t||{};s.vocabularyElementNLSInfo&&s.vocabularyElementNLSInfo.forEach((function(e){let t=a[e.uri];t&&(t.nls=e.nlsName)}))}for(var r in n){var l=a[r];if(l){var d=n[r];l.value=d[l.value]?d[l.value]:l.value}}for(const e in a)u.push(a[e]);i.onComplete.call(null,{results:[o]})}))}else t._raiseError(d.get("An unexpected error occurred. Contact your administrator for support"),i)},_createAttributeModel:function(t,i,n,s,o){let a=c[t],r=t,l=o&&o[t];l=null==l?"":l;let d=a.type;if("date"===d){var u=Date.parse(l),h=new Date(u);h&&(l=e.convertDateToStandard(h,!0),l&&l.valueDB&&(l=l.valueDB))}let p={name:r,selectable:r,path:r,type:d,value:l,valueDB:l,readOnly:!0,nls:r,UIPosition:a.position};i[r]=p,n.push(r),"string"===d&&(s[r]=[l])}}})),define("DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/utils/EditPropUtils","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/EditPropWidget/assets/settings/SettingsForServices.json","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l){"use strict";var d={},c={},u={};r=JSON.parse(r);var h=function(e,t,i){var n=e[t];n?(!0==!n.multivalue&&(n.value=[n.value],n.valueDB=[n.valueDB],n.multivalue=!0),n.value.push(i.value),n.valueDB.push(i.valueDB)):e[t]=i};return{getPreviewUrl:function(e){if(!e.ids&&e.modelList){var t=this;e.ids=[],e.modelList.forEach((function(i){var n=t.getIdFromModel(i);n&&e.ids.push(n)}))}this._getPreviewUrl(e)},_getPreviewUrl:function(i){var n=this,s=i.ids,a=s.length;a&&(i.handleRequest.handle=e.get3DSearchUrlAsync({platformId:i.tenant,onComplete:function(r){var l=r+"/search",d=e.getLanguage(),c="",u="";s.forEach((function(e){c+=u+e,u=" OR "}));var h={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!1,nresults:a,locale:d,query:c,tenant:i.tenant,start:0,select_file:["icon","thumbnail_2d"]},p="PropertiesPanel-"+(window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();h.label=p;var m={Accept:"application/json","content-type":"application/json"};m["Accept-Language"]=e.getLanguage();var f={type:"json",method:"POST",timeout:24e4,data:UWA.Json.encode(h),proxy:"passport",headers:m,cache:-1,onComplete:function(e){n.onCompletePreview(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(f.authentication="passport"),i.handleRequest.handle=o.handleRequest(t._formatUrl2(i.tenant,l),f)}}))},onCompletePreview:function(e,t){var i=[];e&&e.results&&e.results.forEach((function(e){var t=null,n=null,s=!0;e.attributes&&e.attributes.every((function(e){return"resourceid"===e.name&&(t=e.value),"preview_url"===e.name&&(n=e.value),s=!(null!=t&&null!=n)})),s||i.push({id:t,preview:n})})),t.onComplete(i)},checkFacetsVisibility:function(e){var t={};t[i.FACET_PROPERTIES]=!0,e.onComplete.call(this,{id:e.model.get("objectId"),facets:t})},getSourceId:function(e){var t=e.get("sourceName");t=t||e.get("source");var i="",s=n.getSupportedServices()[t.toLowerCase()];return s&&s.fedPrefix&&(i=s.fedPrefix),i},fillModel:function(e,t){var i=e.onComplete;return e.onComplete=function(e){e&&e.results&&e.results.length>0&&s.fillFromServer(e.results[0],t,{}),i.apply(this,[t])},e.modelList=[t],this.getListOfAttributes(e)},getIdFromModel:function(e){var t=this.getSourceId(e),n=e.get("objectId");return e.get("metatype")===i.METATYPE_REL&&e.get("selReferenceID")&&(n=e.get("selReferenceID")),n=n||"",t&&0!==n.indexOf(t)?t+':"'+n+'"':n},getQueryForIndexService:function(e){let t=e.get("objectId"),n=e.get("i3dx");e.get("metatype")===i.METATYPE_REL&&e.get("selReferenceID")&&(t=e.get("selReferenceID"));let s="";return s=n?`[ds6w:i3dx]:"${n}"`:`[ds6w:resourceUid]:"${t}"`,s},_getModelType:function(e){var t,i=e.get("ds6w:type");t="string"==typeof i?i:i?i.get("valueDB"):"";var n=e.get("source");t||"3DSwym"!==n||0==e.get("objectId").indexOf("iam")&&(t="pno:Person");return t},getListOfAttributes:function(n){var s=n.modelList;n.securityContext;if(s.length){var o=s[0],a=o.get("objectId");o.get("metatype")===i.METATYPE_REL&&o.get("selReferenceID")&&(a=o.get("selReferenceID")),o.get("i3dx")&&(a=o.get("i3dx"));var l="POST",d="";if(a){d="/search";n.model=o,n.idModel=a,n.onCompleteWS=this._onCompleteFederated.bind(this);var c=e.getLanguage(),u=e.getCancelObject();if(o.get("indexModeParameter")&&n.select_predicates&&Array.isArray(n.select_predicates)&&n.select_predicates.length>0){let e=this.getQueryForIndexService(o),i=[],s=o.get("source");if(s){let e=r[s.toUpperCase()];e&&e.keyOnFedSearch&&i.push(e.keyOnFedSearch)}var h={with_indexing_date:!1,with_synthesis:!0,with_synthesis_attribute:!0,with_nls:!1,locale:c,query:e,tenant:t.getTenantFromModel(o),source:i,select_predicate:n.select_predicates,start:0,select_file:["icon","thumbnail_2d"]};n.getPLMParameter&&(h.source=["3dspace"],h.specific_source_parameter={"3dspace":{plmparam:{retrieve_plmparam:!0}}});var p="PropertiesPanel-"+(window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();h.label=p,n.source="3DSearch",u.handler=t.createRequest(n,l,d,h)}else this.getMask({"ds6w:type":{valueDB:this._getModelType(o)}},(function(e){var i=[];e.Write.attributes.forEach((function(e){var t=e.name;i.push(t)}));var s=this.getIdFromModel(o),a=[];o.get("indexSource")?a.push(o.get("indexSource").toLowerCase()):o.get("sourceName")&&a.push(o.get("sourceName").toLowerCase());var r={with_indexing_date:!1,with_synthesis:!0,with_synthesis_attribute:!0,with_nls:!1,locale:c,query:s,tenant:t.getTenantFromModel(o),source:a,select_predicate:i,start:0,select_file:["icon","thumbnail_2d"]};i&&(n.select_predicates=i),n.getPLMParameter&&(r.source=["3dspace"],r.specific_source_parameter={"3dspace":{plmparam:{retrieve_plmparam:!0}}});var h="PropertiesPanel-"+(window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();r.label=h,n.source="3DSearch",u.handler=t.createRequest(n,l,d,r)}));return u}}},getElementsNls:function(t,i){t&&t.length>0?a.getResourcesInfo(t.join(","),{tenantId:i.tenant,lang:e.getLanguage(),apiVersion:"R2018x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e),i.onComplete.call(this,{success:!1})}}):i.onComplete.call(this,null)},getValuesNls:function(t,i){if(t){var n={};for(var s in t)Array.isArray(t[s])&&(n[s]=[],t[s].forEach((function(e){n[s].push({value:t[s][0],source:[i.service]})})));a.getNlsOfPropertiesValuesBySource(n,{tenantId:i.tenant,serviceName:i.service,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,e)}}),a.getPropertiesForClass(JSON.stringify(t),{tenantId:i.tenant,serviceName:i.service,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,e)}})}else i.onComplete.call(this,null)},_callMask:function(e,t,i){var n=this;u[e]?i.call(n,u[e]):require([t],(function(t){(t=JSON.parse(t))[e]?u[e]=t[e]:u[e]=t,i.call(n,u[e])}),(function(t){require(["text!DS/EditPropWidget/assets/masks/Federated/default.json"],(function(t){(t=JSON.parse(t))[e]?u[e]=t[e]:u[e]=t,i.call(n,u[e])}))}))},getMask:function(e,t){var i=e["ds6w:type"];if(i&&"pno:Person"===i.valueDB)this._callMask("Person","text!DS/EditPropWidget/assets/masks/3DSwym/Person.json",t);else{var n=i.valueDB;if(null!=n&&""!=n){var s=n.split(":")[1];if(null!=s&&null!=s&&""!=s){var o="text!DS/EditPropWidget/assets/masks/Federated/"+(s+".json");this._callMask(i&&i.valueDB,o,t)}else this._callMask("Default","text!DS/EditPropWidget/assets/masks/Federated/default.json",t)}else this._callMask("Default","text!DS/EditPropWidget/assets/masks/Federated/default.json",t)}},_onCompleteFederated:function(i,n){var s=this,o=i.results,a={source:"Federated"},r=[],u={},p={};if(a.data=r,o&&o.length>0){var m={},f={},g={},v={},_=null,E=null,w=o[0],b={};for(var y in w.attributes.forEach((function(t){var i=t.name,o=i,r=t.value;r=void 0===r?"":r;var l="ds6w_facet"===t.format,w=l;if(l){var y=i.split("/");o=y[y.length-1]}if(l=l||"attribute"===t.format){_=!0===w?v:f,E=!0===w?g:m;var C=t.type,A=!1;if("date"===C){var S=Date.parse(r),D=new Date(S);D&&(r=(r=e.convertDateToStandard(D,!0)).valueDB,"ds6w:modified"!==o&&"ds6w:created"!==o||(C="date"))}else"double"===C.toLowerCase()?C="real":A="STRING"===C.toUpperCase();0===r.indexOf(o)&&(r=r.replace(o+".",""));var I=void 0!==t.dispValue,P=I?t.dispValue:r;if(A&&!I){var T=c[o];P=r;var M=T?T[r]:null;if(M)P=M;else{var F=b[o];F||(F=[],b[o]=F),F.push(r)}}var W={name:o,selectable:o,path:i,type:C,value:P,valueDB:r,readOnly:!0,nls:o};"ds6w:label"===o&&(u=W);var O=d[o];O?(W.nls=O.nlsName,h(_,o,W)):h(E,o,W)}else"resourceid"===o?a.physicalID=r:t.format.startsWith("PLMPARAM")||(a[i]=r);n.getPLMParameter&&(p=s.parsePLMParamater(t,p))})),Object.keys(p).length>0&&(a.PLMParametersAvailableForIndexMode=!0),g)m[y]||(m[y]=g[y]);for(var y in v)f[y]||(f[y]=v[y]);n.idModel&&(a.physicalID=n.idModel),a.computed={label:u};var C=Object.keys(m);if(w.attributes.length>0&&n.select_predicates)for(var A=0;A<n.select_predicates.length;A++)C.includes(n.select_predicates[A])||C.push(n.select_predicates[A]);var S=new Promise((function(i){e.isReplayedODT()&&(s.nlsNameApiCalledCounter||(s.nlsNameApiCalledCounter=0),void 0!==s.nlsNameApiCalledCounter&&s.nlsNameApiCalledCounter++),s.getElementsNls(C,{tenant:t.getTenantFromModel(n.model),onComplete:function(e){i(e)},apiCalled:s.nlsNameApiCalledCounter})})),D=new Promise((function(i){e.isReplayedODT()&&(s.nlsValueApiCalledCounter||(s.nlsValueApiCalledCounter=0),void 0!==s.nlsValueApiCalledCounter&&s.nlsValueApiCalledCounter++);var o=n.model.get("source")?n.model.get("source"):"";o&&s.getValuesNls(b,{tenant:t.getTenantFromModel(n.model),service:o,onComplete:function(e){i(e)},apiCalled:s.nlsValueApiCalledCounter})}));Promise.all([S,D]).then((function(e){var i=e[0],s=e[1];if(i)if(!1!==i.success){var o=i||{};o.vocabularyElementNLSInfo&&o.vocabularyElementNLSInfo.forEach((function(e){var t=m[e.uri];"Predicate"===e.type?d[e.uri]=e:c[e.uri]=e,t&&e.nlsName&&(t.nls=e.nlsName,f[e.uri]=t)}))}else t._raiseError(i.error?i.error.message:"Error",n);for(var u in s){var h=f[u];if(h){var g=s[u];if(h.multivalue){var v=[];h.value.forEach((function(e){var t=g[e];v.push(t||e)})),h.value=v}else h.value=g[h.value]?g[h.value]:h.value}}n.select_predicates.forEach((function(e){var t=f[e];if(t)r.push(t);else{var i=c[e];if(i||(i=d[e]),i&&i.nlsName&&i.uri){var n={name:i.uri,nls:i.nlsName,path:i.uri,readOnly:!0,selectable:i.uri,type:"STRING",value:"",valueDB:""};r.push(n)}}}));for(var _=Object.keys(p),E=[],w=0;w<_.length;w++)p[_[w]].groupNLS=l.get("accordion_parameters"),p[_[w]].group="PLMParametersGroup",p[_[w]].groupWeight=0,E.push(p[_[w]]);a.groupData=E,n.onComplete.call(null,{results:[a]})}))}else t._raiseError(l.get("FedAjax_NotFound"),n)},getListOfExtensions:function(e){var i=e.modelList[0],n=i.get("objectId"),s="",o={};if(i.get("i3dx")&&(n=i.get("i3dx")),n){s="/search";let d=[],c=i.get("source");if(c){let e=r[c.toUpperCase()];e&&e.keyOnFedSearch&&d.push(e.keyOnFedSearch)}o.model=i,o.objectId=n,o.onCompleteWS=e.onComplete,o.onComplete=function(t){var i="Exception in '/search' ws when looking for List of Extensions";t&&t.error&&t.error.Message&&t.error.MessageException&&(i+=` -> error Message = ${t.error.Message} MessageException = ${t.error.MessageException}`),console.error(i),e.onComplete.call([],e)};var a={with_indexing_date:!1,with_synthesis:!0,with_synthesis_attribute:!0,with_nls:!1,locale:e.lang,query:this.getQueryForIndexService(i),tenant:e.tenantId,source:d,select_predicate:e.select_predicates,start:0,select_file:["icon","thumbnail_2d"]},l="PropertiesPanel-"+(window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();a.label=l,o.source="3DSearch",t.createRequest(o,"POST",s,a)}},parsePLMParamater:function(e,t){return t}}})),define("DS/EditPropWidget/ajaxRequests/3dlifecycleAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/WAFData/WAFData"],(function(e,t,i,n,s){"use strict";return{checkFacetsVisibility:function(e){var t={};if(null!=e.facets&&e.facets.length>0)for(var i=0;i<e.facets.length;i++){var s=e.facets[i].name;"properties"===s?t[n.FACET_PROPERTIES]=!0:"social"===s?t[n.FACET_SWYMCOMMENTS]=!0:t[n.FACET_PROPERTIES]=!0}else t[n.FACET_PROPERTIES]=!0;e.onComplete.call(this,{id:e.model.get("objectId"),facets:t})},getListOfAttributes:function(i){var n=i.modelList;i.navigateToMain;i.securityContext="ctx::Kanban User.Company Name.Kanban_PRJ";e.getWidgetValue("index_mode");if(n.length){var s=t.getTenantFromModel(r),o="/resources/v1/modeler/kanban/boards/"+(r=n[0]).get("objectId")+"?tenant="+s+"&mask=properties",a=e.isDebug(),r=(e.getWidgetValue("debug_properties"),n.length>0?n[0]:null);i.model=r,i.withSC=!1,i.withChange=!1,i.onCompleteWS=t._onCompleteAttributes,t.createRequest(i,"GET",o,null)}},commitModels:function(e){var i=e.modelList;e.securityContext="ctx::Kanban User.Company Name.Kanban_PRJ";var n=t.getTenantFromModel(r),s="/resources/v1/modeler/kanban/boards/"+(r=i[0]).get("objectId")+"?tenant="+n,o=[],a=!1;i.forEach((function(e,i){var n=t._createJSONModifiedAttribute(e);a=a||n.requests.length>0,o=o.concat(n.requests);var s=n.plmParametersRequests;s.length>0&&t._concatRequestListComposite(o,s)}));var r=i.length>0?i[0]:null,l={requests:o};a&&null!=r&&r.isMergedModel()&&(l.transactionid=r.get("objectId")),e.model=r,e.onCompleteWS=t._onCompleteCommit,t.createRequest(e,"PATCH",s,l)}}})),define("DS/EditPropWidget/controllers/EditPropMainController",["UWA/Class/Model","DS/EditPropWidget/models/OccurrenceModel","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropWidget/UI/EditPropSkeleton","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/EditPropWidget/utils/DomainPropertiesUtils"],(function(e,t,i,n,s,o,a,r,l,d,c,u,h){"use strict";var p=!1;return"undefined"!=typeof dscef&&(p=dscef.isA2X),UWA.Class.extend({skeleton:null,defaultOptions:{selectionType:r.ALL_SELECTION,displayType:r.STANDARD,context:null,odtUpTransient:!1},init:function(e){var t=this;for(var i in this._parent(e),this._selectionIsStopped=!1,this._currentNewSelection=null,this.options=this.options?this.options:{},this.defaultOptions)this.options[i]=e[i];this.indexModeParameterFromApp=!1,this.indexModeParameter=!1,this.USE_APP_SECURTIYCONTEXT="true"===e.USE_APP_SECURTIYCONTEXT,null!=e.indexModeParameter&&(this.setIndexModeFlag(e.indexModeParameter),this.setIndexModeFlagFromApp(e.indexModeParameter)),this.sharedInformationForFacet=e.sharedInformationForFacet,c.getInstance({context:this.options.context}),o.getDimensions();var n=e.events.onCancel;e.events.onCancel=function(e){t._unsubscribeSelect(),t.skeleton.clearPanel(),t.skeleton.setOccurrences([]),t.skeleton.notifyClose,t.skeleton.notifyClose(),n&&n.call(t,e)},this._setup(e),e.selectionType!==r.NO_SELECTION&&(this._commandProxy=null,require(["DS/WidgetServices/commandProxy/CommandProxy"],(function(e){var i=!1,n=0,s=function(e,s){if(e.paths&&0===e.paths.length||e.pathsInst&&0===e.pathsInst.length)i=!1,setTimeout((function(){!1===i&&t._onSelectionChange(e,s)}),500);else{i=!0;var o=++n;setTimeout((function(){o===n&&t._onSelectionChange(e,s)}),50)}},o={events:{onSelect:s}};t.options.displayType!==r.TRANSIENT&&!0!==t.options.odtUpTransient||(o.events.onUpdateTransient=function(e){e.models;var i=e.options;i&&i.securityContext&&(t.USE_APP_SECURTIYCONTEXT?c.getInstance({context:{getSecurityContext:function(){return{SecurityContext:i.securityContext}}}}).getValidSecurityContext():c.getInstance({context:{getSecurityContext:function(){return{SecurityContext:i.securityContext}}}}).getSecurityContext()),t._commandProxy.subscribe({onSelect:s})}),t._commandProxy=e.create(o)})))},getTopBar:function(){return this.skeleton.getTopBar()},_unsubscribeSelect:function(){this._commandProxy&&this._commandProxy.unsubscribe(this._commandProxy.choices.SELECT)},setModels:function(e,t,i,n){var s=this;null!=i&&""!==i?(this.skeleton.defaultFacetName=i,this.skeleton.selectFacet(i)):this.skeleton.defaultFacetName=null,null!=n&&""!==n&&(this.skeleton.infoForFacet=n);var o=!!this._currentNewSelection;this._currentNewSelection={models:e,change:t},o||this.skeleton.checkChangeAuthorized((function(e){var t=s._currentNewSelection;s._currentNewSelection=null,!0===e&&s._setModels(t.models,t.change)}),!0)},_setModels:function(o,a){p||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_setModelController"):window.top.performance.mark("start_setModelController"));var c=(w=o&&o.length>0?o[0]:null)?w instanceof e?w.get("tenant"):w.tenant:null;if(w&&c&&d.setWidgetValue("x3dPlatformId",c),"ENOLCMT_AP"===d.getWidgetValue("x3dAppId")&&void 0!==a&&d.isChangeAvailable()){require(["DS/EditPropWidget/changeAction/passThruJS"],(function(e){e.onReady((function(e){o.length>0&&(e.changeIsSetChecker(a)||a&&a.configurationRevision)?e.set(a,(function(t){void 0===t.Message&&e.show()})):(e.cleanAuthDetails(),e.hide())}))}))}var m=this,f=o.length,g=[];if(f){var v={},_={},E=null;o.forEach((function(n,a){if("function"!=typeof n.isMergedModel||!0!==n.isMergedModel()){var l=o[a],d=null;n instanceof e?(m._getModel(l.get("objectId"))||l.clearChangedValue(),d=l.getChangedValues()):(l=new i(n),o[a]=l),m._getModel(l.get("objectId"))||(m.editPropModelList=[l],l.clearChangedValue()),l.keys().forEach((function(e){var t=l.get(e),i=t instanceof s;if(!i&&t&&"object"==typeof t&&"EditProp_listOfChange"!==e&&"label"!==e&&(t=new s(t),i=!0,l.set(e,t)),i&&!0===l.isTransientModel()){var n=t.getIdentifier();if(n){var o=_[n];if(o){var a=t.get("value"),r=t.get("valueDB"),d=o.get("value"),c=o.get("valueDB");d[l.get("objectId")]=a,c[l.get("objectId")]=r,"title"===o.get("sectionIdentityCard")&&(E.value[l.get("objectId")]=a,E.valueDB[l.get("objectId")]=r),o.__nbValues++}else{a=(o=new s(UWA.clone(t))).get("value"),r=o.get("valueDB"),c={};(d={})[l.get("objectId")]=a,c[l.get("objectId")]=r,o.set("multisel",!0),o.set("value",d),o.set("valueDB",c),o.__nbValues=1,"title"===o.get("sectionIdentityCard")&&((E={value:{},valueDB:{}}).value[l.get("objectId")]=a,E.valueDB[l.get("objectId")]=r),_[n]=o}}}})),l.clearChangedValue();var c=l.get("EditProp_listOfChange");c&&(l.setChangedValues(c),l.unset("EditProp_listOfChange")),d&&l.setChangedValues(d);var u=l;if(!v[u.get("objectId")]){v[u.get("objectId")]=u;var h=new t;m._occurrenceModel=h,h.setModel(r.MODEL_INIT,u),g.push(h)}}}));var w,b=Object.keys(v).length;if(b>1)if(null!=(w=g[0].getModel(r.MODEL_INIT))){var y=UWA.clone(w.getOptions());for(var C in _){_[C].__nbValues===b&&(y[C]=_[C])}null!=E&&(y[r.MODEL_DS_ATTR+"label"]=new s({sectionIdentityCard:"title",value:E.value,valueDB:E.valueDB,isTransient:!0,multisel:!0,path:r.MODEL_DS_ATTR+"label"}));var A=(A=d.getWidgetPreference("transactionId"))&&A.value?A.value:m._generateMergeID(),S=new t({modelPrefix:A,isMerging:!0});m._occurrenceModel=S,y.objectId=A;var D=new n(y);D.setMergingModels(v),S.setModel(r.MODEL_INIT,D),g.unshift(S)}else console.log("First model not found in occurrence")}if(m.sharedInformationForFacet){m.skeleton.infoForFacet&&(m.sharedInformationForFacet.infoForFacet=m.skeleton.infoForFacet),m.sharedInformationForFacet.securityContextFromAppPreference=m.updatedSecurityContext;let e=m._occurrenceModel;e||(e=new t),e.setSharedInformationForFacet(m.sharedInformationForFacet)}var I="App Side Panel";this.options.displayType!==r.TRANSIENT&&this.options.displayType!==r.POPUP||(I="App Popup"),this.options.displayType===r.PINNED&&(I="Pinned");var P={UXName:"Information",numberObjects:f,UXContext:I,pd16:this.skeleton.currentFacetName};let T=this._getTypeForTracker(f,this.editPropModelList,D);T&&(P.typeObjects=T),this.skeleton.lastTrackerEvent=u.createInitActionEvent(P,this.skeleton.lastTrackerEvent),u.checkAndTrackPageEvent(this.skeleton.lastTrackerEvent),p||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_setModelController"):window.top.performance.mark("end_setModelController"));let M=m.editPropModelList;if(M&&Array.isArray(M)&&M.length>0&&"function"==typeof M[0].get&&M[0].get("i3dx")){let e=M[0].get("i3dx");h.checkIfDomainPropFacetToLoad(e)?(this.skeleton.loadDomainFacet=!0,l.setDomainCentricFlag(!0)):(this.skeleton.loadDomainFacet=!1,l.setDomainCentricFlag(!1))}else this.skeleton.loadDomainFacet=!1,l.setDomainCentricFlag(!1);this.skeleton.setOccurrences(g)},_generateMergeID:function(){return d.generateUniqueId()},_getModel:function(e){return this.skeleton.getModel(e)},getModels:function(){return this.skeleton.getModels()},getTitle:function(){return this.skeleton.getTitle()},getOptimalSize:function(){return this.skeleton.getOptimalSize()},getUI:function(){return this.skeleton},onRefresh:function(){var e=this,t=e.getModels();e.setModels([],void 0),e.setModels(t,void 0)},_getFacet:function(e,t){var i=t;if("string"==typeof t)i=e[t];else if("object"==typeof t&&t.id){var n=e[t.id];if(n){for(var s in t)n[s]=t[s];i=n}}return i},addFacets:function(e){if(e){var t=this,i=[],n=this.mapFacet?this.mapFacet:l.getMapping();e.forEach((function(e){i.push(t._getFacet(n,e))}));var s=this.getUI();s&&s.addFacets(i)}},_setup:function(e){var t=this,i=l.getMapping(e);t.mapFacet=i;var n=l.getDefaultFacets();e.facets&&(n=e.facets,delete e.facets);var s=[],o=!1;n.forEach((function(n){var a=t._getFacet(i,n);a&&(!o&&a.facet&&a.facet.name===r.FACET_PROPERTIES&&(o=!0),(!0!==a.blockFromSearch||!e||"searchInformationProperties"!==e.className&&"searchPreviewProperties"!==e.className)&&s.push(a))})),o||(i[r.FACET_PROPERTIES].visible=!1,s.push(i[r.FACET_PROPERTIES])),this.skeleton=new a(s,e)},destroyComponent:function(){this._commandProxy&&(this._commandProxy.unsubscribe("onUpdateTransient"),this._commandProxy.unsubscribe("onSelect"))},onResize:function(){this.getUI().onResize()},_raiseNotif:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:t})},stopSelection:function(e){this._selectionIsStopped=!0===e},_onSelectionChange:function(e,t){if(this.options.selectionType===r.NO_SELECTION||!0===this._selectionIsStopped)return;if(t&&t.metadata&&t.metadata.originWidgetId===d.getWidgetId()&&"ENORIPE_Relations"===t.metadata.origin)return;let i=null,n=e.source;e.hasOwnProperty("securityContext")&&(i=e.securityContext,this.updatedSecurityContext=i,c.getInstance({context:{getSecurityContext:function(){return{SecurityContext:i}}},source:n}));var s=e.pathsInst,a=!!s,l=(s=s&&s.length>0?s:e.paths)&&s.length,u=e.defaultFacetName,h=e.infoForFacet,p=e.attributes;let m=e.appid,f=e.sourceName,g=e.indexModeParameter,v=s,_=e.i3dxIds;!0===g&&_&&Array.isArray(_)&&_.length>0&&void 0===l&&(l=_.length,s=_),m&&(this.sharedInformationForFacet.sourceAppId=m),this.makeDecisionForIndexMode(g);let E={indexModeParameter:this.getIndexModeFlag()};_&&_.length>0&&(E.i3dx=_[0]),n&&(E.source=n),f&&(E.sourceName=f);var w=this.getModels(),b=[];w.forEach((function(e){b.push(e.get("objectId"))}));var y=!1;if(y=this.options.selectionType!==r.RESTRICTED_SELECTION||t.metadata&&t.metadata.originWidgetId===d.getWidgetId()){for(var C=[],A=0;A<l;A++){var S=s[A];let t;if(v&&v.length===l&&(t=v[A]),this.sharedInformationForFacet&&this.sharedInformationForFacet.objectIdentifierFromApp&&(this.sharedInformationForFacet.objectIdentifierFromApp=[]),S){let i={identifier:"",metatype:"",type:""};if(g)D=o.getModelFromPathInIndexMode(t,_,p,E);else var D=o.getModelFromPath(S,p,a,E,i);!D.get("tenant")&&e.tenant&&D.set("tenant",e.tenant),C.push(D),this.sharedInformationForFacet&&this.sharedInformationForFacet.objectIdentifierFromApp&&this.sharedInformationForFacet.objectIdentifierFromApp.push(i)}}var I=null;if(d.isChangeAvailable()&&(I=UWA.clone(e.changeControl)),this.setModels(C,I||null,u,h),d.isReplayedODT())return C}return d.isReplayedODT()&&!y?"No load of model with selected object":void 0},changeAttributes:function(e){this.skeleton.changeAttributes(e)},setIndexModeFlag:function(e){void 0!==e&&(this.indexModeParameter=e)},getIndexModeFlag:function(){return!0===this.indexModeParameter},setIndexModeFlagFromApp:function(e){void 0!==e&&(this.indexModeParameterFromApp=e)},getIndexModeFlagFromApp:function(){return!0===this.indexModeParameterFromApp},makeDecisionForIndexMode:function(e){let t=this;if(!0===e||!1===e)t.setIndexModeFlag(e),t.skeleton.setIndexModeFlag(e);else{let e=t.getIndexModeFlagFromApp();t.setIndexModeFlag(e),t.skeleton.setIndexModeFlag(e)}},_getTypeForTracker:function(e,t,n){let o="",a="",r=function(e){let t=e.get("_DS_ATTR_type");return t||(t=e.get("type")),"object"==typeof t&&t instanceof s&&(t=t.value||t.valueDB),t};if(1==e)t&&Array.isArray(t)&&t.length>0&&t[0]instanceof i&&(o=r(t[0]));else if(n&&n._innerModels&&"object"==typeof n._innerModels){let e=Object.keys(n._innerModels);for(let t=0;t<e.length;t++){let s=n._innerModels[e[t]];if(s&&s instanceof i){let e=r(s);if(a&&0==a.length&&(a=e),a!=e){o="multiType";break}}}o||(o=a)}return o}})})),define("DS/EditPropWidget/EditPropWidget",["UWA/Core","UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/controllers/EditPropMainController"],(function(e,t,i,n,s){"use strict";var o=function(e){this.setReadonlyStatus(e)};return t.extend({defaultOptions:{},_getController:function(e){return this.controller?this.controller:new s(e)},init:function(e,t){t&&i.setWidgetObject(t),this.clickOnAnnotationData=e.clickOnAnnotationData;var s={};for(var a in e)s[a]=e[a];if(s.propertiesWidgetUI=!0,null!==s.securityContextFromAppPreference&&void 0!==s.securityContextFromAppPreference||(s.context&&"function"==typeof s.context.getSecurityContext&&s.context.getSecurityContext()&&s.context.getSecurityContext().SecurityContext?s.securityContextFromAppPreference=s.context.getSecurityContext().SecurityContext:s.securityContextFromAppPreference=null),s.context&&"function"==typeof s.context.getSecurityContext&&(this.getSecurityContext=s.context.getSecurityContext.bind(s.context)),null!==s.disableAddExtensionButton&&void 0!==s.disableAddExtensionButton||(s.disableAddExtensionButton=!1),s.sourceAppId||(s.sourceAppId=s.appId),!s.sharedInformationForFacet){let e={infoForFacet:{},objectIdentifierFromApp:[],securityContextFromAppPreference:"",sourceAppId:""};if(s.sourceAppId&&(e.sourceAppId=s.sourceAppId),s.securityContextFromAppPreference&&(e.securityContextFromAppPreference=s.securityContextFromAppPreference),s.infoForFacet&&(e.infoForFacet=s.infoForFacet),s.context&&s.context.getSelectedNodes&&"function"==typeof s.context.getSelectedNodes){s.context.getSelectedNodes().forEach((t=>{let i={identifier:"",metatype:"",type:""};var n;t.getId&&"function"==typeof t.getId&&(i.identifier=t.getId()),t.getI3DX&&"function"==typeof t.getI3DX&&(i.i3dx=t.getI3DX()),t.type&&(i.type=t.type),null!=(n=!(n=t&&"function"==typeof t.getInstID?t.getInstID():null)&&t&&"function"==typeof t.getRelationID?t.getRelationID():n)&&Array.isArray(n)&&(n=n.length>0?n[0]:null);var s=!!n?"relationship":"businessobject";t.metatype?i.metatype=t.metatype:i.metatype=s,e.objectIdentifierFromApp.push(i)}))}s.sharedInformationForFacet=e}var r=this;this._parent(s),this.elements||(this.elements={}),s.events||(s.events={}),s.events.onInnerCancel=function(){r.destroyComponent()},this.controller=this._getController(s),this.elements.UI=this.controller.getUI(),this.elements.container=this.elements.UI,this.elements.container.getContent().addEvent("resize",(function(){r.onInnerResize()})),(i.isReplayedODT()||i&&i.getWidgetObject&&"function"==typeof i.getWidgetObject&&i.getWidgetObject().getValue&&"function"==typeof i.getWidgetObject().getValue&&!0===i.getWidgetObject().getValue("proto"))&&(this._handlerSwitch=o.bind(this),n.subscribe("switchMode",this._handlerSwitch))},initDatafromWin:function(e){var t=[];e.forEach((function(e){var i={objectId:e.physicalId};t.push(i)})),console.log("initDatafromWin / selection size: "+e.length),console.log("initDatafromWin / tenant: "+this.tenant),this.initDatas(t)},addAnnotationData:function(e){var t=this,i=function(t){"social"===t.facet.name&&setTimeout((function(){var i=t.content._socialView;if(i&&e&&e.annotation){var n={annotations:[{annotation:{annotation:e.annotation,screenshot:e.screenshot}}],appendContent:!1};i.setActiveCommentInputContent(n)}}))};t.elements.UI._lFacets&&t.elements.UI._lFacets.forEach((function(e){e&&e.facet&&e.facet.name&&"social"===e.facet.name&&(e.content?i(e):t.elements.UI.subscribeEvt("facetLoaded",i),t.elements.UI.selectFacet(e.facet.name))}))},initDatas:function(e,t,i){let n,s=this;void 0!==this.clickOnAnnotationData&&null!=this.clickOnAnnotationData&&(e[0].clickOnAnnotationData=this.clickOnAnnotationData),e&&e[0]&&"function"==typeof e[0].get&&e[0].get("indexModeParameter")&&(n=e[0].get("indexModeParameter")),void 0===n&&"object"==typeof e[0]&&e[0].hasOwnProperty("indexModeParameter")&&(n=e[0].indexModeParameter),this.controller.makeDecisionForIndexMode(n);let o=this.controller.getIndexModeFlag();e&&e[0]&&n!==o&&("function"==typeof e[0].set?e[0].set("indexModeParameter",o):e[0].indexModeParameter=o),this.getSecurityContext&&"function"==typeof this.getSecurityContext&&this.getSecurityContext()&&this.getSecurityContext().hasOwnProperty("SecurityContext")&&(this.controller.updatedSecurityContext=this.getSecurityContext().SecurityContext),this.controller.sharedInformationForFacet.objectIdentifierFromApp=[],e.forEach((function(e){let t={identifier:"",metatype:"",type:""},i="",n="",o="",a="";"function"==typeof e.get?(e.get("objectId")&&(i=e.get("objectId")),e.get("i3dx")&&(a=e.get("i3dx")),n=e.get("type"),o=e.get("metatype")):(e.objectId&&(i=e.objectId),e.i3dx&&(a=e.i3dx),n=e.type,o=e.metatype),i&&(t.identifier=i),a&&(t.i3dx=a),n&&(t.type=n),o&&(t.metatype=o),s.controller.sharedInformationForFacet.objectIdentifierFromApp.push(t)})),this.controller.setModels(e,void 0,t,i)},initData:function(e,t,i){this.initDatas(e,t,i)},changeAttributes:function(e){this.controller.changeAttributes(e)},show:function(e){this.elements.editPropWrapper&&(this.elements.editPropWrapper.show(),this.initDatas(e))},centerIt:function(e){this.elements.editPropWrapper&&this.elements.editPropWrapper.centerIt()},onRefresh:function(){this.controller.onRefresh()},onResize:function(){},onInnerResize:function(){this.elements.editPropWrapper?this.elements.editPropWrapper.onResize():this.elements.UI&&this.elements.UI.onResize()},setReadonlyStatus:function(e){this.elements.UI.setReadonlyStatus(e)},selectFacet:function(e){this.elements.UI.selectFacet(e)},removeFacets:function(e){this.elements.UI.removeFacets(e)},stopSelection:function(e){this.controller.stopSelection(e)},addFacets:function(e){this.controller.addFacets(e)},getTitle:function(){return this.elements.UI.getTitle()},getIdentityCardUI:function(){return this.elements.UI.getIdentityCardUI()},getMainTable:function(e){return this.elements.UI.getMainTable()},getListModel:function(){return this.controller.getModels()},destroyComponent:function(){this._handlerSwitch&&n.remove("switchMode",this._handlerSwitch),this.controller.destroyComponent(),this.elements.editPropWrapper?this.elements.editPropWrapper.destroyComponent():this.elements.UI.destroyComponent()}})})),define("DS/EditPropWidget/dockablecomponent/DockablePanel",["UWA/Controls/Abstract","DS/EditPropWidget/controllers/EditPropMainController","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/EditPropConstants","DS/Windows/ImmersiveFrame","DS/Windows/Panel","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/editPropPopup"],(function(e,t,i,n,s,o,a,r){"use strict";var l="ENOVIA - Information";return e.extend({init:function(e){this.dataReady=!1,this._parent(e),this.initUI()},getController:function(){return this.propController},initUI:function(){var e=this;this.centerAtNextResize=!1,this.widgetPere=this.options.container,this.widgetPere=this.widgetPere?this.widgetPere:i.getWidgetBody();var n={},a=this.options;for(var r in a)n[r]=a[r];n.showTopBar=!0,n.setCloseButton=!0,n.setEditButton=!0,n.events={};var d=!1,c={onDataLoaded:function(){if(d){var t=e.propController.getOptimalSize(),i=t.width;i<600&&(i=600),e.webuxPanel.width=i,e.webuxPanel.height=t.height}},onTitleChanged:function(){var t=e.propController.getTitle();t&&(t=" - "+(t=(t=t.replace(/(&nbsp;)/g," ")).replace(/(<wbr>)/g,""))),e.webuxPanel.title=l+t},onIdentityCardExpands:function(){e.onResize()}};if(a.events)for(var r in a.events)n.events[r]=a.events[r];for(var r in c)n.events[r]=c[r];e.propController=new t(n);var u=new s({});this.options.immersiveFrameFromApp||(this.defaultImmersiveFrame=u,u.inject(this.widgetPere));let h=WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea;this.webuxPanel=new o({immersiveFrame:this.options.immersiveFrameFromApp?this.options.immersiveFrameFromApp:u,identifier:"EditPropDockable_"+this.options.className,title:l,content:e.propController.getUI(),resizableFlag:!0,width:600,height:"1000",allowedDockAreas:h,usePaddingFlag:!1,ensureHeightDefinitionOnHierarchy:!0,floatableFlag:!0,verticallyStretchableFlag:!0,currentDockArea:WUXDockAreaEnum.RightDockArea}),this.webuxPanel.immersiveFrame.dockWindow(this.webuxPanel,WUXDockAreaEnum.RightDockArea,{attachToOtherDockedWindow:!0}),this.webuxPanel.addEventListener("close",(function(){e.panelClosedButtonClicked=!0,e.closePanel()})),d=!this.webuxPanel._getDimensionsFromPreferences()},show:function(){this.webuxPanel.show(),this.onResize()},onRefresh:function(){null!=this.propController&&this.propController.onRefresh()},onResize:function(){this.propController&&this.propController.onResize()},closePanel:function(){this.dispatchEvent("onCancel"),this.dispatchEvent("onInnerCancel"),delete this.panelClosedButtonClicked},destroyComponent:function(){this.propController.destroyComponent(),this.defaultImmersiveFrame&&this.defaultImmersiveFrame.destroy(),this.panelClosedButtonClicked||this.webuxPanel.close()}})})),define("DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/ENOBusinessRuleClient/Services","DS/WAFData/WAFData","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd"],(function(e,t,i,n,s,o,a){"use strict";return{commitModels:function(e){var i=e.modelList,n=(e.securityContext,[]),s=!1;i.forEach((function(e,i){var o=t._createJSONModifiedAttribute(e);s=s||o.requests.length>0,n=n.concat(o.requests);var a=o.plmParametersRequests;a.length>0&&t._concatRequestListComposite(n,a)}));var o=i.length>0?i[0]:null,r={requests:n};s&&null!=o&&o.isMergedModel()&&(r.transactionid=o.get("objectId")),a.enrichRequestWithMetrics(r,{UXName:"Properties"}),e.model=o,e.onCompleteWS=t._onCompleteCommit,t.createRequest(e,"PUT","/resources/v1/collabServices/attributes/op/update?propertiesFacet=true",r)},getPreviewUrl:function(e){var t=e.modelList,n=(t.length,[]),s="";t.forEach((function(e){var t=e.get("objectId");s=s||e.get("tenant"),t&&n.push("physicalid:"+e.get("objectId"))})),n.length>0&&(e.ids=n,e.tenant=s,i.getPreviewUrl(e))},getHistory:function(e){t.securityContextDispatcher(e,this._getHistory)},_getHistory:function(i){var n=i.modelList,s=i.nbResult,a=i.lastDate,r=i.securityContext;i.handleRequest||(i.handleRequest={}),s=s||20;if(n.length){var l="",d="";n.forEach((function(e){var t=e.get("objectId");l+=d+"id="+t,d="&"}));var c=n.length>0?n[0]:null;i.handleRequest.handle=e.getSourceUrlAsync({platformId:t.getTenantFromModel(c),source:t.getSourceFromModel(c),onComplete:function(d){var c="",u="";c="passport",u=d+"/resources/v1/collabServices/attributes/op/history",u+="?"+l,u+="&nbResults="+s,a&&(u+="&lastDate="+a);var h={Accept:"application/json","content-type":"application/json"};h["Accept-Language"]=e.getLanguage(),r&&(h.SecurityContext=encodeURIComponent(r));var p={type:"json",method:"GET",timeout:36e5,proxy:c,headers:h,cache:-1,onComplete:function(e){t._onCompleteAttributes(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(p.authentication="passport");var m=n.length>0?n[0]:null;i.handleRequest.handle=o.handleRequest(t._formatUrl(m,u),p)}})}},checkFacetsVisibility:function(e){t.securityContextDispatcher(e,this._checkFacetsVisibility)},_checkFacetsVisibility:function(i){var n=i.model,s=n.get("objectId"),a=i.facets,r=i.sourceAppId,l=i.securityContext;i.handleRequest||(i.handleRequest={});var d={id:s,facets:a,sourceAppId:r};n.get("instrefid")&&(d.mains={},d.mains[s]={id:n.get("instrefid")}),n.isMergedModel()&&(d.ids=n.getMergedModelIds());i.handleRequest.handle=e.getSourceUrlAsync({platformId:t.getTenantFromModel(n),source:t.getSourceFromModel(n),onComplete:function(s){var a="",r="";a="passport",r=s+"/resources/v1/collabServices/attributes/op/facets/available";var c={Accept:"application/json","content-type":"application/json"};c["Accept-Language"]=e.getLanguage(),l&&(c.SecurityContext=encodeURIComponent(l));var u={type:"json",method:"POST",timeout:36e5,proxy:a,headers:c,data:UWA.Json.encode(d),onComplete:function(e){t._onCompleteAttributes(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(u.authentication="passport"),i.handleRequest.handle=o.handleRequest(t._formatUrl(n,r),u)}})},getListOfAttributes:function(i){var s=i.modelList,o=!0===i.navigateToMain?"true":"false",r=(i.securityContext,e.getWidgetValue("index_mode")),l=s.length,d=!1,c=!1;if(l){for(var u=[],h=[],p=[],m={},f=(P=s[0]).get("objectId"),g=0;g<l;g++){var v=s[g],_={a:v};for(var E in c=c||v.isMergedModel(),v.isMergedModel()&&(_=v.getMergingModels()),_){var w=_[E],b=w.get("metatype"),y=w.get("objectId"),C=w.get("instrefid");d=d||"EBOM"==b,r||b!=n.METATYPE_BUS&&"bus"!=b?r||b!=n.METATYPE_REL?u.push(y):("undefined"!==C&&""!==C&&h.length===p.length&&(p.push(C),m[y]={id:C}),h.push(y)):p.push(y)}}var A="";A="/resources/v1/proto/attributes/op/read",!1!==d||r?r&&console.log("DEBUG-INFORMATION: /attributes/op/readindex - this web service is no more available"):A="/resources/v1/collabServices/attributes/op/read";var S=e.isDebug(),D=e.getWidgetValue("debug_properties")||S?"true":null,I=null;r?I={lIds:u,indexattributes:"true",debug_properties:D||""}:(I={lIds:u,relIDs:h,busIDs:p,plmparameters:i.plmParams?"true":"false",attributes:!1!==i.attributes?"true":"false",navigateToMain:o,readonly:!0===i.readonly?"true":"false",debug_properties:D||"",runUXBL:"true",ignoreKernelAccessChecks:i.ignoreKernelAccessChecks?"true":"false"},Object.keys(m).length>0&&(I.mains=m),c&&(I.format="merge"),c&&(I.transactionid=f),a.enrichRequestWithMetrics(I,{UXName:"Properties"}));var P=s.length>0?s[0]:null;i.model=P,i.withSC=!0,i.withChange="silent",i.onCompleteWS=t._onCompleteAttributes,t.createRequest(i,"POST",A,I)}},getListOfExtensions:function(e){var i="";if(e.modelList.length){var n=e.tenantId,s={classes:[e.type]};i=`/resources/dictionary/class/interfaces?tenant=${n}&xrequestedwith=xmlhttprequest`;var o={onCompleteWS:e.onComplete,onComplete:function(t){var i="Exception in '/resources/dictionary/class/interfaces' ws";t&&t.error&&t.error.Message&&t.error.MessageException&&(i+=` -> error Message = ${t.error.Message} MessageException = ${t.error.MessageException}`),console.error(i),e.onComplete.call([],e)}};t.createRequest(o,"POST",i,s)}},getInstanceDetails:function(e){t.securityContextDispatcher(e,this._getInstanceDetails)},_getInstanceDetails:function(e){var i=e.securityContext;if(e.modelList&&e.modelList.length>0){var n=e.modelList[0].get("objectId"),s={};s.input_physical_ids=[n],s.primitives=e.primitives,s.patterns=e.patterns,s.attributes=e.attributes,s.version=3;var o="EP-"+(window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();s.label=o;var a={onCompleteWS:e.onComplete,onComplete:function(e){var t="Exception in '/cvservlet/navigate' ws";e&&e.error&&e.error.Message&&e.error.MessageException&&(t+=` -> error Message = ${e.error.Message} MessageException = ${e.error.MessageException}`),console.error(t)}},r=`/cvservlet/navigate?SecurityContext=${i}`;t.createRequest(a,"POST",r,s)}},fetchMask:function(e){t.securityContextDispatcher(e,this._fetchMask)},_fetchMask:function(e){var i={type:e.type,name:e.name,indexMode:e.indexMode?"true":"false"},n={onCompleteWS:e.onComplete,onComplete:function(e){var t="Exception '/resources/collabCommon/settings/getmask' ws";e&&e.error&&e.error.Message&&e.error.MessageException&&(t+=` -> error Message = ${e.error.Message} MessageException = ${e.error.MessageException}`),console.error(t)},securityContext:e.securityContext,type:e.type,name:e.name};t.createRequest(n,"POST","/resources/collabCommon/settings/getmask",i)},getListOfDimensions:function(e){t.securityContextDispatcher(e,this._getListOfDimensions)},_getListOfDimensions:function(e){var i={onCompleteWS:e.onComplete,onComplete:e.onFailure};t.createRequest(i,"GET","/resources/dictionary/dimensions")},getConvertedMKSValue:function(e){t.securityContextDispatcher(e,this._getConvertedMKSValue)},_getConvertedMKSValue:function(e){var i={Data:e.data,tenantId:e.tenantId},n={onCompleteWS:e.onComplete,onComplete:function(e){var t="Exception in '/resources/dictionary/dimensions/convertValues' ws";e&&e.error&&e.error.Message&&e.error.MessageException&&(t+=` -> error Message = ${e.error.Message} MessageException = ${e.error.MessageException}`),console.error(t)},securityContext:e.securityContext};t.createRequest(n,"POST","/resources/dictionary/dimensions/convertValues",i)},runBusinessRuleForUI:function(e){var i=this;if(this.clientBLServices)this.clientBLServices.runBusinessRuleForUI(e.brID,e.data,e.onSuccess,e.onFailure,e.onTimeout);else{var n=t.getTenantFromModel(e.modelList[0]);t.securityContextDispatcher(e,(function(e){i.clientBLServices=new s({header:{SecurityContext:e.securityContext},tenant:n}),i.clientBLServices.runBusinessRuleForUI(e.brID,e.data,e.onSuccess,e.onFailure,e.onTimeout)}))}}}})),define("DS/EditPropWidget/popup/EditPropPopup",["UWA/Controls/Abstract","DS/Logger/Logger","DS/EditPropWidget/controllers/EditPropMainController","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/EditPropConstants","DS/UIKIT/Spinner","DS/ENOFloatingPanel/ENOFloatingPanel","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/editPropPopup"],(function(e,t,i,n,s,o,a,r,l){"use strict";var d="ENOVIA - Information";return e.extend({defaultOptions:{className:"",readOnly:!1,serverName:"",serverUri:"",editMode:!1,container:null,context:null},init:function(e){this.dataReady=!1,this._parent(e),this.initUI()},centerIt:function(){this.centerAtNextResize=!1,this.container.centerIt()},setDefaultListOfModel:function(e){this.defaultModels=e},setDataReady:function(e){e&&(this.defaultModels=null),this.dataReady=e},getController:function(){return this.propController},initUI:function(){var e=this;this.centerAtNextResize=!1,this.widgetPere=this.options.container,this.widgetPere=this.widgetPere?this.widgetPere:n.getWidgetBody();var t={},r=this.options;for(var c in r)t[c]=r[c];t.className="editProp_innerComponent",t.showTopBar=!1,t.popup=!0,t.setCloseButton=!0,t.setEditButton=!0,t.events={};var u=!1,h={onDataLoaded:function(){if(u){var t=e.propController.getOptimalSize(),i=t.width;i<600&&(i=600),e.container.setNewBodySize({width:i,height:t.height}),e.container.lockWidth(),e.centerAtNextResize=!0}e.fakeFloatingPanel.hide()},onTitleChanged:function(){var t=e.propController.getTitle();t&&(t=" - "+(t=(t=t.replace(/(&nbsp;)/g," ")).replace(/(<wbr>)/g,""))),e.container.setTitle(d+t)},onIdentityCardExpands:function(){e.onResize()}};if(r.events)for(var c in r.events)t.events[c]=r.events[c];for(var c in h)t.events[c]=h[c];e.propController=new i(t);e.propController.getTopBar();var p=UWA.createElement("table",{class:"EditProp_topBarPopup"}),m=(UWA.createElement("td",{class:"titleSpan"}).inject(p),UWA.createElement("td",{class:"right-actions"}).inject(p),null),f=null;n.isWebInWinEnvironment()||n.isNatifEnvironnement()||(n.getRealPath("EditPropWidget/EditPropWidget.html",widget,!1),m={custoClass:"properties_piner",widgetTitle:"",widgetAppId:"ENOLCMT_AP",widgetData:{title:"My widget",SelectedItem:[],loadData:!0,editProperty_collapseIC:n.getWidgetValue(s.COLLAPSE_IC_PREFERENCE.name),editProperties_editMode:n.getWidgetValue("editProperties_editMode")}},f=function(t){var i=e.propController.getModels();0===i.length&&e.defaultModels&&(i=e.defaultModels);i.forEach((function(e,t){var n=UWA.clone(e.getChangedValues());i[t].set("EditProp_listOfChange",n)})),t.widgetData.SelectedItem=i,t.widgetData.loadData=!e.dataReady,t.widgetData.editProperty_collapseIC=n.getWidgetValue(s.COLLAPSE_IC_PREFERENCE.name),t.widgetData.editProperties_editMode=n.getWidgetValue("editProperties_editMode"),e.propController&&e.propController.getUI&&"function"==typeof e.propController.getUI&&e.propController.getUI().sourceAppId&&(t.widgetData.parent_x3dAppId=e.propController.getUI().sourceAppId),t.widgetData.isPinned="true"});var g=UWA.createElement("span");new o({visible:!0}).inject(g),UWA.createElement("span",{tag:"span",text:l.get("Loading")}).inject(g),e.fakeFloatingPanel=new a({className:"EPP_PopupDialFake",body:g,title:d,pinOptions:m,pinCallback:f,overlay:!1,closable:!0,animate:!0,resizable:!1,events:{onClose:function(){e._cancel()}}}),e.container=new a({className:"EPP_PopupDial "+this.options.className,body:e.propController.getUI(),footer:e.propController.getTopBar(),title:d,pinOptions:m,pinCallback:f,persistId:"floatProperties",overlay:!1,closable:!0,animate:!0,resizable:!0,autocenter:!1,events:{onResizeFloating:function(){e.centerAtNextResize&&e.centerIt()},onClose:function(){e._cancel()}}}),u=!e.container.isDimensionSaved(),e.container.elements.container.setStyle("left",-2e4),e.fakeFloatingPanel.inject(this.widgetPere),e.container.inject(this.widgetPere);var v=this.container.elements.header;this.container.elements.content;setTimeout((function(){var t=e.widgetPere.getSize(),i=v.getSize(),n="1000";"1000">t.height-i.height&&(n=t.height-i.height),u&&e.container.setNewSize({width:600,height:n}),e.fakeFloatingPanel.centerIt()}),0)},show:function(){this.fakeFloatingPanel.show(),this.container.show()},onRefresh:function(){null!=this.propController&&this.propController.onRefresh()},onResize:function(){this.container.onResize(),this.propController&&this.propController.onResize()},_cancel:function(){this.dispatchEvent("onCancel"),this.dispatchEvent("onInnerCancel")},destroyComponent:function(){this.propController.destroyComponent(),this.container.hide(),this.container.destroy(),this.fakeFloatingPanel.hide(),this.fakeFloatingPanel.destroy()}})})),define("DS/EditPropWidget/dockablecomponent/EditPropDockableComponent",["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/dockablecomponent/DockablePanel","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e)},_getController:function(e){return this.elements.editPropWrapper||(this.elements.editPropWrapper=new t(e)),this.controller?this.controller:this.elements.editPropWrapper.getController()}})})),define("DS/EditPropWidget/EditPropComponent",["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/popup/EditPropPopup","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e)},_getController:function(e){return this.elements.editPropWrapper||(this.elements.editPropWrapper=new t(e)),this.controller?this.controller:this.elements.editPropWrapper.getController()}})})),define("DS/EditPropWidget/factory/EditPropComponentFactory",["DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/EditPropComponent","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/dockablecomponent/EditPropDockableComponent"],(function(e,t,i,n){"use strict";return{createFactory:function(s){switch(s.displayType){case e.POPUP:return new t(s);case e.DOCKABLE:return new n(s);case e.TRANSIENT:break;default:return new i(s)}}}})),define("DS/EditPropWidget/utils/EditPropIndexUtils",["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/ConstantsMapping","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t,i,n,s){"use strict";return{getListOfExtensions:function(e,n){var o=this;if(e.type!==s.EDITPROPINDEX_DEFAULTTYPE){t.getCancelObject(),i.getServiceBySource("3dspace"),i.getServiceBySource("fedsearch"),e.type;var a=e.model;t.getLanguage(),a.getTenant();o.promiseForAutoExt=new Promise((function(e,t){e({})})),o.promiseForNonAutoAndCustoExt=new Promise((function(e){e({})})),Promise.all([o.promiseForAutoExt,o.promiseForNonAutoAndCustoExt]).then((function(t){o.parseListOfExtensions(t,n,e)}))}else n([],e)},parseListOfExtensions:function(e,t,i){var n=e[0],s=e[1],o=[];n&&n.results&&n.results.length>0&&n.results[0]&&n.results[0].interfaces&&n.results[0].interfaces.map((function(e){if(e.hasOwnProperty("automatic")&&"yes"===e.automatic.toLowerCase()&&e.name){var t={isExt:!0,isAutomaticExt:!0,name:e.name};o.push(t)}})),s&&s.results&&s.results.length>0&&s.results[0]&&s.results[0].attributes&&s.results[0].attributes.map((function(e){if(e.name.includes("ds6w:kind")&&e.value){var t={isExt:!0,isAutomaticExt:!1,name:e.value};o.push(t)}})),t(o,i)},getMaskAttributes:function(n,s){var o=this,a=new Set,r=new Map,l=0,d=[],c={},u={},h={};n.forEach((function(e){e.name&&r.set(e.name,e)}));var p=function(e,t){if(e.success){var i=t.name;t.type;if(e.mask){var p=e.mask;if(i&&i.length>0){var m=r.get(i);m||"default"!==i||(m={name:"default"}),c[m.name]||(c[m.name]={attributes:[]}),m.isBus&&(c[m.name].isType=!0),m.isRel&&(c[m.name].isType=!0),"default"===m.name&&(c[m.name].isType=!0),m.isExt&&(c[m.name].isExtension=!0,m.isAutomaticExt?c[m.name].isAutomaticExt=!0:c[m.name].isAutomaticExt=!1)}if(p&&p.indexmode_write&&p.indexmode_write.attributes&&p.indexmode_write.attributes.forEach((function(e){(a.add(e.name),i&&i.length>0&&(m&&m.isExt?u[e.name]={extension:m.name,isExt:!0}:u[e.name]={isExt:!1},m&&!c[m.name]&&(c[m.name]={attributes:[]}),m&&c[m.name].attributes.push(e.name)),e.group)&&(u[e.name].group=e.group,void 0!==h[e.group]&&void 0!==h[e.group].attributes||(h[e.group]={attributes:[]}),h[e.group].attributes.push(e.name))})),p&&p.indexmode_groups)for(var f in p.indexmode_groups)h[f]&&(h[f].NLS=p.indexmode_groups[f].NLS?p.indexmode_groups[f].NLS:f,h[f].weight=p.indexmode_groups[f].weight?p.indexmode_groups[f].weight:0)}}if((l+=1)===n.length){for(var g of a)d.push(g);o.getPredicates(n[0].name,(function(e){var t=new Map;e&&Array.isArray(e)&&e.length>0&&e.forEach((function(e){d.includes(e.uri)&&e.dimension&&t.set(e.uri,e)}));var i={maskAttributeDetails:u,listOfPredicates:d,maskGroupInfo:h,groupAttributesInfoAsPerMask:c};t.size>0&&(i.dimensionAttributes=t),s(i)}))}i&&"default"===i&&s({maskAttributeDetails:u,listOfPredicates:d,maskGroupInfo:h,groupAttributesInfoAsPerMask:c})},m=i.getServiceBySource("3dspace");if(r.size>0){t.getCancelObject();for(var f of r.keys()){var g=r.get(f),v=null;g.isBus?v="bus":g.isRel?v="rel":g.isExt&&(v="itf");var _={defService:m,name:f,type:v,indexMode:!0,onComplete:p};e.fetchMask(_)}}else{_={defService:m,name:"default",type:"bus",indexMode:!0,onComplete:p};e.fetchMask(_)}},getPredicates:function(e,i){var s={apiVersion:"R2018x",lang:t.getLanguage(),tenantId:t.getTenantID(),onComplete:function(e){e&&e.classPredicates&&e.classPredicates.length>0&&Array.isArray(e.classPredicates)&&e.classPredicates[0]&&e.classPredicates[0]&&"object"==typeof e.classPredicates[0]&&e.classPredicates[0].vocabularyPredicateInfo?i(e.classPredicates[0].vocabularyPredicateInfo):i([])},onFailure:function(e){console.log(e),i([])}};n.getPropertiesForClass(e,s)}}})),define("DS/EditPropWidget/facets/DomainProperties/DomainPropertiesController",["DS/EditPropWidget/facets/Properties/EditPropController","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropWidget/utils/DomainPropertiesUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l,d,c,u){"use strict";const h={"ds6w:label":1,"ds6w:resourceType":2,"ds6w:type":3,"ds6w:identifier":4,"ds6w:revision":5,"ds6w:description":6,"ds6w:created":7,"ds6w:modified":8,"ds6w:responsible":9,"ds6w:status":10};let p=e.extend({init:function(e){this._parent.apply(this,arguments),this.getListHandle={handle:null},this._groupedAttributes={},this.facetInitOptions=e,this._forbiddenAttributes=new Set(["ds6w:i3dx","previewURL","icon"])},updateFacet:function(){this.onRefresh()},onRefresh:function(){this.loadModels(this.getModel(),void 0)},loadModels:function(e,n){let a=this;this.showLoader();let r=e;if(r){let l=i.getServiceForModel(e);if(e instanceof t||(r=new t(e)),n&&!1===n.loadModel)this.setModel(r),this.trackPropInitUXEvent(this.getModel(),this.getTabId()),this.editPropertiesUI.initData([this.getModel()],{properties:!0});else{let t=!1;a._cancelListRequest();let i=s.getCancelObject();a.getListHandle.handle=i;let n={handleRequest:{handle:i},modelList:[r],tenant:a.getTenantFromModel(r),onComplete:function(n){if(a.hideLoader(),!1===t&&!i.isCancelled()){t=!0,console.log("Ajax call for Domain Properties is success"),a.getListHandle.handle=null;let i=e.get("i3dx"),s=c.getDomainFromI3dx(i),o=!1,d="",h="";if(s){let e=c.getServiceAndRelativePathFromDictionary(s.toUpperCase());e&&(o=!!e.propertiesread,e.propertiesread?(d=e.propertiesread.service,h=e.propertiesread.relativePath):e.fetchforproperties&&(d=e.fetchforproperties.service,h=e.fetchforproperties.relativePath))}if(o)if(n&&n.info&&"200"==n.info.statuscode){let e={},t=[],i={};if(n){if(n.data&&Array.isArray(n.data)&&n.data.length>0){Object.keys(n.data[0]).map((s=>{if(null==n.data[0][s]&&(n.data[0][s]=""),"object"==typeof n.data[0][s]&&n.data[0][s].hasOwnProperty("value")?e[s]=[n.data[0][s].value]:e[s]=[n.data[0][s]],i[s]=!0,s.indexOf(".")>0){if(s.startsWith("ds6")){let e=s.split(":");e.length>1&&e[1]&&(s=e[1])}let e=s.split(".");e.length>=0&&t.push(e[0])}}))}n.layout&&n.layout.groups&&Array.isArray(n.layout.groups)&&n.layout.groups.map((t=>{e[t.groupname]=[t.groupname]}))}a._availableAttrs=i;let s=new Promise((function(e,t){n&&n.data&&Array.isArray(n.data)&&n.data.length>0&&n.data[0]&&n.data[0]["ds6w:type"]?a.getPredicates(n.data[0]["ds6w:type"],(function(){e(1)})):e({})})),o=new Promise((function(t,i){e&&Object.keys(e).length>0?a.getValuesNls(e,{tenant:a.getTenantFromModel(r),service:l,onComplete:function(i){t({answer:i,attrPredicateForLookup:e})}}):t({})})),d=new Promise((function(e,t){if(n&&n.data&&Array.isArray(n.data)&&n.data.length>0){let t=Object.keys(n.data[0]);a.getElementsNls(t,{tenant:a.getTenantFromModel(r),onComplete:function(t){e(t)}})}else e({})})),c=new Promise((function(e,i){t&&Array.isArray(t)&&t.length>0?a.getPredicatesForSubTypeOrExt(t,(function(){e(1)})):e({})}));Promise.all([s,o,d,c]).then((function(e){let t=e[1],i=new Map,s=e[2],o=new Map,r=new Map,l=null;if(t&&t.attrPredicateForLookup&&(l=t.attrPredicateForLookup),t&&t.answer){let e=t.answer,n=t.attrPredicateForLookup;for(let t in e)i.set(t,e[t][n[t][0]])}if(s){let e=s.vocabularyElementNLSInfo;e&&Array.isArray(e)&&e.forEach((e=>{let t=e.uri,i="";if(l)if(t.startsWith("ds6w:")||t.startsWith("ds6wg:"))if(l[t])i=t;else{let e=t.split(":");e.length>1&&l[e[1]]&&(i=e[1])}else l[t]&&(i=t);i&&(o.set(i,e.nlsName),r.set(i,e.dataType))}))}a._valuesNls=i,a._attrNls=o,a._attrDataTypes=r,a._onCompleteOfPropReadWSAndFedDictionaryLoading(n)}))}else{let e=u.get("Error Server"),t="propertiesread_webservice_failed";n&&n.error&&Array.isArray(n.error)&&n.error.length>0&&(n.error[0]&&n.error[0].detail&&(e=n.error[0].detail),n.error[0]&&n.error[0].type&&(t=n.error[0].type)),a._setError(e,"error",t)}else a._onCompleteLoadModel(n);let p={domain:s,service:d,relativePath:h};a.trackPropInitUXEvent(a.getModel(),a.getTabId(),p)}}};o.getListOfAttributes(n)}}else this.editPropertiesUI.clear(),this._onCompleteLoadModel({results:[]})},_onCompleteOfPropReadWSAndFedDictionaryLoading:function(e){let t=this,i=e.optionsUI;i?(void 0!==i.showSections&&t.editPropertiesUI.setOption("showSections",!0===i.showSections),void 0!==i.autoExpand&&t.editPropertiesUI.setOption("sectionAutoexpand",!0===i.autoExpand)):(t.editPropertiesUI.setOption("showSections",!0),t.editPropertiesUI.setOption("sectionAutoexpand",!1));let n={},s=(t._manageNotificationOrErrorFromResponse(e),t._buildFromDomainPropReadResponse(e,n)),o=s.modifyAccess&&!s.allAttributeAreRO&&(!t.isReadOnly()||"false"===t.isReadOnly());!0===o&&(t.editPropertiesUI.switchComponentMode(!o),t.updateReadWriteAccess(o));let r=t.getModel(),l=s.success&&r?[r]:[];this.editPropertiesUI.setAccordionProperties(n),t.editPropertiesUI.initData(l,{edition:a.FORCE_DEFAULT,properties:!0})},_manageNotificationOrErrorFromResponse:function(e){return null},_buildFromDomainPropReadResponse:function(e,i){let n=this,s={modifyAccess:!0,success:!1,allAttributeAreRO:!0};if(e&&e.info&&!0===e.info.success){s.modifyAccess=!0===e.info.modifyAccess,s.success=!0===e.info.success;let i=e.data,o=i?i.length:0;for(let a=0;a<o;a++){let o=i[a],r=n._getObjectId(o),l=n.getModel(r);l||(l=new t({i3dx:r})),l.clearChangedValue();let d=n._fillModelFromServer(o,l,e);s.allAttributeAreRO=s.allAttributeAreRO&&d.allAttributeAreRO}n.editPropertiesUI._ManageValidButton()}return s},_getObjectId:function(e){return e["ds6w:i3dx"]},_fillModelFromServer:function(e,t,i){let n={allAttributeAreRO:!0},s={},o=t.getChangedValues();e.previewURL&&(s.previewUrl=e.previewURL),e.icon&&(s.type_icon_url=e.icon),n.allAttributeAreRO=this._createAttributesAndAddToModel(e,t,s,i);let a={};for(var r in o)s[r]||(a[r]=o[r]);return t.set(s),t.clearChangedValue(),t.setChangedValues(a),this.setModel(t),n},_createAttributesAndAddToModel:function(e,t,i,n){let o=this,a=!0;i||(i={});let l=["ds6w:responsible","ds6w:modified","ds6w:label"],d=o._forbiddenAttributes,c=Object.keys(h),u=[],p=Object.keys(h).length+Object.keys(e).length,m={};n&&n.schema&&Array.isArray(n.schema)&&n.schema.map((e=>m[`${e.name}`]=e));for(let n in e){let s=n;if(d.has(s))continue;h[s]||u.push(s);let r=o._createNewAttribute(s,e[s],m,t);if(null!=r){"ds6w:type"===r.get("_identifier")&&i&&i.type_icon_url&&r.set("urlIcon",i.type_icon_url);let e=l.indexOf(s);!t.isMergedModel()&&e>=0&&(0==e?r.set("sectionIdentityCard","ownerName"):1==e?r.set("sectionIdentityCard","date"):r.set("sectionIdentityCard","title")),h[r.get("_identifier")]?r.set("positionUI",h[r.get("_identifier")]+""):(r.set("positionUI",p+""),p--),a=a&&!0===r.get("readOnly"),i[s]=r}}let f=[];if(n&&n.layout&&n.layout&&Array.isArray(n.layout)&&n.layout.length>0&&n.layout[0]&&n.layout[0].maingroup){n.layout[0].maingroup.map((e=>{let t=e.position,i=e.attributes;if(t)if("top"===t){for(let e=i.length-1;e>=0;e--){let t=i[e];c.unshift(t),f.push(t)}}else if("bottom"===t){let e=i.length;for(let t=0;t<e;t++){let e=i[t];c.push(e),f.push(e)}}else{let n=e.reference,s=!1;"after"===t&&(s=!0);let o=c.indexOf(n),a=s?o+1:o;for(let e=i.length-1;e>=0;e--){let t=i[e];c.splice(a,0,t),f.push(t)}}else i.map((e=>{f.push(e),c.push(e)}))}));let e=new Set(c);f.map((t=>!e.has(t)&&c.push(t))),e=new Set(c),u=u.filter((t=>!e.has(t)));for(let e in i){let t=i[e];if(t instanceof r){let i=c.indexOf(e);t.set("positionUI",i+1)}}}let g={},v={};if(n&&n.layout&&n.layout&&Array.isArray(n.layout)&&n.layout.length>0&&n.layout[0]&&n.layout[0].groups){let e=Number.MAX_SAFE_INTEGER-100;n.layout[0].groups.forEach((t=>{g[t.groupname]=t;let n=t.grouplabel;n||(n=o._valuesNls.get(t.groupname),n=n||t.groupname),t.grouplabel=n,t.grouptype&&(v[t.grouptype]?v[t.grouptype].push(t.groupname):v[t.grouptype]=[t.groupname]);let s=t.attributes;s&&Array.isArray(s)&&(s.forEach(((s,o)=>{if(i[s]){let a=u.indexOf(s);a>=0&&u.splice(a,1);let r=i[s];r.set("group",t.groupname),r.set("extension",t.groupname),r.set("facet",t.groupname),r.set("groupNLS",n),r.set("groupWeight",e),r.set("positionUI",o+1),e-=10}})),o._groupedAttributes[t.groupname]=s)}))}o._groupsInfo=g;let _=[];return n&&n.layout&&n.layout&&Array.isArray(n.layout)&&n.layout.length>0&&n.layout[0]&&n.layout[0].facets&&(n.layout[0].facets.forEach(((e,t)=>{let n=e.facetlabel;if(!n){if(e.groups&&Array.isArray(e.groups)&&e.groups.length>0){let t=e.groups[0];o._groupsInfo[t]&&o._groupsInfo[t].grouplabel&&o._groupsInfo[t].grouplabel&&(n=o._groupsInfo[t].grouplabel)}n||(n=e.facetname)}let s={require:"DS/EditPropWidget/facets/DomainProperties/RuntimeFacetController",facet:{name:e.facetname,text:n,icon:e.faceticon},options:o.facetInitOptions};if(_.push(s),e.attributes&&e.attributes.forEach((function(t,n){if(i[t]){let s=u.indexOf(t);s>=0&&u.splice(s,1);let o=i[t];o.set("runtimefacet",e.facetname),o.set("positionUI",n+1)}})),e.groups&&Array.isArray(e.groups)){let t=Number.MAX_SAFE_INTEGER-100;e.groups.forEach((function(n){let s=o._groupedAttributes[n];s&&Array.isArray(s)&&s.forEach((function(n){if(i[n]){let s=i[n];s.set("groupWeight",t),s.set("runtimefacet",e.facetname),t-=10}}))}))}if(e.grouptype){let t=v[e.grouptype],n=Number.MAX_SAFE_INTEGER-1e3;t.map((t=>{let s=o._groupedAttributes[t];s&&Array.isArray(s)&&s.forEach((function(t){if(i[t]){let s=i[t];s.set("groupWeight",n),s.set("runtimefacet",e.facetname),n-=100}}))}))}})),_&&_.length>0&&o._loadRuntimeFacet(_)),u.map((e=>{i[e]&&delete i[e]})),s.isReplayedODT()&&(o.domainAttrsOrderingAtDataSec=u),a},_createNewAttribute:function(e,t,i,n){let s=this,o=s.predicatesMap.get(e);o||(o={});let a=i&&i[e];if(a||(a={}),!1===a.display)return null;let l=new r;l.set("_identifier",e),l.set("path",e);let c="string";if(a&&a.datatype)c=a.datatype;else if(s._attrDataTypes.get(e))c=s._attrDataTypes.get(e);else if(o&&o.range&&o.range.dataTypes&&Array.isArray(o.range.dataTypes)&&o.range.dataTypes.length>0&&o.range.dataTypes[0]){let e=o.range.dataTypes[0];if(e.includes("#")){let t=e.split("#");t.length>1&&(c=t[1])}}l.set("type",c.toLowerCase());let h=!1;a.multiline?h=!!a.multiline:o.multiline&&(h=!!o.multiline),l.set("multiline",h);let p=!1;a.multivalue?p=!!a.multivalue:o.multivalue&&(p=!!o.multivalue),l.set("multivalue",p),l.set("valueDB",t+""),l.set("multisel",n.isMergedModel());let m=!0;a.usereditable&&(m=!!a.usereditable),l.set("readOnly",m);let f=e;a.label?f=a.label:s._attrNls.get(e)&&(f=s._attrNls.get(e)),l.set("label",f);let g=t;s._valuesNls&&s._valuesNls.get(e)&&(g=s._valuesNls.get(e)),l.set("value",g);let v=[],_=[];if(a.range&&a.range.item&&Array.isArray(a.range.item)?a.range.item.map((e=>{v.push(e.value),_.push(e.display)})):o.rangeValues&&o.rangeValues.literalInfo&&Array.isArray(o.rangeValues.literalInfo)&&o.rangeValues.literalInfo.map((e=>{v.push(e.value),_.push(e.nlsValue)})),l.set("authorizedValues",v),l.set("authorizedValuesNLS",_.length>0?_:v),l.set("mandatory",!!a.ismandatory),l.set("forbiddenChar",a.forbiddenchar?a.forbiddenchar:null),a.maxlength&&l.set("maxlength",parseInt(a.maxlength)),a.minvalue&&l.set("minval",parseInt(a.minvalue)),a.maxvalue&&l.set("maxval",parseInt(a.maxvalue)),l.set("masked",!1),o.dimension||a.magnitude)if(l.set("dimensionType",a.magnitude?a.magnitude:o.dimension),p){if(t&&Array.isArray(t)){let i=[],n=[],o=[],r=[];t.map((t=>{if("object"!=typeof t||t&&(!t.value||!t.unit)){let e=u.get("Wrong format of dimension attribute's value");l.setError(e,"error"),console.log("propertiesread -> format of dimension attribute's value from domain is not as per response payload contract"),s._setError(e,"error","propertiesread_webservice_failed")}t.unit&&n.push(t.unit);let c=t.value;if(i.push(c+""),s._valuesNls&&s._valuesNls.get(e)){let t=s._valuesNls.get(e);r.push(t+"")}let h=a.nlsunit;if(!h&&n){let e=l.get("dimensionType"),i=d&&d.getDimensionUnitNLSName(e.toUpperCase(),[t.unit]);i&&i.length>0&&(h=i[0])}o.push(h)})),l.set("valueDB",i),l.set("value",r.length>0?r:t),l.set("unitName",n),l.set("dimension",o.length>0?o:n)}}else{if("object"!=typeof t||t&&(!t.value||!t.unit)){let e=u.get("Wrong format of dimension attribute's value");l.setError(e,"error"),console.log("propertiesread -> format of dimension attribute's value from domain is not as per response payload contract"),s._setError(e,"error","propertiesread_webservice_failed")}let i="";t.unit&&(i=t.unit),l.set("valueDB",t.value+"");let n=t.value;s._valuesNls&&s._valuesNls.get(e)&&(n=s._valuesNls.get(e)),l.set("value",n+""),l.set("unitName",i);let o=a.nlsunit;if(!o&&i){let e=l.get("dimensionType"),t=d&&d.getDimensionUnitNLSName(e.toUpperCase(),[i]);t&&t.length>0&&(o=t[0])}l.set("dimension",o||l.get("unitName"))}return l},getPredicates:function(e,t){let i=this;i.predicatesMap||(i.predicatesMap=new Map);var n={apiVersion:"R2018x",lang:s.getLanguage(),tenantId:s.getTenantID(),onComplete:function(e){e&&e.classPredicates&&Array.isArray(e.classPredicates)&&e.classPredicates.length>0&&e.classPredicates[0]&&"object"==typeof e.classPredicates[0]&&e.classPredicates[0].vocabularyPredicateInfo&&Array.isArray(e.classPredicates[0].vocabularyPredicateInfo)&&e.classPredicates[0].vocabularyPredicateInfo.forEach((e=>{let t=e.uri,n=e.selectable;i._availableAttrs[t]?i.predicatesMap.set(t,e):i._availableAttrs[n]&&i.predicatesMap.set(n,e)})),t()},onFailure:function(e){console.log(e),t()}};l.getPropertiesForClass(e,n)},getValuesNls:function(e,t){if(e){var i={};for(var n in e)Array.isArray(e[n])&&(i[n]=[],e[n].forEach((function(s){i[n].push({value:e[n][0],source:[t.service]})})));l.getNlsOfPropertiesValuesBySource(i,{tenantId:t.tenant,serviceName:t.service,lang:s.getLanguage(),apiVersion:"R2019x",onComplete:function(e){t.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+JSON.stringify(e)),t.onComplete.call(this,e)}})}else t.onComplete.call(this,{})},getElementsNls:function(e,t){e&&e.length>0?l.getResourcesInfo(e.join(","),{tenantId:t.tenant,lang:s.getLanguage(),apiVersion:"R2018x",onComplete:function(e){t.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls of all elements"+JSON.stringify(e)),t.onComplete.call(this,e)}}):t.onComplete.call(this,null)},getTenantFromModel:function(e){var t=e?e.get("tenant"):null;return t=t||s.getTenantID()},getPredicatesForSubTypeOrExt:function(e,t){let i=this;if(e&&Array.isArray(e)){let n=e.length;e.forEach((function(e){i.getPredicates(e,(function(){n--,0===n&&t(!0)}))}))}else t(!0)}});return p})),define("DS/EditPropWidget/facets/DomainProperties/RuntimeFacetController",["DS/EditPropWidget/facets/DomainProperties/DomainPropertiesController","DS/EditPropWidget/facets/Properties/EditPropController","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel"],(function(e,t,i,n,s,o,a,r,l){"use strict";let d=e.extend({init:function(e){this._parent.apply(this,arguments),this.getListHandle={handle:null},this.initOpts=e},updateFacet:function(){this.onRefresh()},onRefresh:function(){this.loadModels(this.getModel(),void 0)},loadModels:function(e,t){let n=this,s=e;if(e){e instanceof i||(s=new i(e));let t=n._getAttributesFromPropModel(s);if(null!==t){let e={objectId:s.get("objectId"),i3dx:s.get("i3dx")},n=new i(e);n.set(t),this.editPropertiesUI.initData([n],{properties:!0})}}},_getAttributesFromPropModel:function(e){let t=this,i={},n=e&&e._attributes;if(n)for(let e in n){let s=n[e];s instanceof l&&s.get("runtimefacet")&&s.get("runtimefacet")===t.initOpts.tabId&&(i[s.get("_identifier")]=s)}return Object.keys(i).length>0?i:null}});return d})),define("DS/EditPropWidget/form/Form",["DS/EditPropWidget/models/CommonAbstract","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/facets/Properties/TweakerManager","DS/EditPropWidget/utils/AttributesUtils","DS/WidgetServices/WidgetServices","DS/WidgetServices/moveHelper/MoveHelper","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/Controls/Label","DS/EditPropWidget/models/EditPropAttributeModel","DS/WidgetServicesUI/tweakers/TweakerInfoWebUX","DS/EditPropWidget/utils/EditPropUtils","css!DS/EditPropWidget/EditPropWidget.css"],(function(e,t,i,n,s,o,a,r,l,d,c,u){var h=function(e){var i,n,s=e.get("tw_type");return s||("owner"===e.get("name")?s=t.TYPES.PERSON_WUX:"originated"===e.get("name")||"modified"===e.get("name")||"branch.originated"===e.get("name")||"branch.modified"===e.get("name")?s=t.TYPES.DATETIME_WUX:(this.propertiesWidgetUI||this.newInfraUI)&&e.authorizedValues&&0===e.authorizedValues.length&&(e.dimension||e.dimensionType)?s=t.TYPES.UNIT:(i=e.get("type"),n="string"===i||"text"===i?"string_wux":i,"integer"===i?n=t.TYPES.INTEGER_WUX:"real"===i?n=t.TYPES.NUMBER_WUX:"timestamp"===i||"date"===i||"datetime"===i?n=t.TYPES.DATE_WUX:"person"===i?n=t.TYPES.PERSON_WUX:"boolean"===i||"radiobutton"===i||"checkbox"===i?n=t.TYPES.BOOLEAN_WUX:"enum"!==i&&"listbox"!==i&&"listboxmanual"!==i&&"combobox"!==i||(n=t.TYPES.ENUM_WUX),s=n),e.set("tw_type",s)),s},p=function(e){var i,n,s=e.get("tw_type");return s||("owner"===e.get("name")?s=t.TYPES.PERSON:"originated"===e.get("name")||"modified"===e.get("name")||"branch.originated"===e.get("name")||"branch.modified"===e.get("name")?s=t.TYPES.DATETIME:(i=e.get("type"),n=i,"integer"===i?n=t.TYPES.INTEGER:"real"===i?n=t.TYPES.NUMBER:"timestamp"===i||"date"===i?n=t.TYPES.DATE:"person"===i?n=t.TYPES.PERSON:"boolean"===i||"radiobutton"===i||"checkbox"===i?n=t.TYPES.BOOLEAN:"enum"!==i&&"listbox"!==i&&"listboxmanual"!==i&&"combobox"!==i||(n=t.TYPES.ENUM),s=n),e.set("tw_type",s)),s},m=80,f="formLabel",g={},v=function(e,t,i){try{localStorage.setItem(e+"_style"+(i?"_"+i:""),JSON.stringify(t))}catch(e){console.log("Local storage full. Current form size can't be saved")}},_=function(e,t,i){var n=w(e,g[t]?g[t]:"200",t,i);return v(e,n,t),n},E=function(e,t){var i=localStorage.getItem(e+"_style"+(t?"_"+t:"")),n=null;try{(n=JSON.parse(i)).width<m&&(n.width=m)}catch(e){}return n||(n=_(e,t)),n},w=function(e,t,i,n){var s={};return s["."+e+" ."+f+(i?"."+i:"")]={width:t+"px"},s["."+e+" .resizeHandler"+(i?"."+i:"")]={left:t-10+"px"},{style:s,width:t,userAction:n}},b=function(e,t,i){var n=null;return e.forEach((function(e){var o=function(e,t){var i=E(e,t),n=e+"_style"+(t?"_"+t:"");return s.addNewStyles(n,i.style,!0),i}(e,i);t===e&&(n=o)})),n},y=e.extend({postBuildTweaker:function(){this._tweaker&&this._tweaker.postBuildUI(),this._finalizeWhenReady=!0},destroy:function(){this._parent.apply(this,arguments),this._model&&this._model.removeEvent(this._idAttr,this._manageMessageHandler)},init:function(e,t,i,n){this._parent(n),this._idAttr=i.getIdentifier(),this._model=t,this._form=e,this._tweaker=null,this._finalizeWhenReady=!1,this._manageMessageHandler=this._manageMessage.bind(this),this._unitHelperReady=!1;var s=this;s.propertiesWidgetUI=!!t.propertiesWidgetUI,s.newInfraUI=!!t.newInfraUI,!0!==n.postBuild&&this.subscribeEvt("triggerPostBuild",(function(){s.postBuildTweaker()})),this.elements.container=UWA.createElement("div",{class:"formLine s12 m12"+(i.get("width")?" l"+i.get("width"):" l12")}),this.elements.flexLine=UWA.createElement("div",{class:"flexLine"}).inject(this.elements.container);var o=this._form._sharedOptions.identifier?f+" "+this._form._sharedOptions.identifier:f,a=UWA.createElement("div",{class:o+" s12"}).inject(this.elements.flexLine),l=!0!==this.options.readOnly&&i.get("mandatory");let d=i.get("dimensionType"),m=i.get("authorizedValues"),g=!(!d||!m||0!==m.length);var v=UWA.createElement("div",{class:"attrLabel"}).inject(a),_=UWA.createElement("span",{class:"textContainer"}).inject(v);s.elements.errorIcon=UWA.createElement("span",{class:"errorIcon wux-ui-3ds wux-ui-3ds-error"}).inject(_),s.elements.errorIcon.addClassName("hide");var E=UWA.createElement("span",{text:i.get("label")}).inject(_);l&&UWA.createElement("span",{class:"mandIcon  wux-ui-3ds wux-ui-3ds-new-create"}).inject(v),UWA.is(i.tooltipInfo,"object")&&this.addHelpInfo(v,i),g&&(s.propertiesWidgetUI||s.newInfraUI)&&(this._addUnitsHelper=function(e){let t=UWA.createElement("span",{class:"DimensionUnitInfoContainer"}).inject(v);s.elements.infoContainer=t;let i=new c(this.options);i._build(this.options,(function(n){if(n){let s=u.getUnits(d);s&&s.length>0&&(i._injectData(s,this.options),n.inject(t),"function"==typeof e&&e(!0))}}))},s.newInfraUI&&s._addUnitsHelper()),E.tooltipInfos=new r({shortHelp:i.get("label"),mouseRelativePosition:!0,reshowDelay:0});var w=this._idAttr,b=UWA.createElement("div",{class:"formValue s12"}).inject(this.elements.flexLine),y=UWA.createElement("div",{class:"formTweakerContainer",id:w}).inject(b);if(!0!==this.options.readOnly){var C=new UWA.createElement("span",{class:"attribute-lineError"}).inject(b);this.elements.errorContent=C}var A=t.propertiesWidgetUI||t.webUxTweakers||t.newInfraUI?h.call(s,i):p(i),S={};this.options.readonly&&(S.readOnly=this.options.readOnly),S.postBuild=this.options.postBuild,!t.propertiesWidgetUI||t.webUxTweakers||"string"!==A&&"string_wux"!==A?S.forClickable=!1:S.forClickable=!0,this._form.tweakerManager.getTweaker(t,this._idAttr,A,S,(function(e){e.inject(y),s._tweaker=e,s._finalizeWhenReady&&s.postBuildTweaker(),s.dispatchEvent("tweakerReady:"+s._idAttr,[e]),"string"!==i.tw_type&&"string_wux"!==i.tw_type||i.multiline||s._tweaker.addEvent("enterKeyDown",(function(){t.dispatchEvent("onEnterKeyDown",[i])}));let n=i.get("visible");UWA.is(n)&&s.elements.container.toggle(!!n),s._tweaker.addEvent("valid",(function(){t.dispatchEvent("validateValue",[s._model.get(s._idAttr)])}))})),t.addEvent("onChange:"+this._idAttr,this._manageMessageHandler)},addHelpInfo(e,t){var i=this;setTimeout((()=>{i.elements.tooltip=UWA.createElement("div",{class:"helpTooltip"}).inject(e),new l({icon:"info",tooltipInfos:new r({title:t.tooltipInfo.title,shortHelp:t.tooltipInfo.shortHelp,longHelp:t.tooltipInfo.longHelp,moreHelpCB:t.tooltipInfo.moreHelpCB})}).inject(i.elements.tooltip)}))},showNotificationOnField:function(e){this.elements.errorContent&&this.elements.errorContent.setText(e.message?e.message:""),e.message&&"error"===e.type?this.elements.errorIcon.removeClassName("hide"):this.elements.errorIcon.addClassName("hide")},_manageMessage:function(){var e=this._model.get(this._idAttr);this.propertiesWidgetUI=!!this._model.propertiesWidgetUI,this.newInfraUI=!!this._model.newInfraUI;var t=this._model.webUxTweakers||this._model.propertiesWidgetUI||this._model.newInfraUI?h.call(this,e):p(e);e.validationFunction=this._form.tweakerManager.getValidationFunction(t);var i=n.validateAttributes(this._model,[e]);e&&(e.error&&UWA.is(e.error.message)?this.showNotificationOnField(e.error):e&&e.uxBLerror?this.showNotificationOnField(e.uxBLerror):this.showNotificationOnField(e.error)),this._tweaker&&!0!==this._tweaker.underEdition||this.publishEvt("onNotifications",i)},focusTweakerElement:function(){if(this._tweaker){var e=this._tweaker;e&&UWA.is(e.focus,"function")&&e.focus()}else this.addEventOnce("tweakerReady:"+this._idAttr,(function(e){e&&UWA.is(e.focus,"function")&&e.focus()}))}}),C=null,A=null,S=e.extend({defaultOptions:{width:12,label:null,classname:"large",postBuild:!0},_sharedOptions:null,isReadOnly:function(){var e=this._sharedOptions;return!e||!0===e.readOnly},init:function(e,t){this._parent(e),this._sharedOptions=t;var n=this;this.elements.container=UWA.createElement("fieldset",{class:"formContainer s12 m12 l"+this.options.width}),this.fields=[],this.resizeHandlerClass=this._sharedOptions.identifier?"resizeHandler "+this._sharedOptions.identifier:"resizeHandler";var a=UWA.createElement("div",{class:this.resizeHandlerClass}).inject(this.elements.container),r=null,l=null;this.elements.moveHelpers=new o({element:a,events:{startMove:function(){l=null;var e=E(n.getClassResize(),n._sharedOptions.identifier);r=e.width},move:function(e){if(l=null,e.diff.x){var t=r-e.diff.x;t<m?t=m:n.maxColWidth&&t>n.maxColWidth&&(t=n.maxColWidth);var i=n._sharedOptions.identifier;l=w(n.getClassResize(),t,i),s.addNewStyles(n.getClassResize()+"_style"+(i?"_"+i:""),l.style,!0)}},endMove:function(){if(l&&l.width){l.userAction=!0;v(n.getClassResize(),l,n._sharedOptions.identifier);n._publishResizeCell(l)}l=null}}}),e.label&&UWA.createElement("legend",{text:e.label}).inject(this.elements.container),this.elements.content=UWA.createElement("div",{class:"formContent"}).inject(this.elements.container),this.subscribeEvt("editionSwitched",(function(e){n.switchTweakersStatus()})),this.subscribeEvt("innerSwitch",(function(e){if(n.options.sizeClassname=e,A!==this.index){A=this.index;var t=E(e,n._sharedOptions.identifier);n._publishResizeCell(t)}})),this.subscribeEvt("resetDisplay",(function(){C!==this.index&&(C=this.index,n.resetDisplay())})),this.addEvent("resetDisplay1",(function(){var e=n.elements.content.getSize();if(n.idealLabelWidth||n.updateResizeLimit(),e.width){n.maxColWidth=e.width-287;var t=E(n.getClassResize(),n._sharedOptions.identifier);t&&t.width&&t.userAction?(g[n._sharedOptions.identifier]=t.width,n.maxColWidth<m?(g[n._sharedOptions.identifier]=m,n.resetDisplay(["medium","large"],t.userAction)):e.width-t.width<287&&(g[n._sharedOptions.identifier]=n.maxColWidth,n.resetDisplay(["medium","large"],t.userAction))):(g[n._sharedOptions.identifier]=n.idealLabelWidth+1,n.resetDisplay(["medium","large"]))}})),this.tweakerManager=new i({editable:!0===this._sharedOptions.editMode,onNotification:function(e){n.publishEvt("onNotifications",e)}},this._sharedOptions),this._manageEditionStatus(),!0===this.options.automaticCSS&&this.updateCSS()},updateCSS:function(){var e=b(this.options.classnames,this.options.sizeClassname,this._sharedOptions.identifier);this._publishResizeCell(e)},_publishResizeCell:function(e){var t=null;e&&((t=function(e,t,i){var n={};return e.forEach((function(e){var s=E(e,i);t===e&&(s.current=!0),n[e]=s})),n}(this.options.classnames,this.options.sizeClassname,this._sharedOptions.identifier)).userAction=e.userAction),this.publishEvt("onResizeCells",t)},updateResizeLimit:function(){var e=this;e.fields&&e.fields.length&&(e.idealLabelWidth=0,e.fields.forEach((function(t){t.elements.flexLine.getElementsByClassName("formLabel")[0].setStyles({width:"auto"});var i=t.elements.flexLine.getElementsByClassName("formLabel")[0].getSize();i&&i.width&&e.idealLabelWidth<i.width&&(e.idealLabelWidth=i.width),t.elements.flexLine.getElementsByClassName("formLabel")[0].setStyles({width:""})})))},resetDisplay:function(e,t){var i=e||this.options.classnames;i||(i=[this.getClassResize()]);var n=this;i.forEach((function(e){var i=_(e,n._sharedOptions.identifier,t),o=e+"_style"+(n._sharedOptions.identifier?"_"+n._sharedOptions.identifier:"");s.addNewStyles(o,i.style,!0)})),this._publishResizeCell(null)},getClassResize:function(){return this.options.sizeClassname},_manageEditionStatus:function(){var e=!1===this.isReadOnly()&&!0===this._sharedOptions.editMode;e?this.elements.container.addClassName("underEdition"):this.elements.container.removeClassName("underEdition"),this.fields&&Array.isArray(this.fields)&&(!0===e?this.fields.forEach((function(e){!1===e._unitHelperReady&&"function"==typeof e._addUnitsHelper&&e._addUnitsHelper((function(t){t&&(e._unitHelperReady=!0)})),!0===e._unitHelperReady&&e.elements&&e.elements.infoContainer&&e.elements.infoContainer.hasClassName("hide")&&e.elements.infoContainer.removeClassName("hide")})):this.fields.forEach((function(e){e.elements&&e.elements.infoContainer&&!e.elements.infoContainer.hasClassName("hide")&&e.elements.infoContainer.addClassName("hide")}))),this.tweakerManager.switchMode(e)},destroy:function(){this.clear(),this.fields.forEach((function(e){e.destroy()})),this._parent.apply(this,arguments)},switchTweakersStatus:function(){this._manageEditionStatus()},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},clear:function(){this._clearAllFields(),this.elements.content.empty()},setModel:function(e,t){var i=this;this.clear();var n=null!=t&&t.attrs?t.attrs:e.getAllAttributes(),o=[];for(var a in n){var r=n[a];r instanceof d&&o.push(r)}o.sort((function(e,t){return s.compareValue(t.get("positionUI"),e.get("positionUI"))})),o.forEach((function(t){i._addLine(e,t)}))},_addLine:function(e,t){this.options.readOnly=this.isReadOnly();var i=new y(this,e,t,this.options);this.fields.push(i),i.inject(this.elements.content)},_rebuildLine:function(e,t){this.options.readOnly=this.isReadOnly(),this.tweakerManager._removeEvents(e._idAttr);var i=new y(this,e._model,e._model.get(e._idAttr),this.options);return this.fields.splice(t,0,i),this.elements.content.replaceChild(i.getContent(),e.getContent()),i},toggleLineById:function(e,t){if(this.fields){var i=this.fields.find((t=>t._idAttr===e));if(i)return i.getContent().toggle(t),!0}},disableInputFields:function(e=!0){this.fields&&this.fields.forEach((t=>{UWA.is(t._tweaker.disableUserInput,"function")&&t._tweaker.disableUserInput(e)}))},focusLine:function(e){this.fields[e].focusTweakerElement()},updateField:function(e,t){var i=this;this.fields&&Object.keys(e).forEach((n=>{var s=e[n];if(s){let u=i.fields.findIndex((e=>e._idAttr===n||e._model.get(e._idAttr).name===n));var o=i.fields[u];if(o){var a=o._model.get(o._idAttr);if(a){if(UWA.is(s.readOnly)&&(a.set("readOnly",s.readOnly),o._tweaker.options.readOnly=s.readOnly,o._tweaker.switchMode(!s.readOnly)),UWA.is(s.authorizedValues)&&(a.set("authorizedValues",s.authorizedValues),a.set("authorizedValuesNLS",s.authorizedValuesNLS?s.authorizedValuesNLS:s.authorizedValues),UWA.is(s.value)&&s.forceValue&&(a.set("value",s.value),a.set("valueDB",s.value)),o=i._rebuildLine(o,u)),UWA.is(s.value)){var r=a.get("authorizedValues");if(!UWA.is(r)||!r.length||r.includes(s.value)){a.set("value",s.value),a.set("valueDB",s.value),UWA.is(s.unitName)&&(a.set("unitName",s.unitName),a.set("dimension",s.dimension)),o._model.set(a.getIdentifier(),a,{silent:!0});var l=o._model.getChangedValues();if(l||(l={}),l[a.getIdentifier()]=a,o._model.setChangedValues(l),o._model.isMergedModel())o=i._rebuildLine(o,u);else{var d=o._form.tweakerManager._getValueForTweaker(a.tw_type,a);o._tweaker.setValue(d)}}}UWA.is(s.disable)&&(a.set("disable",s.disable),o._tweaker.disableUserInput(s.disable)),UWA.is(s.visible)&&(a.set("visible",s.visible),o.getContent().toggle(s.visible)),UWA.is(s.notif,"object")&&UWA.is(s.notif.sev,"number")&&(1==s.notif.sev?a.setUXBLError(s.notif.msg,"error"):a.resetUXBLError(),o._manageMessage()),UWA.is(s.error,"object")&&s.error.msg&&o.showNotificationOnField({type:"error",message:s.error.msg})}}else if(t){var c=t.getAttributeFromField("path",n)[0];c&&(c.set("valueDB",e.value),t.set(e.name,c,!1))}}}))}});return S})),define("DS/EditPropWidget/form/FormOrganizer",["DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/models/EditPropAttributeModel","DS/WidgetServices/WidgetServices","DS/EditPropWidget/form/Form"],(function(e,t,i,n){var s=!1;"undefined"!=typeof dscef&&(s=dscef.isA2X);var o=e.extend({_sharedOptions:null,init:function(e,t){this._parent(e),this._display=null,this._sharedOptions=t,this._forms=[],this.elements.container=UWA.createElement("div",{class:"formOrganizer "+(this.options.className?this.options.className:"")})},destroy:function(){this.clear(),this._parent.apply(this,arguments)},clear:function(){this._forms.forEach((function(e){e.destroy()})),this._forms=[]},_callOnForms:function(e,t){this._forms.forEach((function(i){i[e].apply(i,t)}))},setModel:function(e,t){var i=e.getAllAttributes();this.setAttributes(e,i,t)},setAttributes:function(e,o,a){var r=this;this.clear();var l={},d=[];for(var c in o){var u=o[c];if(u instanceof t&&!0!==u.isTransient){var h=u.get("form");h||(h="DSDefault");var p=l[h];if(!p){var m=a?a[h]:null;p={list:[],name:h},m&&(p.group=m,void 0!==m.position&&(p.position=m.position)),d.push(p),l[h]=p}p.list.push(u)}}if(d.sort((function(e,t){n=null;var n=void 0===e.position&&void 0!==t.position?1:null;return n=null===(n=null===(n=null===n&&void 0===t.position&&void 0!==e.position?-1:n)&&void 0!==t.position&&void 0!==e.position?e.position-t.position:n)?i.compareValue(t.name,e.name):n})),!s){var f=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_buildForm:"+f):window.top.performance.mark("start_buildForm:"+f)}d.forEach((function(t){var i=UWA.clone(r.options);if(t.group)for(var s in t.group)i[s]=t.group[s];i.automaticCSS=!1;var o=new n(i,r._sharedOptions);o.setModel(e,{attrs:t.list}),o.inject(r.elements.container),r._forms.push(o)})),r._forms.length>0&&r._forms[0].updateCSS(),s||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_buildForm:"+f):window.top.performance.mark("end_buildForm:"+f))},focusLine:function(e,t){var i=this;setTimeout((function(){i._forms[e].focusLine(t)}),0)},toggleFormLine:function(e,t){this._forms&&this._forms.forEach((function(i){i.toggleLineById(e,t)}))},updateFormLine:function(e,t){this._forms&&this._forms.forEach((function(i){i.updateField(e,t)}))},disableInputFields:function(e){this._forms&&this._forms.forEach((function(t){t.disableInputFields(e)}))}});return o})),define("DS/EditPropWidget/form/FormSections",["DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/form/FormOrganizer","DS/EditPropWidget/comm/EventManager","DS/WidgetServices/WidgetServices","DS/UIKIT/Accordion","DS/Controls/Accordeon","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l){var d=r.ACCORDION.ATTRIBUTES,c=l.get("accordion_attributes"),u=l.get("accordion_parameters"),h=!1;"undefined"!=typeof dscef&&(h=dscef.isA2X);var p=e.extend({_sharedOptions:null,defaultOptions:{showSections:!0,sizeClassname:"large"},init:function(e,t){var i=this;this._parent.apply(this,arguments),this.options.classnames=["large","medium","small"],this.openedExpanderItemIndex=[],this._sharedOptions=t,this.elements.accordion=new a({items:[],style:"simple",exclusive:!1}),this.elements.accordion.getContent().addEventListener("expand",(function(e){n.publish("onTableOpened",e.options.expanderTarget.domId);var t={expanderItem:e,action:"opened"};i.getIndexesOfOpenedOrSelectedAccordeonItems(t)})),this.elements.accordion.getContent().addEventListener("collapse",(function(e){var t={expanderItem:e,action:"closed"};i.getIndexesOfOpenedOrSelectedAccordeonItems(t)})),this.elements.container=UWA.createElement("div",{class:this._getDefaultClassname()+" "+this.options.sizeClassname}),this.elements.container.addEvent("resize",(function(){console.log("resize section")})),this.elements.accordion.inject(this.elements.container),this.subscribeEvt("switchDisplay",(function(e){i._switchDisplay(e)||i.publishEvt("innerSwitch",i.options.sizeClassname)})),this.subscribeEvt("switchWrap",(function(){i._switchWrap()})),this.elements._organizers={},this._accordionProperties=[],this._openedSections=[d]},_switchWrap:function(){this.options.titleWrap?this.elements.container.removeClassName("formWrap"):this.elements.container.addClassName("formWrap"),this.options.titleWrap=!this.options.titleWrap},_getDefaultClassname:function(){var e="";return s.isTouchDevice()&&(e="touchDevice "),!0===this.options.titleWrap&&(e+="formWrap"),"formSections "+e},_switchDisplay:function(e){var t=this._display===e;return t||(this._display=e,this._checkSize()),t},_checkSize:function(){var e=this.elements.container.getSize().width,t=this._getDefaultClassname();(null===this._display&&e<500||"s"===this._display)&&(this.options.sizeClassname="small"),(null===this._display&&e<1e3&&e>500||"m"===this._display)&&(this.options.sizeClassname="medium"),(null===this._display&&e>1e3||"l"===this._display)&&(this.options.sizeClassname="large"),t+=this.options.sizeClassname,this.elements.container.className=t},inject:function(){var e=this;this._parent.apply(this,arguments),setTimeout((function(){e._checkSize()}))},getOrganizers:function(){return this.elements._organizers},setAccordionProperties:function(e){this._accordionProperties=e},_callOnOrganizers:function(e,t){for(var i in this.elements._organizers){var n=this.elements._organizers[i];n[e].apply(n,t)}},openSections:function(e){var t=this;e.forEach((function(e){t.openSection(e)}))},openSection:function(e){var t=this.findExpanderIndexFromId(e);t>=0&&this.elements.accordion.expandItem(t)},destroy:function(){this.clear(),this._parent.apply(this,arguments)},clear:function(){this.reset()},setModel:function(e,i,n){var o=this;this.clear(),this._model=e,this._groups=i;var a=e.getAllAttributes(),r={},l=[];for(var p in a){var m=a[p];if(m instanceof t&&!0!==m.isTransient){var f=d;if(n&&n.tabId&&m.get("runtimefacet")&&n.tabId!==m.get("runtimefacet"))continue;var g=m.get("facet"),v=m.get("section"),_=m.get("extension");g=g||v,(o.options.showSections||g===u)&&(f=g||d);var E=r[f];if(!E){var w=o._accordionProperties[f];if(!((w=w||{})&&w.name&&w.nameNLS&&w.icon)){var b=o._accordionProperties[_];b&&(w.icon=b.icon),w.name=f,w.nameNLS=v||(f===d?c:f)}o._accordionProperties[f]=w,"Default"!==m.group&&(w.name=m.group,w.nameNLS=m.groupNLS,w.weight=m.groupWeight),w.weight||(w.weight=0),E={list:[],name:f,section:w},l.push(E),r[f]=E}E.list.push(m)}}if(l.sort((function(e,t){var i=e.section.weight===t.section.weight?null:e.section.weight<t.section.weight?1:-1;return i=null===i?s.compareValue(t.name,e.name):i})),!h){var y=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_buildSections:"+y):window.top.performance.mark("start_buildSections:"+y)}l.forEach((function(e){o.addSection(e)})),h||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_buildSections:"+y):window.top.performance.mark("end_buildSections:"+y)),this.openSections(this._openedSections)},addSection:function(e,t){var i=e.section,n=i,s=i;if("object"==typeof i&&(n=i.name),t){var o=this.findExpanderIndexFromId(n);if(!!this.elements.accordion.getExpanderFromIndex(o))return}var a=this._accordionProperties[n],r=null;a&&(t||a.nameNLS&&(s=a.nameNLS),a.icon&&(r="classif"===a.icon?UWA.createElement("span",{class:"fonticon fonticon-flow-tree",title:l.get("EP_icon_classification")}):UWA.createElement("img",{src:a.icon,width:"10px"})));var d=UWA.createElement("span",{text:s});r&&r.inject(d);var c=s?s.replace(/ /g,"_"):"";this._addSection({expandedFlag:s!==u&&this.options.sectionAutoexpand,name:n,attrs:e.list,title:d,orgClassName:"formSection_"+c})},reset:function(){for(var e in this.elements._organizers){var t=this.elements._organizers[e];t.remove(),t.destroy(),delete this.elements._organizers[e];var i=this.findExpanderIndexFromId(e);this.elements.accordion.deleteItem(i)}},_addSection:function(e){if(e&&e.name){var t=e.name,n=this.elements._organizers[t];if(!n){var s=UWA.clone(this.options);s.className=e.orgClassName,n=new i(s,this._sharedOptions),this.elements._organizers[t]=n,e.content=n.getContent();var o=this.elements.accordion.addItem(e),a=this.elements.accordion.getExpanderFromIndex(o);a.domId=e.name,e.title&&e.title.textContent&&(a.header=e.title.textContent)}n.setAttributes(this._model,e.attrs,this._groups)}this._manageAccordionVisibility()},toggleFormOrgLine:function(e,t){var i=this.elements._organizers;if(i)for(var n in i){i[n].toggleFormLine(e,t)}},updateFormOrganizer:function(e,t){var i=this.elements._organizers;if(i)for(var n in i){i[n].updateFormLine(e,t)}},disableInputFields:function(e){var t=this.elements._organizers;if(t)for(var i in t){t[i].disableInputFields(e)}},_manageAccordionVisibility:function(){this.elements.accordion.items.length<=1?this._hideAccordion():2==this.elements.accordion.items.length&&this._showAccordion()},_hideAccordion:function(){var e=this.elements.accordion.getExpanderFromIndex(0);if(e){var t=this.elements.accordion.elements.container.parentElement,i=this.elements._organizers[e.domId];t&&i.inject(t)}this.elements.accordion.hide()},_showAccordion:function(){var e=this.elements.accordion.getExpanderFromIndex(0);e&&this.elements._organizers[e.domId].inject(e.elements.bodyContainer);this.elements.accordion.show()},findExpanderIndexFromId:function(e){for(var t=0;t<this.elements.accordion._expanderItems.length;t++)if(this.elements.accordion._expanderItems[t].domId===e)return t;return-1},getIndexesOfOpenedOrSelectedAccordeonItems:function(e){var t=this,i=e.expanderItem.options.expanderTarget.domId,n=e.action;if("opened"===n){for(var s=0;s<t._openedSections.length;s++)if(i&&t._openedSections[s]===i)return;i&&t._openedSections.push(i)}else if("closed"===n){var o=t._openedSections.filter((e=>e!==i));t._openedSections=o}}});return p})),define("DS/EditPropWidget/facets/Properties/Properties",["UWA/Class","DS/EditPropWidget/models/CommonAbstract","UWA/Json","UWA/Array","DS/WidgetServices/WidgetServices","DS/EditPropWidget/form/FormSections","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/facets/Properties/EditPropBase","DS/EditPropWidget/facets/Properties/PropertiesUIController","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/WidgetServicesUI/tweakers/TweakerWUXButton","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l,d,c,u,h,p,m,f){"use strict";f.get("accordion_attributes"),f.get("accordion_parameters");var g=!1;"undefined"!=typeof dscef&&(g=dscef.isA2X),g||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.perfoIncrem:window.top.perfoIncrem=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.perfoIncrem?window.dsDashboardWindow.top.perfoIncrem:window.top.perfoIncrem?window.top.perfoIncrem:0);var v=function(e){Date.now()},_=function(){this._switchEditionMode(!0)},E=function(){this._firstModel&&this.dispatchEvent("onTitleChanged",this._firstModel.get("label"))},w=function(){this._ManageValidButton()},b=function(e){this.runClientBL(e)},y=e.extend(t,r,{_previousScrollerPosition:null,defaultOptions:{setRefreshButton:!1,setValidButton:!0,setCloseButton:!0,setEditButton:!1,showTopBar:!0,editMode:!1,showSections:!0,sectionAutoexpand:!1,readOnly:!0,scroller:!0,displayType:d.STANDARD,updateSession:!1},init:function(e){require(["DS/TransientWidget/TransientWidget"]),this._parent.apply(this,arguments),this.wiwListModels=null,this.handlerTouchEnd=v.bind(this),this.handlerDblClick=null,this.handlerAttributeChanged=w.bind(this),this.handlerLabelChanged=E.bind(this),this.handlerValidateAttribute=b.bind(this),this._firstModel=null,this._previousScrollerPosition=null,this.lastPointedTableCellObj=null,this._sharedOptions.editMode=!0===e.editMode,this._sharedOptions.identifier=e.identifier,e.webUxTweakers&&(this.webUxTweakers=e.webUxTweakers),e.propertiesWidgetUI&&(this.propertiesWidgetUI=e.propertiesWidgetUI),e.newInfraUI&&(this.newInfraUI=e.newInfraUI),this.elements.UIController=new l([]),this.isReadOnly=this.isReadOnly();this.subscribeEvt("onResizeCells",this._onCellResized.bind(this)),this.subscribeEvt("onNotifications",(function(e){})),this.initUI()},_onCellResized:function(e){var t=null,i=!1;if(e){var n=e.medium;i=!0!==(t=n&&!0===n.current?n:e.large).current}var s=!1;if(!i){var o=d.MIN_WIDTH_FOR_TABLE;e&&(o=parseInt(t.width)),s=d.VARIABLES.minWidthForTable!==o,d.VARIABLES.minWidthForTable=o}e&&!0===s&&this.dispatchEvent("refreshActions"),this._updateUI()},setAccordionProperties:function(e){this.elements.formSection.setAccordionProperties(e)},isReadonly:function(){return!1!==this.isReadOnly},clear:function(){this._clearAllFields()},_clearAllLine:function(){this.elements.formSection.clear()},_getModel:function(e){return this.elements.UIController.getModel(e)},initData:function(e,t){this.resetUIValues(),this.elements.UIController.setModels([]),this._clearAllLine();var i=this._sharedOptions.editMode;if(t)switch(t.edition){case d.FORCE_READWRITE:i=!0;break;case d.FORCE_READONLY:i=!1;break;case d.FORCE_DEFAULT:i=!0===this.options.editMode}if(this._sharedOptions.editMode!==i&&this._switchEditionMode(),!0===this.options.updateSession){if("undefined"!=typeof dscef){this.wiwListModels=e;var n=e[0]._attributes,s=[];for(var o in n){if(null!=n[o]){var a=n[o].value,r=n[o].valueDB,l=n[o].readOnly;null!=a&&null!=l&&null!=r&&s.push({attribute:o,value:n[o].value,valueDB:n[o].valueDB,readOnly:n[o].readOnly})}}var c=JSON.stringify(s);dscef.sendString('{"operation":"getData","operationVersion":"1.0","attributes":'+c+"}")}}else this.addData(e)},addData:function(e){this._addData(e)},changeAttributes:function(e){var t=JSON.parse(e);if(null!=this.wiwListModels&&null!=e){for(var i=0;i<t.attributes.length;i++){var n=t.attributes[i],s=n.attribute,o=n.value,a=n.valueDB,r=n.readOnly;null!=o&&null!=a&&null!=r&&(this.wiwListModels[0]._attributes[s].value!=o&&(this.wiwListModels[0]._attributes[s].value=o,this.wiwListModels[0]._attributes[s].initialsValues.value=o),this.wiwListModels[0]._attributes[s].valueDB!=a&&(this.wiwListModels[0]._attributes[s].valueDB=a,this.wiwListModels[0]._attributes[s].initialsValues.valueDB=a),this.wiwListModels[0]._attributes[s].readOnly!=r&&(this.wiwListModels[0]._attributes[s].readOnly=r))}this.addData(this.wiwListModels)}},_getScrollerContent:function(){return this.elements.scroller?this.elements.scroller.elements.content:null},_scrollIsBottom:function(e){var t=!1;if(e){var i=e.scrollHeight,n=e.getDimensions();t=0!==e.scrollTop&&e.scrollTop>i-n.height}return t},_getScrollerPosition:function(){var e=this._getScrollerContent();return e?this._scrollIsBottom(e)?-1:e.scrollTop:null},_setScrollerPosition:function(e){var t=this._getScrollerContent();t&&(t.scrollTop=-1===e?t.scrollHeight:e)},_saveScrollerPosition:function(){this._previousScrollerPosition=this._getScrollerPosition()},_restoreScrollerPosition:function(){null!==this._previousScrollerPosition&&this._setScrollerPosition(this._previousScrollerPosition),this._previousScrollerPosition=null},onResize:function(){},_addData:function(e){if(!g){var t=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_LoadUI:"+t):window.top.performance.mark("start_LoadUI:"+t)}var i=this;this._ManageValidButton(!1),null!=e&&e.length>0&&this.elements.UIController.setModels([e[0]]);var n=this.elements.UIController.getModels();if(n.length<=0)this._clearAllLine();else{var o=n[0];this._firstModel=o,o.addEvent("onChange:label",this.handlerLabelChanged),o.addEvent("onChange",this.handlerAttributeChanged),o.get("isUXBLDeployed")&&o.addEvent("validateValue",this.handlerValidateAttribute),this.updateTableManager(),this.onResize(),this._ManageValidButton(),this.endOfLoad()}g||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_LoadUI:"+t):window.top.performance.mark("end_LoadUI:"+t)),this.dispatchEvent("onChangeSize"),this.dispatchEvent("onTitleChanged"),this.elements.UIController.validateModels(this.elements.UIController.getModels()),g||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.readPerfo:window.top.readPerfo=function(e,t){console.log("computing..."),require(["text!DS/EditPropWidget/assets/noNls/perfos.json"],(function(i){for(var n=JSON.parse(i),o=[],a=window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.getEntriesByType("mark"):window.top.performance.getEntriesByType("mark"),r={},l="",d=0;d<a.length;d++){var c=a[d].name,u=a[d].startTime,h=c.replace("start_","").replace("end_",""),p=h,m=null;if(c!==h){o.push(c);var f=h.split(":");p=f[0],f.length>0&&(m=f[1])}if(r[h]){var g=u-r[h].startTime;if(r[h].endTime=u,r[h].duration=g,window.console){var v=(n[p]?n[p]:p+" [ NO NLS ]").toUpperCase();m&&(v+=" :increm: "+m),!0===e&&(v+=" -- specificName: "+h+" -- Entry Type: "+a[d].entryType+" -- Start Time: "+r[h].startTime+" -- End Time: "+u),v+=" -- Duration: "+g+"ms \n",console.log(v),l+=v}}else r[h]={startTime:u}}o.forEach((function(e){window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.clearMarks(e):window.top.performance.clearMarks(e)})),!0!==t&&s.download("perfo",l,"text",!1)}))}),console.log("%creadPerfo() to read Properties the performances","color:blue;font-weight:bold;"),s.isDebug()&&setTimeout((function(){g||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.readPerfo(!0,!0):window.top.readPerfo(!0,!0))}),2e3),g||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_EP_DataDisplay"):window.top.performance.mark("end_EP_DataDisplay")),setTimeout((function(){i._restoreScrollerPosition(),g||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_EP_FullTime"):window.top.performance.mark("end_EP_FullTime"))})),this.elements.formSection._manageAccordionVisibility()},endOfLoad:function(){var e=this;this.dataLoadedOnce||setTimeout((function(){e.dataLoadedOnce=!0,e.dispatchEvent("onDataLoaded")}),0)},_isCloseButton:function(){return d.isCloseButton(this.options)},show:function(){this.getUI().show()},setOption:function(e,t){this._parent.apply(this,arguments),this.elements.formSection.options[e]=t},resetDisplay:function(){this.publishEvt("resetDisplay")},initUI:function(){if(!g){var e=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_EP_InitUI:"+e):window.top.performance.mark("start_EP_InitUI:"+e)}var t=this;if(this.elements.mainDiv=this.elements.container=UWA.createElement("div",{class:"EditProp_MainContain includeMenuBar"}),!0!==this.isReadOnly&&!0===this._sharedOptions.editMode||this.elements.container.addClassName("EP_ReadOnly"),this.ManageButtonDiv=UWA.createElement("div",{class:"EditProp_ManageButtonDiv"}),t.ManageButtonTopRight=UWA.createElement("td",{class:"EditProp_ManageButtonTopRight"}),!this._isCloseButton()){var i={label:f.get("EP_Cancel"),className:"EditProp_buttonTop EditProp_Cancel TopButtonCancel",setAttribute:{name:"TopButtonCancel"},clickCallback:function(){"undefined"!=typeof dscef&&dscef.sendString('{"operation":"onClose","operationVersion":"1.0"}'),t.elements.UIController.resetValueOfModels(),t.elements.UIController.validateModels(t.elements.UIController.getModels()),setTimeout((function(){t._ManageValidButton()}),0)}};this.elements.boutonCancel=new p(i),this.elements.boutonCancel&&(this._sharedOptions.editMode?this.elements.boutonCancel.show():this.elements.boutonCancel.hide())}this.elements.boutonCancel&&!0===t.options.setCloseButton&&this.elements.boutonCancel.inject(t.ManageButtonDiv),this._activateValidButton(!this._sharedOptions.editMode),t.ManageButtonTopRight.inject(this.elements.container);var n=this.elements.containerProperties=UWA.createElement("div",{class:"EP_ContainerProperties"}),r=this.elements.containerAccordeon=UWA.createElement("div",{class:"EP_ScrollerProperties"});a.subscribe("onTableOpened",(function(e){t._saveScrollerPosition()})),this.elements.formSection=new o({postBuild:!1,sectionAutoexpand:this.options.sectionAutoexpand,showSections:this.options.showSections,eventThread:this.options.eventThread},this._sharedOptions),this.elements.formSection.inject(r),r.setStyle("overflow-y","auto"),r.inject(n);var l=this.elements.bottomTable=UWA.createElement("div",{class:"EditProp_BottomTableContainer"}),c="true"===s.getWidgetValue(d.COLLAPSE_IC_PREFERENCE.name)&&this.options.typeOfDisplay===d.ALL;null!==c&&!0!==c||s.setWidgetValue(d.COLLAPSE_IC_PREFERENCE.name,"true");var u=this.elements.containerMainTable=UWA.createElement("div",{class:"ICTableContainer "}).inject(l);n.inject(u),l.inject(this.elements.container),!0===this.options.showTopBar&&this.ManageButtonDiv.inject(t.elements.container),this.elements.formSection._manageAccordionVisibility(),g||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_EP_InitUI:"+e):window.top.performance.mark("end_EP_InitUI:"+e)),this.elements.container.addEvent("resize",this._updateUI.bind(this))},_updateUI:function(){var e=this.elements.container.getSize();e.width&&e.width<381?this.publishEvt("switchDisplay","s"):this.publishEvt("switchDisplay","m")},getUI:function(){return this.elements.container},resetUIValues:function(){this.elements.formSection&&this.elements.formSection.reset()},getComponentMode:function(){return!0===this.options.updateSession||this.isReadOnly},switchComponentMode:function(e){this.isReadOnly=e,this.handlerDblClick&&this.elements.container.removeEvent("dblclick",this.handlerDblClick),this.handlerDblClick=null,!0!==e&&(this.handlerDblClick=_.bind(this),this.elements.container.addEvent("dblclick",this.handlerDblClick))},addSection:function(){this.elements.formSection.addSection.apply(this.elements.formSection,arguments)},_switchEditionMode:function(e){var t=!1;if(e!==(!1===this.isReadOnly&&!0===this._sharedOptions.editMode)){if(!1===this.isReadOnly)if(this._sharedOptions.editMode){if(this.elements.UIController.getModifiedModels().length>0){var i=f.get("Some attributes are in edition. Please valid or cancel the modifications to switch");return this._isCloseButton()&&(i=f.get("Some attributes are in edition. Please valid or refresh to switch")),void this.addWarning(i)}this._sharedOptions.editMode=!1,this._activateAddingButton(!1)}else this._sharedOptions.editMode=!0,this._activateAddingButton(!0);else this._sharedOptions.editMode=!1;t=!0}return t&&this.publishEvt("editionSwitched",this._sharedOptions.editMode),!0!==this._sharedOptions.editMode?this.elements.container.addClassName("EP_ReadOnly"):this.elements.container.removeClassName("EP_ReadOnly"),s.setWidgetValue("editProperties_editMode",this._sharedOptions.editMode),t},_switchEdition:function(e){this._switchEditionMode(e)&&this.onResize(),this.lastPointedTableCellObj=null},resizeActionActive:function(){return d.VARIABLES.minWidthForTable!==d.MIN_WIDTH_FOR_TABLE},getOptimalSize:function(){var e=this.elements.masterTable.getSize(),t=this.elements.containerProperties.getSize(),i=e.height-t.height,n=this.elements.formSection.getContent().getSize();return n.height+=i+60,n.width+=30,n},updateTableManager:function(){this._saveScrollerPosition(),this._clearAllLine(),this.updateTable()},updateTable:function(){var e=this;this._clearAllFields(),this._clearAllLine(),e.modelIdentityCard&&(e.modelIdentityCard.set("title",""),e.modelIdentityCard.set("ownerName",""),e.modelIdentityCard.set("date",""),e.modelIdentityCard.set("description",""));var t=this.elements.UIController.getModels(),i=t.length;if(!g){var n=window.dsDashboardWindow&&window.dsDashboardWindow.top?++window.dsDashboardWindow.top.perfoIncrem:++window.top.perfoIncrem;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_addInForm:"+n):window.top.performance.mark("start_addInForm:"+n)}for(var s=0;s<i;s++){var o=t[s];this.webUxTweakers&&(o.webUxTweakers=this.webUxTweakers),this.propertiesWidgetUI&&(o.propertiesWidgetUI=this.propertiesWidgetUI),this.newInfraUI&&(o.newInfraUI=this.newInfraUI),this.elements.formSection.setModel(o,void 0,{tabId:this.options.tabId})}g||(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_addInForm:"+n):window.top.performance.mark("end_addInForm:"+n)),this._restoreScrollerPosition(),setTimeout((function(){e.publishEvt("triggerPostBuild")}))},saveIsNeeded:function(){var e=!0,t=this.elements.UIController.getModifiedModels();if(t.every((function(t){var i=t.previousAttributes();for(var n in"function"==typeof t.getChangedValues&&(i=t.getChangedValues()),i){var s=i[n];if(s instanceof c&&!1===s.isTransient){e=!1;break}}return!1!==e})),!e){var i=this.elements.UIController.validateModels(t);if(i&&i.length>0&&(e=!0),!e){var n=this.elements.UIController.getUXBLErrors(t[0]);n&&n.length>0&&(e=!0)}}return!e},validateModel:function(e){var t=!1,i=e;if(i||(i=this.elements.UIController.getModifiedModels()),i.length>0){var n=this.elements.UIController.validateModels(i);if(n){n.message=f.get("Modification failed")+":"+n.message;var s={};n.forEach((e=>{s[e.attrName]={error:{msg:e.message}}})),this.updateFormSection(s,i[0])}else t=!0}return this._ManageValidButton(),t},runClientBL:function(e){var t=this.elements.UIController.getModels()[0];t&&(t.get("isUXBLDeployed")&&this.validateModel(this.elements.UIController.getModels())&&this.dispatchEvent("validateValue",[e]))},_valueIsChanging:function(e,t){this._ManageValidButton();var i={value:t,valueDB:e.get("valueDB")};e.isSameValueSet(i)&&this._activateValidButton(!1)},_activateAddingButton:function(e){this.dispatchEvent("onAddActivation",e)},_activateValidButton:function(e){var t=!e;this.dispatchEvent("onValidActivation",t)},_ManageValidButton:function(){this._activateValidButton(!this.saveIsNeeded())},getButtons:function(){return this.ManageButtonDiv},getTitle:function(){var e="";return this.elements.UIController&&(e=this.elements.UIController.getLabel()),e},showNotification:function(e){this.addSuccess(e)},setError:function(e){var t=this;if(n.isArray(e))e.forEach((function(e){var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)}));else{var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)}},_manageError:function(e,t){if(e)switch(e.eventID?e.eventID:"error"){case"warning":this.addWarning(e.message?e.message:e,t);break;case"success":this.addSuccess(e.message?e.message:e,t);break;default:this.addError(e,t)}},addWarning:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"warning",customClass:t})},addSuccess:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"success",customClass:t})},addInfo:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"info",customClass:t})},addError:function(e,t){this.dispatchEvent("onNotification",{msg:e.message?e.message:i.encode(e),eventID:"error",customClass:t})},getFormSection:function(){if(this.elements&&this.elements.formSection)return this.elements.formSection},updateFormSection:function(e,t){var i=this.getFormSection();i&&i.updateFormOrganizer(e,t)},disableInputFields:function(e){var t=this.getFormSection();t&&t.disableInputFields(e)}});return y})),define("DS/EditPropWidget/facets/Properties/iPropertiesFacet",["UWA/Core","UWA/Class/Model","DS/EditPropWidget/facets/Properties/EditPropController","DS/EditPropWidget/facets/Properties/Properties","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/utils/AttributesUtils","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/EditPropWidget/utils/EditPropIndexUtils","DS/UIKIT/Mask","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","text!DS/EditPropWidget/assets/settings/SettingsForServices.json","i18n!DS/EditPropWidget/assets/nls/langEditProp"],(function(e,t,i,n,s,o,a,r,l,d,c,u,h,p,m,f,g,v){"use strict";g=JSON.parse(g);var _=i.extend({getListHandle:null,init:function(){this._parent.apply(this,arguments),this.getListHandle={handle:null},this.elements.container||(this.elements.container=e.createElement("div",{class:"RPL30",styles:{height:"100%"}})),this.listOfExtensions=[],this.listOfPredicates=[],this.maskAttributeDetails={},this.maskGroupInfo={},this.groupAttributesInfoAsPerMask={},this.answer=null,this.dimensionAttributes=new Map},updateFacet:function(){var e=this;if(e.elements&&e.elements.container){var t=e.getModel();if(!t)return!1;if(!t.get("indexModeParameter"))return;var i=t.get("objectId");e.elements.container.setContent(""),e.iPropUX=new n({setCloseButton:!1,editMode:!1,readOnly:!0,scroller:!1,identifier:"EPIndex_"+i,events:{}}),e.elements.container.setContent(e.iPropUX),e.loadModels(t,{})}},loadModels:function(e,t){window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_PrepareAjax"):window.top.performance.mark("start_PrepareAjax");var i=this;this.showLoader();var n=e;if(e){var s=l.getServiceBySource("fedsearch");if(!0===e.isTransientModel()||s&&!0===s.modelNeeded)this.setModel(n),this.iPropUX.initData([this.getModel()]),this.hideLoader();else if(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_PrepareAjax"):window.top.performance.mark("end_PrepareAjax"),t&&!1===t.loadModel)this.setModel(n),this.iPropUX.initData([this.getModel()]);else{window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_EP_AJAXRequest"):window.top.performance.mark("start_EP_AJAXRequest");var o=!1;window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("start_EP_GetFromDistant"):window.top.performance.mark("start_EP_GetFromDistant"),d.getAsyncRead((function(t){!1===o&&(t&&t.response&&t.options?(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.mark("end_EP_GetFromDistant"):window.top.performance.mark("end_EP_GetFromDistant"),o=!0,i.answer=t.response,i._cancelListRequest(),t.options.maskAttributeDetails&&(i.maskAttributeDetails=t.options.maskAttributeDetails),t.options.predicates&&(i.listOfPredicates=t.options.predicates),t.options.groupAttributesInfoAsPerMask&&(i.groupAttributesInfoAsPerMask=t.options.groupAttributesInfoAsPerMask),t.options.listOfExtensions&&(i.listOfExtensions=t.options.listOfExtensions),t.options.maskGroupInfo&&(i.maskGroupInfo=t.options.maskGroupInfo),t.options.dimensionAttributes&&(i.dimensionAttributes=t.options.dimensionAttributes),i.calculateUIPosition(),i.answer=t,i.parseResponse(),i._onCompleteLoadModel(t)):function(){if(i.launchPostRequest=function(){i._cancelListRequest();var e=c.getCancelObject();i.getListHandle.handle=e;var t={handleRequest:{handle:e},modelList:[n],tenant:n.getTenant(),onComplete:function(t){i.hideLoader(),!1!==o||e.isCancelled()||(o=!0,console.log("Ajax 2"),!0===(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.isDebug:window.top.isDebug)&&console.log("Ajax 2 answered "+(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.now():window.top.performance.now())),i.getListHandle.handle=null,t&&t.results&&t.results.length>0&&t.results[0]&&t.results[0].data&&Array.isArray(t.results[0].data)&&t.results[0].data.length>0?(i.answer=t,i.calculateUIPosition(),i.parseResponse(),i._onCompleteLoadModel(t)):(i._setError(v.get("FedAjax_NotFound"),void 0,"rpl30_"+Date.now()),i.hideMainComponent()))}};t.defService=s,t.select_predicates=i.listOfPredicates;let a=n.get("source"),r=a&&g[a.toUpperCase()],l=!1;r&&(l=r.plmParameterSupported),t.getPLMParameter=l,t.dimensionAttributes=i.dimensionAttributes,u.getListOfAttributes(t)},i.launchPostRequestForInstance=function(){var t=l.getServiceBySource("3dspace");u.getInstanceDetails({modelList:[e],defService:t,onComplete:function(t){if(i.hideLoader(),t&&t.infos&&t.infos.status&&"OK"===t.infos.status)if(t.result&&t.result.length>0&&t.result[0]&&t.result[0].input_object&&"object"==typeof t.result[0].input_object){var n=t.result[0].input_object;i.calculateUIPosition(),i.parseInstanceWSResponse(n,e,(function(e){e&&e.results&&e.results.length>0&&e.results[0]&&e.results[0].data&&Array.isArray(e.results[0].data)&&e.results[0].data.length>0?(i.answer=e,i.parseResponse(),i._onCompleteLoadModel(e)):(i._setError(v.get("FedAjax_NotFound"),void 0,"rpl30"+Date.now()),i.hideMainComponent())}))}else i._setError(v.get("FedAjax_NotFound"),void 0,"rpl30"+Date.now()),i.hideMainComponent()},primitives:[{navigate_to_rel:{id:1,mode:"return_rel"}}],patterns:{RELATIONS:[{id:1}]},attributes:i.listOfPredicates})},n.get("metatype")!==r.METATYPE_REL||n.get("selReferenceID"))if(n.get("type"))i.getListOfAttributes(n);else{var t=c.getCancelObject();i.getListHandle.handle=t;var a={handleRequest:{handle:t},modelList:[n],tenant:n.getTenant(),onComplete:function(e){if(i.hideLoader(),e&&e.results&&"object"==typeof e.results[0]&&e.results[0]&&e.results[0].data&&Array.isArray(e.results[0].data)&&e.results[0].data.length>0){if("ds6w:type"===e.results[0].data[0].name){var t=e.results[0].data[0].valueDB;t&&n.set("type",t)}}else i._setError(v.get("FedAjax_NotFound"),void 0,"rpl30"+Date.now()),i.hideMainComponent();i.getListOfAttributes(n)}};a.defService=s,a.select_predicates=["ds6w:type"],u.getListOfAttributes(a)}else i.getInstanceDetails(n)}())}))}}else this.iPropUX&&"function"==typeof this.iPropUX.clear&&this.iPropUX.clear(),this._onCompleteLoadModel({results:[]})},_getModelType:function(e){var t=e.get("type"),i=null;return null!=(i="object"==typeof t?t.get("valueDB"):t)&&null!=i||(i=r.EDITPROPINDEX_DEFAULTTYPE),i},destroyComponent:function(){e.is(this.destroy,"function")&&this.destroy(),this.listOfExtensions=null,this.listOfPredicates=null,this.maskAttributeDetails=null,this.maskGroupInfo=null,this.groupAttributesInfoAsPerMask=null,this.answer=null},calculateUIPosition:function(){var e=this,t=1;for(var i in e.groupAttributesInfoAsPerMask)e.groupAttributesInfoAsPerMask[i]&&e.groupAttributesInfoAsPerMask[i].isType&&e.groupAttributesInfoAsPerMask[i].attributes&&e.groupAttributesInfoAsPerMask[i].attributes.forEach((function(i){e.maskAttributeDetails[i].UIPosition=t,t++}));for(var i in e.groupAttributesInfoAsPerMask)e.groupAttributesInfoAsPerMask[i]&&e.groupAttributesInfoAsPerMask[i].isExtension&&e.groupAttributesInfoAsPerMask[i].isAutomaticExt&&e.groupAttributesInfoAsPerMask[i].attributes&&e.groupAttributesInfoAsPerMask[i].attributes.forEach((function(i){e.maskAttributeDetails[i].UIPosition=t,t++}));for(var i in e.groupAttributesInfoAsPerMask)e.groupAttributesInfoAsPerMask[i]&&e.groupAttributesInfoAsPerMask[i].isExtension&&!1===e.groupAttributesInfoAsPerMask[i].isAutomaticExt&&e.groupAttributesInfoAsPerMask[i].attributes&&e.groupAttributesInfoAsPerMask[i].attributes.forEach((function(i){e.maskAttributeDetails[i].UIPosition=t,t++}));e.answer&&e.answer.results&&e.answer.results.length>0&&e.answer.results[0]&&e.answer.results[0].PLMParametersAvailableForIndexMode&&e.answer.results[0].groupData&&e.answer.results[0].groupData.forEach((function(e){e.UIPosition=t,t++}))},getListOfAttributes:async function(e){var t=this,i={model:e,type:t._getModelType(e)};p.getListOfExtensions(i,(function(i){t.listOfExtensions=i,t.listOfPredicates=[],t.maskAttributeDetails={},t.maskGroupInfo={},t.groupAttributesInfoAsPerMask={};var n=[],s={isBus:!0,name:t._getModelType(e)};n.push(s);for(var o=0;o<i.length;o++)n.push(i[o]);p.getMaskAttributes(n,(function(e){t.maskAttributeDetails=e.maskAttributeDetails,t.listOfPredicates=e.listOfPredicates,t.maskGroupInfo=e.maskGroupInfo,t.groupAttributesInfoAsPerMask=e.groupAttributesInfoAsPerMask,t.dimensionAttributes=e.dimensionAttributes,t.launchPostRequest(t.listOfPredicates)}))}))},parseResponse:function(){var e=this,t=[],i=[],n=e.answer;n.results[0].data.forEach((function(n){e.listOfPredicates.includes(n.name)&&(e.maskAttributeDetails&&e.maskAttributeDetails.hasOwnProperty(n.name)&&e.maskAttributeDetails[n.name].isExt&&(n.extension=e.maskAttributeDetails[n.name].extension),e.maskAttributeDetails&&e.maskAttributeDetails[n.name]&&e.maskAttributeDetails[n.name].UIPosition&&(n.UIPosition=e.maskAttributeDetails[n.name].UIPosition),e.maskAttributeDetails[n.name]&&e.maskAttributeDetails[n.name].group?(n.group=e.maskAttributeDetails[n.name].group,e.maskGroupInfo[n.group]&&e.maskGroupInfo[n.group].NLS&&e.maskGroupInfo[n.group].weight.toString().length>0&&(n.groupNLS=e.maskGroupInfo[n.group].NLS,n.groupWeight=e.maskGroupInfo[n.group].weight),i.push(n)):t.push(n))})),n.results[0].data=t,n.results[0].groupData=n.results[0].groupData?[...n.results[0].groupData,...i]:i,e.listOfExtensions&&e.listOfExtensions.length>0&&(n.results[0].extensions={},e.listOfExtensions.forEach((function(e){n.results[0].extensions[e.name]={name:e.name,nameNLS:e.name},e.isAutomaticExt&&(n.results[0].extensions[e.name].deploymentExtension=e.isAutomaticExt)}))),n.options={showSections:true,autoExpand:false}},getInstanceDetails:async function(e){var t=this,i=t._getModelType(e);if(i!==r.EDITPROPINDEX_DEFAULTTYPE){var n={model:e,type:i};p.getListOfExtensions(n,(function(e,n){t.listOfExtensions=e,t.listOfPredicates=[],t.maskAttributeDetails={},t.maskGroupInfo={},t.groupAttributesInfoAsPerMask={};var s=[];if(i!==r.EDITPROPINDEX_DEFAULTTYPE){var o={isRel:!0,name:i};s.push(o)}for(var a=0;a<e.length;a++)s.push(e[a]);p.getMaskAttributes(s,(function(e){t.maskAttributeDetails=e.maskAttributeDetails,t.listOfPredicates=e.listOfPredicates,t.maskGroupInfo=e.maskGroupInfo,t.groupAttributesInfoAsPerMask=e.groupAttributesInfoAsPerMask,t.dimensionAttributes=e.dimensionAttributes,t.launchPostRequestForInstance(t.listOfPredicates)}))}))}},parseInstanceWSResponse:function(e,t,i){var n=this,s=t.get("source");s||(s=t.get("sourceName"));var o={source:s},a=[],r=Object.keys(e),l={};for(var d in e)l[d]=[e[d]];var u=new Promise((function(e){c.isReplayedODT()&&(n.nlsNameApiCalledCounter||(n.nlsNameApiCalledCounter=0),void 0!==n.nlsNameApiCalledCounter&&n.nlsNameApiCalledCounter++),n.getElementsNls(r,{tenant:f.getTenantFromModel(t),onComplete:function(t){e(t)},apiCalled:n.nlsNameApiCalledCounter})})),h=new Promise((function(e){c.isReplayedODT()&&(n.nlsValueApiCalledCounter||(n.nlsValueApiCalledCounter=0),void 0!==n.nlsValueApiCalledCounter&&n.nlsValueApiCalledCounter++);var i=t.get("sourceName")?t.get("sourceName"):t.get("source");n.getValuesNls(l,{tenant:f.getTenantFromModel(t),service:i,onComplete:function(t){e(t)},apiCalled:n.nlsValueApiCalledCounter})}));Promise.all([u,h]).then((function(t){if(t&&"object"==typeof t){var n=t[0],s=t[1];n&&n.vocabularyElementNLSInfo&&n.vocabularyElementNLSInfo.forEach((function(t){if("Predicate"===t.type){var i=t.uri,n=t.dataType,r=s[i]?s[i][e[i]]:"",l=e[i]?e[i]:"",d={name:i,selectable:i,path:i,type:n,readOnly:!0,value:r,valueDB:l,nls:t.nlsName};if("dateTime"===n||"date"===n){var u=Date.parse(l),h=new Date(u);if(h){var p=c.convertDateToStandard(h,!0);l=p.valueDB,r=p.value,d.value=r,d.valueDB=l}d.type="date"}a.push(d),"ds6w:label"===t.uri&&(o.computed={label:d})}else if(t.nlsName)o[t.nlsName]=e[t.nlsName];else{var m=t.uri.split(":");m.length>1&&m[1]&&(o[t.nlsName]=e[m[1]])}})),o.data=a}i({results:[o]})}))},getElementsNls:function(e,t){e&&e.length>0?h.getResourcesInfo(e.join(","),{tenantId:t.tenant,lang:c.getLanguage(),apiVersion:"R2018x",onComplete:function(e){t.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e),t.onComplete.call(this,{success:!1})}}):t.onComplete.call(this,null)},getValuesNls:function(e,t){if(e){var i={};for(var n in e)Array.isArray(e[n])&&(i[n]=[],e[n].forEach((function(s){i[n].push({value:e[n][0],source:[t.service]})})));h.getNlsOfPropertiesValuesBySource(i,{tenantId:t.tenant,serviceName:t.service,lang:c.getLanguage(),apiVersion:"R2019x",onComplete:function(e){t.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),t.onComplete.call(this,e)}})}},hideMainComponent:function(){this.editPropertiesUI&&this.editPropertiesUI.elements&&this.editPropertiesUI.elements.mainDiv&&"function"==typeof this.editPropertiesUI.elements.mainDiv.hide&&this.editPropertiesUI.elements.mainDiv.hide()}});return _}));