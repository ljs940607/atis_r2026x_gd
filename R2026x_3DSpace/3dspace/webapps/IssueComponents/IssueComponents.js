define("DS/IssueComponents/external/RelationalExplorer",[],(function(){"use strict";var e={WIDTH:700,HEIGHT:800};return{execute:function(t){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],(function(s,n,a){var i=n.get("widget"),o=[];if(t.forEach((function(e){o.push({envId:a.getTenant(),serviceId:e.serviceId?e.serviceId:"3DSpace",contextId:i.id,objectId:e.id,objectType:"",displayName:""})})),o.length>0){var r={protocol:"3DXContent",version:"1.1",source:n.get("widget").name,data:{items:o}},l={mode:"panel",height:e.HEIGHT,width:e.WIDTH};s.showWidget("ENORIPE_AP","",{X3DContentId:JSON.stringify(r),x3dPlatformId:a.getTenant()},l)}}))}}})),define("DS/IssueComponents/team/MembersFilterView",["UWA/Class/View","i18n!DS/IssueComponents/assets/nls/IssueComponents","UWA/Core"],(function(e,t,s){var n=e.extend({name:"teamfilter",tagName:"div",className:"iss-member-view",setup:function(){this.template='                                                <div class="'+this.getClassNames("-role-filter")+'">                                                    <table class="filter-table table">                                                        <tr >                                                            <td style="color: gray;">'+t.team.filter.filterByName+'</td>                                                            <td>                                                                <div class="filter-input">                                                                    <input type="text" placeholder="'+t.team.filter.searchPlaceholder+'" class="form-control form-control-root filtertext">                                                                    <div class="clear-filter fonticon fonticon-cancel-circled"></div>                                                                </div>                                                            </td>                                                        </tr>                                                      </table>                                                   </div>'},init:function(e){e=s.clone(e||{},!1),this._parent.call(this,e)},render:function(){this.name,this.cid;this.container.empty(),containerReference=this.container;var e=UWA.createElement("div",{class:"iss-member-view-role-filter",styles:{height:"10%"}});return e.addContent(this.template),e.inject(containerReference),this},domEvents:{"keyup .filtertext":function(e){var t=e.target.value,s=this.container.getElement(".clear-filter");t.length>0?s.setStyle("visibility","visible"):s.setStyle("visibility","hidden"),this.dispatchEvent("memberFilterKeyUp",arguments)},"click .clear-filter":function(e){this.container.getElement(".clear-filter").setStyle("visibility","hidden");var t=this.container.getElement(".filtertext");if(t){t.value=""}this.dispatchEvent("memberFilterKeyUp",{target:{value:""}})},"focus .filtertext":function(){var e=document.getElementsByClassName("searchfiler-input-container");e.addClassName("highlighted-border"),e.removeClassName("border-without-focus")}}});return n})),define("DS/IssueComponents/routes/Routes",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f){"use strict";var g={STATES:{CREATE:0,ASSIGN:1,ACTIVE:2,REVIEW:3,CLOSED:4},STATES_ORDER:{0:"CREATE",1:"ASSIGN",2:"ACTIVE",3:"REVIEW",4:"CLOSED"},CSS:{ELEMENTS:{SCROLLCONTENT:"im-routes-scroll-content",SCROLLCONTAINER:"im-routes-scroll-container",TABLE_CONTAINER:"im-routes-table-container",TABLE_HEADER:"im-routes-table-header",TABLE_HEADER_STATES:"im-routes-table-header-states",TABLE_HEADER_ROUTES:"im-routes-table-header-routes",TABLE_ROWS_CONTAINER:"im-routes-table-rows-container",TABLE_ROW:"im-routes-table-row",TABLE_ROW_STATES_CELL:"im-routes-table-row-states-cell",TABLE_ROW_STATES_CELL_STATE_BLOCK:"im-routes-table-row-states-cell-state-block",TABLE_ROW_STATES_CELL_STATE_BLOCK_CURRENT:"im-routes-table-row-states-cell-state-block-curr",TABLE_ROW_STATES_CELL_STATE_BLOCK_CREATE:"im-routes-table-row-states-cell-state-block-create",TABLE_ROW_STATES_CELL_STATE_BLOCK_ASSIGN:"im-routes-table-row-states-cell-state-block-assign",TABLE_ROW_STATES_CELL_STATE_BLOCK_ACTIVE:"im-routes-table-row-states-cell-state-block-active",TABLE_ROW_STATES_CELL_STATE_BLOCK_REVIEW:"im-routes-table-row-states-cell-state-block-review",TABLE_ROW_STATES_CELL_STATE_BLOCK_CLOSED:"im-routes-table-row-states-cell-state-block-closed",TABLE_ROW_STATES_CELL_ARROW_ASC:"fonticon fonticon-2x fonticon-double-chevron-down im-lifecycle-approve-modal-preview-arrow",TABLE_ROW_STATES_CELL_ARROW_DESC:"fonticon fonticon-2x fonticon-double-chevron-up im-lifecycle-approve-modal-preview-arrow",TABLE_ROW_ROUTES_CELL:"im-routes-table-row-routes-cell",TABLE_ROW_ROUTES_CELL_STATUS:"im-routes-table-row-routes-cell-status",TABLE_ROW_ROUTES_CELL_MULTI:"im-routes-table-row-routes-cell-multi",TABLE_ROW_ROUTES_CELL_DECISION_ROW:"im-routes-table-row-routes-cell-decision-row",TABLE_ROW_ROUTES_CELL_DECISION_STATUS:"im-routes-table-row-routes-cell-decision-status",ICON_APPROVED:"fonticon fonticon-check im-routes-icon-approved",ICON_REJECTED:"fonticon fonticon-wrong im-routes-icon-rejected",ICON_ABSTAINED:"fonticon fonticon-minus im-routes-icon-abstained",ICON_INPROGRESS:"fonticon fonticon-clock im-routes-icon-inprogress",CELL_DECISION_TEXT:"im-routes-table-row-routes-cell-decision-text",CELL_DECISION_TOOLTIP_TEXT:"im-routes-table-row-routes-cell-decision-tooltip-text",WEBUX_CELL_SINGLE:"im-routes-wux-datagrid-cell-single",WEBUX_CELL_MULTI:"im-routes-wux-datagrid-cell-multi"}},TREELIST:{CELLHEIGHT:32,GRID:{allowUnsafeHTMLContent:!1,height:"100%",apiVersion:2,defaultCellHeight:26,headersDimensions:{width:void 0,height:26},useTransparentScroller:!1,useNativeScroller:!1,useAsyncPreExpand:!0,resize:{columns:!0,rows:!1},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},columns:[{dataIndex:"tree",isHidden:!0,isSortable:!1},{dataIndex:"status",width:55,isDraggable:!1,text:"",isSortable:!1},{width:37,dataIndex:"decisionStatus",isDraggable:!1,text:"",isSortable:!1},{width:"auto",dataIndex:"reviewer",isDraggable:!1,text:f.routes.columns.reviewer,isSortable:!1},{width:"auto",dataIndex:"date",isDraggable:!1,text:f.routes.columns.date,isSortable:!1},{width:"auto",dataIndex:"reason",isDraggable:!1,text:f.routes.columns.reason,isSortable:!1},{width:"auto",dataIndex:"attachments",isDraggable:!1,text:f.routes.columns.attachments,isSortable:!1}]}}};return e.extend({name:"DS/IssueComponents/routes/Routes",tagName:"div",className:"im-routes-component",_logger:null,domEvents:{},defaultOptions:{ids:[],states:["Create","Assign","Active","Review","Closed"]},setup:function(e){var t=this;p.start(t.name+" setup"),t._parent(e),t._logger=n.getLogger(t.name),t.elements={},t._tooltips=[],t._deferred={},t.isLoaded=new s((function(e,s){t._deferred.resolve=e,t._deferred.reject=s})),t.physicalId=e.physicalId,t.order="descending",t.routes=null,t.treeLists=null,t.isEmpty=!1,p.end(t.name+" setup")},render:function(){var e=this;p.start(e.name+" render");var s=e.elements.tableContainer=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_CONTAINER+" "+g.CSS.ELEMENTS.SCROLLCONTENT});s.inject(e.container);var n=e.elements.tableHeader=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_HEADER});n.inject(s),t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_HEADER_STATES,html:f.routes.header.states,title:f.routes.header.states}).inject(n),t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_HEADER_ROUTES,html:f.routes.header.routes}).inject(n),(e.elements.tableRowsContainer=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROWS_CONTAINER})).inject(s);var a=e.elements.scrollContainer=t.createElement("div",{class:g.CSS.ELEMENTS.SCROLLCONTAINER}).inject(e.container);return e._scroller=new o({element:s}).inject(a),e.refresh(e.physicalId),e},refresh:function(e){var s=this;return s.physicalId=e,s.setOption("physicalId",e),u.routes.retrieve({data:{objects:[{physicalId:e}]}}).then((function(e){if(s.reset(),Array.isArray(e.results)&&1===e.results.length){var n=s.routes=e.results[0].body,o={create:[],assign:[],active:[],review:[],closed:[]};s.treeLists={create:null,assign:null,active:null,review:null,closed:null};var r=d.get("maturityGraph");n.history.forEach((function(e){o[e.from.toLowerCase()].push(e)})),Object.keys(o).forEach((function(e){o[e]=o[e].sort((function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return n*("ascending"===s.order?1:-1)})),o[e].forEach((function(e){e.decisions=e.decisions.sort((function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return n*("ascending"===s.order?1:-1)}))}))})),n.current&&n.current.from&&("ascending"===s.order?o[n.current.from.toLowerCase()].push(n.current):o[n.current.from.toLowerCase()].unshift(n.current)),s.isEmpty=Object.keys(o).every((function(e){return 0===o[e].length}));var l=Object.keys(o);"ascending"!==s.order&&(l=l.reverse()),l.forEach((function(e){var l=o[e];if(l.length>0){var c=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW});c.setData("state",e),c.inject(s.elements.tableRowsContainer);var d=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_STATES_CELL});d.inject(c);var u=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),m=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK+" "+g.CSS.ELEMENTS["TABLE_ROW_STATES_CELL_STATE_BLOCK_"+e.toUpperCase()]+" "+g.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK_CURRENT,html:r[u]});m.inject(d),m.setStyle("order","ascending"===s.order?1:3);var p=t.createElement("span",{class:"ascending"===s.order?g.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_ARROW_ASC:g.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_ARROW_DESC});p.inject(d),p.setStyle("order",2);var h=g.STATES_ORDER[g.STATES[e.toUpperCase()]+1].toLowerCase(),v=h.substring(0,1).toUpperCase()+h.substring(1).toLowerCase(),b=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK+" "+g.CSS.ELEMENTS["TABLE_ROW_STATES_CELL_STATE_BLOCK_"+h.toUpperCase()],html:r[v]});b.inject(d),b.setStyle("order","ascending"===s.order?3:1);var C=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL});C.inject(c);var I=t.clone(g.TREELIST.GRID);I.id="im-routes-component-treelist-"+e;var y=l.reduce((function(e,t){return t.decisions.length>e&&(e=t.decisions.length),e}),1);I.defaultCellHeight=g.TREELIST.CELLHEIGHT*y,I.columns=s._customizeColumnRendering(I.columns);var E=new a(I);E.options.shouldDisplayTooltip=function(e){if(!e.isHeader){var t="";if("status"==e.dataIndex)switch(e.nodeModel.options.grid.status){case"inProgress":t=f.routes.status.inProgress;break;case"approved":t=f.routes.status.approved;break;case"rejected":t=f.routes.status.rejected}return{longHelp:t}}},E.onNodeClick((function(){Object.keys(s.treeLists).forEach((function(e){null!==s.treeLists[e]&&s.treeLists[e]!==E&&s.treeLists[e].getManager().unselectAll()}))})),E.inject(C),l.forEach((function(e){var s={id:e.physicalId,grid:t.clone(e)};s.grid.issueId=n.physicalId;var a=new i(s);E.addRoot(a)})),c.setStyle("height",(l.length*y+1)*g.TREELIST.CELLHEIGHT+20),E.elements.container.setStyle("height","100%"),s.treeLists[e]=E}}))}})).then((function(){s.resize(),s.dispatchEvent("onReady")})).catch((function(e){s.dispatchEvent("onFailure",e)}))},resize:function(){},reset:function(){var e=this;e.elements.tableRowsContainer.empty();try{e._tooltips.forEach((function(e){e.destroy()}))}catch(e){}e._tooltips=[]},destroy:function(){this.reset()},_customizeColumnRendering:function(e){var s=this,n=t.clone(e);return n.forEach((function(e){switch(e.dataIndex){case"status":e.onCellRequest=s._columnRenderer.status.bind(s);break;case"decisionStatus":e.onCellRequest=s._columnRenderer.decisionStatus.bind(s);break;case"reviewer":e.onCellRequest=s._columnRenderer.reviewer.bind(s);break;case"date":e.onCellRequest=s._columnRenderer.date.bind(s);break;case"reason":e.onCellRequest=s._columnRenderer.reason.bind(s);break;case"attachments":e.onCellRequest=s._columnRenderer.attachments.bind(s)}})),n},_columnRenderer:{status:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_STATUS}),a=g.CSS.ELEMENTS["ICON_"+s.status.toUpperCase()];t.createElement("div",{class:a}).inject(n),e.cellView.getContent().addClassName(g.CSS.ELEMENTS.WEBUX_CELL_SINGLE),e.cellView.getContent().setContent(n)}},decisionStatus:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});s.decisions.forEach((function(a){e.cellView.getContent().addClassName(g.CSS.ELEMENTS.WEBUX_CELL_MULTI);var i=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),o=Math.floor(1/s.decisions.length*100);i.setStyle("height",o+"%"),i.inject(n);var r=g.CSS.ELEMENTS["ICON_"+a.status.toUpperCase()];t.createElement("span",{class:r}).inject(i)})),e.cellView.getContent().setContent(n)}},reviewer:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,a=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach((function(i){e.cellView.getContent().addClassName(g.CSS.ELEMENTS.WEBUX_CELL_MULTI);var o=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);o.setStyle("height",l+"%"),o.inject(a);var c=i.reviewer.fullName,d=t.createElement("div",{class:g.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c});d.inject(o),s._tooltips.push(new r({position:"bottom",target:d,body:t.createElement("span",{class:g.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c})}))})),e.cellView.getContent().setContent(a)}},date:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,a=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach((function(i){e.cellView.getContent().addClassName(g.CSS.ELEMENTS.WEBUX_CELL_MULTI);var o=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);o.setStyle("height",l+"%"),o.inject(a);var c=i.date?new Date(i.date).toLocaleString(d.get("widget").lang):"",u=t.createElement("div",{class:g.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c});u.inject(o),s._tooltips.push(new r({position:"bottom",target:u,body:t.createElement("span",{class:g.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c})}))})),e.cellView.getContent().setContent(a)}},reason:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,a=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach((function(i){e.cellView.getContent().addClassName(g.CSS.ELEMENTS.WEBUX_CELL_MULTI);var o=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);o.setStyle("height",l+"%"),o.inject(a);var d=i.reason||i.comment,u=t.createElement("div",{class:g.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c.getTextFromHTML(t.String.escapeHTML(d))});u.inject(o),s._tooltips.push(new r({position:"bottom",target:u,body:t.createElement("span",{class:g.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c.getTextFromHTML(t.String.escapeHTML(d))})}))})),e.cellView.getContent().setContent(a)}},attachments:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});e.cellView.getContent().addClassName(g.CSS.ELEMENTS.WEBUX_CELL_MULTI);var a=t.createElement("div",{class:g.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),i=Math.floor(1/s.decisions.length*100);a.setStyle("height",i+"%"),a.inject(n);var o=t.createElement("span",{class:"fonticon fonticon-popup"}),r=t.createElement("div",{class:g.CSS.ELEMENTS.CELL_DECISION_TEXT+" clickable",html:o});r.inject(a),r.addEventListener("click",(function(){l.getCommand("AttachmentManager").selectedObject={physicalId:s.issueId,title:f.replace(f.routes.attachmentsManagerTitle,{fromState:f.maturity[s.from.toLowerCase()],toState:f.maturity[s.approveTo.toLowerCase()]})},l.getCommand("AttachmentManager").begin()})),e.cellView.getContent().setContent(n)}}}})})),define("DS/IssueComponents/create/AutoComplete",["UWA/Core","DS/Utilities/Dom","DS/Controls/Abstract","DS/Controls/SelectionChips","DS/Controls/LineEditor","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Core/PointerEvents"],(function(e,t,s,n,a,i,o,r,l,c){"use strict";var d=[{text:"Text",dataIndex:"tree",autoRowHeightFlag:!0}],u=function(){this._selectionChips=new n({fireOnlyFromUIInteractionFlag:!0}),this._selectionChips.getContent().addClassName("wux-controls-autoComplete-selectionChips");var e=this;t.addEventOnElement(this,this._selectionChips,"onPostRemove",(function(t){if(t.options.chips.length>1)e.selectedItems=[];else for(var s=t.options.chips[0].chipOptions.value,n=0;n<e.selectedItems.length;n++)if(e.selectedItems[n].value===s){e.selectedItems.splice(n,1);break}e.fire("change")})),t.addEventOnElement(this,this._selectionChips,"change",(function(e){e.stopPropagation()}))};return s.inherit({name:"autoComplete",publishedProperties:{placeholder:{defaultValue:"",type:"string"},selectedValues:{defaultValue:[],type:"array"},rangeValues:{defaultValue:[],type:"array"},dataType:{defaultValue:"string",type:"string"}},buildView:function(e){this.elements.container.addClassName("wux-controls-autoComplete"),this.selectedItems=[],this._nbItemsToDisplay=-1},_postBuildView:function(){if(void 0===this._editor){var e="";"integer"===this.dataType?e="[0-9]+":"real"===this.dataType&&(e="[0-9]+|([0-9]+.[0-9]+)"),this._editor=new a({placeholder:this.placeholder,displayStyle:"text",fireOnlyFromUIInteractionFlag:!0,pattern:e}),this._editor.getContent().setStyle("width","100%"),this._editor.getContent().addClassName("iss-controls-autoComplete-editor")}u.call(this),this._editor._myInput.style.width="70%",this._editor.displayStyle="lite",this._editor.displayStyle="lite",this._selectionChips.addLastWidget(this._editor),this._selectionChips.inject(this.elements.container),void 0!==this.selectedValues&&this.selectedValues.length>0&&this._addChips(this.selectedValues)},_showPopup:function(){if(!this.elements.popup){var t={target:this,position:"bottom",offset:{x:0,y:4},className:"wux-controls-autoComplete-popup wux-controls-popup",constraint:"screen",alignment:"near",overlap:!1,trigger:"",overlapCallback:function(e){}};if(this.elements.popup=new i(t),this._dataGridViewContainer=new e.Element("div"),this.elements.popup.setBody(this._dataGridViewContainer),this._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer"),this._model=new r,this.rangeValues.length>0)for(var s=0;s<this.rangeValues.length;s++){this._model.prepareUpdate();var n=new l({label:this.rangeValues[s],id:this.rangeValues[s]});this._model.addRoot(n),this._model.pushUpdate()}var a={treeDocument:this._model,columns:d,cellSelection:"none",selectionBehavior:{toggle:!0},showAlternateBackgroundFlag:!1,showRowBorderFlag:!0};this._dataGridView=new o(a),this._dataGridView.layout.columnsHeader=!1,this._dataGridView.layout.rowsHeader=!1,this._dataGridView.getContent().addClassName("wux-controls-autoComplete-dataGridView"),this._dataGridView.inject(this._dataGridViewContainer);var c=this;this._dataGridView.getTreeDocument().getXSO().onAdd((function(e){if(c._dataGridView.unselectAll(),c._hidePopup(),!c._selectionChips.getAllChipsAsLabels().includes(e.options.label)){var t=[];t.push(e.options.label),c._addChips(t)}c._editor._myInput.value="",!c.rangeValues.length>0&&c._editor._myInput.focus()}))}this._updateNbDisplayedElements(this),this._updatePopupHeight(this);var u=this.elements.container.getBoundingClientRect().width;this._dataGridViewContainer.style.width=u+"px",this.elements.popup.visibleFlag=!0,this.fire("show")},_addChips:function(e){var t=this;e.forEach((function(e){e=e.toString(),t._selectionChips.addChip({label:e,value:e}),t.selectedItems.push({label:e,value:e}),t.fire("change")}))},_updateNbDisplayedElements:function(e){var t=0;this._model.processDescendants({onlyVisibleNodes:!0,processNode:function(e){t++}}),this._nbItemsToDisplay=t<10?t:10},_updatePopupHeight:function(){if(this._dataGridViewContainer){var e=27*this._nbItemsToDisplay+"px";this._nbItemsToDisplay<10&&0!=this._nbItemsToDisplay?this._dataGridViewContainer.style.height!==e&&(this._dataGridViewContainer.style.height=e):0==this._nbItemsToDisplay?this._dataGridViewContainer.style.height="27px":(e=27*this._nbItemsToDisplay+"px",this._dataGridViewContainer.style.height=e),null!=this.elements.popup&&this.elements.popup._updateView()}},_hidePopup:function(){this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1,this.fire("hide"))},handleEvents:function(){var e=this;t.addEventOnElement(this,this._editor,"change",(function(e){e.stopPropagation()})),t.addEventOnElement(this,this._editor._myInput,"focus",(function(t){e.rangeValues.length>0&&e._showPopup()})),t.addEventOnElement(this,this._editor._myInput,"input",(function(t){if(""==e._editor._myInput.value)!e.rangeValues.length>0&&e._hidePopup();else if(e._editor.validFlag){if(e._showPopup(),!e.rangeValues.length>0){e._model.empty();var s=new l({label:e._editor._myInput.value,id:e._editor._myInput.value});e._model.addRoot(s)}}else e._hidePopup()})),t.addEventOnElement(this,this._editor._myInput,"keyup",(function(t){if(13===t.keyCode)if(e.rangeValues.length>0&&e.rangeValues.includes(e._editor._myInput.value)||!e.rangeValues.length>0&&e._editor.validFlag){if(!e._selectionChips.getAllChipsAsLabels().includes(e._editor._myInput.value)){var s=[];s.push(e._editor._myInput.value),e._addChips(s)}e._editor._myInput.value="",e._hidePopup(),e._editor._myInput.focus()}else e._editor._myInput.value=""})),t.addEventOnElement(this,document,c.POINTERDOWN,(function(t){e.elements.container&&e.elements.popup&&(e.elements.container.contains(event.target)||e.elements.popup.elements.container.contains(event.target)||e._hidePopup())}))}})})),define("DS/IssueComponents/search/PeopleSearchUI",["DS/SearchWidget/componentUI/SearchWidgetUI","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t){"use strict";var s="js-selected";return e.extend({init:function(e){var t=this;t._parent(e);var n=t.searchInput.options.events.onKeyDown;t.searchInput.removeEvent("onKeyDown"),t.searchInput.addEvent("onKeyDown",(function(e){if(13===e.which){var a=t.filterAreaContent.getElement("."+s);if(null!==a)t._elementIsButton(a)?(t.selectNextOrPreviousResult("previous"),a.click(),t.selectNextOrPreviousResult("next")):t.__setInput(a),e.stopPropagation();else t.hideLoadingGif(),t.ClearDialog(),t.dispatchEvent("onExpressSearch",t.searchInput.getValue()),""!=t.searchInput.getValue()&&e.stopPropagation()}else 38===e.which||40===e.which||(t.hideLoadingGif(),t.ClearDialog()),n(e)})),t._raiseError=t.raiseError,t.raiseError=function(e){t.customRaiseError(e)}},customRaiseError:function(e){"SW_WarningNotFound"===e.customClass&&this.searchInput.getValue().contains(";")&&(e.code="info",e.message=t.search.info.expressSearch),this._raiseError(e)}})})),define("DS/IssueComponents/team/MembersDataGridViewToolbar",["i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e){var t=Object.create(null);return t.toolbar=null,t.propagate={menu:[{type:"PushItem",title:e.team.toolbar.propagateCoowners,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateCoowners"},tooltip:e.team.toolbar.propagateCoowners},{type:"PushItem",title:e.team.toolbar.propagateAssignees,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateAssignees"},tooltip:e.team.toolbar.propagateAssignees},{type:"PushItem",title:e.team.toolbar.propagateContributors,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateContributors"},tooltip:e.team.toolbar.propagateContributors},{type:"PushItem",title:e.team.toolbar.propagateInformedUsers,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateInformedUsers"},tooltip:e.team.toolbar.propagateInformedUsers}]},t.writetoolbarDefinition=function(){var t={entries:[{id:"assigntoself",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"user-ok",fontIconFamily:1},tooltip:e.team.toolbar.assignToSelf,position:"far",category:"add",action:{module:"DS/IssueComponents/team/AddMembersLayout",func:"assignToSelf"}}},{id:"add",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"user-add",fontIconFamily:1},tooltip:e.team.toolbar.addMember,position:"far",category:"add",action:{module:"DS/IssueComponents/team/AddMembersLayout",func:"launchAddMemberPanel"}}},{id:"remove",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"remove",fontIconFamily:1},tooltip:e.team.toolbar.remove,position:"far",disabled:!0,category:"modify",action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"removeHandler"}}},{id:"filter",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"filter",fontIconFamily:1},tooltip:e.team.toolbar.filter,position:"far",category:"modify",action:{module:"DS/IssueComponents/team/MembersFilterLayout",func:"launchFilterMemberPanel"}}},{id:"propagate",dataElements:{typeRepresentation:"sortingdropdown",icon:{iconName:"propagate",fontIconFamily:1},tooltip:e.team.menu.propagate,value:this.propagate},position:"far",category:"modify"}]};return JSON.stringify(t)},t})),define("DS/IssueComponents/konami/Konami",["UWA/Core","DS/WebappsUtils/WebappsUtils","css!DS/IssueComponents/IssueComponents.css"],(function(e,t){"use strict";return{kojima:function(){this.onKonamiCode((function(){new Audio(t.getWebappsAssetUrl("IssueComponents","others/kojima.png")).play()}))},onKonamiCode:function(e){var t="",s="38384040373937396665";document.addEventListener("keydown",(function(n){if((t+=n.keyCode.toString())===s)return e();s.indexOf(t)&&(t=n.keyCode.toString())}))}}})),define("DS/IssueComponents/open/Open",["UWA/Class/Promise","UWA/Core","UWA/Utils/InterCom","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WAFData/WAFData","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/LocalStorage","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m){"use strict";var p="DS/IssueComponents/open/Open",f=6e5,g="ENXISSU_AP",h="ENX3DIR_AP",v={expand:function(s){var n=r.get("widget");return new e((function(e,a){var o={method:"POST"};o.headers={Accept:"application/json","Accept-Language":n.lang,"Content-Type":"application/json",SecurityContext:"ctx::"+l.getSecurityContext()},o.timeout=f,o.onComplete=function(s){var n=t.is(s,"string")?JSON.parse(s):s;e(n)},o.onFailure=function(e){a(e)};var r=s.reduce((function(e,t){return e.push([t]),e}),[]),c={label:n.name+"-"+l.getUserName()+"-"+Date.now(),authored:!1,root_path_physicalid:r,intent:"explore_2D","q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency"],include_param_Attributes:!0,paths:r,level:"-1",source:"cstorage"};o.data=JSON.stringify(c),i.authenticatedRequest(l.assembleURLFor3DSpace("/resources/enopad/lwc/expand"),o)}))},generateFileContent:function(e,s){var n={version:"2.2",results:[],structures:[],viewpoint:[]};return this.expand(e).then((function(a){var i=a.results,o={},r={};if("ENOUSWC_AP"==s)for(var l=0;l<i.length;l++){if(i[l]&&Array.isArray(i[l].attributes)){for(var c=i[l].attributes,d="",u="",m="",p=0;p<c.length;p++)""===d&&"did"===c[p].name&&(d=c[p].value),""===u&&"physicalid"===c[p].name&&(u=c[p].value),""===m&&"ds6w:cadMaster"===c[p].name&&(m=c[p].value);""!==d&&(o[d]={did:d,physicalId:u},e.find((function(e){e==u&&n.results.push({id:d,phid:u,CADOrigin:m})})))}if(i[l]&&Array.isArray(i[l].path))for(var f=i[l].path,g=null,h=0;h<f.length;h++)null===g&&(t.is(r[f[h]],"object")||(r[f[h]]={}),g=r[f[h]])}else for(l=0;l<i.length;l++){if(i[l]&&Array.isArray(i[l].attributes)){for(c=i[l].attributes,d="",u="",p=0;p<c.length;p++)""===d&&"did"===c[p].name&&(d=c[p].value),""===u&&"physicalid"===c[p].name&&(u=c[p].value);""!==d&&(o[d]={did:d,physicalId:u},n.results.push({id:d,phid:u,CADOrigin:"CATIAV5"}))}if(i[l]&&Array.isArray(i[l].path))for(f=i[l].path,g=null,h=0;h<f.length;h++)null===g?(t.is(r[f[h]],"object")||(r[f[h]]={}),g=r[f[h]]):(t.is(g[f[h]],"object")||(g[f[h]]={}),g=g[f[h]])}var v=function(e,t){for(var s in e)if(e.hasOwnProperty(s)){var n=[],a={id:s,show:!0,children:n,select:!0};t.push(a),v(e[s],n)}},b=[];v(r,b);for(var C=0;C<b.length;C++)n.structures.push({structure:b[C]});return n}),(function(e){throw new Error("An error occurred during the expand "+e)}))}};return{socket:"",compass:null,setTypesCallbackForOFW:function(e,n){var i=this;d.start(p+" setTypesCallbackForOFW");var c=r.get("widget")?r.get("widget"):window.widget,f=u.getCompassPubSub();if(!1===n.setTypesCallbackSubscribe&&(i.socket="compass_"+c.id,i.compass=new s.Socket(i.socket),i.compass.subscribeServer("com.ds.compass",window.parent),f.subscribe("setTypesCallback",(function(e){d.start(p+" setTypesCallbackForOFW setTypesCallback");var t=r.get("widget")?r.get("widget"):window.widget;if(e.widgetId===t.id){var s=[];s=e.data&&Array.isArray(e.data.items)?e.data.items.reduce((function(e,t){return e.push(t.objectId),e}),[]):o.getSelection().physicalIds,Array.isArray(s)&&s.length>0?v.generateFileContent(s,e.appId).then((function(t){var s={appId:e.appId,widgetId:e.widgetId,fileName:"-file",fileContent:JSON.stringify(t)};f.publish("launchApp",s)}),(function(){a.displayNotification({msg:m.open.error,eventID:"error"})})):f.publish("launchApp",{appId:e.appId,widgetId:e.widgetId}),d.end(p+" setTypesCallbackForOFW setTypesCallback")}}))),e.length>0){var b=e.map((function(e){if(c.name===g){var s="",n="",a="";return t.is(e.options,"object")?(s=e.options.physicalId,n=e.options.type,a=e.options.title+" ("+e.options.name+")"):(s=e.physicalId,n=e.type,a=e.title+" ("+e.name+")"),{envId:l.getTenant(),serviceId:"3DSpace",contextId:l.getSecurityContexts().securityContext,objectId:s,objectType:n,displayName:a}}return c.name===h?{envId:l.getTenant(),serviceId:"3DSpace",contextId:l.getSecurityContexts().securityContext,objectId:e.id,objectType:e.type,displayName:e.title+" ("+e.name+")"}:{}}));i.compass.dispatchEvent("onSetX3DContent",{protocol:"3DXContent",version:"1.1",source:c.name,widgetId:c.id,data:{items:b}},i.socket),f.publish("setTypes",{widgetId:r.get("widget")?r.get("widget").id:window.widget?window.widget.id:""})}else i.compass.dispatchEvent("onResetX3DContent",{},i.socket),f.publish("resetTypes");d.end(p+" setTypesCallbackForOFW")},modal:null,openWith:function(){var e=this,s=r.get("widget")?r.get("widget"):window.widget,n="";s.name===g?n="DS/IssueManagement/components/ContextualMenu":s.name===h&&(n="DS/Issue3DReviewV2Rsc/components/ContextualMenu"),require(["UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/ENOFloatingPanel/ENOFloatingPanel",n],(function(n,a,i,o,r,l){l.getContextualMenu().then((function(e){for(var t=0;t<e.length;t++)if("Open"===e[t].name)return e[t];return{submenu:[]}})).then((function(n){var l=c.getItem("open"),d={};d=t.is(l,"object")?{type:l.type?l.type:"",app:l.app?l.app:""}:{type:"",app:""};var u=null,p=null,f=null,g=null,h=null,v=null,b=null,C={},I=function(e,s){null!==h&&t.is(e,"object")&&Array.isArray(e.submenu)&&0!==e.submenu.length&&(h.remove(),C={},e.submenu.forEach((function(e){e&&t.is(e.name,"string")&&(h.add({value:e.name,label:e.title,selected:e.name===s}),C[e.name]=e.action.callback,e.name===s&&v.enable())})))};n.submenu.forEach((function(e){"contexts"===e.name&&((u=new o({className:"primary contexts-chooser",name:"typeChooser",value:"contexts",label:"",checked:"contexts"===d.type,events:{onChange:function(){d.type="contexts",c.setItem("open",d),I(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts wux-ui-3ds wux-ui-3ds-3d-object"}),m.open.labels.contexts]),"contexts"===d.type&&(b=e)),"reportedAgainst"===e.name&&((p=new o({className:"primary reported-against-chooser",name:"typeChooser",value:"reportedAgainst",label:"",checked:"reportedAgainst"===d.type,events:{onChange:function(){d.type="reportedAgainst",c.setItem("open",d),I(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-reported-against wux-ui-3ds wux-ui-3ds-location"}),m.open.labels.reportedAgainst]),"reportedAgainst"===d.type&&(b=e)),"resolvedBy"===e.name&&((f=new o({className:"primary resolved-by-chooser",name:"typeChooser",value:"resolvedBy",label:"",checked:"resolvedBy"===d.type,events:{onChange:function(){d.type="resolvedBy",c.setItem("open",d),I(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts-resolved-by fonticon fonticon-resolved-by"}),m.open.labels.resolvedBy]),"resolvedBy"===d.type&&(b=e)),"resolvedItems"===e.name&&((g=new o({className:"primary resolved-items-chooser",name:"typeChooser",value:"resolvedItems",label:"",checked:"resolvedItems"===d.type,events:{onChange:function(){d.type="resolvedItems",c.setItem("open",d),I(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts-resolved-items fonticon fonticon-docs"}),m.open.labels.resolvedItems]),"resolvedItems"===d.type&&(b=e))}));var y=null;n.submenu.length>0?(h=new i({custom:!1,multiple:!1,placeholder:m.open.labels.placeholder,options:[],events:{onChange:function(){var e=this.getValue();e.length>0&&""===e[e.length-1]?v.disable():(d.app=e[e.length-1],c.setItem("open",d),v.enable())}}}),y=t.createElement("div",{html:[u,p,g,f,h]})):y=t.createElement("div",{class:"nothing-to-open",html:t.createElement("span",{class:"nothing-to-open-label",html:m.open.labels.nothing})}),e.modal=new r({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"open-issues-dialog",title:m.open.dialog.title,header:null,body:y,footer:[v=new a({value:m.open.dialog.open,className:"primary",events:{onClick:function(){var s=h.getValue();s.length>0&&s[s.length-1]&&t.is(C[s[s.length-1]],"function")&&C[s[s.length-1]].call(),e.modal.destroy()}},disabled:!0}),new a({value:m.open.dialog.cancel,events:{onClick:function(){e.modal.destroy()}}})],events:{onClose:function(){this.destroy()}}}).inject(s.body),null!==b&&I(b,d.app)}))}))}}})),define("DS/IssueComponents/external/3DMarkup",[],(function(){"use strict";var e={WIDTH:700,HEIGHT:800},t="Issue";return{execute:function(s){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],(function(n,a,i){var o=a.get("widget"),r=[];if(s.forEach((function(e){r.push({envId:i.getTenant(),serviceId:"3DSpace",contextId:o.id,objectId:e,objectType:t,displayName:""})})),r.length>0){var l={protocol:"3DXContent",version:"1.1",source:a.get("widget").name,data:{items:r}},c={mode:"panel",height:e.HEIGHT,width:e.WIDTH};n.showWidget("ENOR3D_AP","",{X3DContentId:JSON.stringify(l),x3dPlatformId:i.getTenant()},c)}}))}}})),define("DS/IssueComponents/users/Users",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Popover","DS/UIKIT/Spinner","DS/WAFData/WAFData","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/SwymServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l){"use strict";var c=function(e){return t.createElement("div",{class:"issue-user-content",html:[{class:"issue-user-image",html:e.image},{class:"issue-user-info",html:e.info}]})},d=function(e){return t.createElement("div",{class:"issue-user-image-sub",html:t.createElement("img",{class:"issue-user-image-sub-img img-circle",src:o.getUserImage(e.user)})})},u=function(e){return t.createElement("div",{class:"issue-user-info-sub",html:[{class:"issue-user-info-sub-id",html:[{class:"issue-user-info-sub-name",html:e.name},{class:"issue-user-info-sub-user",html:"("+e.user+")"}]},{class:"issue-user-info-sub-email",html:e.email},{class:"issue-user-info-sub-address",html:[{class:"issue-user-info-sub-address-city",html:e.city},{class:"issue-user-info-sub-address-city",html:e.country}]},{class:"issue-user-info-sub-more",html:l.users.more,events:{click:function(){o.getUserProfile(e.user)}}}]})};return{create:function(e){for(var s,n=t.createElement("div",{class:"issue-users-list"}),a=0;a<e.users.length;a++)"group"===e.users[a].type?t.createElement("div",{class:"user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group"}).inject(n):(s=e.users[a],t.createElement("div",{class:"issue-user-image",html:o.getUserImageElement(s,!0,{cssClass:"issue-user-image-img",Title:""})})).inject(n);return n},display:function(e){var a=new n,i=t.createElement("div",{class:"issue-user-info-ph",html:a}),o=d({user:e.user}),l=null;(l=new s({className:"issue-user-popover",target:e.target,body:c({image:o,info:i})})).show(),l.updatePosition(),a.show(),r.users.retrieve({user:e.user}).then((function(e){a.destroy(),i.parentNode.replaceChild(u(e),i),l.updatePosition()}))},open:function(e){var t=e.user;o.getUserProfile(t)}}})),define("DS/IssueComponents/create/Form",["UWA/Controls/Form"],(function(e){"use strict";var t=e.extend({init:function(e){var t=this;t.autocompletes=[],t.fields=e.fields,t.events={onInvalid:function(){}},t._parent(e)},unvalidate:function(){return this.getContent().getElements(".has-error").forEach((function(e){e.removeClassName("has-error")})),this},validate:function(e,t){var s=[];return this.unvalidate(),this.fields.forEach((function(e){switch(e.name){case"button":case"submit":break;case"buttonGroup":if("radio"===e.type)if(e.requiredFlag&&!e.disabled)!(e.value.length>1)&&s.push(e);break;case"checkbox":e.requiredFlag&&!1===e.checked&&!e.disabled&&s.push(e);break;case"comboBox":!e.required||!e.visibleFlag||""!==e.value&&void 0!==e.value||e.disabled||s.push(e);break;case"lineEditor":case"editor":case"email":case"url":case"tel":e.requiredFlag&&""===e.value&&!e.disabled&&s.push(e);break;case"autoComplete":e.requiredFlag&&(""===e.value||void 0===e.value||Array.isArray(e.value)&&0==e.value.length)&&!e.disabled&&s.push(e);break;default:!e.requiredFlag||""!==e.value&&void 0!==e.value||e.disabled||s.push(e)}})),this.dispatchEvent(0===s.length?"onValid":"onInvalid"),0===s.length}});return t})),define("DS/IssueComponents/team/AddMembersView",["UWA/Class/View","i18n!DS/IssueComponents/assets/nls/IssueComponents","UWA/Core"],(function(e,t,s){return e.extend({name:"iss-add-member",tagName:"div",className:"iss-add-member",setup:function(){this.template='                                                <div class="'+this.getClassNames("-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-body")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table class="add-member-table table">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-coowner")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.coowner+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-coowner-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-coowner-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search coowner-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-assignee")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.assignee+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-assignee-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-assignee-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search assignee-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-contributor")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.contributor+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-contributor-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-contributor-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search contributor-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-informeduser")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.informedUser+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-informedUser-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-informedUser-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search informedUser-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-button")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t</div>                                                </div>'},init:function(e){e=s.clone(e||{},!1),this._parent.call(this,e)},render:function(){this.name,this.cid;this.container.empty(),containerReference=this.container;var e=UWA.createElement("div",{class:"iss-member-view",styles:{height:"10%"}});return e.addContent(this.template),e.inject(containerReference),this},domEvents:{"click .assignee-field-search":function(){this.dispatchEvent("searchMember","Assignee")},"click .coowner-field-search":function(){this.dispatchEvent("searchMember","Coowner")},"click .contributor-field-search":function(){this.dispatchEvent("searchMember","Contributor")},"click .informedUser-field-search":function(){this.dispatchEvent("searchMember","InformedUser")}}})})),define("DS/IssueComponents/utils/Utils",["UWA/Class/Promise","UWA/Controls/Input","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueCommon/utils/Utils","DS/Controls/TooltipModel","DS/WebUAUtils/WebUAUtils","DS/UIKIT/Mask","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/ENOCustomAttributeUtils/scripts/CustomAttributeUtils","i18n!DS/IssueCommon/assets/nls/IssueCommon","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g){"use strict";var h={ISSUE_TYPE:"Issue",ISSUE_TYPES:"IssueTypes",CREATE_STATE:"Create",ASSIGN_STATE:"Assign",ACTIVE_STATE:"Active",REVIEW_STATE:"Review",CLOSED_STATE:"Closed",PRIVATE_STATE:"Private",PUBLIC_STATE:"Public",WEBHELP:{customViewSettings:"ENXIssuUserMap/issue-t-customize-columns.htm",addAffectedItem:"ENXIssuUserMap/issue-t-related-objects-manage.htm",addContexts:"ENXIssuUserMap/issue-t-related-objects-manage.htm",addResolvedItems:"ENXIssuUserMap/issue-t-related-objects-manage.htm",addResolvedby:"ENXIssuUserMap/issue-t-related-objects-manage.htm",pickAffectedItem:"ENXIssuUserMap/issue-t-related-objects-manage.htm",pickContexts:"ENXIssuUserMap/issue-t-related-objects-manage.htm",pickResolvedItems:"ENXIssuUserMap/issue-t-related-objects-manage.htm",add:"ENXIssuUserMap/issue-t-members.htm",propagate:"ENXIssuUserMap/issue-t-members.htm",create:"ENXIssuUserMap/issue-t-issue-templates-manage.htm",clone:"ENXIssuUserMap/issue-t-issue-templates-manage.htm",edit:"ENXIssuUserMap/issue-t-issue-templates-manage.htm",delete:"ENXIssuUserMap/issue-t-issue-templates-manage.htm",share:"ENXIssuUserMap/issue-t-issue-templates-manage.htm",customizeDatagridView:"ENXIssuUserMap/issue-t-customize-columns.htm",reportingOrganizationHelper:"ENXIssuUserMap/issue-t-create-issue.htm",responsibleOrganizationHelper:"ENXIssuUserMap/issue-t-create-issue.htm",reportedAgainstHelper:"ENXIssuUserMap/issue-t-related-objects-manage.htm",contextsHelper:"ENXIssuUserMap/issue-t-related-objects-manage.htm",attachmentsHelper:"ENXIssuUserMap/issue-t-attachments.htm",ownerHelper:"ENXIssuUserMap/issue-c-access.htm",coOwnersHelper:"ENXIssuUserMap/issue-c-access.htm",assigneesHelper:"ENXIssuUserMap/issue-c-access.htm",contributorHelper:"ENXIssuUserMap/issue-c-access.htm",informedUserHelper:"ENXIssuUserMap/issue-c-access.htm",replaceHelp:"ENXIssuUserMap/issue-t-manage.htm",suffixHelp:"ENXIssuUserMap/issue-t-manage.htm",prefixHelp:"ENXIssuUserMap/issue-t-manage.htm",removeObject:"ENXIssuUserMap/issue-t-manage.htm",subscribe:"ENXIssuUserMap/issue-t-subscription.htm",unsubscribe:"ENXIssuUserMap/issue-t-subscription.htm",editSubscription:"ENXIssuUserMap/issue-t-subscription.htm",mySubscriptions:"ENXIssuUserMap/issue-t-subscription.htm",moveIssue:"ENXIssuUserMap/issue-t-manage.htm",markAsComplete:"ENXIssuUserMap/issue-t-complete.htm",duplicateIssue:"ENXIssuUserMap/issue-t-manage.htm",approvals:"ENXIssuUserMap/issue-t-workflow.htm",moveTemplate:"ENXIssuUserMap/issue-t-issue-templates-manage.htm",collabSpaceHelper:"EXP3DBasicsUserMap/exp3dconcept-c-collaborative-spaces.htm",organizationHelper:"EXP3DBasicsUserMap/exp3dconcept-c-collaborative-spaces.htm",resolvedBy:"ENXIssuUserMap/issue-t-related-objects-manage.htm",createTask:"ENXIssuUserMap/issue-t-manage.htm",changeAction:"ENXIssuUserMap/issue-t-manage.htm",addResolvedByUsingSearch:"ENXIssuUserMap/issue-t-manage.htm"},DATES:["created","modified","estimatedStartDate","estimatedEndDate","actualStartDate","actualEndDate","resolutionDate"],MATURITY_GRAPH:"maturityGraph",ISSUE_MATURITY_STATE_ATTRIBUTES:"issueMaturityStateAttributes",TEMPLATE_MATURITY_STATE_ATTRIBUTES:"templateMaturityStateAttributes",TEMPLATE_MATURITY_GRAPH:"templateMaturityGraph",BASE_NLS:"ISU_TYPE_NLS",CUSTOM_ATTR_NLS:"CUSTOM_ATTR_NLS",CUSTOM_ATTR_INFOS:"CUSTOM_ATTR_INFOS",ISSUE_EXTENSIONS:"ISSUE_EXTENSIONS",FETCH_PREDICATES:["ds6w:policy","ds6w:escalationRequired","ds6w:hasAffectedItems","ds6w:reserved","ds6w:status","ds6w:assignee","ds6w:contributor","ds6w:changeFollower","ds6w:lastModifiedBy","ds6w:organizationResponsible","ds6w:originator","ds6w:responsible","ds6w:isLastRevision","ds6w:isLastRevisionPerState","ds6w:project","ds6w:hasContexts","ds6w:reportingOrganization","ds6w:responsibleOrganization","ds6w:completionType","ds6w:hasResolvedBy","ds6w:hasResolutionItems","ds6w:priority"]};return{getIconByState:function(e,t,s){var n="";if(t!=h.ISSUE_TYPE&&""!=s)n=u.get3DSpaceUrl()+"/"+s;else switch(e){case h.CREATE_STATE:n=i.getWebappsAssetUrl("IssueCommon","icons/32/states/iconCreateState.png");break;case h.ASSIGN_STATE:n=i.getWebappsAssetUrl("IssueCommon","icons/32/states/iconAssignState.png");break;case h.ACTIVE_STATE:n=i.getWebappsAssetUrl("IssueCommon","icons/32/states/iconActiveState.png");break;case h.REVIEW_STATE:n=i.getWebappsAssetUrl("IssueCommon","icons/32/states/iconReviewState.png");break;case h.CLOSED_STATE:n=i.getWebappsAssetUrl("IssueCommon","icons/32/states/iconClosedState.png")}return n},getColorByState:function(e){var t="";switch(e){case h.CREATE_STATE:t="#9B2C98";break;case h.ASSIGN_STATE:t="#E03400";break;case h.ACTIVE_STATE:t="#007DA3";break;case h.REVIEW_STATE:t="#018308";break;case h.CLOSED_STATE:t="#757575";break;case h.PRIVATE_STATE:t="#9B2C98";break;case h.PUBLIC_STATE:t="#018308"}return t},getFormattedDate:function(e,t){for(var s=window.widget.lang,n=h.DATES,a=0;a<n.length;a++)isNaN(Date.parse(e[n[a]]))?e[n[a]]="":e[n[a]]=new Date(e[n[a]]).toLocaleString(s,t);return e},getTextFromHTML:function(e){var t=s.createElement("div",{html:s.String.escapeHTML(e)});return t.textContent||t.innerText||""},timeSince:function(e){var t=Math.floor((new Date-e)/1e3),s=Math.floor(t/31536e3);return s>1?f.replace(f.dates.years,{number:s}):(s=Math.floor(t/2592e3))>1?f.replace(f.dates.months,{number:s}):(s=Math.floor(t/86400))>1?f.replace(f.dates.days,{number:s}):(s=Math.floor(t/3600))>1?f.replace(f.dates.hours,{number:s}):(s=Math.floor(t/60))>1?f.replace(f.dates.minutes,{number:s}):f.replace(f.dates.seconds,{number:Math.floor(t>=0?t:0)})},getDroppableData:function(t){for(var n=this,a={},i=s.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",o="",r=["text/searchitems","text/plain","Text"],l=0;l<r.length&&""===o;l++){var c=t.dataTransfer.types[i](r[l]);(s.is(c,"number")&&c>=0||s.is(c,"boolean")&&!0===c)&&(o=r[l])}var d={};if(""===o)throw new Error("Unknown type in DnD");d=t.dataTransfer.getData(o);try{let t=[];return(a=JSON.parse(d)).data.items.forEach((e=>{e.objectType==h.ISSUE_TYPE?e.isIssue=!0:t.push(e.objectType)})),t.length>0?new e((function(e){n.getTypesHierarchy(t).then((t=>{a.data.items.forEach((function(e,s){t[e.objectType]&&t[e.objectType].hierarchy.includes(h.ISSUE_TYPE)&&(e.isIssue=!0)})),e(a)}))})):e.resolve(a)}catch(t){a={data:{items:[]}},e.resolve(a)}},setDroppableData:function(e){d.get("widget")||window.widget;for(var t=this.buildDnDPayload({items:[]}),s=0;s<e.length;s++){var n=e[s],a=n.options.id.split(","),i=a[a.length-1];t.data.items.push({envId:u.getTenant(),serviceId:n.options.serviceId?n.options.serviceId:"3DSpace",contextId:"",objectId:i,objectId:n.options.pid?n.options.pid:n.options.id,i3dx:n.options.id.includes("i3dx")?n.options.id:"",objectType:n.options.type,displayName:n.options.name,displayType:n.options.type})}var o="text/plain";try{(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(o="text")}catch(e){}return 0===t.data.items.length?null:{type:o,data:t}},buildCustomViewOptions:function(e,t){e.columns.forEach((e=>{"ContextualMenuColumn"===e.dataIndex&&(e.isOOTBColumn=!0,e.ds6wIndexMapping="contextualMenuColumn")}));let s=e.columns.filter((e=>1==e.isOOTBColumn)),n=e.custom_view_options;n.dgvHandle=e,n.ootb_columns=[...s],n.dgvDiv=t,n.settings={...n.settings,url:u.get3DSpaceUrl(),securityContext:u.getSecurityContexts().securityContext,isNative:d.get("isNatifEnvironnement"),tenant:u.getTenant()},e.columnDefinitionUpdated=!1},applyCustomViews:async function(e){await p.updateColumnDefinition_V2(e.custom_view_options),p.applyCustomAttributes_V2(e.custom_view_options,Object.keys(e.custom_view_options.dgvHandle.customColInfo)),e.columnDefinitionUpdated=!1,e.multiIssuesSelected&&1==e.multiIssuesSelected?e.layout.setColumnVisibleFlag("common",!0):e.multiIssuesSelected&&0==e.multiIssuesSelected&&e.layout.setColumnVisibleFlag("common",!1)},restoreCustomViews:function(e){var t=d.get("widget")||window.widget;if(t.getValue("wux-collectionView-dataGridView")){const s=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[t.id+"_ISUSummaryView"],n=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[t.id+"Template"],a=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[t.id+"_contents"],i=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[e.identifier];let o="";void 0!==i?o=i:("ISUSummaryView"===e.identifier&&(o=s),"ISUTemplateSummaryView"===e.identifier&&(o=n),"ISUContentsView"===e.identifier&&(o=a)),o&&(o.currentCustomViewIdentifier=o.currentCustomViewId?o.currentCustomViewId:"DefaultConfiguration",p.restoreCustomViews(o,e.custom_view_options,!0))}e.columnDefinitionUpdated=!1,e.multiIssuesSelected&&1==e.multiIssuesSelected?e.layout.setColumnVisibleFlag("common",!0):e.multiIssuesSelected&&0==e.multiIssuesSelected&&e.layout.setColumnVisibleFlag("common",!1)},launchCustomViewManager:async function(e){e.columns.forEach((e=>{"ContextualMenuColumn"===e.dataIndex&&(e.isOOTBColumn=!0,e.ds6wIndexMapping="contextualMenuColumn")}));let t=e.columns.filter((e=>1==e.isOOTBColumn));e.custom_view_options.ootb_columns=t,p.launchCustomViewManager_V2(e.custom_view_options)},applyCustomAttributes:function(e,t,s){p.applyCustomAttributes(e,t,s)},applyCustomAttributes_V2:async function(e,t){await p.applyCustomAttributes_V2(e,t)},processColumnsVisibility:function(e,t,s){p.processCustomViews(e,t,s)},loadCustomViews:function(e){var t=d.get("widget")||window.widget;if(t.getValue("wux-collectionView-dataGridView")){const s=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[e.identifier];s&&e.loadCustomViews(s.customViews,s.currentCustomViewId)}},refreshOOTBColumnList:function(e){let t=e.columns.filter((e=>1==e.isOOTBColumn));e.custom_view_options.ootb_columns=t},registerCustomEventsOnDGV:function(e){const t=["sortModelChange","columnOrderChange","columnWidthChange","columnVisibleStateChange"];if(!e)return;const n=e;for(let a=0;a<t.length;a++)e.addEventListener(t[a],(function(e){n.identifier;const i=n.getCustomViewsManager().getCurrentCustomViewIdentifier(),o=i||"DefaultConfiguration";let r=!1,l=!1,c={};const d={columnWidthChange:void 0,columnVisibleStateChange:void 0};switch(t[a]){case"sortModelChange":n.getCustomViewsManager().getCustomView(o).sortModel=e.dsModel.sortModel,n.getCustomViewsManager().getCustomView(o).columnsSortModel=e.dsModel.sortModel,r=!0;break;case"columnOrderChange":break;case"columnWidthChange":s.is(e.options.columnID)&&(d.columnWidthChange=e.options.columnID),s.is(e.options.columnIDs)&&(c=e.options.columnIDs,l=!0),r=!0;break;case"columnVisibleStateChange":s.is(e.options.columnID)&&(d.columnVisibleStateChange=e.options.columnID),r=!0}!0===r&&(!0===l?p.processSizeAllColumnsToFitCustomData(n.getCustomViewsManager().getCustomViews(),o,n.custom_view_options,c):p.processCustomViews(n.getCustomViewsManager().getCustomViews(),o,n.custom_view_options,d))}))},_printPreferences:function(e){var t=d.get("widget")||window.widget;if(t.getValue("wux-collectionView-dataGridView")){JSON.parse(t.getValue("wux-collectionView-dataGridView"))[e.identifier]}},createGhostDrag:function(e,t){var n=s.createElement("div",{class:"issue-ghost-container",html:[s.createElement("div",{class:"issue-ghost-panel",html:[s.createElement("img",{class:"issue-ghost-image",src:e.icons[e.icons.length-1]}),s.createElement("div",{class:"issue-ghost-title",html:e.title+" ("+e.name+")"})]}),s.createElement("span",{class:"issue-ghost-counter",html:t})]});return n.setStyle("transform","translate3d(0,0,0)"),n},template:{getDocuments:function(t){return new e(((e,s)=>{require(["DS/IssueAttachmentManager/services/AttachmentServices"],(function(s){s.getDocumentsFrom(t).then((function(t){var s=[];return Array.isArray(t.attachments)&&(s=t.attachments.map((function(e){return e.id}))),e(s)})).catch((function(t){e(t),that._logger.error("Could not fetch the documents: %o",t)}))}))}))},getPrimary:function(t){return new e(((e,n)=>{require(["DS/IssueAttachmentManager/services/AttachmentServices"],(function(n){n.getPrimary(t).then((function(t){var n="",a=JSON.parse(t);return s.is(a.documentId,"string")&&""!==a.documentId&&(n=a.documentId),e(n)})).catch((function(t){e(t),that._logger.error("Could not fetch the primary attachment: %o",t)}))}))}))},formatMemebersValues:function(e){return e.reduce((function(e,t){return e[t.user]={fullName:t.fullName,user:t.user,type:t.type},e}),{})}},classification:{getCSRFToken:function(t){return new e(((e,n)=>{m.classification.getcsrf().then((function(s){var n={issueId:t.physicalId,csrf:s.csrf.value,isEdit:t.isEdit};e(n)})).catch((function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?a.displayNotification({msg:e.body.message,eventID:"error"}):a.displayNotification({msg:g.create.classificationFailed,eventID:"error"}),n(e)}))}))},classifyObject:function(t,n){var i=[];return t.forEach((function(t){var o=new e((function(e,i){m.classification.classify({classID:t,issueID:n.issueId,token:n.csrf}).then((function(t){"KO"===t.body.StatusOfObjects[n.issueId].status?(a.displayNotification({msg:g.create.classificationFailed,eventID:"error"}),i(n)):e(n)})).catch((function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?a.displayNotification({msg:e.body.message,eventID:"error"}):a.displayNotification({msg:g.create.classificationFailed,eventID:"error"}),i(e)}))}));i.push(o)})),e.all(i).then((function(e){return e[0]}))},deClassifyObject:function(t,n){var i=[];return t.forEach((function(t){var o=new e((function(e,i){m.classification.deClassify({classID:t,issueID:n.issueId,token:n.csrf}).then((function(t){"OK"!=t.body.StatusOfObjects[n.issueId]?(a.displayNotification({msg:g.create.classificationFailed,eventID:"error"}),i(n)):e(n)})).catch((function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?a.displayNotification({msg:e.body.message,eventID:"error"}):a.displayNotification({msg:g.create.classificationFailed,eventID:"error"}),i(e)}))}));i.push(o)})),e.all(i).then((function(e){return e[0]}))},getClassAttrVals:function(e){return this.getClassificationAttrValues(e.issueId).then((function(t){var s=t.member[0]?t.member[0].cestamp:"";return{issueId:e.issueId,csrf:e.csrf,cestamp:s}})).catch((function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?a.displayNotification({msg:e.body.message,eventID:"error"}):a.displayNotification({msg:g.create.setAttributesFailed,eventID:"error"})}))},getClassificationAttrValues:function(t){return new e(((e,s)=>{m.classification.getClassificationAttributesOfClassifiedItem({issueId:t}).then((function(t){e(t)})).catch((function(e){s(e)}))}))},setClassificationValues:function(t,n){return new e(((e,i)=>{m.classification.setClassificationAttributes({issueId:n.issueId,attributes:t,cestamp:n.cestamp,csrf:n.csrf}).then((t=>{e(n)})).catch((e=>{e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?a.displayNotification({msg:e.body.message,eventID:"error"}):a.displayNotification({msg:g.create.setAttributesFailed,eventID:"error"}),i(e)}))}))},addClassificationColumn:function(e,t,n){for(var a in e.attributes){let e=this.getNLSForClassAttr(a);if(s.is(t)&&s.is(t.attributes)&&!t.attributes.includes(a)&&"cestamp"!==a){t.attributes.push(a);var i={column:{text:e||a,dataIndex:a,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustomColumn:"Classification",isOOTBColumn:!0,ds6wIndexMapping:a}},o={that:t,attr:{name:a}},r=[];"template"==n?(i.column.getCellValue=t.dataGrid.rendering.classificationAttributes.bind(o),r=t.dataGrid.getColumns().filter((e=>e.dataIndex==i.column.dataIndex)),r.length<=0&&t.dataGrid.getManager().addColumnOrGroup(i.column)):(i.column.getCellValue=t.list.rendering.classificationAttributes.bind(o),r=t.list.getManager().getColumns().filter((e=>e.dataIndex==i.column.dataIndex)),r.length<=0&&t.list.getManager().addColumnOrGroup(i.column))}}},getNLSForClassAttr:function(e){let t=d.get("classAttrNLS");return t[e]?.label}},getRecentlyUsedTemplates:function(){return new e(((e,t)=>{m.preferences.get({data:{name:"recentUsedTemplates"}}).then((function(t){e(t)})).catch((function(e){}))}))},setRecentlyUsedTemplates:function(t){return new e(((e,s)=>{m.preferences.set({data:{name:"recentUsedTemplates",value:JSON.stringify(t)}}).catch((function(e){s(e)}))}))},isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},utils:{isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},addTypeToNonIndexIds:function(t){var s=this,n=t,a=s.nonIndexIds(t);return new e((function(e){a.length>0?m.fetch({data:{objects:a.map((function(e){return{physicalId:e}}))},onComplete:function(t){const a=s.mapAttributes(t.body.results);n=s.updateResponse(n,a),e(n)},onFailure:function(t){e(n)}}):e(n)}))},nonIndexIds:function(e){var t=[];return e.forEach((e=>{e.reportedAgainst.length>0&&e.reportedAgainst.forEach((e=>{0==e.index&&t.push(e.physicalId)})),e.contexts.length>0&&e.contexts.forEach((e=>{0==e.index&&t.push(e.physicalId)})),e.resolvedBy.length>0&&e.resolvedBy.forEach((e=>{0==e.index&&t.push(e.physicalId)})),e.resolvedItems.length>0&&e.resolvedItems.forEach((e=>{0==e.index&&t.push(e.physicalId)}))})),[...new Set(t)]},mapAttributes:function(e){let t={};return e.forEach((e=>{let n={};var a="";e.attributes.forEach((e=>{switch(s.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name){case"resourceid":n.pid=e.value,""==a&&(a=e.value);break;case"ds6w:label":n.title=e.value;break;case"ds6w:type":n.type=e.value;break;case"ds6w:i3dx":a=e.value}})),t[a]=n})),t},updateResponse:function(e,t){return e.forEach((e=>{e.reportedAgainst.forEach((e=>{t[e.physicalId]&&(e.type=e.objectType=t[e.physicalId].type,e.title=t[e.physicalId].title,e.pid=t[e.physicalId].pid)})),e.resolvedItems.forEach((e=>{t[e.physicalId]&&(e.type=e.objectType=t[e.physicalId].type,e.title=t[e.physicalId].title,e.pid=t[e.physicalId].pid)})),e.resolvedBy.forEach((e=>{t[e.physicalId]&&(e.type=e.objectType=t[e.physicalId].type,e.title=t[e.physicalId].title,e.pid=t[e.physicalId].pid)})),e.contexts.forEach((e=>{t[e.physicalId]&&(e.type=e.objectType=t[e.physicalId].type,e.title=t[e.physicalId].title,e.pid=t[e.physicalId].pid)}))})),e},getTypesHierarchy:function(t){return new e((e=>{m.getTypesHierarchy({types:t}).then((t=>{var n={};s.is(t.types_hierarchies,"array")&&t.types_hierarchies.forEach((function(e,t){var s={};s.hierarchy=e.hierarchy,n[e.type]=s})),e(n)}))}))},updateTooltip:function(e,t){var s=this;return e.forEach((e=>{if(e.id){if(s._tooltip=new r({mouseRelativePosition:!0,allowUnsafeHTMLShortHelp:!0,allowUnsafeHTMLLongHelp:!0}),s._tooltip.title=g[e.id+"Title"],s._tooltip.shortHelp=g[e.id+"ShortHelp"],s._tooltip.longHelp=g[e.id+"LongHelp"],!s._tooltip.moreHelpCB){var n={},a=d.get("widget")?d.get("widget").name:"";n.helpid=e.id,n.content="ENXISSU_AP"===a?{[e.id+".PanelHelp"]:h.WEBHELP[e.id]}:{[e.id+".WebHelp"]:h.WEBHELP[e.id]};var i=l.getMoreHelpCallback(n);this._tooltip.moreHelpCB=i}t?t.updateNodeModel(e.id,{tooltip:s._tooltip}):e.tooltip=s._tooltip}})),e},updatePanelTooltip:function(e,t){if(e[t].tooltipInfos=new r({title:g[t+"Title"],shortHelp:g[t+"ShortHelp"],longHelp:g[t+"LongHelp"]}),!e[t].tooltipInfos.moreHelpCB){var s={},n=d.get("widget")?d.get("widget").name:"";s.helpid=t,s.content="ENXISSU_AP"===n?{[t+".PanelHelp"]:h.WEBHELP[t]}:{[t+".WebHelp"]:h.WEBHELP[t]};var a=l.getMoreHelpCallback(s);e[t].tooltipInfos.moreHelpCB=a}},getIssueMaturity:async function(e){var t={data:e};if(!d.get(h.MATURITY_GRAPH)){for(var s=await m.issues.getStatesAttributes(t),n={},a=s.policies[0].states,i=0;i<a.length;i++){var o=a[i];n[o.stateSysName]=o.stateUserName}d.add(h.MATURITY_GRAPH,n),d.add(h.ISSUE_MATURITY_STATE_ATTRIBUTES,s)}},getTemplateMaturity:async function(e){var t={data:e};if(!d.get(h.TEMPLATE_MATURITY_GRAPH)){for(var s=await m.issues.getStatesAttributes(t),n={},a=s.policies[0].states,i=0;i<a.length;i++){var o=a[i];n[o.stateSysName]=o.stateUserName}d.add(h.TEMPLATE_MATURITY_GRAPH,n),d.add(h.TEMPLATE_MATURITY_STATE_ATTRIBUTES,s)}},updateIssueMaturityClass:async function(){var e=d.get(h.ISSUE_MATURITY_STATE_ATTRIBUTES);o.addCSSMaturityClasses("wux-controls-label",e)},updateTemplateMaturityClass:async function(){var e=d.get(h.TEMPLATE_MATURITY_STATE_ATTRIBUTES);o.addCSSMaturityClasses("wux-controls-label",e)},fetchAndUpdatePredicate:function(t,n,a){if(n.length>0){let o=[];n.forEach((e=>{e.options.predicates&&Object.keys(e.options.predicates).includes(a)||o.push(e.options.id)}));var i=o.map((function(e,t){return{physicalId:e}}));return i.length>0?m.fetch({data:{objects:i,predicates:[a],fetchSinglePredicate:!0}}).then((function(e){Array.isArray(e.body.results)&&t.withTransactionUpdate((function(){let t={};e.body.results.forEach((e=>{var n="";e.attributes.forEach((e=>{if("resourceid"===(s.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name))n=e.value})),t[n]=e.attributes}));for(var a=0;a<n.length;a++){var i=n[a],o=t[i.options.id],r={};o&&(o.forEach((e=>{var t=s.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name,n=e.dispValue?e.dispValue:e.value;r[t]=n})),i.updateOptions({predicates:r}))}}))})):e.resolve()}return e.resolve()},getFetchPredicates:function(){return h.FETCH_PREDICATES},updateSubTypesandExtensions:async function(e,t){if(t.length>0){try{var n=[h.ISSUE_TYPE],a=d.get(h.ISSUE_TYPES);let e;if(a||(a=await m.type.getSubType(),d.add(h.ISSUE_TYPES,a)),null!=a&&Object.keys(a).length>0&&(n=Object.keys(a)),sessionStorage.getItem(h.ISSUE_EXTENSIONS)){let t=JSON.parse(sessionStorage.getItem(h.ISSUE_EXTENSIONS));n.push(...Object.keys(t)),e=n,d.add(h.ISSUE_EXTENSIONS,t)}else e=await this.getTypeExtensions(n);var i={"ds6w:type":e,"ds6w:organizationResponsible":[u.getCurrentCredentials().organization],"ds6w:project":[u.getCurrentCredentials().collaborativeSpace]};let t=await m.getNLSValuesPromise(i);d.add(h.BASE_NLS,t)}catch(e){this._logger.error(e)}e.withTransactionUpdate((function(){for(var e=0;e<t.length;e++){var n=t[e],a=d.get(h.BASE_NLS);if(a&&a["ds6w:type"]&&Object.keys(a["ds6w:type"]).includes(n.options.type))n.updateOptions({grid:{"ds6w:type":a["ds6w:type"][n.options.type],type:n.options.type,typeNLS:a["ds6w:type"][n.options.type]}});else{var i={"ds6w:type":[n.options.type]};m.getNLSValuesPromise(i).then((e=>{s.is(e)&&s.is(e["ds6w:type"])&&s.is(e["ds6w:type"][n.type])&&n.updateOptions({grid:{"ds6w:type":e["ds6w:type"][n.options.type],type:n.options.type,typeNLS:e["ds6w:type"][n.options.type]}})}))}var o=d.get(h.ISSUE_EXTENSIONS);if(o){const e=[];Object.keys(o).forEach((t=>{let s=t.replace("ds6w:","");s=t.replace("ds6wg:",""),e.push(t)})),n.updateOptions({grid:{interfaces:e,interfacesNLS:o}})}}}))}},updateClassificationsAndInterfaces:async function(t,s){var n=[];if(0==s.length)return e.resolve();for(var a=0;a<s.length;a++)n.push(s[a].options.physicalId);var i=await m.classification.getClassifications({version:"1.0",ids:n});this.updateClassificationInNode(t,s,i)},updateClassificationInNode:function(e,t,s){var n=[];if(s){for(var a=s.body,i={},o=0;o<a.length;o++){var r=a[o],l=r.issueId,c={};c.classes=r.classes,i[l]=c,n.push(...r.interfaces)}var d=new Set(n);e.undoRegisterNodeModelUpdateEvent(),e.withTransactionUpdate((function(){for(var e=0;e<t.length;e++){var s=t[e],n={};if(n.classes=[],i[s.options.physicalId])i[s.options.physicalId].classes.forEach((function(e){var t={id:e.id,name:e.name,NLS:e.NLS,attrs:[]};e.attributes.forEach((function(e){var s={name:e.name,type:e.type,NLS:e.NLS,curi:e.curi};t.attrs.push(s)})),n.classes.push(t)})),s.updateOptions({grid:n});if(d){const e=[];d.forEach((t=>{let s=t.replace("ds6w:","");s=t.replace("ds6wg:",""),e.push(t)})),s.updateOptions({grid:{interfaces:e}})}}}))}e.registerNodeModelUpdateEvent()},getNLSValues:async function(e){if(e.length>0)try{var t=[],s=[],n=[];e.forEach((e=>{t.push(e.organization),s.push(e.collaborativeSpace),n.push(e.type)})),t=[...new Set(t)],s=[...new Set(s)];var a={"ds6w:type":n=[...new Set(n)],"ds6w:organizationResponsible":t,"ds6w:project":s};let i=await m.getNLSValuesPromise(a);d.add(h.BASE_NLS,i)}catch(e){this._logger.error(e)}else{n=[h.ISSUE_TYPE],t=[u.getCurrentCredentials().organization],s=[u.getCurrentCredentials().collaborativeSpace],a={"ds6w:type":n,"ds6w:organizationResponsible":t,"ds6w:project":s};let e=await m.getNLSValuesPromise(a);d.add(h.BASE_NLS,e)}},getTypeExtensions:function(t){return new e((function(e,s){let n=[],a={};for(let e of t)n.push(e);m.type.getClassExtensionInterface({classList:t}).then((t=>{t.results.forEach((e=>{e.interfaces.forEach((e=>{e.automatic||(a[e.name]=e.nlsName)}))})),sessionStorage.setItem(h.ISSUE_EXTENSIONS,JSON.stringify(a)),d.add(h.ISSUE_EXTENSIONS,a),n.push(...Object.keys(a)),e(n)}))}))},updateTypeAttributes:async function(){if(!d.get(h.CUSTOM_ATTR_INFOS)){let e=await this.getTypeProperties();d.add(h.CUSTOM_ATTR_INFOS,e),this.customAttrRangeVals(e)}},getTypeProperties:function(){return new e((function(e,t){let n=d.get(h.BASE_NLS),a=[];n&&s.is(n["ds6w:type"])&&(a=Object.keys(n["ds6w:type"]));let i=a.toString();m.type.getProperties(i).then((t=>{if(Array.isArray(t.classPredicates)){let s=t.classPredicates.map((e=>{if(null!=e&&Array.isArray(e.vocabularyPredicateInfo))return e.vocabularyPredicateInfo})).filter((function(e){return void 0!==e})),n=[];s.map((e=>{let t=e.filter((e=>{if(e.hasOwnProperty("userAccess"))return e}));n.push(...t)}));const a=[...new Set(n.map((e=>JSON.stringify(e))))].map((e=>JSON.parse(e)));e(a)}}))}))},customAttrRangeVals:function(e){const t=e.reduce((function(e,t){return null!=t.rangeValues&&(e[t.name]=t.rangeValues),e}),{});d.add(h.CUSTOM_ATTR_NLS,t)},isI3dxInSelectedNodes:function(e){var t=!1;return e.forEach((e=>{if(e._options&&e._options.id&&e._options.id.includes("i3dx"))return t=!0})),t},buildDnDPayload:function(e){var t=d.get("widget")||window.widget;return{protocol:"3DXContent",version:"2.1",source:t.name,widgetId:t.id,data:{items:e.items}}}}})),define("DS/IssueComponents/team/MembersMakeDroppable",["DS/DataDragAndDrop/DataDragAndDrop","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n){"use strict";var a={makeDroppable:function(s,i){e.droppable(s,{drop:function(e,o,r){if(r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault(),r.dataTransfer&&r.dataTransfer.dropEffect&&(r.dataTransfer.dropEffect="copy"),UWA.is(e)&&""!=e){var l=JSON.parse(e);a.ExecuteDrop(l,i)}else t.displayNotification({msg:n.team.error.dropNotSupported,eventID:"error"});s.style.borderWidth="0px"},over:function(){arguments[0].setStyles({borderStyle:"solid",borderColor:"#368ec4",borderWidth:"1px"})},leave:function(){arguments[0].setStyle("borderWidth","0px")}})},ExecuteDrop:function(e,s){if(e){var a=e.data.items;UWA.is(a)&&UWA.is(a.length)&&a.length>0&&s(a)}else t.displayNotification({msg:n.team.error.dropNotSupported,eventID:"error"})}};return a})),define("DS/IssueComponents/external/CollaborativeLifecycle",[],(function(){"use strict";return{execute:function(e){require(["DS/LifecycleCmd/MaturityCmd","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],(function(t,s,n){s.get("widget");var a=[];if(e.forEach((function(e){if(e.contains(",")){var t=e.split(",");e=t[t.length-1]}a.push({physicalId:e})})),a.length>0){var i={};i.context={getSecurityContext:function(){return n.getSecurityContext()}},new t(i).executeAsync(a).then((function(){}))}}))}}})),define("DS/IssueComponents/models/TreeNodeModel",["UWA/Core","DS/TreeModel/TreeNodeModel"],(function(e,t){"use strict";function s(s){s=e.extend({id:"",label:"",icons:[],grid:{},type:""},s),t.call(this,s)}return s.prototype=Object.create(t.prototype),s.prototype.getID=function(){return this.options.id},s})),define("DS/IssueComponents/external/Compare",[],(function(){"use strict";var e={WIDTH:700,HEIGHT:800};return{execute:function(t){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],(function(s,n,a){var i=[];n.get("widget");if(t.forEach((function(e){i.push({envId:a.getTenant(),serviceId:e.serviceId?e.serviceId:"3DSpace",contextId:a.getSecurityContexts().securityContext,objectId:e.physicalId,objectType:e.type,displayName:""})})),i.length>0){var o={protocol:"3DXContent",version:"1.1",source:n.get("widget").name,data:{items:i}},r={mode:"panel",height:e.HEIGHT,width:e.WIDTH};s.showWidget("ENOCOMP_AP","",{X3DContentId:JSON.stringify(o),x3dPlatformId:a.getTenant()},r)}}))}}})),define("DS/IssueComponents/create/Custom",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Date","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Number","DS/UIKIT/Input/Toggle","DS/IssueServices/services/IssueServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d){"use strict";return t.extend({})})),define("DS/IssueComponents/delete/Delete",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/ProgressBar","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h){"use strict";var v="Create";return t.extend({name:"DS/IssueComponents/delete/Delete",tag:"div",className:"delete-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=l.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the delete component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e((function(e,t){s._deferred.resolve=e,s._deferred.reject=t}))},render:function(){var e=this;return f.start(e.name+" render"),e.dialog().then((function(){e._deferred.resolve()}),(function(){e._deferred.reject()})),f.end(e.name+" render"),e},destroy:function(){var e=this;f.start(e.name+" destroy"),e.physicalIds=[],e.issues={},e.titles=[],e.names=[],e.indelible=[],e.validate=null,e.modal.destroy(),e.modal=null,e.isLoaded=null,e._deferred={resolve:null,reject:null},f.end(e.name+" destroy")},dialog:function(){var e=this,t=u.get("widget")||window.widget;return a.mask(e.container),e.modal=new r({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"delete-issues-dialog",title:h.delete.preparing,header:null,body:e.container,footer:[e.validate=new n({value:h.delete.delete,className:"primary",events:{onClick:function(){e.container.getChildren()[0].addClassName("disableContent"),e.modal.elements.footer.addClassName("disableContent"),e.buildProgressBar().inject(e.container),e._delete().then((function(){e.destroy()}))}},disabled:!0}),new n({value:h.delete.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then((function(t){t.inject(e.container),e.physicalIds.length>0?(e.validate.enable(),e.modal.setTitle(h.replace(h.delete.title,{number:e.physicalIds.length})),0===e.indelible.length&&(e.container.getElement(".no-delete-issues-label").addClassName("hidden"),e.container.getElement(".no-delete-issues-content").addClassName("hidden"))):(e.validate.disable(),e.modal.setTitle(h.delete.nothing),e.container.getElement(".delete-issues-label").addClassName("hidden"),e.container.getElement(".delete-issues-content").addClassName("hidden")),e.validate.focus(),a.unmask(e.container),new i({element:e.container}).inject(e.modal.getBody())}))},build:function(){var e=this;return f.start(e.name+" build"),e._check(e.getOption("physicalIds")).then((function(t){for(var n=t.deletable,a=t.indelible,i={physicalIds:[],titles:[],icons:[]},o=0;o<n.length;o++)i.physicalIds.push(n[o].physicalId),i.titles.push(n[o].title+" ("+n[o].name+")"),i.icons.push({tag:"span",class:"fonticon fonticon-issue-type "+n[o].state.toLowerCase()});var r=[];i.titles.forEach((function(e,t){r.push(s.createElement("li",{html:[i.icons[t],s.String.escapeHTML(e)],title:e}))}));for(var l={physicalIds:[],titles:[],icons:[]},c=0;c<a.length;c++)l.physicalIds.push(a[c].physicalId),l.titles.push(a[c].title+" ("+a[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue-type "});var d=[];return l.titles.forEach((function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))})),e.physicalIds=i.physicalIds,e.titles=i.titles,e.indelible=l.physicalIds,f.end(e.name+" build"),s.createElement("div",{html:[{tag:"div",class:"delete-issues-label",html:[{tag:"span",class:"delete-issues-label-first",html:h.delete.warning},{tag:"span",class:"delete-issues-label-second",html:h.delete.deletable}]},{tag:"div",class:"delete-issues-content",html:s.createElement("ul",{html:r,class:"delete-issues-content-list"})},{tag:"div",class:"no-delete-issues-label",html:h.delete.indelible},{tag:"div",class:"no-delete-issues-content",html:s.createElement("ul",{html:d,class:"no-delete-issues-content-list"})}]})}))},buildProgressBar:function(){return new o({shape:"circular",infiniteFlag:!0})},_check:function(e){var t=this;return f.start(t.name+" _check"),p.issues.retrieve({data:{objects:e.map((function(e){return{physicalId:e}}))}}).then((function(e){for(var s={deletable:[],indelible:[]},n=0;n<e.results.length;n++){var a=e.results[n].body;s.deletable.push({physicalId:a.physicalId,name:a.name,state:a.state,title:a.title?a.title:""})}return t.issues=s,f.end(t.name+" _check"),s}),(function(e){if(t._logger.error(e),e.error.message.includes("'business object' does not exist")){var s=g.getErrorMessage("0");g.displayErrorMessage(s,"error"),t.destroy()}else c.displayNotification({msg:h.delete.error,eventID:"error"});f.end(t.name+" _check")}))},_delete:function(){var e=this;f.start(e.name+" _delete");var t=u.get("widget")||window.widget;return a.mask(t.body),p.issues.delete({data:{objects:e.physicalIds.map((function(e){return{physicalId:e}}))}}).then((function(s){if(s&&s.body&&s.body.report.length>0){var n=new Set(e.physicalIds);s.body.report.forEach((t=>{n.delete(t.physicalids[0]),e.physicalIds=[...n]}))}var i="";i=1===e.physicalIds.length?h.replace(h.delete.singleSuccess,{title:e.titles[e.titles.length-1]}):h.replace(h.delete.multipleSuccess,{number:e.physicalIds.length}),a.unmask(t.body),c.displayNotification({msg:i,eventID:"success"});var o=e.physicalIds.reduce((function(e,t){return e.push([t]),e}),[]),r=e.physicalIds.reduce((function(t,s,n){return t[s]=e.issues.deletable[n],t}),{});f.end(e.name+" _delete"),d.publish("DS/Object/delete",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now())},data:{paths:o,attributes:r},version:"1.0"})}),(function(s){if(a.unmask(t.body),s.report.length>0&&s.report[0].error.includes(h.delete.deletePrivilege)){var n=h.delete.deletePrivilege;c.displayNotification({msg:n,eventID:"error"})}else if(s.report.length>0&&s.report[0].error.includes("1500028")){var i=g.getErrorMessage("1500028");g.displayErrorMessage(i,"error")}else c.displayNotification({msg:h.delete.error,eventID:"error"});f.end(e.name+" _delete"),e._logger.error("Cannot delete the selected issue(s) because %o",s)}))},utils:{isDeletable:function(e){return e.state===v}}})})),define("DS/IssueComponents/templates/TemplatesToolbar",["DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s){var n=Object.create(null);return n.toolbar=null,n._templateCommands={single:{enable:["clone","edit","delete","share","customizeDatagridView"],disable:[]},multi:{enable:["delete","share","customizeDatagridView"],disable:["clone","edit"]},empty:{enable:["customizeDatagridView"],disable:["clone","edit","delete","share"]},idling:["clone","edit","delete","share","customizeDatagridView"]},n.writetoolbarDefination=function(){var e={entries:[{id:"create",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"plus",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"createTemplate"},position:"far",category:"create",priority:1,label:s.templates.iconBar.create}},{id:"fromIssue",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"export",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"createFromIssue"},position:"far",category:"create",priority:1,label:s.templates.iconBar.fromIssue}},{id:"clone",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"duplicate",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"duplicateTemplate"},disabled:!0,visibleFlag:!1,position:"far",category:"create",priority:1,label:s.templates.iconBar.clone}},{id:"edit",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"pencil",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"editTemplate"},disabled:!0,visibleFlag:!1,position:"far",category:"modify",priority:1,label:s.templates.iconBar.edit}},{id:"delete",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"trash",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"removeTemplate"},disabled:!0,visibleFlag:!1,position:"far",category:"modify",priority:1,label:s.templates.iconBar.delete}},{id:"share",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"forward",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"shareTemplate"},disabled:!0,visibleFlag:!1,position:"far",category:"actions",priority:1,label:s.templates.iconBar.share}},{id:"customizeDatagridView",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"cog",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"customizeColumnView"},disabled:!0,visibleFlag:!1,priority:1,position:"far",category:"actions",label:s.templates.iconBar.columnCustomization}}]};return JSON.stringify(e)},n.createTemplate=function(e){e._event="createTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"NewIssueTemplate",pd5:"IssueTemplate/DataGridView/TemplateToolbar/NewIssueTemplate"}})}catch(e){}},n.createFromIssue=function(e){e._event="fromIssue",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"NewFromIssue",pd5:"IssueTemplate/DataGridView/TemplateToolbar/NewFromIssue"}})}catch(e){}},n.duplicateTemplate=function(e){e._event="duplicateTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"Duplicate",pd5:"IssueTemplate/DataGridView/TemplateToolbar/Duplicate"}})}catch(e){}},n.editTemplate=function(e){e._event="editTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"Edit",pd5:"IssueTemplate/DataGridView/TemplateToolbar/Edit"}})}catch(e){}},n.removeTemplate=function(e){e._event="removeTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"Remove",pd5:"IssueTemplate/DataGridView/TemplateToolbar/Remove"}})}catch(e){}},n.shareTemplate=function(e){e._event="shareTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"Share",pd5:"IssueTemplate/DataGridView/TemplateToolbar/Share"}})}catch(e){}},n.customizeColumnView=function(e){e._event="columnCustomization",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"CustomView",pd5:"IssueTemplate/DataGridView/TemplateToolbar/CustomView"}})}catch(e){}},n.select=function(e){var t=[],s=[];e&&0!==e.length?1==e.length?(t=t.concat(n._templateCommands.single.enable),s=s.concat(n._templateCommands.single.disable)):(t=t.concat(n._templateCommands.multi.enable),s=s.concat(n._templateCommands.multi.disable)):(t=t.concat(n._templateCommands.empty.enable),s=s.concat(n._templateCommands.empty.disable)),n.enable(t),n.disable(s)},n.idling=function(){n.disable(n._templateCommands.idling)},n.enable=function(e){var t=this;e.forEach((e=>{t.toolbar.updateNodeModel(e,{disabled:!1,visibleFlag:!0})}))},n.disable=function(e){var t=this;e.forEach((e=>{t.toolbar.updateNodeModel(e,{disabled:!0,visibleFlag:!1})}))},n})),define("DS/IssueComponents/templates/model/TemplatesTreeNodeModel",["UWA/Core","DS/TreeModel/TreeNodeModel"],(function(e,t){"use strict";function s(s){s=e.extend({id:"",physicalId:"",label:"",icons:[],grid:{},type:"",children:[],useAsyncPreExpand:!0,matchSearchNavigation:!1},s),t.call(this,s)}function n(e){e._getFilterInfo||(e.filterInChild=s.prototype.filterInChild.bind(e),e.filterOutChild=s.prototype.filterOutChild.bind(e),e._getFilterInfo=s.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=s.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=s.prototype._removeChildrenFilterInfo.bind(e))}return s.prototype=Object.create(t.prototype),s.prototype.getOccurrencePath=function(t){var s=this;if(e.is(t,"function")&&t(this),!s.isRoot()&&s.getParent()){var n=s.getParent().getOccurrencePath(t);return n.push(s.options.id),n.push(s.options.data.relationToIssue),n}return[s.options.id]},s.prototype.getNodesById=function(e){var t={listOfNodesFound:[]};return this._getNodesById(e,t),t.listOfNodesFound},s.prototype._getNodesById=function(e,t){var s=this,n=!1;if(s.options.id===e)t.listOfNodesFound.push(s),n=!0;else{var a=s.getChildren();if(a)for(var i=0;i<a.length;i++)n=a[i]._getNodesById(e,t)||n}return n},s.prototype.matchSearchNavigation=function(){this.options.matchSearchNavigation=!0},s.prototype.unmatchSearchNavigation=function(){this.options.matchSearchNavigation=!1},s.prototype.getID=function(){return this.options.id},s.prototype.filterOut=function(){var e=this,t=e.isRoot()?e.getTreeDocument():e.getParent();null!==t&&(n(t),t.filterOutChild(e))},s.prototype.filterOutChild=function(t){var s=this,n=s.getChildren();if(n.indexOf(t)<0)throw new Error("This is not a child");var a=s._getChildrenFilterInfo(!0);if(!a.childrenBeforeFiltering){a.childrenBeforeFiltering=n&&n.length>0?n.slice(0):[];e.is(s._expandState)&&(a.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[s._expandState])}t._getFilterInfo(!0).parentBeforeFiltering=s,e.is(s.removeChild,"function")?s.removeChild(t):s.removeRoot(t,!0,!0),e.is(s.setState,"function")&&s.setState({state:a.expandStateBeforeFiltering}),a.filteredOutChildren||(a.filteredOutChildren=[]),a.filteredOutChildren.push(t)},s.prototype.filterIn=function(e){var t=this,s=t._getFilterInfo();if(s&&s.parentBeforeFiltering){var a=s.parentBeforeFiltering;n(a),a.filterInChild(t)}if(!0===e){var i=null,o=t._getChildrenFilterInfo();(i=o&&o.childrenBeforeFiltering?o.childrenBeforeFiltering:t.getChildren())&&Array.isArray(i)&&i.forEach((function(t){t.filterIn(e)}))}},s.prototype.filterInChild=function(t){var s=this,n=s._getChildrenFilterInfo();if(n&&n.childrenBeforeFiltering){var a=n.childrenBeforeFiltering.indexOf(t);if(a>=0){var i=t._getFilterInfo();if(i&&i.parentBeforeFiltering===s){var o=s.getChildren(),r=null;if(o&&Array.isArray(o))for(var l=0;l<o.length;l++){var c=o[l];if(n.childrenBeforeFiltering.indexOf(c)>a){r=c;break}}delete i.parentBeforeFiltering,t.options&&t.options.isRootAttached?!0===t.options.isRootAttached&&s.insertBefore(t,r):s.insertBefore(t,r),e.is(s.setState,"function")&&s.setState({state:n.expandStateBeforeFiltering}),t._removeFilterInfo();var d=n.filteredOutChildren.indexOf(t);n.filteredOutChildren.splice(d,1),0===n.filteredOutChildren.length&&s._removeChildrenFilterInfo()}}}},s.prototype._removeFilterInfo=function(){delete this.options._filterInfo},s.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},s.prototype._getFilterInfo=function(e){var t=this;return!t.options._filterInfo&&e&&(t.options._filterInfo={}),t.options._filterInfo},s.prototype._getChildrenFilterInfo=function(e){var t=this;return!t.options._childrenFilterInfo&&e&&(t.options._childrenFilterInfo={}),t.options._childrenFilterInfo},s})),define("DS/IssueComponents/reopen/Reopen",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h){"use strict";var v="Closed";return t.extend({name:"DS/IssueComponents/reopen/Reopen",tag:"div",className:"isu-reopen-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=l.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the reopen component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.fields={},s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e((function(e,t){s._deferred.resolve=e,s._deferred.reject=t}))},render:function(){var e=this;return f.start(e.name+" render"),e.dialog().then(e._deferred.resolve,e._deferred.reject),f.end(e.name+" render"),e},destroy:function(){var e=this;f.start(e.name+" destroy"),e.physicalIds=[],e.issues={},e.titles=[],e.names=[],e.indelible=[],e.fields={},e.validate=null,e.modal.destroy(),e.modal=null,e.isLoaded=null,e._deferred={resolve:null,reject:null},f.end(e.name+" destroy")},dialog:function(){var e=this,t=u.get("widget");return i.mask(e.container),e.modal=new r({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"isu-reopen-dialog",title:h.reopen.preparing,header:null,body:e.container,footer:[e.validate=new n({value:h.reopen.reopen,className:"primary",events:{onClick:function(){e.reopen().then((function(){e.destroy()}))}},disabled:!0}),new n({value:h.reopen.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then((function(t){t.inject(e.container),e.physicalIds.length>0?(e.validate.enable(),e.modal.setTitle(h.replace(h.reopen.title,{number:e.physicalIds.length})),0===e.indelible.length&&(e.container.getElement(".isu-reopen-no-issues-label").addClassName("hidden"),e.container.getElement(".isu-reopen-no-issues-content").addClassName("hidden"))):(e.validate.disable(),e.modal.setTitle(h.reopen.nothing),e.container.getElement(".isu-reopen-label").addClassName("hidden"),e.container.getElement(".isu-reopen-content").addClassName("hidden")),e.validate.focus(),i.unmask(e.container),new o({element:e.container}).inject(e.modal.getBody())}))},build:function(){var e=this;return f.start(e.name+" build"),e._check(e.getOption("physicalIds")).then((function(t){var n="";s.is(t,"object")&&s.is(t.closable,"array")&&1===t.closable.length&&(n=t.closable[0].resolutionRecommendation);for(var i=s.createElement("div",{class:"isu-reopen-form",html:[{tag:"h5",class:"",html:h.create.properties.labels.resolutionRecommendation},e.fields.resolutionRecommendation=new a({name:"isu-reopen-resolution-recommendation ",id:"isu-reopen-resolution-recommendation",className:"isu-reopen-resolution-recommendation",value:n,multiline:!0,required:!1,placeholder:h.create.properties.labels.resolutionRecommendationPlaceholder})]}),o=t.closable,r=t.indelible,l={physicalIds:[],titles:[],icons:[]},c=0;c<o.length;c++)l.physicalIds.push(o[c].physicalId),l.titles.push(o[c].title+" ("+o[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue-type "+o[c].state.toLowerCase()});var d=[];l.titles.forEach((function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))}));for(var u={physicalIds:[],titles:[],icons:[]},m=0;m<r.length;m++)u.physicalIds.push(r[m].physicalId),u.titles.push(r[m].title+" ("+r[m].name+")"),u.icons.push({tag:"span",class:"fonticon fonticon-issue-type "+r[m].state.toLowerCase()});var p=[];u.titles.forEach((function(e,t){p.push(s.createElement("li",{html:[u.icons[t],s.String.escapeHTML(e)],title:e}))})),e.physicalIds=l.physicalIds,e.titles=l.titles,e.indelible=u.physicalIds,f.end(e.name+" build");var g=s.createElement("div",{class:"isu-reopen-list",html:[{tag:"div",class:"isu-reopen-label",html:[{tag:"span",class:"isu-reopen-label-first",html:h.reopen.warning},{tag:"span",class:"isu-reopen-label-second",html:h.reopen.closable}]},{tag:"div",class:"isu-reopen-content",html:s.createElement("ul",{html:d,class:"isu-reopen-content-list"})},{tag:"div",class:"isu-reopen-no-issues-label",html:h.reopen.indelible},{tag:"div",class:"isu-reopen-no-issues-content",html:s.createElement("ul",{html:p,class:"isu-reopen-no-issues-content-list"})}]}),v=s.createElement("div",{html:[]});return e.physicalIds.length>0&&i.inject(v),g.inject(v),v}))},_check:function(e){var t=this;return f.start(t.name+" _check"),p.issues.retrieve({data:{objects:e.map((function(e){return{physicalId:e}}))}}).then((function(e){for(var s={closable:[],indelible:[]},n=0;n<e.results.length;n++){var a=e.results[n].body;!0===t.utils.isReopenable(a)?s.closable.push({physicalId:a.physicalId,name:a.name,state:a.state,title:a.title?a.title:"",resolutionRecommendation:a.resolutionRecommendation,coOwners:a.coOwners}):s.indelible.push({physicalId:a.physicalId,name:a.name,state:a.state,title:a.title?a.title:"",resolutionRecommendation:a.resolutionRecommendation})}return t.issues=s,f.end(t.name+" _check"),s}),(function(e){t._logger.error(e),c.displayNotification({msg:h.reopen.error,eventID:"error"}),f.end(t.name+" _check")}))},reopen:function(){var e=this;f.start(e.name+" reopen");var t=u.get("widget");i.mask(t.body);var s=e.fields.resolutionRecommendation.getValue().trim();return p.issues.reopen({data:{objects:e.physicalIds.map((function(e){var t={physicalId:e};return""!==s&&(t.resolutionRecommendation=s),t}))}}).then((function(s){var n=[],a=[];s.results.forEach((e=>{e.body&&e.body.error&&e.body.error.length>0&&e.body.error.forEach((e=>{n.includes(e)||n.push(e)})),e.body&&e.body.warning&&e.body.warning.length>0&&e.body.warning.forEach((e=>{a.includes(e)||a.push(e)}))}));var o="";o=1===e.physicalIds.length&&0==n.length&&0==a.length?h.replace(h.reopen.singleSuccess,{title:e.titles[e.titles.length-1]}):h.replace(h.reopen.multipleSuccess,{number:e.physicalIds.length}),i.unmask(t.body);const r=e.physicalIds.length-a.length-n.length;if(a.length>0&&0==r){o="";a.forEach((e=>{o+=e})),n.forEach((e=>{o+=warning})),c.displayNotification({msg:o,eventID:"warning"})}else if(n.length>0&&0==r){o="";n.forEach((e=>{o+=e})),c.displayNotification({msg:o,eventID:"error"})}else(a.length>0||n.length>0)&&0!=r?c.displayNotification({msg:h.successPartial,eventID:"warning"}):c.displayNotification({msg:o,eventID:"success"});var l=e.issues.closable.every((function(e){if(e&&e.coOwners)return e.coOwners.some((e=>e.user==m.getUserName()))})),u=e.physicalIds.reduce((function(e,t){return e.push([t]),e}),[]),p=e.physicalIds.reduce((function(t,s,n){return t[s]=e.issues.closable[n],t[s].state=l?"Active":"Create",t[s].type="Issue",t[s].modifiedAttributes=["state"],t}),{});f.end(e.name+" reopen"),d.publish("DS/Object/update",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now())},data:{paths:u,attributes:p},version:"1.0"})}),(function(s){if(i.unmask(t.body),s.error&&s.error.internal&&s.error.internal.includes("You do not have the permissions to perform this action")){var n=g.getErrorMessage("1005");g.displayErrorMessage(n,"error")}else c.displayNotification({msg:s.error.message,eventID:"error"});f.end(e.name+" reopen"),e._logger.error("Cannot reopen the selected issue(s) because %o",s)}))},utils:{isReopenable:function(e){return e.state===v}}})})),define("DS/IssueComponents/close/Close",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/ComboBox","DS/Controls/Editor","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b){"use strict";var C="Closed",I="Issue Resolved",y="Issue Cancelled";return t.extend({name:"DS/IssueComponents/close/Close",tag:"div",className:"isu-close-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=d.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the close component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.fields={},s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e((function(e,t){s._deferred.resolve=e,s._deferred.reject=t}))},render:function(){var e=this;return h.start(e.name+" render"),e.dialog().then(e._deferred.resolve,e._deferred.reject),h.end(e.name+" render"),e},destroy:function(){var e=this;h.start(e.name+" destroy"),e.physicalIds=[],e.issues={},e.titles=[],e.names=[],e.indelible=[],e.fields={},e.validate=null,e.modal.destroy(),e.modal=null,e.isLoaded=null,e._deferred={resolve:null,reject:null},h.end(e.name+" destroy")},dialog:function(){var t=this;p.get("widget")||window.widget;return i.mask(t.container),t.build().then((function(s){if(0==t.listOfDropdownElement)return u.displayNotification({msg:b.completionNotAllowed,eventID:"error"}),new e((e=>{e()}));if(t.createDialog(),s.inject(t.container),t.physicalIds.length>0&&t.listOfDropdownElement.length>0){t.validate.enable();var n="";n=t.physicalIds.length>1?b.replace(b.close.titleMultiple,{number:t.physicalIds.length}):b.replace(b.close.titleSingle,{number:t.physicalIds.length}),t.modal.setTitle(n),0===t.indelible.length&&(t.container.getElement(".isu-close-no-issues-label").addClassName("hidden"),t.container.getElement(".isu-close-no-issues-content").addClassName("hidden"))}else t.validate.disable(),t.modal.setTitle(b.close.nothing),t.container.getElement(".isu-close-label").addClassName("hidden"),t.container.getElement(".isu-close-content").addClassName("hidden");t.validate.focus(),i.unmask(t.container),new o({element:t.container}).inject(t.modal.getBody())}))},build:function(){var e=this;return h.start(e.name+" build"),e._check(e.getOption("physicalIds")).then((function(t){var n=t.closable,a=t.indelible,i=e.getToBeClosedInfo(n);e.listOfDropdownElement=e.getDropdownElement(i);var o=e.getComboboxForm(e.listOfDropdownElement);e.completionForm=e.getCompletionForm(t,e.fields.myComboBox.value);var r=[];i.titles.forEach((function(e,t){r.push(s.createElement("li",{html:[i.icons[t],s.String.escapeHTML(e)],title:e}))}));for(var l={physicalIds:[],titles:[],icons:[]},c=0;c<a.length;c++)l.physicalIds.push(a[c].physicalId),l.titles.push(a[c].title+" ("+a[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue-type "});var d=[];l.titles.forEach((function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))})),e.physicalIds=i.physicalIds,e.titles=i.titles,e.indelible=l.physicalIds,h.end(e.name+" build");var u=s.createElement("div",{class:"isu-close-list",html:[{tag:"div",class:"isu-close-label",html:[{tag:"span",class:"isu-close-label-first",html:b.close.warning},{tag:"span",class:"isu-close-label-second",html:b.close.closable}]},{tag:"div",class:"isu-close-content",html:s.createElement("ul",{html:r,class:"isu-close-content-list"})},{tag:"div",class:"isu-close-no-issues-label",html:b.close.indelible},{tag:"div",class:"isu-close-no-issues-content",html:s.createElement("ul",{html:d,class:"isu-close-no-issues-content-list"})}]}),m=s.createElement("div",{html:[]});return e.physicalIds.length>0&&(o.inject(m),e.completionForm.inject(m),e.ele=e.completionForm.getElementsByClassName("isu-completion-form-required-label highlight wux-ui-3ds-required wux-ui-3ds")[0],1==i.allowedClosureTypes.length&&i.allowedClosureTypes[0]===I&&(e.ele.hide(),e.fields.completionStatement.requiredFlag=!1)),u.inject(m),m}))},getToBeClosedInfo:function(e){for(var t={physicalIds:[],titles:[],icons:[],allowedClosureTypes:[]},s=0;s<e.length;s++){t.physicalIds.push(e[s].physicalId),t.titles.push(e[s].title+" ("+e[s].name+")"),t.icons.push({tag:"span",class:"fonticon fonticon-issue-type "});for(var n=0;n<e[s].allowedClosureTypes.length;n++)t.allowedClosureTypes.includes(e[s].allowedClosureTypes[n])||t.allowedClosureTypes.push(e[s].allowedClosureTypes[n])}return t},getDropdownElement:function(e){for(var t=[],s=0;s<e.allowedClosureTypes.length;s++){var n=e.allowedClosureTypes[s];if(n){var a={label:n===y?b[y]:b[I],value:n===y?y:I};t[s]=a}}return t},getComboboxForm:function(e){var t=this,n=s.createElement("div",{class:"isu-close-comboboxForm",html:[{tag:"h5",class:"",html:b.completionType},t.fields.myComboBox=new r({enableSearchFlag:!1,elementsList:e,value:e.length>1?y:e[0],selectedIndex:1,disabled:!(e.length>1)})]});return n.addEventListener("change",(function(e){var s=t.fields.myComboBox.value;s===I&&(t.ele.hide(),t.fields.completionStatement.requiredFlag=!1),s===y&&(t.ele.show(),t.fields.completionStatement.requiredFlag=!0)})),n},_check:function(e){var t=this;return h.start(t.name+" _check"),g.issues.retrieve({data:{objects:e.map((function(e){return{physicalId:e}}))}}).then((function(e){for(var s={closable:[],indelible:[]},n=0;n<e.results.length;n++){var a=e.results[n].body;!0===t.utils.isClosable(a)?s.closable.push({physicalId:a.physicalId,name:a.name,state:a.state,title:a.title?a.title:"",resolutionStatement:a.resolutionStatement,allowedClosureTypes:a.allowedClosureTypes}):s.indelible.push({physicalId:a.physicalId,name:a.name,state:a.state,title:a.title?a.title:"",resolutionStatement:a.resolutionStatement})}return t.issues=s,h.end(t.name+" _check"),s}),(function(e){t._logger.error(e),u.displayNotification({msg:b.close.error,eventID:"error"}),h.end(t.name+" _check")}))},close:function(){var t=this;h.start(t.name+" close");var n=p.get("widget")||window.widget;i.mask(n.body);var a="",o=t.fields.myComboBox.value;return o===I&&t.fields.completionStatement.value&&(a=t.fields.completionStatement.value.trim()),o===y&&(t.fields.completionStatement.value&&(a=t.fields.completionStatement.value.trim()),0===a.length)?new e((function(e,t){u.displayNotification({msg:b.create.validationFailed,eventID:"error"}),i.unmask(n.body),t()})):g.issues.close({data:{objects:t.physicalIds.map((function(e){var s={physicalId:e};return""!==a&&(s.resolutionStatement=a),s.completionType=t.fields.myComboBox.value,s}))}}).then((function(e){var s=[],a=[];e.results.forEach((e=>{e.body&&e.body.error&&e.body.error.length>0&&e.body.error.forEach((e=>{s.includes(e)||s.push(e)})),e.body&&e.body.warning&&e.body.warning.length>0&&e.body.warning.forEach((e=>{a.includes(e)||a.push(e)}))}));var o="";o=1===t.physicalIds.length&&0==s.length&&0==a.length?b.replace(b.close.singleSuccess,{title:t.titles[t.titles.length-1]}):b.replace(b.close.multipleSuccess,{number:t.physicalIds.length}),i.unmask(n.body);const r=t.physicalIds.length-a.length-s.length;if(a.length>0&&0==r){o="";a.forEach((e=>{o+=e})),s.forEach((e=>{o+=warning})),u.displayNotification({msg:o,eventID:"warning"})}else if(s.length>0&&0==r){o="";s.forEach((e=>{o+=e})),u.displayNotification({msg:o,eventID:"error"})}else(a.length>0||s.length>0)&&0!=r?u.displayNotification({msg:b.successPartial,eventID:"warning"}):u.displayNotification({msg:o,eventID:"success"});var l=t.physicalIds.reduce((function(e,t){return e.push([t]),e}),[]),c=t.physicalIds.reduce((function(e,s,n){return e[s]=t.issues.closable[n],e[s].state="Closed",e[s].type="Issue",e[s].modifiedAttributes=["state"],e}),{});h.end(t.name+" close"),m.publish("DS/Object/update",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now())},data:{paths:l,attributes:c},version:"1.0"})}),(function(e){i.unmask(n.body);var a="";if(e&&e.error&&s.is(e.error.message,"string")&&(a=e.error.message),e.error&&e.error.internal&&e.error.internal.includes("You do not have the permissions to perform this action")){var o=v.getErrorMessage("1005");v.displayErrorMessage(o,"error")}else if(a.includes("Action Taken and Resolution Statement are not filled in")){var r=v.getErrorMessage("5");v.displayErrorMessage(r,"error")}else if(a.includes("Action Taken field is not filled in")){r=v.getErrorMessage("6");v.displayErrorMessage(r,"error")}else if(a.includes("Resolution Statement field is not filled in")){r=v.getErrorMessage("7");v.displayErrorMessage(r,"error")}else if(a.includes("Resolution Date is not filled in")){r=v.getErrorMessage("8");v.displayErrorMessage(r,"error")}else u.displayNotification({msg:e.error.message,eventID:"error"});h.end(t.name+" close"),t._logger.error("Cannot close the selected issue(s) because %o",e)}))},getCompletionForm:function(e,t){var n,a=this,i="";return s.is(e,"object")&&s.is(e.closable,"array")&&1===e.closable.length&&(i=e.closable[0].resolutionStatement),n=s.createElement("div",{class:"isu-completion-form",html:[s.createElement("h5",{class:"isu-completion-header",html:[s.createElement("span",{tag:"h5",class:"isu-completion-statement-label",html:b.cancellationStatement}),s.createElement("span",{class:"isu-completion-form-required-label highlight wux-ui-3ds-required wux-ui-3ds"})]})]}),a.fields.completionStatement=new l({value:i,enableSearchFlag:!1,widthInCharNumber:100,nbRows:2,newLineMode:"shiftEnter",requiredFlag:t==y,resizableFlag:!0}),a.fields.completionStatement._myInput.setStyle("width","100%"),a.fields.completionStatement.inject(n),n},utils:{isClosable:function(e){return e.state!==C}},createDialog:function(){var e=this;e.modal=new c({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"isu-close-dialog",title:b.close.preparing,header:null,body:e.container,footer:[e.validate=new n({value:b.close.close,className:"primary",events:{onClick:function(){e.close().then((function(){e.destroy()})).catch((e=>{console.log(e)}))}},disabled:!0}),new n({value:b.close.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(widget.body)}})})),define("DS/IssueComponents/related/RelatedContentActionBar",["DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s){var n=Object.create(null);n.toolbar=null;var a="ENX3DIR_AP",i="ENXISSU_AP";return n.viewData={menu:[{type:"PushItem",title:s.toolbar.ISU_TOOLTIP_GRID_VIEW,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-view-list"},action:{module:"DS/ENOChgActionGridUX/scripts/View/ChgDataGridLayout",func:"changeView"},tooltip:s.toolbar.ISU_TOOLTIP_GRID_VIEW},{type:"PushItem",title:s.toolbar.ISU_TOOLTIP_TILE_VIEW,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-view-small-tile"},action:{module:"DS/ENOChgActionGridUX/scripts/View/ChgTileViewLayout",func:"changeView"},tooltip:s.toolbar.ISU_TOOLTIP_TILE_VIEW}]},n.writetoolbarDefination=function(t){var n={entries:[{id:"customViewSettings",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"cog",fontIconFamily:1},action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"customViewSettings"},category:"settings",readOnly:!1,position:"far",tooltip:s.toolbar.columnSettings}},{id:"addExistingCommand",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"plus",fontIconFamily:1},category:"add",readOnly:!1,position:"far",tooltip:s.toolbar.addCommand},children:[{id:"addAffectedItem",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.addAffectedItem,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addAffectedItem"},icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addContexts",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.addContexts,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addContexts"},icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addResolvedItems",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.addResolvedItems,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addResolvedItems"},icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addResolvedby",className:"menu",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.addResolvedBy,icon:{iconName:"resolved-by",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"},state:"disabled"},children:[{id:"createTask",title:s.taskAsResolvedBy,type:"PushItem",typeRepresentation:"functionIcon",icon:{iconName:"task",fontIconFamily:1},action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"createTask",argument:{options:t}},priority:1,label:s.taskAsResolvedBy},{id:"changeAction",title:s.caAsResolvedBy,type:"PushItem",typeRepresentation:"functionIcon",icon:{iconName:"change",fontIconFamily:1},action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"createCA",argument:{options:t}},priority:1,label:s.caAsResolvedBy},{id:"addResolvedByUsingSearch",title:s.addExistingAsResolvedBy,type:"PushItem",typeRepresentation:"functionIcon",icon:{iconName:"search",fontIconFamily:1},action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addResolvedBy"},priority:1,label:s.addExistingAsResolvedBy}]}]},{id:"pickCommand",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"location",fontIconFamily:1},visibleFlag:!!e.get("widget")&&(e.get("widget").name===a||e.get("widget").name===i),category:"add",readOnly:!1,position:"far",tooltip:s.toolbar.pickCommand},children:[{id:"pickAffectedItem",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.pickAffectedItem,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickAffectedItem"},icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"pickContexts",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.pickContext,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickContexts"},icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"pickResolvedItems",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.pickResolvedItems,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickResolvedItems"},icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}}]}]};return JSON.stringify(n)},n.pickAffectedItem=function(s){s._event="pickAffectedItem",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"PickAffectedItemsUsingSelector",pd5:"Issue/"+a+"/ContentToolbar/PickAffectedItemsUsingSelector"}})}catch(e){}},n.pickResolvedBy=function(e){e._event="pickResolvedBy",n.toolbar.onToolbarClickCallback(e)},n.pickResolvedItems=function(s){s._event="pickResolvedItems",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"PickResolvedItemsUsingSelector",pd5:"Issue/"+a+"/ContentToolbar/PickResolvedItemsUsingSelector"}})}catch(e){}},n.pickContexts=function(s){s._event="pickContexts",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"PickContextsUsingSelector",pd5:"Issue/"+a+"/ContentToolbar/PickContextsUsingSelector"}})}catch(e){}},n.addAffectedItem=function(s){s._event="addAffectedItem",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"AddAffectedItemsUsingSearch",pd5:"Issue/"+a+"/ContentToolbar/AddAffectedItemsUsingSearch"}})}catch(e){}},n.addResolvedBy=function(s){s._event="addResolvedBy",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"AddResolvedByUsingSearch",pd5:"Issue/"+a+"/ContentToolbar/AddResolvedByUsingSearch"}})}catch(e){}},n.addResolvedItems=function(s){s._event="addResolvedItems",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"AddResolvedItemsUsingSearch",pd5:"Issue/"+a+"/ContentToolbar/AddResolvedItemsUsingSearch"}})}catch(e){}},n.addContexts=function(s){s._event="addContexts",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"AddContextsUsingSearch",pd5:"Issue/"+a+"/ContentToolbar/AddContextsUsingSearch"}})}catch(e){}},n.customViewSettings=function(s){s._event="customViewSettings",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"CustomView",pd5:"Issue/"+a+"/ContentToolbar/CustomView"}})}catch(e){}},n.createTask=function(s){s._event="createTask",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"CreateTask",pd5:"Issue/"+a+"/ContentToolbar/AddContextsUsingSearch"}})}catch(e){}},n.createCA=function(s){s._event="createCA",n.toolbar.onToolbarClickCallback(s);var a=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"ContentToolbar",pd4:"CreateCA",pd5:"Issue/"+a+"/ContentToolbar/AddContextsUsingSearch"}})}catch(e){}},n})),define("DS/IssueComponents/helper/Helper",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/UIKIT/Toggler","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueComponents/utils/Utils","DS/WebappsUtils/WebappsUtils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r){"use strict";var l="Create",c="Assign",d="Active",u="Review",m="Closed",p="minimized";return{name:"DS/IssueComponents/helper/Helper",show:function(t){var n=this;if(n.modal)return null;var i=e.createElement("div",{class:"helper-dialog-body",html:n.getDialogBody()}),o=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,persistId:"ISUHelper",className:"helper-dialog",title:r.helper.dialog.title,header:null,body:i,events:{onClose:function(){o.destroy(),n.modal=null,n.views=null}}}).inject(t),l=e.createElement("span",{class:"right-actions minimize fonticon fonticon-minus"}),c=o.rightButtons.querySelector(".fonticon-cancel");o.rightButtons.insertBefore(l,c),l.addEventListener("click",(function(){n.minimize()})),n.views.minimize={},n.views.minimize.icon=l,o.addEvent("onResizeFloating",(function(){"44px"!==o.elements.container.getStyle("height")&&n.views.minimize.icon.hasClassName(p)&&n.views.minimize.icon.removeClassName(p)}));var d=new s({element:n.views.contentsBody});return o.show(),n.modal=o,d},getBody:function(){for(var t=e.createElement("div",{class:"tooltip-header-body"}),s=[],n=[l,c,d,u,m],a=0;a<n.length;a++){var i="";a===n.length-1&&(i="th-last-row"),s.push(this.getStateHelper(n[a],i))}var o=e.createElement("table");return o.setContent(s),t.setContent(o),t},getStateHelper:function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r.maturity[t.toLowerCase()]}),styles:{"background-color":i.getColorByState(t)}})}),e.createElement("th",{class:"th-description "+s,html:e.createElement("span",{class:"state-description",html:r.helper.states[t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})},getDialogBody:function(){var t=this,s=e.createElement("nav",{class:"tab",html:[e.createElement("li",{class:"tab-item active",id:"state",html:[e.createElement("span",{class:"fonticon fonticon-issue-type "}),r.helper.dialog.tabStates]}),e.createElement("li",{class:"tab-item",id:"shortcut",html:[e.createElement("span",{class:"fonticon fonticon-keyboard"}),r.helper.dialog.tabShortcuts]}),e.createElement("li",{class:"tab-item",id:"workflow",html:[e.createElement("span",{class:"fonticon fonticon-route"}),r.helper.dialog.workflow]})]}),a=new n({container:s,events:{onToggle:function(e){"id"in e&&(Object.keys(t.views.contents).forEach((function(e){t.views.contents[e].hide()})),t.views.contents[e.id].show())}}});t.views={},t.views.contents={},t.views.contents.state=t.state(),t.views.contents.shortcut=t.shortcut(),t.views.contents.workflow=t.workflow(),t.views.contents.shortcut.hide(),t.views.contents.workflow.hide();var i=e.createElement("div",{class:"helper-content-main",html:[t.views.contents.state,t.views.contents.shortcut,t.views.contents.workflow]});return t.views.contentsBody=i,[a,i]},workflow:function(){var t=this,s=e.createElement("div",{class:"helper-content-workflow helper-content-state"});t.lifecycle={Create:{name:"Create",type:"state",index:0,next:["route1","Closed"],organisation:"Reporting",previous:""},route1:{name:"Confirm",type:"route",index:1,organisation:"Reporting",next:["Assign"],previous:""},Assign:{name:"Assign",type:"state",index:2,organisation:"Responsible",next:["route2","Closed"],previous:""},route2:{name:"Approve",type:"route",index:3,organisation:"Responsible",next:["Active"],previous:"Create"},Active:{name:"Active",type:"state",index:4,organisation:"Responsible",next:["route3","Closed"],previous:""},route3:{name:"Confirm",type:"route",index:5,organisation:"Responsible",next:["Review"],previous:""},Review:{name:"Review",type:"state",index:6,organisation:"Reporting",next:["route4","Closed"],previous:""},route4:{name:"Approve",type:"route",index:7,organisation:"Reporting",next:["Closed"],previous:"Active"},Closed:{name:"Closed",type:"state",index:8,organisation:"Reporting",next:[],previous:""}};var n=Object.keys(t.lifecycle);t.grid=e.createElement("table",{class:"helper-workflow-grid"}).inject(s);var a=0,i=0,o=[];n.forEach((function(e){t.lifecycle[e].next.length>0&&(a=a+t.lifecycle[e].next.length-1),""!==t.lifecycle[e].previous&&(i+=1),t.lifecycle[e].organisation.length>0&&(o.includes(t.lifecycle[e].organisation)||o.push(t.lifecycle[e].organisation))}));var l=o.length,c=n.length+2*(n.length-1)+1,d=a+i+5+l+2*(l-1),u=0,m=0;for(u=0;u<d;u++){var p=e.createElement("tr",{class:"helper-workflow-grid-row"}).inject(t.grid);for(m=0;m<c;m++)e.createElement("td",{class:"helper-workflow-grid-cell",html:e.createElement("div",{class:"lifecycle-cell-content"})}).inject(p)}t.grid.getElementsByTagName("tr")[11].setStyle("height","65px");var f=new Array(d);for(u=0;u<d;u++)f[u]=new Array(c);for(var g=0;g<d;g++)for(var h=0;h<c;h++)f[g][h]=t.grid.getChildren()[g].getChildren()[h].getElement(".lifecycle-cell-content");t.graphComponents.cells=f,t.nodes=[];var v=0===a?0:a+2;t.createNodes(f,v,o);var b={forward:t.grid.getChildren().length-1,reverse:1},C=[];t.nodes.forEach((function(e){var s=t.connectNodes(e,f,b);C=C.concat(s)}));var I=[];if(o.length>1){var y=0,E=v+1;for(u=0;u<o.length;u++){var S={name:o[u],start:y,end:E};E=(y=S.end+1)+2,u===o.length-1&&(S.end=d-1),I.push(S)}t.grid.setStyle("background","#f9f9f9"),t.grid.setStyle("border","1px solid");var w=t.grid.getChildren();for(w.forEach((function(e){e.getChildren()[0].getChildren()[0].setStyle("width","30px"),e.getChildren()[0].setStyle("border-right","1px solid")})),u=0;u<I.length;u++){var T=I[u].name;for(y=I[u].start,E=I[u].end,m=y;m<=E;m++)if(u%2==0&&w[m].setStyle("background","#f0f8ff"),m===E){w[m].setStyle("border-bottom","1px solid");var D=w[m].getChildren()[0].getChildren()[0];I[u].caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:r.lifecycle.orgs[T]})}).inject(D)}}}return s.show=function(){s.setStyle("display","table"),C.forEach((function(e){var t=0,s=0,n=0;e.end.c-e.start.c>0?(s=e.start.c,n=e.end.c):(s=e.end.c,n=e.start.c);for(var a=e.start.r,i=s+1;i<n;i++)t+=f[a][i].getSize().width;e.caption.setStyle("width",t)})),I.forEach((function(e){for(var t=0,s=e.start;s<=e.end-1;s++)t+=f[s][0].getSize().height;e.caption.setStyle("width",t),e.caption.setStyle("padding","15px"),e.caption.setStyle("transform-origin","left"),e.caption.setStyle("transform","rotate(-90deg)")}))},s},createNodes:function(e,t,s){for(var n=this,a=Object.keys(n.lifecycle),i=1,o=0;o<a.length;o++){var r={},l=s.indexOf(n.lifecycle[a[o]].organisation),c=0;c=0!==l?t+l+2*l:t,r.cell=n.createNode(n.lifecycle[a[o]],c,i),r.index={r:c,c:i},r.state=n.lifecycle[a[o]],n.nodes.push(r),i+=3}},createNode:function(e,t,s){var n=null;return"state"===e.type?n=this.graphComponents.createStateNode(e,t,s):"route"===e.type&&(n=this.graphComponents.createRouteNode(e,t,s)),n},connectNodes:function(t,s,n){for(var a=this,i=t.state.next.length,o=0,l=0,c=0,d=0,u=[],m=null,p=function(e,t){return a.nodes.find((function(e){return e.state.index===t.index}))},f=function(e,t){return a.nodes.find((function(e){return e.state.index===t.index}))},g=0;g<i;g++){var h=a.lifecycle[t.state.next[g]],v=p(0,h),b=h.index-t.state.index,C=v.index.r-t.index.r;if(1===b)if(o=t.index.r,l=t.index.c+1,0===C){if(a.graphComponents.createHorizontalLine().inject(s[o][l]),l+=1,"Approve"===t.state.name){a.graphComponents.createHorizontalLine().inject(s[o][l]);var I=e.createElement("span",{class:"lifecycle-helper-caption",html:r.lifecycle.paths.approve}).inject(s[o][l]);I.setStyle("position","inherit"),I.setStyle("white-space","pre")}a.graphComponents.createHorizontalConnectorArrowRight(o,l)}else C>0?(a.graphComponents.createHorizontalConnector(0,"left",o,l,"start"),o=(m=a.graphComponents.createVerticalConnector(C-1,"down",o,l)).end.r,l=m.end.c,a.graphComponents.createHorizontalConnector(0,"Right",o,l,"start"),l+=1,a.graphComponents.createHorizontalConnectorArrowRight(o,l)):C<0&&(C=Math.abs(C),a.graphComponents.createHorizontalConnector(0,"left",o,l,"start"),o=(m=a.graphComponents.createVerticalConnector(C-1,"up",o,l)).end.r,l=m.end.c,a.graphComponents.createHorizontalConnector(0,"Right",o,l,"start"),l+=1,a.graphComponents.createHorizontalConnectorArrowRight(o,l));else if(b>1){var y=n.forward-t.index.r-1;b=v.index.c-t.index.c-1,n.forward=n.forward-1,o=t.index.r+1,l=t.index.c,o=(m=a.graphComponents.createVerticalConnector(y,"down",o,l,"end")).end.r,l=m.end.c,o=(m=a.graphComponents.createHorizontalConnector(b,"Right",o,l)).end.r,l=m.end.c,c=m.start.c+1,d=m.start.r,"Create"==t.state.name?m.caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:r.draftStateToClose})}).inject(s[d][c]):m.caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:r.lifecycle.paths.anyStateToClose})}).inject(s[d][c]),u.push(m),y=o-v.index.r-1,o=(m=a.graphComponents.createVerticalConnector(y-1,"up",o,l,"start")).end.r,l=m.end.c,o=(m=a.graphComponents.createVerticalConnectorArrowUp(o,l)).end.r,l=m.end.c}var E=a.lifecycle[t.state.previous];if(void 0!==E){var S=t.index.r-n.reverse-1,w=f(0,E);b=t.index.c-w.index.c-1,o=t.index.r-1,l=t.index.c,o=(m=a.graphComponents.createVerticalConnector(S,"up",o,l,"end")).end.r,l=m.end.c,o=(m=a.graphComponents.createHorizontalConnector(b,"Left",o,l)).end.r,l=m.end.c,c=m.end.c+1,d=m.start.r,m.caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:r.lifecycle.paths.reject})}).inject(s[d][c]),u.push(m),S=w.index.r-o-1,o=(m=a.graphComponents.createVerticalConnector(S-1,"down",o,l,"start")).end.r,l=m.end.c,o=(m=a.graphComponents.createVerticalConnectorArrowDown(o,l)).end.r,l=m.end.c}}return u},state:function(){var t=e.createElement("div",{class:"helper-content helper-content-state"}),s=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:r.helper.dialog.tabStates})}),n=e.createElement("div",{class:"helper-content-body-container"}),a=function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r.maturity[t.toLowerCase()]}),styles:{"background-color":i.getColorByState(t)}})}),e.createElement("th",{class:s,html:e.createElement("span",{class:"th-description",html:r.helper.dialog.states[t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})};t.addContent(s),t.addContent(n);for(var o=[],p=[l,c,d,u,m],f=0;f<p.length;f++){var g="";f===p.length-1&&(g="th-last-row"),o.push(a(p[f],g))}var h=e.createElement("table");return h.setContent(o),n.addContent(h),t},shortcut:function(){var t=e.createElement("div",{class:"helper-content"}),s=function(t,s,n){var a=[e.createElement("th",{class:"th-helper-dialog-key "+n,html:e.createElement("span",{class:"default-helper-title key-shortcut-key",html:e.createElement("span",{class:"default-helper-content ",html:null!=r.helper.dialog.shortcut.key[s][t]||null!=r.helper.dialog.shortcut.key[s][t]?r.helper.dialog.shortcut.key[s][t]:""})})}),e.createElement("th",{class:n,html:e.createElement("span",{class:"th-helper-dialog-description",html:null!=r.helper.dialog.shortcut.detail[s][t]||null!=r.helper.dialog.shortcut.detail[s][t]?r.helper.dialog.shortcut.detail[s][t]:""})})];return e.createElement("tr",{class:"helper-state",html:a})},n=function(t,n,a,i){var o=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:n})}),r=e.createElement("div",{class:"helper-content-body-container default-content-body-container"});t.addContent(o),t.addContent(r);for(var l=[],c=0;c<a.length;c++){var d="";c===a.length-1&&(d="th-last-row"),l.push(s(a[c],i,d))}var u=e.createElement("table");u.setContent(l),r.addContent(u)};return n(t,r.helper.dialog.subtitleShortcuts,["arrowUp","arrowDown","arrowLeft","arrowRight","shiftArrow","ctrlA","ctrlC","delete","enter","ctrlEnter"],"shortcut"),n(t,r.helper.dialog.subtitleMouseOperation,["ctrlClick","shiftClick","doubleClick"],"mouse"),t},minimize:function(){var e=this;e.views.minimize.icon.hasClassName(p)?(e.views.minimize.icon.removeClassName(p),e.modal.elements.container.setStyle("height",e.views.minimize.height)):(e.views.minimize.icon.addClassName(p),e.views.minimize.height=e.modal.elements.container.getStyle("height"),e.modal.elements.container.setStyle("height","44px"))},graphComponents:{createRouteNode:function(t,s,n){var a=o.getWebappsAssetUrl("IssueComponents","images/decisionBox.PNG");return e.createElement("div",{class:"lifecycle-decision-box",html:[e.createElement("img",{src:a}),e.createElement("div",{class:"route-content",html:r.routes[t.name.toLowerCase()]})]}).inject(this.cells[s][n])},createStateNode:function(t,s,n){return e.createElement("div",{class:"state-content",html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r.maturity[t.name.toLowerCase()]}),styles:{"background-color":i.getColorByState(t.name)}})}).inject(this.cells[s][n])},createHorizontalLine:function(){return e.createElement("div",{class:"lifecycle-horizontal-line",html:e.createElement("hr",{class:"horizontal-line"})})},createVerticalLine:function(){return e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})})},createVerticalConnector:function(e,t,s,n,a){return"up"===t?this.createVerticalConnectorUp(e,s,n,a):this.createVerticalConnectorDown(e,s,n,a)},createVerticalConnectorUp:function(t,s,n,a){var i=this,o={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};"end"!==a&&(i.createVerticalLine().inject(i.cells[s][n]).getChildren()[0].setStyle("height","50%"),s--);for(var r=0;r<t;r++)i.createVerticalLine().inject(i.cells[s][n]),s--;if("start"!==a){var l=i.createVerticalLine().inject(i.cells[s][n]);l.getChildren()[0].setStyle("height","50%"),l.style.transform="rotateZ(180deg)"}return o.end.r=s,o.end.c=n,o},createVerticalConnectorDown:function(t,s,n,a){var i=this,o={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};if("end"!==a){var r=i.createVerticalLine().inject(i.cells[s][n]);r.getChildren()[0].setStyle("height","50%"),r.style.transform="rotateZ(180deg)",s++}for(var l=0;l<t;l++)i.createVerticalLine().inject(i.cells[s][n]),s++;"start"!==a&&i.createVerticalLine().inject(i.cells[s][n]).getChildren()[0].setStyle("height","50%");return o.end.r=s,o.end.c=n,o},createHorizontalConnector:function(e,t,s,n,a){return"Right"===t?this.createHorizontalConnectorRight(e,s,n,a):this.createHorizontalConnectorLeft(e,s,n,a)},createHorizontalConnectorRight:function(t,s,n,a){var i=this,o={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};if("end"!==a){var r=i.createHorizontalLine().inject(i.cells[s][n]);r.getChildren()[0].setStyle("width","50%"),r.style.transform="rotate(180deg)"}n++;for(var l=0;l<t;l++)i.createHorizontalLine().inject(i.cells[s][n]),n++;"start"!==a&&i.createHorizontalLine().inject(i.cells[s][n]).getChildren()[0].setStyle("width","50%");return o.end.r=s,o.end.c=n,o},createHorizontalConnectorLeft:function(t,s,n,a){var i=this,o={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};"end"!==a&&i.createHorizontalLine().inject(i.cells[s][n]).getChildren()[0].setStyle("width","50%");n--;for(var r=0;r<t;r++)i.createHorizontalLine().inject(i.cells[s][n]),n--;if("start"!==a){var l=i.createHorizontalLine().inject(i.cells[s][n]);l.getChildren()[0].setStyle("width","50%"),l.style.transform="rotate(180deg)"}return o.end.r=s,o.end.c=n,o},createVerticalConnectorArrowUp:function(t,s){var n={div:e.createElement("div"),start:{r:t,c:s},end:{r:t,c:s}};return e.createElement("div",{class:"lifecycle-vertical-arrow-up",html:[e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})}),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"vertical-arrow-up"})}]}).inject(this.cells[t][s]),n.end.r=t,n.end.c=s,n},createVerticalConnectorArrowDown:function(t,s){var n={div:e.createElement("div"),start:{r:t,c:s},end:{r:t,c:s}};return e.createElement("div",{class:"lifecycle-vertical-arrow-down",html:[e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})}),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"vertical-arrow-down"})}]}).inject(this.cells[t][s]),n.end.r=t,n.end.c=s,n},createHorizontalConnectorArrowRight:function(t,s){e.createElement("div",{class:"lifecycle-horizontal-arrow-right",html:[this.createHorizontalLine(),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"lifecycle-arrow"})}]}).inject(this.cells[t][s])},createHorizontalConnectorArrowleft:function(t,s){e.createElement("div",{class:"lifecycle-horizontal-arrow-left",html:[e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"lifecycle-arrow"}).setStyle("transform","rotate(180deg)")},this.createHorizontalLine()]}).inject(this.cells[t][s])}}}})),define("DS/IssueComponents/duplicate/Duplicate",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/SpinBox","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y){"use strict";return t.extend({name:"DS/IssueComponents/duplicate/Duplicate",tag:"div",className:"duplicate-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},duplicateIssues:[],modal:null,confirm:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=u.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the duplicate component"),s.settings=JSON.parse(y),s.issues={},s.modal=null,s.validate=null,s.confirm=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e((function(e,t){s._deferred.resolve=e,s._deferred.reject=t}))},render:function(){var e=this;return v.start(e.name+" render"),e.dialog().then((function(){e._deferred.resolve()}),(function(){e._deferred.reject()})),v.end(e.name+" render"),e},destroy:function(){var e=this;v.start(e.name+" destroy"),e.physicalIds=[],e.issues={},e.duplicateIssues=[],e.confirm.destroy(),e.confirm=null,e.modal.destroy(),e.modal=null,e.validate=null,e.isLoaded=null,e._deferred={resolve:null,reject:null},v.end(e.name+" destroy")},dialog:function(){var e=this,t=f.get("widget")||window.widget;return r.mask(e.container),e.modal=new d({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"duplicate-issues-dialog",title:I.duplicate.preparing,header:null,body:e.container,footer:[e.validate=new n({value:I.duplicate.duplicate,className:"primary",events:{onClick:function(){e._duplicate()}},disabled:!0}),new n({value:I.duplicate.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then((function(t){new l({element:t}).inject(e.container),e.elements.optionsButton=new o({type:"switch",className:"options-button",checked:!1,label:I.duplicate.advancedOptions,events:{onChange:function(){e.displayOptions()}}}).inject(e.container),e.elements.Options=s.createElement("div",{class:"options-view"}).inject(e.container),e.elements.keepRelated=new o({type:"checkbox",className:"keep-related toggle-primary",checked:!0,label:I.duplicate.keepRelated}).inject(e.elements.Options),e.elements.keepAttachments=new o({type:"checkbox",className:"keep-attachments toggle-primary",checked:!1,label:I.duplicate.keepAttachments}).inject(e.elements.Options),e.settings.enableCopies&&(e.elements.copyCount=s.createElement("div",{class:"copy-count",html:[{tag:"span",class:"title-copy-count",html:I.duplicate.copyCount},e.count=new c({minValue:1,maxValue:e.settings.maxNumberOfCopies,stepValue:1,pageStepValue:1})]}).inject(e.elements.Options)),e.elements.titleOptions=s.createElement("div",{class:"title-options-view",html:[{tag:"span",class:"title-modifier",html:I.duplicate.titleModifier}]}).inject(e.elements.Options),new l({element:e.elements.Options}).inject(e.container),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:I.duplicate.replace},e.replaceHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.replace=new a({className:"advanced-options-text",placeholder:I.duplicate.replacePlaceholder})]}).inject(e.elements.titleOptions),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:I.duplicate.suffix},e.suffixHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.suffix=new a({className:"advanced-options-text",placeholder:I.duplicate.suffixPlaceholder})]}).inject(e.elements.titleOptions),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:I.duplicate.prefix},e.prefixHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.prefix=new a({className:"advanced-options-text",placeholder:I.duplicate.prefixPlaceholder})]}).inject(e.elements.titleOptions),e.settings.enableCopies&&(s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:I.duplicate.iterator},e.iteratorHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.iterator=new a({className:"advanced-options-text",placeholder:I.duplicate.iteratorPlaceholder})]}).inject(e.elements.titleOptions),C.updatePanelTooltip(e,"iteratorHelp")),C.updatePanelTooltip(e,"replaceHelp"),C.updatePanelTooltip(e,"suffixHelp"),C.updatePanelTooltip(e,"prefixHelp"),e.elements.Options.hide(),e.validate.enable(),e.physicalIds.length>1?e.modal.setTitle(I.replace(I.duplicate.titleMultiple,{number:e.physicalIds.length})):e.modal.setTitle(I.replace(I.duplicate.titleSingle,{number:e.physicalIds.length})),e.buildConfirmationDialog(),e.confirm.hide(),e.validate.focus(),r.unmask(e.container)}))},build:function(){var e=this;return v.start(e.name+" build"),h.preferences.getApprovalEnablement({data:{}}).then((function(t){e.adminPreference=t.body.ApprovalProcess})),e._check(e.getOption("physicalIds")).then((function(t){for(var n=[],a=0;a<e.physicalIds.length;a++){var i=t[e.physicalIds[a]],o=i.title+" ("+i.name+")";n.push(s.createElement("li",{html:[{tag:"span",class:"fonticon fonticon-issue-type "},s.String.escapeHTML(o)],title:o}))}return v.end(e.name+" build"),s.createElement("div",{html:[{tag:"div",class:"duplicate-issues-label",html:[{tag:"span",class:"duplicate-issues-label",html:I.duplicate.content}]},{tag:"div",class:"duplicate-issues-content",html:s.createElement("ul",{html:n,class:"duplicate-issues-content-list"})}]})}))},displayOptions:function(){var e=this,t=null,s=null;e.elements.optionsButton.isChecked()?(e.elements.Options.show(),t=e.elements.Options.getSize(),(s=e.modal.elements.container.getSize()).height=s.height+t.height,e.modal.setNewSize(s)):(t=e.elements.Options.getSize(),(s=e.modal.elements.container.getSize()).height=s.height-t.height,e.modal.setNewSize(s),e.elements.Options.hide())},_check:function(e){var t=this;return v.start(t.name+" _check"),h.issues.retrieve({data:{objects:e.reduce((function(e,t){return e.push({physicalId:t}),e}),[])}}).then((function(s){for(var n={},a=0;a<s.results.length;a++){var i=s.results[a].body;n[i.physicalId]={physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:""}}return t.physicalIds=e,t.issues=n,n}),(function(e){if(t._logger.error(e),e.error.message.includes("'business object' does not exist")){var s=b.getErrorMessage("0");b.displayErrorMessage(s,"error"),t.modal.destroy()}else m.displayNotification({msg:I.duplicate.error,eventID:"error"})})).finally((function(){v.end(t.name+" _check")}))},_duplicate:function(){var e=this;v.start(e.name+" _duplicate"),e.duplicateIssues=[];for(var t=!0,s=!1,n=1,a=e.elements.optionsButton.isChecked(),i=e.physicalIds.length,o="",r="",l=0;l<i;l++){var c=e.physicalIds[l],d=e.issues[c].title,u=void 0!==d&&""!==d?d:e.issues[c].name;if(a){t=e.elements.keepRelated.isChecked(),s=e.elements.keepAttachments.isChecked(),n=e.count?e.count.value:1;var p="",f="",g=e.replace.getValue();if(null!==g&&g.length>1&&(p=g.split(":")[0],f=g.split(":")[1],null==p||p.length<=0||null==f||f.length<=0))return void m.displayNotification({msg:I.duplicateWrongReplaceEnter,eventID:"error"});var h=e.suffix.getValue(),b=e.prefix.getValue();if(o=e.iterator?e.iterator.getValue():"",p.length>0&&f&&f.length>0&&(u=e.replaceTitle(u,p,f)),o.length>0){r=e.findIterator(d,o);var C=e.nextIterator(r);null!==C&&C.length>0&&(u=e.replaceIterator(u,r,C)),r=C}b.length>0&&(u=b+u),h&&(u+=h)}e.duplicateIssues.push({issue:e.issues[c],newTitle:u,keepRelated:t,keepAttachments:s});for(var y=1;y<n;y++){if(o.length>0){var E=e.nextIterator(r);u=e.replaceIterator(u,r,E),r=E}e.duplicateIssues.push({issue:e.issues[c],newTitle:u,keepRelated:t,keepAttachments:s})}}a?e.confirmDuplication():e.duplicate(e.duplicateIssues).then((function(){e.destroy()}))},duplicate:function(e){var t=this,n=t.count?t.count.value:1;v.start(t.name+" duplicate"),t.validate.setDisabled(),t.confirmButton.setDisabled();var a,i=f.get("widget")||window.widget;return r.mask(i.body),a="Always"==t.adminPreference?"Analyst":"Never"==t.adminPreference?"Unassigned":"",h.issues.duplicate({data:{objects:e.map((function(e){return{physicalId:e.issue.physicalId,title:e.newTitle,related:e.keepRelated,attachments:e.keepAttachments,actualStartDate:"",actionTaken:"",resolutionStatement:"",adminPreference:a}}))}}).then((function(e){var s="";s=n>1?I.replace(I.duplicate.multipleCopiesSuccess,{number:t.physicalIds.length,multiplication:n}):1===t.physicalIds.length?I.replace(I.duplicate.singleSuccess,{title:t.issues[t.physicalIds[t.physicalIds.length-1]].title+" ("+t.issues[t.physicalIds[t.physicalIds.length-1]].name+")"}):I.replace(I.duplicate.multipleSuccess,{number:t.physicalIds.length}),r.unmask(i.body),m.displayNotification({msg:s,eventID:"success"});var a=e.results.reduce((function(e,t){return e.push([t.body.physicalId]),e}),[]),o=e.results.reduce((function(e,t){return e[t.body.physicalId]=t.body,e}),{});v.end(t.name+" _duplicate"),p.publish("DS/Object/create",{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now())},data:{paths:a,attributes:o},version:"1.0"})}),(function(e){if(r.unmask(i.body),s.is(e.error.internal)&&e.error.internal.includes("ErrorCode:2003")){var n=b.getErrorMessage("2");b.displayErrorMessage(n,"error")}else if(s.is(e.error.internal)&&e.error.internal.includes("No create access to business object")){n=b.getErrorMessage("2");b.displayErrorMessage(n,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("This Issue requires approval but system was not able to find any member")){n=b.getErrorMessage("1004_1");b.displayErrorMessage(n,"error")}else m.displayNotification({msg:I.duplicate.error,eventID:"error"});t._logger.error("Cannot duplicate the selected issue(s) because %o",e),v.end(t.name+" _duplicate")}))},replaceTitle:function(e,t,s){if(0===t.length||0===s.length)return e;var n=t,a=(n=n.replace(/[-[\]{}()*+?\\^$]/g,"\\$&")).concat("|",t),i=null;try{i=new RegExp(a,"i")}catch(e){i=new RegExp(n,"i")}return e.replace(i,s)},findIterator:function(e,t){var s=null;try{s=new RegExp(t,"i")}catch(e){t=t.replace(/[-[\]{}()*+?\\^$]/g,"\\$&"),s=new RegExp(t,"i")}var n=s.exec(e),a=null;return null!==n&&(a=n[n.length-1]),a},nextIterator:function(e){var t=null;if(null!==e){var s=new RegExp("[0-9]+").exec(e);if(null!==s){var n="";s.forEach((function(e){n+=e}));var a=parseInt(n),i=a+1;t=e.replace(a.toString(),i.toString())}}return t},replaceIterator:function(e,t,s){var n=e;if(null!==s&&s.length>0){var a=e.lastIndexOf(t);if(-1!==a)n=e.substring(0,a)+s+e.substring(a+t.length)}return n},buildConfirmationDialog:function(){var e=this,t=f.get("widget")||window.widget;e.confirmMsgCont=new l,e.confirm=new d({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!1,className:"duplicate-confirm-dialog",header:null,body:e.confirmMsgCont,footer:[e.confirmButton=new n({value:I.duplicate.duplicate,className:"primary",events:{onClick:function(){e.duplicate(e.duplicateIssues).then((function(){e.destroy()}))}},disabled:!1}),new n({value:I.duplicate.cancel,events:{onClick:function(){e.modal.show(),e.confirm.hide()}}})],events:{onClose:function(){e.modal.show(),e.confirm.hide()}}}).inject(t.body)},confirmDuplication:function(){var e=this;e.modal.hide(),e.confirmMsgCont.getInnerElement().empty();var t={};Object.keys(e.issues).forEach((function(s){t[s]={title:e.issues[s].title,newTitles:[]}})),e.duplicateIssues.forEach((function(e){t[e.issue.physicalId].newTitles.push(e.newTitle)})),e.physicalIds.length>1?e.confirm.setTitle(I.replace(I.duplicate.titleMultiple,{number:e.physicalIds.length})):e.confirm.setTitle(I.replace(I.duplicate.titleSingle,{number:e.physicalIds.length}));var n=[];Object.keys(t).forEach((function(a){s.createElement("div",{class:"confirmationMsg-parent-container",html:[{tag:"div",class:"confirmationMsg-child-container",html:I.confirmationMsgPart1},{tag:"div",class:"confirmationMsg-child-container",html:s.createElement("span",{html:[{tag:"span",class:"fonticon fonticon-issue-type "}," ",s.String.escapeHTML(t[a].title)]})},{tag:"div",class:"confirmationMsg-child-container",html:I.confirmationMsgPart2}]}).inject(e.confirmMsgCont.getInnerElement()),1===t[a].newTitles.length?(s.createElement("div",{class:"confirmationMsg-parent-container",html:[{tag:"div",class:"confirmationMsg-child-container",html:s.createElement("span",{html:[{tag:"span",class:"fonticon fonticon-issue-type "}," ",s.String.escapeHTML(t[a].newTitles[0])]})},{tag:"div",class:"confirmationMsg-child-container",html:I.issue}]}).inject(e.confirmMsgCont.getInnerElement()),s.createElement("br").inject(e.confirmMsgCont.getInnerElement())):(t[a].newTitles.forEach((e=>{n.push(s.createElement("li",{html:[{tag:"span",class:"fonticon fonticon-issue-type "}," ",s.String.escapeHTML(e)]}))})),s.createElement("div",{class:"duplicate-issues-bulleted-list",html:[{tag:"div",class:"duplicate-issues-confirmation",html:s.createElement("ul",{class:"duplicate-issues-confirmation-list",html:n})}]}).inject(e.confirmMsgCont.getInnerElement()),n=[])})),e.confirm.show(),e.confirm.onResize()}})})),define("DS/IssueComponents/team/MembersGridUtil",["i18n!DS/IssueComponents/assets/nls/IssueComponents","DS/IssueComponents/team/MembersDataGridViewToolbar"],(function(e,t){"use strict";var s=Object.create(null);return s.getColumns=function(){return[{dataIndex:"propagate",visibleFlag:!1,width:35,allowUnsafeHTMLContent:!0,icon:"propagate",sortableFlag:!1},{text:e.team.columns.title,dataIndex:"tree",editableFlag:!1,alwaysVisibleFlag:!0,allowUnsafeHTMLContent:!0,width:"200",getCellGroupingKey:function(e){return e.nodeModel.options.grid.fullName}},{text:e.team.columns.name,dataIndex:"username",editableFlag:!1},{text:e.team.columns.memberof,dataIndex:"memberof",editableFlag:!1,visibleFlag:!1}]},s.changeView=function(s){if("GridView"==s){this.currentView="Grid",widget.setValue("membersView","GridView");var n=t.toolbar.getNodeModelByID("view");n&&"view-list"!=n.options.grid.semantics.icon.iconName&&n.updateOptions({grid:{semantics:{icon:{iconName:"view-list"}}},tooltip:e.team.toolbar.gridView});var a=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-view-list");a&&a.addClassName("currentView");var i=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-view-small-tile");i&&i.removeClassName("currentView");var o=document.querySelector(".iss-member-grid-div");o&&(o.removeClassName("hideView"),o.removeClassName("nonVisible"),o.addClassName("showView"));var r=document.querySelector(".membertileView");r&&(r.removeClassName("showView"),r.addClassName("hideView"))}},s.getRoleNLSValue=function(t){let s="";switch(t){case"Owner":s=e.team.owner.label;break;case"Co-owner":s=e.team.coOwners.label;break;case"Assignee":s=e.team.assignees.label;break;case"Contributor":s=e.team.contributors.label;break;case"InformedUser":s=e.team.informedUsers.label}return s},s.removeRole=function(e,t){let s=","+t,n=", "+t,a=t+",",i=t+" ,";return e.includes(s)?e=e.replace(s,""):e.includes(n)?e=e.replace(n,""):e.includes(a)?e=e.replace(a,""):e.includes(i)&&(e=e.replace(i,"")),e},s})),define("DS/IssueComponents/search/PeopleSearch",["DS/PADUtils/views/PADAlert","DS/SearchWidget/controllers/SW_FullPos_Controller","DS/IssueComponents/search/PeopleSearchUI","DS/IssueServices/services/PlatformServices","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a){"use strict";return t.extend({init:function(e){var t=this;t._parent(e);var n=e.events;null===n&&(n={}),n.onExpressSearch=function(){t.expressSearch()},e.events=n,t.searchWidgetUI.destroy(),t.searchWidgetUI=t.container=new s(e)},expressSearch:function(){var t=this,s=[],i="",o=function(){if(s.length>0){var n=Object.assign({},s);t.dispatchEvent("onValidUsers",n)}i.length>0&&(i=(i=i.trim()).replace(/.$/,""),e.displayNotification({msg:a.replace(a.search.error.usersNotFound,{users:i}),eventID:"error"}))},r=t.searchWidgetUI.searchInput.getValue().trim(),l=0,c=r.split(";");(c=c.filter((function(e){return""!==e}))).length>0&&c.forEach((function(e){e=e.trim(),n.getUserInfo(e,{onComplete:function(e){l+=1;var t=JSON.parse(e);s.push(t),l===c.length&&o()},onFailure:function(){i=i+e+", ",(l+=1)===c.length&&o()}})}))}})})),define("DS/IssueComponents/team/Team",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/SearchWidget/SearchWidgetConstant","DS/IssueCommon/commands/CommandsManager","DS/IssueComponents/search/PeopleSearch","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y){"use strict";return t.extend({})})),define("DS/IssueComponents/team/MembersDataGridModel",["UWA/Class/Model","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/team/MembersGridUtil","DS/IssueServices/services/IssueServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","DS/IssueServices/services/PlatformServices","DS/IssueCommon/utils/Utils","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","DS/Controls/Button"],(function(e,t,s,n,a,i,o,r,l,c,d){"use strict";var u=e.extend({init:function(e){this.contextID=e},setTreeDocument:function(e){this.treeDocument=e},getTreeDocument:function(){return this.treeDocument},createTreeDocument:function(){var e=new t({useAsyncPreExpand:!0,id:"issMembers",shouldBeSelected:function(e){return 1!=e.options.grid.isRoot}});return this.setTreeDocument(e),e},loadMembersData:function(e,t,n,a,o,r){var l=this;e.prepareUpdate(),e.empty(),l.owner=new s({label:i.team.owner.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Owner"}}),l.coowners=new s({label:i.team.coOwners.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Co-owner"}}),l.assignees=new s({label:i.team.assignees.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Assignee"}}),l.contributors=new s({label:i.team.contributors.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Contributor"}}),l.informedUsers=new s({label:i.team.informedUsers.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"InformedUser"}}),e.addRoot(l.owner),e.addRoot(l.coowners),e.addRoot(l.assignees),e.addRoot(l.contributors),e.addRoot(l.informedUsers);var d=this.createTreeDocumentNodeModel(t,"owner");l.owner.addChild(d),l.owner.setLabel(i.team.owner.title+" ("+d.length+")"),l.owner.expandAll(),d=this.createTreeDocumentNodeModel(n,"coowners"),l.coowners.addChild(d),l.coowners.setLabel(i.team.coOwners.title+" ("+d.length+")"),l.coowners.expandAll(),d=this.createTreeDocumentNodeModel(a,"assignees"),l.assignees.addChild(d),l.assignees.setLabel(i.team.assignees.title+" ("+d.length+")"),l.assignees.expandAll(),d=this.createTreeDocumentNodeModel(o,"contributors"),l.contributors.addChild(d),l.contributors.setLabel(i.team.contributors.title+" ("+d.length+")"),l.contributors.expandAll(),d=this.createTreeDocumentNodeModel(r,"informedUsers"),l.informedUsers.addChild(d),l.informedUsers.setLabel(i.team.informedUsers.title+" ("+d.length+")"),l.informedUsers.expandAll(),e.pushUpdate();var u=document.getElementById("iss-outer-member-grid-div");u&&c.isMasked(u)&&c.unmask(u)},createTreeDocumentNodeModel:function(e,t){var s=[];for(var n in e){var a=this.createTreeNode(e[n],t);s.push(a)}return s},createTreeDocumentNodeModelForNewMember:function(e,t){for(var s=[],n=0;n<e.length;n++){var a=this.createTreeNode(e[n],t);s.push(a)}return s},createTreeNode:function(e,t){e.username=e.user,e.root=t,e.role="",e.roleList="";for(var a=0;a<e.roles.length;a++){var i=e.roles[a],r=n.getRoleNLSValue(i);e.role+=i,e.roleList+=r,a!=e.roles.length-1&&(e.role+=",",e.roleList+=", ")}var l=e.roleList;o.get3DSpaceUrl();return"group"===e.type&&(e.username="","OnPremise"!==o.getTenant()&&e.uri&&(e.user=e.uri)),new s({subLabel:"",description:l,grid:e})},createCustomPersonNameField:function(e){var t="",s=o.get3DSwymUrl();t="person"===e.type?e.fullName+" ("+e.user+")":e.fullName;var n=new UWA.Element("div",{class:"members "+e.root,title:t}),a="";if((a="group"===e.type?UWA.createElement("span",{class:"user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group"}):this.getPersonImageDiv(e)).addClassName("assignee"),"group"==e.type)(i=new d({domId:"hyperlinkButton-members",displayStyle:"lite",label:e.fullName})).addEventListener("click",(function(){o.getUserGroupProfile(e.uri)}));else if(s){(i=new d({domId:"hyperlinkButton-members",displayStyle:"lite",label:e.fullName})).addEventListener("click",(function(){o.getUserProfile(e.user)}))}else var i=UWA.createElement("span",{class:"userName",html:e.fullName});return a.inject(n),i.inject(n),n},getPersonImageDiv:function(e,t){var s="/api/user/getpicture/login/"+e.user+"/format/normal",n=o.get3DSwymUrl(),a=new UWA.Element("div",{}),i="";if(""!==n)(i=UWA.createElement("img",{class:"userIcon",src:n+s})).addEventListener("click",(function(){o.getUserProfile(e.user)}));else{var r=o.getAvatarDetails(e.fullName);i=UWA.createElement("div",{html:r.avatarStr}),1==t?(i.addClassName("member-profile-picture"),i.addClassName("member-profile-text")):i.addClassName("avatarIcon"),i.style.setProperty("background",r.avatarColor)}return i.inject(a),a},addNodesInLayoutModel:function(e,t,s){var n=this,a=u.prototype.createTreeDocumentNodeModelForNewMember(t,s);e.prepareUpdate(),"coowners"===s?(n.coowners.addChild(a),n.coowners.setLabel(i.team.coOwners.title+" ("+n.coowners.getNumberOfChildren()+")")):"assignees"===s?(n.assignees.addChild(a),n.assignees.setLabel(i.team.assignees.title+" ("+n.assignees.getNumberOfChildren()+")")):"contributors"===s?(n.contributors.addChild(a),n.contributors.setLabel(i.team.contributors.title+" ("+n.contributors.getNumberOfChildren()+")")):"informedUsers"===s&&(n.informedUsers.addChild(a),n.informedUsers.setLabel(i.team.informedUsers.title+" ("+n.informedUsers.getNumberOfChildren()+")")),n.coowners.expandAll(),n.assignees.expandAll(),n.contributors.expandAll(),n.informedUsers.expandAll(),e.pushUpdate()},removeChildren:function(){var e=this,t=(e.contextID,document.getElementById("iss-outer-member-grid-div")),s=e.treeDocument.getSelectedNodes();if(0!=s.length){for(var n=[],o=[],d=[],u=[],m=[],p=!1,f=0;f<s.length;f++){let e=s[f].options.grid;var g=e.roles;m.includes(e.user)||(g.includes("Owner")&&(p=!0),g.includes("Co-owner")&&d.push({user:e.user,type:e.type}),g.includes("Assignee")&&o.push({user:e.user,type:e.type}),g.includes("Contributor")&&n.push({user:e.user,type:e.type}),g.includes("InformedUser")&&u.push({user:e.user,type:e.type}),m.push(e.user))}d.length>0||o.length>0||n.length>0||u.length>0?require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(m){var p=[];c.mask(t);for(var f=0;f<m.issues.length;f++){var g={physicalId:m.issues[f].id};d.length>0&&(g.coOwners=d),o.length>0&&(g.assignees=o),n.length>0&&(g.contributors=n),u.length>0&&(g.informedUsers=u),p.push(g)}a.people.delete({data:{objects:p}}).then((function(){for(var n=!1,a=0;a<s.length;a++){var o=s[a].options.grid.roles,r=o.indexOf("Owner")>=0,d=o.indexOf("Co-owner")>=0,u=o.indexOf("Assignee")>=0,p=o.indexOf("Contributor")>=0,f=o.indexOf("InformedUser")>=0,g=s[a].options.grid.user;if(r&&(n=!0),d){var h=e.coowners.getAllDescendants().filter((e=>e.options.grid.user==g));h.length>0&&(h[0].remove(),o=o.filter((function(e){return"Co-owner"!=e})),s[a].options.grid.roles=o,e.coowners.setLabel(i.team.coOwners.title+" ("+e.coowners.getNumberOfChildren()+")"))}if(u){var v=e.assignees.getAllDescendants().filter((e=>e.options.grid.user==g));v.length>0&&(v[0].remove(),o=o.filter((function(e){return"Assignee"!=e})),s[a].options.grid.roles=o,e.assignees.setLabel(i.team.assignees.title+" ("+e.assignees.getNumberOfChildren()+")"))}if(p){var b=e.contributors.getAllDescendants().filter((e=>e.options.grid.user==g));b.length>0&&(b[0].remove(),o=o.filter((function(e){return"Contributor"!=e})),s[a].options.grid.roles=o,e.contributors.setLabel(i.team.contributors.title+" ("+e.contributors.getNumberOfChildren()+")"))}if(f){var C=e.informedUsers.getAllDescendants().filter((e=>e.options.grid.user==g));C.length>0&&(C[0].remove(),o=o.filter((function(e){return"InformedUser"!=e})),s[a].options.grid.roles=o,e.informedUsers.setLabel(i.team.informedUsers.title+" ("+e.informedUsers.getNumberOfChildren()+")"))}}n&&(e.owner.getAllDescendants()[0].options.grid.roles=["Owner"],l.displayNotification({msg:i.team.error.skipRemoveOwner,eventID:"info"}));m.view.dispatchEvent("onUpdate",{issues:m.issues}),c.unmask(t)})).catch((function(e){if(c.unmask(t),e.error.message.includes("'business object' does not exist")){var s=r.getErrorMessage("0");r.displayErrorMessage(s,"error")}else if(UWA.is(e.error.internal)&&(e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")||e.error.internal.includes("No 'read' access on Attribute 'Co-Owners' for")||e.error.internal.includes("You do not have the permissions to perform this action"))){s=r.getErrorMessage("1");r.displayErrorMessage(s,"error")}else l.displayNotification({msg:e.error.message,eventID:"error"})}))})):p&&l.displayNotification({msg:i.team.error.skipRemoveOwner,eventID:"info"})}}});return u})),define("DS/IssueComponents/create/Classification",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/Expander","DS/Controls/SpinBox","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/create/AutoComplete","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g){"use strict";var h={DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},v="true";return t.extend({name:"DS/IssueComponents/create/Classify",tag:"div",className:"create-view-content-subview create-classify",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e((function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t})),s.formElements={},s.formElementsToggler={},s.fields={},s.noShow=!t.classification,s._classes=[],s._classificationData=t.classification?t.classification.data:[],s.templateAttributes=t.classification.attributes?t.classification.attributes:{},s.selectedData=t.classification.selectedData?t.classification.selectedData:[],s.classModel=t.classification.classModel?t.classification.classModel:{},s._deferredInit.resolve()},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach((function(t){e.fields[t]=null,e.formElements[t]=null,e.formElementsToggler[t]=null}))},render:function(){var e=this;return e.form=s.createElement("div",{class:"classify-form"}),e.renderClassificationAttributes(),e},renderClassificationAttributes:function(){var e=this;e._classificationData.forEach((function(t,n){e._classes.push(t.classId);var a=s.createElement("div",{}),i=[];t.classAttributes.sort(((e,t)=>e.name>t.name?1:-1)),t.classAttributes.forEach((function(a,o){var r=e.getPlaceholder(a),l=a.authorizedValues,c=!!a.multivalued&&a.multivalued,d=[];l&&a.authorizedValues.forEach((function(e){d.push(e)}));var u=s.createElement("h5",{class:"form-field",internalName:a.name,html:[s.createElement("span",{html:e.getLabel(a)})]});switch(a.type){case h.DATE:var m=e.formElements[a.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-date",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[a.name]=e.getDateField(e._classificationData[n].classAttributes[o],a.default,e.templateAttributes[a.name])]}]});if(e.selectedData.attributeFields[a.name]){p=e.selectedData.attributeFields[a.name].fields,f={classPath:t.classPath,field:e.fields[a.name]};p.push(f)}else{var p=[],f={classPath:t.classPath,field:e.fields[a.name]};p.push(f),e.selectedData.attributeFields[a.name]={},e.selectedData.attributeFields[a.name].fields=p}i.push(m);break;case h.INT:case h.REAL:var g=e.formElements[a.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-number",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[a.name]=l?e.getComboBox(e._classificationData[n].classAttributes[o],d,c,e.templateAttributes[a.name]):e.getNumberField(e._classificationData[n].classAttributes[o],r,c,e.templateAttributes[a.name])]}]});if(e.selectedData.attributeFields[a.name]){p=e.selectedData.attributeFields[a.name].fields,f={classPath:t.classPath,field:e.fields[a.name]};p.push(f)}else{var p=[],f={classPath:t.classPath,field:e.fields[a.name]};p.push(f),e.selectedData.attributeFields[a.name]={},e.selectedData.attributeFields[a.name].fields=p}i.push(g);break;case h.BOOL:var b=e.formElements[a.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-boolean",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[a.name]=e.getBooleanField(e._classificationData[n].classAttributes[o],a.default===v,e.templateAttributes[a.name])]}]});if(e.selectedData.attributeFields[a.name]){p=e.selectedData.attributeFields[a.name].fields,f={classPath:t.classPath,field:e.fields[a.name]};p.push(f)}else{p=[],f={classPath:t.classPath,field:e.fields[a.name]};p.push(f),e.selectedData.attributeFields[a.name]={},e.selectedData.attributeFields[a.name].fields=p}i.push(b);break;case h.TEXT:var C=e.formElements[a.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-text",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[a.name]=l?e.getComboBox(e._classificationData[n].classAttributes[o],d,c,e.templateAttributes[a.name]):e.getTextField(e._classificationData[n].classAttributes[o],r,c,e.templateAttributes[a.name])]}]});if(e.selectedData.attributeFields[a.name]){p=e.selectedData.attributeFields[a.name].fields,f={classPath:t.classPath,field:e.fields[a.name]};p.push(f)}else{p=[],f={classPath:t.classPath,field:e.fields[a.name]};p.push(f),e.selectedData.attributeFields[a.name]={},e.selectedData.attributeFields[a.name].fields=p}i.push(C)}})),i.forEach((function(e){e.inject(a)}));var o=s.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-close"});o.addEvent("click",(function(){delete e.selectedData.classes[t.classId];for(var s=e.selectedData._classificationData,n=0;n<s.length;n++)s[n][0].classId===t.classId&&s.splice(n,1);var a=l.header,i=(l.body.getChildren(),l.body.querySelectorAll("h5"));i.length>0&&i.forEach((function(t){for(var s=e.selectedData.attributeFields[t.getAttribute("internalName")].fields,n=0;n<s.length;n++)if(s[n].classPath===a){s.splice(n,1);break}0===s.length&&delete e.selectedData.attributeFields[t.textContent]})),l.destroy()}));var l=new r({header:t.classPath,body:a,customHeader:o,expandedFlag:!0});l.inject(e.form)}))},show:function(){this._parent()},hide:function(){this._parent()},getLabel:function(e){var t="",s=g.create.properties.classification;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.label?e.label:e.name),t},getPlaceholder:function(e){var t="",s=g.create.properties.classification;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.label?e.label:e.name),t},getDateField:function(e,t,s){var a=this,i="";if(a.selectedData.attributeFields[e.name]&&void 0!==a.selectedData.attributeFields[e.name].value)e.value=a.selectedData.attributeFields[e.name].value,a.selectedData.attributes[e.name]=e.value,i=e.value;else if(void 0!==s)e.value=s,a.selectedData.attributes[e.name]=s,i=new Date(s);else if(void 0!==t){var o=t.substr(8,2),r=t.substr(5,2)-1,l=t.substr(0,4);i=new Date(l,r,o)}else i=void 0;var c=new n({value:i});return c.getContent().addEventListener("change",(function(){var t=c.value;null!==t&&(e.value=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear(),a.selectedData.attributes[e.name]=e.value,a.selectedData.attributeFields[e.name].fields.forEach((function(e){e.field.value=t})),a.selectedData.attributeFields[e.name].value=t)})),c},getTextField:function(e,t,s,n){var i=this,o=(e.type,void 0===e.default?"":e.default);i.selectedData.attributeFields[e.name]&&void 0!==i.selectedData.attributeFields[e.name].value?(e.value=i.selectedData.attributeFields[e.name].value,i.selectedData.attributes[e.name]=e.value,o=e.value):void 0!==n&&(e.value=n,i.selectedData.attributes[e.name]=n,o=n);var r=null;return s?r=i.getMultiValueField(e,o,n):((r=new a({placeholder:t,value:o})).getContent().setStyle("width","100%"),r.addEventListener("change",(function(){e.value=r.value,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].fields.forEach((function(t){t.field.value=e.value})),i.selectedData.attributeFields[e.name].value=e.value}))),r},getNumberField:function(e,t,s,n){var a=this,i=e.type,o=void 0===e.default?0:e.default;a.selectedData.attributeFields[e.name]&&void 0!==a.selectedData.attributeFields[e.name].value?(e.value=a.selectedData.attributeFields[e.name].value,a.selectedData.attributes[e.name]=e.value,o=e.value):void 0!==n&&(e.value=n,a.selectedData.attributes[e.name]=n,o=n);var r=null;if(s)r=a.getMultiValueField(e,o,n);else{var c=e.maximum,d=e.minimum;c=void 0!==c?i===h.INT?parseInt(c):parseFloat(c):i===h.INT?2147483646:999999999999999,(r=new l({value:i===h.INT?parseInt(o):parseFloat(o),stepValue:i===h.INT?1:.1,minValue:d?i===h.INT?parseInt(d):parseFloat(d):"",maxValue:c,decimals:i===h.INT?0:6})).addEventListener("change",(function(){e.value=r.value,a.selectedData.attributes[e.name]=e.value,a.selectedData.attributeFields[e.name].fields.forEach((function(t){t.field.value=e.value})),a.selectedData.attributeFields[e.name].value=e.value}))}return r},getComboBox:function(e,t,s,n){var a=this,i=null,o=e.type,r=e.default;if(a.selectedData.attributeFields[e.name]&&void 0!==a.selectedData.attributeFields[e.name].value?(e.value=a.selectedData.attributeFields[e.name].value,a.selectedData.attributes[e.name]=e.value,r=e.value):void 0!==n&&(e.value=n,a.selectedData.attributes[e.name]=n,r=n),o!==h.INT&&o!==h.REAL||t.sort((function(e,t){return e-t})),s)if(""!==t&&t.length>0){var l=[];""!==t&&t.forEach((function(e,t){l.push({labelItem:e?.nlsValue??e,valueItem:e?.value??e})}));var m=function(e,t){return new u({label:e,value:t})},p=function(){var e=new d;e.prepareUpdate();for(var t=0;t<l.length;t++){var s=l[t].labelItem,n=l[t].valueItem,a=m(s,n);e.addRoot(a)}return e.pushUpdate(),e}(),f=!0,g=[];l.length>0&&l.forEach((function(e,t){var s=[];if(null!=r)for(var n=0;n<r.length;n++)s[n]=r[n]+"";null!=r&&s.includes(e.valueItem)&&g.push(p.getRoots()[t])})),(i=new c({elementsTree:p,multiSearchMode:f,selectedItems:g,allowFreeInputFlag:!1})).addEventListener("change",(function(){for(var t=i.selectedItems,s=[],n=a.selectedData.attributeFields[e.name].fields,o=0;o<t.length;o++)s.push(t[o].options.value);n.forEach((function(e){e.field.selectedItems=t})),e.value=s,a.selectedData.attributes[e.name]=e.value,a.selectedData.attributeFields[e.name].value=e.value}))}else i=a.getMultiValueField(e,r,n,t);else{var v=void 0===r?"":r;l=[];""!==t&&t.forEach((function(e,t){l.push({labelItem:e?.nlsValue??e,valueItem:e?.value??e})}));m=function(e,t){return new u({label:e,value:t})},p=function(){var e=new d;e.prepareUpdate();for(var t=0;t<l.length;t++){var s=l[t].labelItem,n=l[t].valueItem,a=m(s,n);e.addRoot(a)}return e.pushUpdate(),e}(),f=!1,g=[];l.length>0&&l.forEach((function(e,t){v+""===e.valueItem&&g.push(p.getRoots()[t])})),(i=new c({elementsTree:p,multiSearchMode:f,selectedItems:g,allowFreeInputFlag:!1})).addEventListener("change",(function(){e.value=i.value,a.selectedData.attributes[e.name]=e.value,a.selectedData.attributeFields[e.name].fields.forEach((function(t){t.field.value=e.value})),a.selectedData.attributeFields[e.name].value=e.value}))}return i.getContent().addEventListener("keydown",(function(e){13==e.keyCode&&e.stopPropagation()})),i},getBooleanField:function(e,t,s){var n=this;e.multivalued&&Array.isArray(s)&&(s=s.length>0&&s[0]),n.selectedData.attributeFields[e.name]&&void 0!==n.selectedData.attributeFields[e.name].value?(e.value=n.selectedData.attributeFields[e.name].value,n.selectedData.attributes[e.name]=e.value,t=e.value):void 0!==s&&(e.value=s,n.selectedData.attributes[e.name]=e.value,t=s);var a=new o({type:"switch",checkFlag:t});return a.addEventListener("change",(function(){e.value=a.checkFlag,n.selectedData.attributes[e.name]=e.value,n.selectedData.attributeFields[e.name].fields.forEach((function(t){t.field.checkFlag=e.value})),n.selectedData.attributeFields[e.name].value=e.value})),a.getContent().addEventListener("keydown",(function(e){13==e.keyCode&&e.stopPropagation()})),a},getMultiValueField:function(e,t,s,n){var a=this;s=t||s,n=n||[];var i=new m({dataType:e.type,selectedValues:s,rangeValues:n});return i.addEventListener("change",(function(){var t=i.selectedItems,s=[];a.selectedData.attributeFields[e.name].fields.forEach((function(e){e.field._selectionChips.removeAllChips(),e.field.selectedItems=[],s=[];for(var n=0;n<t.length;n++)s.push(t[n].value),e.field._selectionChips.addChip({label:t[n].value,value:t[n].value}),e.field.selectedItems.push({label:t[n].value,value:t[n].value})})),e.value=s,a.selectedData.attributes[e.name]=e.value,a.selectedData.attributeFields[e.name].value=e.value})),i.getContent().addEventListener("keydown",(function(e){13==e.keyCode&&e.stopPropagation()})),i}})})),define("DS/IssueComponents/create/Attachments",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Form","DS/UIKIT/Iconbar","DS/Controls/TooltipModel","DS/Controls/ComboBox","DS/UIKIT/Mask","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/components/Item","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/Catalog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/2DAnnotation/2DAnnotation","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y,E,S,w,T){"use strict";var D="ENX3DIR_AP",A=/[/\\?%*:|"<>]/g,_=e.extend({name:"DS/IssueComponents/create/Attachments",tag:"div",className:"create-view-content-subview create-attachments",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(e){var s=this;s._parent(e),s.parent=e.parent,s.annotateCommand=e.annotateCommand||{enable:!1,addTextbox:!1,getText:function(){return""}},s.searchAttachmentCommand=e.searchAttachmentCommand||{getSearchQuery:function(){return t.resolve("")}},s.isInit=new t((function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t})),s._logger=a.getLogger(s.name),s.form=null,s.formElements={attachments:null},s.formElementsToggler={attachments:null},s.fields={attachments:{container:null,iconBar:null,title:null}},s.collection=new m({id:Date.now().toString()}),s._deferredInit.resolve()},destroy:function(){var e=this;e.form=null,e.formElements={attachments:null},e.formElementsToggler={attachments:null},e.fields={attachments:{container:null,iconBar:null,title:null}},e.collection=null,e.catalog=null},render:function(){var e=this;e.form=new r({className:"create-attachments-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container);var t={},n=void 0;t.element="collaborativeSpace",t.type="comboBox",t.required=!0,t.label=T.collaborativeSpace,t.placeholder=T.selectCollaborativeSpacePlaceholder,t.enableSearchFlag=!1,t.reachablePlaceholderFlag=!0,t.elementsList=[],e.fields.tooltipHelper="collabSpaceHelper",e.collaborativeSpaceField=e.createFormElement(t,"collabSpaceHelper"),C.updatePanelTooltip(e.fields,"collabSpaceHelper"),e.fields.collaborativeSpace.required=t.required;var a={},i=[],o=void 0;return a.element="organization",a.type="comboBox",a.required=!0,a.label=T.organization,a.placeholder=T.selectOrganizationPlaceholder,a.enableSearchFlag=!1,a.reachablePlaceholderFlag=!0,a.elementsList=[],e.fields.tooltipHelper="organizationHelper",e.organizationField=e.createFormElement(a,"organizationHelper"),C.updatePanelTooltip(e.fields,"organizationHelper"),e.fields.organization.required=a.required,e.fields.collaborativeSpace.addEventListener("change",(function(){i=e.getOrganizationsData(e.avaialbleUserCredentialsForDocument);var t=e.getAllAssignedOrganizations(e.avaialbleUserCredentialsForDocument);e.updateComboBoxFields(i,"organization"),e.fields.organization.selectedIndex=-1,1===i.length&&t.length>1?(e.organizationField.show(),e.fields.organization.selectedIndex=0,e.fields.organization.disabled=!0):i.length>1&&t.length>1?(e.organizationField.show(),e.fields.organization.disabled=!1):1===i.length&&1===t.length?(e.fields.organization.selectedIndex=0,e.organizationField.hide()):e.organizationField.hide()})),e._renderAttachmentsField(),s.createElement("div",{class:"create-form-content",html:[e.formElements.attachments=s.createElement("div",{class:"create-form-element create-attachments-form-element-attachments",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.attachments=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[e.fields.attachments.title,e.fields.attachments.accesswarningMessage,e.collaborativeSpaceField,e.organizationField,e.fields.attachments.iconsContainer,e.fields.attachments.container]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.attachments.help]}]})]}).inject(e.form.elements.container),e.fields.attachments.accesswarningMessage.hide(),e.collaborativeSpaceField.hide(),e.organizationField.hide(),I.preferences.getCreateCtx({policy:"Document Release"}).then((function(t){if(e.avaialbleUserCredentialsForDocument=t,e.avaialbleUserCredentialsForDocument){var s;if(e.avaialbleUserCredentialsForDocument.credentials.length<=1&&!e.avaialbleUserCredentialsForDocument.credentials.some((e=>e.ctxname)))return e.fields.attachments.accesswarningMessage.show(),e.fields.attachments.iconBar.disableItem("screenshot"),e.fields.attachments.iconBar.disableItem("attachFromLocalDisk"),void((s=document.getElementsByClassName("isu-am-catalog-placeholder-button btn-default btn btn-root")[0])&&(s.disabled=!0));e._addDropEvent(e.catalog.container);var a=e.getCollaborativeSpaceData(e.avaialbleUserCredentialsForDocument);e.fields.collaborativeSpace.elementsList=a.map((e=>({labelItem:e.title,valueItem:e.name})));var i,r,l,c,d,u,m=e.getAllAssignedOrganizations(e.avaialbleUserCredentialsForDocument);e.issue=e.parent.issue,e.parent.views&&(i=e.parent.views.properties.view.fields.collaborativeSpace.value,r=e.parent.views.properties.view.fields.organization.value),i?n=a.findIndex((e=>e.name===i)):e.issue&&(l=e.issue.collaborativeSpace)&&(d=a.findIndex((e=>e.name===l))),n>-1?e.fields.collaborativeSpace.selectedIndex=n:d>-1&&(e.fields.collaborativeSpace.selectedIndex=d),1===a.length&&(e.fields.collaborativeSpace.selectedIndex=0,e.fields.collaborativeSpace.disabled=!0),a.length>=1&&e.collaborativeSpaceField.show();var p=e.getOrganizationsData(e.avaialbleUserCredentialsForDocument);e.fields.organization.elementsList=p.map((e=>({labelItem:e.title,valueItem:e.name}))),r?o=p.findIndex((e=>e.name===r)):e.issue&&(c=e.issue.organization)&&(u=p.findIndex((e=>e.name===c))),o>-1?e.fields.organization.selectedIndex=o:u>-1&&(e.fields.organization.selectedIndex=u),m.length>1&&e.organizationField.show(),1===m.length&&(e.fields.organization.selectedIndex=0,e.fields.organization.disabled=!0),void 0===e.fields.collaborativeSpace.value&&(e.fields.organization.disabled=!0),e.parent.views&&e.parent.views.properties.view&&e.parent.views.properties.view.fields&&(e.parent.views.properties.view.fields.collaborativeSpace.addEventListener("change",(function(){var t,s=e.parent.views.properties.view.fields.collaborativeSpace.value;s&&(t=a.findIndex((e=>e.name===s))),e.fields.collaborativeSpace.selectedIndex=t>-1?t:0})),e.parent.views.properties.view.fields.organization.addEventListener("change",(function(){var t,s=e.parent.views.properties.view.fields.organization.value,n=e.getOrganizationsData(e.avaialbleUserCredentialsForDocument);s&&(t=n.findIndex((e=>e.name===s))),e.fields.organization.selectedIndex=t>-1?t:0}))),e.parent.isTemplate&&e.parent.finalize&&e.parent.finalize.fields.saveAsTemplate&&(e.parent.finalize.fields.saveAsTemplate.collaborativeSpace.addEventListener("change",(function(){var t,s=e.parent.finalize.fields.saveAsTemplate.collaborativeSpace.value;s&&(t=a.findIndex((e=>e.name===s))),e.fields.collaborativeSpace.selectedIndex=t>-1?t:0})),e.parent.finalize.fields.saveAsTemplate.organization.addEventListener("change",(function(){var t,s=e.parent.finalize.fields.saveAsTemplate.organization.value,n=e.getOrganizationsData(e.avaialbleUserCredentialsForDocument);s&&(t=n.findIndex((e=>e.name===s))),e.fields.organization.selectedIndex=t>-1?t:0})))}})),e},createFormElement:function(e,t){var n="create-attachments-form-element-"+e.element,a=this.formElements[e.element]=s.createElement("div",{class:n});return this.createFormGroup(e,t).inject(a),a},createFormGroup:function(e,t){var n=s.createElement("div",{class:"create-form-field form-group"});this.createLabel(e,t).inject(n);var a=this.fields[e.element]=new d(e);return a.getContent().setStyle("width","100%"),a.inject(n),n},createLabel:function(e,t){return this.formElements[e.element]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:"create-form-field-label",html:e.label}),s.createElement("div",{class:"required-form-field-required-label highlight wux-ui-3ds-required wux-ui-3ds"}),this.fields[t]=s.createElement("span",{class:"fonticon fonticon-help isu-help-icon"})]})},getCollaborativeSpaceData:function(e){var t=[],s=[];return e.credentials.forEach((e=>{if(e.ctxtitle){t.some((t=>t.name===e.prjname))||t.push({title:e.prjtitle?e.prjtitle:e.prjname,name:e.prjname}),s.push(e.ctxname)}})),this.ctx=s,t},getOrganizationsData:function(e){var t=this,s=[];return e.credentials.forEach((e=>{if(e.ctxtitle&&e.prjname===t.fields.collaborativeSpace.value){s.some((t=>t.name===e.orgname))||s.push({name:e.orgname,title:e.orgtitle})}})),s},updateComboBoxFields:function(e,t){this.fields[t].elementsList=e.map((e=>({labelItem:e.title,valueItem:e.name})))},getAllAssignedOrganizations:function(e){var t=[];return e.credentials.forEach((e=>{if(e.ctxtitle){t.some((t=>t.name===e.orgname))||t.push({name:e.orgname,title:e.orgtitle})}})),t},_renderAttachmentsField:function(){var e=this;e.fields.attachments.title=s.createElement("div",{class:"create-form-title",html:[{tag:"h5",class:"create-form-field-attachments-label",html:[T.create.attachments.labels.attachments,e.fields.attachmentsHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]}),e.fields.attachments.accesswarningMessage=s.createElement("div",{class:"create-form-accesswarningMessage",html:[{tag:"h6",class:"create-form-field-attachments-accesswarningMessage",html:[T.messageCreateDocument]}]}),e.fields.attachments.iconsContainer=s.createElement("div",{class:"create-form-attachments-iconbar",html:[]}),C.updatePanelTooltip(e.fields,"attachmentsHelper"),e.fields.attachments.iconBar=new l({items:[{id:"annotate",fonticon:"highlighter",text:T.create.attachments.annotate,selectable:!0,handler:function(){e._annotate()}},{id:"screenshot",fonticon:"camera",text:T.create.attachments.screenshotAvailable,selectable:!0,handler:function(){e._screenshot()}},{id:"attachFromLocalDisk",fonticon:"upload",text:T.create.attachments.attach.fromLocalDisk,selectable:!1,handler:function(){e._onRequestAttachFromLocalDisk()}},{id:"attachFrom3DX",text:T.create.attachments.attach.from3DX,fonticon:"plus",selectable:!1,handler:function(){e.searchAttachmentCommand.getSearchQuery().then((function(t){e._onRequestAttachFrom3DX(t)}))}},{className:"divider"},{id:"setAsPrimary",fonticon:"star",text:h.views.Header.Iconbar.actions.setAsPrimary,selectable:!0,handler:function(){var t=e.collection.getSelectedItems()[0],s=e.collection.filter((function(e){return!0===e.get("isPrimary")}));if(s.some((function(e){return e.get("id")===t.get("id")})))t.set("isPrimary",!1);else for(var n=0;n<e.collection.size();n++){var a=e.collection.at(n);a.id!==t.id?a.set("isPrimary",!1):a.set("isPrimary",!0)}}},{id:"remove",fonticon:"remove",text:T.create.attachments.remove,selectable:!1,handler:function(){var t=e.collection.getSelectedItems();e.collection.unselectAll(),e.collection.remove(t)}},{className:"divider"},{id:"switchCatalogLayout",type:"checkbox",fonticon:"view-list",text:h.views.Header.Iconbar.actions.switchCatalogLayout,selectable:!0,handler:function(){e.catalog.switchLayout(e.catalog.layout%2+1)}}]}),e.fields.attachments.iconBar.disableItem("remove"),e.fields.attachments.iconBar.disableItem("setAsPrimary"),e.annotateCommand.enable||e.fields.attachments.iconBar.getItem("annotate").elements.container.hide(),e.fields.attachments.iconBar.inject(e.fields.attachments.iconsContainer),e.fields.attachments.container=s.createElement("div",{class:"create-form-attachments-container",tabindex:"-1"}),e.catalog=new g({collection:e.collection,layout:1,searchAttachmentCommand:{getSearchQuery:e.searchAttachmentCommand.getSearchQuery}}).render().inject(e.fields.attachments.container),e.listenTo(e.catalog,"onSwitchLayout",e._onCatalogSwitchLayout.bind(e)),e.listenTo(e.catalog,"request:attachFrom3DX",e._onRequestAttachFrom3DX.bind(e)),e.listenTo(e.catalog,"request:attachFromLocalDisk",e._onRequestAttachFromLocalDisk.bind(e)),e.listenTo(e.collection,"onSelect",e._onCollectionSelect.bind(this)),e.listenTo(e.collection,"onUnselect",e._onCollectionSelect.bind(this))},reset:function(){var e=this;return new t((function(t){e.collection.reset(),e.fields.attachments.iconBar.disableItem("remove"),e.fields.attachments.iconBar.disableItem("setAsPrimary"),t()}))},getValues:function(e){var t=this,s={attachments:[],primaryAttachment:null};if(e&&(s.attachments=t.collection.filter((function(e){return!e.get("isFile")})).map((function(e){return e.get("isPrimary")&&(s.primaryAttachment=e.id),e.get("id")}))),t.ctx){const e=t.ctx.findIndex((e=>{const s=e.split(".");return s[1]===t.fields.organization.value&&s[2]===t.fields.collaborativeSpace.value}));t.fields.securityContexts="ctx::"+t.ctx[e]}return s},getHiddenAttributes:function(){var e=this,t={};for(var n in e.formElements)s.is(e.formElementsToggler[n])&&(t[n]=e.formElementsToggler[n].hasClassName("fonticon-eye-off"));return t},applyTemplate:function(e){var n=this;return n.reset().then((function(){if(s.is(e.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var a=n.formElements,o=n.formElementsToggler;for(var r in a)!0===e.hidden[r]&&(n.parent.isTemplate?(s.is(a[r])&&a[r].toggleClassName("visibility-masked",!0),s.is(o[r])&&(o[r].toggleClassName("fonticon-eye-off",!0),o[r].toggleClassName("fonticon-eye",!1))):s.is(a[r])&&(a[r].hide(),"attachments"===r&&(n.collaborativeSpaceField.hide(),n.organizationField.hide())))}return s.is(e.data,"object")&&e.data.hasOwnProperty("attachments")&&e.data.attachments.length>0?f.getDocuments(e.data.attachments).then((function(a){if(s.is(a.attachments,"array")){if(a.attachments.length!==e.data.attachments.length&&(i.displayNotification({msg:T.create.templateApplyWarningAttachments,eventID:"warning"}),0===a.attachments.length))return t.resolve();var o=a.attachments.map((function(e){return e.id}));return f.fetch(o).then((function(t){if(s.is(t.results,"array")&&t.results.length===o.length){var a=t.results.map((function(e){return f.parseFromFetch(e)}));if(e.data.primaryAttachment)for(var i=0;i<a.length;i++)e.data.primaryAttachment===a[i].id&&(a[i].isPrimary=!0);return n._addObjects(a)}return I.fetcher.recent(o).then((function(t){if(s.is(t.results,"array")){if(t.results.length!==o.length){var a=[];t.results.filter((function(e,t){null!=e.attributes.find((e=>e.value==o))&&a.push(f.parseFromFetch(e))}))}else a=t.results.map((function(e){return f.parseFromFetch(e)}));if(e.data.primaryAttachment)for(var i=0;i<a.length;i++)e.data.primaryAttachment===a[i].id&&(a[i].isPrimary=!0);return n._addObjects(a)}throw new Error("Unexpected number of fetch results for attachments.")}))}))}return t.resolve()})).catch((function(e){e&&e.error&&e.error.includes("Invalid Business Object Specified")&&i.displayNotification({msg:T.create.templateApplyWarningAttachments,eventID:"warning"}),t.reject(e)})):t.resolve()}))},_addFiles:function(e){for(var t=this,s=[],n=0;n<e.length;n++){var a=e[n],i="temporary_"+Math.floor(Date.now())+"_"+n,r=a.type,l={id:i,title:a.name,type:"Document",dispType:h.views.Attachment.types.Document,owner:{firstName:o.getUser().firstName,fullName:o.getUser().firstName.trim()+" "+o.getUser().lastName.trim(),lastName:o.getUser().lastName,user:o.getUser().login},relOwner:{firstName:o.getUser().firstName,fullName:o.getUser().firstName.trim()+" "+o.getUser().lastName.trim(),lastName:o.getUser().lastName,user:o.getUser().login},relOriginated:(new Date).toString()};a.hasOwnProperty("lastModifiedDate")?a.lastModifiedDate instanceof Date?(l.modified=a.lastModifiedDate.toString(),l.created=a.lastModifiedDate.toString()):(l.modified=new Date(a.lastModifiedDate).toString(),l.created=new Date(a.lastModifiedDate).toString()):(l.modified=(new Date).toString(),l.created=(new Date).toString());var c=new p(l);c.setDocumentTypeByMIME(r),c.set("isFile",!0),c.set("file",a),s.push(c)}return t.collection.add(s),s.forEach((function(e){"image"===e.get("documentType")&&(b.readImageURI(e.get("file")).then((function(t){e.set("thumbnailUrl",t),e.set("contentUrl",t)})),1===t.collection.size()&&e.set("isPrimary",!0))})),s},_addObjects:function(e){var n=this,a=e.filter((function(e){return void 0===n.collection.get(e.id)}));if(a.length!==e.length&&i.displayNotification({msg:h.replace(h.notifications.Attach.alreadyAttached,{count:e.length-a.length}),eventID:"warning"}),a.length>0){for(var r=[],l=0;l<a.length;l++){var c=a[l];c.relOwner={firstName:o.getUser().firstName,fullName:o.getUser().firstName.trim()+" "+o.getUser().lastName.trim(),lastName:o.getUser().lastName,user:o.getUser().login};var d=new p(c);r.push(d)}n.collection.add(r);for(var u=[],m=[],g=0;g<r.length;g++){var v=r[g];u.push(v.id),"Document"===v.get("type")&&m.push(v.id)}var b=[t.resolve()];u.length>0&&b.push(f.fetch(u).then((function(e){s.is(e.results,"array")?n.downloadAdditionalData(e.results):b.push(I.fetcher.recent(u).then((function(e){var t;s.is(e.results,"array")?(t=e.results.length!==u.length?e.results.filter((function(e){e.attributes.find((e=>e.value==u))})):e.results,n.downloadAdditionalData(t)):i.displayNotification({msg:T.replace(h.notifications.Fetch.failure),eventID:"error"})})).catch((function(e){i.displayNotification({msg:T.replace(h.notifications.Fetch.failure),eventID:"error"}),n._logger.error(e)})))})).catch((function(e){i.displayNotification({msg:T.replace(h.notifications.Fetch.failure),eventID:"error"}),n._logger.error(e)}))),m.length>0&&b.push(f.downloadDocuments(m).then((function(e){for(var t=0;t<e.length;t++){var s=e[t].id,a=n.collection.get(s);a&&e[t].downloadUrl&&void 0===e[t].errorMessage&&a.set("contentUrl",e[t].downloadUrl)}})).catch((function(e){i.displayNotification({msg:T.replace(h.notifications.Download.failure),eventID:"error"}),n._logger.error(e)})))}},downloadAdditionalData:function(e){for(var t=0;t<e.length;t++){var s=e[t].attributes.find((function(e){return"resourceid"===e.name})).value,n=this.collection.get(s);if(n){n.set("isProcessing",!0);var a=e[t].attributes.find((function(e){return"owner"===e.name})),i=e[t].attributes.find((function(e){return"ds6w:responsible"===e.name}));a&&a.value&&i&&i.value&&n.set("owner",{user:a.value,fullName:i.value,firstName:"",lastName:""});var o=e[t].attributes.find((function(e){return"ds6w:docextension"===e.name}));o&&o.value&&n.setDocumentType(o.value),1===this.collection.size()&&"image"===n.get("documentType")&&n.set("isPrimary",!0),n.set("isProcessing",!1)}}},_screenshot:function(){var e=this,t=E.get("widget").name===D;if(s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.hide(),t){E.get("component").utils.takeAnnotation((function(t){var s=t.blob;s.lastModifiedDate=new Date;var n=(new Date).toLocaleString();n=b.formatDate(n,{timePrecision:"sec"}).replace(A,"-"),s.name="screenshot_"+n+".png",e._addFiles([s]),e.parent.elements.dialog.show()}),(function(){e.parent.elements.dialog.show()}),(function(t){e._logger.error(t)}))}else{var n=E.get("component"),a=n.taskManager.addTakeScreenshotTask((function(t){for(var i=t.data,o=t.fileName,r=t.fileType,l=t.lastModified,c=atob(i.split(",")[1]),d=new ArrayBuffer(c.length),u=new Uint8Array(d),m=0;m<c.length;m++)u[m]=c.charCodeAt(m);var p=new File([d],o,{type:r,lastModified:l});e._addFiles([p]),s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(a)}),(function(){s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(a)}));n.maskForTask(a,T.tasks.addAttachments)}},_onCollectionSelect:function(){var e=this.collection.getSelectedItems();e.length>0?(this.fields.attachments.iconBar.enableItem("remove"),1===e.length&&"image"===e[0].get("documentType")?(this.fields.attachments.iconBar.enableItem("setAsPrimary"),this.fields.attachments.iconBar.enableItem("annotate")):(this.fields.attachments.iconBar.disableItem("setAsPrimary"),this.fields.attachments.iconBar.disableItem("annotate"))):(this.fields.attachments.iconBar.disableItem("remove"),this.fields.attachments.iconBar.disableItem("setAsPrimary"),this.fields.attachments.iconBar.enableItem("annotate"))},_onCatalogSwitchLayout:function(){this.fields.attachments.iconBar.getItem("switchCatalogLayout").elements.icon.toggleClassName("fonticon-view-small-thb",(this.catalog.layout+1)%2==1),this.fields.attachments.iconBar.getItem("switchCatalogLayout").elements.icon.toggleClassName("fonticon-view-list",this.catalog.layout%2==1)},_onDrop:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=f.parseFromDragEvent(e);if(n.hasOwnProperty("files")&&n.files instanceof FileList)t._addFiles(n.files);else if(b.isValid3DXContent(n)){var a=n.data.items.map((function(e){return e.objectId}));f.fetch(a).then((function(e){if(!s.is(e.results,"array"))throw new Error("Unexpected empty fetch results.");var n=e.results.map((function(e){return f.parseFromFetch(e)}));t._addObjects(n)})).catch((function(e){i.displayNotification({msg:T.replace(h.notifications.Attach.failure,{count:a.length}),eventID:"error"}),t._logger.error(e)}))}else i.displayNotification({msg:T.notifications.Drop.unsupported,eventID:"error"})},_onRequestAttachFrom3DX:function(e){var t=this,n=E.get("application");if(s.is(n,"object")&&n.isStandalone){var a=E.get("component"),i=a.taskManager.addObjectsTask((function(e){if(Array.isArray(e)&&null==e.physicalIds){let t=e.map((e=>e.physicalId));(e={}).physicalIds=t}if(Array.isArray(e.physicalIds)){var n=e.physicalIds;f.fetch(n).then((function(e){if(s.is(e.results,"array")&&e.results.length===n.length){var a=e.results.map((function(e){return f.parseFromFetch(e)}));return t._addObjects(a)}throw new Error("Unexpected number of fetch results for attachments.")})).finally((function(){s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.show(),a.unmaskForTask(i)}))}else t.parent.elements.dialog.show(),a.unmaskForTask(i)}),(function(){t.parent.elements.dialog.show(),a.unmaskForTask(i)}));a.maskForTask(i,T.tasks.addAttachments)}else y.search({title:h.Attach.SearchTitle,default_search_criteria:s.is(e,"string")?e:"",multiSel:!0,callback:function(e){var s=e.map((function(e){return f.parseFromSearch(e)}));t._addObjects(s)},cancel:function(){}})},_onRequestAttachFromLocalDisk:function(){var e=this;f.browseFileFromLocalDisk(e.container).then(e._addFiles.bind(e)).catch((function(t){i.displayNotification({msg:h.replace(h.notifications.BrowseFile.failure),eventID:"error"}),e._logger.error(t)}))},_addDropEvent:function(e){var t=this,s=0;e.addEventListener("drop",(function(){e.removeClassName("dragenter"),t._onDrop.apply(t,arguments)})),e.addEventListener("dragenter",(function(){e.addClassName("dragenter"),s++})),e.addEventListener("dragleave",(function(){--s<=0&&e.removeClassName("dragenter")})),e.addEventListener("mouseleave",(function(){--s<=0&&e.removeClassName("dragenter")})),document.addEventListener("dragover",(function(e){e.preventDefault()}))},_annotate:function(){var e=this,t=E.get("widget");b.Mask.mask(t.body);var s=e.collection.getSelectedItems()[0],n={className:"approve-annotation",saveCallback:e._annotationSaveCallback.bind(e),exitCallback:function(){e.annotation.destroy(),e.annotation=null}};if(s&&s.get("contentUrl"))n.imageURL=s.get("contentUrl");else{var a=t.body.getDimensions();n.defaultDimensions={width:a.width-50,height:a.height-50}}var o=new w(n);o.render(),o.isLoaded.then((function(){o.container.inject(t.body),e.annotation=o;var s=e.annotateCommand.getText();if(e.annotateCommand.addTextbox&&s){var n={text:s,centered:!0},a=new Event("onAddNewObject");a.data={tool:"createText",options:n,select:!0},e.annotation.dispatchEvent("onAddNewObject",a)}})).catch((function(t){e.annotation&&(e.annotation.destroy(),e.annotation=null),i.displayNotification({msg:T.replace(h.notifications.Annotation.initFailure),eventID:"error"}),e._logger.error(t)})).finally((function(){b.Mask.unmask(t.body)}))},_annotationSaveCallback:function(e){var t=this,s=(new Date).toLocaleString();s=b.formatDate(s,{timePrecision:"sec"}).replace(A,"-");var n=h.replace(h.annotate.defaultName,{date:s}),a=new File([e.blob],n,{type:"image/png",lastModified:Date.now()}),i=t.collection.getSelectedItems(),o=null;if(1===i.length){var r=i[0];o=r.get("isPrimary"),t.collection.remove(r)}var l=t._addFiles([a]);l&&l[0]&&(t.collection.select(l[0].id),o&&l[0].set("isPrimary",!0)),t.annotation.destroy(),t.annotation=null}});return _})),define("DS/IssueComponents/lifecycle/Lifecycle",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Attachments","DS/IssueComponents/close/Close","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y){"use strict";var E={STATES:{CREATE:0,ASSIGN:1,ACTIVE:2,REVIEW:3,CLOSED:4},STATES_ORDER:{0:"CREATE",1:"ASSIGN",2:"ACTIVE",3:"REVIEW",4:"CLOSED"},STATES_VALUES:{CREATE:"Create",ASSIGN:"Assign",ACTIVE:"Active",REVIEW:"Review",CLOSED:"Closed"},CSS:{ELEMENTS:{GRAPH_CONTAINER:"im-lifecycle-graph-container",GRAPH_NOT_SUPPORTED:"im-lifecycle-graph-not-supported",GRAPH_NOT_SUPPORTED_TEXT:"im-lifecycle-graph-not-supported-text",GRAPH_ARIADNE:"im-lifecycle-graph-ariadne",GRAPH_ARIADNE_PLACEHOLDER:"im-lifecycle-graph-ariadne-placeholder",GRAPH_ARIADNE_ROPE:"im-lifecycle-graph-ariadne-rope",GRAPH_STATES_CONTAINER:"im-lifecycle-graph-states-ctn",GRAPH_STATE:"im-lifecycle-graph-state",GRAPH_STATE_TEXT:"im-lifecycle-graph-state-text",GRAPH_STATE_OVERLAY:"im-lifecycle-graph-state-overlay",GRAPH_STATE_PREV:"im-lifecycle-graph-state-prev",GRAPH_STATE_CURR:"im-lifecycle-graph-state-curr",GRAPH_STATE_NEXT:"im-lifecycle-graph-state-next",GRAPH_STATE_CLICKABLE:"im-lifecycle-graph-state-clickable",GRAPH_STATE_REQUIRES_APPROVAL:"im-lifecycle-graph-state-requires-approval",GRAPH_STATE_CREATE:"im-lifecycle-graph-state-create",GRAPH_STATE_ASSIGN:"im-lifecycle-graph-state-assign",GRAPH_STATE_ACTIVE:"im-lifecycle-graph-state-active",GRAPH_STATE_REVIEW:"im-lifecycle-graph-state-review",GRAPH_STATE_CLOSED:"im-lifecycle-graph-state-closed",GRAPH_STATE_CURRENT_INDICATOR:"fonticon fonticon-expand-down im-lifecycle-graph-state-current-indicator",GRAPH_STATE_APPROVE:"fonticon fonticon-thumbs-up im-lifecycle-graph-state-approve",GRAPH_STATE_REJECT:"fonticon fonticon-thumbs-down im-lifecycle-graph-state-reject",GRAPH_STATE_INPROGRESS:"fonticon fonticon-clock im-lifecycle-graph-state-inprogress",GRAPH_HISTORY_CONTAINER:"im-lifecycle-graph-history-container",GRAPH_HISTORY_APPROVED:"fonticon fonticon-check im-lifecycle-graph-history-approved ",GRAPH_HISTORY_REJECTED:"fonticon fonticon-wrong im-lifecycle-graph-history-rejected",GRAPH_HISTORY_MORE:"fonticon fonticon-menu-dot im-lifecycle-graph-history-more",GRAPH_HISTORY_TOOLTIP:"im-lifecycle-graph-history-tooltip",GRAPH_HISTORY_TOOLTIP_TITLE:"im-lifecycle-graph-history-tooltip-title",STATE_APPROVE_MODAL:"im-lifecycle-approve-modal",STATE_APPROVE_MODAL_HEIGHT:490,STATE_APPROVE_MODAL_WIDTH:510,STATE_APPROVE_MODAL_BODY:"im-lifecycle-approve-modal-body",STATE_APPROVE_MODAL_REASON:"im-lifecycle-approve-modal-reason",STATE_APPROVE_MODAL_ATTACHMENTS:"im-lifecycle-approve-modal-attachments"}}};return e.extend({name:"DS/IssueComponents/lifecycle/Lifecycle",tagName:"div",className:"im-lifecycle-graph-component",_logger:null,domEvents:{"click div.im-lifecycle-graph-state":"_onStateClick"},defaultOptions:{ids:[],state:"Create",states:["Create","Assign","Active","Review","Closed"]},setup:function(e){var t=this;I.start(t.name+" setup"),t._parent(e),t._logger=n.getLogger(t.name),t.elements={},t._tooltips=[],t._statesTooltips=[],t._deferred={},t.isLoaded=new s((function(e,s){t._deferred.resolve=e,t._deferred.reject=s})),t.physicalIds=[],t._isProcessing=!1,I.end(t.name+" setup")},render:function(){var e=this;I.start(e.name+" render");var s=e.elements.graph=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_CONTAINER});s.inject(e.container),(e.elements.notSupported=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED_TEXT,html:y.lifecycle.notSupported,title:y.lifecycle.notSupported})).inject(s);var n=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_ARIADNE});t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_ARIADNE_PLACEHOLDER}).inject(n),(e.elements.ariadneRope=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_ARIADNE_ROPE})).inject(n),n.inject(s);var a=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_STATES_CONTAINER});a.inject(s);var i=Object.keys(E.STATES);return e.elements.states={create:null,assign:null,active:null,review:null,closed:null},e.elements.routesContainer={create:null,assign:null,active:null,review:null},i.sort((function(e,t){return E.STATES[e.toUpperCase()]-E.STATES[t.toUpperCase()]})).forEach((function(s,n){var r=E.CSS.ELEMENTS["GRAPH_STATE_"+s.toUpperCase()],l=y.maturity[s.toLowerCase()],c=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_TEXT,html:l}),d=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_STATE_OVERLAY}),u=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_STATE+" "+r,html:[d,c]});if(u.setData("state",s.toLowerCase()),e.elements.states[s.toLowerCase()]=u,u.inject(a),u.hide(),e._statesTooltips.push(new o({position:"top",target:c,body:y.lifecycle[s.toLowerCase()]})),n<i.length-1){var m=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_CONTAINER});e.elements.routesContainer[s.toLowerCase()]=m,m.inject(a),m.hide()}})),I.end(e.name+" render"),e},_renderApproveRejectButtons:function(e){var s=this,n=v.get("widget")||window.widget,d=e[0];s.elements.states[d.current.approveTo.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_REQUIRES_APPROVAL,!0);var m=y.maturity[d.current.approveTo.toLowerCase()],p=s.maturityGraph,h=E.STATES[d.current.approveTo.toUpperCase()];""!==p&&null!=p&&(m=p[h].stateUserName);var b=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_APPROVE});s._tooltips.push(new o({position:"left",target:b,body:y.replace(y.lifecycle.approveModal.header,{approveTo:m})})),b.addEventListener("click",(function(){var e=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),o=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});o.inject(e),t.createElement("label",{html:y.lifecycle.approveModal.reasonLabel}).inject(o);var d=new i({multiline:!0,rows:4,placeholder:y.lifecycle.approveModal.reasonPlaceholder});d.inject(o),d.getContent().toggleClassName("highlight",""===d.getValue()),d.getContent().addEventListener("keyup",(function(){d.getContent().toggleClassName("highlight",""===d.getValue())}));var p=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(e);var h=new g({parent:s,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=d.getValue();t&&(e=C.getFullName()+"\n"+(new Date).toLocaleString(n.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return u.getSearchQuery(s.physicalIds)}}});h.render(),h.inject(p),s.approveComponents={},s.approveComponents.attachments=h,s.approveComponents.reasonInput=d;var v={},b=new r({element:e}),I=new l({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:E.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:t.createElement("h4",{html:y.replace(y.lifecycle.approveModal.header,{approveTo:m})}),body:b,footer:[v.okButton=new a({value:y.lifecycle.approveModal.okButton,className:"primary",events:{onClick:function(){""!==d.getValue()?(f.Mask.mask(e),v.okButton.elements.container.addClassName("disabled"),v.cancelButton.elements.container.addClassName("disabled"),s._approveRoutes(s.routes,d.getValue(),h).then((function(){I.destroy(),s.approveComponents=null})).catch((function(t){var n=y.lifecycle.error;if(null!=t&&void 0!==t&&null!=t.error&&(n=t.error.message),n.includes("Action Taken and Resolution Statement are not filled in")){v.cancelButton.elements.container.removeClassName("disabled");var a=f.getErrorMessage("5");f.displayErrorMessage(a,"error")}else if(n.includes("Action Taken field is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");a=f.getErrorMessage("6");f.displayErrorMessage(a,"error")}else if(n.includes("Resolution Statement field is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");a=f.getErrorMessage("7");f.displayErrorMessage(a,"error")}else if(n.includes("Resolution Date is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");a=f.getErrorMessage("8");f.displayErrorMessage(a,"error")}else c.displayNotification({msg:n,eventID:"error"});s._logger.error(t),f.Mask.unmask(e)}))):c.displayNotification({msg:y.lifecycle.approveModal.reasonRequired,eventID:"warning"})}}}),v.cancelButton=new a({value:y.lifecycle.approveModal.cancelButton,className:"default",events:{onClick:function(){I.destroy(),s.approveComponents=null}}})]});I.inject(n.body),I.elements.container.setStyle("height",E.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),I.elements.container.setStyle("width",E.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),I.show(),d.focus()})),s.elements.approve=b,b.inject(s.elements.states[d.current.approveTo.toLowerCase()]);var I=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_REJECT});s._tooltips.push(new o({position:"left",target:I,body:y.replace(y.lifecycle.rejectModal.header,{approveTo:m})})),I.addEventListener("click",(function(){var e=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),o=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});o.inject(e),t.createElement("label",{html:y.lifecycle.rejectModal.reasonLabel}).inject(o);var d=new i({multiline:!0,rows:4,placeholder:y.lifecycle.rejectModal.reasonPlaceholder});d.inject(o),d.getContent().toggleClassName("highlight",""===d.getValue()),d.getContent().addEventListener("keyup",(function(){d.getContent().toggleClassName("highlight",""===d.getValue())}));var p=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(e);var h=new g({parent:s,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=d.getValue();t&&(e=C.getFullName()+"\n"+(new Date).toLocaleString(n.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return u.getSearchQuery(s.physicalIds)}}});h.render(),h.inject(p),s.rejectComponents={},s.rejectComponents.attachments=h,s.rejectComponents.reasonInput=d;var v={},b=new r({element:e}),I=new l({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:E.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:t.createElement("h4",{html:y.replace(y.lifecycle.rejectModal.header,{approveTo:m})}),body:b,footer:[v.okButton=new a({value:y.lifecycle.rejectModal.okButton,className:"primary",events:{onClick:function(){if(""===d.getValue())return c.displayNotification({msg:y.lifecycle.rejectModal.reasonRequired,eventID:"warning"}),void d.elements.container.addClassName("highlight");f.Mask.mask(e),v.okButton.elements.container.addClassName("disabled"),v.cancelButton.elements.container.addClassName("disabled"),s._rejectRoutes(s.routes,d.getValue(),h).then((function(){I.destroy()})).catch((function(t){c.displayNotification({msg:y.lifecycle.error,eventID:"error"}),s._logger.error(t),f.Mask.unmask(e)}))}}}),v.cancelButton=new a({value:y.lifecycle.rejectModal.cancelButton,className:"default",events:{onClick:function(){I.destroy()}}})]});I.inject(n.body),I.elements.container.setStyle("height",E.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),I.elements.container.setStyle("width",E.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),I.show(),d.focus()})),s.elements.reject=I,I.inject(s.elements.states[d.current.approveTo.toLowerCase()])},_renderInProgressIndicator:function(e){var s=this,n=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_INPROGRESS});s.elements.inProgressIndicator=n;var a=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),i=e[0];if(e.length>1)s._tooltips.push(new o({position:"bottom",target:n,body:"<span>"+y.lifecycle.routeIndicatorTooltip.inProgressTooltip.multiSelectionTitle+"</span>"})),n.inject(s.elements.states[i.current.approveTo.toLowerCase()]);else if(1===e.length){var r=i.current.reviewers,l=i.current.decisions.filter((function(e){return"approved"===e.status||"rejected"===e.status})).map((function(e){return e.reviewer.user})),c=r.filter((function(e){return-1===l.indexOf(e.user)}));if(c.length>0){var d=t.createElement("div",{html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+y.lifecycle.routeIndicatorTooltip.inProgressTooltip.title+"</span>"});c.forEach((function(e){t.createElement("span",{html:"<span>"+e.fullName+"</span>"}).inject(d)})),d.inject(a)}var u=i.current.decisions.filter((function(e){return"approved"===e.status}));if(u.length>0){var m=t.createElement("div",{html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+y.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});u.forEach((function(e){var s=y.replace(y.lifecycle.routeIndicatorTooltip.approvalText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(m)})),m.inject(a)}s._tooltips.push(new o({position:"bottom",target:n,body:a})),n.inject(s.elements.states[i.current.approveTo.toLowerCase()])}},_renderRoutesHistory:function(e){var s=this;if(Array.isArray(e.history)&&e.history.length>0){s.elements.routesIndicators={create:{more:null,last:null,nonLast:[]},assign:{more:null,last:null,nonLast:[]},active:{more:null,last:null,nonLast:[]},review:{more:null,last:null,nonLast:[]}};var n={create:[],assign:[],active:[],review:[]};e.history.forEach((function(e){n[e.from.toLowerCase()].push(e)})),Object.keys(n).forEach((function(a){s.elements.routesContainer[a].empty();var i=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_MORE});i.inject(s.elements.routesContainer[a]),i.hide(),s.elements.routesIndicators[a].more={element:i,tooltip:null},n[a]=n[a].sort((function(e,t){return e.date?t.date?new Date(e.date)-new Date(t.date):-1:1})),n[a].forEach((function(i,r){var l="approved"===i.status?E.CSS.ELEMENTS.GRAPH_HISTORY_APPROVED:E.CSS.ELEMENTS.GRAPH_HISTORY_REJECTED,c=t.createElement("div",{class:l});c.addEventListener("click",(function(){s.dispatchEvent("request:openRoute",{issueId:e.physicalId,route:i})}));var d=s.elements.routesContainer[a];c.inject(d),r===n[a].length-1?s.elements.routesIndicators[a].last={data:i,element:c}:s.elements.routesIndicators[a].nonLast.unshift({data:i,element:c});var u=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),m=i.decisions.filter((function(e){return"rejected"===e.status}));if(m.length>0){var p=t.createElement("div",{html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+y.lifecycle.routeIndicatorTooltip.rejectionTitle+"</span>"});m.forEach((function(e){var s=y.replace(y.lifecycle.routeIndicatorTooltip.rejectionText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(p)})),p.inject(u)}var f=i.decisions.filter((function(e){return"approved"===e.status}));if(f.length>0){var g=t.createElement("div",{html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+y.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});f.forEach((function(e){var s=y.replace(y.lifecycle.routeIndicatorTooltip.approvalText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(g)})),g.inject(u)}s._tooltips.push(new o({position:"bottom",target:c,body:u}))}))}))}},refresh:function(e){var s=this;s.physicalIds=e;var n=e[0],a=[];return b.issues.getMaturityGraph({data:{id:n}}).then((function(n){""!==n&&null!=n&&(a=n.data.policies[0].maturityGraph.states,s.maturityGraph=a),b.routes.retrieve({data:{objects:e.map((function(e){return{physicalId:e}}))}}).then((function(n){s.reset(),s.routes=n.results.map((function(e){return e.body}));var i=s.routes.every((function(e){return e.state===s.routes[0].state}));if(e.length===n.results.length&&i){var o=t.is(s.routes[0].current,"object")&&t.is(s.routes[0].current.from,"string"),r=s.routes.every((function(e){return(t.is(e.current,"object")&&t.is(e.current.from,"string"))===o}));if(r){var l=s.routes[0],c=l.state,d=E.STATES[c.toUpperCase()],u=E.STATES_ORDER[d+1],m=E.STATES_ORDER[d-1];if(Object.keys(s.elements.states).forEach((function(e){if(e!==E.STATES_VALUES.CLOSED.toLowerCase()?s.elements.states[e].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1):s.elements.states[e].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),s.elements.states[e].removeClassName(E.CSS.ELEMENTS.GRAPH_STATE_CURR),e===l.state.toLowerCase()&&(s.elements.states[e].addClassName(E.CSS.ELEMENTS.GRAPH_STATE_CURR),s.elements.currentIndicator=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_CURRENT_INDICATOR}),s.elements.currentIndicator.inject(s.elements.states[e])),null!=a&&""!==a){var n=E.STATES[e.toUpperCase()],i=a[n].stateUserName;s.getContent().getElementsByClassName(E.CSS.ELEMENTS.GRAPH_STATE_TEXT)[n].setText(i);s._statesTooltips[n].getBody();var o=y.lifecycle[e.toUpperCase()];if(null!=o&&""!==o){var r=y.replace(y.lifecycle[e.toUpperCase()],{stateDisplayName:i});s._statesTooltips[n].setBody(r)}}})),l.current&&l.current.from===c){void 0!==u&&s.elements.states[u.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1),void 0!==m&&m!=E.STATES_ORDER[Object.keys(E.STATES_ORDER).length-2]&&s.elements.states[m.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1);var p=C.getUserName();if(s.routes.every((function(e){return-1!==e.current.reviewers.map((function(e){return e.user})).indexOf(p)}))){var f=s.routes.some((function(e){return-1===e.current.decisions.filter((function(e){return"approved"===e.status||"rejected"===e.status})).map((function(e){return e.reviewer.user})).indexOf(p)}));f?s._renderApproveRejectButtons(s.routes):s._renderInProgressIndicator(s.routes)}else s._renderInProgressIndicator(s.routes)}else void 0!==u&&(s.elements.states[u.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),s.elements.states[E.STATES_VALUES.CLOSED.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0)),void 0!==m&&m!=E.STATES_ORDER[Object.keys(E.STATES_ORDER).length-2]&&s.elements.states[m.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0)}else s.container.addClassName(E.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED);1===s.routes.length&&s._renderRoutesHistory(s.routes[0])}else s.container.addClassName(E.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED)})).then((function(){s.resize(),s.dispatchEvent("onReady")}))}))},resize:function(){var e=this;if(Array.isArray(e.routes)&&0!==e.routes.length){var s=Object.keys(e.elements.states),n=e.routes[0].state.toLowerCase(),a=E.STATES[n.toUpperCase()],i=e.container.offsetWidth,r=Math.floor(i/140);if(r=r>s.length?5:r,s.forEach((function(t){e.elements.states[t].hide(),void 0!==e.elements.routesContainer[t]&&null!==e.elements.routesContainer[t]&&e.elements.routesContainer[t].hide()})),e.elements.states[n].show(),void 0!==e.elements.routesContainer[n]&&null!==e.elements.routesContainer[n]&&e.elements.routesContainer[n].show(),"closed"===n){var l=a-1,c=E.STATES_ORDER[l].toLowerCase();e.elements.states[c].show(),void 0!==e.elements.routesContainer[c]&&null!==e.elements.routesContainer[c]&&e.elements.routesContainer[c].show()}else{var d=a+1,u=E.STATES_ORDER[d].toLowerCase();e.elements.states[u].show()}if(r>=2)for(var m="closed"===n?a-1:a,p=0;p<r-2;p++){var f=m-p-1;if(f>=0){var g=E.STATES_ORDER[f].toLowerCase();e.elements.states[g].show(),void 0!==e.elements.routesContainer[g]&&null!==e.elements.routesContainer[g]&&e.elements.routesContainer[g].show()}else{f=p+2;var h=E.STATES_ORDER[f].toLowerCase();e.elements.states[h].show();var b=E.STATES_ORDER[f-1].toLowerCase();void 0!==e.elements.routesContainer[b]&&null!==e.elements.routesContainer[b]&&e.elements.routesContainer[b].show()}}var C=(i-100*r)/(r-1);Object.keys(e.elements.routesContainer).forEach((function(s){if(e.elements.routesContainer[s].setStyle("width",C),void 0!==e.elements.routesIndicators&&null!==e.elements.routesIndicators)if(null!==e.elements.routesIndicators[s].last&&e.elements.routesIndicators[s].last.element.show(),Array.isArray(e.elements.routesIndicators[s].nonLast)&&1===e.elements.routesIndicators[s].nonLast.length)e.elements.routesIndicators[s].nonLast[0].element.show(),e.elements.routesIndicators[s].more.element.hide();else if(e.elements.routesIndicators[s].nonLast.length>1){var n=Math.floor(C/26)-1,a=0;e.elements.routesIndicators[s].nonLast.forEach((function(t,i){a<n?a===n-1&&i<e.elements.routesIndicators[s].nonLast.length-1?(t.element.hide(),a+=1):(t.element.show(),a+=1):t.element.hide()}));var i=e.elements.routesIndicators[s].nonLast.filter((function(e){return e.element.isHidden()}));if(i.length>0){if(e.elements.routesIndicators[s].more.element.show(),null!==e.elements.routesIndicators[s].more.tooltip)try{e.elements.routesIndicators[s].more.tooltip.destroy()}catch(e){}for(var r=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP,html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+y.replace(y.lifecycle.routeIndicatorTooltip.moreTooltip.title,{number:i.length})+"</span>"}),l=i.length-1;l>=0;l--){var c=i[l].data.date,d="approved"===i[l].data.status?"approvalText":"rejectionText";t.createElement("div",{html:"<span>"+y.replace(y.lifecycle.routeIndicatorTooltip.moreTooltip[d],{date:new Date(c).toLocaleString(v.get("widget").lang)})+"</span>"}).inject(r)}e.elements.routesIndicators[s].more.tooltip=new o({position:"bottom",target:e.elements.routesIndicators[s].more.element,body:r})}else if(e.elements.routesIndicators[s].more.element.hide(),null!==e.elements.routesIndicators[s].more.tooltip)try{e.elements.routesIndicators[s].more.tooltip.destroy()}catch(e){}}}));var I=e.elements.states[n].offsetLeft;e.elements.ariadneRope.setStyles({width:I+"px"})}},reset:function(){var e=this;e.container.removeClassName(E.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED),Object.keys(e.elements.states).forEach((function(t){t!==E.STATES_VALUES.CLOSED.toLowerCase()?e.elements.states[t].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1):e.elements.states[t].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),e.elements.states[t].removeClassName(E.CSS.ELEMENTS.GRAPH_STATE_CURR),e.elements.states[t].removeClassName(E.CSS.ELEMENTS.GRAPH_STATE_REQUIRES_APPROVAL),void 0!==e.elements.routesContainer[t]&&e.elements.routesContainer[t].empty()})),e.elements.currentIndicator&&e.elements.currentIndicator.destroy(),e.elements.approve&&e.elements.approve.destroy(),e.elements.reject&&e.elements.reject.destroy(),e.elements.inProgressIndicator&&e.elements.inProgressIndicator.destroy();try{e._tooltips.forEach((function(e){e.destroy()}))}catch(e){}e._tooltips=[],e._isProcessing=!1},destroy:function(){var e=this;e.reset();try{e._statesTooltips.forEach((function(e){e.destroy()}))}catch(e){}e._statesTooltips=[]},_onStateClick:function(e){var s=this;if(!s._isProcessing){var n=null;if(e.target.hasClassName(E.CSS.ELEMENTS.GRAPH_STATE)?n=e.target:e.target.getParent().hasClassName(E.CSS.ELEMENTS.GRAPH_STATE)&&(n=e.target.getParent()),null!==n&&n.hasClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE)){var a=s.routes[0].state.toLowerCase(),i=n.getData("state"),o=E.STATES[i.toUpperCase()]-E.STATES[a.toUpperCase()];if(1===o||-1===o){s._isProcessing=!0,f.Mask.mask(s.container);var r=1===o?"promote":"demote",l=s.routes.map((function(e){return{physicalId:e.physicalId,state:E.STATES_VALUES[i.toUpperCase()]}}));b.issues[r]({data:{objects:l}}).then((function(){1===o?s.dispatchEvent("onPromotionCompleted",{issues:l}):s.dispatchEvent("onDemotionCompleted",{issues:l})})).catch((function(e){var n=y.lifecycle.error,a="";if(e&&e.error&&t.is(e.error.message,"string")&&(a=e.error.message),a.includes("Action Taken and Resolution Statement are not filled in")){n=f.getErrorMessage("5");f.displayErrorMessage(n,"error")}else if(a.includes("Action Taken field is not filled in")){n=f.getErrorMessage("6");f.displayErrorMessage(n,"error")}else if(a.includes("Resolution Statement field is not filled in")){n=f.getErrorMessage("7");f.displayErrorMessage(n,"error")}else if(a.includes("Resolution Date is not filled in")){n=f.getErrorMessage("8");f.displayErrorMessage(n,"error")}else if(a.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation.")){var i=f.getErrorMessage("1005_1");f.displayErrorMessage(i,"error")}else if(e.error&&e.error.internal&&(e.error.internal.includes("Message:No privilege for operation Severity:2 ErrorCode:1500019")||e.error.internal.includes("User does not have necessary privileges"))){i=f.getErrorMessage("1005");f.displayErrorMessage(i,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to promote or demote this issue, as a validation process is attached to the issue for assignees")){i=f.getErrorMessage("1004");f.displayErrorMessage(i,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("Issue object cannot be demoted, as atleast one Resolving Item connected to Issue has Passed IN Work state.")){i=f.getErrorMessage("9");f.displayErrorMessage(i,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("Issue object cannot be promoted, as atleast one Resolving Item connected to Issue is not Completed.")){i=f.getErrorMessage("13");f.displayErrorMessage(i,"error")}else e&&e.error&&t.is(e.error.message,"string")&&(n=e.error.message,c.displayNotification({msg:n,eventID:"error"}));s._logger.error(e)})).finally((function(){s.refresh(s.physicalIds).then((function(){f.Mask.unmask(s.container),s._isProcessing=!1}))}))}else if(i===E.STATES_VALUES.CLOSED.toLowerCase()&&1!==o){var d=s.routes.map((function(e){return e.physicalId}));new h({physicalIds:d}).render()}else c.displayNotification({msg:y.replace(o>0?y.kanban.dnd.unsupportedPromote:y.kanban.dnd.unsupportedDemote,{currState:a,state:i}),eventID:"error"}),s._logger.error(new Error("Unexpected or unsupported promotion/demotion."))}}},_approveRoutes:function(e,t,s){var n=this,a=e.map((function(e){return e.physicalId}));return f.Mask.mask(n.container),n._connectAttachments(a,s).then((function(){return b.routes.approve({data:{objects:e.map((function(e){return{physicalId:e.physicalId,comment:t}}))}}).then((function(e){var t=e.results.map((function(e){return{physicalId:e.body.physicalId,task:e.body.task}}));n.dispatchEvent("onApprovalCompleted",{issues:t,modifiedAttributes:["attachments"]})}))})).finally((function(){n.refresh(n.physicalIds).then((function(){f.Mask.unmask(n.container)}))}))},_rejectRoutes:function(e,t,s){var n=this,a=e.map((function(e){return e.physicalId}));return f.Mask.mask(n.container),n._connectAttachments(a,s).then((function(){return b.routes.reject({data:{objects:e.map((function(e){return{physicalId:e.physicalId,reason:t}}))}}).then((function(e){var t=e.results.map((function(e){return{physicalId:e.body.physicalId,task:e.body.task}}));n.dispatchEvent("onRejectionCompleted",{issues:t,modifiedAttributes:["attachments"]})}))})).finally((function(){n.refresh(n.physicalIds).then((function(){f.Mask.unmask(n.container)}))}))},_connectAttachments:function(e,t){var n=this,a=v.get("widget")||window.widget,i=t.collection,o=function(e){this.set("isCancelable",!0),this.set("request",e)},r=function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}},l=function(){this.set("isCancelable",!1),this.set("request",null)},f=i.filter((function(e){return!0===e.get("isFile")})).map((function(e){var t=e.clone();return t.set("isProcessing",!0),t})),g=[];if(f.length>0){var h=new d({id:"uploadAttachmentsToRoutes",attachments:f});new m({container:a.body,collection:h}).render(),g=f.map((function(e){var t=u.uploadFile(e.get("file"),null,{onCheckinStart:o.bind(e),onCheckinProgress:r.bind(e),onCheckinComplete:l.bind(e)});return t=t.then((function(t){t&&t.data&&t.data.length>0&&t.data[0].id&&(i.get(e.id).set("isFile",!1),i.get(e.id).set("id",t.data[0].id),e.set("id",t.data[0].id),e.set("isFile",!1),e.set("isProcessing",!1))})).catch((function(t){e.set("isFailed",!0),e.set("isProcessing",!1),e.set("isCancelable",!1),e.set("request",null),t instanceof Error&&(c.displayNotification({msg:p.replace(p.notifications.Upload.failure,{count:1}),eventID:"error"}),n._logger.error(t))}))}))}return s.all(g).then((function(){var t=i.filter((function(e){return!0!==e.get("isFile")})).map((function(e){return e.clone()})),a=[];return t.length>0&&e.forEach((function(e){var s=t.map((function(e){return e.id}));a.push(u.connectDocumentsToParent(s,e).catch((function(e){c.displayNotification({msg:p.replace(p.notifications.Attach.failure,{count:1}),eventID:"error"}),n._logger.error(e)})))})),s.all(a)})).then((function(){var t=[],a=i.filter((function(e){return!0===e.get("isPrimary")}));if(1===a.length){var o=a[0];return e.forEach((function(e){t.push(u.setAsPrimary(o.get("id"),e,!0).then((function(){})).catch((function(e){c.displayNotification({msg:p.notifications.SetAsPrimary.failure,eventID:"error"}),n._logger.error(e)})))})),s.all(t)}return s.resolve()}))}})})),define("DS/IssueComponents/templates/TemplateDelete",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/ProgressBar","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v){"use strict";var b="PRIVATE";return t.extend({name:"DS/IssueComponents/templates/TemplateDelete",tag:"div",className:"Templatedelete-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=l.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the delete component"),s.templates={},s.titles=[],s.names=[],s.indelible=[],s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.currentUser=m.getUserName(),s.isLoaded=new e((function(e,t){s._deferred.resolve=e,s._deferred.reject=t}))},render:function(){var e=this;return f.start(e.name+" render"),e.dialog(),f.end(e.name+" render"),e},destroy:function(){var e=this;f.start(e.name+" destroy"),e.physicalIds=[],e.templates={},e.titles=[],e.names=[],e.indelible=[],e.validate=null,e.modal.destroy(),e.modal=null,e.isLoaded=null,e._deferred={resolve:null,reject:null},f.end(e.name+" destroy")},dialog:function(){var e=this,t=u.get("widget")||window.widget,s=u.get("templateComponentDialog")?u.get("templateComponentDialog"):u.get("templateComponent");a.mask(e.container),e.modal=new r({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"delete-templates-dialog",title:v.delete.preparing,header:null,body:e.container,footer:[e.validate=new n({value:v.delete.delete,className:"primary",events:{onClick:function(){e.container.getChildren()[0].addClassName("disableContent"),e.modal.elements.footer.addClassName("disableContent"),e.buildProgressBar().inject(e.container),e.removeTemplates(e.physicalIds).then((function(){var t="",n=[];h.getRecentlyUsedTemplates().then((function(t){""!==t.body&&(n=t.body),n.length>0&&(n=n.filter((t=>!e.physicalIds.includes(t.physicalId))),h.setRecentlyUsedTemplates(n).catch((function(t){e._logger.error("Could not save the preferences: %o",t)})))})).finally((function(){t=1===e.physicalIds.length?v.replace(v.singleDeleteSuccess,{title:e.titles[e.titles.length-1]}):v.replace(v.multipleDeleteSuccess,{number:e.physicalIds.length}),s&&s.document.removeRootsById(e.physicalIds),e.destroy(),c.displayNotification({msg:t,eventID:"success"})}))})).catch((function(t){e.destroy(),c.displayNotification({msg:v.templates.errors.remove,eventID:"error"})}))}},disabled:!0}),new n({value:v.delete.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().inject(e.container),e.physicalIds.length>0?(e.validate.enable(),e.modal.setTitle(v.replace(v.templateDeleteTitle,{number:e.physicalIds.length})),0===e.indelible.length&&(e.container.getElement(".no-delete-templates-label").addClassName("hidden"),e.container.getElement(".no-delete-templates-content").addClassName("hidden"))):(e.validate.disable(),e.modal.setTitle(v.templateNothingToDel),e.container.getElement(".delete-templates-label").addClassName("hidden"),e.container.getElement(".delete-templates-content").addClassName("hidden")),e.validate.focus(),a.unmask(e.container),new i({element:e.container}).inject(e.modal.getBody())},buildProgressBar:function(){return new o({shape:"circular",infiniteFlag:!0})},build:function(){var e=this;f.start(e.name+" build");for(var t=e._check(e.getOption("selectedNodes")),n=t.deletable,a=t.indelible,i={physicalIds:[],titles:[],icons:[]},o=0;o<n.length;o++)i.physicalIds.push(n[o].physicalId),i.titles.push(n[o].title+" ("+n[o].name+")"),i.icons.push({tag:"span",class:"fonticon fonticon-issue-type "+n[o].state.toLowerCase()});var r=[];i.titles.forEach((function(e,t){r.push(s.createElement("li",{html:[i.icons[t],s.String.escapeHTML(e)],title:e}))}));for(var l={physicalIds:[],titles:[],icons:[]},c=0;c<a.length;c++)l.physicalIds.push(a[c].physicalId),l.titles.push(a[c].title+" ("+a[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue-type "});var d=[];l.titles.forEach((function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))})),e.physicalIds=i.physicalIds,e.titles=i.titles,e.indelible=l.physicalIds;var m=u.get("templateMaturityGraph");return f.end(e.name+" build"),s.createElement("div",{html:[{tag:"div",class:"delete-templates-label",html:[{tag:"span",class:"delete-templates-label-first",html:v.delete.warning},{tag:"span",class:"delete-templates-label-second",html:v.templates.confirmDelete.text}]},{tag:"div",class:"delete-templates-content",html:s.createElement("ul",{html:r,class:"delete-templates-content-list"})},{tag:"div",class:"no-delete-templates-label",html:v.replace(v.templateIndelible,{state:m[b]?m[b]:"Public"})},{tag:"div",class:"no-delete-templates-content",html:s.createElement("ul",{html:d,class:"no-delete-templates-content-list"})}]})},_check:function(e){var t=this;f.start(t.name+" _check");for(var s={deletable:[],indelible:[]},n=0;n<e.length;n++){var a=e[n].options;!0===t.utils.isPrivate(a)&&1==t.utils.isOwned(a,t.currentUser)?s.deletable.push({physicalId:a.physicalId,name:a.name,state:a.state,title:a.title?a.title:""}):s.indelible.push({physicalId:a.physicalId,name:a.name,state:a.state,title:a.title?a.title:""})}return s},removeTemplates:function(e){return p.issues.delete({data:{objects:e.map((function(e){return{physicalId:e}}))}}).then((function(e){}))},utils:{isPrivate:function(e){return e.state===b},isOwned:function(e,t){return e.owner.user===t}}})})),define("DS/IssueComponents/team/AddMembersLayout",["DS/IssueComponents/team/AddMembersView","DS/IssueComponents/team/MembersGridUtil","DS/IssueComponents/team/MembersMakeDroppable","DS/IssueComponents/team/MembersDataGridModel","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/Controls/Button","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f){"use strict";var g={createAddMemberPanel:function(t){g.teamlayoutModel=t.model,new e({events:{searchMember:function(e){var t='(flattenedtaxonomies:"types/Person" AND policycurrent:"Person.Active")';t+="OnPremise"===i.getTenant()?' OR (flattenedtaxonomies:"types/Group" AND current:"active")':" OR ([ds6w:type]:(Group))",i.search({title:f.team.addMember[e.toLowerCase()],default_search_criteria:"",precond:t,multiSel:!0,callback:function(t){for(var s=[],n=0;n<t.length;n++)s.push({objectId:t[n].id,identifier:t[n]["ds6w:identifier"],objectType:t[n]["ds6w:type"],displayType:t[n]["ds6w:type_value"],displayName:t[n]["ds6w:label"],serviceId:t[n].sourceid});var a={data:{}};a.data.items=s,g.ExecuteDropForAddMemberPanel(a,e)},cancel:function(){}})}}}).render().inject(t.target);var n=t.target.querySelector(".iss-add-member-coowner-field"),o=t.target.querySelector(".iss-add-member-assignee-field"),r=t.target.querySelector(".iss-add-member-contributor-field"),m=t.target.querySelector(".iss-add-member-informedUser-field"),p=t.target.querySelector(".iss-add-member-button"),h=t.target.querySelector(".iss-add-member-coowner-field-container"),v=t.target.querySelector(".iss-add-member-assignee-field-container"),b=t.target.querySelector(".iss-add-member-contributor-field-container"),C=t.target.querySelector(".iss-add-member-informedUser-field-container");s.makeDroppable(h,g.ExecuteDropForCoownerField),s.makeDroppable(v,g.ExecuteDropForAssigneeField),s.makeDroppable(b,g.ExecuteDropForContributorField),s.makeDroppable(C,g.ExecuteDropForInformedUserField),g.addButton=new l({label:f.team.addMember.add,emphasize:"primary",disabled:!0}).inject(p),g.cancelButton=new l({label:f.team.addMember.cancel,emphasize:"secondary"}).inject(p),g.modelForCoowner=new d,g.modelForContributor=new d,g.modelForAssignee=new d,g.modelForInformedUser=new d,g.autoCompleteAssignee=new c({elementsTree:function(e){return new Promise((function(t,s){setTimeout((function(){a.getMembers({text:e}).then((function(e){g.modelForAssignee.empty(),g.modelForAssignee.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(s){let n={};s.issues;var a=s.membersDataGridModel.assignees.getChildren()?s.membersDataGridModel.assignees.getChildren():[];for(let e=0;e<a.length;e++){let t=a[e].options.grid;n[t.user]=t.role}for(var i=g.autoCompleteAssignee.selectedItems,o=0;o<e.length;o++){var r=e[o].identifier,l=[];if(i&&i.length>0&&(l=i.filter((t=>"person"===e[o].type.toLowerCase()?t.options.identifier===e[o].identifier:t.options.identifier===e[o].id))),!i||0==i.length||0==l.length)if("person"===e[o].type.toLowerCase()){var c=e[o].name+" ("+e[o].identifier.toUpperCase()+")";if(!n.hasOwnProperty(r)||!n[r].contains("Assignee")){var d=new u({label:c,value:e[o].identifier,name:e[o].name,identifier:e[o].identifier,type:e[o].type.toLowerCase()});g.modelForAssignee.addRoot(d)}}else if(!("group"!==e[o].type.toLowerCase()||n.hasOwnProperty(e[o].id)&&n[e[o].id].contains("Assignee"))){d=new u({label:e[o].name,value:e[o].identifier,name:e[o].name,identifier:e[o].id,type:e[o].type.toLowerCase()});g.modelForAssignee.addRoot(d)}}g.modelForAssignee.pushUpdate(),t(g.modelForAssignee)}))}),(function(e){t(g.modelForAssignee)}))}),1e3)}))},placeholder:f.team.addMember.typeToSearch,customFilterMessage:f.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(o),g.autoCompleteCoowner=new c({elementsTree:function(e){return new Promise((function(t,s){setTimeout((function(){a.getMembers({text:e}).then((function(e){g.modelForCoowner.empty(),g.modelForCoowner.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(s){let n={};s.issues;var a=s.membersDataGridModel.coowners.getChildren()?s.membersDataGridModel.coowners.getChildren():[];for(let e=0;e<a.length;e++){let t=a[e].options.grid;n[t.user]=t.role}for(var i=g.autoCompleteCoowner.selectedItems,o=0;o<e.length;o++){var r=e[o].identifier,l=[];i&&i.length>0&&(l=i.filter((t=>"person"===e[o].type.toLowerCase()?t.options.identifier===e[o].identifier:t.options.identifier===e[o].id)));var c=(s.membersDataGridModel.owner.getChildren()?s.membersDataGridModel.owner.getChildren():[]).filter((t=>t.options.grid.user===e[o].identifier));if((!i||0==i.length||0==l.length)&&0==c.length)if("person"===e[o].type.toLowerCase()){var d=e[o].name+" ("+e[o].identifier.toUpperCase()+")";if(!n.hasOwnProperty(r)||!n[r].contains("Co-owner")){var m=new u({label:d,value:e[o].identifier,name:e[o].name,identifier:e[o].identifier,type:e[o].type.toLowerCase()});g.modelForCoowner.addRoot(m)}}else if(!("group"!==e[o].type.toLowerCase()||n.hasOwnProperty(e[o].id)&&n[e[o].id].contains("Co-owner"))){m=new u({label:e[o].name,value:e[o].identifier,name:e[o].name,identifier:e[o].id,type:e[o].type.toLowerCase()});g.modelForCoowner.addRoot(m)}}g.modelForCoowner.pushUpdate(),t(g.modelForCoowner)}))}),(function(e){t(g.modelForCoowner)}))}),1e3)}))},placeholder:f.team.addMember.typeToSearch,customFilterMessage:f.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(n),g.autoCompleteContributor=new c({elementsTree:function(e){return new Promise((function(t,s){setTimeout((function(){a.getMembers({text:e}).then((function(e){g.modelForContributor.empty(),g.modelForContributor.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(s){let n={};s.issues;var a=s.membersDataGridModel.contributors.getChildren()?s.membersDataGridModel.contributors.getChildren():[];for(let e=0;e<a.length;e++){let t=a[e].options.grid;n[t.user]=t.role}for(var i=g.autoCompleteContributor.selectedItems,o=0;o<e.length;o++){var r=e[o].identifier,l=[];if(i&&i.length>0&&(l=i.filter((t=>"person"===e[o].type.toLowerCase()?t.options.identifier===e[o].identifier:t.options.identifier===e[o].id))),!i||0==i.length||0==l.length)if("person"===e[o].type.toLowerCase()){var c=e[o].name+" ("+e[o].identifier.toUpperCase()+")";if(!n.hasOwnProperty(r)||!n[r].contains("Contributor")){var d=new u({label:c,value:e[o].identifier,name:e[o].name,identifier:e[o].identifier,type:e[o].type.toLowerCase()});g.modelForContributor.addRoot(d)}}else if(!("group"!==e[o].type.toLowerCase()||n.hasOwnProperty(e[o].id)&&n[e[o].id].contains("Contributor"))){d=new u({label:e[o].name,value:e[o].identifier,name:e[o].name,identifier:e[o].id,type:e[o].type.toLowerCase()});g.modelForContributor.addRoot(d)}}g.modelForContributor.pushUpdate(),t(g.modelForContributor)}))}),(function(e){t(g.modelForContributor)}))}),1e3)}))},placeholder:f.team.addMember.typeToSearch,customFilterMessage:f.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(r),g.autoCompleteInformedUser=new c({elementsTree:function(e){return new Promise((function(t,s){setTimeout((function(){a.getMembers({text:e}).then((function(e){g.modelForInformedUser.empty(),g.modelForInformedUser.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(s){let n={};s.issues;var a=s.membersDataGridModel.informedUsers.getChildren()?s.membersDataGridModel.informedUsers.getChildren():[];for(let e=0;e<a.length;e++){let t=a[e].options.grid;n[t.user]=t.role}for(var i=g.autoCompleteInformedUser.selectedItems,o=0;o<e.length;o++){var r=e[o].identifier,l=[];if(i&&i.length>0&&(l=i.filter((t=>"person"===e[o].type.toLowerCase()?t.options.identifier===e[o].identifier:t.options.identifier===e[o].id))),!i||0==i.length||0==l.length)if("person"===e[o].type.toLowerCase()){var c=e[o].name+" ("+e[o].identifier.toUpperCase()+")";if(!n.hasOwnProperty(r)||!n[r].contains("InformedUser")){var d=new u({label:c,value:e[o].identifier,name:e[o].name,identifier:e[o].identifier,type:e[o].type.toLowerCase()});g.modelForInformedUser.addRoot(d)}}else if(!("group"!==e[o].type.toLowerCase()||n.hasOwnProperty(e[o].id)&&n[e[o].id].contains("InformedUser"))){d=new u({label:e[o].name,value:e[o].identifier,name:e[o].name,identifier:e[o].id,type:e[o].type.toLowerCase()});g.modelForInformedUser.addRoot(d)}}g.modelForInformedUser.pushUpdate(),t(g.modelForInformedUser)}))}),(function(e){t(g.modelForInformedUser)}))}),1e3)}))},placeholder:f.team.addMember.typeToSearch,customFilterMessage:f.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(m),g.autoCompleteAssignee.addEventListener("change",(function(){g.enableAddButton()})),g.autoCompleteCoowner.addEventListener("change",(function(){g.enableAddButton()})),g.autoCompleteContributor.addEventListener("change",(function(){g.enableAddButton()})),g.autoCompleteInformedUser.addEventListener("change",(function(){g.enableAddButton()})),g.enableAddButton=function(){var e=g.autoCompleteAssignee.selectedItems?g.autoCompleteAssignee.selectedItems.length:0,t=g.autoCompleteCoowner.selectedItems?g.autoCompleteCoowner.selectedItems.length:0,s=g.autoCompleteContributor.selectedItems?g.autoCompleteContributor.selectedItems.length:0,n=g.autoCompleteInformedUser.selectedItems?g.autoCompleteInformedUser.selectedItems.length:0;g.addButton.disabled=!(e>0||t>0||s>0||n>0)},g.addButton.addEventListener("buttonclick",(function(e){t.target.hide(),document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add").removeClassName("member-toolbar-active");var s=document.querySelector(".iss-member-grid-div"),n=document.querySelector(".membertileView");s.removeClassName("teamview-opaque"),n.removeClassName("teamview-opaque");var a=[],i=[],o=[],r=[];if(null!=g.autoCompleteCoowner.selectedItems)for(var l=0;l<g.autoCompleteCoowner.selectedItems.length;l++){let e=g.autoCompleteCoowner.selectedItems[l].options;a.push(e)}if(null!=g.autoCompleteAssignee.selectedItems)for(l=0;l<g.autoCompleteAssignee.selectedItems.length;l++){let e=g.autoCompleteAssignee.selectedItems[l].options;i.push(e)}if(null!=g.autoCompleteContributor.selectedItems)for(l=0;l<g.autoCompleteContributor.selectedItems.length;l++){let e=g.autoCompleteContributor.selectedItems[l].options;o.push(e)}if(null!=g.autoCompleteInformedUser.selectedItems)for(l=0;l<g.autoCompleteInformedUser.selectedItems.length;l++){let e=g.autoCompleteInformedUser.selectedItems[l].options;r.push(e)}(a.length>0||i.length>0||o.length>0||r.length>0)&&(g.autoCompleteCoowner.selectedItems=g.autoCompleteAssignee.selectedItems=g.autoCompleteContributor.selectedItems=g.autoCompleteInformedUser.selectedItems=void 0,g.addMembers(a,i,o,r))})),g.cancelButton.addEventListener("buttonclick",(function(e){t.target.hide(),document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add").removeClassName("member-toolbar-active");var s=document.querySelector(".iss-member-grid-div"),n=document.querySelector(".membertileView");s.removeClassName("teamview-opaque"),n.removeClassName("teamview-opaque")}))},launchAddMemberPanel:function(){var e=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add"),t=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-filter"),s=document.querySelector(".addmemberView"),n=document.querySelector(".memberfilterView"),a=document.querySelector(".iss-member-grid-div"),i=document.querySelector(".membertileView");n.hide(),t.removeClassName("member-toolbar-active"),a.removeClassName("teamview-opaque"),i.removeClassName("teamview-opaque"),"block"==s.style.display?(s.hide(),e.removeClassName("member-toolbar-active")):(s.show(),e.addClassName("member-toolbar-active"),a.addClassName("teamview-opaque"),i.addClassName("teamview-opaque"))},addMembers:function(e,t,s,n,i,l,c){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(d){var u=document.getElementById("iss-outer-member-grid-div");p.mask(u);for(var h=d.issues,v=[],b=0;b<h.length;b++){var C=h[b],I={physicalId:C.id},y=!1;if(e=e.filter((function(e){return e.identifier===C.owner.user&&(y=!0),e.identifier!==C.owner.user})),y&&m.displayNotification({msg:f.replace(f.team.error.isOwner,{name:C.owner.fullName}),eventID:"info"}),e.length>0){I.coOwners=e.map((function(e){return{user:e.identifier,type:e.type}}));try{var E=r.get("component").getCurrentView();o.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:E,pd3:"MembersToolbar",pd4:"AddCoordinators",pd5:"Issue/"+E+"/MembersToolbar/AddCoordinators"}})}catch(e){}}if(t.length>0){I.assignees=t.map((function(e){return{user:e.identifier,type:e.type}}));try{E=r.get("component").getCurrentView();o.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:E,pd3:"MembersToolbar",pd4:"AddAssignees",pd5:"Issue/"+E+"/MembersToolbar/AddAssignees"}})}catch(e){}}if(s.length>0){I.contributors=s.map((function(e){return{user:e.identifier,type:e.type}}));try{E=r.get("component").getCurrentView();o.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:E,pd3:"MembersToolbar",pd4:"AddContributors",pd5:"Issue/"+E+"/MembersToolbar/AddContributors"}})}catch(e){}}if(n.length>0){I.informedUsers=n.map((function(e){return{user:e.identifier,type:e.type}}));try{E=r.get("component").getCurrentView();o.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:E,pd3:"MembersToolbar",pd4:"AddInformedUsers",pd5:"Issue/"+E+"/MembersToolbar/AddInformedUsers"}})}catch(e){}}v.push(I)}try{o.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersToolbar"}})}catch(e){}a.people.update({data:{objects:v}}).then((function(){for(var a=[],o=d.membersDataGridModel.coowners.getChildren()?d.membersDataGridModel.coowners.getChildren():[],r=[],m=0;m<e.length;m++){var f=(y=e[m]).identifier;y.fullName=y.name,y.user=y.identifier,y.roles=[],y.roles.push("Co-owner");for(var h=!1,v=0;v<o.length;v++)if(f==o[v].options.grid.user){h=!0;break}if(1==h);else d.membersDataGridModel.treeDocument.getAllDescendants().forEach((function(e){e.options.grid.user===y.user&&(e.options.grid.roles.includes("Co-owner")||e.options.grid.roles.push("Co-owner"),y.roles=e.options.grid.roles)})),a.push(y.user),r.push(y)}r.length>0&&d.addNodesInLayout(r,"coowners");var b=d.membersDataGridModel.assignees.getChildren()?d.membersDataGridModel.assignees.getChildren():[];r=[];for(m=0;m<t.length;m++){f=(y=t[m]).identifier;y.user=y.identifier,y.fullName=y.name,y.roles=[],y.roles.push("Assignee");for(h=!1,v=0;v<b.length;v++)if(f==b[v].options.grid.user){h=!0;break}if(1==h);else d.membersDataGridModel.treeDocument.getAllDescendants().forEach((function(e){e.options.grid.user===y.user&&(e.options.grid.roles.includes("Assignee")||e.options.grid.roles.push("Assignee"),y.roles=e.options.grid.roles)})),r.push(y)}r.length>0&&d.addNodesInLayout(r,"assignees");var C=d.membersDataGridModel.contributors.getChildren()?d.membersDataGridModel.contributors.getChildren():[];r=[];for(m=0;m<s.length;m++){f=(y=s[m]).identifier;y.user=y.identifier,y.fullName=y.name,y.roles=[],y.roles.push("Contributor");for(h=!1,v=0;v<C.length;v++)if(f==C[v].options.grid.user){h=!0;break}if(1==h);else d.membersDataGridModel.treeDocument.getAllDescendants().forEach((function(e){e.options.grid.user===y.user&&(e.options.grid.roles.includes("Contributor")||e.options.grid.roles.push("Contributor"),y.roles=e.options.grid.roles)})),r.push(y)}r.length>0&&d.addNodesInLayout(r,"contributors");var I=d.membersDataGridModel.informedUsers.getChildren()?d.membersDataGridModel.informedUsers.getChildren():[];r=[];for(m=0;m<n.length;m++){var y;f=(y=n[m]).identifier;y.user=y.identifier,y.fullName=y.name,y.roles=[],y.roles.push("InformedUser");for(h=!1,v=0;v<I.length;v++)if(f==I[v].options.grid.user){h=!0;break}if(1==h);else d.membersDataGridModel.treeDocument.getAllDescendants().forEach((function(e){e.options.grid.user===y.user&&(e.options.grid.roles.includes("InformedUser")||e.options.grid.roles.push("InformedUser"),y.roles=e.options.grid.roles)})),r.push(y)}if(r.length>0&&d.addNodesInLayout(r,"informedUsers"),c&&c.updateOptions({grid:{common:!0}}),!0===i){var E=[];"coOwners"==l?E=d.membersDataGridModel.coowners.getChildren()?d.membersDataGridModel.coowners.getChildren():[]:"assignees"==l?E=d.membersDataGridModel.assignees.getChildren()?d.membersDataGridModel.assignees.getChildren():[]:"contributors"==l?E=d.membersDataGridModel.contributors.getChildren()?d.membersDataGridModel.contributors.getChildren():[]:"informedUsers"==l&&(E=d.membersDataGridModel.informedUsers.getChildren()?d.membersDataGridModel.informedUsers.getChildren():[]),E.forEach((function(e){e.updateOptions({grid:{common:!0}})}))}g.modelForCoowner.empty(),g.modelForAssignee.empty(),g.modelForContributor.empty(),g.modelForInformedUser.empty(),d.view.dispatchEvent("onUpdate",{issues:d.issues}),p.unmask(u)})).catch((function(e){if(p.unmask(u),g.modelForCoowner.empty(),g.modelForAssignee.empty(),g.modelForContributor.empty(),g.modelForInformedUser.empty(),e.error.message.includes("'business object' does not exist")){var t=o.getErrorMessage("0");o.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("You do not have the permissions to perform this action")){t=o.getErrorMessage("1");o.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No toconnect access to business object")){t=o.getErrorMessage("10");o.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")){t=o.getErrorMessage("2005");o.displayErrorMessage(t,"error")}else m.displayNotification({msg:e.error.message,eventID:"error"})}))}))},assignToSelf:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){var t=i.getUserName(),s=i.getFullName(),n=g.modelForAssignee.getAllDescendants(),a=(d=e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[]).filter((e=>e.options.grid.user===t)),o=g.autoCompleteAssignee.selectedItems,r=n.filter((e=>e.options.identifier===t)),l=g.autoCompleteAssignee.selectedItems,c=[];if(l&&l.length>0&&(c=l.filter((e=>e.options.identifier===t))),a.length>0)m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"});else if(0==r.length&&0==a.length&&0==c.length){if(document.querySelector(".addmemberView").isHidden()){var d;(d=[]).push({identifier:t,name:s,type:"person"}),g.addMembers([],d,[],[])}else{o=g.autoCompleteAssignee.selectedItems;g.modelForAssignee.prepareUpdate();var p=s+" ("+t.toUpperCase()+")",h=new u({label:p,value:t,name:s,identifier:t,type:"person"});g.modelForAssignee.addRoot(h),o?(o=o.concat(h),g.autoCompleteAssignee.selectedItems=o):(o=[h],g.autoCompleteAssignee.selectedItems=o),g.modelForAssignee.pushUpdate()}}else 1==r.length&&(o=o.concat(r[0]),g.autoCompleteAssignee.selectedItems=o)}));try{var e=r.get("component").getCurrentView();o.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"MembersToolbar",pd4:"AssignToSelf",pd5:"Issue/"+e+"/MembersToolbar/AssignToSelf"}}),o.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersToolbar"}})}catch(e){}},ExecuteDropForCoownerField:function(e){var t={data:{}};t.data.items=e,g.ExecuteDropForAddMemberPanel(t,"Coowner")},ExecuteDropForContributorField:function(e){var t={data:{items:[]}};t.data.items=e,g.ExecuteDropForAddMemberPanel(t,"Contributor")},ExecuteDropForAssigneeField:function(e){var t={data:{}};t.data.items=e,g.ExecuteDropForAddMemberPanel(t,"Assignee")},ExecuteDropForInformedUserField:function(e){var t={data:{}};t.data.items=e,g.ExecuteDropForAddMemberPanel(t,"InformedUser")},ExecuteDropForAddMemberPanel:function(e,t){if(e&&e.data&&e.data.items){var s=e.data.items;if(UWA.is(s)&&UWA.is(s.length)&&s.length>0){for(var n=[],i=[],o=[],r=[],l=[],c=0;c<s.length;c++)if(s[c].objectId){var d=s[c].serviceId.toLowerCase();d.includes("3dspace")?n.push(s[c].objectId):d.includes("3dswym")&&"pno:Person"==s[c].objectType?(i.push(s[c].objectId.replace("iam:","")),o.push(s[c].displayName),r.push(s[c])):d.includes("usersgroup")&&l.push(s[c])}n.length>0&&a.getAdditionalObjectInfo({pidArray:n}).then((function(e){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(s){for(var a=0;a<n.length;a++){var i=e.additionObjectInfo[n[a]];if("Coowner"===t){var o=g.modelForCoowner.getAllDescendants(),r=s.membersDataGridModel.coowners.getChildren()?s.membersDataGridModel.coowners.getChildren():[],l=s.membersDataGridModel.owner.getChildren()?s.membersDataGridModel.owner.getChildren():[],c=g.autoCompleteCoowner.selectedItems,d=o.filter((e=>"person"===i.type.toLowerCase()?e.options.identifier===i.objectTitle:e.options.identifier===i.pid)),p=[];(w=g.autoCompleteCoowner.selectedItems)&&w.length>0&&(p=w.filter((e=>"person"===i.type.toLowerCase()?e.options.identifier===i.objectTitle:e.options.identifier===i.pid)));var h=r.filter((e=>"person"===i.type.toLowerCase()?e.options.grid.user===i.objectTitle:e.options.grid.user===i.pid)),v=l.filter((e=>e.options.grid.user===i.objectTitle));if(0==d.length&&0==h.length&&0==p.length&&0==v.length){if("person"===i.type.toLowerCase()){g.modelForCoowner.prepareUpdate();var b=i.fullName+" ("+i.objectTitle.toUpperCase()+")",C=new u({label:b,value:i.objectTitle,name:i.fullName,identifier:i.objectTitle,type:i.type.toLowerCase()});g.modelForCoowner.addRoot(C),d.push(C),c?(c=c.concat(C),g.autoCompleteCoowner.selectedItems=c):(c=[C],g.autoCompleteCoowner.selectedItems=c),g.modelForCoowner.pushUpdate()}else if("group"===i.type.toLowerCase()){g.modelForCoowner.prepareUpdate();C=new u({label:i.objectTitle,value:i.objectTitle,name:i.objectTitle,identifier:i.pid,type:i.type.toLowerCase()});g.modelForCoowner.addRoot(C),d.push(C),c?(c=c.concat(C),g.autoCompleteCoowner.selectedItems=c):(c=[C],g.autoCompleteCoowner.selectedItems=c),g.modelForCoowner.pushUpdate()}}else 1==d.length&&(c=c.concat(d[0]),g.autoCompleteCoowner.selectedItems=c);h.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):v.length>0?m.displayNotification({msg:f.replace(f.team.error.isOwner,{name:i.objectName}),eventID:"info"}):0==d.length&&0==p.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Contributor"===t){o=g.modelForContributor.getAllDescendants();var I=s.membersDataGridModel.contributors.getChildren()?s.membersDataGridModel.contributors.getChildren():[];c=g.autoCompleteContributor.selectedItems,d=o.filter((e=>"person"===i.type.toLowerCase()?e.options.identifier===i.objectTitle:e.options.identifier===i.pid)),p=[];(w=g.autoCompleteContributor.selectedItems)&&w.length>0&&(p=w.filter((e=>"person"===i.type.toLowerCase()?e.options.identifier===i.objectTitle:e.options.identifier===i.pid)));h=I.filter((e=>"person"===i.type.toLowerCase()?e.options.grid.user===i.objectTitle:e.options.grid.user===i.pid));if(0==d.length&&0==h.length&&0==p.length){if("person"===i.type.toLowerCase()){g.modelForContributor.prepareUpdate();b=i.fullName+" ("+i.objectTitle.toUpperCase()+")";var y=new u({label:b,value:i.objectTitle,name:i.fullName,identifier:i.objectTitle,type:i.type.toLowerCase()});g.modelForContributor.addRoot(y),d.push(y),c?(c=c.concat(y),g.autoCompleteContributor.selectedItems=c):(c=[y],g.autoCompleteContributor.selectedItems=c),g.modelForContributor.pushUpdate()}else if("group"===i.type.toLowerCase()){g.modelForContributor.prepareUpdate();y=new u({label:i.objectTitle,value:i.objectTitle,name:i.objectTitle,identifier:i.pid,type:i.type.toLowerCase()});g.modelForContributor.addRoot(y),d.push(y),c?(c=c.concat(y),g.autoCompleteContributor.selectedItems=c):(c=[y],g.autoCompleteContributor.selectedItems=c),g.modelForContributor.pushUpdate()}}else 1==d.length&&(c=c.concat(d[0]),g.autoCompleteContributor.selectedItems=c);h.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==d.length&&0==p.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Assignee"===t){o=g.modelForAssignee.getAllDescendants();var E=s.membersDataGridModel.assignees.getChildren()?s.membersDataGridModel.assignees.getChildren():[];c=g.autoCompleteAssignee.selectedItems,d=o.filter((e=>"person"===i.type.toLowerCase()?e.options.identifier===i.objectTitle:e.options.identifier===i.pid)),p=[];(w=g.autoCompleteAssignee.selectedItems)&&w.length>0&&(p=w.filter((e=>"person"===i.type.toLowerCase()?e.options.identifier===i.objectTitle:e.options.identifier===i.pid)));h=E.filter((e=>"person"===i.type.toLowerCase()?e.options.grid.user===i.objectTitle:e.options.grid.user===i.pid));if(0==d.length&&0==h.length&&0==p.length){if("person"===i.type.toLowerCase()){g.modelForAssignee.prepareUpdate();b=i.fullName+" ("+i.objectTitle.toUpperCase()+")";var S=new u({label:b,value:i.objectTitle,name:i.fullName,identifier:i.objectTitle,type:i.type.toLowerCase()});g.modelForAssignee.addRoot(S),d.push(S),c?(c=c.concat(S),g.autoCompleteAssignee.selectedItems=c):(c=[S],g.autoCompleteAssignee.selectedItems=c),g.modelForAssignee.pushUpdate()}else if("group"===i.type.toLowerCase()){g.modelForAssignee.prepareUpdate();S=new u({label:i.objectTitle,value:i.objectTitle,name:i.objectTitle,identifier:i.pid,type:i.type.toLowerCase()});g.modelForAssignee.addRoot(S),d.push(S),c?(c=c.concat(S),g.autoCompleteAssignee.selectedItems=c):(c=[S],g.autoCompleteAssignee.selectedItems=c),g.modelForAssignee.pushUpdate()}}else 1==d.length&&(c=c.concat(d[0]),g.autoCompleteAssignee.selectedItems=c);h.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==d.length&&0==p.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("InformedUser"===t){o=g.modelForInformedUser.getAllDescendants();var w,T=s.membersDataGridModel.informedUsers.getChildren()?s.membersDataGridModel.informedUsers.getChildren():[];c=g.autoCompleteInformedUser.selectedItems,d=o.filter((e=>"person"===i.type.toLowerCase()?e.options.identifier===i.objectTitle:e.options.identifier===i.pid)),p=[];(w=g.autoCompleteInformedUser.selectedItems)&&w.length>0&&(p=w.filter((e=>"person"===i.type.toLowerCase()?e.options.identifier===i.objectTitle:e.options.identifier===i.pid)));h=T.filter((e=>"person"===i.type.toLowerCase()?e.options.grid.user===i.objectTitle:e.options.grid.user===i.pid));if(0==d.length&&0==h.length&&0==p.length){if("person"===i.type.toLowerCase()){g.modelForInformedUser.prepareUpdate();b=i.fullName+" ("+i.objectTitle.toUpperCase()+")";var D=new u({label:b,value:i.objectTitle,name:i.fullName,identifier:i.objectTitle,type:i.type.toLowerCase()});g.modelForInformedUser.addRoot(D),d.push(D),c?(c=c.concat(D),g.autoCompleteInformedUser.selectedItems=c):(c=[D],g.autoCompleteInformedUser.selectedItems=c),g.modelForInformedUser.pushUpdate()}else if("group"===i.type.toLowerCase()){g.modelForInformedUser.prepareUpdate();D=new u({label:i.objectTitle,value:i.objectTitle,name:i.objectTitle,identifier:i.pid,type:i.type.toLowerCase()});g.modelForInformedUser.addRoot(D),d.push(D),c?(c=c.concat(D),g.autoCompleteInformedUser.selectedItems=c):(c=[D],g.autoCompleteInformedUser.selectedItems=c),g.modelForInformedUser.pushUpdate()}}else 1==d.length&&(c=c.concat(d[0]),g.autoCompleteInformedUser.selectedItems=c);h.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==d.length&&0==p.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}}}))}),(function(e){return Promise.reject(e)})),i.length>0&&require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){for(var s=0;s<i.length;s++){var n=i[s],a=r[s];if("Coowner"===t){var o=g.modelForCoowner.getAllDescendants(),l=e.membersDataGridModel.coowners.getChildren()?e.membersDataGridModel.coowners.getChildren():[],c=e.membersDataGridModel.owner.getChildren()?e.membersDataGridModel.owner.getChildren():[],d=g.autoCompleteCoowner.selectedItems,p=o.filter((e=>e.options.identifier===n)),h=[];(T=g.autoCompleteCoowner.selectedItems)&&T.length>0&&(h=T.filter((e=>e.options.identifier===n)));var v=l.filter((e=>e.options.grid.user===n)),b=c.filter((e=>e.options.grid.user===n));if(0==p.length&&0==v.length&&0==h.length&&0==b.length){if("pno:person"===a.objectType.toLowerCase()){g.modelForCoowner.prepareUpdate();var C=a.displayName+" ("+i[s].toUpperCase()+")",I=new u({label:C,value:i[s],name:a.displayName,identifier:i[s],type:"person"});g.modelForCoowner.addRoot(I),p.push(I),d?(d=d.concat(I),g.autoCompleteCoowner.selectedItems=d):(d=[I],g.autoCompleteCoowner.selectedItems=d),g.modelForCoowner.pushUpdate()}}else 1==p.length&&(d=d.concat(p[0]),g.autoCompleteCoowner.selectedItems=d);v.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):b.length>0?m.displayNotification({msg:f.replace(f.team.error.isOwner,{name:n}),eventID:"info"}):0==p.length&&0==h.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Contributor"===t){o=g.modelForContributor.getAllDescendants();var y=e.membersDataGridModel.contributors.getChildren()?e.membersDataGridModel.contributors.getChildren():[];d=g.autoCompleteContributor.selectedItems,p=o.filter((e=>e.options.identifier===n)),h=[];(T=g.autoCompleteContributor.selectedItems)&&T.length>0&&(h=T.filter((e=>e.options.identifier===n)));v=y.filter((e=>e.options.grid.user===n));if(0==p.length&&0==v.length&&0==h.length){if("pno:person"===a.objectType.toLowerCase()){g.modelForContributor.prepareUpdate();C=a.displayName+" ("+i[s].toUpperCase()+")";var E=new u({label:C,value:i[s],name:a.displayName,identifier:i[s],type:"person"});g.modelForContributor.addRoot(E),p.push(E),d?(d=d.concat(E),g.autoCompleteContributor.selectedItems=d):(d=[E],g.autoCompleteContributor.selectedItems=d),g.modelForContributor.pushUpdate()}}else 1==p.length&&(d=d.concat(p[0]),g.autoCompleteContributor.selectedItems=d);v.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==p.length&&0==h.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Assignee"===t){o=g.modelForAssignee.getAllDescendants();var S=e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[];d=g.autoCompleteAssignee.selectedItems,p=o.filter((e=>e.options.identifier===n)),h=[];(T=g.autoCompleteAssignee.selectedItems)&&T.length>0&&(h=T.filter((e=>e.options.identifier===n)));v=S.filter((e=>e.options.grid.user===n));if(0==p.length&&0==v.length&&0==h.length){if("pno:person"===a.objectType.toLowerCase()){g.modelForAssignee.prepareUpdate();C=a.displayName+" ("+i[s].toUpperCase()+")";var w=new u({label:C,value:i[s],name:a.displayName,identifier:i[s],type:"person"});g.modelForAssignee.addRoot(w),p.push(w),d?(d=d.concat(w),g.autoCompleteAssignee.selectedItems=d):(d=[w],g.autoCompleteAssignee.selectedItems=d),g.modelForAssignee.pushUpdate()}}else 1==p.length&&(d=d.concat(p[0]),g.autoCompleteAssignee.selectedItems=d);v.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==p.length&&0==h.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("InformedUser"===t){o=g.modelForInformedUser.getAllDescendants();var T,D=e.membersDataGridModel.informedUsers.getChildren()?e.membersDataGridModel.informedUsers.getChildren():[];d=g.autoCompleteInformedUser.selectedItems,p=o.filter((e=>e.options.identifier===n)),h=[];(T=g.autoCompleteInformedUser.selectedItems)&&T.length>0&&(h=T.filter((e=>e.options.identifier===n)));v=D.filter((e=>e.options.grid.user===n));if(0==p.length&&0==v.length&&0==h.length){if("pno:person"===a.objectType.toLowerCase()){g.modelForInformedUser.prepareUpdate();C=a.displayName+" ("+i[s].toUpperCase()+")";var A=new u({label:C,value:i[s],name:a.displayName,identifier:i[s],type:"person"});g.modelForInformedUser.addRoot(A),p.push(A),d?(d=d.concat(A),g.autoCompleteInformedUser.selectedItems=d):(d=[A],g.autoCompleteInformedUser.selectedItems=d),g.modelForInformedUser.pushUpdate()}}else 1==p.length&&(d=d.concat(p[0]),g.autoCompleteInformedUser.selectedItems=d);v.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==p.length&&0==h.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}}})),l.length>0&&require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){for(var s=0;s<l.length;s++){var n=l[s],a=l[s].objectId;if("Coowner"===t){var i=g.modelForCoowner.getAllDescendants(),o=e.membersDataGridModel.coowners.getChildren()?e.membersDataGridModel.coowners.getChildren():[],r=g.autoCompleteCoowner.selectedItems,c=i.filter((e=>e.options.identifier===a)),d=[];(y=g.autoCompleteCoowner.selectedItems)&&y.length>0&&(d=y.filter((e=>e.options.identifier===a)));var p=o.filter((e=>e.options.grid.user===a));if(0==c.length&&0==p.length&&0==d.length){g.modelForCoowner.prepareUpdate();var h=new u({label:n.displayName,value:n.displayName,name:n.displayName,identifier:a,type:"group"});g.modelForCoowner.addRoot(h),c.push(h),r?(r=r.concat(h),g.autoCompleteCoowner.selectedItems=r):(r=[h],g.autoCompleteCoowner.selectedItems=r),g.modelForCoowner.pushUpdate()}else 1==c.length&&(r=r.concat(c[0]),g.autoCompleteCoowner.selectedItems=r);p.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==c.length&&0==d.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Contributor"===t){i=g.modelForContributor.getAllDescendants();var v=e.membersDataGridModel.contributors.getChildren()?e.membersDataGridModel.informedUsers.getChildren():[];r=g.autoCompleteContributor.selectedItems,c=i.filter((e=>e.options.identifier===a)),d=[];(y=g.autoCompleteContributor.selectedItems)&&y.length>0&&(d=y.filter((e=>e.options.identifier===a)));p=v.filter((e=>e.options.grid.user===a));if(0==c.length&&0==p.length&&0==d.length){g.modelForContributor.prepareUpdate();var b=new u({label:n.displayName,value:n.displayName,name:n.displayName,identifier:a,type:"group"});g.modelForContributor.addRoot(b),c.push(b),r?(r=r.concat(b),g.autoCompleteContributor.selectedItems=r):(r=[b],g.autoCompleteContributor.selectedItems=r),g.modelForContributor.pushUpdate()}else 1==c.length&&(r=r.concat(c[0]),g.autoCompleteContributor.selectedItems=r);p.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==c.length&&0==d.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Assignee"===t){i=g.modelForAssignee.getAllDescendants();var C=e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[];r=g.autoCompleteAssignee.selectedItems,c=i.filter((e=>e.options.identifier===a)),d=[];(y=g.autoCompleteAssignee.selectedItems)&&y.length>0&&(d=y.filter((e=>e.options.identifier===a)));p=C.filter((e=>e.options.grid.user===a));if(0==c.length&&0==p.length&&0==d.length){g.modelForAssignee.prepareUpdate();var I=new u({label:n.displayName,value:n.displayName,name:n.displayName,identifier:a,type:"group"});g.modelForAssignee.addRoot(I),c.push(I),r?(r=r.concat(I),g.autoCompleteAssignee.selectedItems=r):(r=[I],g.autoCompleteAssignee.selectedItems=r),g.modelForAssignee.pushUpdate()}else 1==c.length&&(r=r.concat(c[0]),g.autoCompleteAssignee.selectedItems=r);p.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==c.length&&0==d.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("InformedUser"===t){i=g.modelForInformedUser.getAllDescendants();var y,E=e.membersDataGridModel.informedUsers.getChildren()?e.membersDataGridModel.informedUsers.getChildren():[];r=g.autoCompleteInformedUser.selectedItems,c=i.filter((e=>e.options.identifier===a)),d=[];(y=g.autoCompleteInformedUser.selectedItems)&&y.length>0&&(d=y.filter((e=>e.options.identifier===a)));p=E.filter((e=>e.options.grid.user===a));if(0==c.length&&0==p.length&&0==d.length){g.modelForInformedUser.prepareUpdate();var S=new u({label:n.displayName,value:n.displayName,name:n.displayName,identifier:a,type:"group"});g.modelForInformedUser.addRoot(S),c.push(S),r?(r=r.concat(S),g.autoCompleteInformedUser.selectedItems=r):(r=[S],g.autoCompleteInformedUser.selectedItems=r),g.modelForInformedUser.pushUpdate()}else 1==c.length&&(r=r.concat(c[0]),g.autoCompleteInformedUser.selectedItems=r);p.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==c.length&&0==d.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}}})),0==n.length&&0==i.length&&0==l.length&&m.displayNotification({msg:f.team.error.dropNotSupported,eventID:"error"})}}}};return g})),define("DS/IssueComponents/create/CustomNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/SpinBox","DS/Controls/Toggle","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueServices/services/IssueServices","DS/IssueServices/Contexts","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g){"use strict";var h={READ_ONLY:"ReadOnly",NONE:"None"},v={MEMO:"textarea",DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},b="TRUE",C="TemplateCustomAttrMandEnablement";return t.extend({name:"DS/IssueComponents/create/Custom",tag:"div",className:"create-view-content-subview create-custom",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e((function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t})),s.formElements={},s.formElementsToggler={},s.fields={},s.requiredLabels={},s.noShow=!0;let n={};var a=[];s._customProperties=[],new e((function(t,i){a.push(p.custom.getCustomAttributes(n)),a.push(p.type.getProperties("Issue")),e.all(a).then((e=>{var n={};e.length>1&&void 0!==e[1]&&(Array.isArray(e[1].classPredicates)&&e[1].classPredicates.length>0&&e[1].classPredicates[0].vocabularyPredicateInfo.forEach((e=>{e.userAccess&&(n[e.name]=e.nlsName)})));if(e.length&&Array.isArray(e[0].body)&&e[0].body.length){const t=new Map(e[0].body.map((e=>[e.name,e])));f.add("ISU_DeploymentAttributes",t),e[0].body.forEach((e=>{n[e.name]&&(e.title=n[e.name])})),s._customProperties=e[0].body,s.noShow=!1}t()}))})).then(s._deferredInit.resolve).catch(s._deferredInit.reject)},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach((function(t){e.fields[t]=null,e.parent.formElements[t]=null,e.parent.formElementsToggler[t]=null}))},render:function(){var e=this;e.form=new n({className:"create-properties-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container),e.form.getContent().setAttribute("novalidate",!1);var t=s.createElement("div",{class:"create-form-content"});e.isCustoAttrMandTemplate=f.get(C);var a=[],i=[];return e._customProperties.forEach((function(t,s){var n=[];if(""!==t.range){var o=t.NLSRange.split("%@separator%");t.range.split(",").forEach((function(e,t){n.push({labelItem:o[t],valueItem:e})}))}t.type==v.DATE&&""==t.defaults&&(t.defaults=void 0);var r={};if(r.index=s,r.element=t.name,r.value=t.defaults,r.required="Yes"===t.mandatory&&(!e.parent.parent.isTemplate||!!e.isCustoAttrMandTemplate),r.placeholder=e.getPlaceholder(t),r.help=e.getHelper(t),r.type=t.type,r.label=e.getLabel(t),r.rangeItems=n,r.UIAccess=t.UIAccess,r.requiredText=g.create.required,r.selectedIndex=-1,r.MultiValuated=t.valuetype,r.multiline=t.multiline,r.type!==v.INT&&r.type!==v.REAL||r.rangeItems.sort((function(e,t){return e.valueItem-t.valueItem})),r.rangeItems.length>0&&r.rangeItems.forEach((function(e,t){r.value===e&&(r.selectedIndex=t)})),h.NONE!=t.UIAccess&&h.READ_ONLY!=t.UIAccess){var l=e.createFormElement(r);r.required?a.push(l):i.push(l)}})),a.forEach((function(e){e.inject(t)})),i.forEach((function(e){e.inject(t)})),t.inject(e.form.elements.container),e},createFormElement:function(e){var t=this,n="create-form-element create-properties-form-element-"+e.element,a=t.parent.formElements[e.element]=s.createElement("div",{class:n});t.parent.parent.isTemplate&&!e.required&&t.createVisibilityMask(e).inject(a);return t.createFormGroup(e).inject(a),a},createFormGroup:function(e){var t=this,n=s.createElement("div",{class:"create-form-field form-group"});return(e.required?t.createRequiredLabel(e):t.createLabel(e)).inject(n),t.createFormField(e).inject(n),n},createVisibilityMask:function(e){return s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.parent.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]})},createRequiredLabel:function(e){var t=this,n=(e.element,"required-form-field-title-label"+(t.parent.parent.isTemplate&&!t.isCustoAttrMandTemplate?"":" highlight")),a="required-form-field-required-label"+(t.parent.parent.isTemplate&&!t.isCustoAttrMandTemplate?"":" highlight");return t.requiredLabels[e.element]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:n,html:e.label}),s.createElement("div",{class:a+" wux-ui-3ds-required wux-ui-3ds"})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=this,n=s.createElement("div",{name:e.name,id:e.id}),a=null;if(e.rangeItems.length>0&&e.type!==v.BOOL)a=t.createComboBox(e);else switch(e.type){case v.TEXT:case v.MEMO:if(s.is(e.MultiValuated)&&"multival"==e.MultiValuated)(a=t.createComboBox(e)).allowFreeInputFlag=!0;else(a=t.createTextField(e)).getContent().querySelectorAll("input, div").forEach((function(e){e.style.width="100%",e.style.fontSize="medium"}));break;case v.DATE:(a=t.createDateField(e)).getContent().querySelectorAll("input").forEach((function(e){e.style.fontSize="medium"}));break;case v.BOOL:a=t.createBooleanField(e);break;case v.INT:case v.REAL:if(s.is(e.MultiValuated)&&"multival"==e.MultiValuated){var i="";e.type===v.INT?i="[0-9]+":e.type===v.REAL&&(i="[0-9]+|([0-9]+.[0-9]+)"),(a=t.createComboBox(e)).allowFreeInputFlag=!0,a._editor.pattern=i}else a=t.createNumberField(e),t.fields[e.element].getContent().style.height="auto",a.getContent().style.width="100%",a.getContent().querySelectorAll("input").forEach((function(e){e.style.fontSize="medium"}))}return a.getContent().addEventListener("change",(function(){switch(e.type){case v.TEXT:case v.MEMO:t._customProperties[e.index].value=t.fields[e.element].value;break;case v.DATE:var s=t.fields[e.element].value;t._customProperties[e.index].value=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear();break;case v.BOOL:t._customProperties[e.index].value=t.fields[e.element].checkFlag?"true":"false";break;case v.INT:case v.REAL:var n=t.fields[e.element].value,a=t._customProperties[e.index].valuetype;t._customProperties[e.index].value=null!=n&&""!==n&&"singleval"==a?n.toString():n}})),a.inject(n),n},createTextField:function(e){var t=null;"false"===e.multiline?(t=this.fields[e.element]=new i({value:e.value,requiredFlag:e.required,placeholder:e.placeholder})).getContent().setStyle("width","100%"):((t=this.fields[e.element]=new o({value:e.value,nbRows:4,requiredFlag:e.required,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t.getContent().querySelectorAll("textarea").forEach((function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="vertical",e.style.overflow="auto"})));return t},createDateField:function(e){return this.fields[e.element]=new a({value:e.value,minValue:e.minValue,maxValue:e.maxValue})},createNumberField:function(e){var t="integer"===e.type?parseInt(e.value):parseFloat(e.value);return this.fields[e.element]=new l({value:t,stepValue:"integer"===e.type?1:.1,maxValue:"integer"===e.type?2147483646:999999999999999,requiredFlag:e.required})},createComboBox:function(e){var t=e.rangeItems,n=function(){var e=new u;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,a=t[s].valueItem,i=new m({label:n,value:a});e.addRoot(i)}return e.pushUpdate(),e}(),a=!1;s.is(e.MultiValuated)&&"multival"==e.MultiValuated&&(a=!0);var i=[];t.length>0&&t.forEach((function(t,s){e.value===t.valueItem&&i.push(n.getRoots()[s])}));var o=e.required,r=(e.placeholder,this.fields[e.element]=new d({elementsTree:n,multiSearchMode:a,selectedItems:i,allowFreeInputFlag:!1}));return(1==a||t.length>0)&&r.getContent().addEventListener("keydown",(function(e){13==e.keyCode&&e.stopPropagation()})),r.requiredFlag=o,r},createBooleanField:function(e){var t=this.fields[e.element]=new c({type:"switch",checkFlag:e.value===b});return t.getContent().addEventListener("keydown",(function(e){13==e.keyCode&&e.stopPropagation()})),t},show:function(){var e=this;e._parent(),e.fields[e._customProperties[0].name]&&"focus"in e.fields[e._customProperties[0].name]&&e.fields[e._customProperties[0].name].focus()},hide:function(){this._parent()},validate:function(){return this.form.fields=Object.values(this.fields).filter((function(e){return null!==e})),this.form.validate(!1,!1)},getValues:function(){var e={custom:{}};return this._customProperties.forEach((function(t){t.range.length>0?""!=t.value&&(e.custom[t.path]=t.value):e.custom[t.path]=t.value})),e},getHiddenAttributes:function(){var e=this,t={custom:{}};for(var n in e.parent.formElements)s.is(e.parent.formElementsToggler[n])&&(t.custom[n]=e.parent.formElementsToggler[n].hasClassName("fonticon-eye-off"));return t},reset:function(){var e=this;e._customProperties.forEach((function(t){if(t.value=t.defaults,e.fields[t.name])switch(t.type){case v.TEXT:case v.MEMO:e.fields[t.name].value=t.defaults;break;case v.DATE:break;case v.BOOL:e.fields[t.name].checkFlag="true"===t.defaults.toLowerCase();break;case v.INT:case v.REAL:e.fields[t.name].value=""===t.defaults?0:"integer"===t.type?parseInt(t.defaults):parseFloat(t.defaults)}}))},applyTemplate:function(t){var n=this;if(n.reset(),s.is(t.data,"object")&&s.is(t.data.custom,"object")&&n._customProperties.forEach((function(e){if(s.is(t.data.custom[e.path],"string")){if(e.value=t.data.custom[e.path],n.fields[e.name])switch(e.type){case v.TEXT:case v.MEMO:case v.DATE:n.fields[e.name].value=e.value;break;case v.BOOL:n.fields[e.name].checkFlag="true"===e.value.toLowerCase();break;case v.INT:case v.REAL:n.fields[e.name].value=""===e.value?"0":e.value}}else s.is(t.data.custom[e.path],"array")&&(e.value=[],e.value=t.data.custom[e.path],e.type==v.BOOL?(t.data.custom[e.path].length>0?e.value="true"===t.data.custom[e.path][0].toLowerCase():e.value=!1,n.fields[e.name].checkFlag=e.value):e.type==v.DATE&&(n.fields[e.name].value=e.value[0]),n.fields[e.name].value=e.value)})),s.is(t.hidden,"object")&&s.is(t.hidden.custom,"object")&&s.is(n.parent.formElements,"object")&&s.is(n.parent.formElementsToggler,"object")){var a=n.parent.formElements,i=n.parent.formElementsToggler;for(var o in a)!0===t.hidden.custom[o]&&(n.parent.parent.isTemplate?(s.is(a[o])&&a[o].toggleClassName("visibility-masked",!0),s.is(i[o])&&(i[o].toggleClassName("fonticon-eye-off",!0),i[o].toggleClassName("fonticon-eye",!1))):s.is(a[o])&&a[o].hide())}return e.resolve()},getLabel:function(e){var t="",s=g.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getPlaceholder:function(e){var t="",s=g.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getHelper:function(e){var t="",s=g.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.helper)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t}})})),define("DS/IssueComponents/templates/model/TemplatesTreeDocument",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/TreeModel/TreeDocument","DS/TreeModel/BaseFilter","DS/CoreEvents/ModelEvents","DS/IssueComponents/templates/model/TemplatesTreeNodeModel","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueComponents/templates/TemplatesToolbar","DS/IssueServices/services/PlatformServices","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/ModelParser","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h){"use strict";var v=10,b=100,C="RELEASED",I="Issue Template Json Details",y=function(e,t,s){var n;return function(){var a=this,i=arguments,o=s&&!n;clearTimeout(n),n=setTimeout((function(){n=null,s||e.apply(a,i)}),t),o&&e.apply(a,i)}},E=this;return a.extend({name:"DS/IssueComponents/templates/model/TemplatesTreeDocument",_logger:null,component:null,settings:{},_publishSelection:!1,_onNodeModelUpdateSubscriptionToken:"",init:function(t){var n=this;E=n,n._logger=s.getLogger("DS/IssueComponets/Model"),n.component=t.component,t.list=e.merge(t.document||{},n.getEventOptions()),n._parent(),n._publishSelection=!1,n._subscribers(),n.initCustomFilter(),n.registerCustomFilter(),n.user=m.getUserName();var a={name:"templateModelEvents"};n.templateModelEvents=new o(a)},registerNodeModelUpdateEvent:function(){this._onNodeModelUpdateSubscriptionToken=this.onNodeModelUpdate((function(e){var t=e.data.nodeModel;if(t)e.data.attributes,t.options.physicalId}))},undoRegisterNodeModelUpdateEvent:function(){this.unsubscribe(this._onNodeModelUpdateSubscriptionToken)},registerCustomFilter:function(){this.getFilterManager().registerFilter("stringRole",this.stringRoleFilter)},initCustomFilter:function(){E.filteredListOfNodes=[],this.stringRoleFilter=i.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue(this.propertyId);return!(!this.filterModel||!this.filterModel.allowedRoles)&&!t.toLowerCase().includes(this.filterModel.allowedRoles.toLowerCase())},isEmpty:function(){return void 0===this.filterModel.allowedRoles}})},getEventOptions:function(){return{shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1}}},addRoots:function(e,s){var n=this;return 0===e.length?t.resolve([]):new t((function(t){n.withTransactionUpdate((function(){for(var s=[],a=0;a<e.length;a++){var i=new r(e[a]);i.options.data&&(i.options.data.isExpandMultiple=!1),i.options.children=null,i.setState({state:"noChildren"}),s.push(i)}if(s.length>1)for(var o=0;o<s.length;o++)n.addRoot(s[o]);else 1==s.length&&n.addRoot(s[0],0);t(s)}))}),(function(){n._logger.error('An error occurred during "%s"',"addRoots")}))},removeRootsById:function(e){var s=this;return 0===e.length?t.resolve():new t((function(t){s.withTransactionUpdate((function(){e.forEach((function(e){var t=s.searchRootById(e);null!==t&&s.removeRoot(t)}));let n=s.getRoots();if(s.templateModelEvents.publish({event:"template-remove",data:{roots:n}}),0==n.length){var a=l.get("templateComponentDialog")?l.get("templateComponentDialog"):l.get("templateComponent");a.templateList.dataGridContainer.addClassName("tree-list-empty"),a.templateList.treeListPlaceholder.setContent(h.templates.treeList.placeholder),u.idling()}t()}))}))},prepareBroadcastSelect:function(){this._publishSelection=!0},postBroadcastSelect:function(){this._publishSelection=!1},getSelectedTemplateNodes:function(){return this.getSelectedNodes()},buildBroadcastSelectForTemplate:function(){var e=this;d.start(e.name+" buildBroadcastSelect");for(var t=[],s={},n=e.getSelectedTemplateNodes(),a=0;a<n.length;a++){var i=n[a];t.push([i.options.id]),s[i.options.id]={id:i.options.id,type:i.options.type,name:i.options.name,label:i.options.title}}return d.end(e.name+" buildBroadcastSelect"),{paths:t,attributes:s}},pushBroadcastSelect:y((function(){var e=this;d.start(e.name+" pushBroadcastSelect");var t=e.buildBroadcastSelectForTemplate();if(e.getRoots(!1).length>0){var s=l.get("templateStatus");if(s){var n=h.replace(h.selectedTemplatesCount,{number:e.getSelectedTemplateNodes().length});s.selectedDiv.textContent=n}var a=e.getSelectedTemplateNodes();u.select(a);var i=a[a.length-1];null!=i&&(e.utils.isOwnedByCurrentUser(i.options,e.user)&&i.options.state!=C?e.utils.isOwnedByCurrentUser(i.options,e.user)&&1==a&&u.enable(["edit"]):u.disable(["edit"]))}p.publishSelectAll(t),e.component.publishCompass(),e._publishSelection=!1,d.end(e.name+" pushBroadcastSelect")}),100),withBroadcastSelect:function(e){var t=this;t.prepareBroadcastSelect(),e.then((function(){t.pushBroadcastSelect()}),(function(){t.postBroadcastSelect()}))},updateObjectNodeForMaturity:function(t){var s=this,n=s.getSelectedTemplateNodes(),a=[];t.forEach((e=>{null!=e.policy&&(e.maturity=e.policy+"."+e.state,a.push(e.maturity))}));var i={"ds6w:status":a};c.getNLSValuesPromise(i).then((i=>{if(e.is(i["ds6w:status"])){var o=Object.values(i["ds6w:status"])[0],r=a[0];r=r.replace("Issue Template.",""),n.filter((e=>t.some((t=>e.options.id.includes(t.physicalid))))).forEach((e=>{e.updateOptions({state:r,grid:{"ds6w:state":o}})})),s.prepareBroadcastSelect(),s.pushBroadcastSelect(),s.postBroadcastSelect()}}))},autoFill:{_physicalIdsForValidation:{},_physicalIdsForClassification:{},classificationAttributes:function(e,t,s){var n=this;if(n._physicalIdsForClassification[e]){var a=n._physicalIdsForClassification[e];if(!a.attributes.some((e=>e.name===t))){var i={name:t,type:s};a.attributes.push(i)}}else{n._physicalIdsForClassification[e]={},n._physicalIdsForClassification[e].physicalId=[e];i={name:t,type:s};n._physicalIdsForClassification[e].attributes=[i]}n._autoFillClassification(n._physicalIdsForClassification)},_autoFillClassification:y((function(e){c.classification.retrieve({data:{objects:e}}).then((function(t){for(var s=l.get("classAttrNLS"),n={},a=0;a<t.results.length;a++){var i=t.results[a].body,o=i.physicalId;n[o]=[];for(var r=e[o].attributes,c={timePrecision:"min"},d=0;d<r.length;d++){var u=r[d].name,m=r[d].type,f="";i[u]&&(s&&s[u]?.rangeValues?f=p.getMulValueAttr(u,i[u]):(f=i[u].substring(1,i[u].length-1),"timestamp"==m&&(f=p.formatDate(f,c))));var g={};g.attrName=u,g.attrValue=f,n[o].push(g)}}var h=E.getAllDescendants();for(d=0;d<h.length;d++){var v=h[d];if(n[v.options.physicalId]){r=n[v.options.physicalId];for(var b=0;b<r.length;b++){var C=r[b].attrName,I=r[b].attrValue,y={grid:{}};y.grid[C]=I,v.updateOptions(y)}}}}))}),b)},getComponent:function(){return this.component},getRoots:function(t){var s=this,n=s._parent();if(!0===t&&e.is(s._getChildrenFilterInfo,"function")){var a=s._getChildrenFilterInfo();if(a&&e.is(a.childrenBeforeFiltering,"array")){var i=n;n=a.childrenBeforeFiltering.slice(0),i.forEach((function(e){n.indexOf(e)<0&&n.push(e)}))}}return n},getNodesById:function(e){var t=this,s=[];d.start(t.name+" getNodesById");for(var n=t.getRoots(!1),a=0;a<n.length;a++)s=s.concat(n[a].getNodesById(e));return d.end(t.name+" getNodesById"),s},_subscribers:function(){var e=this;e.getXSO().onEmpty((function(){e.component._destroyPopover(),e.templateModelEvents.publish({event:"template-xso-empty"}),e.prepareBroadcastSelect(),setTimeout((function(){0===e.getSelectedTemplateNodes().length&&e.pushBroadcastSelect()}),v),e.postBroadcastSelect()})),e.getXSO().onChange((function(){e.component._destroyPopover(),e.prepareBroadcastSelect(),e.pushBroadcastSelect(),e.templateModelEvents.publish({event:"template-xso-change"}),e.postBroadcastSelect()})),n.subscribe("Lifecycle.Modification",(function(t){var s=JSON.parse(t).Refresh.modified;if(Array.isArray(s)){var n=s.filter((function(e){return"Issue Template"==e.policy})).map((function(e){return e}));n.length>0&&e.updateObjectNodeForMaturity(n)}}))},utils:{isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},isShared:function(t){return!0===e.is(t.info.share,"object")},isOwnedBy:function(e,t){return!0===this.isShared(e)&&e.info.share.owner&&e.info.share.owner.user===t},isOwnedByCurrentUser:function(e,t){return e.owner.user===t},setDroppableData:function(e,t){var s=l.get("widget")||window.widget,n=f.buildDnDPayload({items:[]});null!=t&&(n.data.options=t);for(var a=0;a<e.length;a++){var i=e[a],o=i.options.physicalId.split(","),r=o[o.length-1],c={envId:m.getTenant(),serviceId:"3DSpace",contextId:s.id,objectId:r,objectType:i.options.type,displayName:i.options.display,displayType:i.options.type};n.data.items.push(c)}var d="text/plain";try{(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(d="text")}catch(e){}return{type:d,data:JSON.stringify(n)}}},getTemplateModelEvents:function(){return this.templateModelEvents},refreshNodesById:function(e){var s=this;d.start(s.name+" refreshNodesById");var n=[],a=[],i=[];return new t((function(t,s){e.isEdit?(n.push(e.physicalId),a.push(e.physicalId)):(n.push(e.physicalId),i.push(e.physicalId)),n.length>0&&c.templates.retrieve({data:{objects:{physicalId:n[0]}},onComplete:function(e){var s={},n=e.body;n.attribute.forEach((e=>{if(Object.keys(e)[0]===I)s=JSON.parse(e[I])})),n.data={},n.data.id=n.physicalId,n.data.data=s.data,n.data.info=s.info,n.data.hidden=s.hidden;var a=g.parse(e.body);t(a)},onFailure:function(e){s(e)}})})).then((function(e){var t=[],n=[];return i.length>=1&&t.push(e),a.length>=1&&(n.push(e),[].push([e.id]),{}[e.id]={id:e.id,type:e.type,name:e.name,title:e.title}),s.addRoots(t,!0).then((function(e){var t=l.get("templateComponentDialog")?l.get("templateComponentDialog"):l.get("templateComponent"),a=[];return e.length>0&&(s.unselectAll(),e.forEach((e=>{e.select()})),t.templateList.dataGridContainer.removeClassName("tree-list-empty")),s.withTransactionUpdate((function(){n.forEach((function(e){var t=s.searchRootById(e.physicalId);null!==t&&(g.update(t.options,e),t.updateOptions(e),a.push(t),t.select())}))})),d.end(s.name+" refreshNodesById"),{created:e,modified:a}}))}))},searchRootById:function(e){var t=this,s=null;d.start(t.name+" searchRootById");for(var n=t.getRoots(),a=0;a<n.length;a++)if(n[a].options.id===e){s=n[a];break}return d.end(t.name+" searchRootById"),s}})})),define("DS/IssueComponents/templates/TemplateMigration",["UWA/Class/Promise","UWA/Core","DS/Controls/ProgressBar","DS/DocumentManagement/DocumentManagement","DS/PADUtils/views/PADAlert","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/services/PlatformServices","DS/PlatformAPI/PlatformAPI","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l,c,d,u){"use strict";var m="ISU_TEMPLATES",p="In_Progress",f="Completed",g="DiffWidget";return{processLegacyTemplates:function(){var t=this,s=o.get("widget")||window.widget;return t.templateComponent=o.get("templateComponentDialog")?o.get("templateComponentDialog"):o.get("templateComponent"),t.migrationStatus().then((n=>n==g?void d.subscribe("DS/ENXISSU_AP/TemplateMigration",(function(e){"Completed"!=e.data.status||a.displayNotification({msg:"Templates are migrated, please refresh your widget.",eventID:"info"})})):n==f?void 0:t.getTemplates().then((e=>t.filterTemplateList(e))).then((e=>t.createTemplateList(e))).then((e=>t.getSharedTemplateData(e.shared).then((t=>({templateList:e,result:t}))))).then((e=>{var s=t.getContentIdAndData(e),n=s.consolidated,a=s.listOfContent;return t.fetchDataforContent(a).then((e=>({consolidated:n,result:e})))})).then((e=>{let s=t.getMembersOfTemplate(e.consolidated);return t.fetchDataforMembers(s).then((t=>({consolidated:e.consolidated,result:e.result,memberResult:t})))})).then((e=>t.formatDataForLegacy(e))).then((s=>{var n=[];return t.totalLegacyTemplate=s.length,s.forEach((e=>{n.push(t.migrateIssueTemplate(e))})),e.all(n).then((e=>t.getTemplates().then((s=>(0==s.length&&t.setMigrationStatus(f),e)))),(function(e){t.templateComponent._logger.error('The templatemigration failed "%s"',e)}))})).then((e=>(d.publish("DS/ENXISSU_AP/TemplateMigration",{metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now())},data:{status:"Completed"},version:"1.0"}),e))).catch((e=>{}))))},getTemplates:function(){var e=this,t=[];return r.preferences.get({data:{name:m}}).then((function(s){return t=s.body,e.legacyTemplates=t,e.migratedTemplateCount=0,t})).catch((function(t){return e.templateComponent._logger.error("Could not fetch the templates from the preferences: %o",t),[]}))},migrationStatus:function(){var t=this,s=o.get("widget")||window.widget,n="";return new e(((e,a)=>{t.getMigrationStatus().then((a=>{let i=a.status;if(""==i||null==i)t.setMigrationStatus(s.id+"-"+p),n=p;else if(i==s.id+"-"+p)n=p;else if(i==f)n=f;else if(n=g,c.isCloudEnvironment())return t.getTemplates().then((a=>{a.length>0?(n=p,t.setMigrationStatus(s.id+"-"+p)):(n=f,t.setMigrationStatus(f)),e(n)}));e(n)})).catch((t=>{e(n=p)}))}))},filterTemplateList:function(e){var s=[],n=[];return s=e.filter((function(e){return e.info.tenant===c.getTenant()})),c.isCloudEnvironment()?(n=e.filter((function(e){return("OnPremise"===e.info.tenant||""===e.info.tenant||null==e.info.tenant)&&!0===t.is(e.info.share,"object")})),this.fetchDocumentForCloud(n).then((e=>(n=e,s.concat(n))))):s},fetchDocumentForCloud:function(t){var s=this,a=[];if(0===t.length)return e.resolve(a);var i=t.reduce((function(e,t){return e.push(t.info.share.file),e}),[]);return new e((function(e){n.downloadDocuments(i,{tenantUrl:c.get3DSpaceUrl(),tenant:c.getTenant(),securityContext:decodeURIComponent(c.getSecurityContext()),onComplete:function(n){var i=n.length,o=0;n.forEach((function(n){n.downloadUrl?s.getContentFromURL(n.id,n.downloadUrl).then((s=>{var n=t.filter((e=>e.info.share.file==s.id));Array.isArray(n)&&(n[0].info.tenant=c.getTenant(),a.push(n[0])),++o==i&&e()})).catch((e=>{})):++o==i&&e()}))},onFailure:function(t){s.templateComponent._logger.error('The download call failed "%s"',t);var n=0,a=t.length;t.forEach((e=>{null==e.downloadUrl&&n++})),n==a&&e()}})})).then((function(){return a}))},createTemplateList:function(e){var s={shared:[],non_shared:[]};if(Array.isArray(e)){if(!(e.length>0))return s;this.showMigrationProgressBar(),e.forEach((e=>{!0===t.is(e.info.share,"object")?s.shared.push(e):s.non_shared.push(e)}))}return s},getSharedTemplateData:function(s){var a=this,i=t.clone(s),o={array:[],map:{}};if(0===i.length)return e.resolve(o);var r=i.reduce((function(e,t){return e.push(t.info.share.file),e}),[]);return new e((function(e){n.downloadDocuments(r,{tenantUrl:c.get3DSpaceUrl(),tenant:c.getTenant(),securityContext:decodeURIComponent(c.getSecurityContext()),onComplete:function(s){var n=s.length,r=0;s.forEach((function(s){s.downloadUrl?a.getContentFromURL(s.id,s.downloadUrl).then((s=>{var a=s,l=i.filter((e=>e.info.share.file==s.id)),d=t.clone(a.content);d.id=l[0].id,d.info.lastUsed=l[0].info.lastUsed,d.data.share={file:l[0].info.share.file,document:l[0].info.share.document};var u=d.info.version;t.is(u,"string")||(u=d.info.version=""),d.info.tenant=c.getTenant(),o.array.push(d),o.map[d.id]=d,++r==n&&e()})).catch((e=>{})):++r==n&&e()}))},onFailure:function(t){a.templateComponent._logger.error('The download call failed "%s"',t);var s=0,n=t.length;t.forEach((e=>{null==e.downloadUrl&&(s++,a.legacyTemplates=a.legacyTemplates.filter((function(t){return t.info.share?t.info.share.file!=e.id:t})))})),s==n&&e()}})})).then((function(){return a.setTemplates(a.legacyTemplates),o}))},getContentFromURL:function(t,s){var n=this,a=new XMLHttpRequest;return new e((function(e,i){a.open("GET",s,!0),a.responseType="blob",a.onload=function(){var s=new FileReader;s.readAsDataURL(a.response),s.onload=function(s){try{e({id:t,content:JSON.parse(n.base64.decode(s.target.result.split(",").pop()))})}catch(e){i(new Error("The shared template from the URL is not a JSON "+e))}}},a.onerror=function(){i(new Error("Could not read the shared template from the URL "+s))},a.send()}))},getContentIdAndData:function(e){var t=[],s=[];e.templateList.non_shared.forEach((e=>{t.push(e),(e.data.reportedAgainst.length>0||e.data.contexts.length>0)&&(e.data.reportedAgainst.forEach((e=>{s.push(e.physicalId)})),e.data.contexts.forEach((e=>{s.push(e.physicalId)})))})),e.result.array.forEach((e=>{t.push(e),(e.data.reportedAgainst.length>0||e.data.contexts.length>0)&&(e.data.reportedAgainst.forEach((e=>{s.push(e.physicalId)})),e.data.contexts.forEach((e=>{s.push(e.physicalId)})))}));var n=[...new Set(s)];return{consolidated:t,listOfContent:n}},getMembersOfTemplate:function(e){let t={user:[],userGroup:[]};e.forEach((e=>{e.data.assignees&&e.data.assignees.forEach((e=>{e.type&&"group"==e.type?t.userGroup.push(e):t.user.push(e)})),e.data.coOwners&&e.data.coOwners.forEach((e=>{e.type&&"group"==e.type?t.userGroup.push(e):t.user.push(e)})),e.data.contributors&&e.data.contributors.forEach((e=>{e.type&&"group"==e.type?t.userGroup.push(e):t.user.push(e)})),e.data.informedUsers&&e.data.informedUsers.forEach((e=>{e.type&&"group"==e.type?t.userGroup.push(e):t.user.push(e)}))}));const s=[...new Map(t.user.map((e=>[e.user,e]))).values()],n=[...new Map(t.userGroup.map((e=>[e.user,e]))).values()];return t.user=s,t.userGroup=n,t},fetchDataforContent:function(t){return new e(((e,s)=>{t.length>0?r.fetch({data:{objects:t.map((function(e){return{physicalId:e}}))}}).then((t=>{var s=t.body,n={};s.infos&&s.infos.nresults&&s.infos.nresults>0&&s.results.forEach((e=>{var t="",s="";e.attributes.forEach((e=>{"resourceid"==e.name&&(t=e.value),"ds6w:type"==e.name&&(s=e.value)})),n[t]={physicalId:t,type:s}})),e(n)})).catch((e=>{})):e()}))},fetchDataforMembers:function(t){return new e(((e,s)=>{t.user.length>0||t.userGroup.length>0?r.templates.getMembers(t).then((t=>{var s={};t.forEach((e=>{s[e.identifier]={...e}})),e(s)})).catch((e=>{})):e()}))},formatDataForLegacy:function(e){var s=[],n=e.result,a=e.memberResult;return e.consolidated.forEach((e=>{e.data.reportedAgainst.slice(0).forEach((t=>{null==n[t.physicalId]?e.data.reportedAgainst.splice(e.data.reportedAgainst.indexOf(t),1):(t.objectType=n[t.physicalId].type,t.serviceId="3dspace",t.envId=c.getTenant())})),e.data.contexts.slice(0).forEach((t=>{null==n[t.physicalId]?e.data.contexts.splice(e.data.contexts.indexOf(t),1):(t.objectType=n[t.physicalId].type,t.serviceId="3dspace",t.envId=c.getTenant())})),t.is(e.data.custom)&&Object.values(e.data.custom)&&Object.values(e.data.custom).forEach(((t,s)=>{Array.isArray(t)&&(e.data.custom[Object.keys(e.data.custom)[s]]=t.toString())})),Array.isArray(e.data.assignees)&&e.data.assignees.slice(0).forEach((t=>{null==a[t.user]&&e.data.assignees.splice(e.data.assignees.indexOf(t),1)})),Array.isArray(e.data.coOwners)&&e.data.coOwners.slice(0).forEach((t=>{null==a[t.user]&&e.data.coOwners.splice(e.data.coOwners.indexOf(t),1)})),Array.isArray(e.data.contributors)&&e.data.contributors.slice(0).forEach((t=>{null==a[t.user]&&e.data.contributors.splice(e.data.contributors.indexOf(t),1)})),Array.isArray(e.data.informedUsers)&&e.data.informedUsers.slice(0).forEach((t=>{null==a[t.user]&&e.data.informedUsers.splice(e.data.informedUsers.indexOf(t),1)}))})),e.consolidated.forEach((e=>{e.data.templateTitle=e.info.name,e.data.templateDescription=e.info.description,e.data.oldTemplateId=e.id;var t={id:"",data:e.data,metadata:{hidden:e.hidden,info:e.info,data:{securityContexts:e.data.securityContexts,title:e.data.title,description:e.data.description,automationTasks:e.data.automationTasks}}};s.push(t)})),s},migrateIssueTemplate:function(e){var t=this,s=e.data.securityContexts,n=c.getSecurityContexts();return n.cspaces.some((e=>e.value==s))||(e.data.securityContexts=n.securityContext,e.metadata.data.securityContexts=n.securityContext),t.createIssueTemplate(e).then((function(s){var n={physicalId:s.body.physicalId,isEdit:!0};return e.data.attachments.length>0?t._connectAttachments(n,e):n})).then((function(t){return Array.isArray(e.data.classes)&&e.data.classes.length>0||Array.isArray(e.data.existingClassification)&&e.data.existingClassification.length>0?i.classification.getCSRFToken(t).then((t=>i.classification.classifyObject(e.data.classes,t))).then((e=>i.classification.getClassAttrVals(e))).then((t=>{if(t.cestamp){var s=e.data.attributes;return i.classification.setClassificationValues(s,t)}return t})).then((t=>{var s=o.get("templateComponentDialog")?o.get("templateComponentDialog"):o.get("templateComponent");return s&&i.classification.addClassificationColumn(e,s.templateList,"template"),t})).catch((e=>({issueId:t.physicalId}))):{issueId:t.physicalId}})).then((function(t){return e.data.share?r.templates.promoteTemplate(t,e).then((e=>t)).catch((e=>t)):t})).then((function(t){return e.data.share?r.templates.changeTemplateOwner(t,e).then((e=>t)).catch((e=>t)):t})).then((function(t){return e.data.share&&r.templates.deleteDocument({data:e.data.share.document}),e})).then((function(s){return t.updateProgress(),t.legacyTemplates=t.legacyTemplates.filter((function(t){return t.id!=e.data.oldTemplateId})),t.setTemplates(t.legacyTemplates),!0}))},createIssueTemplate:function(t){var s=this;return new e(((e,n)=>{r.templates.createTemplate({data:t}).then((function(t){e(t)})).catch((function(t){e(t),s.templateComponent._logger.error("Could not create the template: %o",t)}))}))},_connectAttachments:function(t,s){null!=s.data.primaryAttachment&&null!=s.data.primaryAttachment&&l.setAsPrimary(s.data.primaryAttachment,t.physicalId,!0);var n=[];return s.data.attachments.forEach((e=>{n.push(l.connectDocumentToParent(e,t.physicalId))})),e.all(n).then((e=>t)).catch((e=>t))},showMigrationProgressBar:function(){var e=this,n=o.get("widget")||window.widget,i=t.createElement("span",{html:u.templateMigrationMsg,class:"migration-msg"}),r=t.createElement("br",{}),l=t.createElement("span",{html:u.templateMigrationSubMsg,class:"migration-subMsg"});e.migrationProgressBar=new s({shape:"linear"});var c=t.createElement("div",{}),d=t.createElement("div",{class:"migration-progressBar"});e.migrationProgressBar.inject(d),i.inject(c),r.inject(c),l.inject(c),d.inject(c),e.migrationProgressBar.value=0,e.migrationProgressBar.gradientAnimationFlag=!1,e.templateComponent.templateList.dataGridContainer.addClassName("tree-list-empty"),e.templateComponent.templateList.treeListPlaceholder.setContent(c),n.getValue("IsIssueSummaryView")&&a.displayNotification({msg:u.templateMigrationMsg+"\n"+u.templateMigrationSubMsg,eventID:"info"})},updateProgress:function(){var e=this;e.migratedTemplateCount++;var t=e.migratedTemplateCount/e.totalLegacyTemplate*100;e.migrationProgressBar.value=t},setTemplates:function(e){var t=this;return r.preferences.set({data:{name:m,value:JSON.stringify(e)}}).catch((function(e){t.templateComponent._logger.error("Could not save the preferences: %o",e)}))},setMigrationStatus:function(e){var t=this;let s={status:e};r.preferences.set({data:{name:"ISUTemplateMigration",value:JSON.stringify(s)}}).catch((function(e){t.templateComponent._logger.error("Could not save the preferences: %o",e)}))},getMigrationStatus:function(e){var t=this;return r.preferences.get({data:{name:"ISUTemplateMigration"}}).then((function(e){return e.body})).catch((function(e){return t.templateComponent._logger.error("Could not save the preferences: %o",e),""}))},base64:{decode:function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}}}})),define("DS/IssueComponents/create/Related",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Iconbar","DS/Controls/TooltipModel","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/Visualization/ThreeJS_DS","DS/IssueCommon/commands/CommandsManager","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C){"use strict";var I={NONSUPPORTED_TYPES:["Change Action","Change Order","Change Request","Change Analysis","Route","Country","Business Role","Issue"],ISSUE_MANAGEMENT:"ENXISSU_AP",ISSUE_3D_REVIEW:"ENX3DIR_AP",ISSUE_TYPE:"Issue",PATH_TO_PARSE:0,RELATED_OBJECTS_TYPES:{CONTEXTS:"contexts",REPORTED_AGAINST:"reportedAgainst"}};return t.extend({name:"DS/IssueComponents/create/Related",tag:"div",className:"create-view-content-subview create-related",defaultOptions:{treelist:{grid:{height:"100%",apiVersion:2,defaultCellHeight:26,useTransparentScroller:!1,useNativeScroller:!1,useAsyncPreExpand:!0,resize:{columns:!0,rows:!1},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},columns:[{text:C.create.related.treelist.tree,dataIndex:"tree",width:"auto",isDraggable:!1},{text:C.create.related.treelist["ds6w:type"],width:"auto",dataIndex:"ds6w:type",isDraggable:!1},{text:C.create.related.treelist["ds6w:identifier"],width:"auto",dataIndex:"ds6w:identifier",isDraggable:!1},{text:C.create.related.treelist["ds6wg:revision"],width:"auto",dataIndex:"ds6wg:revision",isDraggable:!1}]}}},isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e((function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t})),s.form=null,s.formElements={reportedAgainst:null,contexts:null},s.formElementsToggler={reportedAgainst:null,contexts:null},s.fields={reportedAgainst:{},contexts:{},balloons:null},s._deferredInit.resolve()},destroy:function(){var e=this;e.fields.reportedAgainst.treeList&&e.fields.reportedAgainst.treeList.getRoots().forEach((function(e){if(e.options.position&&e.options.position.balloons&&e.options.position.balloons.length)for(var t=e.options.position.balloons,s=0;s<t.length;s++)e.options.position.balloons[s].destroy()})),e.form=null,e.formElements={reportedAgainst:null,contexts:null},e.formElementsToggler={reportedAgainst:null,contexts:null},e.fields={reportedAgainst:{},contexts:{},balloons:null}},render:function(){var e=this;if(e._renderReportedAgainstField(),e._renderContextField(),!e.parent.isTemplate&&"IFB"===e.parent.options.issueCreationType&&widget.getValue("createSetting")&&widget.getValue("selectedContext")){var t=widget.getValue("selectedContext").id,a=widget.getValue("selectedContext").type,i=widget.getValue("selectedContext").serviceId;i.includes(":")&&(i=i.split(":")[0]);var o=[],r=f.get("ISU_TYPE_NLS");if(s.is(r["ds6w:type"])&&(o=Object.keys(r["ds6w:type"])),!o.includes(a)){var l=widget.getValue("affectedItemCreateSetting"),c=widget.getValue("contextCreateSetting");l&&e._addNodes([{id:t,serviceId:i}],I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST),c&&e._addNodes([{id:t,serviceId:i}],I.RELATED_OBJECTS_TYPES.CONTEXTS)}}return e.form=new n({className:"create-related-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container),s.createElement("div",{class:"create-form-content",html:[e.formElements.reportedAgainst=s.createElement("div",{class:"create-form-element create-related-form-element-reported-against",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.reportedAgainst=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[e.fields.reportedAgainst.title,e.fields.reportedAgainst.treeListContainer]}]}),e.formElements.contexts=s.createElement("div",{class:"create-form-element create-related-form-element-contexts",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.contexts=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[e.fields.contexts.title,e.fields.contexts.treeListContainer]}]})]}).inject(e.form.elements.container),e},getValues:function(){var e=[];this.fields.reportedAgainst.treeList.getDocument().getRoots().forEach((function(t){var s=t.options.id.split(","),n={physicalId:s[s.length-1],path:s,envId:t.options.envId,serviceId:t.options.serviceId,objectType:t.options.type};e.push(n),t.options.hasOwnProperty("position")&&null!==t.options.position&&void 0!==t.options.position&&(n.position={x:t.options.position.x,y:t.options.position.y,z:t.options.position.z})}));var t=[];return this.fields.contexts.treeList.getDocument().getRoots().forEach((function(e){var s={physicalId:e.options.id,envId:e.options.envId,serviceId:e.options.serviceId,objectType:e.options.type};t.push(s)})),{reportedAgainst:e,contexts:t}},getHiddenAttributes:function(){var e=this,t={};for(var n in e.formElements)s.is(e.formElementsToggler[n])&&(t[n]=e.formElementsToggler[n].hasClassName("fonticon-eye-off"));return t},applyTemplate:function(t){var n=this;return n.reset().then((function(){var a=[];if(Array.isArray(t.data.reportedAgainst)&&t.data.reportedAgainst.length>0&&t.data.reportedAgainst.forEach((function(t){var i=t.position&&s.is(t.position,"object"),o=[],r=t.serviceId;Array.isArray(t.path)?o=t.path:o.push(t.physicalId);var l=s.merge(t.automation||{},{assignee:!1,context:!1});if(!0===i){var c=(f.get("widget")?f.get("widget"):window.widget).name===I.ISSUE_3D_REVIEW,d=f.get("component"),u=d&&"getManager"in d&&d.getManager(),m=[],p={};if(p[o.join()]={x:Number(t.position.x),y:Number(t.position.y),z:Number(t.position.z),balloons:[]},c&&u&&(m=d.getManager().getNodesById(t.physicalId)),m.hasOwnProperty("nodes")&&m.nodes.length>0){for(var g=[],h=0;h<m.nodes.length;h++){m.paths[h].toString().includes(o.toString())&&g.push(new e((function(e){n._addBalloon(p[o.join()],t.physicalId,m.paths[h],(function(){p[o.join()].balloons.push(this),e()}))})))}a.push(e.all(g).then((function(){return n.parent.elements.dialog.show(),n._addNodes([{id:o.join(),serviceId:r}],I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,p,!l.assignee)})))}else a.push(n._addNodes([{id:o.join(),serviceId:r}],I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,p,!l.assignee))}else a.push(n._addNodes([{id:o.join(),serviceId:r}],I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,null,!l.assignee))})),Array.isArray(t.data.contexts)&&t.data.contexts.length>0&&a.push(n._addNodes(t.data.contexts.map((function(e){return{id:e.physicalId,serviceId:e.serviceId}})),I.RELATED_OBJECTS_TYPES.CONTEXTS)),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var i=n.formElements,o=n.formElementsToggler;for(var r in i)!0===t.hidden[r]&&(n.parent.isTemplate?(s.is(i[r])&&i[r].toggleClassName("visibility-masked",!0),s.is(o[r])&&(o[r].toggleClassName("fonticon-eye-off",!0),o[r].toggleClassName("fonticon-eye",!1))):s.is(i[r])&&i[r].hide())}return e.all(a)}))},reset:function(){var t=this;return new e((function(e){var s=t.fields.reportedAgainst.treeList.getRoots();t._removeNodes(s,I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST),t._removeNodes(t.fields.contexts.treeList.getRoots(),I.RELATED_OBJECTS_TYPES.CONTEXTS),e()}))},_renderReportedAgainstField:function(){var t=this,n=(f.get("widget")?f.get("widget"):window.widget).name===I.ISSUE_3D_REVIEW;t.fields.reportedAgainst.title=s.createElement("div",{class:"create-form-title-with-iconbar",html:[{tag:"h5",class:"create-form-field-reported-against-label",html:[C.create.related.labels.reportedAgainst,t.fields.reportedAgainstHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]}),p.updatePanelTooltip(t.fields,"reportedAgainstHelper"),t.fields.reportedAgainst.iconBar=new a({renderTo:t.fields.reportedAgainst.title,items:[{id:"location",fonticon:"location",text:C.create.related.addBalloonAvailable,handler:function(){var a=f.get("component"),i=function(a,i,o,r,l){for(var c=a.split(","),d=[],u=0;u<o.nodes.length;u++){var m=o.paths[u].toString().includes(c.toString());n?m&&d.push(new e((function(e){t._addBalloon(i[a],a,o.paths[u],(function(){i[a].balloons.push(this),e()}))}))):d.push(e.resolve())}e.all(d).then((function(){var e="3dspace";if(l&&""!==l){var n={};n[l]=i[a],i=n,a=l,l.includes("i3dx:r2vsurvey!")&&(e="r2vsurvey")}t.parent.elements.dialog.show();var o=[t._addNodes([{id:a,serviceId:e}],I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,i)];return s.is(r,"string")&&o.push(t._addNodes([{id:r,serviceId:e}],I.RELATED_OBJECTS_TYPES.CONTEXTS)),o}))};if(n)t.parent.elements.dialog.hide(),a.utils.selectIn3D((function(e,t,s,n,a,o){i(e,t,s,n,o)}),(function(){t.parent.elements.dialog.show()}),[{isOccurenceSelection:!0}]);else{s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.hide();var o=a.taskManager.addSelectIn3DTask((function(e){var n=e.target,r=e.positions,l=e.nodes,c=e.context,d=e.i3dx;i(n,r,l,c,d),s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.show(),a.unmaskForTask(o)}),(function(){s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.show(),a.unmaskForTask(o)}),{isOccurenceSelection:!0});a.maskForTask(o,C.tasks.selectIn3D)}}},{id:"addReported",text:C.create.related.search,fonticon:"plus",handler:function(){var e=f.get("application");if(s.is(e,"object")&&e.isStandalone){var n=f.get("component"),a=n.taskManager.addObjectsTask((function(e){if(Array.isArray(e)){for(var s=[],i=0;i<e.length;i++)s.push({id:e[i].physicalId,serviceId:e[i].serviceId});t._addNodes(s,I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)}n.unmaskForTask(a)}),(function(){n.unmaskForTask(a)}));n.maskForTask(a,C.tasks.addObjects)}else{var i=I.NONSUPPORTED_TYPES;g.type.getSubType().then((e=>{var s=e;null!=s&&Object.keys(s).length>1&&(i=Object.keys(s)),h.search({title:C.create.related.labels.reportedAgainst,default_search_criteria:"",callback:function(e){for(var s=[],n=0,a=!0,o=0;o<e.length;o++)if(i.includes(e[o]["ds6w:type_value"]))n++;else{var r=e[o];if(r.sourceid.includes(":")){const e=r.sourceid.split(":");r.sourceid=e[0]}if(r.sourceid.toLowerCase().includes("3dspace")||r.hasOwnProperty("ds6w:i3dx_value")&&""!=r["ds6w:i3dx_value"]){var c=r["ds6w:i3dx_value"]&&""!=r["ds6w:i3dx_value"]?r["ds6w:i3dx_value"]:r.id;s.push({id:c,serviceId:r.sourceid})}else a=!1}a||l.displayNotification({msg:C.create.related.dropError,eventID:"warning"}),0===n?t._addNodes(s,I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST):l.displayNotification({msg:C.replace(C.resolveIssues.issueNotDroppable,{number:n}),eventID:"error"})},cancel:function(){}})}))}}},{id:"removeReported",text:C.create.related.remove,fonticon:"remove",handler:function(){t._removeSelectedNodes(I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)}}]}),t.fields.reportedAgainst.iconBar.disableItem("removeReported"),t.fields.reportedAgainst.treeListContainer=s.createElement("div",{class:"create-form-treelist treelist-empty",id:I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,tabindex:"-1"}),t.fields.reportedAgainst.treeListPlaceholder=s.createElement("span",{class:"treelist-placeholder",html:C.create.related.labels.reportedAgainstPlaceholder}).inject(t.fields.reportedAgainst.treeListContainer),t._addDropEvent(t.fields.reportedAgainst.treeListContainer);var i=s.clone(t.options.treelist.grid);i.id=I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,i.onDropBlank=t._onTreeListDrop.bind(t),i.onDropCell=t._onTreeListDrop.bind(t),i.onDragStartCell=t._onDragStartCell.bind(t),i.allowUnsafeHTMLContent=!1,t.addOccurencePathColumn(i),t.fields.reportedAgainst.treeList=new c(i),t.fields.reportedAgainst.treeList.inject(t.fields.reportedAgainst.treeListContainer)},addOccurencePathColumn:function(e){e.columns.splice(1,0,{text:C.create.related.treelist.occurrence,dataIndex:"occurrence",width:"auto",isDraggable:!1})},_renderContextField:function(){var e=this,t=(f.get("widget")?f.get("widget"):window.widget).name===I.ISSUE_3D_REVIEW;e.fields.contexts.title=s.createElement("div",{class:"create-form-title-with-iconbar",html:[{tag:"h5",class:"create-form-field-contexts-label",html:[C.create.related.labels.contexts,e.fields.contextsHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]}),p.updatePanelTooltip(e.fields,"contextsHelper"),e.fields.contexts.iconBar=new a({renderTo:e.fields.contexts.title,items:[{id:"location",fonticon:"location",text:C.create.related.selectContextIn3D,handler:function(){var n=f.get("component");if(t)e.parent.elements.dialog.hide(),n.utils.selectIn3D((function(t,s,n,a,i,o){o&&""!==o&&(t=o),e.parent.elements.dialog.show(),e._addNodes([{id:t,serviceId:"3dspace"}],I.RELATED_OBJECTS_TYPES.CONTEXTS)}),(function(){e.parent.elements.dialog.show()}));else{s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.hide();var a=n.taskManager.addSelectIn3DTask((function(t){var i=t.target;s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(a),e._addNodes([{id:i,serviceId:"3dspace"}],I.RELATED_OBJECTS_TYPES.CONTEXTS)}),(function(){s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(a)}));n.maskForTask(a,C.tasks.selectIn3D)}}},{id:"addContext",text:C.create.related.search,fonticon:"plus",handler:function(){var t=f.get("application");if(s.is(t,"object")&&t.isStandalone){var n=f.get("component"),a=n.taskManager.addObjectsTask((function(t){if(Array.isArray(t)){for(var s=[],i=0;i<t.length;i++)s.push({id:t[i].physicalId,serviceId:t[i].serviceId});e._addNodes(s,I.RELATED_OBJECTS_TYPES.CONTEXTS)}n.unmaskForTask(a)}),(function(){n.unmaskForTask(a)}));n.maskForTask(a,C.tasks.addObjects)}else{var i=I.NONSUPPORTED_TYPES;g.type.getSubType().then((t=>{var s=t;null!=s&&Object.keys(s).length>1&&(i=Object.keys(s)),h.search({title:C.create.related.labels.contexts,default_search_criteria:"",multiSel:!0,callback:function(t){for(var s=[],n=0,a=!0,o=0;o<t.length;o++)if(i.includes(t[o]["ds6w:type_value"]))n++;else{var r=t[o];if(r.sourceid.includes(":")){const e=r.sourceid.split(":");r.sourceid=e[0]}if(r.sourceid.toLowerCase().includes("3dspace")||r.hasOwnProperty("ds6w:i3dx_value")&&""!=r["ds6w:i3dx_value"]){var c=r["ds6w:i3dx_value"]&&""!=r["ds6w:i3dx_value"]?r["ds6w:i3dx_value"]:r.id;s.push({id:c,serviceId:r.sourceid})}else a=!1}a||l.displayNotification({msg:C.create.related.dropError,eventID:"warning"}),0===n?e._addNodes(s,I.RELATED_OBJECTS_TYPES.CONTEXTS):l.displayNotification({msg:C.replace(C.resolveIssues.issueNotDroppable,{number:n}),eventID:"error"})},cancel:function(){}})}))}}},{id:"removeContext",text:C.create.related.remove,fonticon:"remove",handler:function(){e._removeSelectedNodes(I.RELATED_OBJECTS_TYPES.CONTEXTS)}}]}),e.fields.contexts.iconBar.disableItem("removeContext"),e.fields.contexts.treeListContainer=s.createElement("div",{class:"create-form-treelist treelist-empty",id:I.RELATED_OBJECTS_TYPES.CONTEXTS,tabindex:"-1"}),e.fields.contexts.treeListPlaceholder=s.createElement("span",{class:"treelist-placeholder",html:C.create.related.labels.contextPlaceholder}).inject(e.fields.contexts.treeListContainer),e._addDropEvent(e.fields.contexts.treeListContainer);var n=s.clone(e.options.treelist.grid);n.id=I.RELATED_OBJECTS_TYPES.CONTEXTS,n.onDropBlank=e._onTreeListDrop.bind(e),n.onDropCell=e._onTreeListDrop.bind(e),n.onDragStartCell=e._onDragStartCell.bind(e),e.fields.contexts.treeList=new c(n),e.fields.contexts.treeList.inject(e.fields.contexts.treeListContainer)},_addNodesReportedAgainst:function(t,s,n,a){var i=this,o=i.fields[s].treeList;return new e((function(e,r){var c={skipped:{ids:[]},error:{ids:[]},result:{ids:[]}},u=[],m=t.map((e=>e.id));o.getRoots().forEach((function(e){var t=m.indexOf(e.options.id);-1!==t&&(m.splice(t,1),c.skipped.ids.push(e.options.id),u.push(e))})),u.forEach((function(e){if(n&&e.options.id in n){for(var t=e.options.position.balloons||[],s=0;s<t.length;s++)t[s].destroy();e.options.position=n[e.options.id]}}));for(var p=[],f=0;f<m.length;f++)if(m[f]){var b=m[f].split(",");p.push(b[b.length-1])}else p.push(m);m.length?g.fetch({data:{objects:p.map((function(e){return{physicalId:e}}))},onComplete:function(u){var f=u.body;f.infos&&f.infos.nresults&&p.length!==f.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"});var g=[];f.infos&&f.infos.nresults&&f.infos.nresults>0?(o.getDocument().withTransactionUpdate((function(){if("results"in f){var e={};f.results.forEach((function(t){var s=v.parseFetchResponse(t);e[s.value.id]=s}),r)}else r(u);for(var l=0;l<m.length;l++){var p={label:null,icons:[],grid:{}},b=m[l].split(","),C=e[b[b.length-1]];p.icons.push(C.value.typeIcon),p.id=m[l],p.grid["ds6w:label"]=C.display.title,p.label=C.display.title,p.title=C.display.title,p.grid["ds6w:type"]=C.display.type,p.type=C.value.type,p.grid["ds6w:identifier"]=C.display.name,p.name=C.value.name?C.value.name:"",p.grid["ds6wg:revision"]=C.display.revision,p.revision=C.value.revision,p.grid["ds6w:organizationResponsible"]=C.display.organization,p.organizationResponsible=C.value.organization,p.grid["ds6w:responsible"]=C.display.responsible,p.responsible=C.value.responsible,p.grid.owner=C.display.owner,p.owner=C.value.owner;var y=t.find((e=>e.id.includes(C.display.id)));if(p.serviceId=y.serviceId,p.envId=h.getTenant(),"Issue"===p.type)c.error.ids.push(p.id);else{var E=new d(p);if(n&&E.options.id in n&&(E.options.position=n[E.options.id]),E.onSelect((function(e){s===I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST?i.fields.reportedAgainst.iconBar.enableItem("removeReported"):s===I.RELATED_OBJECTS_TYPES.CONTEXTS&&i.fields.contexts.iconBar.enableItem("removeContext")})),E.onUnselect((function(e){0===o.getDocument().getSelectedNodes().length&&(s===I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST?i.fields.reportedAgainst.iconBar.disableItem("removeReported"):s===I.RELATED_OBJECTS_TYPES.CONTEXTS&&i.fields.contexts.iconBar.disableItem("removeContext"))})),o.addRoot(E),g.push(E),c.result.ids.push(p.id),!a&&s===I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)"true"===localStorage.getItem("assignPreferenceTemplate")&&i.parent.dispatchEvent("related-add-reportedAgainst",{data:E.options})}}})),i.fetchOccurencePath(g,m,o),o.getDocument().getRoots().length&&i.fields[s].treeListContainer.removeClassName("treelist-empty"),e(c)):e(c)},onFailure:function(e){r(e)}}):e(c)}))},_addNodes:function(t,s,n,a){var i=this;if(s==I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)return i._addNodesReportedAgainst(t,s,n,a);var o=i.fields[s].treeList;return new e((function(e,r){var c={skipped:{ids:[]},error:{ids:[]},result:{ids:[]}},u=[],m=t.map((e=>e.id));o.getRoots().forEach((function(e){var t=m.indexOf(e.options.id);-1!==t&&(m.splice(t,1),c.skipped.ids.push(e.options.id),u.push(e))})),u.forEach((function(e){if(n&&e.options.id in n){for(var t=e.options.position.balloons||[],s=0;s<t.length;s++)t[s].destroy();e.options.position=n[e.options.id]}})),m.length?g.fetch({data:{objects:m.map((function(e){return{physicalId:e}}))},onComplete:function(u){var p=u.body;p.infos&&p.infos.nresults&&m.length!==p.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"}),p.infos&&p.infos.nresults&&p.infos.nresults>0?(o.getDocument().withTransactionUpdate((function(){"results"in p?p.results.forEach((function(e){var r={label:null,icons:[],grid:{}},l=v.parseFetchResponse(e);r.icons.push(l.value.typeIcon),r.id=l.value.id,r.grid["ds6w:label"]=l.display.title,r.label=l.value.title,r.title=l.value.title,r.grid["ds6w:type"]=l.display.type,r.type=l.value.type,r.grid["ds6w:identifier"]=l.display.name,r.name=l.value.name?l.value.name:"",r.grid["ds6wg:revision"]=l.display.revision,r.revision=l.value.revision,r.grid["ds6w:organizationResponsible"]=l.display.organization,r.organizationResponsible=l.value.organization,r.grid["ds6w:responsible"]=l.display.responsible,r.responsible=l.value.responsible,r.grid.owner=l.display.owner,r.owner=l.value.owner;var u=t.find((e=>e.id.includes(l.display.id)));if(r.serviceId=u.serviceId,r.envId=h.getTenant(),"Issue"===r.type)c.error.ids.push(r.id);else{var m=new d(r);if(n&&m.options.id in n&&(m.options.position=n[m.options.id]),m.onSelect((function(e){s===I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST?i.fields.reportedAgainst.iconBar.enableItem("removeReported"):s===I.RELATED_OBJECTS_TYPES.CONTEXTS&&i.fields.contexts.iconBar.enableItem("removeContext")})),m.onUnselect((function(e){0===o.getDocument().getSelectedNodes().length&&(s===I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST?i.fields.reportedAgainst.iconBar.disableItem("removeReported"):s===I.RELATED_OBJECTS_TYPES.CONTEXTS&&i.fields.contexts.iconBar.disableItem("removeContext"))})),o.addRoot(m),c.result.ids.push(r.id),!a&&s===I.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)"true"===localStorage.getItem("assignPreferenceTemplate")&&i.parent.dispatchEvent("related-add-reportedAgainst",{data:m.options})}}),r):r(u)})),o.getDocument().getRoots().length&&i.fields[s].treeListContainer.removeClassName("treelist-empty"),e(c)):e(c)},onFailure:function(e){r(e)}}):e(c)}))},_addBalloon:function(e,t,s,n){f.get("component").utils.createBalloon({id:t,position:e,path:s,color:"red",parent:this,temporary:!0}).then((function(e){n.call(e)}))},_removeSelectedNodes:function(e){var t=this.fields[e].treeList.getDocument().getSelectedNodes();t.length?this._removeNodes(t,e):l.displayNotification({msg:C.create.related.removeErrorNoSelection,eventID:"warning"})},_removeNodes:function(e,t){var s=this.fields[t].treeList;s.getDocument().withTransactionUpdate((function(){for(var t=e.length-1;t>=0;t--){var n=e[t];if(n.options.position&&n.options.position.balloons&&n.options.position.balloons.length)for(var a=n.options.position.balloons,i=0;i<a.length;i++)n.options.position.balloons[i].destroy();s.getDocument().removeRoot(n)}})),0===s.getDocument().getRoots().length&&this.fields[t].treeListContainer.addClassName("treelist-empty")},_addDropEvent:function(e){var t=0;e.addEventListener("drop",this._onTreeListDrop.bind(this)),e.addEventListener("dragenter",(function(){e.addClassName("drag-enter"),t++})),e.addEventListener("dragleave",(function(){0===--t&&e.removeClassName("drag-enter")})),document.addEventListener("dragover",(function(e){e.preventDefault()}))},_onTreeListDrop:function(e,t){e.currentTarget.removeClassName("drag-enter"),e.preventDefault();var s,n=this;if(s=t?t.parent.options.id:e.currentTarget.id,""!==e.dataTransfer.getData("text/searchitems"))JSON.parse(e.dataTransfer.getData("text/searchitems"));else if(""!==e.dataTransfer.getData("text/plain"))try{JSON.parse(e.dataTransfer.getData("text/plain"))}catch(e){}p.getDroppableData(e).then((e=>{var t=e.data.items;if(t){var a=[],i=!0;t.forEach((function(e){if(e.serviceId.includes(":")){const t=e.serviceId.split(":");e.serviceId=t[0]}I.NONSUPPORTED_TYPES.includes(e.objectType)||e.isIssue?i=!1:e.serviceId.toLowerCase().includes("3dspace")||e.hasOwnProperty("i3dx")&&""!=e.i3dx?"i3dx"in e&&""!=e.i3dx?a.push({id:e.i3dx,serviceId:e.serviceId}):"objectId"in e&&a.push({id:e.objectId,serviceId:e.serviceId}):i=!1})),i||l.displayNotification({msg:C.create.related.dropError,eventID:"warning"}),n._addNodes(a,s).then((function(e){e.error&&e.error.ids&&e.error.ids.length>0&&l.displayNotification({msg:C.create.related.dropError,eventID:"error"})}))}else l.displayNotification({msg:C.create.related.dropError,eventID:"error"})}))},_onDragStartCell:function(e,t){var n=this,a="";a=s.is(t,"object")?t.parent.options.id:e.currentTarget.id;var i=n.fields[a].treeList.getDocument().getSelectedNodes();if(0===i.length)return!1;var o=p.setDroppableData(i),r={type:o.type,data:JSON.stringify(o.data)};return e.dataTransfer.setData(r.type,r.data),n._ghost&&(n._ghost.destroy(),n._ghost=null),n._ghost=p.createGhostDrag(t.nodeModel.options,i.length),document.body.appendChild(n._ghost),e.dataTransfer.setDragImage(n._ghost,e.offsetX,e.offsetY),!0},fetchOccurencePath:function(e,t,s){var n=[];if(0!=e.length){for(var a=0;a<t.length;a++)if(t[a])for(var i=t[a].split(","),o=0;o<i.length;o++)0!=o&&o%2!=1&&o!=i.length-1||n.push(i[o]);g.fetch({data:{objects:n.map((function(e){return{physicalId:e}}))},onComplete:function(t){var a=t.body;if(a.infos&&a.infos.nresults&&n.length!==a.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"}),a.infos&&a.infos.nresults&&a.infos.nresults>0){var i={};e.forEach((function(e){i[e.options.id]="NewNode"})),s.getDocument().withTransactionUpdate((function(){var e={};"results"in a&&a.results.forEach((function(t){var s=v.parseFetchResponse(t);e[s.value.id]=s}));for(var t=s.getRoots(),n=0;n<t.length;n++)if("NewNode"==i[t[n].options.id]){var o=t[n].options.id.split(","),r="",l="";o.length>0&&(r=e[o[o.length-1]].display.title);for(var c=0;c<o.length;c++)e[o[c]]&&c!=o.length-1&&(l+=e[o[c]].display.title,c!=o.length-2&&(l+="\\"));var d=t[n]._options.grid;1==o.length?(d.occurrence="",d["ds6w:label"]=r):(d.occurrence=l,d["ds6w:label"]=l),t[n].updateOptions({grid:d}),t[n].setLabel(r),t[n].options.title=r}}))}},onFailure:function(e){}})}}})})),define("DS/IssueComponents/team/MembersMenu",["UWA/Core","DS/IssueServices/services/PlatformServices","DS/IssueCommon/commands/CommandsManager","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o){"use strict";var r={showRMBMenuOnGrid:function(e,s,a){return new Promise((function(o,l){var c={},d=s.cellInfos.nodeModel.getTreeDocument().getSelectedNodes(),u=d[0].options.grid.roles;c.currentObjType=d[0].options.grid.type;var m=0,p=[];require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(l){u.indexOf("Co-owner")>=0?(c.Coowner="DISCONNECT",m++):c.Coowner="CONNECT",u.indexOf("Contributor")>=0?(c.Contributor="DISCONNECT",m++):c.Contributor="CONNECT",u.indexOf("Assignee")>=0?(c.Assignee="DISCONNECT",m++):c.Assignee="CONNECT",u.indexOf("InformedUser")>=0?(c.InformedUser="DISCONNECT",m++):c.InformedUser="CONNECT";var f=u.indexOf("Owner")>=0,g="Owner"===s.cellInfos.nodeModel.getParent().options.grid.role;if(1==d.length){if(1==l.issues.length){f||1!=m||(c.showConfirmation=!0);var h=t.getUserName(),v=l.issues[0].coOwners.filter((function(e){return e.user===h}));(h===l.issues[0].owner.user||v.length>0)&&(f||p.push(r.getCoownerMenu(e,s,c))),p.push(r.getAssigneeMenu(e,s,c)),p.push(r.getContributorMenu(e,s,c)),p.push(r.getInformedUserMenu(e,s,c)),p.push({type:"SeparatorItem"})}i.get("widget")||window.widget;g&&p.push(r.getChangeOwnerMenu(e,s,c,a.physicalIds)),""!==t.get3DSwymUrl()&&"group"!==s.cellInfos.nodeModel.options.grid.type&&p.push(r.getViewProfileMenu(e,s,c)),n.updateTooltip(p)}if(l.issues.length>1){var b=s.cellInfos.nodeModel.options.grid.common,C=s.cellInfos.nodeModel.options.grid.isRoot;f="Owner"===s.cellInfos.nodeModel.getParent().options.grid.role;if(1!=d.length||C||f||0!=b){if(d.length>1){var I=d.every((function(e){return"Owner"===e.getParent().options.grid.role})),y=d.every((function(e){return void 0===e.options.grid.common||e.options.grid.common}));I||y||p.push(r.getPropagateMenu(e,d,c))}}else p.push(r.getPropagateMenu(e,d,c))}f=u.indexOf("Owner")>=0;(1==d.length&&(!f||u.length>1)||d.length>1)&&p.push(r.getRemoveMenu(e,s,c)),o(p)}))}))},getCoownerMenu:function(e,t,s){var n={type:"CheckItem",title:o.team.menu.coowner,id:"coOwners",action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){s.role="Coowner",e.updatePersonRole(t.cellInfos,s)}))}}};return"DISCONNECT"==s.Coowner&&(n.state="selected"),n},getContributorMenu:function(e,t,s){var n={type:"CheckItem",title:o.team.menu.contributor,id:"contributor",action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){s.role="Contributor",e.updatePersonRole(t.cellInfos,s)}))}}};return"DISCONNECT"==s.Contributor&&(n.state="selected"),n},getAssigneeMenu:function(e,t,s){var n={type:"CheckItem",title:o.team.menu.assignee,id:"assignees",action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){s.role="Assignee",e.updatePersonRole(t.cellInfos,s)}))}}};return"DISCONNECT"==s.Assignee&&(n.state="selected"),n},getInformedUserMenu:function(e,t,s){var n={type:"CheckItem",title:o.team.menu.informedUser,id:"informedUser",action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){s.role="InformedUser",e.updatePersonRole(t.cellInfos,s)}))}}};return"DISCONNECT"==s.InformedUser&&(n.state="selected"),n},getRemoveMenu:function(e,t,s){var n={type:"PushItem",title:o.team.menu.remove,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){s.role=[],s.role.push("Contributor"),s.role.push("Coowner"),s.role.push("Assignee"),s.role.push("InformedUser"),s.Coowner="DISCONNECT",s.Assignee="DISCONNECT",s.Contributor="DISCONNECT",s.InformedUser="DISCONNECT",s.showConfirmation=!0,s.remove=!0,e.updatePersonRole(t.cellInfos,s)}))}}};try{var r=i.get("component").getCurrentView();a.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:r,pd3:"MembersActions",pd4:"Remove",pd5:"Issue/"+r+"/MembersActions/Remove"}}),a.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersActions"}})}catch(e){}return n},getViewProfileMenu:function(e,s,n){return{type:"PushItem",title:o.team.menu.profile,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye"},action:{callback:function(){t.getUserProfile(s.cellInfos.nodeModel.options.grid.user)}}}},getPropagateMenu:function(e,t,s){return{type:"PushItem",title:o.team.menu.propagate,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-propagate"},action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){e.propagateMember(t)}))}}}},getChangeOwnerMenu:function(e,t,s,n){return{type:"PushItem",title:o.team.menu.changeOwner,id:"changeOwner",fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-user-change"},action:{callback:function(){require(["DS/IssueCommon/commands/ChangeOwner"],(function(e){(new e).execute(n)}));try{var e=i.get("component").getCurrentView();a.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"MembersActions",pd4:"ChangeOwner",pd5:"Issue/"+e+"/MembersActions/ChangeOwner"}}),a.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersActions"}})}catch(e){}}}}}};return r})),define("DS/IssueComponents/related/TreeListView",["UWA/Core","UWA/Class","UWA/Controls/Abstract","UWA/Class/Promise","DS/CoreEvents/Events","DS/Logger/Logger","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/Menu/Menu","DS/TreeModel/TreeDocument","DS/Tree/TreeListView","DS/LifecycleServices/LifecycleServicesSettings","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/IssueComponents/models/TreeNodeModel","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/PADUtils/PADUtilsServices","DS/PlatformAPI/PlatformAPI","DS/UIBehaviors/ContextualMenuManager","DS/WebappsUtils/WebappsUtils","DS/IssueCommon/utils/DocumentUtils","DS/IssueAttachmentManager/services/AttachmentServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y,E,S,w,T,D,A,_,O,N,R,M){"use strict";return s.extend({name:"DS/IssueComponents/related/TreeListView",_preventEvents:!1,_syncSort:!1,_logger:null})})),define("DS/IssueComponents/related/Related",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Iconbar","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/related/TreeListView","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","css!DS/IssueComponents/IssueComponents.css","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v){"use strict";return e.extend({name:"DS/IssueComponents/related/Related",tag:"div",className:"related-objects-view"})})),define("DS/IssueComponents/related/DatagridView",["UWA/Core","UWA/Class","UWA/Controls/Abstract","UWA/Class/Promise","DS/CoreEvents/Events","DS/Logger/Logger","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/PlatformAPI/PlatformAPI","DS/TreeModel/TreeDocument","DS/IssueComponents/models/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Parser","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Views","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueCommon/utils/DocumentUtils","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y,E,S,w,T,D,A,_,O){"use strict";var N={ISSUE_TYPE:"Issue",ISSUE_3D_REVIEW:"ENX3DIR_AP",ISSUEMANAGEMENT:"ENXISSU_AP",TIMEOUT_UPDATE_COLUMN_WITH:250,REVISION_TARGETS:{STABLE_LATEST:"STABLE_LATEST",RELEASE_LATEST:"RELEASE_LATEST",LATEST:"LATEST"},CATEGORY_REPORTED_AGAINST:"reportedAgainst",CATEGORY_RESOLVED_BY:"resolvedBy",CATEGORY_CONTEXTS:"contexts",CATEGORY_RESOLVED_ITEMS:"resolvedItems",CATEGORY_REPORTED_AGAINST_INSTANCE:"reportedAgainst_instance",CATEGORY_RESOLVED_BY_INSTANCE:"resolvedBy_instance",CATEGORIES:[{CATEGORY_NAME:"reportedAgainst",CATEGORY_LABEL:O.open.labels.reportedAgainst,CATEGORY_ICON:"location"},{CATEGORY_NAME:"contexts",CATEGORY_LABEL:O.open.labels.contexts,CATEGORY_ICON:"3d-object"},{CATEGORY_NAME:"resolvedItems",CATEGORY_LABEL:O.open.labels.resolvedItems,CATEGORY_ICON:"markup-review"},{CATEGORY_NAME:"resolvedBy",CATEGORY_LABEL:O.open.labels.resolvedBy,CATEGORY_ICON:"resolved-by"}],CATEGORY_NLS:{reportedAgainst:O.open.labels.reportedAgainst,resolvedBy:O.open.labels.resolvedBy,resolvedItems:O.open.labels.resolvedItems,contexts:O.open.labels.contexts},CREATE_STATE:"Create",ASSIGN_STATE:"Assign",ACTIVE_STATE:"Active",REVIEW_STATE:"Review",CLOSED_STATE:"Closed"},R=s.extend({name:"relatedcontent-datagridview",parentView:null,_logger:null,_publishSelection:!1,defaultOptions:{grid:{cellSelection:"none",cellDragEnabledFlag:!0,showRowIndexFlag:!1,showContextualMenuColumnFlag:!0,allowUnsafeHTMLContent:!0,apiVersion:2,defaultCellHeight:26,height:"100%",useAsyncPreExpand:!0,rowGroupingEnabledFlag:!1,useWidgetPreferencesFlag:!0,isEditable:!1,isSortable:!0,resize:{columns:!0},headersDimensions:{height:26},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},performances:{buildLinks:!1,enableColumnVirtualization:!0,useRequestAnimationFrameRendering:!0,preloadPool:!0},enableExpandOnDoubleClick:!0,placeholder:O.placeholder.emptyRelatedDatagridView,columns:[{text:O.resolveIssues.common,description:O.resolveIssues.propagate,dataIndex:"common",visibleFlag:!1,width:20,isDraggable:!0,ds6wIndexMapping:"ds6w:common",isOOTBColumn:!0,icon:"propagate"},{text:O.resolveIssues.label,dataIndex:"tree",alwaysVisibleFlag:!0,ds6wIndexMapping:"ds6w:label",width:200,isOOTBColumn:!0,isDraggable:!0},{text:O.create.related.treelist.occurrence,dataIndex:"occurrence",width:"auto",ds6wIndexMapping:"ds6w:occurrence",visibleFlag:!1,isOOTBColumn:!0,isDraggable:!0},{text:O.resolveIssues.type,dataIndex:"typeNLS",ds6wIndexMapping:"ds6w:type",width:150,isOOTBColumn:!0,isDraggable:!0},{text:O.resolveIssues.name,dataIndex:"name",ds6wIndexMapping:"ds6w:name",width:200,isOOTBColumn:!0,isDraggable:!0},{text:O.resolveIssues.revision,dataIndex:"revision",ds6wIndexMapping:"ds6w:revision",width:150,isDraggable:!0,className:"revisionPopup",isOOTBColumn:!0,typeRepresentation:"url"},{text:O.resolveIssues.state,dataIndex:"dispState",ds6wIndexMapping:"ds6w:status",width:150,isDraggable:!0,typeRepresentation:"tag",isOOTBColumn:!0,className:"lc-maturity-state"},{text:O.resolveIssues.isLastRevision,dataIndex:"isLastRevision",ds6wIndexMapping:"ds6w:isLastRevision",width:150,isOOTBColumn:!0,isDraggable:!0},{text:O.columns.actionsColumn,width:50,isOOTBColumn:!0,dataIndex:"ContextualMenuColumn"}]}},callbacks:{onModifyGrid:null},destroy:function(){this.dgView&&(this.dgView=null)},init:function(e,t,s,a){var o=this;f.start(o.name+" init"),o._logger=i.getLogger("DS/IssueCommon/components/IssueContextsDatagridView"),o.relatedObjects=[],o.parentView=s,o._deferred={resolve:null,reject:null},o.dgView=null,o.tooltips=[],o.timestampLastRefresh=null,o.container=e,o._dnd=a,o.custom_view_options={dgvHandle:null,ootb_columns:[],dgvDiv:null,settings:{url:v.get3DSpaceUrl(),securityContext:v.getSecurityContexts().securityContext,isNative:C.get("isNatifEnvironnement")}},o.treeDocument=new d({useAsyncPreExpand:!0,shouldAcceptDrag:function(e){return 1!=e.options.grid.isCategory},shouldBeSelected:function(e){return 1!=e.options.grid.isCategory}}),o._customizeColumnRendering(o.defaultOptions.grid.columns);var r=C.get("widget")||window.widget;o.defaultOptions.grid.identifier="ISUContentsView";var l=o.defaultOptions.grid;o.dgView=new m(l),o.dgView.treeDocument=o.treeDocument,o.dgView.custom_view_options=o.custom_view_options,o.dgView.inject(e),o.container.addClassName("issue-tree-list-view"),o.dgView.addEventListener("click",o.doOnTreeNodeClick.bind(o)),y.buildCustomViewOptions(o.dgView,o.container),y.registerCustomEventsOnDGV(o.dgView),o.dgView.getCustomViewsManager().onCustomViewsSave=function(e,t){y.applyCustomAttributes(e,t,o.custom_view_options)},o.dgView.getCellTooltip=function(e){return o.dgView.getCellDefaultTooltip(e)},o.dgView.onContextualEvent=function(t){if(t&&t.cellInfos){var s=t.cellInfos;if(-1===s.rowID&&t.collectionView){var a=document.getElementsByClassName("issue-relatedContent-dropzones dropzone-flex");return a.length>0&&(o._dnd.count=0,a[0].hide(),e&&o.container.setStyle("opacity",1)),t.collectionView.buildDefaultContextualMenu(t,{pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0})}if(s.nodeModel.options.grid.isCategory)return!1;if(s.nodeModel){var i,r=o._getTreeDocument().getSelectedNodes();r.length>1?(i=r,o._removeCategoryRootsFromSelection(i)):s.nodeModel&&(o.dgView.unselectAll(),s.nodeModel.select(),i=[s.nodeModel]);var l="blank";return i&&i.length>0&&(l="children"),o.getContextualMenu({type:l,models:i||[]})}return n.resolve()}return n.resolve()},o.dgView.onDragColumnHeader=function(e,t){console.log("inside column header"),r.setValue("dragContentColumnHeader",!0)},o.dgView.onDragStartCell=function(e,t){r.setValue("dragContentColumnHeader",!1);var s=o._getTreeDocument().getSelectedNodes();if(0===s.length)return!1;var n=y.setDroppableData(s),a={type:n.type,data:JSON.stringify(n.data)},i=n.data.data.items.length;return e.dataTransfer.setData(a.type,a.data),o._ghost&&(o._ghost.destroy(),o._ghost=null),o._ghost=y.createGhostDrag(t.nodeModel.options,i),document.body.appendChild(o._ghost),e.dataTransfer.setDragImage(o._ghost,e.offsetX,e.offsetY),!0},c.subscribe("Lifecycle.Modification",(function(e){var t=JSON.parse(e).Refresh.modified;if(Array.isArray(t)){var s=t.filter((function(e){return null!=e.policy})).map((function(e){return e}));s.length>0&&o.updateObjectNode(s),t[0].policy==N.ISSUE_TYPE&&o.dgView.getToolbar()&&o.dgView.getToolbar().getNodeModelByID("addExistingCommand")&&(1!==t.length||t[0].state!=N.ASSIGN_STATE&&t[0].state!=N.ACTIVE_STATE||r.name==N.ISSUE_3D_REVIEW||r.name==N.ISSUEMANAGEMENT?o.dgView.getToolbar().getNodeModelByID("addExistingCommand")._options.grid.data.menu.forEach((e=>{"addResolvedby"==e.id&&(e.state="disabled")})):o.dgView.getToolbar().getNodeModelByID("addExistingCommand")._options.grid.data.menu.forEach((e=>{"addResolvedby"==e.id&&(e.state="enabled")})))}})),c.subscribe("DS/Object/update",(function(e){var t=[],s=e.data.paths,n=e.data.attributes;s.forEach((function(e){t.push(e.pop())}));n=e.data.attributes;t.forEach((function(e){n[e].type==N.ISSUE_TYPE&&o.dgView.getToolbar()&&o.dgView.getToolbar().getNodeModelByID("addExistingCommand")&&n[e].state&&(1!==Object.keys(n).length||n[e].state!=N.ASSIGN_STATE&&n[e].state!=N.ACTIVE_STATE?o.dgView.getToolbar().getNodeModelByID("addExistingCommand")._options.grid.data.menu.forEach((e=>{"addResolvedby"==e.id&&(e.state="disabled")})):o.dgView.getToolbar().getNodeModelByID("addExistingCommand")._options.grid.data.menu.forEach((e=>{"addResolvedby"==e.id&&(e.state="enabled")})))}))}))},updateObjectNode:function(t){var s=this.dgView.getTreeDocument().getSelectedNodes(),n=[];t.forEach((e=>{null!=e.policy&&(e.maturity=e.policy+"."+e.state,n.push(e.maturity))}));var a={"ds6w:status":n};h.getNLSValuesPromise(a).then((a=>{if(e.is(a["ds6w:status"])){var i=Object.values(a["ds6w:status"])[0],o=n[0];s.filter((e=>t.some((t=>e.options.pid.includes(t.physicalid))))).forEach((e=>{e.updateOptions({state:o,grid:{dispState:i}})}))}}))},_removeCategoryRoots:function(){this.dgView.getTreeDocument().removeRoots()},_getCategoryRoots:function(){return this.dgView.getTreeDocument().getRoots()},_getCategoryRoot:function(e){return this._getCategoryRoots().filter((t=>{if(t.options.grid.Name===e&&1==t.options.grid.isCategory)return t}))[0]},_getTreeDocument:function(){return this.dgView.getTreeDocument()},_customizeColumnRendering:function(e){var t=this;e.forEach((function(e){switch(e.dataIndex){case"tree":default:break;case"common":e.onCellRequest=t.rendering.common.bind(t);break;case"isLastRevision":e.onCellRequest=t.rendering.isLastRevision.bind(t);break;case"revision":e.onCellRequest=t.rendering.revision.bind(t);break;case"ContextualMenuColumn":e.hasCellValue=t.rendering.contextualMenuColumn.bind(t);break;case"dispState":e.getCellClassName=t.styling.state.bind(t)}}))},rendering:{common:function(t){var s=this;f.start(s.name+" rendering common");var n="",a=null;let i="";if(t.nodeModel.options.grid.isCategory)a=e.createElement("span",{}),t.cellView.setReusableContent(a);else{var o=t.nodeModel.options.common;a=e.createElement("span",{class:"clickable-column",html:e.createElement("span",{class:n})}),o||(n="wux-ui-3ds wux-ui-3ds-propagate wux-ui-3ds-lg related-propagate",a.addContent(e.createElement("span",{class:n})),i=O.resolveIssues.tooltips.propagateTooltip,a.addEventListener("click",function(){let e=t.nodeModel.getParent().options.grid.Name;this.propagate&&this.propagate([t.nodeModel],e)}.bind(s))),t.cellView.setReusableContent(a)}a&&(a.tooltipInfos=new p({shortHelp:i,mouseRelativePosition:!1,position:"bottom"})),f.end(s.name+" rendering common")},isLastRevision:function(t){f.start(this.name+" rendering isLastRevision");var s="";let n="";""!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&null!=t.nodeModel.options.revision&&null!=t.nodeModel.options.isLastRevision&&null!=t.nodeModel.options.isLastRevision?1==t.nodeModel.options.isLastRevision?(s=e.createElement("div",{class:"isLastRevisionTrue wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"}),n=O.resolveIssues.tooltips.isLastRevision,t.cellView.setReusableContent(s)):0==t.nodeModel.options.isLastRevision&&(s=e.createElement("div",{class:"isLastRevisionFalse wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-close"}),n=O.resolveIssues.tooltips.isNotLastRevision,t.cellView.setReusableContent(s)):(s=e.createElement("div",{}),n="",t.cellView.setReusableContent(s)),s.tooltipInfos=new p({shortHelp:n,mouseRelativePosition:!1,position:"bottom"}),f.end(this.name+" rendering isLastRevision")},revision:function(t){var s="";s=e.createElement("div",{html:t.nodeModel.options.revision,class:"revisionColumn"}),null!=t.nodeModel.options.revision&&""!=t.nodeModel.options.revision&&"-"!=t.nodeModel.options.revision&&s.addEventListener("click",function(){E.showRevisionModal(t)}.bind(this)),t.cellView.setReusableContent(s)},contextualMenuColumn:function(e){let t=!0;return t=!e.nodeModel.options.grid.isCategory,t}},styling:{state:function(e){if(e.nodeModel&&e.nodeModel.options.state){var t,s;return(t=e.nodeModel.options.state)&&(s=this.styling.getAndCreateMaturityClass(t,"wux-controls-label")),s}},getAndCreateMaturityClass:function(e,t){return"lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"")},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")}},load:function(e){var t=this;return f.start(t.name+" load"),new n(((s,a)=>{if(t.dgView.getToolbar()&&t.dgView.getToolbar().getNodeModelByID("addExistingCommand")){var i=C.get("widget")||window.widget;1!==e.length||e[0].state!=N.ASSIGN_STATE&&e[0].state!=N.ACTIVE_STATE||i.name==N.ISSUE_3D_REVIEW||i.name==N.ISSUEMANAGEMENT?t.dgView.getToolbar().getNodeModelByID("addExistingCommand")._options.grid.data.menu.forEach((e=>{"addResolvedby"==e.id&&(e.state="disabled")})):t.dgView.getToolbar().getNodeModelByID("addExistingCommand")._options.grid.data.menu.forEach((e=>{"addResolvedby"==e.id&&(e.state="enabled")}))}t.isLoaded=new n((function(e,s){t._deferred.resolve=e,t._deferred.reject=s})),t.issues=e;for(let e=t.dgView.columns.length-1;e>=0;e--)t.dgView.columns[e].isOOTBColumn||t.dgView.columns.splice(e,1);1===e.length?(t.dgView.layout.setColumnVisibleFlag("common",!1),t.dgView.multiIssuesSelected=!1):e.length>1&&(t.dgView.layout.setColumnVisibleFlag("common",!0),t.dgView.multiIssuesSelected=!0),t._removeCategoryRoots();var o=t.computeRelatedObjectsCommon(N.CATEGORIES[0].CATEGORY_NAME),r=t.computeRelatedObjectsCommon(N.CATEGORIES[1].CATEGORY_NAME),l=t.computeRelatedObjectsCommon(N.CATEGORIES[2].CATEGORY_NAME),c=t.computeRelatedObjectsCommon(N.CATEGORIES[3].CATEGORY_NAME);let d=[];d.push(o),d.push(r),d.push(l),d.push(c);var u=0;if(t.timestampLastRefresh=null,o.length||r.length||l.length||c.length){t._createCategoryRoots();const e=[];for(let s=0;s<d.length;s++){let n=t.fetchRelatedObjects(d[s],!1);e.push(n),n.then((function(e){t.dgView.getTreeDocument().withTransactionUpdate((function(){u+=e.length,t.timestampLastRefresh=Math.floor(Date.now());let n=t._getCategoryRoots()[s].options.grid.Name,a=t._getCategoryRoots()[s];for(let s=0;s<e.length;s++){let i=e[s];t.relatedObjects[n].objects[i.options.id]&&(i.options.common=t.relatedObjects[n].objects[i.options.id].common),a.addChild(i),t._refreshItemCount(a,n),t.relatedObjects[n].objects[i.options.id].model=i}e.length&&a.expandAll()}),(function(){t._logger.error('An error occurred during "%s"',"load")}))}))}n.all(e).then(((e,n)=>{null!=C.get("information")&&C.get("information").customModelEvents.publish({event:"im-update-tab-count",data:{tabs:["relatedObjects"],count:[u]}}),t._deferred.resolve(),s()}))}else t._deferred.resolve(),s()}))},_createCategoryRoots:function(){let e=N.CATEGORIES;for(let s=0;s<e.length;s++){var t=new u({label:e[s].CATEGORY_LABEL+" (0)",icons:[{iconName:e[s].CATEGORY_ICON}],grid:{isCategory:!0,Name:e[s].CATEGORY_NAME}});this.dgView.getTreeDocument().addRoot(t)}},updateRelatedObjectsCommon:function(e,t){var s=this;e.forEach((function(e){e.options.common=s.relatedObjects[t].objects[e.options.id].common}))},computeRelatedObjectsCommon:function(e){var t=this,s=[];return t.issues.forEach((function(n){for(var a=t.utils.getRelatedObjects(n,e),i=0;i<a.length;i++){var o=a[i];void 0===s.find((e=>e.id==o.id))&&s.push(o)}})),t.relatedObjects[e]={},t.relatedObjects[e].objects={},s.forEach((function(s){for(var n=!0,a=0;a<t.issues.length;a++){var i=t.utils.getRelatedObjects(t.issues[a],e);if(i&&void 0===i.find((e=>e.id==s.id))){n=!1;break}}t.relatedObjects[e].objects[s.id]={},t.relatedObjects[e].objects[s.id].common=n})),s},fetch:function(e){var t=this;return f.start(t.name+" fetch"),new n((function(s,n){0!==e.length?h.fetch({data:{objects:e.map((function(e){return{physicalId:e}}))},onComplete:function(a){var i=a.body;t._logger.log("fetch :Success..."),f.end(t.name+" fetch"),i.results&&i.results.length===e.length?s(i.results):i.results&&i.results.length>0?(D.displayNotification({msg:O.resolveIssues.errorFetch,eventID:"error"}),s(i.results)):(t._logger.error("fetch :Failure... Not indexed."),n(new Error("fetch :Failure... Not indexed.")))},onFailure:function(e){t._logger.error("fetch :Failure..."),t._logger.error(e),f.end(t.name+" fetch"),n(new Error("fetch :Failure..."))}}):s([])}))},fetchRelatedObjects:function(e){for(var t=[],s=0;s<e.length;s++)for(var a=e[s].id.split(","),i=0;i<a.length;i++)0!=i&&i%2!=1&&i!=a.length-1||t.push(a[i]);var o=[...e];t=[...new Set(t)];var l=this;return new n((function(s){var n=[];r.mask(l.container),l.fetch(t).then((function(t){for(var a={},i=[],c=0;c<t.length;c++){var d=g.parseFetchResponse(t[c]);a[d.value.id]=d,""!==d.value.physicalId&&(a[d.value.physicalId]=d)}for(var m=0;m<o.length;m++){var p=e[m].id.split(","),f=p[p.length-1];if(a[f]){var h=a[f],v="";p.length>0&&(v=a[p[p.length-1]].display.title);for(var b="",C=0;C<p.length;C++)a[p[C]]&&C!=p.length-1&&(b+=a[p[C]].display.title,C!=p.length-2&&(b+=" \\ "));h.value["ds6w:policy"]&&i.push(h.value["ds6w:policy"]);var I="3dspace"===e[m].serviceId.toLowerCase()?"LEGACY_3DSPACE":"CSD",y=new u({id:e[m].id,pid:h.value.physicalId,name:h.value.name?h.value.name:"",title:v,type:h.value.type,dispTypeValue:h.display.type,revision:h.value.revision,label:v,icons:[h.value.typeIcon],isLastRevision:h.value.isLastRevision,common:true,state:h.value.state,serviceId:e[m].serviceId,elementType:I,kind:h.value["ds6w:kind"],grid:{name:h.display.name?h.display.name:"",type:h.value.type,typeNLS:h.display.type,revision:h.display.revision,dispState:h.display.state,id:f,interfaces:h.value.interface,occurrence:b,sourceType:I}});n.push(y)}}i.length>0&&(i=[...new Set(i)],l.setClassContentType({policies:i})),r.unmask(l.container),s(n)}),(function(){D.displayNotification({msg:O.resolveIssues.errorFetch,eventID:"error"}),r.unmask(l.container),l._deferred.reject()}))}))},addObjects:function(e,t,s){var n=this;f.start(n.name+" addObjects");var a=[].concat(e);a&&a.length&&a.forEach((function(e){for(var t=0,s=0;s<a.length;s++){e===a[s]&&t++,t>1&&(a.splice(s,1),s--,n._logger.log("remove the same id from object-id list"))}})),n.addRelatedObjects(a,t,s),f.end(n.name+" addObjects")},addRelatedObjects:function(e,t,s){var n=this,a=[],i=[],o=!1;if(t!=N.CATEGORY_REPORTED_AGAINST)for(var r=0;r<e.length;r++){var l=e[r].id.split(",");e[r].id=l[l.length-1]}for(var c=function(e,t){for(var s=[].concat(t),n=0;n<e.length;n++)for(var a=e[n],i=0;i<s.length;i++)if(a.id===s[i].id){s.splice(i,1);break}return s},d=0;d<n.issues.length;d++){var u={physicalId:n.issues[d].id};u[t]={};var m=[].concat(e);if(t==N.CATEGORY_RESOLVED_BY){var p=m.map((function(e){return e.id})).indexOf(u.physicalId);if(p>-1&&m.splice(p,1),0==m.length){o=!0,D.displayNotification({msg:O.resolveIssues.errorSameIssue,eventID:"error"});continue}e=m}if((m=c(n.utils.getRelatedObjects(n.issues[d],t),m)).length>0){u[t]=m.map((function(e){var t=[];e.id.contains(",")?t=e.id.split(","):t.push(e.id);var n={physicalId:t[t.length-1],path:t,envId:v.getTenant(),serviceId:e.serviceId,objectType:e.objectType};if(s)for(var a=0;a<s.length;a++)s[a].id===e.id&&(n.position=s[a],n.position.id=t[t.length-1]);return n})),a.push(u);var f={id:n.issues[d].id,issue:n.issues[d]};i.push(f)}}if(a.length>0){var g=n.timestampLastRefresh;n.updateIssues(a).then((function(s){n.fetchRelatedObjects(e,!0).then((function(e){n.timestampLastRefresh===g&&(0==n._getCategoryRoots().length&&n._createCategoryRoots(),n.dgView.getTreeDocument().withTransactionUpdate((function(){let a=n._getCategoryRoot(s.category),i=a.getChildren();var o=[],r=[],l="",c="";s.result.forEach((t=>{t.body&&t.body.responce&&t.body.responce.forEach((t=>{t.warning.length>2?(e=e.filter((e=>!(e.options.id==t.physicalId.slice(1,-1)))),o.push(t.warning.slice(1,-1))):t.error.length>2&&(e=e.filter((e=>!(e.options.id==t.physicalId.slice(1,-1)))),r.push(t.error.slice(1,-1)))}))}));for(let o=0;o<e.length;o++){let r=e[o],l=-1;n.relatedObjects[s.category].objects[r.options.id]&&n.relatedObjects[s.category].objects[r.options.id].model&&(l=i.indexOf(n.relatedObjects[s.category].objects[r.options.id].model)),-1!==l?(i.splice(l,1),n._getCategoryRoot(t).addChild(r,l)):(a.addChild(r,0),n._refreshItemCount(a,s.category)),n.relatedObjects[s.category].objects[r.options.id]={},n.relatedObjects[s.category].objects[r.options.id].model=r,n.relatedObjects[s.category].objects[r.options.id].common=!0;for(var d=0;d<n.issues.length;d++){var u=n.utils.getRelatedObjects(n.issues[d],s.category);-1===u.indexOf(r.options.id)&&u.push({id:r.options.id,serviceId:r.options.serviceId})}}e.length&&a.expandAll(),o=new Set(o),r=new Set(r),o.forEach((e=>{l+=e})),r.forEach((e=>{c+=e})),l.length>0&&0==e.length?D.displayNotification({msg:l,eventID:"warning"}):c.length>0&&0==e.length?D.displayNotification({msg:c,eventID:"error"}):(l.length>0||c.length>0)&&e.length>0?1==n.issues.length?D.displayNotification({msg:O.successPartial,eventID:"warning"}):D.displayNotification({msg:O.replace(O.resolveIssues.attachSuccessMultiple[s.category],{count:e.length}),eventID:"success"}):1==n.issues.length?D.displayNotification({msg:O.replace(O.resolveIssues.attachSuccess[s.category],{count:e.length,issue:n.issues[0].title+" ("+n.issues[0].name+")"}),eventID:"success"}):D.displayNotification({msg:O.replace(O.resolveIssues.attachSuccessMultiple[s.category],{count:e.length}),eventID:"success"})}),(function(){n._logger.error('An error occurred during "%s"',"add child")})),n.dispatchEvent("onUpdate",{issues:i,relation:s.category}))}))}),(function(){}))}else o||D.displayNotification({msg:O.resolveIssues.nothingToAdd,eventID:"info"})},updateIssues:function(t,s){var a=this;return f.start(a.name+" updateIssues"),t.forEach((e=>{Array.isArray(e.reportedAgainst)&&e.reportedAgainst.forEach((e=>{if(!("path"in e)){var t=e.physicalId,s=(t=t.split(","))[t.length-1];e.physicalId=s+"",e.path=t}}))})),new n((function(n,i){r.mask(a.container);var o=s?"delete":"update";h.related[o]({data:{objects:t},onComplete:function(e){r.unmask(a.container);var s={};let i="";Object.keys(t[0]).includes(N.CATEGORY_REPORTED_AGAINST)?i=N.CATEGORY_REPORTED_AGAINST:Object.keys(t[0]).includes(N.CATEGORY_RESOLVED_BY)?i=N.CATEGORY_RESOLVED_BY:Object.keys(t[0]).includes(N.CATEGORY_RESOLVED_ITEMS)?i=N.CATEGORY_RESOLVED_ITEMS:Object.keys(t[0]).includes(N.CATEGORY_CONTEXTS)&&(i=N.CATEGORY_CONTEXTS),s.result=e.results,s.category=i,a.dispatchEvent("onUpdateComplete"),n(s)},onFailure:function(t){a._logger.error(t),e.is(t.error)&&e.is(t.error.internal)&&"'business object' does not exist"==t.error.internal?E.displayErrorMessage(E.getErrorMessage("0"),"error"):e.is(t.error)&&e.is(t.error.internal)&&t.error.internal.includes("ErrorCode:2005")?E.displayErrorMessage(E.getErrorMessage("2005"),"error"):e.is(t.error)&&e.is(t.error.internal)&&(t.error.internal.includes("No fromdisconnect access to object")||t.error.internal.includes("User should be Owner or Co-owner or Assignee for this operation")||t.error.internal.includes("If the issue is open, your responsibility does not permit you to add Reported Against, Contexts or Resolved by. If the issue is closed, related objects or contexts cannot be added"))?E.displayErrorMessage(E.getErrorMessage("10"),"error"):D.displayNotification({msg:t.error.message,eventID:"error"}),r.unmask(a.container),a.dispatchEvent("onUpdateFailure"),a.parentView&&a.parentView.refresh(),i(new Error("Failed to update issues..."))}})}))},_refreshItemCount:function(e,t){let s=null!==e.getChildren()?e.getChildren().length:0;e.setLabel(N.CATEGORY_NLS[t]+" ("+s+")")},getContextualMenu:function(e){var t=this;f.start(t.name+" getContextualMenu");var s=[],a=e.models,i=null,o=null,r=null,l=null,c=null,d=null,u=null,m=null,p=null;t.isI3dxPresent=y.isI3dxInSelectedNodes(a);var g=new n((function(e){i={name:"Remove",title:O.resolveIssues.contextualMenus.remove,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},data:a,action:{callback:function(e){t.dgView.getTreeDocument().withTransactionUpdate((function(){let s=t.extractCategoryObjects(e.context);t.removeRelatedObjects(s)}),(function(){t._logger.error('An error occurred during "%s"',"removeCommand")}))},context:a}},o={title:O.resolveIssues.contextualMenus.propagate,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-propagate"},data:a,action:{callback:function(e){t.propagate(e.context)},context:a}},r={name:"Maturity State",title:O.resolveIssues.contextualMenus.maturity,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:a,action:{callback:function(e){require(["DS/IssueComponents/external/CollaborativeLifecycle"],(function(t){for(var s=[],n=e.context,a=0;a<n.length;a++)s.push(n[a].options.pid);t.execute(s);try{var i=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentActions",pd4:"Maturity",pd5:"Issue/"+i+"/ContentActions/Maturity"}})}catch(e){}}))},context:a}},l={name:"Compare",title:O.resolveIssues.contextualMenus.compare,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compare-on"},data:a,action:{callback:function(e){require(["DS/IssueComponents/external/Compare"],(function(t){for(var s=[],n=e.context,a=0;a<n.length;a++)s.push({physicalId:n[a].options.pid,type:n[a].options.type});t.execute(s);try{var i=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentActions",pd4:"Compare",pd5:"Issue/"+i+"/ContentActions/Compare"}})}catch(e){}}))},context:a}},c={name:"WhereUsed",title:O.resolveIssues.contextualMenus.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:a,action:{callback:function(e){require(["DS/IssueComponents/external/RelationalExplorer"],(function(t){for(var s=[],n=e.context,a=0;a<n.length;a++)s.push({id:n[a].options.pid,serviceId:n[a].options.serviceId});t.execute(s);try{var i=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentActions",pd4:"Relations",pd5:"Issue/"+i+"/ContentActions/Relations"}})}catch(e){}}))},context:a}},d={name:"ReplaceByLatestRevision",title:O.resolveIssues.contextualMenus.replaceByLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-3"},data:a,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,N.REVISION_TARGETS.LATEST);try{var n=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:n,pd3:"ContentActions",pd4:"ReplaceByLatestRevision",pd5:"Issue/"+n+"/ContentActions/ReplaceByLatestRevision"}})}catch(e){}},context:a}},u={name:"ReplaceByReleasedLatestRevision",title:O.resolveIssues.contextualMenus.replaceByReleasedLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-1"},data:a,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,N.REVISION_TARGETS.RELEASE_LATEST);try{var n=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:n,pd3:"ContentActions",pd4:"ReplaceByReleasedLatestRevision",pd5:"Issue/"+n+"/ContentActions/ReplaceByReleasedLatestRevision"}})}catch(e){}},context:a}},m={name:"ReplaceByStableLatestRevision",title:O.resolveIssues.contextualMenus.replaceByStableLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-2"},data:a,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,N.REVISION_TARGETS.STABLE_LATEST);try{var n=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:n,pd3:"ContentActions",pd4:"ReplaceByStableLatestRevision",pd5:"Issue/"+n+"/ContentActions/ReplaceByStableLatestRevision"}})}catch(e){}},context:a}},p={name:"information",title:O.resolveIssues.contextualMenus.information,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-info-open-in-a-new-window"},data:null,action:{callback:function(){E.viewProperties(a[0].options.pid,a[0].options.serviceId);try{var e=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"ContentActions",pd4:"Information",pd5:"Issue/"+e+"/ContentActions/Information"}})}catch(e){}}}},e()}));if(1===a.length&&"Document"===a[0].options.type){var h=null,v=null,I=null,w=null,T=null;g=g.then((function(){return b.getDocuments([a[0].options.id]).then((function(e){h=e.data[0]}))})).then((function(){var e={data:h,from:"related"},s=[];s.push(a[0].options);var n={data:h,from:"related",menu:t,selected:s};v={name:"Preview",title:O.resolveIssues.contextualMenus.preview,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-eye"},data:null,action:{callback:function(){S.preview(n)}}},""===h.relateddata.files[0].dataelements.locker?I={name:"Edit",title:O.resolveIssues.contextualMenus.edit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-pencil"},data:null,action:{callback:function(){S.edit(e)}}}:(w={name:"UndoEdit",title:O.resolveIssues.contextualMenus.undoEdit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-undo"},data:null,action:{callback:function(){S.undoEdit(e)}}},T={name:"Update",title:O.resolveIssues.contextualMenus.update,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-upload"},data:null,action:{callback:function(){S.update(e)}}})}))}if(a.every((e=>"Document"==e.options.type))){for(var D=null,A=[],_=0;_<a.length;_++)A.push(a[_].options);var R={from:"related",menu:t,selected:A};D={name:"Download",title:O.resolveIssues.contextualMenus.download,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"},data:null,action:{callback:function(){S.download(R)}}}}return g=g.then((function(){return t._getOpenWithMenu(e).then((function(n){if(s=s.concat(n),"children"===e.type){if(s.push({type:"SeparatorItem"}),1===e.models.length&&"Document"===e.models[0].options.type&&(v&&(s.push(v),s.push({type:"SeparatorItem"})),null!==I&&s.push(I),null!==w&&s.push(w),null!==T&&s.push(T)),e.models[0].options.type!==N.ISSUE_TYPE&&!t.isI3dxPresent){var g=[],h={name:"ReplaceByRevision",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-replace-by-existing"},title:O.resolveIssues.contextualMenus.replaceByRevision,submenu:g};g.push(u),g.push(m),g.push(d),s.push(h)}s.push({type:"SeparatorItem"}),t.isI3dxPresent||s.push(r),e.models.length<=2&&(t.isI3dxPresent||s.push(l)),s.push({type:"SeparatorItem"}),e.models.every((e=>"Document"==e.options.type))&&null!==D&&s.push(D),t.isI3dxPresent||s.push(c),1===a.length&&(t.isI3dxPresent||s.push(p)),s.push(i);for(var b=0;b<e.models.length;b++)if(!e.models[b].options.common){s.push(o);break}}return f.end(t.name+" getContextualMenu"),s}))})),g},_getOpenWithMenu:function(t){try{C.get("component").getCurrentView()}catch(e){}finally{f.start(name+" getMenu");var s=[],a=t.models||[];return 0===a.length||"blank"===t.type?n.resolve([]):new n((function(t){f.start(name+" getOpenWithMenu");var n=[],i=[],o=[N.ISSUE_TYPE];h.type.getSubType().then((r=>{var l=r;null!=l&&Object.keys(l).length>1&&(o=Object.keys(l));for(var c=0;c<a.length;c++){var d=a[c],u=[];u.push(d.options.type),d.options.kind&&""!=d.options.kind&&u.push(d.options.kind),o.includes(d.options.type)||(i.push(d.options.type),n.push({envId:v.getTenant(),serviceId:d.options.serviceId?d.options.serviceId:"3DSpace",objectId:d.options.pid,objectType:d.options.type,objectTaxonomies:u,displayName:d.options.title?d.options.title:d.options.name,i3dx:d.options.pid.includes("i3dx")?d.options.pid:""})),o.includes(d.options.type)&&(d.options.children?d.options.children.forEach((function(e){var t=[];t.push(e.options.type),e.options.kind&&""!=e.options.kind&&t.push(e.options.kind),i.push(e.options.type),n.push({envId:v.getTenant(),serviceId:e.options.serviceId?e.options.serviceId:"3DSpace",objectId:e.options.pid,objectType:e.options.type,objectTaxonomies:t,displayName:e.options.title?e.options.title:e.options.name})})):(i.push(d.options.type),n.push({envId:v.getTenant(),serviceId:d.options.serviceId?d.options.serviceId:"3DSpace",objectId:d.options.id,objectType:d.options.type,objectTaxonomies:u,displayName:d.options.title?d.options.title:d.options.name})))}h.getTypesHierarchy({types:i,onComplete:function(a){if(e.is(a.types_hierarchies,"array")&&a.types_hierarchies.forEach((function(e,t){n.forEach((function(t,s){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))}))})),0===n.length)return f.end(name+" getOpenWithMenu"),void t(s);C.get("widget")||window.widget;I.getOpenWith().set3DXContent(y.buildDnDPayload({items:n}),!0).retrieveCompatibleApps((function(e){if(e&&e.length>0){var n=[],a=[];if(e.forEach((function(e){a={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:e.handler}},null!=e.fonticon?a.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:e.className&&1==e.className.contains("app-widget")?a.icon={iconPath:e.icon,className:"issue-widget"}:a.icon=e.icon,n.push(a)})),n.length>0){var i={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot"},title:O.resolveIssues.contextualMenus.openWith,submenu:n};s.push(i),s.push({type:"SeparatorItem"})}}t(s)})),f.end(name+" getOpenWithMenu")},onFailure:function(e){t(s)}})})).catch((()=>{}))}))}},extractCategoryObjects:function(e){let t=[],s=[],n=[],a=[];for(let i=0;i<e.length;i++)if(!e[i].options.grid.isCategory){switch(e[i].getParent().options.grid.Name){case N.CATEGORY_REPORTED_AGAINST:t.push(e[i]);break;case N.CATEGORY_RESOLVED_BY:s.push(e[i]);break;case N.CATEGORY_RESOLVED_ITEMS:n.push(e[i]);break;case N.CATEGORY_CONTEXTS:a.push(e[i])}}let i=[];return t.length&&i.push({category:N.CATEGORY_REPORTED_AGAINST,objs:t}),s.length&&i.push({category:N.CATEGORY_RESOLVED_BY,objs:s}),n.length&&i.push({category:N.CATEGORY_RESOLVED_ITEMS,objs:n}),a.length&&i.push({category:N.CATEGORY_CONTEXTS,objs:a}),i},removeRelatedObjects:function(e){for(var t=this,s=[],a=[],i=function(e,t){for(var s=[].concat(t),n=0;n<s.length;n++){var a=s[n];-1===e.map((function(e){return e.id})).indexOf(a)&&(s.splice(n,1),n--)}return s},o=0;o<t.issues.length;o++)for(let n=0;n<e.length;n++){var r={physicalId:t.issues[o].id};let d=e[n].category,u=e[n].objs,m=[];u.forEach((function(e){m.push(e.options.id)})),r[d]={};var l=[].concat(m);(l=i(t.utils.getRelatedObjects(t.issues[o],d),l)).length>0&&(r[d]=l.map((function(e){return{physicalId:e}}))),s.push(r);var c={id:t.issues[o].id,issue:t.issues[o]};a.push(c)}if(s.length>0){var d=t.timestampLastRefresh,u=[];t.confirmDetach(e).then((function(){for(let e=0;e<s.length;e++)u.push(t.updateIssues([s[e]],!0));n.all(u).then((function(s){s.forEach((s=>{var n=s.category;t.timestampLastRefresh===d&&t.dgView.getTreeDocument().withTransactionUpdate((function(){let s=[];for(let t=0;t<e.length;t++)e[t].category==n&&(s=e[t].objs);for(var a=0;a<s.length;a++){var i=s[a];i.remove(),t.relatedObjects[n].objects[i.options.id]=null,delete t.relatedObjects[n].objects[i.options.id];for(var o=0;o<t.issues.length;o++){var r=t.utils.getRelatedObjects(t.issues[o],n),l=r.map((function(e){return e.id})).indexOf(i.options.id);l>-1&&r.splice(l,1)}let e=t._getCategoryRoot(n);t._refreshItemCount(e,n)}D.displayNotification({msg:O.resolveIssues.successResolved,eventID:"success"})}),(function(){t._logger.error('An error occurred during "%s"',"remove child")}))})),t.dispatchEvent("onUpdate",{issues:a})}))}),(function(){t._logger.log('User cancel the operation. "%s"',"Detach related objects")}))}},_removeCategoryRootsFromSelection:function(e){for(let t=0;t<e.length;t++)e[t].options.grid.isCategory&&(e.splice(t,1),t--)},confirmDetach:function(e){for(var t=[],s=0;s<e.length;s++){e[s].objs.forEach((function(e){var s=e.options.title;s=e.options.name?s+" ("+e.options.name+")":s,t.push(s)}))}return this._showConfirm(t,O.resolveIssues.confirmDialog.confirmDetach,O.resolveIssues.confirmDialog.detachTitle)},_showConfirm:function(t,s,a){var i=this,r=C.get("widget")||window.widget,c=t,d=[];c.forEach((function(t){d.push(e.createElement("li",{html:t,title:t}))}));var u=e.createElement("div",{html:[s,e.createElement("ul",{class:"related-confirm-dialog-ul",html:d})]}),m=O.replace(a,{number:c.length,issues:i.issues.length});return new n((function(e,t){var s,n=i.dialog=new T({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"related-confirm-dialog",title:m,header:null,body:u,footer:[s=new o({value:O.resolveIssues.okButton,className:"primary related-confirm-dialog-ok",events:{onClick:function(){n.destroy(),i.dialog=null,e()}}}),new o({value:O.resolveIssues.cancel,className:"default related-confirm-dialog-cancel",events:{onClick:function(){n.destroy(),i.dialog=null,t(new Error("The dialog has been closed by the end user"))}}})],events:{onClose:function(){n.destroy(),i.dialog=null,t(new Error("The dialog has been closed by the end user"))}}}).inject(r.body);new l({element:u}).inject(n.getBody()),n.show(),s.focus()}))},propagate:function(e,t){var s=this;s.confirmPropagate(e,t).then((function(){s.extractCategoryObjects(e).forEach((e=>{for(var t=[],n=0;n<e.objs.length;n++)t.push({id:e.objs[n].options.id,serviceId:e.objs[n].options.serviceId,objectType:e.objs[n].options.type});s.addRelatedObjects(t,e.category);try{var a="";N.CATEGORY_REPORTED_AGAINST===e.category&&(a="PropogateAffectedItems"),N.CATEGORY_RESOLVED_BY===e.category&&(a="PropogateResolvedBy"),N.CATEGORY_CONTEXTS===e.category&&(a="PropogateContexts"),N.CATEGORY_RESOLVED_ITEMS===e.category&&(a="PropogateResolvedItems");var i=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentActions",pd4:a,pd5:"Issue/"+i+"/ContentActions/"+a}})}catch(e){}}))}),(function(){s._logger.log('User cancel the operation. "%s"',"Propagate related objects")}))},confirmPropagate:function(e,t){for(var s=[],n=0;n<e.length;n++){var a=e[n],i=a.options.title;i=a.options.name?i+" ("+a.options.name+")":i,s.push(i)}return this._showConfirm(s,O.resolveIssues.confirmDialog.confirmPropagate,O.resolveIssues.confirmDialog.propagateTitle)},replaceByRevision:function(e,t){var s=this;let n=[],a=[];e.forEach((e=>{n.indexOf(e.category)&&n.push(e.category),a.push(...e.objs)})),s.getRevisions(a).then((function(a){var i=[],o=[];a.forEach((function(e){(e.targetModel.getParent().options.grid.isCategory&&(e.category=e.targetModel.getParent().options.grid.Name),null!==e[t])&&((e[t].contents?e[t].contents[0].id:e[t].id)!==e.pid&&(i.push(e),o.push(e)))}));var r={issuesToAdd:[],issuesToRemove:[]},l=[],c=[];for(let n=0;n<s.issues.length;n++)for(let a=0;a<e.length;a++){let o=e[a].category;var d={physicalId:s.issues[n].id};d[o]=[];var u={physicalId:s.issues[n].id};if(u[o]=[],i.forEach((function(e){var a=s.utils.getRelatedObjects(s.issues[n],o).map((function(e){return e.id})).indexOf(e.id);e[t]&&a>-1&&(-1===u[o].indexOf(e.id)&&u[o].push({physicalId:e.id}),-1===d[o].indexOf(e[t].id)&&(d[o].push({physicalId:e[t].contents?e[t].contents[0].id:e[t].id,envId:v.getTenant(),objectType:e[t].contents?e[t].contents[0].type:e[t].type,serviceId:e.targetModel.options.serviceId}),-1===c.indexOf(e[t].id)&&c.push({id:e[t].id,serviceId:e.targetModel.options.serviceId})))})),u[o].length>0||d[o].length>0){r.issuesToAdd.push(d),r.issuesToRemove.push(u);var m={id:s.issues[n].id,issue:s.issues[n]};l.push(m)}}if(r.issuesToAdd.length>0||r.issuesToRemove.length>0){var p=s.timestampLastRefresh;s.confirmReplaceByRevision(o,t).then((function(){s.updateIssues(r.issuesToAdd,!1).then((function(){s.updateIssues(r.issuesToRemove,!0).then((function(){s.fetchRelatedObjects(c,!0).then((function(e){var a={};e.forEach((function(e){a[e.options.id]=e})),s.timestampLastRefresh===p&&(s._getTreeDocument().withTransactionUpdate((function(){n.forEach((n=>{let o=s._getCategoryRoot(n),r=o.getChildren(),l=r.map((e=>e.options.id));i.forEach((function(e){var i=r.indexOf(e.targetModel);if(i>-1){e.targetModel.remove();var c=a[e[t].id];c&&(-1==l.indexOf(c.options.id)&&o.addChild(c,i),a[e[t].id]=null)}s.issues.forEach((function(a){var i=s.utils.getRelatedObjects(a,n),o=i.map((function(e){return e.id})).indexOf(e.id);o>-1&&(i.splice(o,1),i.map((function(e){return e.id})).indexOf(e[t].id)>-1||i.splice(o,0,{id:e[t].id,serviceId:e.targetModel.options.serviceId}))}))})),s.computeRelatedObjectsCommon(n),s.updateRelatedObjectsCommon(o.getChildren(),n),e.length&&o.expandAll(),D.displayNotification({msg:O.resolveIssues.successResolved,eventID:"success"})}))}),(function(){s._logger.error('An error occurred during "%s"',"add child")})),s.dispatchEvent("onUpdate",{issues:l}))}))}),(function(){s._logger.error('An error occurred during "%s"',"removing in replace revision in withTransactionUpdate")}))}),(function(){s._logger.error('An error occurred during "%s"',"adding in replace revision in withTransactionUpdate")}))}),(function(){s._logger.log('User cancel the operation. "%s"',"replace revision")}))}else D.displayNotification({msg:O.resolveIssues.nothingToReplace,eventID:"info"})}),(function(){}))},getRevisions:function(e){var t=this;return f.start(t.name+" getRevisions"),new n((function(s,n){if(e&&0!==e.length){var a={graphRequests:[]},i=[];e.forEach((function(e){i.push(e.options.pid)})),(i=[...new Set(i)]).forEach((function(e){a.graphRequests.push({id:e})})),h.getRevisions({data:a,onComplete:function(n){var a=n.body;t._logger.log("getRevisions :Success...");var i=[];e.forEach((function(e){for(var s=null,n=null,o=null,r=null,l=null,c=a.graphs,d=0;d<c.length;d++){var u=c[d];if(u.versions)for(var m=0;m<u.versions.length;m++){var p=u.versions[m].contents?u.versions[m].contents[0].id:u.versions[m].id;if(e.options.pid===p){s=u.versions;break}}if(s)break}if(s){for(var f=0;f<s.length;f++)if(s[f].isLastVersion){n=s[f];break}for(var g=s.length-1;g>=0;g--)if("RELEASED"===s[g].maturity){l=s[g];break}for(var h=s.length-1;h>=0;h--)if("RELEASED"===s[h].maturity||"FROZEN"===s[h].maturity){r=s[h];break}for(var v=0;v<s.length;v++){if((s[v].contents?s[v].contents[0].id:s[v].id)===e.options.pid){o=s[v];break}}}else t._logger.log("getRevisions :no revision -> "+e.options.pid);var b={id:e.options.id,pid:e.options.pid,targetModel:e,revisionFamily:s,CURRENT:o,STABLE_LATEST:r,RELEASE_LATEST:l,LATEST:n};i.push(b)})),f.end(t.name+" getRevisions"),s(i)},onFailure:function(e){t._logger.error("getRevisions :Failure..."),t._logger.error(e),D.displayNotification({msg:O.resolveIssues.errorResolved,eventID:"error"}),f.end(t.name+" getRevisions"),n(e)}})}else s([])}))},confirmReplaceByRevision:function(e,t){var s=O.resolveIssues.confirmDialog.replaceByLatestRevisionTitle,n=O.resolveIssues.confirmDialog.confirmReplaceByLatestRevision;t===N.REVISION_TARGETS.RELEASE_LATEST?(s=O.resolveIssues.confirmDialog.replaceByReleasedLatestRevisionTitle,n=O.resolveIssues.confirmDialog.confirmReplaceByReleasedLatestRevision):t===N.REVISION_TARGETS.STABLE_LATEST&&(s=O.resolveIssues.confirmDialog.replaceByStableLatestRevisionTitle,n=O.resolveIssues.confirmDialog.confirmReplaceByStableLatestRevision);for(var a=[],i=0;i<e.length;i++){var o=e[i].targetModel;s=o.options.title;s=o.options.name?s+" ("+o.options.name+")":s;var r=O.replace(O.resolveIssues.confirmDialog.confirmReplaceByTitleMessage,{target:s+o.options.revision,latest:e[i][t].code});a.push(r)}return this._showConfirm(a,n,s)},setClassContentType:function(e){var t={data:e};return new n((function(e,s){h.issues.getStatesAttributes(t).then((function(t){E.addCSSMaturityClasses("wux-controls-label",t),e()}))})).catch((function(e){return e}))},utils:{_debounceTimeouts:[],debounce:function(e,t,s){var n,a=this;return function(){var i=this,o=arguments,r=s&&!n;clearTimeout(n);var l=a._debounceTimeouts.indexOf(n);-1!==l&&a._debounceTimeouts.splice(l,1),n=setTimeout((function(){n=null,s||e.apply(i,o)}),t),a._debounceTimeouts.push(n),r&&e.apply(i,o)}},getRelatedObjects:function(e,t){return e.relatedObjects[t]},sortJudgment:function(e,t){return(e=e||"")<(t=t||"")?-1:e>t?1:0}},doOnTreeNodeClick:function(){for(var e=this._getTreeDocument().getSelectedNodes(),t=[],s=[],n=0;n<e.length;n++){var a=e[n];t.push([a.options.id]),s[a.options.id]={id:a.options.id,type:a.options.type,name:a.options.name,label:a.options.title}}var i={paths:[],attributes:[]};i.paths=t,i.attributes=s,widget&&widget.data&&("ENX3DIR_AP"===widget.data.appId||"ENXISSU_AP"===widget.data.appId)&&E.publishSelectAll(i)}});return R})),define("DS/IssueComponents/related/RelatedContent",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Utils","DS/IssueCommon/facets/Placeholder","DS/IssueComponents/utils/Utils","DS/IssueComponents/related/DatagridView","DS/IssueComponents/related/RelatedContentActionBar","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/Utilities/Dom","css!DS/IssueComponents/IssueComponents.css","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v){"use strict";var b={ISSUE_TYPE:"Issue",CATEGORY_REPORTED_AGAINST:"reportedAgainst",CATEGORY_RESOLVED_BY:"resolvedBy",CATEGORY_CONTEXTS:"contexts",CATEGORY_RESOLVED_ITEMS:"resolvedItems",CATEGORY_REPORTED_AGAINST_INSTANCE:"reportedAgainst_instance",CATEGORY_RESOLVED_BY_INSTANCE:"resolvedBy_instance",CATEGORY_NLS:{reportedAgainst:"Affected Items",resolvedBy:"Resolvedby",contexts:"Contexts",resolvedItems:"Resolved Items"},CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT:["resolvedBy"],ISSUE_3D_REVIEW:"ENX3DIR_AP"},C={actual:null,count:0};return e.extend({name:"DS/IssueComponents/related/RelatedContent",tag:"div",className:"relatedContent-objects-view",_deferred:{resolve:null,reject:null},setup:function(e){var t=this;p.start(t.name+" setup"),t._logger=n.getLogger(t.name),t._logger.log("Initializing related"),this._parent(e),t.options.ids=e.ids,t.issues={},t.views={},t.views.relatedContent={},t.grids={},t.isLoaded=null,p.end(t.name+" setup")},render:function(){var e=this;return e.build(),e.load(e.options.ids),p.end(e.name+" init"),e},build:function(){var e=this;p.start(e.name+" build"),e.views.main=s.createElement("div",{styles:{width:"100%",height:"100%",display:"inline-block"},class:"relatedContent-objects-view-main",html:e.createRelatedContent()}),e.views.main.inject(e.container),e.isValidSelection()?(e.placeholder.hide(e.container),e.views.main.show()):(e.views.main.hide(),e.placeholder.show(e.container)),e.grids.relatedContent=new l(e.views.relatedContent.dgView,b.CATEGORY_CONTEXTS,void 0,C),c.toolbar=e.grids.relatedContent.dgView.setToolbar(c.writetoolbarDefination(e.options)),c.toolbar.onToolbarClickCallback=this.onToolbarClickCallback.bind(e),c.toolbar.inject(e.views.relatedContent.relatedContentHeader),e.toolbar=c.toolbar;var t=JSON.parse(c.writetoolbarDefination());t.entries.forEach((function(t){switch(t.id){case"addExistingCommand":r.updateTooltip(t.children,e.toolbar),t.children.forEach((t=>{"addResolvedby"==t.id&&r.updateTooltip(t.children,e.toolbar)}));break;case"pickCommand":r.updateTooltip(t.children,e.toolbar)}})),r.updateTooltip(t.entries,e.toolbar),e._addDropEvent(e.views.relatedContent.droppable);for(var n=[{id:b.CATEGORY_REPORTED_AGAINST,icon:"location",title:h.open.labels.reportedAgainst},{id:b.CATEGORY_CONTEXTS,icon:"3d-object",title:h.open.labels.contexts},{id:b.CATEGORY_RESOLVED_ITEMS,icon:"markup-review",title:h.open.labels.resolvedItems},{id:b.CATEGORY_RESOLVED_BY,icon:"resolved-by",title:h.open.labels.resolvedBy}],a=0;a<n.length;a++){var i=s.createElement("div",{class:"relatedcontent-dgv-dropZoneGlobal "+n[a].id,draggable:!1}),o=s.createElement("div",{class:"relatedcontent-dgv-dropZone "+n[a].id,draggable:!1}).inject(i),d=s.createElement("div",{class:"relatedcontent-dgv-dropIconAndText "+n[a].id}).inject(o);s.createElement("i",{class:"relatedcontent-dgv_img wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+n[a].icon}).inject(d),s.createElement("h5",{class:"relatedcontent-dgv_txt "+n[a].id,text:n[a].title}).inject(d),i.inject(e.views.relatedContent.dropzones)}e.views.relatedContent.dropzones.hide(),e.grids.relatedContent.callbacks.onModifyGrid=e._refreshItemCount.bind(e),e.listenTo(e.grids.relatedContent,"onUpdate",(function(t){var n={issues:s.clone(t.issues).map((function(e){return e.issue})),relation:t.relation};e.dispatchEvent("onUpdate",n)})),p.end(e.name+" build")},onToolbarClickCallback:function(e){"addAffectedItem"==e._event&&this._addItem(b.CATEGORY_REPORTED_AGAINST),"addResolvedBy"==e._event&&this._addItem(b.CATEGORY_RESOLVED_BY),"addResolvedItems"==e._event&&this._addItem(b.CATEGORY_RESOLVED_ITEMS),"addContexts"==e._event&&this._addItem(b.CATEGORY_CONTEXTS),"pickAffectedItem"==e._event&&this._pickItem(b.CATEGORY_REPORTED_AGAINST),"pickResolvedBy"==e._event&&this._pickItem(b.CATEGORY_RESOLVED_BY),"pickResolvedItems"==e._event&&this._pickItem(b.CATEGORY_RESOLVED_ITEMS),"pickContexts"==e._event&&this._pickItem(b.CATEGORY_CONTEXTS),"customViewSettings"==e._event&&this._customViewSettings(),"createTask"==e._event&&this._createResolvedBy(e),"createCA"==e._event&&this._createResolvedBy(e),e._event},_customViewSettings:function(){r.launchCustomViewManager(this.grids.relatedContent.dgView)},_pickItem:function(e){var t=this,s=d.get("component"),n=d.get("widget").name===b.ISSUE_3D_REVIEW,i=!1;if(e===b.CATEGORY_REPORTED_AGAINST&&(i=!0),n)s.isInspected()?a.displayNotification({msg:h.resolveIssues.pickupError_needtoExitInspectionMode,eventID:"error"}):s.utils.selectIn3D((function(s,n,a,i,o,r){if(r&&""!==r){var l={};l[r]=n[s],n=l,s=r}var c=[{id:s,x:n[s].x,y:n[s].y,z:n[s].z}];t.grids.relatedContent.addObjects([{id:s,serviceId:"3dspace",objectType:o}],e,c)}),"",[{isOccurenceSelection:i}]);else{var o=s.taskManager.addSelectIn3DTask((function(n){var a=n.target,i=n.positions;if(n.i3dx&&""!=n.i3dx){var r={};r[n.i3dx]=i[a],i=r,a=n.i3dx,n.i3dx.includes("i3dx:r2vsurvey!")&&(n.serviceId="r2vsurvey")}var l=[{id:a,x:i[a].x,y:i[a].y,z:i[a].z}];t.grids.relatedContent.addObjects([{id:a,serviceId:n.serviceId?n.serviceId:"3dspace",objectType:n.objectType}],e,l),s.unmaskForTask(o)}),(function(){s.unmaskForTask(o)}),{isOccurenceSelection:i});s.maskForTask(o,h.tasks.selectIn3D)}},_addItem:function(e){var t=this,n=d.get("application");if(s.is(n,"object")&&n.isStandalone){var o=d.get("component"),l=o.taskManager.addObjectsTask((function(s){if(Array.isArray(s)){for(var n=[],a=0;a<s.length;a++)n.push({id:s[a].physicalId,serviceId:s[a].serviceId,objectType:s[a].objectType});t.grids.relatedContent.addObjects(n,e)}o.unmaskForTask(l)}),(function(){o.unmaskForTask(l)}));o.maskForTask(l,h.tasks.addObjects)}else{m.getTenant();let s=h.open.labels[e];m.search({title:s,default_search_criteria:"",callback:function(s){var n=[b.ISSUE_TYPE];try{i.updateI3DxIds(s);var o=[],l=[],c=0;s.forEach((e=>{l.push(e["ds6w:type_value"])})),l.length>0&&r.getTypesHierarchy(l).then((i=>{for(var r=0;r<s.length;r++){var l=s[r];if(l.hasOwnProperty("sourceid_value")){if(l.sourceid_value.includes(":")){const e=l.sourceid_value.split(":");l.sourceid_value=e[0]}var d=l.sourceid_value.toLowerCase();if(-1===d.indexOf("3dspace")&&(!l.hasOwnProperty("ds6w:i3dx_value")||""==l["ds6w:i3dx_value"]))throw new Error("Object not supported")}if(!i[l["ds6w:type_value"]].hierarchy.includes(n[0])&&l["ds6w:type_value"]!==n[0]||b.CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT.includes(e)){var u=l["ds6w:i3dx_value"]&&""!=l["ds6w:i3dx_value"]?l["ds6w:i3dx_value"]:l.id;o.push({id:u,serviceId:d,objectType:l["ds6w:type_value"]})}else c++}o.length>0&&t.grids.relatedContent.addObjects(o,e),0===c||a.displayNotification({msg:h.replace(h.resolveIssues.issueNotDroppable,{number:c}),eventID:"error"})}))}catch(e){return a.displayNotification({msg:h.resolveIssues.errorNotSupportedObject,eventID:"warning"}),null}},cancel:function(){}})}},_refreshItemCount:function(){},createRelatedContent:function(){var e=this;return p.start(e.name+" createRelatedContent"),e.views.relatedContent.main=s.createElement("div",{styles:{width:"100%",height:"100%",display:"inline-block"},class:"issue-relatedContent-main",html:[e.views.relatedContent.relatedContentHeader=s.createElement("div",{styles:{width:"100%",height:"40px",display:"flex","align-items":"center"},class:"issue-relatedContent-header"}),e.views.relatedContent.droppable=s.createElement("div",{styles:{width:"100%",position:"relative"},class:"issue-relatedContent-droppable",html:[e.views.relatedContent.dgView=s.createElement("div",{styles:{width:"100%",height:"100%",position:"absolute"},class:"issue-relatedContent-datagridview"}),e.views.relatedContent.tileView=s.createElement("div",{styles:{width:"100%",height:"100%",position:"absolute",display:"none"},class:"issue-relatedContent-tileview",html:"Test"}),e.views.relatedContent.dropzones=s.createElement("div",{styles:{position:"absolute","z-index":5e4,"justify-content":"space-around","align-items":"center","margin-top":"30px","margin-bottom":"30px"},class:"issue-relatedContent-dropzones"})]})]}),p.end(e.name+" createRelatedContent"),e.views.relatedContent.main},clear:function(){this.issues={}},destroy:function(){var e=this;e.views.main&&e.views.main.destroy(),e.stopListening(e.grids.relatedContent,"onUpdate"),e.grids.relatedContent&&(e.grids.relatedContent.destroy(),e.grids.relatedContent=null),e.views={},e.grids={},e._timestampUpdate=0},reBuildPanel:function(e){var t=this;p.start(t.name+" reBuildPanel"),t.clear(),t.options.ids=e,t.load(t.options.ids),p.end(t.name+" reBuildPanel")},refresh:function(e){var t=this;p.start(t.name+" refresh");var s=e;return s||(s=t.options.ids),t.setOption("ids",s),t.isValidSelection()?(t.placeholder.hide(t.container),t.views.main.show()):(t.views.main.hide(),t.placeholder.show(t.container)),t.reBuildPanel(s),p.end(t.name+" refresh"),t.isLoaded},load:function(e){var n=this;n.isLoaded=new t((function(e,t){n._deferred.resolve=e,n._deferred.reject=t}));var o=JSON.parse(v).contentLimit;e.length>o?n._deferred.resolve():n.fetchIssuesAndRelatedObjects(e).then((function(e){if(n.issues=e.issues,n.issues.length>0){n.grids.relatedContent.load(e.issues).then((()=>{r.buildCustomViewOptions(n.grids.relatedContent.dgView,n.container),r.restoreCustomViews(n.grids.relatedContent.dgView),i.setColumnFilteringOnAllColumns(n.grids.relatedContent.dgView)}));var t=0,s=0,a=function(e){t++,e||s++,1===t&&(s>0?(n._deferred.reject(),n.dispatchEvent("onFailure",{error:"Cannot load the related view"})):(n._deferred.resolve(),n.dispatchEvent("onReady",{})))};n.grids.relatedContent.isLoaded.then((function(){a(!0)}),(function(){a(!1)}))}}),(function(e){s.is(e.error)&&s.is(e.error.internal)&&"'business object' does not exist"==e.error.internal?i.displayErrorMessage(i.getErrorMessage("0"),"error"):a.displayNotification({msg:h.resolveIssues.errorGetIssues,eventID:"error"}),n._deferred.reject()}))},fetchIssuesAndRelatedObjects:function(e){var s=this;return new t((function(t,n){u.issues.retrieve({timestamp:s._timestampUpdate?s._timestampUpdate:null,data:{objects:e.map((function(e){return{physicalId:e}}))},onComplete:function(e){if(Array.isArray(e.results)){for(var s={issues:[]},a=0;a<e.results.length;a++){var i=e.results[a].body,o={id:i.physicalId,name:i.name,title:i.title,type:i.type,revision:"",state:i.state,description:i.description,rowNumForEmpty:{},relatedObjects:{}};s.issues.push(o),o.relatedObjects[b.CATEGORY_REPORTED_AGAINST]=[],o.relatedObjects[b.CATEGORY_RESOLVED_BY]=[],o.relatedObjects[b.CATEGORY_RESOLVED_ITEMS]=[],o.relatedObjects[b.CATEGORY_CONTEXTS]=[];for(var r=0;r<i.reportedAgainst.length;r++)o.relatedObjects[b.CATEGORY_REPORTED_AGAINST].push({id:i.reportedAgainst[r].path.join(),serviceId:i.reportedAgainst[r].serviceId,elementType:i.reportedAgainst[r].elementType});for(let e=0;e<i.resolvedBy.length;e++)o.relatedObjects[b.CATEGORY_RESOLVED_BY].push({id:i.resolvedBy[e].physicalId,serviceId:i.resolvedBy[e].serviceId,elementType:i.resolvedBy[e].elementType});for(let e=0;e<i.resolvedItems.length;e++)o.relatedObjects[b.CATEGORY_RESOLVED_ITEMS].push({id:i.resolvedItems[e].physicalId,serviceId:i.resolvedItems[e].serviceId,elementType:i.resolvedItems[e].elementType});for(var l=0;l<i.contexts.length;l++)o.relatedObjects[b.CATEGORY_CONTEXTS].push({id:i.contexts[l].physicalId,serviceId:i.contexts[l].serviceId,elementType:i.contexts[l].elementType})}t(s)}else n(new Error("Unexpected response when retrieving issues."))},onFailure:function(e){s._logger.log("getIssues :Failure..."+e),n(e)}})}))},_addDropEvent:function(e){var t=this,s=0;let n=t.views.relatedContent.dropzones;document.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",(function(s){if(e.removeClassName("dragenter"),t.views.relatedContent.dgView.style.opacity="1",n.hide(),C.count=0,s.stopPropagation(),!s.defaultPrevented){s.preventDefault();let e=[b.CATEGORY_REPORTED_AGAINST,b.CATEGORY_RESOLVED_BY,b.CATEGORY_RESOLVED_ITEMS,b.CATEGORY_CONTEXTS];var a="";for(let t=0;t<e.length;t++)if(C.actual.classList.contains(e[t])){a=e[t];break}t.getDroppedInfo(s,a).then((e=>{e&&t.grids.relatedContent.addObjects(e,a)}))}})),e.addEventListener("dragenter",(function(a){if(console.log(widget.getValue("dragContentColumnHeader")),!widget.getValue("dragContentColumnHeader")){0===C.count&&(t.views.relatedContent.dgView.style.opacity="0.4",e.addClassName("dragenter"),n.show(),n.addClassName("dropzone-flex"));var i=f.firstParentWithClass(a.target,"relatedcontent-dgv-dropZoneGlobal");if(i){var o=i.querySelector(".relatedcontent-dgv-dropZone");C.actual!==o&&(C.actual&&C.actual.classList.remove("zoneHighlighted"),o.classList.add("zoneHighlighted"),C.actual=o)}C.count++,s++,a.stopPropagation()}})),e.addEventListener("mouseenter",(function(){e.hasClassName("dragenter")&&s++})),e.addEventListener("mouseleave",(function(){e.hasClassName("dragenter")&&--s<=0&&e.removeClassName("dragenter")})),e.addEventListener("dragleave",function(a){C.count--,0===C.count&&(t.views.relatedContent.dgView.style.opacity="1",e.removeClassName("dragenter"),n.hide()),a.target===C.actual&&(C.actual.classList.remove("zoneHighlighted"),C.actual=null),0===--s&&(e.removeClassName("dragenter"),n.hide()),a.stopPropagation()}.bind(t))},getDroppedInfo:function(e,t){var n=[];try{return r.getDroppableData(e).then((e=>{var o=e.data.items;if(0==o.length)throw new Error("Object not supported");var r=0;return i.updateI3DxIds(o),o.forEach((function(e){if(e.isIssue&&!b.CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT.includes(t))r++;else{if(!e.hasOwnProperty("serviceId")||!s.is(e.serviceId,"string")||!e.serviceId.toLowerCase().includes("3dspace")&&!e.hasOwnProperty("i3dx")||!e.serviceId.toLowerCase().includes("3dspace")&&e.hasOwnProperty("i3dx")&&""==e.i3dx)throw new Error("Object not supported");if(-1===n.indexOf(e.objectId)){e.serviceId.includes(":")&&(e.serviceId=e.serviceId.split(":")[0]);var a=e.i3dx&&""!=e.i3dx?e.i3dx:e.objectId;n.push({id:a,serviceId:e.serviceId,objectType:e.objectType})}}})),0!==r&&a.displayNotification({msg:h.replace(h.resolveIssues.issueNotDroppable,{number:r}),eventID:"error"}),n.length>0?n:null})).catch((function(){a.displayNotification({msg:h.resolveIssues.errorNotSupportedObject,eventID:"warning"})}))}catch(e){return a.displayNotification({msg:h.resolveIssues.errorNotSupportedObject,eventID:"warning"}),null}return n},utils:{pushObjectIdIntoArrayOnce:function(e,t){return t.indexOf(e)>-1&&(t.push(e),!0)}},isValidSelection:function(){var e=JSON.parse(v).contentLimit,t=this.getOption("ids");return Array.isArray(t)&&t.length<=e},placeholder:{_view:new o,show:function(e){this._view.render("content").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}},_createResolvedBy:function(e){e&&"createTask"==e._event?require(["DS/IssueCommon/commands/CreateTask"],(function(e){(new e).execute()})):e&&"createCA"==e._event&&require(["DS/IssueCommon/commands/ChangeAction"],(function(e){(new e).execute()}))}})})),define("DS/IssueComponents/create/Finalize",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y){"use strict";var E="Analyst";return t.extend({name:"DS/IssueComponents/create/Finalize",tag:"div",className:"create-view-content-subview create-finalize",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.avaialbleUserCredentials=s.parent.avaialbleUserCredentials,s.isInit=new e((function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t})),s.form=null,s.formElements={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},s.formElementsToggler={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},s.fields={automation:{enableApproval:null,saveAsTemplate:null,assignContentOwner:null},saveAsTemplate:{name:null,description:null,securityContexts:null}},s._appliedTemplate=null,s._deferredInit.resolve()},destroy:function(){var e=this;e.form=null,e.formElements={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},e.formElementsToggler={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},e.fields={automation:{enableApproval:null,saveAsTemplate:null,assignContentOwner:null},saveAsTemplate:{name:null,description:null}},e._appliedTemplate=null},render:function(){var e=this;v.get("widget")||window.widget;b.preferences.getApprovalEnablement({data:{}}).then((function(t){var s=t.body.ApprovalProcess;e.adminPreference=s,"Always"==s?(e.fields.automation.enableApproval.checkFlag=!0,e.fields.automation.enableApproval.disabled=!0):"Never"==s?(e.fields.automation.enableApproval.checkFlag=!1,e.fields.automation.enableApproval.disabled=!0):e._appliedTemplate&&Array.isArray(e._appliedTemplate.data.automationTasks)?e._appliedTemplate.data.automationTasks.indexOf("enableApproval")>-1?(e.fields.automation.enableApproval.checkFlag=!0,e.fields.automation.enableApproval.disabled=!1):(e.fields.automation.enableApproval.checkFlag=!1,e.fields.automation.enableApproval.disabled=!1):e.getApprovalPreference()})),e.form=new n({className:"create-finalize-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container);var t=s.createElement("div",{class:"create-form-content",html:[e._renderContentField(),e._renderApprovalField(),e._renderTemplateField(),e._renderTemplateForm()]});return b.preferences.get({data:{name:"assignPreference"}}).then((function(t){if(!e._appliedTemplate){var s=t.body;e.fields.automation.assignContentOwner.checkFlag=s,localStorage.setItem("assignPreferenceTemplate",s)}})),new u({element:t}).inject(e.form.elements.container),e.parent.isTemplate&&(t.style.minHeight="251px"),e},getApprovalPreference:function(){var e=this;b.preferences.get({data:{name:"approvalPreference"}}).then((function(t){if(!e._appliedTemplate||!Array.isArray(e._appliedTemplate?.data?.automationTasks)){var s=t.body;e.fields.automation.enableApproval.checkFlag=s,e.fields.automation.enableApproval.disabled=!1}})).catch((function(e){e&&s.is(e.error,"object")&&s.is(e.error.message,"string")&&PADAlert.displayNotification({msg:e.error.message,eventID:"error"})}))},_renderContentField:function(){var e=this,t=new r({type:"checkbox"}),n=e.fields.automation.assignContentOwner=new o({type:"checkbox",label:y.create.finalize.assignContentOwner,value:0});return n.addEventListener("buttonclick",(function(t){t.dsModel.checkFlag?(localStorage.setItem("assignPreferenceTemplate",!0),b.preferences.set({data:{name:"assignPreference",value:!0}}).catch((function(t){e._logger.error("Could not save the preferences: %o",t)}))):(localStorage.setItem("assignPreferenceTemplate",!1),b.preferences.set({data:{name:"assignPreference",value:!1}}).catch((function(t){e._logger.error("Could not save the preferences: %o",t)})))})),t.addChild(n),e.formElements.assignContentOwner=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.assignContentOwner=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[t]}]})},_renderApprovalField:function(){var e=this,t=new r({type:"checkbox"}),n=e.fields.automation.enableApproval=new o({type:"checkbox",label:y.create.finalize.enableApproval,value:1});return n.addEventListener("buttonclick",(function(t){t.dsModel.checkFlag?b.preferences.set({data:{name:"approvalPreference",value:!0}}).catch((function(t){e._logger.error("Could not save the preferences: %o",t)})):b.preferences.set({data:{name:"approvalPreference",value:!1}}).catch((function(t){e._logger.error("Could not save the preferences: %o",t)}))})),t.addChild(n),e.formElements.enableApproval=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.enableApproval=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[t]}]})},_renderTemplateField:function(){var e=this,t=new r({type:"checkbox"}),n=!1,a=!1;e.parent.isTemplate&&(n=!0,a=!0);var i=e.fields.automation.saveAsTemplate=new o({type:"checkbox",label:y.create.finalize.saveAsTemplateToggle,value:2,checkFlag:n,disabled:a});return i.addEventListener("change",(function(e){e.dsModel.checkFlag?(document.querySelector(".create-expander-body-template").style.display="block",widget.getElement(".create-finalize-form .create-form-content").style.minHeight="251px"):(document.querySelector(".create-expander-body-template").style.display="none",widget.getElement(".create-finalize-form .create-form-content").style.minHeight="95px")})),t.addChild(i),e.formElements.saveAsTemplate=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.saveAsTemplate=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[t]}]})},_renderTemplateForm:function(){var e=this,t=v.get("widget")||window.widget;e.templateContainer=new s.Element("div",{class:"create-expander-body-template"}),e.templateContainer.style.display="none",e.parent.isTemplate&&(e.templateContainer.style.display="block");var n="required-form-field-title-label"+(e.isTemplate?"":" highlight"),a="required-form-field-required-label"+(e.isTemplate?"":" highlight");s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:n,html:y.create.templateName}),s.createElement("div",{class:a+" wux-ui-3ds-required wux-ui-3ds"})]}).inject(e.templateContainer);var i=e.fields.saveAsTemplate.name=new l({requiredFlag:!0});i.getContent().setStyle("width","100%"),e.fields.saveAsTemplate.name.addEventListener("keyup",(function(){var t=e.fields.saveAsTemplate.name.valueToCommit;e._onTemplateNameChange(t)})),i.inject(e.templateContainer);var o={element:"collaborativeSpace",type:"comboBox",required:!0};o.label=y.collaborativeSpace,o.placeholder=y.selectCollaborativeSpacePlaceholder,o.enableSearchFlag=!1;a="required-form-field-required-label"+(e.isTemplate?"":" highlight");var r=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:"create-form-field-label",html:y.collaborativeSpace}),s.createElement("div",{class:a+" wux-ui-3ds-required wux-ui-3ds"}),e.fields.collabSpaceHelper=s.createElement("span",{class:"fonticon fonticon-help isu-help-icon"})]});h.updatePanelTooltip(e.fields,"collabSpaceHelper"),r.inject(e.templateContainer),e.parent.options.editMode&&r.hide();var u,m,p=e.getCollaborativeSpaceData(e.avaialbleUserCredentials);o.elementsList=p.map((e=>({labelItem:e.title,valueItem:e.name}))),t.getPreference("pad_security_ctx")&&(u=t.getPreference("pad_security_ctx").value),u&&(m=u.split("ctx::")[1]);var f=e.avaialbleUserCredentials.credentials.findIndex((e=>e.ctxname===m)),g=-1;m&&f>-1&&(g=p.findIndex((e=>e.name===m.split(".")[2]))),o.reachablePlaceholderFlag=(void 0===f||-1==f)&&p.length>1;var b=e.fields.saveAsTemplate.collaborativeSpace=new d(o);e.fields.saveAsTemplate.collaborativeSpace.required=o.required,g&&g>-1&&(e.fields.saveAsTemplate.collaborativeSpace.selectedIndex=g),1===p.length&&(e.fields.saveAsTemplate.collaborativeSpace.selectedIndex=0),p.length>=1&&(b.getContent().setStyle("width","100%"),b.inject(e.templateContainer)),1===p.length&&(e.fields.saveAsTemplate.collaborativeSpace.disabled=!0),o.element="organization",o.type="comboBox",o.required=!0,o.label=y.organization,o.placeholder=y.selectOrganizationPlaceholder,o.enableSearchFlag=!1;a="required-form-field-required-label"+(e.isTemplate?"":" highlight");var C=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:"create-form-field-label",html:y.organization}),s.createElement("div",{class:a+" wux-ui-3ds-required wux-ui-3ds"}),e.fields.organizationHelper=s.createElement("span",{class:"fonticon fonticon-help isu-help-icon"})]});h.updatePanelTooltip(e.fields,"organizationHelper");var I=e.getAllAssignedOrganizations(e.avaialbleUserCredentials);C.inject(e.templateContainer),e.parent.options.editMode&&C.hide();var E=e.getOrganizationsData(e.avaialbleUserCredentials);o.elementsList=E.map((e=>({labelItem:e.title,valueItem:e.name})));var S=-1;m&&f>-1&&(S=E.findIndex((e=>e.name===m.split(".")[1]))),o.reachablePlaceholderFlag=!0;var w=e.fields.saveAsTemplate.organization=new d(o);e.fields.saveAsTemplate.organization.required=o.required,S>-1&&(e.fields.saveAsTemplate.organization.selectedIndex=S),w.getContent().setStyle("width","100%"),w.inject(e.templateContainer),e.fields.saveAsTemplate.collaborativeSpace.addEventListener("change",(function(){E=e.getOrganizationsData(e.avaialbleUserCredentials),e.updateComboBoxFields(E,"organization"),e.fields.saveAsTemplate.organization.selectedIndex=-1,1===E.length&&I.length>1?(C.show(),w.show(),e.fields.saveAsTemplate.organization.selectedIndex=0,w.disabled=!0):E.length>1&&I.length>1?(C.show(),w.show(),w.disabled=!1):1===E.length&&1===I.length?(e.fields.saveAsTemplate.organization.selectedIndex=0,C.hide(),w.hide()):(C.hide(),w.hide())})),1===E.length&&I.length>1&&!e.parent.options.editMode&&(C.show(),w.show(),e.fields.saveAsTemplate.organization.selectedIndex=0,w.disabled=!0),1==I.length&&(C.hide(),w.hide(),e.fields.saveAsTemplate.organization.selectedIndex=0,w.disabled=!0),-1!==f||void 0!==e.fields.saveAsTemplate.collaborativeSpace.value||e.parent.options.editMode||(C.show(),w.show(),w.disabled=!0),s.createElement("h5",{class:"create-form-field-label",html:y.create.templateDesc}).inject(e.templateContainer);var T=e.fields.saveAsTemplate.description=new c({nbRows:4,newLineMode:"enter"});return T.getContent().setStyle("width","100%"),T.inject(e.templateContainer),e.templateContainer},getCollaborativeSpaceData:function(e){var t=[],s=[];return e.credentials.forEach((e=>{if(e.ctxtitle){t.some((t=>t.name===e.prjname))||t.push({title:e.prjtitle?e.prjtitle:e.prjname,name:e.prjname}),s.push(e.ctxname)}})),this.ctx=s,t},getOrganizationsData:function(e){var t=this,s=[];return e.credentials.forEach((e=>{if(e.ctxtitle&&e.prjname===t.fields.saveAsTemplate.collaborativeSpace.value){s.some((t=>t.name===e.orgname))||s.push({name:e.orgname,title:e.orgtitle})}})),s},updateComboBoxFields:function(e,t){this.fields.saveAsTemplate[t].elementsList=e.map((e=>({labelItem:e.title,valueItem:e.name})))},getAllAssignedOrganizations:function(e){var t=[];return e.credentials.forEach((e=>{if(e.ctxtitle){t.some((t=>t.name===e.orgname))||t.push({name:e.orgname,title:e.orgtitle})}})),t},createCredential:function(e){var t=e.rangeItems,s=function(){var e=new f;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,a=t[s].valueItem,i=new g({label:n,grid:{valueItem:a}});e.addRoot(i)}return e.pushUpdate(),e}();return new d({elementsTree:s,value:e.value,enableSearchFlag:1==e.enableSearchFlag})},validate:function(){var e=this;return!0!==e.fields.automation.saveAsTemplate.checkFlag||!(""===e.fields.saveAsTemplate.name.value||e.fields.saveAsTemplate.collaborativeSpace.visibleFlag&&void 0===e.fields.saveAsTemplate.collaborativeSpace.value||e.fields.saveAsTemplate.organization.visibleFlag&&void 0===e.fields.saveAsTemplate.organization.value)},getTasks:function(){var e=this,t=[];return Object.keys(e.fields.automation).forEach((function(s){e.fields.automation[s].checkFlag&&!0===e.fields.automation[s].checkFlag&&t.push(s)})),t},getApprovalValue:function(){return this.fields.automation.enableApproval.checkFlag},getContentValue:function(){return this.fields.automation.assignContentOwner.checkFlag},getTemplateValue:function(){return this.fields.automation.saveAsTemplate.checkFlag},getValues:function(){var e=this,t={};return!0===e.getApprovalValue()&&(t.waitingOn=E),!0===e.getContentValue()&&(t.assignContentOwner=!0),!0===e.getTemplateValue()&&(t.saveAsTemplate=!0),t},getHiddenAttributes:function(){var e=this,t={};for(var n in e.formElements)s.is(e.formElementsToggler[n])&&(t[n]=e.formElementsToggler[n].hasClassName("fonticon-eye-off"));return t},getTemplateValues:function(){var e=this;const t=e.ctx.findIndex((t=>{const s=t.split(".");return s[1]===e.fields.saveAsTemplate.organization.value&&s[2]===e.fields.saveAsTemplate.collaborativeSpace.value}));return{name:e.fields.saveAsTemplate.name.value,description:e.fields.saveAsTemplate.description.value,securityContexts:"ctx::"+e.ctx[t],collaborativeSpace:e.fields.saveAsTemplate.collaborativeSpace.value,organization:e.fields.saveAsTemplate.organization.value}},applyTemplate:function(t){var n=this;return new e((function(e){if(n._appliedTemplate=t,Array.isArray(t.data.automationTasks)&&Object.keys(n.fields.automation).forEach((function(e){"saveAsTemplate"===e||-1===t.data.automationTasks.indexOf(e)?("saveAsTemplate"===e&&n.parent.isTemplate?n.fields.automation[e].checkFlag=!0:"assignContentOwner"===e?null!=t.applyIssue&&t.applyIssue||(n.fields.automation[e].checkFlag=!1,localStorage.setItem("assignPreferenceTemplate",!1)):"enableApproval"===e&&"UserChoice"==n.adminPreference&&(n.fields.automation[e].checkFlag=!1,n.fields.automation[e].disabled=!1),"assignContentOwner"===e&&localStorage.setItem("assignPreferenceTemplate",!1)):"saveAsTemplate"===e?n.fields.automation[e].checkFlag=!0:"assignContentOwner"===e?(n.fields.automation[e].checkFlag=!0,localStorage.setItem("assignPreferenceTemplate",!0)):"enableApproval"===e&&"UserChoice"==n.adminPreference&&(n.fields.automation[e].checkFlag=!0,n.fields.automation[e].disabled=!1)})),s.is(t.info,"object")&&(!0===s.is(t.info.name,"string")&&(n.fields.saveAsTemplate.name.value=t.info.name,n._onTemplateNameChange(t.info.name)),!0===s.is(t.info.description,"string")&&(n.fields.saveAsTemplate.description.value=t.info.description),n.fields.saveAsTemplate.securityContexts={},!0===s.is(t.info.securityContexts,"string")&&(n.fields.saveAsTemplate.securityContexts.value=t.info.securityContexts)),n.parent.options.editMode&&(n.fields.saveAsTemplate.organization.hide(),n.fields.saveAsTemplate.collaborativeSpace.hide()),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var a=n.formElements,i=n.formElementsToggler;for(var o in a)!0===t.hidden[o]&&(n.parent.isTemplate?(s.is(a[o])&&a[o].toggleClassName("visibility-masked",!0),s.is(i[o])&&(i[o].toggleClassName("fonticon-eye-off",!0),i[o].toggleClassName("fonticon-eye",!1))):s.is(a[o])&&(a[o].hide(),"saveAsTemplate"===o&&n.templateContainer.hide()))}e()}))},_onTemplateNameChange:function(e){var t=this;"fields"in t&&"saveAsTemplate"in t.fields&&"name"in t.fields.saveAsTemplate&&t.parent&&t.parent.isTemplate&&t.parent.updateTitle(e)}})})),define("DS/IssueComponents/create/Properties",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Date","DS/UIKIT/Input/Text","DS/CKEditor/CKEditor","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/create/Classification","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y,E,S,w,T){"use strict";return t.extend({})})),define("DS/IssueComponents/templates/TemplatesContextualMenu",["UWA/Class/Promise","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueServices/services/PlatformServices","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r){"use strict";var l="DS/IssueManagement/components/ContextualMenu";return{getContextualMenu:function(t){var n=this;try{s.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryViewTemplateActions"}})}catch(e){}finally{n.templateComponet=a.get("templateComponentDialog")?a.get("templateComponentDialog"):a.get("templateComponent");var i=t.document.getSelectedTemplateNodes();if(n.user=o.getUserName(),0===i.length)return e.resolve([]);var r=i.reduce((function(e,t){var s=t.options.id.split(","),n=s[s.length-1],a=t.options.grid.Approvals;return e.push({physicalId:n,path:t.options.id,parentId:t.options.data.issue,relationToIssue:t.options.data.relationToIssue,type:t.options.type,baseType:t.options.baseType,name:t.options.name,title:t.options.title,state:t.options.state,approvals:a,kind:t.options.kind,owner:t.options.owner}),e}),[]);return n._getMenu({objects:r})}},_getMenu:function(t){return 0===(Array.isArray(t.objects)?t.objects:[]).length?e.resolve([]):(i.start(l+" _getMenu"),this._getBasicMenu(t))},_getApprovalMenu:function(t){var s=[];if(1===t.objects.length){var n={type:"CheckItem",icon:"check",state:"unselected"};t.approvals?(n.state="selected",n.title=r.approvalOnCommand):n.title=r.approvalOffCommand,s.push(n),s.push({type:"SeparatorItem"})}return e.resolve(s)},_getBasicMenu:function(o){var c=this;i.start(l+" _getBasicMenu");var d=[],u=Array.isArray(o.objects)?o.objects:[];if(0===u.length)return d;var m=new e((function(e){e()}));return m=m.then((function(){return d.push({name:"CollaborativeLifecycle",title:r.collaborativeLifecycleCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){a.get("pad3DViewer")?a.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"CollaborativeLifecycle"}):t.getCommand("CollaborativeLifecycle").begin();try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"SummaryViewTemplateActions",pd4:"Maturity",pd5:"IssueTemplate/DataGridView/SummaryViewTemplateActions/Maturity"}})}catch(e){}}}}),d.push({type:"SeparatorItem"}),d.push({name:"Move",title:r.moveCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-move-to"},id:"moveTemplate",data:null,action:{callback:function(){a.get("pad3DViewer")?a.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Move"}):t.getCommand("Move").begin();try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"SummaryViewTemplateActions",pd4:"Move",pd5:"IssueTemplate/DataGridView/SummaryViewTemplateActions/Move"}})}catch(e){}}}}),d.push({type:"SeparatorItem"}),d.push({name:"Share",title:r.shareCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-forward"},data:null,action:{callback:function(){c.templateComponet.shareTemplateHandler()}}}),1==u.length&&d.push({name:"information",title:r.informationCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-info-open-in-a-new-window"},data:null,action:{callback:function(){s.viewProperties(u[0].physicalId,"3DSpace");try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"SummaryViewTemplateActions",pd4:"Information",pd5:"IssueTemplate/DataGridView/SummaryViewTemplateActions/Information"}})}catch(e){}}}}),d.push({name:"Delete",title:r.deleteCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-trash"},id:"deleteTemplates",data:null,action:{callback:function(){c.templateComponet._removeTemplateHandler();try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"SummaryViewTemplateActions",pd4:"Delete",pd5:"IssueTemplate/DataGridView/SummaryViewTemplateActions/Delete"}})}catch(e){}}}}),d.push({type:"SeparatorItem"}),n.updateTooltip(d),i.end(l+" _getBasicMenu"),d}))}}})),define("DS/IssueComponents/templates/TemplatesDGView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/IssueComponents/templates/TemplatesContextualMenu","DS/IssueComponents/users/Users","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/Controls/Button","text!DS/IssueComponents/assets/Settings.json","i18n!DS/IssueCommon/assets/nls/IssueCommon","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p){"use strict";var f={ISSUE_TYPE:"Issue",DS6W:"ds6w:",STATE_ENUM:{PRIVATE:1,RELEASED:2},PRIORITY_ENUM:{LOW:1,MEDIUM:2,HIGH:3,URGENT:4},LOW_PRIORITY:"Low",MEDIUM_PRIORITY:"Medium",HIGH_PRIORITY:"High",URGENT_PRIORITY:"Urgent"},g=this;return e.extend({init:function(e){this._parent(e);var t=this;g=this,t.templateComponent=l.get("templateComponentDialog")?l.get("templateComponentDialog"):l.get("templateComponent"),t.templatesDatagrid={},t.custom_view_options={dgvHandle:null,ootb_columns:[],dgvDiv:null,settings:{url:r.get3DSpaceUrl(),securityContext:r.getSecurityContexts().securityContext,isNative:l.get("isNatifEnvironnement")}},t.document=e.treeDocument,t.datagridSettings=JSON.parse(u),this.render()},render:function(){try{var e=this;e.options.columns.forEach((function(t){t.text=e.getHeader(t.dataIndex)})),e.templatesDatagrid=new t(e.options),e.templatesDatagrid.custom_view_options=e.custom_view_options,setTimeout((()=>{e.setTemplateCustomView()}),5e3),e.templateComponent.options.editMode&&e.templatesDatagrid.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:p.columns.actionsColumn,width:50}),e.subscribers(),e._customizeColumnSorting(e.options.columns),e._customizeColumnRendering(e.options.columns)}catch(e){}},subscribers:function(){var e=this;e.templatesDatagrid.addEventListener("click",e.doOnTreeNodeClick.bind(e)),e.templatesDatagrid.onContextualEvent=function(t){if(t&&t.cellInfos){var s=t.cellInfos;if(-1===s.rowID&&t.collectionView){return t.collectionView.buildDefaultContextualMenu(t,{pin:!0,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,filter:!0})}return s.nodeModel&&(!1===s.nodeModel.isSelected()&&s.nodeModel.select(!0),e.templateComponent.options.editMode)?n.getContextualMenu(e):Promise.resolve()}return Promise.resolve()},e.templatesDatagrid.onDragStartCell=function(t,s){var n=e.document.getSelectedNodes(),a=e.document.utils.setDroppableData(n);return e.document.prepareBroadcastSelect(),e.document.pushBroadcastSelect(),t.dataTransfer.setData(a.type,a.data),null!==e._ghost&&null!=e._ghost&&(e._ghost.destroy(),e._ghost=null),e._ghost=UWA.createElement("div",{class:"issue-ghost-container"}),e._ghost.setStyle("transform","translate3d(0,0,0)"),document.body.appendChild(e._ghost),t.dataTransfer.setDragImage(e._ghost,t.offsetX,t.offsetY),!0}},doOnTreeNodeClick:function(e,t){e&&void 0!==t&&("ds6w:state"==e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID)&&-1!=t.rowID&&this.templateComponent.options.editMode&&e.detail<2&&this.launchMaturityPopup(t))},launchMaturityPopup:function(){var e=this;require(["DS/IssueComponents/external/CollaborativeLifecycle"],(function(t){for(var s=[],n=e.document.getSelectedTemplateNodes(),a=0;a<n.length;a++)s.push(n[a].options.id);t.execute(s)}))},setTemplateCustomView:function(){i.registerCustomEventsOnDGV(this.templatesDatagrid),o.setColumnFilteringOnAllColumns(this.templatesDatagrid)},getHeader:function(e){var t=l.get("widget")||window.widget,s=this.datagridSettings.list.columns;return s&&s.default&&s.default[e]?p[s.default[e]]:s&&s.custom&&s.custom[e]?s.custom[e][t.lang]:e},_customizeColumnSorting:function(e){var t=this;e.forEach((function(e){var s=e.dataIndex.replace(f.DS6W,"");switch(e.dataIndex){case"tree":e.compareFunction=t.sorting.title;break;case"ds6w:name":e.compareFunction=t.sorting.name(!1);break;case"ds6w:description":e.compareFunction=t.sorting.description(!1);break;case"ds6w:created":case"ds6w:modified":case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:actualStartDate":case"ds6w:actualEndDate":case"ds6w:resolutionDate":break;case"ds6w:priority":case"ds6w:state":e.compareFunction=t.sorting.enumeration(s);break;case"ds6w:assignees":e.compareFunction=t.sorting.assignees;break;case"ds6w:contributors":e.compareFunction=t.sorting.contributors;break;case"ds6w:informedUsers":e.compareFunction=t.sorting.informedUsers;break;case"ds6w:originator":e.compareFunction=t.sorting.originator;break;case"ds6w:owner":e.compareFunction=t.sorting.owner;break;case"ds6w:coOwners":e.compareFunction=t.sorting.coOwners;break;default:!0===e.custom&&(e.compareFunction=t.sorting.custom(s))}}))},_customizeColumnRendering:function(e){var t=this;widget.getValue("wux-collectionView-dataGridView")&&JSON.parse(widget.getValue("wux-collectionView-dataGridView")).ISUTemplateSummaryView,e.forEach((function(e){e.dataIndex.replace(f.DS6W,"");switch(e.dataIndex){case"ds6w:biColor":e.onCellRequest=t.rendering.biColor;break;case"ds6w:state":e.getCellClassName=t.styling.state;break;case"ds6w:priority":e.onCellRequest=t.rendering.priority;break;case"ds6w:assignees":e.onCellRequest=t.rendering.assignees;break;case"ds6w:contributors":e.onCellRequest=t.rendering.contributors;break;case"ds6w:informedUsers":e.onCellRequest=t.rendering.informedUsers;break;case"ds6w:originator":e.onCellRequest=t.rendering.originator;break;case"ds6w:owner":e.onCellRequest=t.rendering.owner;break;case"ds6w:coOwners":e.onCellRequest=t.rendering.coOwners;break;case"ds6w:reportedAgainst":e.getCellValue=t.rendering.isReportedAgainstPresent;break;case"ds6w:contexts":e.getCellValue=t.rendering.isContextsPresent;break;case"ds6w:resolutionDate":e.onCellRequest=t.rendering.date;break;default:if(e.isCustomColumn){var s={that:t,attr:{name:e.dataIndex}};e.getCellValue=t.rendering.classificationAttributes.bind(s)}}}))},getManager:function(){return this.templatesDatagrid},getColumns:function(){return this.templatesDatagrid.columns},rendering:{biColor:function(e){!1===e.manager.getColumnOptions("biColor").isHidden&&(e.isHeader||(e.cellView.reuseCellContent("biColorCell").style["background-color"]=e.nodeModel.options.grid.biColor))},priority:function(e){if(-1!==e.rowID&&e.nodeModel.options.baseType==f.ISSUE_TYPE){var t=e.nodeModel.options.priority,s="",n="",a=m.priorities[t.toLowerCase()];switch(null==a&&(a=t),t){case f.LOW_PRIORITY:n="low wux-ui-3ds wux-ui-3ds-level-low";break;case f.MEDIUM_PRIORITY:n="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case f.HIGH_PRIORITY:n="high wux-ui-3ds wux-ui-3ds-level-high";break;case f.URGENT_PRIORITY:n="urgent wux-ui-3ds wux-ui-3ds-alert "}s=""==n?UWA.createElement("div",{class:"issue-list-priority",html:a}):UWA.createElement("div",{class:"issue-list-priority",html:[UWA.createElement("span",{class:"issue-list-priority-icon templatePriority "+n}),a]}),e.cellView.setReusableContent(s)}},classificationAttributes:function(e){if(-1===e.rowID||e.nodeModel.options.baseType!=f.ISSUE_TYPE)return;let t=e.nodeModel.options.grid[this.attr.name];if(void 0!==t)return UWA.is(t,"string")&&(t=t.replaceAll("",", ")),t;this.that.templateList.dataGrid.options.treeDocument.autoFill.classificationAttributes(e.nodeModel.options.physicalId,this.attr.name,this.attr.type)},owner:function(e){if(c.start(" rendering owner"),-1!==e.rowID){var t=e.nodeModel.options,n=a.create({users:[t.owner]}).addClassName("issue-owner-container"),i=new d({domId:"hyperlinkButton",displayStyle:"lite",label:t.owner.fullName});i.addEventListener("click",(function(){r.getUserProfile(t.owner.user)})),i.inject(n),e.cellView.setReusableContent(n);let o="";t.owner.fullName&&t.owner.user&&(o=t.owner.fullName+" ("+t.owner.user+")"),n.tooltipInfos=new s({shortHelp:o,mouseRelativePosition:!1,position:"bottom"})}c.end(" rendering owner")},originator:function(e){if(c.start(" rendering originator"),-1!==e.rowID){var t=e.nodeModel.options,n=a.create({users:[t.originator]}).addClassName("issue-owner-container"),i=new d({domId:"hyperlinkButton",displayStyle:"lite",label:t.originator.fullName});i.addEventListener("click",(function(){r.getUserProfile(t.originator.user)})),i.inject(n),e.cellView.setReusableContent(n);let o="";t.originator.fullName&&t.originator.user&&(o=t.originator.fullName+" ("+t.originator.user+")"),n.tooltipInfos=new s({shortHelp:o,mouseRelativePosition:!1,position:"bottom"})}c.end(" rendering originator")},assignees:function(e){if(c.start(" rendering assignees"),-1!==e.rowID){var t=g.templatesDatagrid.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.assignees&&n.assignees.length){var i=n.assignees.map((function(e){return e})),o=a.create({users:i});e.cellView.setReusableContent(o);let t="";i.forEach((e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName})),o.tooltipInfos=new s({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}c.end(" rendering assignees")},contributors:function(e){if(c.start(" rendering contributors"),-1!==e.rowID){var t=g.templatesDatagrid.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.contributors&&n.contributors.length){var i=n.contributors.map((function(e){return e})),o=a.create({users:i});e.cellView.setReusableContent(o);let t="";i.forEach((e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName})),o.tooltipInfos=new s({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}c.end(" rendering contributors")},informedUsers:function(e){if(c.start(" rendering informedUsers"),-1!==e.rowID){var t=g.templatesDatagrid.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.informedUsers&&n.informedUsers.length){var i=n.informedUsers.map((function(e){return e})),o=a.create({users:i});e.cellView.setReusableContent(o);let t="";i.forEach((e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName})),o.tooltipInfos=new s({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}c.end(" rendering informedUsers")},coOwners:function(e){if(c.start(" rendering coOwners"),-1!==e.rowID){var t=g.templatesDatagrid.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.coOwners&&n.coOwners.length){var i=n.coOwners.map((function(e){return e})),o=a.create({users:i});e.cellView.setReusableContent(o);let t="";i.forEach((e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName})),o.tooltipInfos=new s({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}c.end(" rendering coOwners")},array:function(e){return function(t){if(c.start(" rendering array"),t.nodeModel.options.baseType===f.ISSUE_TYPE){var s=t.nodeModel.options[e];if(!0===(e in t.nodeModel.options&&s.length>0))if(s.length<f.RENDERING_LIMIT_ARRAY)t.cellView.reuseCellContent("arrayLengthIs"+s.length);else{var n=UWA.createElement("div",{class:"issue-list-cell-related",html:p.replace(p.listHasRelated,{number:s.length})});t.cellView.getContent().setContent(n)}else t.cellView.reuseCellContent("arrayLengthEmpty")}c.end(" rendering array")}},isContextsPresent:function(e){if(c.start(" rendering isContextsPresent"),e.nodeModel.options.baseType===f.ISSUE_TYPE)return e.nodeModel.options.contexts.length;c.end(" rendering isContextsPresent")},isReportedAgainstPresent:function(e){if(c.start(" rendering isReportedAgainstPresent"),e.nodeModel.options.baseType===f.ISSUE_TYPE)return e.nodeModel.options.reportedAgainst.length;c.end(" rendering isReportedAgainstPresent")},date:function(e){var t="";if(""!=e.nodeModel.options.resolutionDate){var s=l.get("widget")||window.widget,n=parseInt(s.getValue("approaching"),10),a="",i=new Date;i.setHours(0,0,0,0);var r=new Date(e.nodeModel.options.resolutionDate),c=e.nodeModel.options.resolutionDate;r.setHours(0,0,0,0),a=""===(a=Math.ceil(Math.abs(r-i)/864e5)<=n&&r>i?"approaching":"")&&r<=i?"overdue":a;r.toLocaleString("default",{month:"short"}),r.getDate(),r.getFullYear();t=UWA.is(a,"string")&&""!==a?UWA.createElement("div",{class:"target-approaching-overdue",html:[{class:"approaching"===a?"fonticon fonticon-clock":"fonticon fonticon-attention"},{html:o.formatDate(c)}]}):UWA.createElement("div",{class:"target-approaching-overdue",html:o.formatDate(c)})}e.cellView.setReusableContent(t)},updateColumnStyles:function(e,t){var s={};void 0!==t.color&&(s.color=t.color+";"),void 0!==t["background-color"]&&(s["background-color"]=t["background-color"]+";");var n=[],a=document.styleSheets[0];a.cssRules?n=a.cssRules:a.rules&&(n=a.rules);var i='.issue-list-container .wux-datagrid-cell[data-index="'+e+'"]:not(.wux-datagrid-header)',o=this._getBrowserSelector(i),r=function(e,t,s){for(var n=e.length;--n;){var a=e[n];if(s(t,a))return{item:a,index:n}}return null}(n,o,(function(e,t){return t.selectorText===e}));null!==r&&a.deleteRule(r.index);var l="{}";UWA.is(t,"object")&&(l=(l=(l=JSON.stringify(s)).replace(/"/g,"")).replace(/,/g,"")),"{}"!==l&&a.insertRule(o+l,n.length)},_getBrowserSelector:function(e){var t=document.styleSheets,s=t[t.length-1],n=-1,a=null;try{n=s.insertRule(e+"{}",s.cssRules.length),a=(s.cssRules||s.rules)[n].selectorText}finally{n>=0&&s.deleteRule(n)}return a}},styling:{state:function(e){if(e.nodeModel){var t="";if(t="Issue-Template."+e.nodeModel.options.state){var s="lc-status-"+t.replace(/(\.| )/g,"-")+"-withClass";return s=s+" "+(t=t.replace("Issue-Template.",""))+" ISU-template-maturity"}}},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")}},sorting:{custom:function(e){return function(e,t,s,n,a){var i=!(a in s.options.custom)||null===s.options.custom[a],o=!(a in n.options.custom)||null===n.options.custom[a];if(i||o)return i&&!o?-1:!i&&o?1:0;var r=s.options.custom[a],l=n.options.custom[a];return isNaN(r)||isNaN(l)?r>l?1:r<l?-1:0:(r=parseFloat(r))>(l=parseFloat(l))?1:r<l?-1:0}},title:function(e,t,s,n,a){return s.options.baseType!==f.ISSUE_TYPE||n.options.baseType,s.options.label<n.options.label?-1:s.options.label>n.options.label?1:0},name:function(e){return function(t,s,n,a,i){return n.options.name<a.options.name?e?1:-1:n.options.name>a.options.name?e?-1:1:0}},description:function(e){return function(t,s,n,a,i){var r=o.getTextFromHTML(n.options.description),l=o.getTextFromHTML(a.options.description);return r<l?e?1:-1:r>l?e?-1:1:0}},array:function(e){return function(e,t,s,n,a){return s.options[a].length-n.options[a].length}},date:function(e){return function(e,t,s,n,a){if(s.options[a]&&n.options[a]){var i=s.options[a]<n.options[a]?-1:1;try{var o=new Date(s.options[a]),r=new Date(n.options[a]);i=o>r?1:o<r?-1:0}catch(e){}return i}return!s.options[a]&&n.options[a]?-1:!n.options[a]&&s.options[a]?1:0}},enumeration:function(e){var t={};switch(e){case"state":default:t=f.STATE_ENUM;break;case"priority":t=f.PRIORITY_ENUM}return function(e,s,n,a,i){var o=0;i=i.replace("ds6w:","");try{i in n.options&&i in a.options&&(e=n.options[i].toUpperCase(),s=a.options[i].toUpperCase(),o=t[e]-t[s])}catch(e){}return o}},assignees:function(e,t,s,n,a){var i=0;if("assignees"in s.options&&"assignees"in n.options){var o=s.options.assignees,r=n.options.assignees;i=o.length>=r.length?1:-1}return i},contributors:function(e,t,s,n,a){var i=0;if("contributors"in s.options&&"contributors"in n.options){var o=s.options.contributors,r=n.options.contributors;i=o.length>=r.length?1:-1}return i},informedUsers:function(e,t,s,n,a){var i=0;if("informedUsers"in s.options&&"informedUsers"in n.options){var o=s.options.informedUsers,r=n.options.informedUsers;i=o.length>=r.length?1:-1}return i},originator:function(e,t,s,n,a){return s.options.originator.lastName<n.options.originator.lastName?-1:s.options.originator.lastName>n.options.originator.lastName?1:0},owner:function(e,t,s,n,a){return s.options.owner.lastName<n.options.owner.lastName?-1:s.options.owner.lastName>n.options.owner.lastName?1:0},coOwners:function(e,t,s,n,a){var i=0;if("coOwners"in s.options&&"coOwners"in n.options){var o=s.options.coOwners,r=n.options.coOwners;i=o.length>=r.length?1:-1}return i}}})})),define("DS/IssueComponents/create/Specialization",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/SpinBox","DS/Controls/Toggle","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueServices/services/IssueServices","DS/IssueServices/Contexts","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g){"use strict";var h={UI_ACCESS:{READ_ONLY:"ReadOnly",NONE:"None"},CUSTOM_PROPERTY_TYPE:{MEMO:"textarea",DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},ISSUE_TYPE:"Issue",BOOL_TRUE:"TRUE",TEMPLATE_CUSTOM_ATTR_MAND_ENABLEMENT:"TemplateCustomAttrMandEnablement"};return t.extend({name:"DS/IssueComponents/create/Specialization",tag:"div",className:"create-view-content-subview create-specialize",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.DefaultType=h.ISSUE_TYPE,s.isInit=new e((function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t})),s.formElements={},s.formElementsToggler={},s.fields={},s.requiredLabels={},s.noShow=!0,s.noShowSubType=!0,s._customProperties=[],s.subTypeRes={};var n=[],a=s.getSubTypes();n.push(a),e.all(n).then(s._deferredInit.resolve).catch(s._deferredInit.reject)},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach((function(t){e.fields[t]=null,e.formElements[t]=null,e.formElementsToggler[t]=null}))},render:function(){var e=this;return e.form=new n({className:"create-properties-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container),e.form.getContent().setAttribute("novalidate",!1),e.isCustoAttrMandTemplate=f.get(h.TEMPLATE_CUSTOM_ATTR_MAND_ENABLEMENT),e.setFormContent(),e},getSubTypeAttributes:function(t){let s=[];var n={type:h.ISSUE_TYPE};return s.push(p.type.getSubTypesAllAttributes(n)),s.push(p.type.getSubTypesAllAttributes(t)),s.push(p.type.getProperties(t.type)),s.push(p.custom.getCustomAttributes({subType:t.type})),s.push(p.custom.getTypeInfo({subType:t.type})),e.all(s).then((t=>{let s=[];if(t.length>3&&t[3].body&&t[3].body.length>0){const e=f.get("ISU_DeploymentAttributes");t[3].body.forEach((t=>{if(null===e||null!==e&&!e.get(t.name)){var n=[],a="";if(t.NLSRange){let e=t.NLSRange.split("%@separator%");a="Yes",t.range.split(",").forEach((function(t,s){n.push({NLS:e[s],Name:t})}))}const e={Name:t.name,NLS:t.title,Type:t.type,DefaultValue:t.defaults,HasDefault:"",MultiValuated:"multival"==t.valuetype?"Yes":"No",MultiLine:t.multiline,UIAccess:t.UIAccess,AuthorizedValues:n,HasRangeDefined:a,mandatory:t.mandatory};s.push(e)}}))}s.length&&s.forEach((e=>{t[1].Attributes&&t[1].Attributes.push(e)}));var n={};if(t.length>1&&void 0!==t[2]){let e=t[2];if(Array.isArray(e.classPredicates)&&e.classPredicates.length>0)e.classPredicates[0].vocabularyPredicateInfo.forEach((e=>{e.userAccess&&(n[e.name]=e)}))}let a=t[0].Attributes.map((e=>e.Name));var i=t[1].Attributes.filter((e=>!a.includes(e.Name)));t[1].Attributes=i;let o=[];return t[4]&&t[4].body&&Array.isArray(t[4].body)&&t[4].body.forEach((e=>{o[e.name]={mandatory:e.val.Mandatory}})),t[1].Attributes.length&&t[1].Attributes.forEach((e=>{n[e.Name]&&(e.NLS=n[e.Name].nlsName),o[e.Name]&&(e.mandatory=!!o[e.Name].mandatory&&o[e.Name].mandatory)})),e.resolve(t[1])}))},updateTypeAttributeOnSelect:function(t){var n,a,i=this,o=new e(((e,t)=>{a=t,n=e})),r=[];if(i.form.elements.container.empty(),i._customProperties=[],i.noShow=!1,void 0!==t&&i.DefaultType!=t.type){var l=new e(((e,n)=>{i.getSubTypeAttributes(t).then((t=>{if(void 0!==t&&Array.isArray(t.Attributes)&&t.Attributes.length>0){var n=t.Attributes.map((e=>{var t=e.Type.toLowerCase();switch(t){case"date":t=h.CUSTOM_PROPERTY_TYPE.DATE;break;case"double":t=h.CUSTOM_PROPERTY_TYPE.REAL}var n=[],a=[];return"Yes"===e.HasRangeDefined&&e.AuthorizedValues.forEach((function(e){n.push(e.Name),a.push(e.NLS)})),{title:e.NLS,name:e.Name,type:t,defaults:e.DefaultValue,NLSRange:a,range:n,path:e.Name,UIAccess:s.is(e.UIAccess)?e.UIAccess:"",multiline:"Yes"==e.MultiLine?"true":"false",MultiValuated:"Yes"==e.MultiValuated?"true":"false",mandatory:e.mandatory}}));e(n)}else e()}))}));r.push(l)}return e.all(r).then((e=>{e.forEach((e=>{s.is(e,"array")&&(i._customProperties=i._customProperties.concat(e))})),i.setFormContent(),n()})).catch((e=>{a()})),o},getSubTypes:function(t){var s=this;return new e((t=>{p.type.getSubType().then((t=>(s.subTypeRes=t,null!=s.subTypeRes&&Object.keys(s.subTypeRes).length>1&&(s.noShowSubType=!1),e.resolve(t)))).catch((function(){return s.subTypeRes=null,e.resolve({Issue:{}})})).then(t)}))},setFormContent:function(e){var t=this;if(t._customProperties.length>0){var n=s.createElement("div",{class:"create-form-content"}),a=[],i=[];t._customProperties.forEach((function(e,s){var n=[],o={};if(null!==e.range){var r=e.NLSRange;e.range.forEach((function(e,t){n.push({labelItem:r[t],valueItem:e})}))}if(e.type==h.CUSTOM_PROPERTY_TYPE.DATE&&""==e.defaults&&(e.defaults=void 0),o.index=s,o.element=e.name,o.value=e.defaults,o.required=("Yes"===e.mandatory||1==e.mandatory)&&(!t.parent.parent.isTemplate||!!t.isCustoAttrMandTemplate),o.placeholder=t.getPlaceholder(e),o.help=t.getHelper(e),o.type=e.type,o.label=t.getLabel(e),o.rangeItems=n,o.UIAccess=e.UIAccess,o.requiredText=g.create.required,o.selectedIndex=-1,o.multiline=e.multiline,o.MultiValuated=e.MultiValuated,o.type!==h.CUSTOM_PROPERTY_TYPE.INT&&o.type!==h.CUSTOM_PROPERTY_TYPE.REAL||o.rangeItems.sort((function(e,t){return e-t})),o.rangeItems.length>0&&o.rangeItems.forEach((function(e,t){o.value===e&&(o.selectedIndex=t)})),h.UI_ACCESS.NONE!=e.UIAccess&&h.UI_ACCESS.READ_ONLY!=e.UIAccess){var l=t.createFormElement(o);o.required?a.push(l):i.push(l)}})),a.forEach((function(e){e.inject(n)})),i.forEach((function(e){e.inject(n)})),n.inject(t.form.elements.container)}},createFormElement:function(e){var t=this,n="create-form-element create-properties-form-element-"+e.element,a=t.formElements[e.element]=s.createElement("div",{class:n});t.parent.parent.isTemplate&&!e.required&&t.createVisibilityMask(e).inject(a);return t.createFormGroup(e).inject(a),a},createFormGroup:function(e){var t=this,n=s.createElement("div",{class:"create-form-field form-group"});return(e.required?t.createRequiredLabel(e):t.createLabel(e)).inject(n),t.createFormField(e).inject(n),n},createVisibilityMask:function(e){var t,n,a,i=this,o=s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[i.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]});return i.formElementsToggler[e.element].addEventListener("click",(t=i.formElements,n=i.formElementsToggler,a=e.element,function(){s.is(t[a])&&t[a].toggleClassName("visibility-masked"),s.is(n[a])&&(n[a].toggleClassName("fonticon-eye"),n[a].toggleClassName("fonticon-eye-off"))})),o},createRequiredLabel:function(e){var t=this;e.element,t.parent.parent.isTemplate&&t.isCustoAttrMandTemplate,t.parent.parent.isTemplate&&t.isCustoAttrMandTemplate;return t.requiredLabels[e.element]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:"required-form-field-title-label highlight",html:e.label}),s.createElement("div",{class:"required-form-field-required-label highlight wux-ui-3ds-required wux-ui-3ds"})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=this,n=s.createElement("div",{name:e.name,id:e.id}),a=null;if(e.rangeItems.length>0&&e.type!==h.CUSTOM_PROPERTY_TYPE.BOOL)a=t.createComboBox(e);else switch(e.type){case h.CUSTOM_PROPERTY_TYPE.TEXT:case h.CUSTOM_PROPERTY_TYPE.MEMO:if(s.is(e.MultiValuated)&&"true"==e.MultiValuated)(a=t.createComboBox(e)).allowFreeInputFlag=!0;else(a=t.createTextField(e)).getContent().querySelectorAll("input, div").forEach((function(e){e.style.width="100%",e.style.fontSize="medium"}));break;case h.CUSTOM_PROPERTY_TYPE.DATE:(a=t.createDateField(e)).getContent().querySelectorAll("input").forEach((function(e){e.style.fontSize="medium"}));break;case h.CUSTOM_PROPERTY_TYPE.BOOL:a=t.createBooleanField(e);break;case h.CUSTOM_PROPERTY_TYPE.INT:case h.CUSTOM_PROPERTY_TYPE.REAL:if(s.is(e.MultiValuated)&&"true"==e.MultiValuated){var i="";e.type===h.CUSTOM_PROPERTY_TYPE.INT?i="[0-9]+":e.type===h.CUSTOM_PROPERTY_TYPE.REAL&&(i="[0-9]+|([0-9]+.[0-9]+)"),(a=t.createComboBox(e)).allowFreeInputFlag=!0,a._editor.pattern=i}else a=t.createNumberField(e),t.fields[e.element].getContent().style.height="auto",a.getContent().style.width="100%",a.getContent().querySelectorAll("input").forEach((function(e){e.style.fontSize="medium"}))}return a.getContent().addEventListener("change",(function(){switch(e.type){case h.CUSTOM_PROPERTY_TYPE.TEXT:case h.CUSTOM_PROPERTY_TYPE.MEMO:t._customProperties[e.index].value=t.fields[e.element].value;break;case h.CUSTOM_PROPERTY_TYPE.DATE:var s=t.fields[e.element].value;t._customProperties[e.index].value=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear();break;case h.CUSTOM_PROPERTY_TYPE.BOOL:t._customProperties[e.index].value=t.fields[e.element].checkFlag?"true":"false";break;case h.CUSTOM_PROPERTY_TYPE.INT:case h.CUSTOM_PROPERTY_TYPE.REAL:var n=t.fields[e.element].value;t._customProperties[e.index].value=null!=n&&""!==n?n.toString():n}})),a.inject(n),n},createTextField:function(e){var t=null;"false"===e.multiline?(t=this.fields[e.element]=new i({value:e.value,requiredFlag:e.required,placeholder:e.placeholder})).getContent().setStyle("width","100%"):((t=this.fields[e.element]=new o({value:e.value,nbRows:4,requiredFlag:e.required,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t.getContent().querySelectorAll("textarea").forEach((function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="vertical",e.style.overflow="auto"})));return t},createDateField:function(e){var t=this.fields[e.element]=new a({value:e.value,minValue:e.minValue,maxValue:e.maxValue});return t.requiredFlag=e.required,t},createNumberField:function(e){var t="integer"===e.type?parseInt(e.value):parseFloat(e.value);return this.fields[e.element]=new l({value:t,stepValue:"integer"===e.type?1:.1,maxValue:"integer"===e.type?2147483646:999999999999999,requiredFlag:e.required})},createComboBox:function(e){var t=e.rangeItems,s=function(){var e=new u;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,a=t[s].valueItem,i=new m({label:n,value:a});e.addRoot(i)}return e.pushUpdate(),e}(),n=!1;"true"==e.MultiValuated&&(n=!0);var a=[];t.length>0&&t.forEach((function(t,n){e.value===t.labelItem&&a.push(s.getRoots()[n])}));var i=e.required,o=(e.placeholder,this.fields[e.element]=new d({elementsTree:s,multiSearchMode:n,selectedItems:a,allowFreeInputFlag:!1}));return(1==n||t.length>0)&&o.getContent().addEventListener("keydown",(function(e){13==e.keyCode&&e.stopPropagation()})),o.requiredFlag=i,o},createBooleanField:function(e){var t=this.fields[e.element]=new c({type:"switch",checkFlag:e.value.toLowerCase()===h.BOOL_TRUE.toLowerCase()});return t.getContent().addEventListener("keydown",(function(e){13==e.keyCode&&e.stopPropagation()})),t},show:function(){var e=this;e._parent(),e._customProperties.length>0&&e.fields[e._customProperties[0].name]&&"focus"in e.fields[e._customProperties[0].name]&&e.fields[e._customProperties[0].name].focus()},hide:function(){this._parent()},validate:function(){return this.form.fields=Object.values(this.fields).filter((function(e){return null!==e})),this.form.validate(!1,!1)},getValues:function(){var e=this,t={specialization:{}};return s.is(e.subTypeSelector,"object")&&(t.type=e.subTypeSelector.value),e._customProperties.forEach((function(e){e.range.length>0?""!=e.value&&(t.specialization[e.path]=e.value):t.specialization[e.path]=e.value})),t},getHiddenAttributes:function(){var e=this,t={custom:{}};for(var n in e.formElements)s.is(e.formElementsToggler[n])&&(t.custom[n]=e.formElementsToggler[n].hasClassName("fonticon-eye-off"));return t},reset:function(){var e=this;e._customProperties.forEach((function(t){if(t.value=t.defaults,e.fields[t.name])switch(t.type){case h.CUSTOM_PROPERTY_TYPE.TEXT:case h.CUSTOM_PROPERTY_TYPE.MEMO:e.fields[t.name].value=t.defaults;break;case h.CUSTOM_PROPERTY_TYPE.DATE:break;case h.CUSTOM_PROPERTY_TYPE.BOOL:e.fields[t.name].checkFlag="true"===t.defaults.toLowerCase();break;case h.CUSTOM_PROPERTY_TYPE.INT:case h.CUSTOM_PROPERTY_TYPE.REAL:e.fields[t.name].value=""===t.defaults?0:"integer"===t.type?parseInt(t.defaults):parseFloat(t.defaults)}}))},applyTemplate:function(t){var n,a=this;a.reset();var i=new e(((e,t)=>{t,n=e}));if(s.is(a.subTypeSelector,"object")){a.subTypeSelector.removeEventListener("change",a.subTypeSelectorClick),a.subTypeSelector.value=s.is(t.data.type,"string")?t.data.type:a.DefaultType,a.subTypeSelector.addEventListener("change",a.subTypeSelectorClick);var o={type:a.subTypeSelector.value}}return a.parent.parent.options.editMode&&(a.subTypeSelector.disabled=!0),a.updateTypeAttributeOnSelect(o).then((()=>{if(s.is(t.data,"object")&&(s.is(t.data.specialization,"object")||s.is(t.data.custom,"object"))&&a._customProperties.forEach((function(e){if(s.is(t.data.specialization[e.path],"string")||s.is(t.data.custom[e.path],"string")){if(e.value=""==t.data.specialization[e.path]||t.data.specialization[e.path]?t.data.specialization[e.path]:t.data.custom[e.path],e.value.includes("")&&(e.value=e.value.split("")),a.fields[e.name])switch(e.type){case h.CUSTOM_PROPERTY_TYPE.TEXT:case h.CUSTOM_PROPERTY_TYPE.MEMO:case h.CUSTOM_PROPERTY_TYPE.DATE:a.fields[e.name].value=e.value;break;case h.CUSTOM_PROPERTY_TYPE.BOOL:a.fields[e.name].checkFlag="true"===e.value.toLowerCase();break;case h.CUSTOM_PROPERTY_TYPE.INT:case h.CUSTOM_PROPERTY_TYPE.REAL:a.fields[e.name].value=""===e.value?"0":e.value}}else(s.is(t.data.custom[e.path],"array")||s.is(t.data.specialization[e.path],"array"))&&(e.value=[],e.value=t.data.specialization[e.path]?t.data.specialization[e.path]:t.data.custom[e.path],e.type==h.CUSTOM_PROPERTY_TYPE.BOOL&&(t.data.custom[e.path].length>0?e.value="true"===t.data.custom[e.path][0].toLowerCase():e.value=!1,a.fields[e.name].checkFlag=e.value),e.type==h.CUSTOM_PROPERTY_TYPE.DATE&&(a.fields[e.name].value=e.value[0]),a.fields[e.name].value=e.value)})),s.is(t.hidden,"object")&&s.is(t.hidden.custom,"object")&&s.is(a.formElements,"object")&&s.is(a.formElementsToggler,"object")){var e=a.formElements,i=a.formElementsToggler;for(var o in e)!0===t.hidden.custom[o]&&(a.parent.parent.isTemplate?(s.is(e[o])&&e[o].toggleClassName("visibility-masked",!0),s.is(i[o])&&(i[o].toggleClassName("fonticon-eye-off",!0),i[o].toggleClassName("fonticon-eye",!1))):s.is(e[o])&&e[o].hide())}n()})),i},getLabel:function(e){var t="",s=g.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getPlaceholder:function(e){var t="",s=g.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getHelper:function(e){var t="",s=g.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.helper)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getSubTypePicker:function(e){var t=this;t.myTreeDocument=new u;var n=new m({label:t.DefaultType});t.myTreeDocument.addRoot(n),t.subTypeRes=s.is(e,"object")?e:t.subTypeRes;var a={"ds6w:type":[]};if(null!=t.subTypeRes&&Object.keys(t.subTypeRes).length>1){var i=Object.keys(t.subTypeRes);i.sort((function(e,t){return e.localeCompare(t)})),i.forEach((e=>{var s={label:e,grid:{valueItem:e}};e!=t.DefaultType&&(t.myTreeDocument.addRoot(new m(s)),a["ds6w:type"].push(e))})),t.noShow=!1}t.myTreeDocument.expandAll(),a["ds6w:type"].length>0&&p.getNLSValuesPromise(a).then((e=>{s.is(e)&&s.is(e["ds6w:type"])&&t.myTreeDocument.getAllDescendants().forEach((t=>{var n=t.options.grid.valueItem;s.is(e["ds6w:type"][n])&&(t.options.label=e["ds6w:type"][n])}))}));var o=t.subTypeSelector=new r({enableSearchFlag:!1,elementsTree:t.myTreeDocument});o.getContent().style.width="100%";var l=o.getContent().querySelectorAll("button")[0];l.onfocusin=function(){o.getContent().style.borderColor="#368ec4"},l.onmouseout=function(){o.getContent().style.borderColor="#b4b6ba"},l.onmouseover=function(){o.getContent().style.borderColor="#77797c"},o.getContent().querySelectorAll("button").forEach((function(e){e.style.background="white"})),t.subTypeSelectorClick=function(e){var s={type:t.subTypeSelector.value};t.fields={},t.updateTypeAttributeOnSelect(s)},t.subTypeSelector.addEventListener("change",t.subTypeSelectorClick);var c=s.createElement("div",{class:"issue-comboBox-Type"});return t.subTypeSelector.inject(c),t.subTypeSelector}})})),define("DS/IssueComponents/create/Team",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/SearchWidget/SearchWidgetConstant","DS/UIKIT/Form","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/search/PeopleSearch","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I){"use strict";var y="_PRJ",E={OWNER:"owner",CO_OWNERS:"coOwners",ASSIGNEES:"assignees",CONTRIBUTORS:"contributors",INFORMEDUSERS:"informedUsers"};return e.extend({name:"DS/IssueComponents/create/Team",tag:"div",className:"create-view-content-subview create-team",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(e){var s=this;s._parent(e),s.parent=e.parent,s.isInit=new t((function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t})),s.form=null,s.formElements={owner:null,coOwners:null,assigness:null,contributors:null,informedUsers:null},s.formElementsToggler={owner:null,coOwners:null,assigness:null,contributors:null,informedUsers:null},s.fields={assignToMe:null,addOwner:null,addCoOwners:null,addAssignees:null,addReviewers:null,addContributors:null,addInformedUsers:null},s.values={owner:{},coOwners:{},assignees:{},contributors:{},informedUsers:{}},s.listenTo(s.parent,"related-add-reportedAgainst",(function(e){let t={user:e.data.owner,fullName:e.data.responsible};s._addUser(t,"assignees")})),h.organizations.getCompanies({onComplete:function(e){s.organizations=e.body},onFailure:function(){s.organizations=[]}}).finally((function(){s._deferredInit.resolve()}))},destroy:function(){var e=this;e.form=null,e.formElements={coOwners:null,assigness:null,contributors:null},e.formElementsToggler={coOwners:null,assigness:null,contributors:null},e.fields={assignToMe:null},e.values={coOwners:{},assignees:{},contributors:{}}},render:function(){var e=this;return e.form=new r({className:"create-team-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container),s.createElement("div",{class:"create-form-content",html:[e.formElements.owner=s.createElement("div",{class:"create-form-element create-team-form-element-owner",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.owner=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group template-owner-field",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",class:"create-form-field-owner-label",html:[I.create.team.labels.owner,e.fields.ownerHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]}),{tag:"div",class:"issue-owner-search-container",html:[s.createElement("div",{class:"form-group-owner",html:e.fields.addOwner=e._peopleSearch(E.OWNER)}),e.fields.owner=s.createElement("div",{class:"form-group-owner-holder"})]}]}]}),e.formElements.coOwners=s.createElement("div",{class:"create-form-element create-team-form-element-coowners",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.coOwners=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",class:"create-form-field-coOwners-label",html:[I.create.team.labels.coOwners,e.fields.coOwnersHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]}),{tag:"div",class:"issue-coowners-search-container",html:[s.createElement("div",{class:"form-group-coowners",html:e.fields.addCoOwners=e._peopleSearch(E.CO_OWNERS)}),e.fields.coOwners=s.createElement("div",{class:"form-group-coowners-holder"})]}]}]}),e.formElements.assignees=s.createElement("div",{class:"create-form-element create-team-form-element-assignees",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.assignees=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",class:"create-form-field-assignees-label",html:[I.create.team.labels.assignees,e.fields.assigneesHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]},{tag:"span",class:"issue-assign-to-me",html:e.fields.assignToMe=new c({type:"checkbox",value:"assign-me",label:I.create.team.labels.assignToMe,checked:!1,className:"primary",events:{onChange:function(){this.isChecked()?e._addUser({user:v.getUserName(),fullName:v.getFullName(),position:0},E.ASSIGNEES):e._removeUser({user:v.getUserName(),fullName:v.getFullName()},E.ASSIGNEES)}}})}]}),{tag:"div",class:"issue-assignees-search-container",html:[s.createElement("div",{class:"form-group-assignees",html:e.fields.addAssignees=e._peopleSearch(E.ASSIGNEES)}),e.fields.assignees=s.createElement("div",{class:"form-group-assignees-holder"})]}]}]}),e.formElements.contributors=s.createElement("div",{class:"create-form-element create-team-form-element-contributors",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.contributors=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",class:"create-form-field-contributors-label",html:[I.create.team.labels.contributors,e.fields.contributorHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]}),{tag:"div",class:"issue-contributors-search-container",html:[s.createElement("div",{class:"form-group-contributors",html:e.fields.addContributors=e._peopleSearch(E.CONTRIBUTORS)}),e.fields.contributors=s.createElement("div",{class:"form-group-contributors-holder"})]}]}]}),e.formElements.informedUsers=s.createElement("div",{class:"create-form-element create-team-form-element-informedUsers",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.informedUsers=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",class:"create-form-field-informedUsers-label",html:[I.create.team.labels.informedUsers,e.fields.informedUserHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]}),{tag:"div",class:"issue-informedUsers-search-container",html:[s.createElement("div",{class:"form-group-informedUsers",html:e.fields.addInformedUsers=e._peopleSearch(E.INFORMEDUSERS)}),e.fields.informedUsers=s.createElement("div",{class:"form-group-informedUsers-holder"})]}]}]})]}).inject(e.form.elements.container),e.parent.isTemplate&&document.getElementsByClassName("template-owner-field")&&document.getElementsByClassName("template-owner-field").item(Element)&&document.getElementsByClassName("template-owner-field").item(Element).addClassName("disable-template-owner-field"),f.updatePanelTooltip(e.fields,"ownerHelper"),f.updatePanelTooltip(e.fields,"coOwnersHelper"),f.updatePanelTooltip(e.fields,"assigneesHelper"),f.updatePanelTooltip(e.fields,"contributorHelper"),f.updatePanelTooltip(e.fields,"informedUserHelper"),e.reset().then(e._deferredInit.resolve),e},getValues:function(){var e=this;return{owner:{user:Object.keys(e.values.owner)[0]},coOwners:Object.values(e.values.coOwners).map((function(e){return{user:e.user,type:e.type}})),assignees:Object.values(e.values.assignees).map((function(e){return{user:e.user,type:e.type}})),contributors:Object.values(e.values.contributors).map((function(e){return{user:e.user,type:e.type}})),informedUsers:Object.values(e.values.informedUsers).map((function(e){return{user:e.user,type:e.type}}))}},getUIValues:function(){var e=this;return{owner:e.values.owner,coOwners:e.values.coOwners,assignees:e.values.assignees,contributors:e.values.contributors,informedUsers:e.values.informedUsers}},getHiddenAttributes:function(){var e=this,t={};for(var n in e.formElements)s.is(e.formElementsToggler[n])&&(t[n]=e.formElementsToggler[n].hasClassName("fonticon-eye-off"));return t},applyTemplate:function(e){var n=this;return n.reset().then((function(){if(s.is(e.ui)&&(s.is(e.ui.owner,"object")&&n._addUser({user:v.getUserName(),fullName:v.getFullName(),position:0},E.OWNER),s.is(e.ui.coOwners,"object")&&Object.keys(e.ui.coOwners).forEach((function(t){n._addUser(e.ui.coOwners[t],E.CO_OWNERS)})),s.is(e.ui.assignees,"object")&&Object.keys(e.ui.assignees).forEach((function(t){n._addUser(e.ui.assignees[t],E.ASSIGNEES)})),s.is(e.ui.contributors,"object")&&Object.keys(e.ui.contributors).forEach((function(t){n._addUser(e.ui.contributors[t],E.CONTRIBUTORS)})),s.is(e.ui.informedUsers,"object")&&Object.keys(e.ui.informedUsers).forEach((function(t){n._addUser(e.ui.informedUsers[t],E.INFORMEDUSERS)}))),s.is(e.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var a=n.formElements,i=n.formElementsToggler;for(var o in a)!0===e.hidden[o]&&(n.parent.isTemplate?(s.is(a[o])&&a[o].toggleClassName("visibility-masked",!0),s.is(i[o])&&(i[o].toggleClassName("fonticon-eye-off",!0),i[o].toggleClassName("fonticon-eye",!1))):s.is(a[o])&&a[o].hide())}return t.resolve()}))},reset:function(){var e=this;return new t((function(t){Object.keys(e.values.owner).forEach((function(t){e._removeUser(e.values.owner[t],E.OWNER)})),e._addUser({user:v.getUserName(),fullName:v.getFullName()},E.OWNER),Object.keys(e.values.coOwners).forEach((function(t){e._removeUser(e.values.coOwners[t],E.CO_OWNERS)})),Object.keys(e.values.assignees).forEach((function(t){e._removeUser(e.values.assignees[t],E.ASSIGNEES)})),Object.keys(e.values.contributors).forEach((function(t){e._removeUser(e.values.contributors[t],E.CONTRIBUTORS)})),Object.keys(e.values.informedUsers).forEach((function(t){e._removeUser(e.values.informedUsers[t],E.INFORMEDUSERS)})),t()}))},_peopleSearch:function(e){var t=this,s="";e!==E.OWNER&&(s=o.EXTTYPE_USERGRP);var n=new g({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:o.TYPE_PERSON,exttype:s,events:{onValid:function(){var s=n.getNewOwner().person,a=n.getNewOwner().userGrp;void 0!==s?t._addUser({user:s.personID.replace(y,""),fullName:s.personFullName,type:"person"},e):void 0!==a&&t._addUser({user:a.id,fullName:a.label,type:"group"},e),n.clearInput(),n.getContent().searchInput.focus()},onUnvalid:function(){},onError:function(){i.displayNotification({msg:I.team.error.notFound,eventID:"info"})},onValidUsers:function(s){Object.keys(s).map((function(e){return s[e]})).forEach((function(s){var n={};n.user=s.name,n.fullName=s.firstname+" "+s.lastname,t._addUser(n,e)})),n.clearInput(),n.getContent().searchInput.focus()}}});return n.setSelectedItemList([{objectID:t.organizations[0].physicalId}]),n},_addUser:function(e,t){var n=this;if(t===E.OWNER&&(Object.keys(n.values.owner).forEach((function(e){n._removeUser(n.values.owner[e],E.OWNER)})),n.values.coOwners.hasOwnProperty(e.user)&&n._removeUser(n.values.coOwners[e.user],E.CO_OWNERS)),t===E.CO_OWNERS&&n.values.owner.hasOwnProperty(e.user))i.displayNotification({msg:I.create.team.cannotAddOwnerAsCoOwner,eventID:"error"});else if(n.values[t][e.user])i.displayNotification({msg:I.replace(I.create.team.alreadyAssigned,{name:e.fullName}),eventID:"info"});else{var a=n._createUserHTML(e,t);if(t!==E.OWNER){var o=s.createElement("span",{class:"team-content-user-remove wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(a),r=new d({position:"left",target:o,body:I.create.team.removeAssignee,animate:!1});o.addEventListener("click",(function(){n._removeUser(e,t),r.destroy()}))}n._isInteger(e.position)?n.fields[t].insertBefore(a,n.fields[t].children[e.position]):n.fields[t].appendChild(a),t!==E.ASSIGNEES||e.user!==v.getUserName()||n.fields.assignToMe.isChecked()||n.fields.assignToMe.check(),e.element=a,n.values[t][e.user]=e}},_removeUser:function(e,t){var s=this;s.values[t][e.user]&&(t===E.ASSIGNEES&&e.user===v.getUserName()&&!0===s.fields.assignToMe.isChecked()&&s.fields.assignToMe.uncheck(),s.values[t][e.user].element.destroy(),delete s.values[t][e.user])},_createUserHTML:function(e,t){var n=s.createElement("div",{id:t+"-"+p.getTextFromHTML(e.user),class:"team-content-user-container"});("group"===e.type?s.createElement("span",{class:"team-content-user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group",title:e.fullName}):v.getUserImageElement(e,!0,{cssClass:"team-content-user-img",Title:p.getTextFromHTML(e.fullName+" ("+e.user+")")})).inject(n);var a=s.createElement("div",{class:"team-content-user-info"}).inject(n);return"group"===e.type?s.createElement("span",{class:"team-content-user-group-label",html:p.getTextFromHTML(e.fullName)}).inject(a):(s.createElement("span",{class:"team-content-user-full-name",html:p.getTextFromHTML(e.fullName)}).inject(a),s.createElement("span",{class:"team-content-user-id",html:p.getTextFromHTML(e.user)}).inject(a)),n},_isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}})})),define("DS/IssueComponents/team/MembersTileViewLayout",["UWA/Core","DS/IssueComponents/team/MembersGridUtil"],(function(e,t){"use strict";return{}})),define("DS/IssueComponents/create/PropertiesNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/DatePicker","DS/Controls/TooltipModel","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/PADUtils/views/PADAlert","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/create/CustomNew","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/WUXAutoComplete/AutoComplete","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/create/Classification","DS/IssueComponents/create/Specialization","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y,E,S,w,T,D,A,_,O,N,R,M){"use strict";var P="ISU_TYPE_NLS",L=1e3;return t.extend({name:"DS/IssueComponents/create/PropertiesNew",tag:"div",className:"create-view-content-subview create-properties",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e((function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t})),s.settings=JSON.parse(M),s.autoCompleteMultiSel=null,s.form=null,s.formElements={title:null,type:null,similarIssues:null,description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.formElementsToggler={description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.fields={title:null,titleLabel:null,similarIssues:null,similarIssuesLabel:null,description:null,escalationRequired:null,classifications:null,attributes:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.values={libIDs:[],classIDs:[],classNames:[],reportingOrganization:null,responsibleOrganization:null,reportingOrganizationTitle:null,responsibleOrganizationTitle:null},s.selected={classes:{},attributes:{},_classificationData:[],templateAttributes:{},attributeFields:{}};var n=[];if(s.customPropertiesView=new v({parent:s}),n.push(s.customPropertiesView.isInit),s.specializeProperties=new _({parent:s}),n.push(s.specializeProperties.isInit),s.settings.enableClassification){var a=new e((function(e,t){C.classification.getLibraries().then((function(e){return e.member})).then((function(e){s.classModel=new T({shouldBeSelected:function(e){return"Class"===e.options.grid.type},useAsyncPreExpand:!0}),s.classModel.prepareUpdate(),null!=e&&e.forEach((function(e){if("Active"==e.state&&"Standard"!=e.libraryUsage){s.values.libIDs.push(e.id);var t=s._createNode(e.title,e.id,"library","Library",e.libraryName,e.id);s.classModel.addRoot(t)}})),s.classModel.onPreExpand((function(e){var t=e.data.nodeModel;t.hasChildren()?e.target.preExpandDone():C.classification.getClasses({libId:t.options.id}).then((function(n){var a=n.member[0].ChildClasses.member,i=""!==n.member[0].title?n.member[0].title:n.member[0].name;s.classModel.prepareUpdate(),a.forEach((function(n){if("Active"==n.state&&"Standard"!=n.classUsage){s.values.classIDs.push(n.id);var a=""!==n.title?n.title:n.name;s.values.classNames.push(a);var o=i+" > "+a,r=t.options.id+","+n.id,l=s._createNode(a,n.id,"library-class","Class",o,r);e.target.addChild(l);var c=function(e,t){e.ChildClasses&&e.ChildClasses.member&&e.ChildClasses.member.forEach((function(e){if("Active"==e.state&&"Standard"!=e.classUsage){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n),r=t.options.grid.idPath+","+e.id,o=t.options.grid.path+" > "+n;var a=s._createNode(n,e.id,"library-class","Class",o,r);t.addChild(a),c(e,a)}}))};c(n,l)}})),s.classModel.pushUpdate(),e.target.preExpandDone()}))})),s.classModel.pushUpdate()})).finally((function(){e()}))}));n.push(a)}var i=new e((function(e,t){C.organizations.getCompanies({onComplete:function(e){s.organizations=e.body},onFailure:function(){s.organizations=[]}}).finally((function(){e()}))}));n.push(i);var o=new e((function(e,t){C.getExpressionValue({onComplete:function(e){var t=["ISU_AUTO_DATES"];e&&e.data&&e.data.forEach((function(e){if(e.dataelements){var s=Object.keys(e.dataelements);for(var n in s)t.indexOf(s[n])>=0&&b.add([s[n]],e.dataelements[s[n]])}}))},onFailure:function(){}}).finally((function(){e()}))}));n.push(o),e.all(n).then(s._deferredInit.resolve).catch((function(e){s._deferredInit.reject(e)})),s._similarIssues=[],s._debouncedSearch=g.debounce(s._searchSimilarIssues.bind(s),L)},_createNode:function(e,t,s,n,a,i){return new D({label:e,id:t,icons:[s],grid:{idPath:i,type:n,path:a},children:"Library"===n?[]:null})},_addClasesForLibraries:function(){var t=this,s=[],n=!0;return t.classModel.getRoots().forEach((function(a){if(!a.isExpanded()){n=!1;var i=new e((e=>{t._addClassesForLibrary(a).then(e)}));s.push(i)}})),n?e.resolve():e.all(s)},_addClassesForLibrary:function(t){var s=this;return new e((e=>{C.classification.getClasses({libId:t.options.id}).then((function(n){if(t.isExpanded())e();else{s.classModel.prepareUpdate();var a=n.member[0].ChildClasses.member,i=""!==n.member[0].title?n.member[0].title:n.member[0].name;a.forEach((function(e){if("Active"==e.state&&"Standard"!=e.classUsage){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n);var a=i+" > "+n,o=t.options.id+","+e.id,r=s._createNode(n,e.id,"library-class","Class",a,o);t.addChild(r);var l=function(e,t){e.ChildClasses&&e.ChildClasses.member&&e.ChildClasses.member.forEach((function(e){if("Active"==e.state&&"Standard"!=e.classUsage){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n),o=t.options.grid.idPath+","+e.id,a=t.options.grid.path+" > "+n;var i=s._createNode(n,e.id,"library-class","Class",a,o);t.addChild(i),t.expandAll(),l(e,i)}}))};l(e,r)}})),t.expandAll(),s.classModel.pushUpdate(),e()}}))}))},destroy:function(){var e=this;e.form=null,e.formElements={title:null,type:null,similarIssues:null,description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null},e.formElementsToggler={description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null},e.fields={title:null,type:null,titleLabel:null,similarIssues:null,similarIssuesLabel:null,description:null,classifications:null,attributes:null,resolutionRecommendation:null,priority:null,resolutionDate:null},e.values={libIDs:[],classIDs:[],classNames:[]},e.selected={classes:{},attributes:{},_classificationData:[],templateAttributes:{},attributeFields:{}},e._issuesForSimilarity=null,s.is(e.specializeProperties,"object")&&e.specializeProperties.destroy(),s.is(e.customPropertiesView,"object")&&e.customPropertiesView.destroy()},render:function(){var t=this,a=b.get("widget")||window.widget;t.form=new n({className:"create-properties-form"}).inject(t.container),t.form.getContent().setAttribute("novalidate",!1);var i=new Date,o=new Date(i);o.setDate(o.getDate()-1);var r=new Date(i);r.setDate(r.getDate()+7);var l=s.createElement("div",{class:"create-form-content"}),c={id:"",name:"",element:"",type:"",placeholder:"",required:!1,value:"",minValue:"",maxValue:"",cssClass:"create-form-field",help:"",label:"",emphasize:"",icons:"",requiredText:R.create.required};c.element="title",c.type="text",c.placeholder="",c.required=!0,c.help=R.create.properties.labels.titleHelper,c.label=R.create.properties.labels.title;var d=t.createFormElement(c);t.parent.isTemplate&&(t.fields.title.requiredFlag=!1),d.inject(l),c.element="type",c.type="subType",c.placeholder=R.create.properties.labels.titlePlaceholder,c.required=!0,c.help=R.create.properties.labels.typeHelper,c.label=R.create.properties.labels.type;d=t.createFormElement(c);t.specializeProperties.noShowSubType||d.inject(l),t.avaialbleUserCredentials=t.parent.avaialbleUserCredentials,c.element="collaborativeSpace",c.type="comboBox",c.required=!0,c.label=R.collaborativeSpace,c.placeholder=R.selectCollaborativeSpacePlaceholder,c.enableSearchFlag=!1;var u="required-form-field-required-label"+(t.parent.isTemplate?"":" highlight"),m=t.formElements.collaborativeSpace=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:"create-form-field-label",html:R.collaborativeSpace}),s.createElement("div",{class:u+" wux-ui-3ds-required wux-ui-3ds"}),t.fields.collabSpaceHelper=s.createElement("span",{class:"fonticon fonticon-help isu-help-icon"})]});h.updatePanelTooltip(t.fields,"collabSpaceHelper");var p,f,v=t.getCollaborativeSpaceData(t.avaialbleUserCredentials);c.elementsList=v.map((e=>({labelItem:e.title,valueItem:e.name}))),a.getPreference("pad_security_ctx")&&(p=a.getPreference("pad_security_ctx").value),p&&(f=p.split("ctx::")[1]);var y=t.avaialbleUserCredentials.credentials.findIndex((e=>e.ctxname===f)),E=-1;f&&y>-1&&(E=v.findIndex((e=>e.name===f.split(".")[2]))),c.reachablePlaceholderFlag=(void 0===y||-1==y)&&v.length>1;var S=t.fields.collaborativeSpace=new w(c);E&&E>-1&&(t.fields.collaborativeSpace.selectedIndex=E),1===v.length&&(t.fields.collaborativeSpace.selectedIndex=0),t.fields.collaborativeSpace.required=c.required,1===v.length&&(t.fields.collaborativeSpace.disabled=!0),v.length>=1&&(m.inject(l),S.getContent().setStyle("width","100%"),S.inject(l));var T=[];c.element="organization",c.type="comboBox",c.required=!0,c.label=R.organization,c.placeholder=R.selectOrganizationPlaceholder,c.enableSearchFlag=!1;var D=t.formElements.organization=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:"create-form-field-label",html:R.organization}),s.createElement("div",{class:u+" wux-ui-3ds-required wux-ui-3ds"}),t.fields.organizationHelper=s.createElement("span",{class:"fonticon fonticon-help isu-help-icon"})]});h.updatePanelTooltip(t.fields,"organizationHelper");var A=t.getAllAssignedOrganizations(t.avaialbleUserCredentials);T=t.getOrganizationsData(t.avaialbleUserCredentials);c.elementsList=T.map((e=>({labelItem:e.title,valueItem:e.name})));var _=-1;f&&y>-1&&(_=T.findIndex((e=>e.name===f.split(".")[1]))),c.reachablePlaceholderFlag=!0;var O=t.fields.organization=new w(c);_>-1&&(t.fields.organization.selectedIndex=_),t.fields.organization.required=c.required,D.inject(l),O.getContent().setStyle("width","100%"),O.inject(l),t.fields.collaborativeSpace.addEventListener("change",(function(){T=t.getOrganizationsData(t.avaialbleUserCredentials),t.updateComboBoxFields(T,"organization"),t.fields.organization.selectedIndex=-1,1===T.length&&A.length>1?(D.show(),O.show(),t.fields.organization.selectedIndex=0,O.disabled=!0):T.length>1&&A.length>1?(D.show(),O.show(),O.disabled=!1):1===T.length&&1===A.length?(t.fields.organization.selectedIndex=0,D.hide(),O.hide()):(D.hide(),O.hide())})),1===T.length&&A.length>1&&(D.show(),O.show(),t.fields.organization.selectedIndex=0,O.disabled=!0),1===A.length&&(D.hide(),O.hide(),t.fields.organization.selectedIndex=0,O.disabled=!0),-1===y&&void 0===t.fields.collaborativeSpace.value&&(D.show(),O.show(),O.disabled=!0),t.parent.isTemplate&&(m.hide(),S.hide(),D.hide(),O.hide());t.formElements.title.getElementsByClassName("form-group")[0].querySelectorAll("input, div");t.formElements.title.querySelectorAll("input")[0].oninput=function(e){var s=this.value;t.parent&&!t.parent.isTemplate&&t.parent.updateTitle(s),t.parent.isTemplate?(t.fields.titleLabel.getElement(".required-form-field-required-label").removeClassName("highlight"),t.fields.titleLabel.getElement(".required-form-field-title-label").removeClassName("highlight")):(t.fields.titleLabel.getElement(".required-form-field-required-label").addClassName("highlight"),t.fields.titleLabel.getElement(".required-form-field-title-label").addClassName("highlight")),t._debouncedSearch()},t.fields.title.addEventListener("change",(function(e){var s=t.formElements.title.querySelectorAll("input")[0];if(!e||document.activeElement!==s){var n=t.fields.title.value.trim();t.fields.title.value=n,t.parent.isTemplate?(t.fields.titleLabel.getElement(".required-form-field-required-label").removeClassName("highlight"),t.fields.titleLabel.getElement(".required-form-field-title-label").removeClassName("highlight")):(t.fields.titleLabel.getElement(".required-form-field-required-label").addClassName("highlight"),t.fields.titleLabel.getElement(".required-form-field-title-label").addClassName("highlight")),t._debouncedSearch()}}));var N=t.similarIssueDiv();t.formElements.similarIssues=N,N.inject(l),t.formElements.similarIssues.hide(),c.element="description",c.type="memo",c.placeholder=R.create.properties.labels.descriptionPlaceholder,c.required=!1,c.help=R.create.properties.labels.descriptionHelper,c.label=R.create.properties.labels.description,c.value="",c.rangeItems=[],t.createFormElement(c).inject(l),t.formElements.description.getElementsByClassName("form-group")[0].querySelectorAll("textarea").forEach((function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="vertical",e.style.overflow="auto"})),t.createClassificationField(c).inject(l),c.element="resolutionRecommendation",c.type="memo",c.placeholder=R.create.properties.labels.resolutionRecommendationPlaceholder,c.required=!1,c.value="",c.minValue="",c.maxValue="",c.cssClass="",c.label=R.create.properties.labels.resolutionRecommendation,c.help=R.create.properties.labels.resolutionRecommendationHelper,t.createFormElement(c).inject(l),t.formElements.resolutionRecommendation.getElementsByClassName("form-group")[0].querySelectorAll("textarea").forEach((function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="vertical",e.style.overflow="auto"})),c.element="priority",c.type="buttonToggle",c.placeholder=R.create.properties.labels.priority,c.required=!1,c.id=["Low","Medium","High","Urgent"],c.value=["low","medium","high","urgent"],c.emphasize=["success","info","medium-attention","high-attention"],c.icons=["level-low","level-medium","level-high","alert"],c.minValue="",c.maxValue="",c.cssClass="",c.label=R.priorities.title,c.help=R.create.properties.labels.priorityHelper,t.createFormElement(c).inject(l);var M=b.get("ISU_AUTO_DATES");c.element="resolutionDate",c.type="date",c.placeholder=R.create.properties.labels.dueDatePlaceholder,c.required=!1,c.value="true"==M?r:void 0,c.emphasize="",c.icons="",c.minValue=o,c.maxValue="",c.cssClass="",c.label=R.create.properties.labels.dueDate,c.help=R.create.properties.labels.dueDatePlaceholder,t.createFormElement(c).inject(l),t.formElements.resolutionDate.getElementsByClassName("form-group")[0].querySelectorAll("input").forEach((function(e){e.style.fontSize="medium"})),c.element="estimatedEndDate",c.type="date",c.placeholder=R.create.properties.labels.estimatedEndDatePlaceholder,c.required=!1,c.value=void 0,c.emphasize="",c.icons="",c.minValue=o,c.maxValue="",c.cssClass="",c.label=R.create.properties.labels.estimatedEndDate,c.help=R.create.properties.labels.estimatedEndDatePlaceholder,t.createFormElement(c).inject(l),t.formElements.estimatedEndDate.getElementsByClassName("form-group")[0].querySelectorAll("input").forEach((function(e){e.style.fontSize="medium"})),c.element="escalationRequired",c.name="escalationRequired",c.id="escalationRequired_id",c.type="comboBox",c.label=R.create.properties.labels.escalationRequired,c.rangeItems=[{labelItem:R.create.properties.labels.escalationRequired_No,valueItem:"No"},{labelItem:R.create.properties.labels.escalationRequired_Yes,valueItem:"Yes"}],c.value="No",c.selectedIndex=0,c.enableSearchFlag=!1,t.createFormElement(c).inject(l);let P=t.formElements.reportingOrganization=s.createElement("div",{class:"create-form-element create-properties-form-element-reporting-organization",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[t.formElementsToggler.reportingOrganization=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",class:"create-form-field-reporting-organization-label",html:[R.create.team.labels.reportingOrganization,t.fields.reportingOrganizationHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]},{tag:"div",html:[t.fields.addReportingOrganization=t._orgSearch("reportingOrganization"),t.fields.reportingOrganization=s.createElement("div",{class:"form-group-reporting-organization-holder"})]}]}]});t._setOrganization(I.getCurrentCredentials().organization,"reportingOrganization",I.getCurrentCredentials().details.orgNls),h.updatePanelTooltip(t.fields,"reportingOrganizationHelper"),P.inject(l);let L=t.formElements.responsibleOrganization=s.createElement("div",{class:"create-form-element create-properties-form-element-responsible-organization",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[t.formElementsToggler.responsibleOrganization=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",class:"create-form-field-responsible-organization-label",html:[R.create.team.labels.responsibleOrganization,t.fields.responsibleOrganizationHelper=s.createElement("div",{class:"create-form-help-icon-tooltip",html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]},{tag:"div",html:[t.fields.addResponsibleOrganization=t._orgSearch("responsibleOrganization"),t.fields.responsibleOrganization=s.createElement("div",{class:"form-group-responsible-organization-holder"})]}]}]});return t._setOrganization(I.getCurrentCredentials().organization,"responsibleOrganization",I.getCurrentCredentials().details.orgNls),h.updatePanelTooltip(t.fields,"responsibleOrganizationHelper"),L.inject(l),l.inject(t.form.elements.container),t.values.libIDs.length>0?(t.formElements.classifications.show(),null!=b.get("classAttrNLS")&&null!=b.get("classAttrNLS")||new e(((e,t)=>{C.classification.fetchClassificationAttributes().then((t=>{g.setClassificationAttrNLS(t),e()})).catch((t=>{e()}))}))):t.formElements.classifications.hide(),s.is(t.specializeProperties,"object")&&!t.specializeProperties.noShow&&t.form.elements.container.addContent(t.specializeProperties.render()),s.is(t.customPropertiesView,"object")&&!t.customPropertiesView.noShow&&t.form.elements.container.addContent(t.customPropertiesView.render()),t},getCollaborativeSpaceData:function(e){var t=[],s=[];return e.credentials.forEach((e=>{if(e.ctxtitle){t.some((t=>t.name===e.prjname))||t.push({title:e.prjtitle?e.prjtitle:e.prjname,name:e.prjname}),s.push(e.ctxname)}})),this.ctx=s,t},getOrganizationsData:function(e){var t=this,s=[];return e.credentials.forEach((e=>{if(e.ctxtitle&&e.prjname===t.fields.collaborativeSpace.value){s.some((t=>t.name===e.orgname))||s.push({name:e.orgname,title:e.orgtitle})}})),s},updateComboBoxFields:function(e,t){this.fields[t].elementsList=e.map((e=>({labelItem:e.title,valueItem:e.name})))},getAllAssignedOrganizations:function(e){var t=[];return e.credentials.forEach((e=>{if(e.ctxtitle){t.some((t=>t.name===e.orgname))||t.push({name:e.orgname,title:e.orgtitle})}})),t},similarIssueDiv:function(){var e=this;return e.formElements.similarIssues=s.createElement("div",{class:"create-form-element create-properties-form-element-similar-issues",html:[{tag:"div",class:"create-form-field form-group",html:[e.fields.similarIssuesLabel=s.createElement("h5",{class:"create-form-field-similar-issues-label",html:R.create.properties.labels.similarIssues}),e.fields.similarIssues=s.createElement("div",{class:"create-form-field-similar-issues"})]}]}),e.formElements.similarIssues},createClassificationField:function(e){var t=this;return t.formElements.classifications=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[t.formElementsToggler.classifications=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",class:"create-form-classification-label",html:[t.fields.classificationsWarning=s.createElement("div",{class:"create-form-error-icon",html:[s.createElement("span",{class:"fonticon fonticon-error"})]}),R.create.properties.labels.classification]},{tag:"div",html:[s.createElement("div",{class:"form-field-classification",html:t.fields.classifications=t._getClassificationField()}),t.fields.attributes=s.createElement("div",{class:"form-field-attributes"})]}]}]})},createFormElement:function(e){var t=this,n="create-form-element create-properties-form-element-"+e.element,a=t.formElements[e.element]=s.createElement("div",{class:n});t.parent.isTemplate&&!e.required&&t.createVisibilityMask(e).inject(a);return t.createFormGroup(e).inject(a),a},createFormGroup:function(e){var t=this,n=s.createElement("div",{class:"create-form-field form-group"});return(e.required?t.createRequiredLabel(e):t.createLabel(e)).inject(n),t.createFormField(e).inject(n),n},createVisibilityMask:function(e){return s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]})},createRequiredLabel:function(e){var t=this,n=e.element+"Label",a="required-form-field-title-label"+(t.parent.isTemplate?"":" highlight"),i="required-form-field-required-label"+(t.parent.isTemplate?"":" highlight");return t.fields[n]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:a,html:R.create.properties.labels[e.element]}),s.createElement("div",{class:i+" wux-ui-3ds-required wux-ui-3ds"})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=this,n=s.createElement("div",{name:e.name,id:e.id}),a=null;switch(e.type){case"text":case"memo":a=t.createTextField(e);break;case"date":a=t.createDateField(e);break;case"buttonToggle":a=t.createButtonToggle(e);break;case"subType":a=t.createSubTypePicker(e);break;case"comboBox":a=t.createComboBox(e)}return a.inject(n),n},createTextField:function(e){var t=null;return"text"===e.type?(t=this.fields[e.element]=new r({value:e.value,requiredFlag:e.required,placeholder:e.placeholder})).getContent().setStyle("width","100%"):(t=this.fields[e.element]=new o({value:e.value,nbRows:4,requiredFlag:e.required,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t},createDateField:function(e){return this.fields[e.element]=new l({value:e.value,minValue:e.minValue,maxValue:e.maxValue})},createButtonToggle:function(e){var t=this.fields[e.element]=new i({type:"radio"}),s=[];return e.value.forEach((function(n,i){var o=new a({label:R.priorities[n],type:"radio",value:e.id[i],icon:{iconName:e.icons[i],fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},emphasize:e.emphasize[i],checkFlag:0===i});t.addEventListener("buttonclick",(function(e){e.dsModel.checkFlag=!0})),s.push(o),t.addChild(o)})),t},createSubTypePicker:function(e){var t=null;return"type"==e.element&&(t=this.specializeProperties.getSubTypePicker()),t},show:function(){var e=this;s.is(e.specializeProperties,"object")&&!e.specializeProperties.noShow&&e.specializeProperties.show(),s.is(e.customPropertiesView,"object")&&!e.customPropertiesView.noShow&&e.customPropertiesView.show(),e._parent(),e.formElements.title.querySelectorAll("input").length>0&&e.formElements.title.querySelectorAll("input")[0].focus()},hide:function(){var e=this;s.is(e.specializeProperties,"object")&&e.specializeProperties.hide(),s.is(e.customPropertiesView,"object")&&e.customPropertiesView.hide(),e._parent()},validate:function(){var e=this,t=!1;return e.form.fields=Object.values(e.fields).filter((function(e){return null!==e})),t=e.form.validate(!1,!1),s.is(e.specializeProperties,"object")&&!e.specializeProperties.noShow&&(t=t?e.specializeProperties.validate():t),s.is(e.customPropertiesView,"object")&&!e.customPropertiesView.noShow&&(t=t?e.customPropertiesView.validate():t),t},getValues:function(){var e,t,n,a=this,i=new Date,o=a.fields.resolutionDate.value,r=a.fields.estimatedEndDate.value;null!=o&&""!==o&&(n=o.toString()),null!=r&&""!==r&&(t=r.toString()),"true"==b.get("ISU_AUTO_DATES")&&(e=i.toString(),t=i.toString());var l;l=a.fields.description.value;var c=[],d={};a.selected._classificationData.forEach((function(e){c.push(e[0].classId),e[0].classAttributes.forEach((function(e){d[e.name]=a.selected.attributes[e.name]?a.selected.attributes[e.name]:e.value}))}));const u=a.ctx.findIndex((e=>{const t=e.split(".");return t[1]===a.fields.organization.value&&t[2]===a.fields.collaborativeSpace.value}));var m={title:a.fields.title.value,description:l,securityContexts:"ctx::"+a.ctx[u],collaborativeSpace:a.fields.collaborativeSpace.value,organization:a.fields.organization.value,resolutionRecommendation:a.fields.resolutionRecommendation.value,priority:a.fields.priority.value[0],escalationRequired:a.fields.escalationRequired.value,resolutionDate:n,estimatedStartDate:e,estimatedEndDate:t,classes:c,attributes:d,classification:a.selected._classificationData,reportingOrganization:a.values.reportingOrganization,responsibleOrganization:a.values.responsibleOrganization,reportingOrganizationTitle:a.values.reportingOrganizationTitle,responsibleOrganizationTitle:a.values.responsibleOrganizationTitle,existingClassification:a.existingClassificationIds?a.existingClassificationIds:[]};return s.is(a.specializeProperties,"object")&&s.merge(m,a.specializeProperties.getValues()),s.is(a.customPropertiesView,"object")&&s.merge(m,a.customPropertiesView.getValues()),m},getHiddenAttributes:function(){var e=this,t={};for(var n in e.formElements)s.is(e.formElementsToggler[n])&&(t[n]=e.formElementsToggler[n].hasClassName("fonticon-eye-off"));return s.is(e.specializeProperties,"object")&&!e.specializeProperties.noShow&&s.merge(t,e.specializeProperties.getHiddenAttributes()),s.is(e.customPropertiesView,"object")&&!e.customPropertiesView.noShow&&s.merge(t,e.customPropertiesView.getHiddenAttributes()),t},applyTemplate:function(t){var n=this;b.get("widget")||window.widget;return n.reset().then((function(){var a=[];s.is(t.data.title)&&(n.fields.title.value=t.data.title,n.formElements.title.querySelectorAll("input")[0].oninput(),n.parent&&!n.parent.isTemplate&&n.parent.updateTitle(t.data.title));if(s.is(t.data.description)&&(n.fields.description.value=h.getTextFromHTML(t.data.description)),s.is(t.data.resolutionRecommendation)&&(n.fields.resolutionRecommendation.value=t.data.resolutionRecommendation),s.is(t.data.priority)&&(n.fields.priority.getButtonFromValue(t.data.priority).checkFlag=!0),s.is(t.data.resolutionDate)&&(n.fields.resolutionDate.value=t.data.resolutionDate),s.is(t.data.estimatedEndDate)&&(n.fields.estimatedEndDate.value=t.data.estimatedEndDate),s.is(t.data.escalationRequired)&&(n.fields.escalationRequired.value=t.data.escalationRequired),n.fields.securityContexts={},n.fields.securityContexts.value=t.data.securityContexts,n.selected.templateAttributes=t.data.attributes,s.is(t.data.classification,"array")&&t.data.classification.length>0&&n.applyClass(t.data.classification),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var i=n.formElements,o=n.formElementsToggler;for(var r in i)!0===t.hidden[r]&&(n.parent.isTemplate?(s.is(i[r])&&i[r].toggleClassName("visibility-masked",!0),s.is(o[r])&&(o[r].toggleClassName("fonticon-eye-off",!0),o[r].toggleClassName("fonticon-eye",!1))):s.is(i[r])&&i[r].hide())}return s.is(n.specializeProperties,"object")&&!n.specializeProperties.noShow&&a.push(n.specializeProperties.applyTemplate(t)),s.is(n.customPropertiesView,"object")&&!n.customPropertiesView.noShow&&a.push(n.customPropertiesView.applyTemplate(t)),s.is(t.data.responsibleOrganization)&&(t.data.responsibleOrganizationTitle?n._setOrganization(t.data.responsibleOrganization,"responsibleOrganization",t.data.responsibleOrganizationTitle):n._setOrganization(t.data.responsibleOrganization,"responsibleOrganization")),s.is(t.data.reportingOrganization)&&""!=t.data.reportingOrganization&&(t.data.reportingOrganizationTitle?n._setOrganization(t.data.reportingOrganization,"reportingOrganization",t.data.reportingOrganizationTitle):n._setOrganization(t.data.reportingOrganization,"reportingOrganization")),e.all(a)}))},applyClass:function(t){var n=this;n.existingClassificationIds=t;var a=[],i=[];s.is(t)&&s.is(t[0])&&s.is(t[0][0])&&s.is(t[0][0].classIdPath)?t.forEach((function(t){var s=new e((e=>{var s=t[0],a=s.classIdPath.substring(0,s.classIdPath.indexOf(",")),o=n.classModel.getAllDescendants().filter((e=>e.options.grid.idPath==a));if(1==o.length)if(o[0].isExpanded()){var r={model:o[0],data:[t]};e(r)}else n._addClassesForLibrary(o[0]).then((()=>{var s={model:o[0],data:[t]};e(s)}));else i.push(s),e()}));a.push(s)})):a.push(new e((e=>{n._addClasesForLibraries().then((()=>{var s={model:n.classModel,data:t};e(s)}))}))),e.all(a).then((e=>{e.forEach((function(e){var t;e&&(t=e.model,e.data.forEach((function(e){var s=e[0],n=t.getAllDescendants().filter((e=>e.options.id===s.classId));0==n.length?i.push(s):n.map((e=>{e.select()}))})))}));var t=n.autoCompleteMultiSel.selectedItems;if(n.autoCompleteMultiSel._selectionChips.removeAllChips(),n.addBtn.disabled=!0,t&&t.length>0&&n._addClass(t),i.length>0){var s=i.map((e=>e.className)).join(", ");p.displayNotification({msg:R.replace(R.templates.errors.classificationApplyTemplateFailed,{ClassNames:s}),eventID:"error"})}}))},reset:function(){var t=this;return new e((function(e){t.fields.title.value="",t.formElements.title.querySelectorAll("input")[0].oninput();var s=new Date,n=new Date(s);n.setDate(n.getDate()+7);var a=b.get("ISU_AUTO_DATES");t.fields.resolutionRecommendation.value="",t.fields.priority.getButton(0).checkFlag=!0,t.fields.resolutionDate.value="true"==a?n:void 0,t.fields.description.value="",e()}))},_searchSimilarIssues:function(){var e=this;if(s.is(e.fields)&&s.is(e.fields.title)&&s.is(e.fields.similarIssues)&&s.is(e.fields.similarIssuesLabel)&&s.is(e.formElements)&&s.is(e.formElements.similarIssues)){var t="";if(e.formElements.title.querySelectorAll("input").length>0)t=e.formElements.title.querySelectorAll("input")[0].value;t.length>0?C.search({data:{query:"(3dexpiss:#all) "+t,select_predicate:["resourceid","ds6w:created","ds6w:modified","ds6w:identifier","owner","ds6w:responsible","ds6wg:revision","ds6w:status","ds6w:label","ds6w:type"]}}).then((function(t){if(Array.isArray(t.body.results)?e._similarIssues=t.body.results.map((function(e){return y.parseFetchResponse(e).value})):e._similarIssues=[],e._similarIssues.length>0){e.fields.similarIssues.empty();for(var n=0;n<e._similarIssues.length;n++){var a=s.clone(e._similarIssues[n]),i=e._similarIssues[n].name+"  "+R.create.properties.labels.Created+" "+g.timeSince(new Date(a.created))+" "+R.create.properties.labels.ago+" by "+a.responsible+"  "+R.create.properties.labels.Updated+" "+g.timeSince(new Date(a.modified))+" "+R.create.properties.labels.ago,o=g.computeSharedIssuesURL([a.physicalId]);s.createElement("div",{class:"create-form-field-similar-issues-line",html:[s.createElement("a",{html:[s.createElement("div",{class:"create-form-field-similar-issues-line-title",html:[s.createElement("img",{src:g.getIconByState(a.state,a.type,a.typeIcon),title:R.maturity[a.state.toLowerCase()]}),s.createElement("span",{html:s.String.escapeHTML(e._similarIssues[n].title)})]}),s.createElement("div",{class:"create-form-field-similar-issues-line-info",html:g.getTextFromHTML(i)})],href:o,target:"_blank"})]}).inject(e.fields.similarIssues)}var r=g.computeSharedIssuesURL(e._similarIssues.map((function(e){return e.physicalId})));e.fields.similarIssuesLabel.setContent([R.create.properties.labels.similarIssues," (",{tag:"a",html:e._similarIssues.length,href:r,target:"_blank"},")"]),e.formElements.similarIssues.show()}else e.formElements.similarIssues.hide()})).catch((function(){e.formElements.similarIssues.hide()})):e.formElements.similarIssues.hide()}},_getClassificationField:function(){var e=this;e.classificationField=new s.Element("div",{class:"classification-container"}),e.autoCompleteMultiSel=new S({elementsTree:e.classModel,placeholder:R.create.properties.labels.classificationPlaceholder}),e.fields.classificationsWarning.hide();var t=s.createElement("div",{class:"classifications-help-text-container",html:[s.createElement("span",{html:R.classificationsFieldHelpText})]});return e.autoCompleteMultiSel.addEventListener("change",(function(){var s=e.autoCompleteMultiSel.selectedItems;e.helpField=t,e.helpField.inject(e.classificationField),e.selectedClasses=s,0===e.autoCompleteMultiSel._selectionChips.getNumberOfChips()&&(e.addBtn.disabled=!0,e.helpField.hide(),e.fields.classificationsWarning.hide()),e.autoCompleteMultiSel.invalidValue=!1;for(var n=s.length-1;n>=0;n--)if(!e.values.classNames.includes(s[n].options.label)){e.autoCompleteMultiSel._selectionChips.removeChip(s[n].options.label),e.autoCompleteMultiSel.selectedItems.splice(n,1),e.autoCompleteMultiSel.invalidValue=!0;break}!e.autoCompleteMultiSel.invalidValue&&e.autoCompleteMultiSel._selectionChips.getNumberOfChips()>0&&(e.addBtn.disabled=!1,e.helpField.show(),e.fields.classificationsWarning.show())})),e.autoCompleteMultiSel.getContent().addEventListener("keydown",(function(e){13==e.keyCode&&e.stopPropagation()})),e.autoCompleteMultiSel.inject(e.classificationField),e.addBtn=new a({label:R.create.properties.labels.classificationAddBtn,domId:"addBtn",disabled:!0}),e.addBtn.getContent().addEventListener("buttonclick",(function(){e.autoCompleteMultiSel._selectionChips.removeAllChips(),e._addClass(e.selectedClasses),e.addBtn.disabled=!0,e.helpField.hide()})),e.addBtn.inject(e.classificationField),e.classificationField},_addClass:function(t){var s=this;s.classModel.unselectAll();var n=[],a=document.getElementById("create-view-footer-create-btn");a.disabled=!0,t.forEach((function(t){if(!s.selected.classes[t.options.id]){s.selected.classes[t.options.id]={};var a=new e((function(e){C.classification.getClassificationAttributesOfClass({id:t.options.id,onFailure:function(e){}}).then((function(s){g.updateNLSForClassifAttr(s.member),e({data:s,item:t})}))}));n.push(a)}})),e.all(n).then((function(e){e.forEach((function(e){var t=[{classId:e.data.member[0].id,className:e.data.member[0].name,classPath:e.item.options.grid.path,classIdPath:e.item.options.grid.idPath,classAttributes:e.data.member[0].ClassAttributes.member}];s.classification=new A({classification:{data:t,attributes:s.selected.templateAttributes,selectedData:s.selected,classModel:s.classModel}});var n=s.classification.render();s.selected._classificationData.push(n._classificationData);var a=n.form;a.inject(s.fields.attributes,"top");var i={classId:e.data.member[0].id,element:a};s.selected.classes[e.item.options.id]=i}))})).finally((()=>{a.disabled=!1}))},createComboBox:function(e){var t=e.rangeItems,s=function(){var e=new T;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,a=t[s].valueItem,i=new D({label:n,grid:{valueItem:a}});e.addRoot(i)}return e.pushUpdate(),e}();return this.fields[e.element]=new w({elementsTree:s,value:e.value,enableSearchFlag:1==e.enableSearchFlag})},_orgSearch:function(e){var t=this,s=new O({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:N.TYPE_ORGANIZATION,events:{onValid:function(){var n=s.getNewOwner().organization;t._setOrganization(n.orgID,e,n.orgTitle),s.clearInput(),s.getContent().searchInput.focus()},onUnvalid:function(){},onError:function(){p.displayNotification({msg:R.search.error.orgNotFound,eventID:"info"})}}});return s.setSelectedItemList([{objectID:t.organizations[0].physicalId}]),s},_setOrganization:function(e,t,n){var a=this;if(!s.is(n)||""==n){n=e;var i=b.get(P);s.is(i)&&s.is(i["ds6w:organizationResponsible"][e])&&(n=i["ds6w:organizationResponsible"][e])}var o=s.createElement("div",{class:"team-content-org-container",html:[s.createElement("span",{class:"team-content-org-icon fonticon view-icon fonticon-users"}),s.createElement("span",{class:"team-content-org-info",html:g.getTextFromHTML(n)})]});a.fields[t].empty(),a.fields[t].appendChild(o),a.values[t]=e,a.values[t+"Title"]=n}})})),define("DS/IssueComponents/create/Create",["UWA/Class/Events","UWA/Class/Promise","UWA/Controls/Abstract","DS/Controls/TabBar","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Toggler","DS/UIKIT/Tooltip","DS/Controls/ComboBox","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/Controls/Expander","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/LineEditor","DS/Controls/Editor","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Custom","DS/IssueComponents/create/CustomNew","DS/IssueComponents/create/Attachments","DS/IssueComponents/create/Finalize","DS/IssueComponents/create/Properties","DS/IssueComponents/create/PropertiesNew","DS/IssueComponents/create/Related","DS/IssueComponents/create/Team","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","text!DS/IssueCommon/assets/Settings.json","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y,E,S,w,T,D,A,_,O,N,R,M,P,L,U,x,k,F,j,V,B){"use strict";var z="Issue",G={MULTI_STEP:"multi-step",FULL_VIEW:"full-view"},H={MULTI_STEP:"view-big-tile",FULL_VIEW:"view-list"},W="IssueCommon",q=100,Y="IssueTemplatesEnabled",X=600,K=600,J=13;return s.extend(e,{name:"DS/IssueComponents/create/Create",isLoaded:null,_deferred:{resolve:null,reject:null},_tooltips:[],_defaultViewMode:null,defaultOptions:{editMode:!1,isTemplate:!1,escapeToClose:!0,resizable:!0},overwrite:null,init:function(e,t){var s=this;s._parent(t),s.parentContainer=e,s._logger=p.getLogger(s.name),s._logger.log("Initializing the creation component"),s.elements={dialog:null,header:null,body:null,footer:null},s.modeToggler={iconBar:null},s.navigator={container:null,toggler:null},s.content={container:null},s.scroller=null,s.buttons={create:null,saveAsDraft:null,cancel:null},s._tooltips=[],s.isTemplate=s.options.isTemplate,s.isIssueNewTemplate_Enabled=x.get(Y),s._allViewsHaveBeenRendered=!1,s._defaultViewMode=localStorage.getItem("IssueCommonCreateViewMode"),s.activeMode=null,s.activeView=null,s.views={},s.settings=JSON.parse(V),s.views={properties:{id:0,key:"properties",label:B.create.views.properties,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attributes",view:s.settings.enableClassification?new M({parent:s}):new R({parent:s}),order:2},related:{id:1,key:"related",label:B.create.views.relatedObjects,fonticon:"view-icon fonticon-location",view:new P({parent:s}),order:4},attachments:{id:2,key:"attachments",label:B.create.views.attachments,fonticon:"view-icon fonticon-attach",view:new O({parent:s}),order:5},team:{id:3,key:"team",label:B.create.views.team,fonticon:"view-icon fonticon-users",view:new L({parent:s}),order:6}}},destroy:function(){var e=this,t=x.get("component");(t&&t._tasks&&t._tasks.current&&"SELECT_IN_3D"===t._tasks.current.taskType&&t.taskManager.cancel(t._tasks.current.taskId),e._tooltips.forEach((function(e){e.destroy()})),Object.keys(e.views).forEach((function(t){e.views[t].view.destroy(),e.views[t]=null})),e.elements={dialog:null,header:null,body:null,footer:null},e.modeToggler={iconBar:null},e.navigator={container:null,toggler:null},e.content={container:null},e.scroller&&e.scroller.destroy(),e.scroller=null,e.buttons={create:null},e._tooltips=[],e._allViewsHaveBeenRendered=!1,e._defaultViewMode=null,e.activeMode=null,e.activeView=null,e.sortedViewsIds=null,e.views={},e.parentContainer=null,x.get("component")&&x.get("component").container&&x.get("component").container.dropZone)&&x.get("component").container.dropZone.hide()},render:function(){var e=this;e.isLoaded=new t((function(t,s){e._deferred.resolve=t,e._deferred.reject=s}));var s=Object.keys(e.views).map((function(t){return e.views[t].view.isInit}));t.all(s).then((function(){Object.keys(e.views).forEach((function(t){e.views[t].view.noShow&&delete e.views[t]})),e.sortedViewsIds=Object.keys(e.views),e.sortedViewsIds.sort((function(t,s){return e.views[t].order-e.views[s].order})),k.preferences.getCreateCtx({policy:"Issue"}).then((function(t){if(e.avaialbleUserCredentials=t,e.avaialbleUserCredentials){if(e.avaialbleUserCredentials.credentials.length<=1&&!e.avaialbleUserCredentials.credentials.some((e=>e.ctxname))){!0===e.options.isTemplate?f.displayAdvancedNotification({level:"error",title:B.errorCreateTemplateForRoleTitle,subtitle:B.errorCreateIssueForRoleSubTitle,message:B.errorCreateIssueForRoleMsg,sticky:!1,eventID:"error"}):f.displayAdvancedNotification({level:"error",title:B.errorCreateIssueForRoleTitle,subtitle:B.errorCreateIssueForRoleSubTitle,message:B.errorCreateIssueForRoleMsg,sticky:!1,eventID:"error"});var s=T.getCommand("Create"),n=x.get("widget")||window.widget;return D.Mask.unmask(n.body),s.end(),void e.destroy()}e.footer(),e.body(),e.dialog(e.parentContainer)}}))})).catch(e._deferred.reject)},dialog:function(e){var t=this,s=D.throttle((function(){t.onResize()}),q);t.elements.dialog=new m({animate:!0,autocenter:!0,closable:!0,escapeToClose:t.options.escapeToClose,limitParent:!1,overlay:!1,resizable:t.options.resizable,visible:!0,className:"create-view-dialog",title:"",body:t.elements.body,footer:t.elements.footer,events:{onShow:function(){t.build()},onResizeFloating:function(){s()},onMove:function(){},onClose:function(e){null==e&&(e=!0),t.dispatchEvent("onCreateDialogClose",e),t.elements.dialog.destroy(),t.destroy()}}}),t.updateTitle(),e.hasOwnProperty("body")?t.elements.dialog.inject(e.body):t.elements.dialog.inject(e)},body:function(){var e=this;e.elements.body=a.createElement("div",{class:"create-view-body multi-step"+(e.isTemplate?" template-mode":"")}),e.elements.body.addEventListener("keydown",(function(t){t.which===J&&e._create(!1)}));var t=e.finalize=new N({parent:e}).render(),s=!1;e.isTemplate&&(s=!0),e.settingsExpander=new h({header:"",body:t,orientation:"horizontal",icon:"cog",expandedFlag:s}).inject(e.elements.body),e.settingsExpander.elements.header.title=B.create.settings,e.createContainer=a.createElement("div",{class:"create-container"}).inject(e.elements.body),e.navigator.container=a.createElement("nav",{class:"create-view-navigator-container"}).inject(e.createContainer),e._createPanelTabBar(["strip"],e.navigator.container),e.content.container=a.createElement("div",{class:"create-view-content"}).inject(e.createContainer),e.content.scrollable=a.createElement("div",{class:"create-view-scrollable-content"}),e.scroller=new l({element:e.content.scrollable}).inject(e.content.container),e.sortedViewsIds.forEach((function(t){var s=e.views[t];s.view&&(s.view.inject(e.scroller.getInnerElement()),s.view.hide())}));var n={scroll:e._onScroll.bind(e)};e.scroller.elements.content.addEvents(n)},_createPanelTabBar:function(e,t,s){var a=this;s||(s="properties"),a.createPanelTabs&&a.createPanelTabs.destroy(),a.createPanelTabs=new n({displayStyle:e,minWidth:"100%"}),a.createPanelTabs.add({label:B.create.views.properties,isSelected:"properties"==s,icon:{iconName:"attributes",fontIconFamily:WUXManagedFontIcons.Font3DS}}),a.createPanelTabs.add({label:B.create.views.relatedObjects,isSelected:"related"==s,icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS}}),a.createPanelTabs.add({label:B.create.views.attachments,isSelected:"attachments"==s,icon:{iconName:"attach",fontIconFamily:WUXManagedFontIcons.Font3DS}}),a.createPanelTabs.add({label:B.create.views.team,isSelected:"team"==s,icon:{iconName:"users",fontIconFamily:WUXManagedFontIcons.Font3DS}}),a.createPanelTabs.inject(t),a.createPanelTabs.addEventListener("tabButtonClick",(function(e,t){let s=e.dsModel.value[0],n=a._getViewIdFromTabValue(s);a.switchView(n)}))},footer:function(){var e=this;e.elements.footer=a.createElement("div",{class:"create-view-footer"}),e.modeToggler.iconBar=new i({renderTo:e.elements.footer,items:[{name:"SwitchView",fonticon:e._defaultViewMode===G.FULL_VIEW?H.MULTI_STEP:H.FULL_VIEW,text:e._defaultViewMode===G.FULL_VIEW?B.create.modeToggler.tooltipMultiStep:B.create.modeToggler.tooltipFullView,handler:function(){var t=e.modeToggler.iconBar.getItem("SwitchView").elements.icon,s=e.modeToggler.iconBar.getItem("SwitchView").tooltip;!0===t.hasClassName("fonticon-"+H.MULTI_STEP)?(t.removeClassName("fonticon-"+H.MULTI_STEP),t.addClassName("fonticon-"+H.FULL_VIEW),s.setBody(B.create.modeToggler.tooltipFullView),e.switchViewMode(G.MULTI_STEP)):(t.removeClassName("fonticon-"+H.FULL_VIEW),t.addClassName("fonticon-"+H.MULTI_STEP),s.setBody(B.create.modeToggler.tooltipMultiStep),e.switchViewMode(G.FULL_VIEW))}}]});var t=a.createElement("div",{class:"create-view-footer-btn-container"}).inject(e.elements.footer);((e.buttons.create=new o({value:e.isTemplate?B.create.saveButton:B.create.sendButton,id:"create-view-footer-create-btn",className:"primary",disabled:!0}).inject(t)).addEvent("onClick",(function(){e._create()})),e.isTemplate)||(e.buttons.saveAsDraft=new o({value:B.create.saveAsDraftButton,id:"create-view-footer-save-as-draft-btn",className:"default",disabled:!0}).inject(t)).addEvent("onClick",(function(){e._create(!0)}));(e.buttons.cancel=new o({value:B.create.cancelButton,id:"create-view-footer-cancel-btn",className:"default"}).inject(t)).addEvent("onClick",(function(){e.cancel()}))},build:function(){var e=this;if(!e._allViewsHaveBeenRendered){var t=function(e,t,s){return function(){a.is(e[s])&&e[s].toggleClassName("visibility-masked"),a.is(t[s])&&(t[s].toggleClassName("fonticon-eye"),t[s].toggleClassName("fonticon-eye-off"))}};Object.keys(e.views).forEach((function(s){var n=e.views[s];if(n.view&&(n.view.render(),e.isTemplate&&a.is(n.view.formElements,"object")&&a.is(n.view.formElementsToggler,"object"))){var i=n.view.formElements,o=n.view.formElementsToggler;for(var r in i)a.is(o[r])&&o[r].addEventListener("click",t(i,o,r))}}));var s=e.finalize.formElements,n=e.finalize.formElementsToggler;for(var i in s)a.is(n[i])&&n[i].addEventListener("click",t(s,n,i));e.switchViewMode(e._defaultViewMode?e._defaultViewMode:G.MULTI_STEP),e.switchView(e.sortedViewsIds[0]),e._allViewsHaveBeenRendered=!0,e._deferred.resolve()}e.subscribers()},onResize:function(){var e=this,t=e.elements.dialog.elements.container.getSize(),s=t.width<X,n=t.height<K;e.elements.dialog.elements.container.toggleClassName("responsive-width-phone",s),e.elements.dialog.elements.container.toggleClassName("responsive-height-phone",n)},updateTitle:function(e){var t=this,s=t.options.editMode?B.create.titleActionEdit:B.create.titleActionCreate;s+=" ",s+=t.isTemplate?B.create.titleTemplate:B.create.title,e&&e.length&&(s+=": "+e),t.elements.dialog.setTitle(s)},_getViewIdFromTabValue:function(e){const{properties:t,related:s,attachments:n,team:a}=this.views;return[t,s,n,a].reduce(((t,s)=>(s.id===e&&t.push(s),t)),[])[0].key},_navItem:function(e){var t=this,s={};return s.container=a.createElement("a",{id:e.id,class:"nav-item"}),s.container.addEventListener("click",(function(){t.activeMode===G.FULL_VIEW&&t.activeView===e.id&&t._highlightElement(e.view.container)})),s.container.addEventListener("dragover",(function(){t.switchView(e.id)})),s.activeIndicator=a.createElement("div",{class:"nav-item-active-indicator"}).inject(s.container),a.createElement("span",{class:"fonticon fonticon-expand-down"}).inject(s.activeIndicator),s.circle=a.createElement("div",{class:"nav-item-circle"}).inject(s.container),a.createElement("span",{class:"fonticon "+e.fonticon}).inject(s.circle),s.label=a.createElement("div",{class:"nav-item-label",html:e.label}).inject(s.container),s},switchViewMode:function(e){var t=this;if(t.elements.body)if(e===G.MULTI_STEP)t._createPanelTabBar(["strip"],t.navigator.container,t.activeView),t.elements.body.addClassName("multi-step"),Object.keys(t.views).forEach((function(e){e!==t.activeView&&"view"in t.views[e]&&t.views[e].view.hide()}));else if(t.elements.body.removeClassName("multi-step"),t._createPanelTabBar(["strip","vertical"],t.navigator.container,t.activeView),Object.keys(t.views).forEach((function(e){"view"in t.views[e]&&t.views[e].view.show()})),t.activeView in t.views&&"view"in t.views[t.activeView]){var s=t.views[t.activeView].view.container;t.scroller.scrollToElement(s),t._highlightElement(s)}t.activeMode=e,localStorage.setItem("IssueCommonCreateViewMode",e)},switchView:function(e){var t=this;if(t.navigator&&t.navigator.container&&t.activeView){var s=t.navigator.container.getElements("a"),n=!1;s.forEach((function(s){if(!1===n?s.removeClassName("filled").addClassName("filled"):s.removeClassName("filled"),s.id===t.activeView&&s.removeClassName("active"),s.id===e){s.addClassName("active");var a=s.getElement(".view-icon.fonticon");if(t.elements.body.hasClassName("multi-step")){var i=a.getPosition().x/t.navigator.container.getSize().width*100;i+=10,t.navigator.container.getElement(".ariadne-rope").setStyles({width:i+"%",height:"2px"})}else{var o=a.getPosition().y/t.navigator.container.getSize().height*100;t.navigator.container.getElement(".ariadne-rope").setStyles({width:"2px",height:o+"%"})}n=!0}}))}if(t.activeMode===G.MULTI_STEP)t.activeView in t.views&&"view"in t.views[t.activeView]&&t.views[t.activeView].view.hide(),e in t.views&&"view"in t.views[e]&&t.views[e].view.show();else if(e in t.views&&"view"in t.views[e]&&t.scroller){var a=t.views[e].view.container;t.scroller.scrollToElement(a),t._highlightElement(a)}t.activeView=e},applyTemplate:function(e,s){var n=this;for(var a in s&&!0===s.overwrite&&(n.overwrite=e),r.mask(n.elements.dialog.getBody()),n.buttons)n.buttons.hasOwnProperty(a)&&n.buttons[a]&&n.buttons[a].disable();var i=Object.keys(n.views),o=[];if(i.forEach((function(t){var s=n.views[t];"applyTemplate"in s.view&&o.push(s.view.applyTemplate(e))})),o.push(n.finalize.applyTemplate(e)),!n.options.editMode&&!n.isTemplate){new Date;if(e.info){var l=[];U.getRecentlyUsedTemplates().then((function(t){if(""!==t.body&&(l=t.body),null!=e.id&&null!=e.info.name){var s={physicalId:e.id,name:e.info.name},a=l.findIndex((t=>t.physicalId==e.id));-1!=a?l.splice(a,1):3==l.length&&l.pop(),l.unshift(s)}U.setRecentlyUsedTemplates(l).catch((function(e){n._logger.error("Could not save the preferences: %o",e)}))}))}}return t.all(o).then((function(e){return r.unmask(n.elements.dialog.getBody()),(n.propertiesView&&void 0!==n.propertiesView.lastUsedCollaborativeSpaceIndex&&n.propertiesView.lastUsedCollaborativeSpaceIndex>-1||n.propertiesView&&void 0!==n.propertiesView.fields.collaborativeSpace.value&&void 0!==n.propertiesView.fields.organization.value||!0===n.finalize.parent.options.editMode)&&(n.buttons&&n.buttons.create&&n.buttons.create.setDisabled(!1),n.buttons&&n.buttons.saveAsDraft&&n.buttons.saveAsDraft.setDisabled(!1)),n.buttons&&n.buttons.cancel&&n.buttons.cancel.enable(),e}))},applyIssue:function(e){var t=this,s=x.get("widget")||window.widget,n={};return k.preferences.getApprovalEnablement({data:{}}).then((function(e){var s=e.body.ApprovalProcess;t.adminPreference=s})),k.issues.retrieve({data:{objects:[{physicalId:e.id}]}}).then((function(i){var o=i.results[i.results.length-1].body;return n={id:"template-"+s.id+"-"+Date.now(),info:{description:null,name:null},ui:{assignees:U.template.formatMemebersValues(o.assignees),responsibleOrganization:o.responsibleOrganization,coOwners:U.template.formatMemebersValues(o.coOwners),contributors:U.template.formatMemebersValues(o.contributors),informedUsers:U.template.formatMemebersValues(o.informedUsers)},data:{assignees:o.assignees,automationTasks:[],contexts:o.contexts,custom:o.custom,specialization:o.specialization,description:o.description||"",escalationRequired:o.escalationRequired,priority:o.priority||"Low",reportedAgainst:o.reportedAgainst,resolutionDate:o.resolutionDate,estimatedEndDate:o.estimatedEndDate,resolutionRecommendation:o.resolutionRecommendation||"",responsibleOrganization:o.responsibleOrganization,reportingOrganization:o.reportingOrganization,responsibleOrganizationTitle:o.responsibleOrganizationTitle,reportingOrganizationTitle:o.reportingOrganizationTitle,title:o.title||"",type:o.type||z,securityContexts:o.collaborativeSpace},hidden:{},applyIssue:!0},a.is(o.waitingOn,"string")&&("Always"==t.adminPreference?(o.waitingOn="Analyst",n.data.automationTasks.push("enableApproval")):"Never"==t.adminPreference?o.waitingOn="Unassigned":(t.adminPreference="Analyst"===o.waitingOn)&&n.data.automationTasks.push("enableApproval")),U.template.getDocuments(e.id)})).then((function(t){return n.data.attachments=t,U.template.getPrimary(e.id)})).then((function(t){return n.data.primaryAttachment=t,U.classification.getClassificationAttrValues(e.id)})).then((function(s){var a=[],i={};return s.member[0].ClassificationAttributes.member.forEach((function(e){var t=[],s={classId:e.ClassID};t.push(s),a.push(t),e.Attributes.forEach((function(e){i[e.name]=e.value}))})),n.data.classification=a,n.data.attributes=i,t.applyTemplate(n).then((function(){f.displayNotification({msg:B.replace(B.create.issueApplySuccess,{title:e["ds6w:label"],name:e["ds6w:identifier"]}),eventID:"info"})}))})).catch((function(s){f.displayNotification({msg:B.replace(B.create.issueApplyError,{title:e["ds6w:label"],name:e["ds6w:identifier"]}),eventID:"error"}),t._logger.error(s)}))},cancel:function(){this.elements.dialog.options.events.onClose(!0)},getDialog:function(){return this.elements.dialog},_onScroll:function(){var e=this;setTimeout((function(){if(e.activeMode===G.FULL_VIEW){var t=e.scroller._infos.y.scrollPosition;Object.keys(e.views).forEach((function(s){var n=e.views[s];if(n.view&&n.view.container){var a=n.view.container;if(t>=a.offsetTop&&t<a.offsetTop+a.offsetHeight){e.activeView=s;let t=e.views[s].id;e.createPanelTabs.getButtonFromValue(t).checkFlag=!0}}}))}}),0)},_highlightElement:function(e){e.addClassName("highlight"),e.addEventListener("animationend",(function(){e&&e.removeClassName("highlight")}))},_create:function(e){var s=this,n=x.get("widget")||window.widget;for(var a in s.closeDialog=!0,r.mask(n.body),s.buttons)s.buttons.hasOwnProperty(a)&&s.buttons[a]&&s.buttons[a].disable();return s.elements.dialog.rightButtons.getElement(".fonticon-cancel").addClassName("disabled"),(s.isTemplate?s._validate().then((function(){return s._saveAsIssueTemplate()})).then((function(e){return s.setTemplateAsRecentlyUsed(e.physicalId,s.templateData),t.resolve(e)})).then((function(e){return s._connectAttachments(e.physicalId,e.isEdit),t.resolve(e)})).then((function(e){return s._publishTemplateCreateEvent(e),t.resolve(e)})).then((function(e){return Array.isArray(s.templateData.classes)&&s.templateData.classes.length>0||Array.isArray(s.templateData.existingClassification)&&s.templateData.existingClassification.length>0?U.classification.getCSRFToken(e):{issueId:e.physicalId,isEdit:e.isEdit}})).then((function(e){var t=[];return s.templateData.existingClassification.length>0&&(t=s.templateData.existingClassification.map((function(e){return e[0].classId}))),t.length>0&&e.isEdit?U.classification.deClassifyObject(t,e).then((t=>e)):e})).then((function(e){return Array.isArray(s.templateData.classes)&&s.templateData.classes.length>0?U.classification.classifyObject(s.templateData.classes,e):e})).then((function(e){return Array.isArray(s.templateData.classes)&&s.templateData.classes.length>0?U.classification.getClassAttrVals(e):e})).then((function(e){if(e.cestamp){var t=s.templateData.attributes;return U.classification.setClassificationValues(t,e)}return e})).then((function(e){var t=x.get("templateComponentDialog")?x.get("templateComponentDialog"):x.get("templateComponent");return t&&U.classification.addClassificationColumn(s.templateData,t.templateList,"template"),e.issueId})).catch((function(){})):s._validate().then((function(){return s._createRequest(e)})).then((function(e){var n=e.physicalId;return s._publishEvent(n,"DS/Object/create"),t.resolve(e)})).then((function(e){return new t((function(t,n){s._connectAttachments(e.physicalId).then((function(){t(e)})).catch(n)}))})).then((function(e){return Array.isArray(s.createData.classes)&&s.createData.classes.length>0||Array.isArray(s.createData.existingClassification)&&s.createData.existingClassification.length>0?U.classification.getCSRFToken(e):{issueId:e.physicalId,isEdit:e.isEdit}})).then((function(e){return Array.isArray(s.createData.classes)&&s.createData.classes.length>0?U.classification.classifyObject(s.createData.classes,e):e})).then((function(e){return Array.isArray(s.createData.classes)&&s.createData.classes.length>0?U.classification.getClassAttrVals(e):e})).then((function(e){if(e.cestamp){var t=s.createData.attributes;return U.classification.setClassificationValues(t,e)}return e})).then((function(e){var n=[];return n.push(s._execAutomationTasks(e.issueId)),t.all(n)}))).catch((function(e){return s._logger.error(e),t.reject(e)})).finally((function(){for(var e in r.unmask(n.body),s.buttons)s.isTemplate?(s.buttons.hasOwnProperty(e)&&null!==s.buttons[e]&&"cancel"===e&&s.buttons[e].enable(),s.buttons.hasOwnProperty(e)&&null!==s.buttons[e]&&s.finalize&&void 0!==s.finalize.fields.saveAsTemplate.collaborativeSpace.value&&void 0!==s.finalize.fields.saveAsTemplate.organization.value&&s.buttons[e].enable()):(s.buttons.hasOwnProperty(e)&&null!==s.buttons[e]&&"cancel"===e&&s.buttons[e].enable(),s.buttons.hasOwnProperty(e)&&null!==s.buttons[e]&&s.views.properties.view&&void 0!==s.views.properties.view.fields.collaborativeSpace.value&&void 0!==s.views.properties.view.fields.organization.value&&s.buttons[e].enable());s.elements.dialog.rightButtons.getElement(".fonticon-cancel").removeClassName("disabled"),s.closeDialog&&s.elements.dialog.options.events.onClose(!1)}))},_createRequest:function(e){var t=this,s=Object.keys(t.views),n={};return s.forEach((function(e){var s=t.views[e];"getValues"in s.view&&a.merge(n,s.view.getValues())})),a.merge(n,t.finalize.getValues()),t.createData=n,a.is(n.custom)&&Object.values(n.custom)&&Object.values(n.custom).forEach(((e,t)=>{Array.isArray(e)&&(n.custom[Object.keys(n.custom)[t]]=e.toString())})),a.is(n.specialization)&&Object.values(n.specialization)&&Object.values(n.specialization).forEach(((e,t)=>{Array.isArray(e)&&(n.specialization[Object.keys(n.specialization)[t]]=e.toString())})),a.is(n.description,"string")&&(n.description=U.getTextFromHTML(n.description),n.description.match(/.*\n$/)&&(n.description=n.description.replace(/\n+$/,""))),n.state=!0!==e?"Assign":"Create",k.issues.create({data:n}).then((function(s){try{D.cloudProbeUtils.sendCreateIssueTrackerEvent(t),"CreateFrom3D"==t.options.issueCreationType&&D.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"NewIssue",pd5:"Issue/3DViewer/Issue3DReviewToolbar/NewIssue"}})}catch(e){}finally{if(e){widget.setValue("usedCollaborativeSpace",t.createData.collaborativeSpace),widget.setValue("usedOrganization",t.createData.organization);const e=B.replace(B.create.creationSuccess,{title:n.title});f.displayNotification({msg:e,eventID:"success"})}else if(0==s.body.isPromoted){const e=B.replace(B.creationDraft,{title:n.title});f.displayNotification({msg:e,eventID:"warning"})}else{widget.setValue("usedCollaborativeSpace",t.createData.collaborativeSpace),widget.setValue("usedOrganization",t.createData.organization);const e=B.replace(B.create.creationSuccess,{title:n.title});f.displayNotification({msg:e,eventID:"success"})}return s.body}})).catch((function(e){if(t.closeDialog=!1,e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to create an issue, as a validation process is attached to the issue for assignees")){var s=D.getErrorMessage("1004");D.displayErrorMessage(s,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("This Issue requires approval but system was not able to find any member")){s=D.getErrorMessage("1004_1");D.displayErrorMessage(s,"error")}else if(a.is(e.error,"object")&&a.is(e.error.internal)&&(e.error.internal.includes("ErrorCode:2004")||e.error.internal.includes("ErrorCode:1500028")||e.error.internal.includes("Admin not allowed to create Issue"))){s=D.getErrorMessage("4");D.displayErrorMessage(s,"error")}else if(a.is(e.error,"object")&&a.is(e.error.internal)&&e.error.internal.includes("ErrorCode:2006")){s=(s=e.error.internal).replace("ErrorCode:2006","").replace("java.lang.Exception:",""),f.displayNotification({msg:s,eventID:"error"})}else if(a.is(e.error,"object")&&a.is(e.error.internal)&&e.error.internal.includes("exceeds maximum length")){s=e.error.message;f.displayNotification({msg:s,eventID:"error"})}else if(a.is(e.error,"object")&&a.is(e.error.message)&&e.error.message.includes("ErrorCode:1501009"))f.displayNotification({msg:B.errorCreateIssueForRoleSubTitle,eventID:"error"});else if(a.is(e.error,"object")&&"6001"===e.error.code&&a.is(e.error.message)){s=e.error.message;f.displayNotification({msg:s,eventID:"error"})}else f.displayNotification({msg:B.create.creationFailed,eventID:"error"});t._logger.error(e)}))},_validate:function(){var e=this,s=Object.keys(e.views);return new t((function(t,n){var a=s.every((function(t){var s=e.views[t],n=!0;return"validate"in s.view&&(n=s.view.validate()),n}));a&&(a=e.finalize.validate()),a?t():(f.displayNotification({msg:B.create.validationFailed,eventID:"error"}),e.closeDialog=!1,n(new Error("invalid fields")))}))},_connectAttachments:function(e,s){var n=this,a=x.get("widget")||window.widget;if("attachments"in n.views&&"collection"in n.views.attachments.view){var i=n.views.attachments.view.collection,o=n.views.attachments.view.catalog,r=function(e){this.set("isCancelable",!0),this.set("request",e)},l=function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}},c=function(){this.set("isCancelable",!1),this.set("request",null)};return new t(((t,a)=>{if(s)return U.template.getDocuments(e).then((function(s){var a=s,o=[];i.forEach((e=>{a.includes(e.get("id"))&&o.push(e)})),o.forEach((e=>{a.splice(a.indexOf(e.get("id")),1)})),a.length>0&&E.disconnectDocumentsFromParent(a,e),o.forEach((t=>{!0===t.get("isPrimary")&&E.setAsPrimary(t.get("id"),e,!0).then((function(){f.displayNotification({msg:w.notifications.SetAsPrimary.success,eventID:"info"})})).catch((function(e){f.displayNotification({msg:w.notifications.SetAsPrimary.failure,eventID:"error"}),n._logger.error(e)})),i.remove(t)})),t()}));t()})).then((s=>{var d=i.filter((function(e){return!0===e.get("isFile")})).map((function(e){var t=e.clone();return t.set("isProcessing",!0),t})),u=[],m=[];if(d.length>0){var p=new y({id:e||"template",attachments:d});new S({container:a.body,collection:p}).render(),n.views&&n.views.attachments&&(n.securityContextForDocumentUpload=n.views.attachments.view.fields.securityContexts,E.attachmentsView={collaborativeSpace:n.views.attachments.view.fields.collaborativeSpace.value,organization:n.views.attachments.view.fields.organization.value}),u=d.map((function(s){t.resolve();return(null!=e?E.uploadFile(s.get("file"),e,{onCheckinStart:r.bind(s),onCheckinProgress:l.bind(s),onCheckinComplete:c.bind(s)},n.securityContextForDocumentUpload):E.uploadFile(s.get("file"),null,{onCheckinStart:r.bind(s),onCheckinProgress:l.bind(s),onCheckinComplete:c.bind(s)},n.securityContextForDocumentUpload)).then((function(e){if(e&&e.data&&e.data.length>0&&e.data[0].id){m.push(e.data[0].id);var t=i.get(s.id);t&&(t.set("id",e.data[0].id),t.set("isFile",!1),o.attachments[e.data[0].id]=o.attachments[s.id],o.attachments[e.data[0].id].id=t.get("id"),o.attachments[e.data[0].id].container.id=t.get("id"),o.attachments[e.data[0].id].container.setAttribute("id","attachment-"+t.get("id")),o.attachments[e.data[0].id].container.setData("id",t.get("id")),delete o.attachments[s.id],s.set("id",e.data[0].id),s.set("isFile",!1),s.set("isProcessing",!1))}})).catch((function(e){s.set("isFailed",!0),s.set("isProcessing",!1),s.set("isCancelable",!1),s.set("request",null),e instanceof Error&&(f.displayNotification({msg:w.replace(w.notifications.Upload.failure,{count:1}),eventID:"error"}),n._logger.error(e))}))}))}var g=i.filter((function(e){return!0!==e.get("isFile")})).map((function(e){return e.clone()})),h=[];g.length>0&&(h=g.map((function(s){return null!=e?E.connectDocumentToParent(s.id,e).catch((function(e){f.displayNotification({msg:w.notifications.Attach.failure,eventID:"error",count:1}),n._logger.error(e)})):t.resolve()}))),t.all(u.concat(h)).then((function(){k.issues.addAccess({data:{issueId:e,documentIds:m}});var s=i.filter((function(e){return!0===e.get("isPrimary")}));if(1===s.length){var a=s[0];return E.setAsPrimary(a.get("id"),e,!0).then((function(){f.displayNotification({msg:w.notifications.SetAsPrimary.success,eventID:"info"})})).catch((function(e){f.displayNotification({msg:w.notifications.SetAsPrimary.failure,eventID:"error"}),n._logger.error(e)}))}return t.resolve()}))})).catch((e=>{}))}return t.resolve()},_execAutomationTasks:function(){var e=this,s=t.resolve();if(e.finalize){if(-1!==e.finalize.getTasks().indexOf("saveAsTemplate"))return e._saveAsIssueTemplate().then((function(s){return e.setTemplateAsRecentlyUsed(s.physicalId,e.templateData),t.resolve(s)})).then((function(s){return e._connectAttachments(s.physicalId,s.isEdit),t.resolve(s)})).then((function(s){return e._publishTemplateCreateEvent(s),t.resolve(s)})).then((function(t){return Array.isArray(e.templateData.classes)&&e.templateData.classes.length>0||Array.isArray(e.templateData.existingClassification)&&e.templateData.existingClassification.length>0?U.classification.getCSRFToken(t):{issueId:t.physicalId,isEdit:t.isEdit}})).then((function(t){return Array.isArray(e.templateData.classes)&&e.templateData.classes.length>0?U.classification.classifyObject(e.templateData.classes,t):t})).then((function(t){return Array.isArray(e.templateData.classes)&&e.templateData.classes.length>0?U.classification.getClassAttrVals(t):t})).then((function(t){if(t.cestamp){var s=e.templateData.attributes;return U.classification.setClassificationValues(s,t)}return t})).then((function(t){var s=x.get("templateComponentDialog")?x.get("templateComponentDialog"):x.get("templateComponent");return s&&U.classification.addClassificationColumn(e.templateData,s.templateList,"template"),t.issueId})).then((()=>{var e=x.get("templateComponentDialog")?x.get("templateComponentDialog"):x.get("templateComponent");e&&e.refreshTemplateList()}))}else s=t.resolve();return s},_saveAsIssueTemplate:function(){var e=this,t=x.get("widget")||window.widget,s=e.getTemplateFinalData();return e.templateData=s.data,!0===a.is(e.overwrite,"object")&&(s.id=e.overwrite.id,!0===e.templates.isShared(e.overwrite)&&(s.metadata.info.share=e.overwrite.info.share)),e.options.editMode?e.templates.editIssueTemplate(s).then((function(e){var t=B.create.updateTemplateSuccess;return f.displayNotification({msg:t,eventID:"success"}),{physicalId:e.body.physicalId,isEdit:!0}})):e.templates.createIssueTemplate(s).then((function(e){if(!e.error){const n=e.body.templateTitle;t.setValue("usedCollaborativeSpace",e.body.collaborativeSpace),t.setValue("usedOrganization",e.body.organization);var s=B.replace(B.create.creationTemplateSuccess,{title:n});return f.displayNotification({msg:s,eventID:"success"}),{physicalId:e.body.physicalId,isEdit:!1}}if(e.error.internal.includes("No create access to business object")){var n=D.getErrorMessage("4");D.displayErrorMessage(n,"error")}else f.displayNotification({msg:e.error.message,eventID:"error"})}))},getTemplateFinalData:function(){var e=this,t=Object.keys(e.views),s={},n={};t.forEach((function(t){var i=e.views[t];"getValues"in i.view&&a.merge(s,i.view.getValues(!0)),"getHiddenAttributes"in i.view&&a.merge(n,i.view.getHiddenAttributes(!0))})),a.is(s.custom)&&Object.values(s.custom)&&Object.values(s.custom).forEach(((e,t)=>{Array.isArray(e)&&(s.custom[Object.keys(s.custom)[t]]=e.toString())})),a.is(s.specialization)&&Object.values(s.specialization)&&Object.values(s.specialization).forEach(((e,t)=>{Array.isArray(e)&&(s.specialization[Object.keys(s.specialization)[t]]=e.toString())})),a.merge(n,e.finalize.getHiddenAttributes(!0)),s.automationTasks=e.finalize.getTasks();var i=e.finalize.getTemplateValues();return i.version=x.version,i.tenant=F.getTenant(),s.templateTitle=i.name,s.templateDescription=i.description,s.securityContexts=i.securityContexts,s.collaborativeSpace=i.collaborativeSpace,s.organization=i.organization,{id:"",data:s,metadata:{hidden:n,info:i,data:{securityContexts:s.securityContexts,title:s.title,description:s.description,automationTasks:s.automationTasks}}}},setTemplateAsRecentlyUsed:function(e,t){var s=[];U.getRecentlyUsedTemplates().then((function(n){""!==n.body&&(s=n.body);var a={physicalId:e,name:t.templateTitle},i=s.findIndex((t=>t.physicalId==e));-1!=i?s.splice(i,1):3==s.length&&s.pop(),s.unshift(a),U.setRecentlyUsedTemplates(s).catch((function(e){that._logger.error("Could not save the preferences: %o",e)}))}))},_publishEvent:function(e,t){var s=x.get("widget")||window.widget,n=[],a={};n.push([e]),a[e]={};var i=Math.floor(Date.now()),o={metadata:{appId:s.id,appName:W,timestamp:i,options:{}},data:{paths:n,attributes:a},version:"1.0"};g.publish(t,o)},_publishTemplateCreateEvent:function(e){this.dispatchEvent("onTemplateCreate",{isEdit:e.isEdit,physicalId:e.physicalId})},templates:{createIssueTemplate:function(e){return new t((function(t,s){require(["DS/IssueComponents/templates/TemplatesDataGridLayout_V2","text!DS/IssueCommon/assets/Settings.json"],(function(n,a){var i=new n(x.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});i.createIssueTemplate(e).then(t,s).finally((function(){i=null}))}))}))},editIssueTemplate:function(e){return new t((function(t,s){require(["DS/IssueComponents/templates/TemplatesDataGridLayout_V2","text!DS/IssueCommon/assets/Settings.json"],(function(n,a){var i=new n(x.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});i.editIssueTemplate(e).then(t,s).finally((function(){i=null}))}))}))},isShared:function(e){return!0===a.is(e.info.share,"object")}},subscribers:function(){var e=this,t=e.views.properties.view.autoCompleteMultiSel;t.addEventListener("change",(function(){!t.invalidValue&&t._selectionChips.getNumberOfChips()>0?(e.propertiesView&&e.propertiesView.fields&&void 0!==e.propertiesView.fields.collaborativeSpace.value||e.finalize&&e.finalize.fields&&e.finalize.fields.saveAsTemplate&&null!=e.finalize.fields.saveAsTemplate.collaborativeSpace.value)&&(e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!0),e.buttons&&e.buttons.saveAsDraft&&e.buttons.saveAsDraft.setDisabled(!0)):(e.propertiesView&&e.propertiesView.fields&&void 0!==e.propertiesView.fields.collaborativeSpace.value&&void 0!==e.propertiesView.fields.organization.value||e.finalize&&e.finalize.fields&&e.finalize.fields.saveAsTemplate&&null!=e.finalize.fields.saveAsTemplate.collaborativeSpace.value&&null!=e.finalize.fields.saveAsTemplate.organization.value)&&(e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!1),e.buttons&&e.buttons.saveAsDraft&&e.buttons.saveAsDraft.setDisabled(!1))})),e.propertiesView=e.views.properties.view,e.propertiesView&&e.propertiesView.fields&&e.propertiesView.fields.collaborativeSpace&&e.propertiesView.fields.collaborativeSpace.addEventListener("change",(function(){!t.invalidValue&&t._selectionChips.getNumberOfChips()>0?(e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!0),e.buttons&&e.buttons.saveAsDraft&&e.buttons.saveAsDraft.setDisabled(!0)):(e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!1),e.buttons&&e.buttons.saveAsDraft&&e.buttons.saveAsDraft.setDisabled(!1))})),e.propertiesView&&e.propertiesView.fields&&e.propertiesView.fields.organization&&e.propertiesView.fields.organization.addEventListener("change",(function(){!t.invalidValue&&t._selectionChips.getNumberOfChips()>0?(e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!0),e.buttons&&e.buttons.saveAsDraft&&e.buttons.saveAsDraft.setDisabled(!0)):(e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!1),e.buttons&&e.buttons.saveAsDraft&&e.buttons.saveAsDraft.setDisabled(!1))})),e.finalize&&e.finalize.fields&&e.finalize.fields.saveAsTemplate&&e.finalize.fields.saveAsTemplate.collaborativeSpace&&e.finalize.fields.saveAsTemplate.collaborativeSpace.addEventListener("change",(function(){!t.invalidValue&&t._selectionChips.getNumberOfChips()>0?e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!0):e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!1)})),e.finalize&&e.finalize.fields&&e.finalize.fields.saveAsTemplate&&e.finalize.fields.saveAsTemplate.organization&&e.finalize.fields.saveAsTemplate.organization.addEventListener("change",(function(){!t.invalidValue&&t._selectionChips.getNumberOfChips()>0?e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!0):e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!1)})),(e.propertiesView&&void 0!==e.propertiesView.lastUsedCollaborativeSpaceIndex&&e.propertiesView.lastUsedCollaborativeSpaceIndex>-1||e.propertiesView&&void 0!==e.propertiesView.fields.collaborativeSpace.value&&void 0!==e.propertiesView.fields.organization.value)&&(e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!1),e.buttons&&e.buttons.saveAsDraft&&e.buttons.saveAsDraft.setDisabled(!1)),(e.finalize&&void 0!==e.finalize.lastUsedCollaborativeSpaceIndex&&e.finalize.lastUsedCollaborativeSpaceIndex>-1||e.finalize&&void 0!==e.finalize.fields.saveAsTemplate.collaborativeSpace.value&&void 0!==e.finalize.fields.saveAsTemplate.organization.value)&&e.buttons&&e.buttons.create&&e.buttons.create.setDisabled(!1)}})})),define("DS/IssueComponents/templates/TemplatesDataGridView",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Popover","DS/UIKIT/Scroller","DS/UIKIT/Input/Text","DS/UIKIT/Toggler","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/Core/PointerEvents","DS/DocumentManagement/DocumentManagement","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/DataGridView/DataGridView","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/IssueComponents/templates/TemplatesToolbar","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Create","DS/IssueComponents/users/Users","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y,E,S,w,T,D,A,_,O,N,R){"use strict";return t.extend({})})),define("DS/IssueComponents/helper/TemplateHelper",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/UIKIT/Toggler","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueComponents/utils/Utils","DS/WebappsUtils/WebappsUtils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r){"use strict";var l="Private",c="Public",d="minimized";return{name:"DS/IssueComponents/helper/Helper",show:function(t){var n=this;if(n.modal)return null;var i=e.createElement("div",{class:"helper-dialog-body",html:n.getDialogBody()}),o=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,persistId:"ISUHelper",className:"helper-dialog",title:r.helper.dialog.title,header:null,body:i,events:{onClose:function(){o.destroy(),n.modal=null,n.views=null}}}).inject(t),l=e.createElement("span",{class:"right-actions minimize fonticon fonticon-minus"}),c=o.rightButtons.querySelector(".fonticon-cancel");o.rightButtons.insertBefore(l,c),l.addEventListener("click",(function(){n.minimize()})),n.views.minimize={},n.views.minimize.icon=l,o.addEvent("onResizeFloating",(function(){"44px"!==o.elements.container.getStyle("height")&&n.views.minimize.icon.hasClassName(d)&&n.views.minimize.icon.removeClassName(d)}));var u=new s({element:n.views.contentsBody});return o.show(),n.modal=o,u},getDialogBody:function(){var t=this,s=e.createElement("nav",{class:"tab",html:[e.createElement("li",{class:"tab-item active",id:"state",html:[e.createElement("span",{class:"fonticon fonticon-issue-type "}),r.helper.dialog.tabStates]}),e.createElement("li",{class:"tab-item",id:"shortcut",html:[e.createElement("span",{class:"fonticon fonticon-keyboard"}),r.helper.dialog.tabShortcuts]})]}),a=new n({container:s,events:{onToggle:function(e){"id"in e&&(Object.keys(t.views.contents).forEach((function(e){t.views.contents[e].hide()})),t.views.contents[e.id].show())}}});t.views={},t.views.contents={},t.views.contents.state=t.state(),t.views.contents.shortcut=t.shortcut(),t.views.contents.shortcut.hide();var i=e.createElement("div",{class:"helper-content-main",html:[t.views.contents.state,t.views.contents.shortcut]});return t.views.contentsBody=i,[a,i]},state:function(){var t=e.createElement("div",{class:"helper-content helper-content-state"}),s=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:r.helper.dialog.tabStates})}),n=e.createElement("div",{class:"helper-content-body-container"}),a=function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r[t.toLowerCase()]}),styles:{"background-color":i.getColorByState(t)}})}),e.createElement("th",{class:s,html:e.createElement("span",{class:"th-description",html:r["templateHelper_"+t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})};t.addContent(s),t.addContent(n);for(var o=[],d=[l,c],u=0;u<d.length;u++){var m="";u===d.length-1&&(m="th-last-row"),o.push(a(d[u],m))}var p=e.createElement("table");return p.setContent(o),n.addContent(p),t},shortcut:function(){var t=e.createElement("div",{class:"helper-content"}),s=function(t,s,n){var a=[e.createElement("th",{class:"th-helper-dialog-key "+n,html:e.createElement("span",{class:"default-helper-title key-shortcut-key",html:e.createElement("span",{class:"default-helper-content ",html:null!=r.helper.dialog.shortcut.key[s][t]||null!=r.helper.dialog.shortcut.key[s][t]?r.helper.dialog.shortcut.key[s][t]:""})})}),e.createElement("th",{class:n,html:e.createElement("span",{class:"th-helper-dialog-description",html:null!=r.helper.dialog.shortcut.detail[s][t]||null!=r.helper.dialog.shortcut.detail[s][t]?r.helper.dialog.shortcut.detail[s][t]:""})})];return e.createElement("tr",{class:"helper-state",html:a})},n=function(t,n,a,i){var o=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:n})}),r=e.createElement("div",{class:"helper-content-body-container default-content-body-container"});t.addContent(o),t.addContent(r);for(var l=[],c=0;c<a.length;c++){var d="";c===a.length-1&&(d="th-last-row"),l.push(s(a[c],i,d))}var u=e.createElement("table");u.setContent(l),r.addContent(u)};return n(t,r.helper.dialog.subtitleShortcuts,["arrowUp","arrowDown","arrowLeft","arrowRight","shiftArrow","ctrlA","ctrlC","ctrlEnter"],"shortcut"),n(t,r.helper.dialog.subtitleMouseOperation,["ctrlClick","shiftClick"],"mouse"),t},minimize:function(){var e=this;e.views.minimize.icon.hasClassName(d)?(e.views.minimize.icon.removeClassName(d),e.modal.elements.container.setStyle("height",e.views.minimize.height)):(e.views.minimize.icon.addClassName(d),e.views.minimize.height=e.modal.elements.container.getStyle("height"),e.modal.elements.container.setStyle("height","44px"))}}})),define("DS/IssueComponents/templates/footer/TemplateStatus",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Controls/Loader","DS/IssueComponents/helper/TemplateHelper","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l){"use strict";var c="Issue";return e.extend({name:"DS/IssueManagement/components/footer/Status",tagName:"div",className:"status-container",_logger:null,isVisible:!0,_pin:null,setup:function(e){var t=this;r.start(t.name+" setup"),t._parent(e),t.isVisible=!0,t.loading.init(),r.end(t.name+" setup")},render:function(){var e=this;return r.start(e.name+" render"),e.helper().inject(e.container),e.loadedTemplates().inject(e.container),e.selectedTemplates().inject(e.container),e.loading.container.inject(e.container),r.end(e.name+" render"),e},refresh:function(){this.destroy(),this.render()},destroy:function(){this.container.empty()},loading:{container:t.createElement("div",{class:"im-status-loader"}),clickCallback:null,isVisible:!1,_loader:new a({text:"Loading...",fadeDuration:500,showButtonFlag:!1}),init:function(){this._loader.inject(this.container)}},helper:function(){var e=o.get("widget")||window.widget,n=t.createElement("span",{class:"issue-status-left-helper fonticon fonticon-help-circled"}),a=new s({className:"helper-tooltip",position:"top",target:n,body:l.templateHelper});return n.addEventListener("click",(function(){a.hide(),i.show(e.body)})),n},info:function(){var e=this,n=t.createElement("span",{class:"issue-status-right fonticon fonticon-info"});return new s({className:"im-status-tooltip",trigger:"touch",target:n,events:{onShow:function(){r.start(e.name+" render status");o.get("component");for(var s=o.get("templateComponentDialog")?o.get("templateComponentDialog"):o.get("templateComponent"),n=s.document.getSelectedNodes(),a=s.document.getRoots(!1).length,i=0,d=0;d<n.length;d++)n[d].options.baseType===c&&(i+=1);var u=t.createElement("div",{class:"im-status-msg"});t.createElement("div",{class:"im-status-msg-issues",text:l.replace(l.templatesinfo,{number:a})}).inject(u),t.createElement("div",{class:"im-status-msg-selection",text:l.replace(l.selectedTemplates,{number:i})}).inject(u),this.setBody(u),r.end(e.name+" render status")}}}),n},loadedTemplates:function(){var e=this;e.showDialog=!0;var s=t.createElement("div",{class:"im-status-loaded"}),n=l.replace(l.loadedTemplates,{number:0});e.loadedDiv=t.createElement("div",{text:n});var a=l.replace(l.totalTemplates,{number:0});return e.totalDiv=t.createElement("div",{text:a}),e.loadedDiv.inject(s),e.totalDiv.inject(s),s},selectedTemplates:function(){var e=l.replace(l.selectedTemplatesCount,{number:0});return this.selectedDiv=t.createElement("div",{class:"im-status-selected",text:e}),this.selectedDiv},utils:{}})})),define("DS/IssueComponents/templates/TemplatesDataGridLayout_V2",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueComponents/open/Open","DS/IssueComponents/templates/TemplatesDGView","DS/IssueComponents/templates/TemplateDelete","DS/IssueComponents/templates/TemplateMigration","DS/IssueCommon/utils/ModelParser","DS/IssueComponents/templates/model/TemplatesTreeDocument","DS/IssueComponents/templates/TemplatesToolbar","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Create","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueComponents/templates/footer/TemplateStatus","text!DS/IssueComponents/assets/Settings.json","text!DS/IssueComponents/assets/IssueTemplates.DataGrid.json","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h,v,b,C,I,y,E,S,w,T,D){"use strict";var A="CUSTOM_ATTR_INFOS",_="CUSTOM_ATTR_NLS",O="IssueTemplatesEnabled",N="Issue Template Json Details";return t.extend({name:"DS/IssueComponents/templates/TemplatesDataGridLayout_V2",_logger:null,isLoaded:null,_deferred:{resolve:null,reject:null},_isRendered:!1,init:function(e,t){var s=this;s._parent(t),s.container=e,s._logger=r.getLogger(s.name),s._logger.log("Initializing the templates component"),s.status=null,s.elements={dialog:null,header:null,body:null,footer:null},s.templateList={container:null,title:null,dataGridContainer:null,dataGrid:null,toolBarContainer:null,toolBar:null,attributes:[]},s.templateLastUsed={container:null,header:null,previews:{container:null,templates:{}}},s.buttons={cancel:null,select:null},s.isTemplateLoaded=!1,s._tooltips=[],s.attributes=[],s.user=E.getUserName(),s.userInfo=c.getUser(),s.popover=null,s.isIssueNewTemplate_Enabled=I.get(O),s.onClose=t.onClose.bind(s),s.onEnd=t.onEnd.bind(s),s.utils._setTypesCallbackSubscribe=!1,s.totalTemplates=0},destroy:function(){var e=this;e._tooltips.forEach((function(e){e.destroy()})),e._tooltips=[],e.elements={header:null,body:null},e.templateList={container:null,title:null,dataGridContainer:null,dataGrid:null,toolBarContainer:null,iconBar:null,attributes:[]},e.templateLastUsed={container:null,header:null,previews:{container:null,templates:{}}},e.buttons={cancel:null,select:null},e.user="",e.userInfo="",e.isTemplateLoaded=!1,e._destroyPopover(),e.utils._setTypesCallbackSubscribe=!1,I.remove("templateComponentDialog")},render:function(){var e=this;I.add("templateComponent",e),e.renderTemplateData(),e.setFooter(),e.subscribers()},renderTemplateData:function(){var t=this;t.isLoaded=new e((function(e,s){t._deferred.resolve=e,t._deferred.reject=s})),t.setBody(),t.createTemplateDocument(),t.createTemplateDGView(),t.setTemplateToolbar(),t.updateUXForEditMode(),t.templateModelEvents=t.document.getTemplateModelEvents()},renderDialog:function(){I.add("templateComponentDialog",this),this.renderTemplateData()},setBody:function(){var e=this;e.elements.body=s.createElement("div",{class:"create-template-chooser-body hide-last-used"}),!0===e.options.editMode&&e.elements.body.addClassName("edit-mode"),e.templateList.container=s.createElement("div",{class:"create-template-chooser-list"}).inject(e.elements.body),e.templateList.toolBarContainer=s.createElement("div",{class:"create-template-chooser-list-iconbar"}).inject(e.templateList.container)},createTemplateDocument:function(){var e=JSON.parse(w);this.document=new g({component:this,settings:e,document:{}})},createTemplateDGView:function(){var e=this,t=(I.get("widget")||window.widget,JSON.parse(T));e.templateList.dataGrid=new u({columns:t.columns,defaultColumnDef:{width:"auto",typeRepresentation:"string"},treeDocument:e.document,showNodeKPIColorFlag:!0,showRowBorderFlag:!0,showAlternateBackgroundFlag:!0,cellSelection:"none",showRowIndexFlag:!1,rowGroupingEnabledFlag:!1,useWidgetPreferencesFlag:!0,identifier:"ISUTemplateSummaryView",cellDragEnabledFlag:!0,filter:!0,showContextualMenuColumnFlag:e.options.editMode}),e.templateList.dataGridContainer=s.createElement("div",{class:"create-template-chooser-list-tree-list tree-list-empty"}).inject(e.templateList.container),e.templateList.treeListPlaceholder=s.createElement("span",{class:"tree-list-placeholder"}).inject(e.templateList.dataGridContainer),e.customViewsManager=e.templateList.dataGrid.templatesDatagrid.getCustomViewsManager()},setTemplateToolbar:function(){var e=this;e.templateToolbar=h,h.toolbar&&h.toolbar.destroy(),h.toolbar=e.templateList.dataGrid.templatesDatagrid.setToolbar(h.writetoolbarDefination()),e.registerToolbarCallback(),e.templateList.toolBarContainer.appendChild(h.toolbar.getContent()),e.toolBar=h.toolbar,e.templateList.dataGrid.templatesDatagrid.inject(e.templateList.dataGridContainer);var t=JSON.parse(h.writetoolbarDefination());v.updateTooltip(t.entries,e.toolBar)},setFooter:function(){var e=this;e.status=(new S).render(),I.add("templateStatus",e.status),e.elements.footer=s.createElement("div",{class:"im-template-footer"}),e.status.inject(e.elements.footer),e.elements.footer.inject(e.templateList.container)},registerToolbarCallback:function(){h.toolbar.onToolbarClickCallback=this.onToolbarClickCallback.bind(this)},build:function(){var e=this;!1===e._isRendered&&e.refreshTemplateList().then((function(){e._isRendered=!0,e._deferred.resolve()})).catch((function(t){e._deferred.reject(t)}))},refreshTemplateList:function(){var e=this,t=I.get("widget")||window.widget;return h.toolbar.updateNodeModel("customizeDatagridView",{disabled:!0}),h.toolbar.updateNodeModel("customizeDatagridView",{visibleFlag:!0}),p.processLegacyTemplates().then((function(){return a.mask(e.elements.body),e.getIssueTemplates()})).then((async function(s){e.document.removeRoots(),await v.getNLSValues(s),await v.getTemplateMaturity({policies:["Issue Template"]}),v.updateTemplateMaturityClass();var n=f.parse(s);e.isTemplateLoaded=!0,s.length>0?(e.templateList.dataGridContainer.removeClassName("tree-list-empty"),e.document.addRoots(n).then((async()=>{const t=e.document.getRoots();e.document.registerNodeModelUpdateEvent(),e.totalTemplates=t.length;var s=D.replace(D.totalTemplates,{number:t.length}),a=D.replace(D.loadedTemplates,{number:t.length}),i=D.replace(D.selectedTemplatesCount,{number:0});e.status&&(e.status.totalDiv.textContent=s,e.status.loadedDiv.textContent=a,e.status.selectedDiv.textContent=i),e.updateApprovalInDatagrid(n),v.buildCustomViewOptions(e.templateList.dataGrid.templatesDatagrid,e.templateList.dataGrid.container);let o=await y.classification.fetchClassificationAttributes();b.setClassificationAttrNLS(o),e.addClassificationAttrToColumnsList(n),await v.updateSubTypesandExtensions(e.document,t),await v.updateTypeAttributes(),e.addCustomAttrToColumnsList(),e.getCustomAttrValues().then((t=>{e.updateCustomAttrValuesInDatagrid(t)})),h.toolbar.updateNodeModel("customizeDatagridView",{disabled:!1})}))):(e.templateList.dataGridContainer.addClassName("tree-list-empty"),e.templateList.treeListPlaceholder.setContent(D.templates.treeList.placeholder)),t.dispatchEvent("onTitleChange")})).then((function(){})).catch((function(e){l.displayNotification({msg:D.templates.errors.get,eventID:"error"})})).finally((function(){var t=e.document.getRoots();a.unmask(e.elements.body),0==t&&h.idling()}))},updateNLSValuesInDatagrid:function(e){var t=this,s=[],n=[];e.forEach((e=>{s.push(e.organization),n.push(e.collaborativeSpace),s.push(e.responsibleOrganization),s.push(e.reportingOrganization)}));var a={"ds6w:organizationResponsible":s,"ds6w:project":n};y.getNLSValuesPromise(a).then((s=>{if(null!=s&&Object.keys(s).length>0){var n=s["ds6w:organizationResponsible"],a=s["ds6w:project"];t.document.withTransactionUpdate((function(){for(var s={},i=0;i<e.length;i++){var o=e[i],r=o.physicalId,l={};Object.keys(n).forEach((function(e){e==o.organization&&(l.organization=n[e]),e==o.responsibleOrganization&&(l.responsibleOrganizationTitle=n[e]),e==o.reportingOrganization&&(l.reportingOrganizationTitle=n[e])})),Object.keys(a).forEach((function(e){e==o.collaborativeSpace&&(l.collaborativeSpaceTitle=a[e])})),s[r]=l}for(var c=t.document.getRoots(!1),d=0;d<c.length;d++){var u=c[d];if(s[u.options.physicalId]){var m=s[u.options.physicalId];u.updateOptions({grid:{"ds6w:collaborativeSpace":m.collaborativeSpaceTitle,"ds6w:organization":m.organization,"ds6w:responsibleOrganization":m.responsibleOrganizationTitle,"ds6w:reportingOrganization":m.reportingOrganizationTitle},collaborativeSpaceTitle:m.collaborativeSpaceTitle,organization:m.organization,reportingOrganization:m.reportingOrganizationTitle,responsibleOrganization:m.responsibleOrganizationTitle})}}}))}}))},updateApprovalInDatagrid:function(e){var t={};for(let i=0;i<e.length;i++){var s=e[i].data.data,n=e[i].physicalId,a={};s&&Array.isArray(s.automationTasks)&&(a.approval=s.automationTasks.includes("enableApproval"),t[n]=a)}for(var i=this.document.getRoots(!1),o=0;o<i.length;o++){var r=i[o];if(t[r.options.physicalId]){var l=t[r.options.physicalId];r.updateOptions({grid:{Approvals:l.approval},collaborativeSpaceTitle:l.collaborativeSpaceTitle,organization:l.organization,reportingOrganization:l.reportingOrganizationTitle,responsibleOrganization:l.responsibleOrganizationTitle})}}},addClassificationAttrToColumnsList:function(e){let t=[];e.map((e=>{if(e.data.attribute&&null!=e.data.attribute){let s=e.data.attribute["to[Classified Item].from.id"];""!=s&&(s=s.replace("[",""),s=s.replace("]",""),s=s.split(", "),t.push(...s))}}));let s=[...new Set(t)];s.length&&this.getClassificationAttributeValues(s)},getClassificationAttributeValues:async function(e){var t=this;await t.getClassificationAttrInfo(e).then((e=>{t.templateList.attributes=[],b.updateNLSForClassifAttr(e),e.forEach((function(e){e.classAttributes.forEach((function(e){if(!t.templateList.attributes.includes(e.name)){t.templateList.attributes.push(e.name),"timestamp"==e.type&&(e.type="datetime");var s={column:{text:e.label?e.label:e.name,dataIndex:e.name,isDraggable:!0,visibleFlag:!1,moveable:!0,width:120,minWidth:5,isCustomColumn:"Classification",isOOTBColumn:!0,ds6wIndexMapping:e.name,typeRepresentation:e.type}},n={that:t,attr:e};s.column.getCellValue=t.templateList.dataGrid.rendering.classificationAttributes.bind(n),t.templateList.dataGrid.getColumns().filter((e=>e.dataIndex==s.column.dataIndex)).length<=0&&(t.templateList.dataGrid.getManager().removeColumnOrGroup(e.name),t.templateList.dataGrid.getManager().addColumnOrGroup(s.column),b.setColumnFilteringOnColumn(t.templateList.dataGrid.templatesDatagrid,s.column))}}))}))}))},getClassificationAttrInfo:function(t){var s=[];return t.forEach((function(t){var n=new e((function(e){y.classification.getClassificationAttributesOfClass({id:t,onFailure:function(e){}}).then((function(s){if(s.member){var n={classAttributes:s.member[0].ClassAttributes.member,classID:t};e(n)}else e()}))}));s.push(n)})),e.all(s)},addCustomAttrToColumnsList:function(){var e=this;let t={...I.get("CustomAttributesPredicates")};e.templateList.dataGrid.templatesDatagrid.prepareUpdateView();let s=I.get(A);Array.isArray(s)&&s.forEach((function(s){const n=b.getTypeRepOfAttribute(s);var a={column:{name:s.name,text:s.nlsName,dataIndex:s.selectable,isDraggable:!0,visibleFlag:!1,moveable:!0,width:120,minWidth:5,isCustomColumn:"Attribute",isOOTBColumn:!0,typeRepresentation:n,ds6wIndexMapping:s.uri}};e.templateList.dataGrid.getColumns().filter((e=>e.dataIndex==a.column.dataIndex)).length<=0&&(e.templateList.dataGrid.getManager().removeColumnOrGroup(s.selectable),e.templateList.dataGrid.getManager().addColumnOrGroup(a.column),b.setColumnFilteringOnColumn(e.templateList.dataGrid.templatesDatagrid,a.column)),t[s.selectable]||(t[s.selectable]=a.column)})),I.add("CustomAttributesPredicates",t),e.templateList.dataGrid.templatesDatagrid.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},getCustomAttrValues:function(){var t=[];let s=I.get(A);return Array.isArray(s)?(s.forEach((e=>{let s=e.selectable,n={predicate:e.uri,selectable:s};t.push(n)})),JSON.parse(T).columns.forEach((e=>{if(e.isGenericResource){let s={predicate:e.predicate,selectable:e.selectable};t.push(s)}})),y.templates.getCustomAttributes({version:"2.0",data:{customAttrInfo:t}})):e.reject()},updateCustomAttrValuesInDatagrid:function(e){var t={};if(Array.isArray(e.body))for(let o=0;o<e.body.length;o++){var s=e.body[o].attribute,n=e.body[o].physicalId,a={};if(s&&Array.isArray(s)){for(var i=0;i<s.length;i++){let e=Object.keys(s[i])[0],t=s[i][e],n=b.getFormattedValueAsPerTypeRepresentation(e,t);if("string"==typeof n&&null!=n&&""!=n&&(n=n.trim(),"["==n[0]&&"]"==n[n.length-1]&&(n=n.substring(1,n.length-1))),null!=I.get(_)||null!=I.get(_)){let t=I.get(_)[e];if("string"==typeof n&&t&&""!=n){let e=b.getNLSValueForCustomAttr(n,t);0!=e.length&&(n=e.toString())}}e=e.replace("attribute[",""),e=e.replace("]",""),a[e]=n}t[n]=a}}var o=this.document.getRoots(!1);this.document.withTransactionUpdate((function(){for(var e=0;e<o.length;e++){var s=o[e];if(t[s.options.physicalId]){var n=t[s.options.physicalId];s.updateOptions({grid:n})}}}))},getIssueTemplates:function(){var e=this;return y.templates.getTemplates({}).then((function(t){var s=t.body;return s.sort((function(e,t){return new Date(t.modified)-new Date(e.modified)})),s.forEach((function(e){var t={},s="";e.attribute.forEach((e=>{switch(Object.keys(e)[0]){case N:t=JSON.parse(e[N]);break;case"to[Classified Item].from.id":s=e}})),e.data={},e.data.id=e.physicalId,e.data.data=t.data,e.data.info=t.info,e.data.hidden=t.hidden,e.data.attribute=s})),e.checkRecentlyUsedTemplateList(s),s}))},checkRecentlyUsedTemplateList:function(e){var t=this,s=[];v.getRecentlyUsedTemplates().then((function(n){""!==n.body&&Array.isArray(n.body)&&(s=n.body);const a=s.filter((t=>e.find((({physicalId:e})=>t.physicalId===e))));v.setRecentlyUsedTemplates(a).catch((function(e){t._logger.error("Could not save the preferences: %o",e)}))}))},createIssueTemplate:function(t){var s=this;return new e(((e,n)=>{y.templates.createTemplate({data:t}).then((function(s){s.body.templateTitle=t.data.templateTitle,s.body.collaborativeSpace=t.data.collaborativeSpace,s.body.organization=t.data.organization,e(s)})).catch((function(t){e(t),s._logger.error("Could not create the template: %o",t)}))}))},editIssueTemplate:function(e){var t=this;return y.templates.editTemplate({data:e}).catch((function(e){t._logger.error("Could not update the template: %o",e)}))},onEndCallback:function(){var e=this.document.getSelectedTemplateNodes(),t=e[e.length-1].options;this.onEnd(t)},shareTemplateHandler:function(){var e=this;e.templates=e.document.getSelectedTemplateNodes(),require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],(function(t,s){var n=e.templates.map((function(e){return new t({physicalId:e.options.id,Revision:"1",typeDisplayName:"Issue Template",name:e.options.data.info.name,organizationTitle:e.options.responsibleOrganization,collabSpaceTitle:"3DS Collab Space",responsibleName:e.options.owner.user})})),a=I.get("widget")||window.widget;new s(a,a.body,{removeAtClose:!0,events:{onClose:function(){}}}).show(n)}))},_columnCustomizationHandler:function(){v.refreshOOTBColumnList(this.templateList.dataGrid.templatesDatagrid),this.customViewsManager.showCustomViewsDialog()},_listenToCreateEvents:function(e){var t=this;t.listenTo(e,"onTemplateCreate",(function(e){t.document.refreshNodesById(e).then((function(e){t.totalTemplates=t.totalTemplates+e.created.length;var s=D.replace(D.totalTemplates,{number:t.totalTemplates}),n=D.replace(D.loadedTemplates,{number:t.totalTemplates});t.status.totalDiv.textContent=s,t.status.loadedDiv.textContent=n}))})),t.listenTo(e,"onCreateDialogClose",(function(){t.templateModelEvents.publish({event:"show-template-dialog-container"})}))},_destroyPopover:function(){var e=this;if(null!==e.popover){try{e.popover.destroy()}catch(e){}e.popover=null}},onToolbarClickCallback:function(e){"createTemplate"==e._event&&this._createTemplateHandler(),"fromIssue"==e._event&&this._fromIssueHandler(),"duplicateTemplate"==e._event&&this._duplicateTemplateHandler(),"editTemplate"==e._event&&this._editTemplateHandler(),"removeTemplate"==e._event&&this._removeTemplateHandler(),"shareTemplate"==e._event&&this.shareTemplateHandler(),"columnCustomization"==e._event&&this._columnCustomizationHandler();try{b.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"TemplateToolbar"}})}catch(e){}},_createTemplateHandler:function(){var e=this;e.templateModelEvents.publish({event:"hide-template-dialog-container"});var t=new C(e.container,{isTemplate:!0});e.utils.isAlreadyRunning()||(t.render(),e._listenToCreateEvents(t))},_fromIssueHandler:function(){var e=this,t=I.get("application");if(s.is(t,"object")&&t.isStandalone){var n=I.get("component"),a=n.taskManager.addObjectsTask((function(t){if(Array.isArray(t.physicalIds)){e.templateModelEvents.publish({event:"hide-template-dialog-container"});var s=new C(e.container,{isTemplate:!0});if(e.utils.isAlreadyRunning())return;s.render(),s.isLoaded.then((function(){var e={id:t.physicalIds[t.physicalIds.length-1]};s.applyIssue(e)})).finally((function(){e._listenToCreateEvents(s)}))}n.unmaskForTask(a)}),(function(){n.unmaskForTask(a)}));n.maskForTask(a,D.tasks.addObjects)}else E.search({title:D.create.start.actionPage.template.fromIssue,default_search_criteria:"",precond:'(flattenedtaxonomies:"types/Issue")',multiSel:!1,callback:function(t){e.templateModelEvents.publish({event:"hide-template-dialog-container"});var s=new C(e.container,{isTemplate:!0});e.utils.isAlreadyRunning()||(s.render(),s.isLoaded.then((function(){s.applyIssue(t[t.length-1])})).finally((function(){e._listenToCreateEvents(s)})))},cancel:function(){}})},_duplicateTemplateHandler:function(){var e=this,t=e.document.getSelectedTemplateNodes(),n=I.get("widget")||window.widget;if(1!==t.length)return;var a=t[t.length-1].options,i=s.clone(a.data);e.templateModelEvents.publish({event:"hide-template-dialog-container"});var o=new C(e.container,{isTemplate:!0});let r=E.getSecurityContexts().cspaces;e.updateDataPresentOnNode(a.physicalId,i).then((t=>{i.info.name=D.replace(D.templates.clonePrefix,{name:i.info.name}),i.info.securityContexts=n.getPreference("pad_security_ctx")?n.getPreference("pad_security_ctx").value:r[0].value,i.data.securityContexts=n.getPreference("pad_security_ctx")?n.getPreference("pad_security_ctx").value:r[0].value,e.updateTemplateData(i).then((function(){e.utils.isAlreadyRunning()||(o.render(),o.isLoaded.then((function(){return o.applyTemplate(i,{overwrite:!1}).catch((function(t){e._logger.error('Could not apply template "%s"',t),l.displayNotification({msg:D.replace(D.create.templateApplyError,{name:i.info.name}),eventID:"error"})}))})).finally((function(){e._listenToCreateEvents(o)})))}))})).catch((e=>{}))},_editTemplateHandler:function(){var e=this,t=e.document.getSelectedTemplateNodes();if(1===t.length){var s=t[t.length-1].options,n=s.data;e.templateModelEvents.publish({event:"hide-template-dialog-container"});var a=new C(e.container,{editMode:!0,isTemplate:!0});e.updateDataPresentOnNode(s.physicalId,n).then((t=>{e.updateTemplateData(n).then((function(){e.utils.isAlreadyRunning()||(a.render(),a.isLoaded.then((function(){return a.applyTemplate(n,{overwrite:!0}).catch((function(t){e._logger.error('Could not apply template "%s"',t),l.displayNotification({msg:D.replace(D.create.templateApplyError,{name:n.info.name}),eventID:"error"})}))})).finally((function(){e._listenToCreateEvents(a)})))}))})).catch((e=>{}))}},_removeTemplateHandler:function(){var e=this.document.getSelectedTemplateNodes();new m({selectedNodes:e}).render()},publishCompass:function(){this.utils.setTypesCallbackForOFW(this.document.getSelectedTemplateNodes())},updateTemplateData:function(e){var t=this;return v.template.getDocuments(e.id).then((function(t){return e.data.attachments=t,v.template.getPrimary(e.id)})).then((function(t){return e.data.primaryAttachment=t,v.classification.getClassificationAttrValues(e.id)})).then((function(t){var s=[],n={};t.member[0].ClassificationAttributes.member.forEach((function(e){var t=[],a={classId:e.ClassID};t.push(a),s.push(t),e.Attributes.forEach((function(e){n[e.name]=e.value}))})),e.data.classification=s,e.data.attributes=n})).catch((function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?l.displayNotification({msg:e.body.message,eventID:"error"}):l.displayNotification({msg:D.create.setAttributesFailed,eventID:"error"}),t._logger.error(e)}))},updateDataPresentOnNode:function(e,t){return y.templates.retrieve({data:{objects:{physicalId:e}}}).then((e=>{var s=t,n=e.body,a="";n.attribute.forEach((e=>{switch(Object.keys(e)[0]){case N:a=JSON.parse(e[N]);break;case"to[Classified Item].from.id":e}})),s.data.classes=n.classification,s.data.escalationRequired=n.escalationRequired,s.data.reportedAgainst=n.reportedAgainst,s.data.contexts=n.contexts,s.data.type=n.type,s.data.priority=n.priority,s.data.resolutionDate=n.resolutionDate,s.data.resolutionRecommendation=n.resolutionRecommendation,s.data.reportingOrganization=n.reportingOrganization,s.data.reportingOrganizationTitle=n.reportingOrganizationTitle,s.data.responsibleOrganization=n.responsibleOrganization,s.data.responsibleOrganizationTitle=n.responsibleOrganizationTitle,s.data.custom=n.custom,s.data.securityContexts=a.data.securityContexts,s.data.automationTasks=a.data.automationTasks,s.data.title=a.data.title,s.data.description=a.data.description,s.data.specialization=n.specialization,s.data.estimatedEndDate=n.estimatedEndDate,s.info.description=n.description,s.info.name=n.title,s.info.version=a.info.version,s.info.tenant=a.info.tenant,s.info.securityContexts=a.info.securityContexts,s.ui={},s.ui.owner=n.owner,s.ui.assignees=v.template.formatMemebersValues(n.assignees),s.ui.coOwners=v.template.formatMemebersValues(n.coOwners),s.ui.contributors=v.template.formatMemebersValues(n.contributors),s.ui.informedUsers=v.template.formatMemebersValues(n.informedUsers),s.hidden=a.hidden,s.id=n.physicalId})).catch((e=>{if(e.error.internal&&e.error.internal.includes("No business object")){var t=b.getErrorMessage("0");b.displayErrorMessage(t,"error")}}))},subscribers:function(){var e=this;e.templateModelEvents.subscribe({event:"template-remove"},(function(t){e.totalTemplates=t.roots.length;var s=D.replace(D.totalTemplates,{number:e.totalTemplates}),n=D.replace(D.loadedTemplates,{number:e.totalTemplates}),a=D.replace(D.selectedTemplatesCount,{number:e.document.getSelectedTemplateNodes()});e.status.totalDiv.textContent=s,e.status.loadedDiv.textContent=n,e.status.selectedDiv.textContent=a}))},utils:{_setTypesCallbackSubscribe:!1,setTypesCallbackForOFW:function(e){d.setTypesCallbackForOFW(e,{setTypesCallbackSubscribe:this._setTypesCallbackSubscribe}),this._setTypesCallbackSubscribe=!0},isAlreadyRunning:function(){return null!==(I.get("widget")||window.widget).body.getElement(".create-view-dialog")}},updateUXForEditMode:function(){var e=this;e.options.editMode||(e.templateList.toolBarContainer.hide(),e.templateList.dataGridContainer.addClassName("isu-template-dialog-full-height-without-toolbar"))}})})),define("DS/IssueComponents/templates/TemplatesDialog",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueComponents/templates/TemplatesDataGridLayout_V2","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l,c,d,u){return t.extend({name:"DS/IssueComponents/templates/TemplatesDialog",isLoaded:null,_deferred:{resolve:null,reject:null},_isRendered:!1,init:function(e,t){var s=this;s.container=e,s.options=t,s.elements={dialog:null,footer:null},s.buttons={select:null,cancel:null},s.onClose=t.onClose.bind(s)},render:async function(){var t=this;t.isLoaded=new e((function(e,s){t._deferred.resolve=e,t._deferred.reject=s})),t.templateComponent=new c(t.container,t.options),t.templateComponent.renderDialog(),t.setFooter(),t.dialog(t.container),t.templateModelEvents=t.templateComponent.document.getTemplateModelEvents(),t.subscribers()},dialog:function(e){var t=this;t._closeCallbackEnabled=!0,t.elements.dialog=new l({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,className:"create-template-chooser-dialog",title:t.options.editMode?u.templates.titleEdit:u.templates.title,header:null,footer:t.elements.footer,events:{onShow:function(){t.build()},onResizeFloating:function(){},onMove:function(){},onClose:function(){!0===t._closeCallbackEnabled&&(t.elements.dialog.destroy(),t.dispatchEvent("onTemplatesDialogClose",!0),t.onClose(),t.destroy(),t.templateComponent.destroy())}}}),new i({element:t.templateComponent.elements.body}).inject(t.elements.dialog.getBody()),t.elements.dialog.inject(e),t._deferred.resolve()},setFooter:function(){var e=this;e.elements.footer=s.createElement("div",{class:"create-template-chooser-footer"});var t=s.createElement("div",{class:"create-template-chooser-footer-btn-container"}).inject(e.elements.footer);if(!1===e.options.editMode){var a=e.buttons.select=new n({value:u.templates.selectButton,id:"create-template-chooser-footer-select-btn",className:"primary"}).inject(t);a.disable(),a.addEvent("onClick",(function(){e.templateComponent.onEndCallback(),e.destroyDialog(),e.destroy(),e.templateComponent.destroy()}))}(e.buttons.cancel=new n({value:e.options.editMode?u.templates.closeButton:u.templates.cancelButton,id:"create-template-chooser-footer-cancel-btn",className:"default"}).inject(t)).addEvent("onClick",(function(){e.elements.dialog.options.events.onClose()}))},build:function(){var e=this;!1===e._isRendered&&e.templateComponent.refreshTemplateList().then((function(){e._isRendered=!0})).catch((function(e){}))},show:function(){this.elements.dialog.show(),this._closeCallbackEnabled=!0},hide:function(){this._closeCallbackEnabled=!1,this.elements.dialog.hide()},_listenToCreateEvents:function(e){var t=this;t.listenTo(e,"onTemplateCreate",(function(){t.templateComponent.refreshTemplateList()})),t.listenTo(e,"onCreateDialogClose",(function(){t.show()}))},destroyDialog:function(){this.elements.dialog.destroy()},subscribers:function(){var e=this;e.templateModelEvents.subscribe({event:"template-xso-empty"},(function(){e.buttons.select&&e.buttons.select.disable()})),e.templateModelEvents.subscribe({event:"template-xso-change"},(function(){1==e.templateComponent.document.getSelectedTemplateNodes().length&&e.buttons.select?e.buttons.select.enable():e.buttons.select&&e.buttons.select.disable()})),e.templateModelEvents.subscribe({event:"hide-template-dialog-container"},(function(){e.hide()})),e.templateModelEvents.subscribe({event:"show-template-dialog-container"},(function(){e.show()}))},destroy:function(){this.elements={dialog:null,footer:null},this.buttons={select:null,cancel:null}}})})),define("DS/IssueComponents/team/MembersFilterLayout",["DS/IssueComponents/team/MembersFilterView","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts"],(function(e,t,s){"use strict";var n={createMemberFilter:function(t){var s=this;n.teamlayoutModel=t.model,s.filterMembersView;var a={events:{memberFilterKeyUp:function(e){n.enteredText=e.target.value;var t={filteringMode:"name",text:n.enteredText};n.filterCollectionAndUpdateUI(t)}}};s.filterMembersView=new e(a),s.filterMembersView.render().inject(t.target)},filterCollectionAndUpdateUI:function(e){var t=e.text;n.teamlayoutModel.setFilterModel({fullName:{filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:t}}},role:{filterId:"stringRegexp"}});n.teamlayoutModel.getFilterManager().getFilters().role},launchFilterMemberPanel:function(){var e=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-filter"),n=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add"),a=document.querySelector(".addmemberView"),i=document.querySelector(".memberfilterView"),o=document.querySelector(".iss-member-grid-div"),r=document.querySelector(".membertileView");a.hide(),n.removeClassName("member-toolbar-active"),o.removeClassName("teamview-opaque"),r.removeClassName("teamview-opaque"),"block"==i.style.display?(i.hide(),e.removeClassName("member-toolbar-active")):(i.show(),e.addClassName("member-toolbar-active"));try{var l=s.get("component").getCurrentView();t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:l,pd3:"MembersToolbar",pd4:"Filters",pd5:"Issue/"+l+"/MembersToolbar/Filters"}}),t.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersToolbar"}})}catch(e){}}};return n})),define("DS/IssueComponents/team/MembersDataGridView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/CollectionView/ResponsiveTilesCollectionView","DS/IssueComponents/team/MembersDataGridViewToolbar","DS/IssueComponents/team/MembersFilterLayout","DS/IssueComponents/team/AddMembersLayout","DS/IssueComponents/team/MembersMenu","DS/IssueComponents/utils/Utils","DS/IssueServices/services/PlatformServices","DS/CollectionView/CollectionViewStatusBar","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,s,n,a,i,o,r,l,c,d){"use strict";return e.extend({init:function(e){this._parent(e);this.membersDatagridView="","undefined"!=this.options.target&&null!=this.options.target&&(this.render(),this.membersDatagridView.inject(this.options.target),this.membersDatagridView.setStyle("width",this.options.target.offsetWidth))},render:function(){try{var e=this.processColumns(),c=this,u={treeDocument:this.options.treeDocument,columns:e,cellSelection:"none",rowSelection:"multiple",columnDragEnabledFlag:!1,cellDragEnabledFlag:!1,showRowIndexFlag:!1,identifier:widget.id+"_members",isEditable:!1,defaultColumnDef:{width:"auto",resizableFlag:!0,sortableFlag:!0},resize:{columns:!0},headersDimensions:{height:26},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},performances:{buildLinks:!1,enableColumnVirtualization:!0,useRequestAnimationFrameRendering:!0,preloadPool:!0},showContextualMenuColumnFlag:!0,enableExpandOnDoubleClick:!0,onContextualEvent:function(e){var t=[];if(e&&e.collectionView&&e.cellInfos){if(e.cellInfos.rowID>-1)return o.showRMBMenuOnGrid(c,e,c.options).then((function(e){return e}));e.collectionView.columns.length,e.cellInfos.columnID;t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!1,sizeColumnToFit:!0})}return t}};u=UWA.merge(u,this.options);var m={model:this.options.treeDocument,height:"inherit",allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["contextualMenu","description","propertiesList","activeFlag"]};this.membersDatagrid=new t(u),this.membersDatagrid.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:d.team.columns.actions,width:60,isHidden:!1,visibleFlag:!0,defaultVisibility:!0,pinned:"right"}),this.tileView=new s(m);var p={callback:function(e){if(e&&e.cellInfos&&e.cellInfos.cellModel)return o.showRMBMenuOnGrid(c,e).then((function(e){return e}))}};this.tileView.onContextualEvent=p;this.membersDatagrid.getTypeRepresentationFactory().registerTypeRepresentations({sortingdropdown:{stdTemplate:"functionMenuIcon",semantics:{label:"action",icon:"plus"}}}),n.toolbar=this.membersDatagrid.setToolbar(n.writetoolbarDefinition()),this.toolbar=n.toolbar,(c=this).membersDatagrid.getTreeDocument().getXSO().onAdd((function(e){if(e.getTreeDocument()){var t=e.getTreeDocument().getSelectedNodes().length;require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){0===t?e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!0}):e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!1})}))}})),c.membersDatagrid.getTreeDocument().getXSO().onRemove((function(e){0==e.getTreeDocument().getSelectedNodes().length&&require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!0})}))})),c.membersDatagrid.getTreeDocument().onNodeModelUpdate((function(e){require(["DS/IssueComponents/team/MembersDataGridLayout"],(function(e){var t=l.getUserName();(e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[]).filter((e=>e.options.grid.user===t)).length>0?e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("assigntoself",{visibleFlag:!1}):e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("assigntoself",{visibleFlag:!0})}))})),this.membersDatagridView=UWA.createElement("div",{id:"iss-outer-member-grid-div",class:"outer-member-grid-div"});var f=UWA.createElement("div",{styles:{width:"100%"},class:"toolbar-member-grid-div"});this.toolbar.inject(f);var g=JSON.parse(n.writetoolbarDefinition());r.updateTooltip(g.entries,this.toolbar);var h=UWA.createElement("div",{class:"iss-member-grid-div expanded-header-height hideView"}),v=UWA.createElement("div",{class:"iss-member-tile-div membertileView expanded-header-height"}),b=UWA.createElement("div",{styles:{position:"relative"},class:"iss-member-filter-div memberfilterView hideView"}),C=UWA.createElement("div",{styles:{position:"relative"},class:"iss-add-member-div addmemberView hideView"}),I=UWA.createElement("div",{class:"hideView",id:"issMemberEmptyTileViewDiv"});UWA.createElement("div",{html:d.team.datagridPlaceholder}).inject(I);var y={target:b,model:this.options.treeDocument},E={target:C,model:this.options.treeDocument};this.membersFilterLayout=a,a.createMemberFilter(y),i.createAddMemberPanel(E),this.membersDatagrid.inject(h),this.tileView.inject(v),I.inject(v),this.membersDatagridView.addContent(f),this.membersDatagridView.addContent(b),this.membersDatagridView.addContent(C),this.membersDatagridView.addContent(h),this.membersDatagridView.addContent(v)}catch(e){}},processColumns:function(){return this.options.columns},reapplySortModel:function(){this.membersDatagrid.reapplySortModel()}})})),define("DS/IssueComponents/team/MembersDataGridLayout",["DS/IssueComponents/team/MembersDataGridView","DS/IssueComponents/team/MembersTileViewLayout","DS/IssueComponents/team/MembersGridUtil","DS/IssueComponents/team/MembersDataGridModel","DS/IssueComponents/team/AddMembersLayout","DS/IssueComponents/team/MembersDataGridViewToolbar","DS/IssueServices/services/IssueServices","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json"],(function(e,t,s,n,a,i,o,r,l,c,d,u,m,p,f,g,h){"use strict";var v={createMembersView:function(t){var a=this;a.view=t;var i={};(i=UWA.merge(i,t.options)).columns=s.getColumns(),a.membersDataGridModel=new n(t.options.id),i.treeDocument=a.membersDataGridModel.createTreeDocument(),a.membersTreeModel=i.treeDocument;var o=new e(i);a.membersDataGridView=o,a._customizeColumnRendering(i.columns);a.membersDataGridView.membersDatagrid;return a.loadContent(i.physicalIds)},loadContent:function(e){var t=this,s=JSON.parse(h).membersLimitC;return e.length>s?new Promise(((e,t)=>{e()})):(t.physicalIds=e,t.membersTreeModel.removeRoots(),new Promise((function(s,n){o.issues.retrieve({timestamp:t._timestampUpdate?t._timestampUpdate:null,data:{objects:e.map((function(e){return{physicalId:e}}))},onComplete:function(e){var a;t.physicalIds.length>1?(t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("propagate",!0),t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("memberof",!0),!(a=i.toolbar.getNodeModelByID("propagate"))||0!=a.options.grid.semantics.visibleFlag&&void 0!==a.options.grid.semantics.visibleFlag||a.updateOptions({grid:{semantics:{visibleFlag:!0}}})):(t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("propagate",!1),t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("memberof",!1),!(a=i.toolbar.getNodeModelByID("propagate"))||1!=a.options.grid.semantics.visibleFlag&&void 0!==a.options.grid.semantics.visibleFlag||a.updateOptions({grid:{semantics:{visibleFlag:!1}}}));if(Array.isArray(e.results)){for(var o=e.results.map((function(e){return e.body})),r=[],l=0;l<o.length;l++){var c={id:o[l].physicalId,name:o[l].name,state:o[l].state,title:o[l].title?o[l].title:"",type:o[l].type,assignees:o[l].assignees,coOwners:o[l].coOwners,owner:o[l].owner,contributors:o[l].contributors,informedUsers:o[l].informedUsers};r.push(c)}t.issues=r;r&&r.length>0&&(t.owners=t.getUsersMap(r,"owner"),Object.keys(t.owners),Object.assign({},t.owners),t.coOwners=t.getUsersMap(r,"coOwners"),t.assignees=t.getUsersMap(r,"assignees"),t.contributors=t.getUsersMap(r,"contributors"),t.informedUsers=t.getUsersMap(r,"informedUsers"),Object.keys(t.owners).forEach((function(e){t.coOwners.hasOwnProperty(e)&&(t.owners[e].roles.includes("Co-owner")||t.owners[e].roles.push("Co-owner")),t.assignees.hasOwnProperty(e)&&(t.owners[e].roles.includes("Assignee")||t.owners[e].roles.push("Assignee")),t.contributors.hasOwnProperty(e)&&(t.owners[e].roles.includes("Contributor")||t.owners[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.owners[e].roles.includes("InformedUser")||t.owners[e].roles.push("InformedUser"))})),Object.keys(t.coOwners).forEach((function(e){t.owners.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Owner")||t.coOwners[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Assignee")||t.coOwners[e].roles.push("Assignee")),t.contributors.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Contributor")||t.coOwners[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("InformedUser")||t.coOwners[e].roles.push("InformedUser"))})),Object.keys(t.assignees).forEach((function(e){t.owners.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Owner")||t.assignees[e].roles.push("Owner")),t.coOwners.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Co-owner")||t.assignees[e].roles.push("Co-owner")),t.contributors.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Contributor")||t.assignees[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.assignees[e].roles.includes("InformedUser")||t.assignees[e].roles.push("InformedUser"))})),Object.keys(t.contributors).forEach((function(e){t.owners.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Owner")||t.contributors[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Assignee")||t.contributors[e].roles.push("Assignee")),t.coOwners.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Co-owner")||t.contributors[e].roles.push("Co-owner")),t.informedUsers.hasOwnProperty(e)&&(t.contributors[e].roles.includes("InformedUser")||t.contributors[e].roles.push("InformedUser"))})),Object.keys(t.informedUsers).forEach((function(e){t.owners.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Owner")||t.informedUsers[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Assignee")||t.informedUsers[e].roles.push("Assignee")),t.coOwners.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Co-owner")||t.informedUsers[e].roles.push("Co-owner")),t.contributors.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Contributor")||t.informedUsers[e].roles.push("Contributor"))}))),t.membersDataGridModel.loadMembersData(t.membersTreeModel,t.owners,t.coOwners,t.assignees,t.contributors,t.informedUsers),v.changeView(),s()}else n(new Error("Unexpected response when retrieving issues."))},onFailure:function(e){p.displayNotification({msg:g.team.error.loadContent,eventID:"error"}),n(e)}})})))},getUsersMap:function(e,t){var s={},n="";switch(t){case"owner":n="Owner";break;case"coOwners":n="Co-owner";break;case"assignees":n="Assignee";break;case"contributors":n="Contributor";break;case"informedUsers":n="InformedUser"}return e&&e.length>0&&(s=e.reduce((function(s,a){if(a[t])if(Array.isArray(a[t]))for(var i=a[t],o=0;o<i.length;o++)a[t][o].roles=[n],a[t][o].type=i[o].type,void 0!==s[a[t][o].user]?(a[t][o].count=s[a[t][o].user].count+1,a[t][o].count==e.length?a[t][o].common=!0:a[t][o].common=!1):(a[t][o].count=1,a[t][o].common=!1),s[a[t][o].user]=a[t][o];else a[t].roles=[n],a[t].type="person",s[a[t].user]=a[t];return s}),{})),s},_customizeColumnRendering:function(e){var t=this;e.forEach((function(e){switch(e.dataIndex){case"tree":e.onCellRequest=t.rendering.title.bind(t);break;case"propagate":e.onCellRequest=t.rendering.propagate.bind(t);break;case"user":default:break;case"memberof":e.onCellRequest=t.rendering.memberOf.bind(t);break;case"ContextualMenuColumn":e.hasCellValue=t.rendering.contextualMenuColumn.bind(t)}}))},rendering:{title:function(e){var t="";if(e.nodeModel.options.grid.isRoot){var s=e.nodeModel.getNumberOfChildren();"Owner"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:g.team.owner.title+" ("+s+")"}):"Co-owner"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:g.team.coOwners.title+" ("+s+")"}):"Assignee"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:g.team.assignees.title+" ("+s+")"}):"Contributor"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:g.team.contributors.title+" ("+s+")"}):"InformedUser"===e.nodeModel.options.grid.role&&(t=UWA.createElement("span",{class:"member-title",html:g.team.informedUsers.title+" ("+s+")"}))}else t=this.membersDataGridModel.createCustomPersonNameField(e.nodeModel.options.grid);t.computeContentSize=function(){return this.getChildren().length>0&&this.getChildren()[1]?this.getChildren()[1].firstChild.getBoundingClientRect().width+50:this.getBoundingClientRect().width+50},e.cellView.setReusableContent(t)},propagate:function(e){var t=this,s="",n=null;let a="";if(e.nodeModel.options.grid.isRoot||"Owner"===e.nodeModel.getParent().options.grid.role||1==t.physicalIds.length)n=UWA.createElement("span",{}),e.cellView.setReusableContent(n);else{var i=e.nodeModel.options.grid.common;n=UWA.createElement("span",{class:"propagate-column",html:UWA.createElement("span",{class:s})}),0==i&&(s="wux-ui-3ds wux-ui-3ds-propagate wux-ui-3ds-lg members-propagate",n.addContent(UWA.createElement("span",{class:s})),a=g.resolveIssues.tooltips.propagateTooltip,n.addEventListener("click",function(){var s=[e.nodeModel];t.propagateMember(s)}.bind(t))),e.cellView.setReusableContent(n)}n&&(n.tooltipInfos=new m({shortHelp:a,mouseRelativePosition:!1,position:"bottom"}))},memberOf:function(e){var t=null;if(e.nodeModel.options.grid.isRoot||"Owner"===e.nodeModel.getParent().options.grid.role)t=UWA.createElement("span",{}),e.cellView.setReusableContent(t);else{var s=e.nodeModel.options.grid.common;t=UWA.createElement("span",{class:"memberof-column"}),0==s&&this.physicalIds.length>1?t.addContent(UWA.createElement("span",{class:"memberof",html:g.team.common.varies})):t.addContent(UWA.createElement("span",{class:"memberof",html:g.team.common.allIssues})),e.cellView.setReusableContent(t)}},contextualMenuColumn:function(e){let t=!0;return t=!e.nodeModel.options.grid.isRoot,t}},propagateMember:function(e){for(var t=0;t<e.length;t++){var s=e[t].getParent().options.grid.role,n={identifier:e[t].options.grid.user,name:e[t].options.grid.fullName,type:e[t].options.grid.type},i=[],o=[],c=[],d=[];"Co-owner"==s?i.push(n):"Assignee"==s?o.push(n):"Contributor"==s?c.push(n):"InformedUser"==s&&d.push(n),a.addMembers(i,o,c,d,!1,"",e[t])}try{var u=l.get("component").getCurrentView();r.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:u,pd3:"MembersActions",pd4:"Propogate",pd5:"Issue/"+u+"/MembersActions/Propogate"}}),r.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersActions"}})}catch(e){}},propagateCoowners:function(e){e.role="coOwners",v.propagateMembers(e)},propagateAssignees:function(e){e.role="assignees",v.propagateMembers(e)},propagateContributors:function(e){e.role="contributors",v.propagateMembers(e)},propagateInformedUsers:function(e){e.role="informedUsers",v.propagateMembers(e)},propagateMembers:function(e){var t=[],s=[],n=[],i=[];if("coOwners"==e.role){var o=v.coOwners;for(var r in o){var l=o[r],c={identifier:l.user,name:l.fullName,type:l.type};t.push(c)}}if("assignees"==e.role){var d=v.assignees;for(var r in d){var u=d[r];c={identifier:u.user,name:u.fullName,type:u.type};s.push(c)}}if("contributors"==e.role){var m=v.contributors;for(var r in m){var p=m[r];c={identifier:p.user,name:p.fullName,type:p.type};n.push(c)}}if("informedUsers"==e.role){var f=v.informedUsers;for(var r in f){var g=f[r];c={identifier:g.user,name:g.fullName,type:g.type};i.push(c)}}a.addMembers(t,s,n,i,!0,e.role)},changeView:function(e){s.changeView("GridView")},addNodesInLayout:function(e,t){v.membersDataGridModel.addNodesInLayoutModel(this.membersTreeModel,e,t)},removeHandler:function(){var e=v.membersDataGridModel.treeDocument.getSelectedNodes(),t=e[0].options.grid.roles,s=(t.indexOf("Owner"),1==t.length&&t.indexOf("Owner")>=0);if(1==e.length&&s)p.displayNotification({msg:g.team.error.warnRemoveOwner,eventID:"warning"});else{var n=new c({}),a=document.getElementById("iss-outer-member-grid-div");n.inject(a),new d({immersiveFrame:n,title:g.team.removeTitle,content:g.team.removeMessage,activeFlag:!1,modelFlag:!0,width:500,buttons:{No:new u({domId:"removeMemberNo",onClick:function(e){n.destroy()}}),Yes:new u({domId:"removeMemberYes",onClick:function(e){n.destroy(),v.membersDataGridModel.removeChildren()}})}}).addEventListener("close",(function(e){n&&n.destroy()}))}try{var i=l.get("component").getCurrentView();r.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"MembersToolbar",pd4:"Remove",pd5:"Issue/"+i+"/MembersToolbar/Remove"}}),r.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersToolbar"}})}catch(e){}},updatePersonRole:function(e,t){var s=v.membersTreeModel.getSelectedNodes();if(s.length>0){for(var n=[],a=[],i=[],o=[],r=t.role,l=Array.isArray(r)?t[r[0]]:t[r],c=[],d=0;d<s.length;d++){var u=s[d].options.grid.user,m=s[d].options.grid.type;s[d].options.grid.roles;c.includes(u)||(r.indexOf("Contributor")>=0&&n.push({user:u,type:m}),r.indexOf("Assignee")>=0&&a.push({user:u,type:m}),r.indexOf("Coowner")>=0&&i.push({user:u,type:m}),r.indexOf("InformedUser")>=0&&o.push({user:u,type:m}),c.push(u))}"DISCONNECT"==l&&1==t.showConfirmation?v.showConfirmationDialog(l,i,a,n,o):v.updateMembers(l,i,a,n,o,!1)}},showConfirmationDialog:function(e,t,s,n,a){var i=new c({}),o=document.getElementById("iss-outer-member-grid-div");i.inject(o),new d({immersiveFrame:i,title:g.team.removeTitle,content:g.team.removeMessage,activeFlag:!1,modelFlag:!0,width:500,buttons:{No:new u({domId:"removeMemberNo",onClick:function(e){i.destroy()}}),Yes:new u({domId:"removeMemberYes",onClick:function(o){i.destroy(),v.updateMembers(e,t,s,n,a,!0)}})}}).addEventListener("close",(function(e){i&&i.destroy()}))},updateMembers:function(e,t,n,a,i,l){var c=this,d=[],u="",m=document.getElementById("iss-outer-member-grid-div");f.mask(m);for(var h=0;h<c.issues.length;h++){var b={physicalId:c.issues[h].id};t.length>0&&(b.coOwners=t,u="Co-owner"),n.length>0&&(b.assignees=n,u="Assignee"),a.length>0&&(b.contributors=a,u="Contributor"),i.length>0&&(b.informedUsers=i,u="InformedUser"),d.push(b)}"CONNECT"===e?o.people.update({data:{objects:d}}).then((function(){var e=v.membersTreeModel,t=e.getSelectedNodes()[0];e.prepareUpdate();var n=t.options.grid.role,a=t.options.description,i=s.getRoleNLSValue(u);let o=","+u,r=", "+i;var l=a.concat(r);v.membersDataGridModel.treeDocument.getAllDescendants().forEach((function(e){e.options.grid.user===t.options.grid.user&&(e.setAttribute("roleList",l),e.options.description=l,e.options.grid.role=n.concat(o),e.options.grid.roles.push(u))}));var d={};d.user=t.options.grid.user,d.fullName=t.options.grid.fullName,d.roles=t.options.grid.roles,d.type=t.options.grid.type,d.uri=t.options.grid.uri,"Co-owner"===u?v.addNodesInLayout([d],"coowners"):"Assignee"===u?v.addNodesInLayout([d],"assignees"):"Contributor"===u?v.addNodesInLayout([d],"contributors"):"InformedUser"===u&&v.addNodesInLayout([d],"informedUsers"),e.pushUpdate(),c.view.dispatchEvent("onUpdate",{issues:v.issues}),f.unmask(m)})).catch((function(e){if(f.unmask(m),e.error.message.includes("'business object' does not exist")){var t=r.getErrorMessage("0");r.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("You do not have the permissions to perform this action")){t=r.getErrorMessage("1");r.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No toconnect access to business object")){t=r.getErrorMessage("10");r.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")){t=r.getErrorMessage("2005");r.displayErrorMessage(t,"error")}else p.displayNotification({msg:e.error.message,eventID:"error"})})):"DISCONNECT"===e&&o.people.delete({data:{objects:d}}).then((function(){var e=v.membersTreeModel,t=e.getSelectedNodes(),n=!1;if(1==l)for(var a=0;a<t.length;a++){t[a].options.grid.roles.indexOf("Owner")>=0&&(n=!0),(o=v.membersDataGridModel.treeDocument.getAllDescendants()).forEach((function(e){e.options.grid.user===t[a].options.grid.user&&("Owner"!=e.getParent().options.grid.role?e.remove():e.options.grid.roles=["Owner"])}))}else{e.prepareUpdate();var i=e.getSelectedNodes()[0],o=v.membersDataGridModel.treeDocument.getAllDescendants(),r=i.options.grid.role,d=i.options.description,h=s.getRoleNLSValue(u),b=s.removeRole(d,h);o.forEach((function(e){if(e.options.grid.user===i.options.grid.user)if(e.getParent().options.grid.role==u)e.remove();else{e.setAttribute("roleList",b),e.options.description=b,e.options.grid.role=s.removeRole(r,u);var t=i.options.grid.roles.filter((function(e,t,s){return e!=u}));e.options.grid.roles=t}})),e.pushUpdate()}v.membersDataGridModel.coowners.setLabel(g.team.coOwners.title+" ("+v.membersDataGridModel.coowners.getNumberOfChildren()+")"),v.membersDataGridModel.assignees.setLabel(g.team.assignees.title+" ("+v.membersDataGridModel.assignees.getNumberOfChildren()+")"),v.membersDataGridModel.contributors.setLabel(g.team.contributors.title+" ("+v.membersDataGridModel.contributors.getNumberOfChildren()+")"),v.membersDataGridModel.informedUsers.setLabel(g.team.informedUsers.title+" ("+v.membersDataGridModel.informedUsers.getNumberOfChildren()+")"),n&&p.displayNotification({msg:g.team.error.skipRemoveOwner,eventID:"info"}),c.view.dispatchEvent("onUpdate",{issues:v.issues}),f.unmask(m)})).catch((function(e){if(f.unmask(m),e.error.message.includes("'business object' does not exist")){var t=r.getErrorMessage("0");r.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&(e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")||e.error.internal.includes("No 'read' access on Attribute 'Co-Owners' for")||e.error.internal.includes("You do not have the permissions to perform this action"))){t=r.getErrorMessage("1");r.displayErrorMessage(t,"error")}else p.displayNotification({msg:e.error.message,eventID:"error"})}))}};return v})),define("DS/IssueComponents/team/TeamNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/Logger/Logger","DS/IssueCommon/facets/Placeholder","DS/IssueComponents/team/MembersDataGridLayout","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],(function(e,t,s,n,a,i,o,r,l){"use strict";return t.extend({name:"DS/IssueComponents/team/TeamNew",tag:"div",className:"team-view-panel",setup:function(e){var t=this;t._logger=a.getLogger("DS/IssueComponents/team/TeamNew"),t._logger.log("Initializing the team component"),t.isLoaded=null,t._deferred={resolve:null,reject:null},t.physicalIds=e.physicalIds,t.issues=[],t.options=e,t.reset()},reset:function(){var t=this;t.isLoaded=new e((function(e,s){t._deferred.resolve=e,t._deferred.reject=s})),s.is(t.view,"object")&&t.view.container&&t.view.container.destroy(),t.view={container:null}},destroy:function(){var e=this;for(var t in e.view&&e.view.container&&e.view.container.destroy(),e)e.hasOwnProperty(t)&&delete e[t]},render:function(){var e=this;return n.mask(e.container),e.view={},e.view.container=s.createElement("div",{class:"team-view-container"}),e.options.target=e.view.container,e.view.container.inject(e.container),e.layout=o,e.isValidSelection()?(e.placeholder.hide(e.container),e.view.container.show()):(e.view.container.hide(),e.placeholder.show(e.container)),o.createMembersView(e).then((function(){n.unmask(e.container),e._deferred.resolve()}),(function(t){n.unmask(e.container),e._deferred.reject(t),e.dispatchEvent("onFailure",{error:t})})),e},refresh:function(e){var t=this;return Array.isArray(e)&&(t.physicalIds=e,t.setOption("physicalIds",e)),t.isValidSelection()?(t.placeholder.hide(t.container),t.view.container.show()):(t.view.container.hide(),t.placeholder.show(t.container)),t.loadMembers(t.physicalIds),t.isLoaded},loadMembers:function(e){var t=this;return n.mask(t.container),o.loadContent(e).then((function(){n.unmask(t.container),t._deferred.resolve()}),(function(e){n.unmask(t.container),t._deferred.reject(e),t.dispatchEvent("onFailure",{error:e})})),t},isValidSelection:function(){var e=JSON.parse(l).membersLimit,t=this.getOption("physicalIds");return Array.isArray(t)&&t.length<=e},placeholder:{_view:new i,show:function(e){this._view.render("members").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})}));