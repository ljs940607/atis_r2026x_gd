/*!  COPYRIGHT DASSAULT SYSTEMES 2021   */
define("DS/DesignEnvironmentUX/utils/DesignEnvConstants",[],(()=>Object.freeze({GLOBAL_EVENT_CLOSE_LANDING_PAGE:"ENXViews/WelcomePanel/closeLandingPage",EVENT_CLEAN_APP:"event/clean/app",EVENT_LAUNCH_COMMAND:"event/launch/command",EVENT_CROSS_HEIGHLIGHT_SELECT:"DS/PADUtils/PADCommandProxy/select",EVENT_ONSELECT:"event/onselect",EVENT_DESIGNENV_REMOVEROOT:"ENXModel/DesignEnv/removeRoot",EVENT_DESIGNENV_CLOSE:"ENXModel/DesignEnv/close",EVENTS_RESET_VIEW:"ENXModel/DesignEnv/resetView",EVENTS_ADD_ITEM:"ENXModel/DesignEnv/wip/addItem",EVENT_ROOT_REMOVE:"ENXModel/Root/remove",EVENT_ROOT_ADDTITLE:"ENXModel/Root/addTile",EVENT_ROOT_SELECT:"ENXModel/Root/select",EVENT_ROOT_REMOVE_TILE:"ENXModel/Root/removeTile",EVENTS_REMOVE_ITEMS:"DesignExp/remove/items",OPEN_DESIGN_ENV_COMMAND_ID:"OpenDesignEnvHdr",TYPE_ADVANCED_FILTER:"ENOStrRefinementSpecification",TYPE_VDRP_FILTER:"ENOStrRefinementVDRPSpec",BOTH_FILTERS:["ENOStrRefinementSpecification","ENOStrRefinementVDRPSpec"],TYPE_CHECKBOX:"checkbox",DISPLAY_TYPE_ADVANCED_FILTER:"Advanced Filter",KIND_DESIGNENV:"designenv",KIND_CONTEXT:"ctx",KIND_WIP:"wip",KIND_COW:"cow",LABEL_CONTEXT:"Context",LABEL_WIP:"Work In Progress",LABEL_COW:"Center of the World",DS_FONT_ICON_FAMILY:"DSFontIcon",DS_FONT_CONTENT:"wux-ui-3ds wux-ui-3ds",STATUS_SUCCESS:"success",STATUS_FAILURE:"failure"}))),define("DS/DesignEnvironmentUX/commands/EditPropertiesCmd",["DS/ApplicationFrame/Command"],(function(e){"use strict";return e.extend({_propertiesCommandPath:"DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase",init:function(e){e.withTimeout=!1,this._parent(e,{isAsynchronous:!0}),this.editProp=null},execute:function(){var e=this;require([this._propertiesCommandPath],(function(t){t=new t;var i=e.options.context.getActiveDesignEnv();e.disable(),i.getSelectedNodes=()=>[i],t.launchProperties(i),setTimeout((()=>{e.enable()}),2e3),e._ctx.app.probeMethods.addCommandHit("DGX-DEInformation")}))}})})),define("DS/DesignEnvironmentUX/utils/DesignEnvUtils",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","DS/CoreEvents/ModelEvents","DS/Utilities/UUID","DS/PADServices/utils/GrantedRolesCache"],(function(e,t,i,n,s){"use strict";var o,r=null,a=null,d=null,l=new i;return{init:function(t){o=this;var i=[];return s.setup({}),new Promise((function(n,o){null===a&&t&&!0===t.initURL&&i.push(new Promise((function(t,i){e.getPlatformServices({onComplete:function(e){a=e,s.initialize().then(t)},onFailure:function(e){i(e)}})}))),t&&!0===t.initWSAccess&&i.push(new Promise((function(e,i){require(["DS/DesignEnvironmentUX/ws/WSAccess"],(function(n){n.initialize({addDefaults:!0,WSDefinitionAMDs:t.WSDefinitionAMDs}).then(e).catch(i)}),i)}))),Promise.all(i).then(n).catch(o)}))},setModelEvents:function(e){l=e},getModelEvents:function(){return l},publish:function(e){return l.publish(e)},subscribe:function(e,t){return l.subscribe(e,t)},unsubscribe:function(e){return l.unsubscribe(e)},unsubscribeAll:function(e){return l.unsubscribeAll(e)},getWidgetId:function(){return"undefined"!=typeof widget?widget.id:"default-widget-id"},getAppId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):widget.getValue("appId")},getSharedId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dSharedId")?widget.getValue("x3dSharedId"):this.getAppId()},uid:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},hasVDRPRoles:()=>!!s.isEnabled("POE",!0),getPlatformId:function(){return"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},getPlatformIdForWin:function(){return a&&a.length?a[a.length-1].platformId:"OnPremise"},getTenantInfo:function(e){for(var t={},i=0;i<a.length;i++)if(a[i].platformId===e){t=a[i];break}return t},get3DSpaceURL:function(){return this.getPlatformURL("3DSpace")},getPlatformURL:function(e){if(!UWA.is(a,"array"))throw new Error("Platform services not initialize yet");var t=window.isWebInWin?this.getPlatformIdForWin():this.getPlatformId(),i=this.getTenantInfo(t);if(void 0===i[e])throw console.error("No "+e+" URL available for this tenant."),new Error("Unknown service "+e);return i[e]},getLang:function(){return"undefined"!=typeof widget?widget.lang:"en"},getUser:function(){return null==d&&(d=t.getUser()),d},setSecurityContext:function(e){r=e},getSecurityContext:function(){return r},isValidDesignEnv:function(e){return!0},getRequestLabel:function(){return this.getUserLogin()+"-"+this.getAppId()+"-"+Date.now()},getUserLogin:function(){var e=this.getUser(),t="";return void 0!==e&&(t=e.login),t},retrieveAndSetSC:function(e){var t=this;return new Promise((function(e,i){require(["DS/DesignEnvironmentUX/ws/WSAccess"],(function(n){n.getscandcollab().then((function(n){var s=UWA.is(n,"string")?JSON.parse(n):n,o=s?.credentials&&s.credentials.length?`ctx::${s.credentials[0].ctxname}`:i("No security context found!");t.setSecurityContext(o),e()}))}),i)}))},getIndexCallParams:function(e){return{input_physical_ids:[e],primitives:[{navigate_to_sr:{id:1,mode:"path",filter:{role:["574"],semantics:["1"]}}},{navigate_to_sr:{id:2,mode:"path",filter:{role:["575"],semantics:["1"]}}},{navigate_to_sr:{id:3,mode:"path",filter:{role:["576"],semantics:["1"]}}}],patterns:{Context:[{id:1,iter:1}],WIP:[{id:2,iter:1}],COW:[{id:3,iter:1}]},version:3,label:"DesignExp3dExcite"}},getQueryOpts:(e,t)=>({method:e,proxy:t.proxy,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":o.getLang(),...t.securityCtx&&{SecurityContext:t.securityCtx}},data:t.data,timeout:6e4})}})),define("DS/DesignEnvironmentUX/services/CommandsService",["DS/ApplicationFrame/CommandsManager","text!DS/DesignEnvironmentUX/assets/menus/MenuInfo.json","text!DS/DesignEnvironmentUX/assets/menus/Commands.json","i18n!DS/DesignEnvironmentUX/assets/nls/DesignEnvironmentUX","text!DS/DesignEnvironmentUX/assets/menus/MenuInfoReadOnlyInWeb.json"],((e,t,i,n,s)=>class{constructor(e){this.app=e.app,this._commandsInfo=JSON.parse(i),this._menuInfos=this.app.isReadOnly?{}:this.app.getIsReadOnlyInWeb()?JSON.parse(s):JSON.parse(t)}initialize(){let e=this;this._eventToken=this.app.core.dsEnvEventManager.subscribe(this.app.core.designEnvConstants.EVENT_LAUNCH_COMMAND,(function(t){e._commandsListener(t)})),this.commandLoaderStatus={},this.app.core.mandatoryStartupPromises.push(...this.loadAllCommand())}renderMenu(){return this.getMenu()}getMenu(){let e=this.getSelectedItemInfo(),t=this._getTemplateMenu(e.kind),i=this.getCommands(e);return this.buildMenu(t,i,e)}getCommands(e){let t=[],i=this._commandsInfo;if(e.kind==this.app.core.designEnvConstants.KIND_DESIGNENV||e.kind==this.app.core.designEnvConstants.KIND_CONTEXT||e.kind==this.app.core.designEnvConstants.KIND_WIP||e.kind==this.app.core.designEnvConstants.KIND_COW)return i;let n=e.multiSelected;for(let e in i){let s=i[e],o=!0;o=!n||1==s.multiSelect,s.nls_key="DesignEnvRemoveContentHdr"==s.commandHdr?n?"removeItems":"remove":s.nls_key,o&&(t[e]=s)}return t}buildMenu(e,t,i){var n=this;let s=[];return e.forEach((e=>{if(e.type){let o=t[e.ID];s.push(n._buildMenuEntry(o,"PushItem",i.kind))}})),s}_buildMenuEntry(e,t,i){var s=this;return{type:t,title:this.app.core.contextManager.getSelectedContext().getKind()==this.app.core.designEnvConstants.KIND_COW?n.designenv.setItemLabel:n.designenv[e.nls_key],fonticon:{family:this.app.core.designEnvConstants.DS_FONT_ICON_FAMILY,content:`${this.app.core.designEnvConstants.DS_FONT_CONTENT}-${e.fonticon}`},action:{context:this,callback:function(){s.commandHandler(e,i)}},state:e.checkState?s.getState(e.commandHdr):"enabled"}}commandHandler(e,t){this.executeCommand(e.commandHdr)}executeCommand(t,i){var n=this._commandsInfo[t];i&&i();let s=e.getCommand(n.commandHdr,widget);s&&s.begin()}loadAllCommand(){var e=this;let t=[];for(let i in this._commandsInfo){let n=e._commandsInfo[i],s=new Promise((function(t,i){e.loadCommand(n,t,i)}));t.push(s)}return t}loadCommand(e,t,i){if(!e||!e.commandHdr||!e.AmdLoader)return console.error("Oups ! no valid command description"),void i("Oups ! no valid command description");var n=this;return require([e.AmdLoader],(function(i){new i({context:n.app.core.contextManager,app:n.app,ID:e.commandHdr}),t()}),(function(e){i(e)}))}_getTemplateMenu(e){return Object.keys(this._menuInfos).length&&this._menuInfos.templates[e]||[]}_commandsListener(e){this.executeCommand(e.commandId)}getSelectedItemInfo(){let e=1,t=!1,i=[],n=this.app.core.contextManager.getSelectedItems();Array.isArray(n)&&n.length>0&&(t=!0,e=n.length,n.forEach((e=>{-1==i.indexOf(e.getKind())&&i.push(e.getKind())})));let s=this.app.core.contextManager.getSelectedContext();return{kind:null!=s?s.getKind():0==i.length?n.getKind():1==i.length?i[0]:void 0,nbSelectedItems:e,multiSelected:t,selectedItemsKind:i,areSameKindOfItemsSelected:i.length<=1}}getState(e){let t="enabled",i=this.app.core.contextManager.getSelectedItems();if(Array.isArray(i))return this.app.core.dataProvider.getMissingItems().length||"AddInViewCmd"!=e?t:"disabled";if(this.app.core.dataProvider.getDeTypes().includes(i.getKind())&&!i.getChildren().length&&"AddInViewCmd"==e)return"disabled";if("AddInViewCmd"==e&&i&&"ENOStrRefinementVDRPSpec"==i.options.objectType)return"disabled";if(this.app.core.contextManager.isFilter(i)&&!this.app.core.contextManager.isDeFilterAvailableInDGV(i))return t;switch(e){case"RemoveItemsFromFolderCmd":t=i.hasChildren()?"enabled":"disabled";break;case"AddInViewCmd":t=this.app.core.dataProvider.isItemInPseView()?"disabled":"enabled"}return t}})),define("DS/DesignEnvironmentUX/utils/DesignEnvModelEvents",["DS/CoreEvents/ModelEvents"],(function(e){"use strict";var t=new e;return{getModelEvents:function(){return t},publish:function(e){return t.publish(e)},subscribe:function(e,i){return t.subscribe(e,i)},subscribeOnce:t.subscribeOnce,unsubscribe:function(e){return t.unsubscribe(e)},unsubscribeAll:function(e){return t.unsubscribeAll(e)}}})),define("DS/DesignEnvironmentUX/commands/CloseDesignEnvCmd",["DS/ApplicationFrame/Command"],(e=>class extends e{constructor(e){super(e,"CloseDesignEnvCmd"),this.app=e.app}execute(){this.app.getModelEvent().publish({event:this.app.core.designEnvConstants.EVENT_DESIGNENV_CLOSE,data:{designExp:this.app.core.contextManager.getActiveDesignEnv()}})}})),define("DS/DesignEnvironmentUX/commands/AddInViewCmd",["DS/ApplicationFrame/Command"],(e=>class extends e{constructor(e){super(e,"Design_Env_add_in_view_command"),this.app=e.app}execute(){this.addInView()}addInView(){let e=this,t=this.app.core.dataProvider.getItemsAsArray(this.app.core.contextManager.getSelectedItems());if(this.app.core.dataProvider.getDeTypes().includes(this._ctx._selectedContext.getKind())){let e=this._ctx.app.core.dataProvider.getMissingItems().filter((e=>!this._ctx.app.core.contextManager.isFilter(e)));t=t.filter((t=>this._ctx.app.core.contextManager.isFilter(t)?t:e.find((e=>e.options.resourceid==t.options.resourceid))))}this.app.core.pseCommonService.filtersToLoad=[],t.forEach((t=>{if(e.app.core.contextManager.isFilter(t)&&(t.options.isFilterModified||!e.app.core.contextManager.isDeFilterAvailableInDGV(t))){this.app.core.pseCommonService.filtersToLoad.push(t);let i=this.app.core.pseCommonService.getChildren().filter((e=>e.options.resourceid==t.options.associatedRoot));i.length&&(e.app.core.pseCommonService.removItems([i[0].options.resourceid]),t.options.isFilterModified&&(t.options.isFilterModified=!1,i[0].options.isFilterModified=!1))}})),this.app.core.pseCommonService.addItems(t),setTimeout((()=>{t.length&&(e.app.core.pseCommonService.updateIsReadOnlyAndAssetType(t.filter((t=>!e.app.core.contextManager.isFilter(t)))),"designenv"==this._ctx._selectedContext.getKind()&&e.app.core.pseCommonService.applyDefaultSort(),e.app.core.pseCommonService.reorderDgvAssets(),e.app.core.pseCommonService.reorderDgvAssets(),this.app.core.pseCommonService.filtersToLoad.length&&(e.app.core.pseCommonService.isCustomFilterLoad=!0),e.app.core.contextManager.hasFiltersInDE()&&e.app.core.pseCommonService.triggerFilterReorderOnSort())}),1e3)}})),define("DS/DesignEnvironmentUX/DesignExpComponent",["DS/Selection/CSOManager"],(e=>{let t=null,i=null;const n="CATC3D_AP";return class{constructor(s){this.initialize=function(){t=this,i=t.getExecutionContext(),e.onPostAdd(this._onSelection.bind(this)),e.onPostRemove(this._onDeSelection.bind(this))},this.clean=function(){return new Promise((e=>{e()}))},this.destroy=function(){return new Promise((e=>{e()}))},this._onSelection=function(){let e=i?i.getSourceApp():"";e&&e.getId()==n&&e.pad3DViewer.getController().isDesignExperienceEnabled()&&e.pad3DViewer.getController().hasReadOnlyRootSelection()&&(e.pad3DViewer.disableCmd("ENO3DVolumeQueryCmd"),setTimeout((()=>{e.pad3DViewer.getCommandHandler().disableHandler("ActionBar_Attributes")}),500))},this._onDeSelection=function(){let e=i?i.getSourceApp():"";e&&e.getId()==n&&e.pad3DViewer.getController().isDesignExperienceEnabled()&&(e.pad3DViewer.getController().hasReadOnlyRootSelection()||e.pad3DViewer.enableCmd("ENO3DVolumeQueryCmd"))}}}})),define("DS/DesignEnvironmentUX/utils/DesignEnvCtx",["DS/PlatformAPI/PlatformAPI"],(function(e){"use strict";function t(){return"object"==typeof t.instance?t.instance:(t.instance=this,this.designEnvCtx=void 0,this.appId=void 0,this)}return t.prototype.initialize=function(t){return new Promise(function(i,n){t.appId?(this.appId=t.appId,e.subscribe("DS/DesignEnvCtx/"+t.appId+"/setContext",this._setContext.bind(this)),i()):n("DesignEnvCtx#initialize: Invalid input parameters missing appId")}.bind(this))},t.prototype.setContext=function(t){this._setContext(t),e.publish("DS/DesignEnvCtx/"+this.appId+"/setContext",t)},t.prototype.getContext=function(){return"my_sandbox"},t.prototype.hasContext=function(){return void 0!==this.designEnvCtx&&null!==typeof this.designEnvCtx},t.prototype._setContext=function(e){if(void 0===e.designEnvCtx)throw new Error("DesignEnvCtx#_setContextAPI: Invalid input parameters missing designEnvCtx");this.designEnvCtx=e.designEnvCtx},new t})),define("DS/DesignEnvironmentUX/services/DesignEnvEventsManager",["DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI"],((e,t)=>{let i=null;return class{constructor(e){return i||this.getNewInstance(e)}initialize(e){}getNewInstance(t){return this.options=t,this._eventBroker=new e,i=this,this}publish(e,t){this._eventBroker.publish({event:e,data:t})}subscribe(e,t){return this._eventBroker.subscribe({event:e},t)}unsubscribe(e){this._eventBroker.unsubscribe(e)}unsubscribeAll(){this._eventBroker&&(this._eventBroker.destroy(),this._eventBroker=new e)}destroy(){this._eventBroker.destroy()}publishPlatformEvent(e,i){t.publish(e,i)}subscribePlatformEvent(e,i){return t.subscribe(e,i)}}})),define("DS/DesignEnvironmentUX/services/DesignEnvAlertManager",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],((e,t)=>class{constructor(e){this.options=e}static initialize(){this.notifManager=e,t.setNotificationManager(this.notifManager),t.setStackingPolicy(5),t.setRemoveStackOnFirstTimeoutFlag(!0),t.setFadeOutPolicy(2)}static successAlert(e){this.notifManager||this.initialize(),this.notifManager.addNotif({level:"success",message:e,sticky:!1})}static infoAlert(e){this.notifManager||this.initialize(),this.notifManager.addNotif({level:"info",message:e,sticky:!1})}static warningAlert(e){this.notifManager||this.initialize(),this.notifManager.addNotif({level:"warning",message:e,sticky:!1})}static errorAlert(e,t,i){this.notifManager||this.initialize(),this.notifManager.addNotif({level:"error",title:i,message:e,subtitle:t,sticky:!1})}})),define("DS/DesignEnvironmentUX/services/DesignEnvContextManager",[],(()=>{let e=null;return class{constructor(t){return e||this.getNewInstance(t)}getNewInstance(t){return this.app=t&&t.app?t.app:{},e=this,this}initialize(){this._activeDesignEnv=null,this._selectedContext={},this._modelEvents={}}isValidContextToOpen(e){return!0}getWidgetId(){return"undefined"!=typeof widget?widget.id:"default-widget-id"}getAppId(){if("undefined"!=typeof widget)return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):widget.getValue("appId")}getSharedId(){if("undefined"!=typeof widget)return widget.getValue("x3dSharedId")?widget.getValue("x3dSharedId"):this.getAppId()}getServiceId(){return"3DSpace"}setActiveDesignEnv(e){this._activeDesignEnv=e}removeActiveDesignExp(){this._activeDesignEnv=null}getActiveDesignEnv(){return this._activeDesignEnv}setNextOpenSelection(e){this._nextOpenSelection=e}getNextOpenSelection(){return this._nextOpenSelection}setSelectedContext(e){this._selectedContext=e}getSelectedContext(){return this._selectedContext}getContextAssets(){return this.getActiveDesignEnv()?this.getActiveDesignEnv().getContext().getChildren():[]}getWipAssets(){return this.getActiveDesignEnv()?this.getActiveDesignEnv().getWip().getChildren():[]}getCowAsset(){return this.getActiveDesignEnv()?this.getActiveDesignEnv().getCow().getChildren():[]}hasFiltersInDE(){return!!this.getContextAssets()&&this.getContextAssets().find((e=>this.isFilter(e)))}isDeFilterAvailableInDGV(e){return!!this.app.core.pseCommonService.getChildren().find((t=>t.options.filterId==e.options.resourceid))}handleDesignExpItemsSelection(e){let t=this.getSelectedItems();this.designAssetTypeSelection="";let i=this.app.core.dataProvider.getDeTypes(),n=this.app.core.pseCommonService.getChildren();if(!e.paths.length&&t.length&&n.length&&Array.isArray(t)&&!t.filter((e=>i.includes(e.options.kind))).length)e.dePaths=[];else{if(Array.isArray(t)?(e.designAssetTypeSelection=t.length&&i.includes(t[0].getKind())?t[0].getKind():"",e.dePaths=t.filter((e=>!i.includes(e.options.kind))).map((e=>e.options.resourceid))):!t||n.find((e=>e.options.resourceid===t.options.resourceid&&!this.hasFilterCondition(t,e)||t.options.resourceid===e.options.filterId))||i.includes(t.options.kind)||(e.dePaths=[t.options.resourceid]),!this.app.listView.isSelectionFromDE&&e.dePaths&&e.dePaths.length>1&&1==e.paths.length&&!e.designAssetTypeSelection)if(2==e.dePaths.length){let t=e.dePaths.findIndex((t=>t==e.paths[0][0]));-1==t||n.find((t=>t.options.resourceid==e.paths[0][0]&&t.options.filtered))?e.dePaths=[]:e.dePaths.slice(t,1)}else e.dePaths=[];!this.app.listView.isSelectionFromDE&&e.dePaths&&e.paths&&(e.dePaths=e.paths),this.designAssetTypeSelection=e.designAssetTypeSelection}}hasFilterCondition(e,t){return!!(!this.isFilter(e)&&this.app.core.pseCommonService.isPSEFilter(t)&&t.options.filterId||this.isFilter(e)&&!this.app.core.pseCommonService.isPSEFilter(t))}isFilter(e){return e.getType()==this.app.core.designEnvConstants.TYPE_ADVANCED_FILTER}getDesignExpItem(e){return this.app.core.dataProvider.getItemsAsArray(this.getActiveDesignEnv().getContents().filter((t=>t.getID()==e||t.options.associatedRoot==e)))}getSelectedItems(){let e=this.app.listView.getModels().getSelectedNodes();return Array.isArray(e)&&1==e.length?e[0]:e}isWipSelected(){return!!this.app.core.dataProvider.getItemsAsArray(this.getSelectedItems()).filter((e=>"wip"==e.getParent().getKind())).length}isCtxSelected(){return!!this.app.core.dataProvider.getItemsAsArray(this.getSelectedItems()).filter((e=>"ctx"==e.getParent().getKind())).length}isCowSelected(){return!!this.app.core.dataProvider.getItemsAsArray(this.getSelectedItems()).filter((e=>"cow"==e.getParent().getKind())).length}hasCowContent(){return!!this.getActiveDesignEnv()&&!!this.getActiveDesignEnv().getCow().getChildren().length}hasVdrpFilter(){return!!this.getActiveDesignEnv()&&!!this.getContextAssets().find((e=>"ENOStrRefinementVDRPSpec"==e.options.objectType))}getSortIdentifier(e){let t=e?this.getDesignExpItem(e.options.resourceid):null;return t?t[0]?.options.sortIdentifier:1}handleExpandCollapseEvents(){this.app.deFolderNodes.forEach((e=>{e.onPostCollapse(this.onPostCollapseExpand.bind(this)),e.onPostExpand(this.onPostCollapseExpand.bind(this))}))}onPostCollapseExpand(e){"postCollapse"==e.event&&e.data.nodeModel.getAllDescendants().find((e=>e._isSelected))?(e.data.nodeModel.highlight(),this.updateFolderBorder(e.data.nodeModel.getKind(),"update")):this.designAssetTypeSelection!=e.data.nodeModel.getKind()&&e.data.nodeModel.isHighlighted()&&(e.data.nodeModel.unhighlight(),this.updateFolderBorder(e.data.nodeModel.getKind(),"remove"))}updateFolderBorder(e,t){let i=this,n=document.querySelectorAll('.designenvpanel-main [data-node-depth="0"]'),s=document.querySelectorAll('.designenvpanel-main [data-node-depth="1"]'),o=document.querySelectorAll(".designenvpanel-main .wux-layouts-datagridview-tree-node-cell");function r(e,t){e.forEach((e=>{!t&&e?.hasAttribute("is-active")?e.removeAttribute("is-active"):t&&!e?.hasAttribute("is-active")&&e.setAttribute("is-active","")}))}setTimeout((()=>{"ALL"==e&&"remove"==t&&r(o,!1),"designenv"==e?(r(n,"update"==t),"remove"==t&&(r(o,!1),i.app.deFolderNodes[1].isHighlighted()&&s[0].setAttribute("is-active",""),i.app.deFolderNodes[2].isHighlighted()&&s[1].setAttribute("is-active",""),i.app.deFolderNodes[3].isHighlighted()&&s[2].setAttribute("is-active",""))):"ctx"==e?r([s[0]],"update"==t):"wip"==e?r([s[1]],"update"==t):"cow"==e&&r([s[2]],"update"==t)}),10)}setModelEvents(e){this._modelEvents=e}getModelEvents(){return this._modelEvents}}})),define("DS/DesignEnvironmentUX/collections/DesignEnvTreeDocument",["DS/TreeModel/TreeDocument"],(e=>{function t(t){t=t||{},e.call(this,t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t})),define("DS/DesignEnvironmentUX/services/HelperService",["DS/WebappsUtils/WebappsUtils"],(e=>class{static getIconPath(t){return e.getWebappsAssetUrl("DesignEnvironmentUX",`icons/32/${t}.png`)}})),define("DS/DesignEnvironmentUX/services/DataBuilder",["DS/DesignEnvironmentUX/utils/DesignEnvUtils","DS/Utilities/UUID"],((e,t)=>class{constructor(e){this.core=e&&e.app?e.app.core:e}buildContentOptions(e){let i={protocol:"3DXContent",version:"1.1",source:t.v4(),widgetId:"undefined"==typeof widget?t.v4():widget.id,data:{}};return e?(i.data.items=e.results.map(this.getContentOption.bind(this)),i):i}getContentOption(t){return{objectId:t.filterId?t.filterId:t.AssetID,actorType:t.ActorType,actorID:t.ActorID,label:t.filterId?t.filterTitle:t.AssetName,displayName:t.filterId?t.filterTitle:t.AssetName,objectType:t.filterId?this.core.designEnvConstants.TYPE_ADVANCED_FILTER:t.AssetType,displayType:t.filterId||t.AssetType==this.core.designEnvConstants.TYPE_VDRP_FILTER||this.core.designEnvConstants.BOTH_FILTERS.includes(t.AssetType)?this.core.designEnvConstants.DISPLAY_TYPE_ADVANCED_FILTER:t.AssetType,envId:e.getPlatformId(),serviceId:this.core.contextManager.getServiceId(),contextId:e.getSecurityContext()}}})),define("DS/DesignEnvironmentUX/services/DesignEnvSearchService",["DS/DesignEnvironmentUX/utils/DesignEnvUtils"],(e=>{let t=null;return class{constructor(e){return t||this.getNewInstance(e)}getNewInstance(e){return this.core=e&&e.app?e.app.core:e,t=this,this}launchSearch(e){let t={parent_window:e.odtSpecificParentWindow,title:e.title,precond:e.precondition,fts_value:e.fts_value,showApplyButton:e.showApplyButton,applyButton_Nls:e.applyButton_Nls,callback:e.ok,apply:e.apply,cancel:function(e){}};this.core.wsDataService.inAppsSearch(t)}searchDataToDropData(t){var i="string"==typeof t?JSON.parse(t):t,n={data:{items:[]}};if(i.length>0)for(var s=0;s<i.length;s++){var o={displayName:i[s]["ds6w:label"],displayType:i[s]["ds6w:type"],objectId:i[s].id,objectType:i[s]["ds6w:type_value"],serviceId:"3DSpace",envId:e.getPlatformId(),contextId:e.getSecurityContext()};n.data.items.push(o)}return n}}})),define("DS/DesignEnvironmentUX/ws/WSDesignExp",["DS/DesignEnvironmentUX/utils/DesignEnvUtils","DS/WebappsUtils/WebappsUtils"],(function(e,t){"use strict";function i(){}return i.prototype.addExperienceAssets=function(t){var i=e.getSecurityContext(),n=this,s=function(){var i=e.get3DSpaceURL()+"/resources/v1/3dcommunication/experiences/"+t.deId+"/actors?tenant="+e.getPlatformId();let s=t.assets.map((e=>({assetID:e,role:"wip"==t.actorKind?"V_DEtoWIPAsset":"cow"==t.actorKind?"V_DEtoCoW":"V_DEtoContextAsset",actorType:"wip"==t.actorKind?"DEWIPActor":"cow"==t.actorKind?"V_DEtoCoW":"DEContextActor"}))),o=e.getQueryOpts("POST",{data:s});return n.executeRequestPromise(i,o)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.removeExperienceAssets=function(t){var i=e.getSecurityContext(),n=this,s=function(){var i=e.get3DSpaceURL()+"/resources/v1/3dcommunication/experiences/"+t.folderId+"/actors?tenant="+e.getPlatformId();let s=e.getQueryOpts("DELETE",{data:t.ids});return n.executeRequestPromise(i,s)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.getExperienceAssets=function(t){var i=e.getSecurityContext(),n=this,s=function(){var i=e.get3DSpaceURL()+"/resources/v1/3dcommunication/experiences/"+t.deId+"/actors?Content=All&tenant="+e.getPlatformId()+"&$pageSize=50";t.hasPagination&&(i+="&$pageStart=51");let s=e.getQueryOpts("GET",{});return n.executeRequestPromise(i,s)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.getExperienceAssetsonIndex=function(t){var i=e.getSecurityContext(),n=this,s=function(){var s=e.get3DSpaceURL()+"/cvservlet/navigate?tenant="+e.getPlatformId();i&&(s+="&SecurityContext="+i);let o=e.getQueryOpts("POST",{data:e.getIndexCallParams(t.deId)});return n.executeRequestPromise(s,o)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.saveUnsavedFilter=function(t){var i=this,n=e.getSecurityContext(),s=function(){var s=`${e.get3DSpaceURL()}/resources/FilterBIAPI/Filter/createFilter`,o={filterName:t.name,filterDescription:"",rootPhysicalId:t.rootID,filterUIComponents:t.componentsToFeedUI,filterTitle:t.title,rootServiceId:""};let r=e.getQueryOpts("POST",{securityCtx:n,data:JSON.stringify(o)});return i.executeRequestPromise(s,r)};return n?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.getDefaultFilterName=function(t){var i=e.getSecurityContext(),n=this,s=function(){var s=`${e.get3DSpaceURL()}/resources/FilterBIAPI/Filter/getDefaultName?filterName=${encodeURIComponent(t)}`;let o=e.getQueryOpts("GET",{securityCtx:i,proxy:"passport"});return n.executeRequestPromise(s,o)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.fetch=function(t){return new Promise(function(i,n){var s=t.data||{},o=Object.assign({label:"fetch-"+e.getRequestLabel(),locale:e.getLang(),tenant:e.getPlatformId()},s);void 0!==t.pids&&(o.physicalid=t.pids);var r=[];r.push("ds6w:type"),r.push("ds6w:label"),o.select_predicate=r;var a=e.getSecurityContext(),d=e.get3DSpaceURL()+"/cvservlet/fetch/v2?tenant="+e.getPlatformId();let l=e.getQueryOpts("POST",{data:JSON.stringify(o)});l={...l,timeout:t.timeout?t.timeout:void 0,onComplete:i,onFailure:n},a&&(d+="&SecurityContext="+a),this.executeRequest(d,l)}.bind(this))},i})),define("DS/DesignEnvironmentUX/ws/WSDesignEnv",["DS/DesignEnvironmentUX/utils/DesignEnvUtils","DS/WebappsUtils/WebappsUtils"],(function(e,t){"use strict";function i(){}return i.prototype.getFolderContent=function(t){var i=this;return new Promise(function(n,s){var o=e.get3DSpaceURL()+"/resources/v1/FolderManagement/Folder/"+t.folderId+"/content?Content=All&tenant="+e.getPlatformId(),r={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:n,onFailure:s};i.executeRequest(o,r)}.bind(this))},i.prototype.addFolderContent=function(t){var i=e.getSecurityContext(),n=this,s=function(){var i={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":e.getLang()},timeout:6e4},s=e.get3DSpaceURL()+"/resources/v1/FolderManagement/Folder/"+t.folderId+"/content?tenant="+e.getPlatformId(),o={IDs:String(t.ids)};return i.data=o,n.executeRequestPromise(s,i)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.removeFolderContents=function(t){var i=e.getSecurityContext(),n=this,s=function(){i||(i=e.getSecurityContext());var s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":e.getLang()},timeout:6e4},o=e.get3DSpaceURL()+"/resources/v1/FolderManagement/Folder/"+t.folderId+"/removecontent?tenant="+e.getPlatformId();i&&(o+="&SecurityContext="+i);var r={IDs:String(t.ids)};return s.data=r,n.executeRequestPromise(o,s)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.createFolder=function(t){var i=e.getSecurityContext(),n=this,s=function(){var s=t.rootFolder?t.rootFolder:"Native";i||(i=e.getSecurityContext());var o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":e.getLang()},timeout:6e4},r=e.get3DSpaceURL()+"/resources/v1/collabServices/authoring/op/createContent?tenant="+e.getPlatformId();r+="&folderID="+s,i&&(r+="&SecurityContext="+i);var a={expectSingleCreation:!1,type:"folder"};return t.title&&(a.title=t.title),o.data=a,n.executeRequestPromise(r,o)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i.prototype.deleteFolderStructure=function(t){var i=e.getSecurityContext(),n=this,s=function(){i||(i=e.getSecurityContext());var s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":e.getLang()},timeout:6e4},o=e.get3DSpaceURL()+"/resources/lifecycle/Delete/structure?tenant="+e.getPlatformId();i&&(o+="&SecurityContext="+i);var r={data:[{physicalid:t.id}],options:[]};return s.data=r,n.executeRequestPromise(o,s)};return i?s():new Promise(function(t,i){e.retrieveAndSetSC().then((function(){s().then(t)}))}.bind(this))},i})),define("DS/DesignEnvironmentUX/ws/WSMisc",["UWA/Utils/InterCom","DS/Utilities/Utils","DS/DesignEnvironmentUX/utils/DesignEnvUtils"],(function(e,t,i){"use strict";function n(){}return n.prototype.getscandcollab=function(){var e=this;return new Promise(function(t,n){var s={},o=`${i.get3DSpaceURL()}/resources/vplmte/getallctx?tenant=${i.getPlatformId()}`;s.method="GET",s.headers={Accept:"application/json","Accept-Language":i.getLang(),"Content-Type":"application/json"},s.cache=-1,s.onComplete=t,s.onFailure=n,e.executeRequest(o,s)}.bind(this))},n.prototype.fetchFilter=function(e){return new Promise(function(t,n){var s=e.data.filterids,o=i.getSecurityContext(),r=i.get3DSpaceURL()+"/resources/FilterBIAPI/Filter/getBasicsInDBFromIds?tenant="+i.getPlatformId(),a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:e.timeout?e.timeout:void 0,data:JSON.stringify(s),onComplete:t,onFailure:n};o&&(r+="&SecurityContext="+o),this.executeRequest(r,a)}.bind(this))},n.prototype.getFiltersFromIds=function(e){return new Promise(function(t,n){var s=e.data.filterids,o=i.getSecurityContext(),r=i.get3DSpaceURL()+"/resources/FilterBIAPI/Filter/getFiltersFromIds?tenant="+i.getPlatformId(),a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:e.timeout?e.timeout:void 0,data:JSON.stringify(s),onComplete:t,onFailure:n};o&&(r+="&SecurityContext="+o),this.executeRequest(r,a)}.bind(this))},n.prototype.retrieveFiltersForRoots=function(e){return new Promise(function(t,n){var s=e.data.rootIds,o=i.getSecurityContext(),r=i.get3DSpaceURL()+"/resources/FilterBIAPI/Filter/retrieveFiltersForRoots?tenant="+i.getPlatformId(),a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:e.timeout?e.timeout:void 0,data:JSON.stringify(s),onComplete:t,onFailure:n};o&&(r+="&SecurityContext="+o),this.executeRequest(r,a)}.bind(this))},n.prototype.inAppsSearch=function(n){var s=Object.assign(function(){var e={mode:"furtive",default_with_precond:!0,widget_id:i.getWidgetId(),app_socket_id:"enosearchutils_"+i.getWidgetId(),idcard_activated:!1,advanced_search:{showByDefault:!1},tenant:i.getPlatformId()};return e}(),n),o=new e.Socket(s.app_socket_id,{dispacthRetryInterval:0});!0===n.debug_mode&&o.setDebugMode(!0),UWA.is(n.parent_window)?o.subscribeServer("SearchComServer",window):o.subscribeServer("SearchComServer"),o.dispatchEvent("RegisterContext",s),UWA.is(n.context_name)&&(s.context_title=n.context_name),s.default_search_criteria=n.fts_value,o.dispatchEvent("InContextSearch",s);var r,a=[];o.addListener("InContextSearch_Response",(function(e){e,a=e.selected_objects,r=e.selected_command}));var d=t.debounce((function(e){switch(r){case"in_app_ok":n.callback.call(null,a);break;case"in_app_apply":n.apply?n.apply.call(null,a):n.callback.call(null,a);break;default:n.cancel&&n.cancel.call(null)}o.removeListener("onCloseTransient",d),o.dispatchEvent("UnregisterContext",{widget_id:s.widget_id})}),200);o.addListener("onCloseTransient",d),o.addListener("onCloseTransient",(function(e){n.cancel&&n.cancel.call(null),o.dispatchEvent("UnregisterContext",{widget_id:s.widget_id})}))},n})),define("DS/DesignEnvironmentUX/commands/DesignExpRefreshView",["DS/ApplicationFrame/Command","DS/DesignEnvironmentUX/utils/DesignEnvUtils"],((e,t)=>class extends e{constructor(e){super(e,"Design_Env_delete_command"),this.app=e.app}execute(){this.app.core.dsEnvEventManager.publish(this.app.core.designEnvConstants.EVENTS_RESET_VIEW,{deid:this.options.context.getSelectedContext().getID()})}})),define("DS/DesignEnvironmentUX/utils/Utils",["DS/DesignEnvironmentUX/utils/DesignEnvConstants"],(e=>{var t=["VPMReference","ENOStrRefinementSpecification"],i=["AxisSystemReference","VPMReferenceExtPos"];return class{static isAdvancedFilter(t){return null!=t&&(t.objectType==e.TYPE_ADVANCED_FILTER||t.displayType==e.DISPLAY_TYPE_ADVANCED_FILTER)}static isVDRPFilter(t){return null!=t&&(t.objectType==e.TYPE_VDRP_FILTER||t.displayType==e.DISPLAY_TYPE_ADVANCED_FILTER)}static getAuthorisedRoots(){return t}static getPoeAuthorisedRoots(){return i}static authoriseVDRPRoot(){t.push("ENOStrRefinementVDRPSpec")}}})),define("DS/DesignEnvironmentUX/commands/DesignEnvAddItemToWIPCmd",["DS/ApplicationFrame/Command","DS/DesignEnvironmentUX/utils/DesignEnvUtils","DS/DesignEnvironmentUX/utils/Utils","i18n!DS/DesignEnvironmentUX/assets/nls/DesignEnvironmentUX"],((e,t,i,n)=>class extends e{constructor(e){super(e,"newAdd_contexItem_command"),this.app=e.app}execute(){let e=this;this.app.core.searchService.launchSearch({precondition:'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference"',fts_value:void 0,showApplyButton:!1,ok:function(s){var o=[];let r=e.app.core.searchService.searchDataToDropData(s),a=e.app.core.contextManager.getSelectedContext(),d=r.data.items;d=d.filter((s=>{if("AxisSystemReference"===s.objectType)e.app.core.dataProvider.displayWarning(n.replace(n.designenv.unsupported_drop,{type:s.objectType}));else{if(t.hasVDRPRoles()||"VPMReferenceExtPos"!==s.objectType)return i.getAuthorisedRoots().includes(s.objectType)||o.push(s.objectType),s;e.app.core.dataProvider.displayWarning(n.designenv.unauthorisedDrop)}})),e.app.listView._areTypesAuthorised(o).then((t=>{t.length?r.data.items=d.filter((e=>!t.includes(e.objectType))):r.data.items=d,e.app.core.dsEnvEventManager.publish(e.app.core.designEnvConstants.EVENTS_ADD_ITEM,{data:r,kind:a.getKind()})}))}})}})),define("DS/DesignEnvironmentUX/services/DesignEnvDataProvider",["DS/DesignEnvironmentUX/services/DesignEnvAlertManager","DS/DesignEnvironmentUX/utils/DesignEnvUtils","DS/DesignEnvironmentUX/utils/Utils","DS/UIKIT/Mask","i18n!DS/DesignEnvironmentUX/assets/nls/DesignEnvironmentUX","text!DS/DesignEnvironmentUX/assets/menus/DesignExpSettings.json"],((e,t,i,n,s,o)=>{let r=1;const a=Object.freeze({maxAssetAddition:115});var d=[];return class{constructor(e){this.app=e.app?e.app:e,this.options=e,this.initialize(e)}initialize(e){this.filtersRootsMap={},this.contentLoaderPromise=[],this.saveFilterData={},d=[{label:this.app.core.designEnvConstants.LABEL_CONTEXT,displayName:this.getNLS().contextLabel},{label:this.app.core.designEnvConstants.LABEL_WIP,displayName:this.getNLS().wipLabel},{label:this.app.core.designEnvConstants.LABEL_COW,displayName:this.getNLS().cowLabel}]}getNewInstance(e){return this.options=e,instance=this,this}buildFetchParams(e){return{pids:[e.objectId],data:{select_predicate:["ds6w:label"]},isReadOnly:this.app.isReadOnly,shouldFetchLabel:e.shouldFetchLabel}}getDesignEnvItem(e){let s=this,o=s.app.core;return this.models=this.app.isReadOnly?{}:o.pseCommonService.getModels(),this.app.isVDRPEnabled&&i.authoriseVDRPRoot(),new Promise((function(i){t.init({initURL:!0,initWSAccess:!0}).then((function(){t.retrieveAndSetSC().then((function(){1===e.length&&(n.mask(s.app.listView.getDEContainer(),s.getNLS().loadingDE),o.wsDataService.getDesignExperienceLabel(s.buildFetchParams(e[0])).then((r=>{e[0].displayName=s.app.isReadOnly||e[0].shouldFetchLabel&&r?r:e[0].displayName;let a=o.factory.createDesignEnvItem(e[0]);s.app.isReadOnly||(s.widget=s.models.options.context.options.widget),o.contextManager.setActiveDesignEnv(a),o.wsDataService.getFolderContent(a).then((function(e){e.data.items=d.map((e=>({objectId:a.getID(),label:e.label,displayName:e.displayName}))),s.buildSubFolders(e.data.items),Promise.allSettled(s.contentLoaderPromise).then((e=>{s.buildDesignExpContents(e).forEach((e=>{a.addChild(e),e.getKind()!=o.designEnvConstants.KIND_COW||s.app.isCowEnabled&&t.hasVDRPRoles()||e.hide()})),s.app.deFolderNodes=s.app.listView.getModels().getAllDescendants().filter((e=>s.getDeTypes().includes(e.options.kind))),o.contextManager.handleExpandCollapseEvents(),s.app.isReadOnly||(o.pseCommonService.removeItemsOnPreference(!1).then((()=>{setTimeout((()=>{if(!s.app.getIsReadOnlyInWeb()&&s.widget.getValue("autoload_items")){let e=a.getContents();e=e.filter((e=>"ENOStrRefinementVDRPSpec"!==e.options.objectType)),o.pseCommonService.addItems(e),e.length||(o.pseCommonService.isDesignExpLoading=!1),setTimeout((()=>{a.getContext().getChildren().length&&(o.pseCommonService.updateIsReadOnlyAndAssetType(a.getContext().getChildren().filter((e=>!s.app.core.contextManager.isFilter(e)))),o.pseCommonService.isGraphView()&&o.pseCommonService.updateDeTypeInGraphview(),!o.pseCommonService.isGraphView()&&o.pseCommonService.applyDefaultSort(),s.app.getIsReadOnlyInWeb()&&!o.pseCommonService.isGraphView()&&(o.pseCommonService.reorderDgvAssets(),o.pseCommonService.reorderDgvAssets()),o.contextManager.hasFiltersInDE()||(o.pseCommonService.isDesignExpLoading=!1))}),1e3)}else o.pseCommonService.isDesignExpLoading=!1}),300)})),o.pseCommonService.addOrRemoveEvents("add",!0),setTimeout((()=>{!o.pseCommonService.isGraphView()&&s.reapplySortModel()}),200)),n.unmask(s.app.listView.getDEContainer())})),a.expandAll(),s.app.isReadOnly||s.app.getGlobalModelEvent().publish({event:o.designEnvConstants.GLOBAL_EVENT_CLOSE_LANDING_PAGE}),i(a)}))})))})).catch((e=>console.error(e)))}))}))}buildDesignExpContents(e){return e.filter((e=>"fulfilled"==e.status)).map((e=>e.value))[0].sort(((e,t)=>e.options.sortInfo-t.options.sortInfo))}buildSubFolders(e){this.contentLoaderPromise=[],e&&this.contentLoaderPromise.push(this.buildFolder3dExcite(e))}buildFolder3dExcite(n){var o=this,r=n.map((e=>this.createFolder(e))),a=[],d=!1;return new Promise(((n,l)=>{if(r.length){if(self.widget&&self.widget.newDesignExpCreated)return self.widget.newDesignExpCreated=!1,n(r),!1;o.app.core.pseCommonService.isDesignExpLoading=!0,o.app.core.wsDataService.getFolderContent(r[0]).then((function(l){l.data.items||(l.data.items=[]);let c=l.data.items.reduce(((e,n)=>o.app.isVDRPEnabled||"ENOStrRefinementVDRPSpec"!==n.objectType?!t.hasVDRPRoles()&&i.getPoeAuthorisedRoots().includes(n.objectType)?(d=!0,e):(e["DEContextActor"==n.actorType?"DEContextActor":"V_DEtoCoW"==n.actorType?"V_DEtoCoW":"DEWIPActor"].push(n),e):e),{DEContextActor:[],DEWIPActor:[],V_DEtoCoW:[]});if(!o.app.isReadOnly&&o.app.probeMethods.triggerPadTrackerEvent("DGX-LoadDEContentInDGV",c.DEContextActor.length+c.DEWIPActor.length),d)return o.app.core.commandService.executeCommand("CloseDesignEnvHdr"),e.warningAlert(s.designenv.unauthorisedDesignExpAccess),!1;r.forEach((e=>{"ctx"==e.getKind()&&!c.DEContextActor.length||"wip"==e.getKind()&&!c.DEWIPActor.length||"cow"==e.getKind()&&!c.V_DEtoCoW.length?(a.push(e),e.getKind()===o.app.core.designEnvConstants.KIND_COW&&(o.app.isReadOnly||o.app.getIsReadOnlyInWeb())&&e.hide(),3==a.length&&n(a)):o.buildFolderContent("ctx"==e.getKind()?c.DEContextActor:e.getKind()==o.app.core.designEnvConstants.KIND_COW?c.V_DEtoCoW:c.DEWIPActor,e.getKind()).then((t=>{Array.isArray(t)&&t.length>0&&(e.addChild(t),e.expand()),a.push(e),3==a.length&&n(a)}))}))}))}}))}buildFolderContent(e,t,i){let n=this;return this.updatedDeContent=[],new Promise(((s,o)=>{i?n.app.core.wsDataService.getFolderContent(n.app.core.contextManager.getActiveDesignEnv().getChildren()[0]).then((o=>{n.updatedDeContent=o&&o.data&&o.data.items?o.data.items:[],s(n.processing(e,t,i))})):s(n.processing(e,t))}))}processing(e,t,i){if(i&&e.data&&this.updatedDeContent.length+e.data.items.length>100)return new Promise(((e,t)=>(t({maxLimitError:!0,message:"Maximum assets limit"}),!1)));let n=(e=this.areValidContents(e,t)).data?e.data.items:e;return t===this.app.core.designEnvConstants.KIND_CONTEXT?this.getContextItems(n):t===this.app.core.designEnvConstants.KIND_WIP?this.getWipItems(n):t==this.app.core.designEnvConstants.KIND_COW?this.getCowItems(n):void 0}createFolder(e,t){return[this.app.core.designEnvConstants.LABEL_CONTEXT,this.app.core.designEnvConstants.LABEL_WIP,this.app.core.designEnvConstants.LABEL_COW].includes(e.label)?this.app.core.factory.createSubFolder(e):null}getContextItems(e){let t=this;return new Promise(((n,s)=>{let o=e.filter(i.isAdvancedFilter.bind(t)).map((e=>e.objectId)),r=e.filter((e=>1==e.isFiltered)).map((e=>e.filterId));Array.isArray(o)&&o.length>0?t._getRootsForFilters(o).then((function(i){n(t.getItems(e))})):Array.isArray(r)&&r.length>0?t.buildFilteredItems(e,r).then((e=>{n(e)}),(e=>{s(e)})):n(t.getItems(e))}))}getCowItems(e){let t=this;return new Promise(((i,n)=>{i(e?t.getItems(e,!0):[])}))}getWipItems(e){let t=this;return new Promise(((i,n)=>{i(t.getItems(e))}))}authoringModeErrorNotification(){e.warningAlert(s.designenv.errorDeNotAllowedInAuthoring)}displayWarning(t){e.warningAlert(t)}getNLS(){return s.designenv}getDeTypes(){let e=this.app.core.designEnvConstants;return[e.KIND_DESIGNENV,e.KIND_COW,e.KIND_WIP,e.KIND_CONTEXT]}getItems(e,t){let i=this;return e.map((e=>i.app.core.factory.createContentItem(e,t)))}getItemsAsArray(e){return Array.isArray(e)?e:[e]}buildFilteredItems(t,i){let n=this;return new Promise(((o,a)=>{let d=t.reduce(((e,t)=>(e[t.filterId?"savedFilters":"unsavedFilters"].push(t),e)),{savedFilters:[],unsavedFilters:[]});if(d.unsavedFilters.length>1||d.savedFilters.length&&d.unsavedFilters.length)return e.warningAlert(s.designenv.errorFilterIsNotSaved),o(),!1;if(d.unsavedFilters.length){let i=t;const{objectId:a}=i[0];let d=n.app.core.pseCommonService.getFilterProxy()._biFilter._shareSpec,l=n.app.core.pseCommonService.getChildren().find((e=>e.options.resourceid===a));const c={description:"",rootID:a,componentsToFeedUI:d&&d[a]?d[a].filterMdl:{},pfServiceId:""},p=`${s.designenv.filter}-${r++}`;n.app.core.wsDataService.getDefaultFilterName(p).then((t=>{c.name=c.title=t?t.defaultName:`${p}-DesignExp`,n.app.core.wsDataService.saveUnsavedFilter(c).then((t=>{i[0].filterId=t.filterId,i[0].displayName=i[0].filterTitle=t&&t.filter?t.filter[0].filterTitle:i[0].displayName,i[0]=n.app.core.dataBuilder.getContentOption(i[0]),i[0].rootId=c.rootID,n.filtersRootsMap[t.filterId]=c.rootID,n.saveFilterData[t.filterId]||(n.saveFilterData[t.filterId]=t.filter[0]),l&&(l.options.filterId=t.filterId,l.options.filterTitle=i[0].filterTitle),e.successAlert(s.designenv.unsavedFilterSaveInfo),n.unsavedFilterReloadInfo=l,o(n.getItems(i))}))}))}else t=t.map((e=>e.isFiltered?n.app.core.dataBuilder.getContentOption(e):e)),n._getRootsForFilters(i).then((function(e){for(var i of t)"ENOStrRefinementSpecification"==i.objectType&&(i.displayName=e.filter((e=>e[i.objectId]))[0][i.objectId].filterTitle);o(n.getItems(t))}))}))}areValidContents(t,n){if(!(t.length||t.data&&t.data.items))return!1;t.data&&t.data.items&&(t=t.data.items);let o=[];for(let r of t)n==this.app.core.designEnvConstants.KIND_WIP&&(1==r.isFiltered||i.isAdvancedFilter(r)||i.isVDRPFilter(r))?e.warningAlert(s.designenv.warningFiltersNotAllowedToWIP):r.rootId&&this.checkExisting(r.rootId)||this.checkExisting(r.objectId)?e.warningAlert(r.isFiltered?s.designenv.FiltersFromSameRootMessage:s.replace(s.designenv.warningExisting,{label:r.displayName})):this.updatedDeContent&&r.isFiltered&&this.checkExisting(r.filterId)||r.path&&r.path.length>1&&this.options.app.core.contextManager.getActiveDesignEnv().getAllDescendants().find((e=>e.getID()==r.path[0].resourceid||e.getRootID()==r.path[0].resourceid))?e.warningAlert(s.replace(s.designenv.warningExisting,{label:r.displayName})):o.push(r);return o}addContent(t){let i=this,o="string"==typeof t.data?JSON.parse(t.data):t.data,r=this.app.core.contextManager.getActiveDesignEnv(),d="ctx"==t.kind,l=t.kind==this.app.core.designEnvConstants.KIND_COW;if(o.data.items.length>0){n.mask(i.app.listView.getDEContainer(),"Loading..."),this.isFromCommand?i.app.probeMethods.triggerPadTrackerEvent(d?"DGX-AddItemsCommand-Ctx":"DGX-AddItemsCommand-WIP",o.data.items.length):i.app.probeMethods.triggerPadTrackerEvent(d?"DGX-AddItemsDnD-Ctx":"DGX-AddItemsDnD-WIP",o.data.items.length);let c=d?r.getContext():l?r.getCow():r.getWip();this.buildFolderContent(o,t.kind,!0).then((t=>{Array.isArray(t)&&t.length>0?i.app.core.wsDataService.addFolderContent(c,t).then((e=>{e.results&&e.results.length&&t.forEach((t=>{t.options.actorId=e.results.find((e=>e.AssetID==t.getID())).ActorID})),c.addChild(t),c.expand(),i.unsavedFilterReloadInfo?(i.app.core.pseCommonService.removItems([i.unsavedFilterReloadInfo.options.resourceid]),delete i.unsavedFilterReloadInfo,setTimeout((()=>{i.addItemsToPseView(t,c.options.kind),n.unmask(i.app.listView.getDEContainer())}),400)):(t=t.filter((e=>"ENOStrRefinementVDRPSpec"!==e.options.objectType)),!l&&i.addItemsToPseView(t,c.options.kind),n.unmask(i.app.listView.getDEContainer()))})).catch((t=>{n.unmask(i.app.listView.getDEContainer()),t&&t.response&&(t.response.code==a.maxAssetAddition?e.errorAlert("","",s.designenv.maximumAdditionsError.title):t.message.contains('"400"')||t.message.contains('"500"')?e.errorAlert("",s.designenv.ContactAdmin,s.designenv.DataServiceFailed):t.message.contains('"404"')&&e.errorAlert("",s.designenv.QueryFailed,s.designenv.DataServiceFailed))})):n.unmask(i.app.listView.getDEContainer())})).catch((t=>{t&&t.maxLimitError?e.errorAlert("",s.designenv.maximumAssetsError.subTitle,s.designenv.maximumAssetsError.title):e.warningAlert(t.message),n.unmask(i.app.listView.getDEContainer())}))}}addItemsToPseView(e,t){let i=this,n=(e.map((e=>(e.select(),t&&(e.options.sortIdentifier="ctx"===t?3:2,i.updateSortModelInDGV(i.app.core.contextManager.isFilter(e)?e.options.associatedRoot:e.options.resourceid,"added",t)),this._getId(e)))),e.filter((e=>!this.app.core.pseCommonService.isItemAvailableInPSE(e))));this.models.withTransactionUpdate((()=>{i.app.core.pseCommonService.addItems(n),setTimeout((()=>{i.app.core.pseCommonService.updateIsReadOnlyAndAssetType(e,"add",t),i.app.core.contextManager.hasFiltersInDE()&&i.app.core.pseCommonService.triggerFilterReorderOnSort()}),300)}))}updateSortModelInDGV(e,t,i){let n,s=this;"remove"===t?Array.isArray(e)?e.forEach((e=>{n=s.models.getNodesById(e),n.length&&(n[0].options.sortIdentifier=1)})):(n=s.models.getNodesById(e),n.length&&(n[0].options.sortIdentifier=1)):"added"===t&&(n=s.models.getNodesById(e),n.length&&(n[0].options.sortIdentifier="ctx"===i?3:2))}reapplySortModel(){this.models.options.context.getPADDGVView().options.dgv.reapplySortModel()}getFilterAppliedProductIdFromFilter(e){return this.filtersRootsMap[e]?this.filtersRootsMap[e]:e}_getRootsForFilters(e){let t=this;return new Promise((function(i,n){e.length>0?t.app.core.wsDataService.getRootsForFilters({data:{filterids:e}}).then((function(e){if((e="string"==typeof e?JSON.parse(e):e).success){for(var s=0;s<e.success.length;s++)for(var o=e.success[s],r=Object.getOwnPropertyNames(o),a=0;a<r.length;a++)t.filtersRootsMap[r[a]]=o[r[a]].rootPhysicalId,t.filtersRootsMap[r[a]]||(t.filtersRootsMap[r[a]]=o[r[a]].rootExtPosPhysicalId),t.saveFilterData[r[a]]||(t.saveFilterData[r[a]]=o[r[a]]);i(e.success)}else n()})):i(t.filtersRootsMap)}))}buildDataForPE(e){let t=[];return e.Context&&(t=e.Context.map((e=>({Role:574,AssetID:e.elements[0].physicalid,ActorType:"DEContextActor",AssetType:e.elements[0]["ds6w:type"],AssetName:e.elements[0]["ds6w:label"]})))),e.WIP&&(t=t.concat(e.WIP.map((e=>({Role:575,ActorType:"DEWIPActor",AssetID:e.elements[0].physicalid,AssetType:e.elements[0]["ds6w:type"],AssetName:e.elements[0]["ds6w:label"]}))))),e.COW&&(t=t.concat(e.COW.map((e=>({Role:576,ActorType:"V_DEtoCoW",AssetID:e.elements[0].physicalid,AssetType:e.elements[0]["ds6w:type"],AssetName:e.elements[0]["ds6w:label"]}))))),t}checkExisting(e){let t=!!this.app.core.contextManager.getActiveDesignEnv().getAllDescendants().find((t=>this.app.core.contextManager.isFilter(t)&&t.options.associatedRoot==e||t.options.resourceid===e)),i=this.updatedDeContent;return!t&&i&&i.length?!!i.find((t=>t.objectId==e)):t}replaceOrUnsetCowAsset(e){let t=e||this.app.core.contextManager.getCowAsset()[0];this.app.listView.getModels().prepareUpdate(),this.app.core.contextManager.getActiveDesignEnv().getCow().removeChild(t),this.app.listView.getModels().removeRoot(t),this.app.listView.getModels().pushUpdate(),this.app.core.wsDataService.removeFolderContents({folderId:this.app.core.contextManager.getActiveDesignEnv().getCow().getID(),ids:t.options.actorId})}resetView(){let e=this;e.deModel=e.app.listView.getModels(),e.removedAssetsCnt=0,n.mask(e.app.listView.getDEContainer(),e.getNLS().refreshingDE),e.app.core.wsDataService.getFolderContent(e.app.core.contextManager.getActiveDesignEnv().getChildren()[0]).then((t=>{let i=e.app.core.pseCommonService.getChildren(),n=e.app.core.contextManager.getActiveDesignEnv().getContents(),s=t&&t.data&&t.data.items?t.data.items:[],o=s.map((e=>e.objectId));e.removeItemsNotInDesignExp(o,n,i),setTimeout((()=>{e.addMissingAssetsToBothViews(s,n),e.deModel.unselectAll()}),300)}))}getMissingItems(){let e=this,t=this.app.core,i=t.contextManager.getSelectedContext();if(e.app.isDndFromLeftPanel)return t.contextManager.getActiveDesignEnv().getContents().filter((e=>!t.pseCommonService.isItemAvailableInPSE(e)));if(!i.getContents())return t.contextManager.getSelectedItems().filter((e=>!t.pseCommonService.isItemAvailableInPSE(e)));let n=t.pseCommonService.getChildren().map((e=>e.getID()));return i.getContents().filter((t=>-1==n.indexOf(e._getId(t))))}removeItemsNotInDesignExp(e,t,i){let n=t.filter((t=>!e.includes(t.getID()))),s=i.filter((t=>t.options.deType&&!e.includes(t.options.resourceid)&&!(t.options.filtered&&e.includes(t.options.filterId)))).map((e=>e.options.resourceid));this.app.core.pseCommonService.removItems(s),this.removedAssetsCnt=s.length,this.deModel.prepareUpdate(),n.forEach((e=>e.getParent().removeChild(e)&&this.deModel.removeRoot(e))),this.deModel.pushUpdate(),this.app.getIsReadOnlyInWeb()&&setTimeout((()=>{this.app.core.pseCommonService.reorderDgvAssets(),this.app.core.pseCommonService.reorderDgvAssets()}),200)}addMissingAssetsToBothViews(e){var t=this;let i=[],s=t.app.core.contextManager.getActiveDesignEnv().getContents(),o=e.filter((e=>!s.find((t=>t.getID()==e.objectId)))),r=o.reduce(((e,t)=>(e["DEContextActor"==t.actorType?"DEContextActor":"DEWIPActor"].push(t),e)),{DEContextActor:[],DEWIPActor:[]}),a={added:o.length,removed:t.removedAssetsCnt};if(this.app.probeMethods.triggerPadTrackerEvent("DGX-RefreshDEContent",a,!0,"design_exp_refresh"),!r.DEContextActor.length&&!r.DEWIPActor.length)return n.unmask(t.app.listView.getDEContainer()),!1;i.push(this.getContextItems(r.DEContextActor)),i.push(this.getWipItems(r.DEWIPActor)),Promise.allSettled(i).then((e=>{let i=[];"fulfilled"==e[0].status&&(t.app.core.contextManager.getActiveDesignEnv().getContext().addChild(e[0].value),i=e[0].value),"fulfilled"==e[1].status&&(t.app.core.contextManager.getActiveDesignEnv().getWip().addChild(e[1].value),i=i.concat(e[1].value)),n.unmask(t.app.listView.getDEContainer())}))}isItemInPseView(){let e=this.app.core.contextManager.getSelectedContext();return this.app.core.pseCommonService.getChildren().map((e=>e.getID())).indexOf(this._getId(e))>=0}getFilterAppliedProductId(e){return this._getId(e)}_getId(e){return e.getType()==this.app.core.designEnvConstants.TYPE_ADVANCED_FILTER?this.getFilterAppliedProductIdFromFilter(e.getID()):e.getID()}}})),define("DS/DesignEnvironmentUX/commands/DesignEnvAddItemToContextCmd",["DS/ApplicationFrame/Command","DS/DesignEnvironmentUX/utils/DesignEnvUtils","DS/DesignEnvironmentUX/utils/Utils","i18n!DS/DesignEnvironmentUX/assets/nls/DesignEnvironmentUX"],((e,t,i,n)=>class extends e{constructor(e){super(e,"DesignEnvAddItemToContextCmd"),this.app=e.app}execute(){let e=this;var s="cow"==this.app.core.contextManager.getSelectedContext().getKind();if(s&&this.app.core.contextManager.hasCowContent()&&this.app.core.contextManager.getActiveDesignEnv().getContents().length)return e.app.core.dataProvider.displayWarning(e.app.core.dataProvider.getNLS().unableToSetCow),!1;this.app.core.searchService.launchSearch({precondition:s?'flattenedtaxonomies:"types/AxisSystemReference"':'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification"'+(this.app.isVDRPEnabled?"OR flattenedtaxonomies:types/ENOStrRefinementVDRPSpec":""),fts_value:void 0,showApplyButton:!1,ok:function(o){var r=[];if(e.selectedItems=o,s){if(e.selectedItems.length>1)return e.app.core.dataProvider.displayWarning(e.app.core.dataProvider.getNLS().multipleCowItemsError),!1;e.app.core.contextManager.hasCowContent()&&e.app.core.dataProvider.replaceOrUnsetCowAsset()}e.selectedItems=e.selectedItems.filter((o=>{if(s||"AxisSystemReference"!==o["ds6w:type_value"]){if(t.hasVDRPRoles()||"VPMReferenceExtPos"!==o["ds6w:type_value"])return i.getAuthorisedRoots().includes(o["ds6w:type_value"])||r.push(o["ds6w:type_value"]),o;e.app.core.dataProvider.displayWarning(n.designenv.unauthorisedDrop)}else e.app.core.dataProvider.displayWarning(n.replace(n.designenv.unsupported_drop,{type:o["ds6w:type_value"]}))})),e.app.listView._areTypesAuthorised(r).then((t=>{t.length&&(e.selectedItems=e.selectedItems.filter((e=>!t.includes(e["ds6w:type_value"]))));let i=e.selectedItems.filter((e=>"ENOStrRefinementSpecification"==e["ds6w:type_value"])).map((e=>e.id));i.length?e.app.core.dataProvider._getRootsForFilters(i).then((t=>{let i=e.app.core.searchService.searchDataToDropData(e.selectedItems);const s=new Set;i.data.items=i.data.items.filter((i=>{if("ENOStrRefinementSpecification"==i.objectType){if(i.rootId=t.find((e=>e[i.objectId]))[i.objectId].rootPhysicalId,i.isFiltered=!0,s.has(i.rootId))return e.app.core.dataProvider.displayWarning(n.replace(n.designenv.FiltersFromSameRootMessage,{label:i.filterTitle})),!1;s.add(i.rootId)}return!0})),e.addItems(i)})):e.addItems(e.app.core.searchService.searchDataToDropData(e.selectedItems))}))}})}addItems(e){this.app.core.dsEnvEventManager.publish(this.app.core.designEnvConstants.EVENTS_ADD_ITEM,{data:e,kind:this.app.core.contextManager.getSelectedContext().getKind()})}})),define("DS/DesignEnvironmentUX/views/DesignExpDialogs/js/DesignExpUXDialog",["DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/UIKIT/Input/Toggle","DS/Controls/Button","DS/DesignEnvironmentUX/utils/DesignEnvConstants","i18n!DS/DesignEnvironmentUX/assets/nls/DesignEnvironmentUX"],((e,t,i,n,s,o)=>{let r;class a{constructor(e){this.core=e&&e.core?e.core:{}}static getInstance(e){return r||(r=new a(e)),r}buildRemoveItemsConfirmationDialog(e){e.content=UWA.Element("div",{class:"remove-dialog-content",html:e.message}),e.showDonNotShowAttr&&(this.doNotShowAttrRef=new i({type:s.TYPE_CHECKBOX,label:o.designenv.doNotShowDialogAgainTitle,checked:!1}),this.doNotShowAttrRef.inject(e.content)),this.getDialog(e)}buildFilterCriteriaConfirmationDialog(e){e.content=UWA.Element("div",{class:"restore-dialog-content",html:[UWA.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-attention color-red"}),e.message]}),this.getDialog(e)}getDialog(i){let n=new e;return n.inject(widget.body),new t({immersiveFrame:n,title:i.title,content:i.content,width:i.width?i.width:400,resizableFlag:!i.resizableFlag||i.resizableFlag,modalFlag:!i.modalFlag||i.modalFlag,buttons:i.buttons})}getButtons(e){let t=this;return{Close:new n({onClick:function(i){e.onCloseDialogCallback(i,t.doNotShowAttrRef?t.doNotShowAttrRef.isChecked():"")}}),Ok:new n({onClick:function(i){e.onOkCallback(),e.onCloseDialogCallback(i,t.doNotShowAttrRef?t.doNotShowAttrRef.isChecked():"")}})}}}return a})),define("DS/DesignEnvironmentUX/services/PseCommonService",["DS/DesignEnvironmentUX/utils/DesignEnvUtils","DS/DesignEnvironmentUX/services/HelperService","DS/DesignEnvironmentUX/views/DesignExpDialogs/js/DesignExpUXDialog"],((e,t,i)=>class{constructor(e){this.app=e.app?e.app:e,this.options=e}getModels(){return!this.app.getDgvModel()&&this.app.getGlobalModelEvent()&&this.app.getGlobalModelEvent().publish({event:"DesignEnv/updateDgvModel",data:this.updateDgvModel.bind(this)}),this.app.getDgvModel()?this.app.getDgvModel():{}}getPseContext(){return this.getModels()&&this.getModels().options?this.getModels().options.context:{}}updateDgvModel(e){this.app.setDgvModel(e)}getChildren(){return this.getModels().getChildren?this.getModels().getChildren():[]}addOrRemoveEvents(e,t){if(this.padDGV=this.getPseContext().getPADDGVView(),this.isGraphView())return!1;if(this.filtersToLoad=[],this.clearDeDataInPSE(),this.deSortModel={isSorted:!1,sort:""},this.padDGV.options.dgv.sortModel||(this.sortModel=this.padDGV.options.dgv.sortModel=[]),"add"===e){this.padDGV.changeVisibilityCB("asset-type",!0),this.handler=async e=>{var t;e.ctrlKey||(await(t=100,new Promise((e=>setTimeout(e,t)))),e.dsModel&&this.deSortModel.isSorted&&e.dsModel.sortModel&&e.dsModel.sortModel.length&&"asset-type"!=e.dsModel.sortModel[0].dataIndex?(this.applyDefaultSort(e.dsModel.sortModel,this.deSortModel.sort),this.padDGV.options.dgvLayout.saveColumnSortModelInPreferences()):e.dsModel._preselectedCellStableID&&"asset-type"!=e.dsModel._preselectedCellStableID.columnDataIndex&&this.deSortModel.isSorted&&!e.dsModel.sortModel.length?(this.applyDefaultSort(e.dsModel.sortModel,this.deSortModel.sort),this.app.core.contextManager.hasFiltersInDE()&&this.triggerFilterReorderOnSort()):e.dsModel.sortModel&&!e.dsModel.sortModel.length&&e.dsModel._preselectedCellStableID&&"asset-type"==e.dsModel._preselectedCellStableID.columnDataIndex?this.applyDefaultSort(e.dsModel.sortModel,"asc"):!e.dsModel.sortModel&&e.dsModel._preselectedCellStableID&&"asset-type"==e.dsModel._preselectedCellStableID.columnDataIndex&&(this.deSortModel.isSorted=!1))},this.applyDefaultSort(this.padDGV.options.dgv.sortModel),this.addOrRemoveCompareFunction(this.padDGV,"add"),this.getPseContext().getPADTreeDocument().refresh({datagrid:this.padDGV,dispatch:!1}),t&&this.addOrRemoveEventListener("remove"),this.addOrRemoveEventListener("add"),this.padDGV._saveSortsHandler&&this.padDGV._saveSortsHandler.options.actual.addEventListener("sortModelChange",this.onSortModelChange.bind(this))}else"remove"===e&&(this.padDGV.options.dgv.sortModel&&this.padDGV.options.dgv.sortModel.length&&this.padDGV.options.dgv.sortModel.splice(this.padDGV.options.dgv.sortModel.findIndex((e=>"asset-type"==e.dataIndex)),1),this.deSortModel.isSorted=!1,this.addOrRemoveCompareFunction(this.padDGV,"remove"),this.addOrRemoveEventListener("remove"),this.padDGV.changeVisibilityCB("asset-type",!1),this.clearDeDataInPSE())}onSortModelChange(e){var t=e.dsModel&&e.dsModel._preselectedCellStableID&&"asset-type"==e.dsModel._preselectedCellStableID.columnDataIndex;let i=e;setTimeout((()=>{if(this.app.getIsReadOnlyInWeb()&&t){let e="asc"==i.dsModel.sortModel.find((e=>"asset-type"===e.dataIndex)).sort;this.reorderDgvAssets(e)}this.app.core.contextManager.hasFiltersInDE()&&t&&setTimeout((()=>{this.triggerFilterReorderOnSort()}),100)}),200)}triggerFilterReorderOnSort(){let e=this.padDGV.options.dgv.sortModel?this.padDGV.options.dgv.sortModel.find((e=>"asset-type"==e.dataIndex)).sort:"";this.getAllPseFilters().forEach((t=>{this.isLastFilterLoaded(t,"asc"==e)}))}applyDefaultSort(e,t){this.padDGV.options.dgv.sortModel||(this.padDGV.options.dgv.sortModel=[]),e||(e=this.padDGV.options.dgv.sortModel),e?.find((e=>"asset-type"==e.dataIndex))&&0==e?.findIndex((e=>"asset-type"==e.dataIndex))||(e||(e=[]),e.unshift({dataIndex:"asset-type",sort:t||"desc"}),this.padDGV.options.dgv.reapplySortModel())}addOrRemoveEventListener(e){let t=this.padDGV.options.dgv.elements.header;"add"==e&&t?t.addEventListener("click",this.handler,!1):"remove"==e&&t&&t.removeEventListener("click",this.handler,!1)}addOrRemoveCompareFunction(e,t){e.options.dgvLayout._leafColumns.forEach((i=>{"asset-type"!=i.dataIndex&&("add"==t?i.compareFunction=this.commonCompareFunction.bind(e):"remove"==t&&delete i.compareFunction)}))}commonCompareFunction(){let e=this.options.context.getPseService();return e.deSortModel.isSorted?arguments[2].options.deType==arguments[3].options.deType&&arguments[0]&&arguments[1]?e.handleCompare(arguments):0:arguments[0]&&arguments[1]?e.handleCompare(arguments):void 0}handleCompare(e){return"string"==typeof e[0]||"string"==typeof e[1]?e[0].localeCompare(e[1]):!e[0]&&!e[1]||UWA.equals(e[0],e[1])?0:e[0]>e[1]?1:e[0]<e[1]||!e[0]&&e[1]?-1:1}clearDeDataInPSE(){this.getChildren().forEach((e=>{delete e.options.deType,delete e.options.isReadOnly}))}getAssetTypeCellValue(e){var i=e.nodeModel.options;if(i.sortIdentifier=1,e&&e.nodeModel&&1!=e.nodeModel.getNodeSource()){if(!e.nodeModel.isRoot()&&i.deType)return delete i.deType,"";["WIP","WIPModified"].includes(i.deType)||null==i.deType&&this.isWip(e.nodeModel.getID())&&e.nodeModel.isRoot()&&!i.filterId?(i.deType="WIP",i.sortIdentifier=2,i.isFilterModified&&(i.deType="WIPModified")):(["Context","ContextModified"].includes(i.deType)||null==i.deType&&this.isContext(i.filterId||e.nodeModel.getID())&&e.nodeModel.isRoot())&&(i.deType="Context",i.isReadOnly=null==i.isReadOnly||i.isReadOnly,i.isFilterModified&&(i.deType="ContextModified"),i.filterId&&null==e.nodeModel.options.isFilterModified&&(i.isFilterModified=!1),i.sortIdentifier=3)}return i.deType?t.getIconPath(i.deType):""}confirmCellAction(e){e.nodeModel.options.isFilterModified&&this.confirmToRestoreFilterCriteria(this.actionOnClick.bind(this,e))}actionOnClick(e){let t=this;var i=e.nodeModel;i.getNextBrother();i.options.isFilterModified&&(i.options.isFilterModified=!1,i.options.filterId?t.getModels().withTransactionUpdate((()=>{t.getFilterProxy().resetNGFilterUI({appId:t.app.core.contextManager.getAppId(),widgetId:t.app.core.contextManager.getWidgetId(),rootIds:[i.options.resourceid]}),t.isFromActionClick=!0;let e=t.getPseContext().xNavPersistFilterSpec.filterSpecDE.get(i.options.resourceid),n=t.app.core.dataProvider.saveFilterData[i.options.filterId];e&&n&&e.filter.filterSpecifications[0].filterCriteria.forEach(((t,i)=>{let s=n.filterUIComponents[1].toFeedUI.findIndex((e=>e.criteriaType==t.criteriaType));-1!=s?e.filter.filterSpecifications[0].filterCriteria[i].addedNodesList=n.filterUIComponents[1].toFeedUI[s].addedNodesList:e.filter.filterSpecifications[0].filterCriteria.splice(i,1)})),t.getFilterProxy().setPublicFilterSpecification({rootId:i.options.resourceid,specification:e,eventName:"setFilterSpec-"+i.options.filterId,applyFilter:1,displayFilter:0})})):!i.options.filterId&&i.options.filtered&&(i.options.deType="ContextModified"==i.options.deType?"Context":"WIP",t.getFilterProxy().resetNGFilterUI({appId:t.app.core.contextManager.getAppId(),widgetId:t.app.core.contextManager.getWidgetId(),rootIds:[i.options.resourceid]}),this.getPseContext().removeNGFilter([i.options.resourceid]),this.getFilterProxy().removeRoots([i.options.resourceid]),this.getModels()._cmdProxy.designExpFilterRestore&&this.getModels()._cmdProxy.designExpFilterRestore([i.options.resourceid]),delete i.options.filtered,i.select(),setTimeout((()=>{i.expand()}),1500)))}confirmToRestoreFilterCriteria(e){let t=this,n=t.app.core.dataProvider.getNLS();this.designExpUXDialog=i.getInstance(this.app);let s=this.designExpUXDialog.getButtons({onOkCallback:e,onCloseDialogCallback:t.onCloseDialog.bind(t)});this.designExpUXDialog.buildFilterCriteriaConfirmationDialog({title:n.restoreConfimrationRequestTitle,message:n.restoreConfimrationRequestMessage,buttons:s})}onCloseDialog(e){e.dsModel.dialog.close()}isGraphView(){return"graphview"==this.getPseContext().options.active_view}getCellTooltip(e){let t=this.app.core.dataProvider.getNLS();return{shortHelp:e.nodeModel&&["ContextModified","Context"].includes(e.nodeModel.options.deType)?e.nodeModel.options.isFilterModified?t.ModifiedFilterTooltip:t.RetainedFilterTooltip:e.nodeModel&&["WIP","WIPModified"].includes(e.nodeModel.options.deType)?e.nodeModel.options.isFilterModified?t.ModifiedFilterWIPTooltip:t.WIPTooltip:"",updateModel:!0}}isContext(e){let t=this;return!!this.app.core.contextManager.getActiveDesignEnv().getContext()&&this.app.core.contextManager.getContextAssets().find((i=>i.options.associatedRoot==e&&t.app.core.contextManager.isDeFilterAvailableInDGV(i)||i.getID()==e))}isWip(e){return!!this.app.core.contextManager.getActiveDesignEnv().getWip()&&this.app.core.contextManager.getWipAssets().find((t=>e==t.getID()))}isLastFilterLoaded(e,t){this.filtersMap=this.app.core.contextManager.getContextAssets().filter((e=>this.app.core.contextManager.isFilter(e))),this.isCustomFilterLoad&&(this.filtersMap=this.filtersToLoad),this.filtersMap.length&&this.filtersMap[this.filtersMap.length-1].getID()==e.options.filterId&&(setTimeout((()=>{this.getAllPseFilters().forEach((e=>{e.options.isReadOnly&&!this.getModels().readOnyRootData.readOnlyRootIds.includes(e.options.resourceid)&&this.getModels().readOnyRootData.readOnlyRootIds.push(e.options.resourceid),!this.app.isReadOnly&&this.reorderFilterInPSE(e,t)})),this.isDesignExpLoading=!1,this.getModels().readOnyRootData.hasReadOnlyRoot=!0,this.getModels()._cmdProxy.getReadOnlyRoots&&this.getModels()._cmdProxy.getReadOnlyRoots(this.getModels().readOnyRootData),this.isFromWidgetLink=!this.isFromWidgetLink&&this.isFromWidgetLink}),1e3),this.isCustomFilterLoad=!this.isCustomFilterLoad&&this.isCustomFilterLoad)}getFilterProxy(){return this.getPseContext()?this.getPseContext()._biFilter:{}}reorderFilterInPSE(e,t){let i=this.app.core.contextManager.getContextAssets().findIndex((t=>t.getID()==e.options.filterId));t&&(i+=this.getNonDeAssets().length+this.app.core.contextManager.getWipAssets().length,this.app.getIsReadOnlyInWeb()&&(i+=1));let n=-1!=i?this.getChildren()[i]:"";this.getModels().withTransactionUpdate((()=>{n&&n.options.filterId!=e.options.filterId&&this.getModels().insertBefore(e,n)}))}reorderDgvAssets(e){let t,i,n=this.getChildren(),s=this.app.core.contextManager.getActiveDesignEnv().getContents();n.forEach((o=>{t=s.findIndex((e=>e.getID()==o.options.resourceid)),this.app.getIsReadOnlyInWeb()&&e&&(t+=this.getNonDeAssets().length+this.app.core.contextManager.getWipAssets().length),i=-1!=t?n[t]:"",this.getModels().withTransactionUpdate((()=>{i&&i.options.resourceid!=o.options.resourceid&&this.getModels().insertBefore(o,i)}))}))}removItems(e){Array.isArray(e)&&e.length>0&&this.app.getGlobalModelEvent().publish({event:this.app.core.designEnvConstants.EVENT_ROOT_REMOVE,data:{pids:e}})}isItemAvailableInPSE(e){return this.getChildren().find((t=>this.isPSEFilter(t)?t.options.filterId==e.options.resourceid:e.options.resourceid==t.options.resourceid))}handleFilterModifications(e,t,i){let n,s=this,o=this.app.core.contextManager.getContextAssets(),r=o.filter((e=>s.app.core.contextManager.isFilter(e)));if(s.isFromActionClick)return s.isFromActionClick=!1,!1;if(s.isFromWidgetLink)return!1;if(null!=e.empty&&r.forEach((t=>{n=this.getModels().getNodesById(t.options.associatedRoot),(t.getID()==e.filterId||i&&t.getID()==i.options.filterId)&&(t.options.isFilterModified=!0,n.length&&(n[0].options.isFilterModified=!0,n[0].updateOptions(n[0].options)))})),i&&i.options.filtered&&!i.options.filterId)o.forEach((e=>{n=this.getModels().getNodesById(e.options.resourceid),e.options.resourceid==i.options.resourceid&&(e.options.isFilterModified=!0,n.length&&(n[0].options.isFilterModified=!0,n[0].updateOptions(n[0].options)))})),s.isWip(i.options.resourceid)&&(i.options.isFilterModified=!0,i.updateOptions(i.options));else if("removed"==t&&!i&&e.filterRootIds&&e.filterRootIds.length){let t=this.getModels().getNodesById(e.filterRootIds[0])[0];!t.options.filterId&&t.options.isFilterModified&&(t.options.isFilterModified=!1)}}handleAuthoringModeChange(e){e&&this.getChildren().forEach((e=>{e.options.isFilterModified&&(e.options.isFilterModified=!1,e.updateOptions(e.options))}))}updateIsReadOnlyAndAssetType(e,t,i){let n=this,s=[];this.getChildren().forEach((o=>{e.find((e=>n.app.core.contextManager.isFilter(e)?o.options.resourceid==e.options.associatedRoot:e.options.resourceid==o.options.resourceid))&&(i&&(o.options.deType="add"==t?"wip"==i?"WIP":"Context":"",o.updateOptions(o.options)),o.options.isReadOnly="remove"!=t&&!!["ContextModified","Context"].includes(o.options.deType)),o.options.isReadOnly&&s.push(o.options.resourceid)})),this.getModels().readOnyRootData={hasReadOnlyRoot:!!s.length,readOnlyRootIds:s},this.getModels()._cmdProxy.getReadOnlyRoots&&this.app.getDgvModel()._cmdProxy.getReadOnlyRoots(this.getModels().readOnyRootData),!this.isGraphView()&&this.app.core.dataProvider.reapplySortModel()}updateDeTypeInGraphview(){let e=this;this.getChildren().forEach((t=>{e.app.core.contextManager.getContextAssets().find((i=>e.app.core.contextManager.isFilter(i)?t.options.resourceid==i.options.associatedRoot:i.options.resourceid==t.options.resourceid))?t.options.deType="Context":e.app.core.contextManager.getWipAssets().find((e=>e.options.resourceid==t.options.resourceid))&&(t.options.deType="WIP")}))}removeItemsOnPreference(e){return new Promise((t=>{let i=e?this.getChildren().filter((e=>["ContextModified","Context","WIP","WIPModified"].includes(e.options.deType))):this.getChildren();i.length&&this.getPseContext().getPADTreeDocument().removeRootsQuiet(i),t()}))}removeTile(e){this.app.getGlobalModelEvent().publish({event:this.app.core.designEnvConstants.EVENT_ROOT_REMOVE_TILE,data:{tile_id:e}})}getNonDeAssets(){return this.getChildren().filter((e=>!e.options.deType))}updateModifiedAssetTitle(e,t){let i=this.app.core.contextManager.getActiveDesignEnv().getAllDescendants().find((e=>e.options.resourceid==t));i&&(i.options.label=e,i.updateOptions())}updateFilterAssetTitle(e){e&&this.app.core.dataProvider._getRootsForFilters([e.getID()]).then((function(t){e.options.label=t?.length?t[0][e.getID()].filterTitle:e.options.label,e.updateOptions()}))}updateDesignExpTitle(e){var t=this.app.core.contextManager.getActiveDesignEnv();this.app.core.wsDataService.deFetchDB(e).then((e=>{t.options.label=e,t.updateOptions()}))}checkBeforeAddingToRecent(e){this.pathsToRestore=[],e.addedPaths.length&&(this.pathsToRestore=e.addedPaths.slice(),UWA.clone(e.addedPaths).forEach((t=>{(this.isContext(t[0])||this.isWip(t[0]))&&e.addedPaths.splice(e.addedPaths.findIndex((e=>e[0]==t[0])),1)})))}shouldAddFilterToRecent(e){return!this.isContext(e)}addItems(e){if(Array.isArray(e)&&e.length>0){if(!this.app.getIsReadOnlyInWeb()&&this.getModels()._getAuthoringFlag()&&e.find((e=>this.app.core.contextManager.isFilter(e))))return this.app.core.dataProvider.authoringModeErrorNotification(),!1;this.app.getGlobalModelEvent().publish({event:this.app.core.designEnvConstants.EVENT_ROOT_ADDTITLE,data:{unserializedData:this.getUnserializedData(e),behavior:"WITHOUT_CONTEXT",broadcast:!0,mode:void 0,isDesignExpCall:!0}})}}isPSEFilter(e){return!(!e.options||!e.options.filtered)}getAllPseFilters(){return this.getChildren().filter((e=>this.isPSEFilter(e)))}updateRootsAfterSync(e){var t=this;setTimeout((()=>{e.forEach((function(e){if(t.getFilterProxy()._biFilter.hasFilter(e.rootId).hasFilter){var i=t.getModels().searchRootById(e.rootId);i&&e.filterId&&(i.options.deType=t.isContext(e.filterId)?"Context":"",i.options.filtered=!0,i.options.filterId=e.filterId,i.options.isReadOnly="Context"==i.options.deType,i.updateOptions(i.options))}})),t.triggerFilterReorderOnSort()}),500)}selectNodes(t){e.publish({event:this.app.core.designEnvConstants.EVENT_ROOT_SELECT,data:{tile_ids:t}})}filterAlreadyLoadedItemsInPSEView(e){let t=this.getChildren().map((e=>e.getID()));return e.filter((e=>!t.includes(e)))}collapseAll(){let e=this;require(["DS/ENXNav/commands/view/_xNavCollapseAll"],(function(t){t.execute({model:e.getModels()})}))}getUnserializedData(t){let i=this.app.core.contextManager.getActiveDesignEnv();return{data:{items:t.map(function(t){return{objectId:t.getID(),label:t.getLabel(),designEnvId:i.getID(),objectType:t.getType(),displayName:t.getLabel(),displayType:t.getDisplayType(),envId:e.getPlatformId(),serviceId:this.app.core.contextManager.getServiceId(),contextId:e.getSecurityContext()}}.bind(this))}}}})),define("DS/DesignEnvironmentUX/commands/UnsetCowCmd",["DS/ApplicationFrame/Command","DS/DesignEnvironmentUX/views/DesignExpDialogs/js/DesignExpUXDialog"],((e,t)=>class extends e{constructor(e){super(e,"UnsetCowCmd"),this.app=e.app}execute(){if(this.app.core.contextManager.getActiveDesignEnv().getContents().length)return this.app.core.dataProvider.displayWarning(this.app.core.dataProvider.getNLS().unableToUnsetCow),!1;this.confirmToRemoveItems(this.remove.bind(this,this.app.core.contextManager.getSelectedContext()))}remove(e){this.app.core.dataProvider.replaceOrUnsetCowAsset(e)}confirmToRemoveItems(e){if(1==this.isdontShowRemoveItemsDialog)return void e();this.designExpUXDialog=t.getInstance(this.app);let i=this.designExpUXDialog.getButtons({onOkCallback:e,onCloseDialogCallback:this.onCloseDialog.bind(this)});this.designExpUXDialog.buildRemoveItemsConfirmationDialog({title:this.app.core.dataProvider.getNLS().UnsetItemDialogTitle,message:this.app.core.dataProvider.getNLS().UnsetItemsDialogMessage,buttons:i,showDonNotShowAttr:!0})}onCloseDialog(e,t){e.dsModel.dialog.close(),this.isdontShowRemoveItemsDialog=t}})),define("DS/DesignEnvironmentUX/commands/RemoveItemsGenericCmd",["DS/ApplicationFrame/Command","DS/UIKIT/Mask","DS/DesignEnvironmentUX/views/DesignExpDialogs/js/DesignExpUXDialog","DS/DesignEnvironmentUX/services/DesignEnvAlertManager","i18n!DS/DesignEnvironmentUX/assets/nls/DesignEnvironmentUX"],((e,t,i,n,s)=>class extends e{constructor(e){super(e,"Design_Env_remove_items_command"),this.app=e.app?e.app:e}remove(e){var i=this,o="ctx"==e.getParent().getKind();i.app.probeMethods.triggerPadTrackerEvent(o?"DGX-RemoveItems-Ctx":"DGX-RemoveItems-WIP",1),i.app.core.wsDataService.getFolderContent(e.getParent()).then((r=>{let a=r&&r.data&&r.data.items?r.data.items:[];a.length&&a.find((t=>t.objectId==e.getID()))?this.app.core.wsDataService.removeFolderContents({folderId:e.getParent().getID(),ids:e.options.actorId}).then((t=>{let s=t&&t.status?t.status:""==t?"success":"";i.app.core.designEnvConstants.STATUS_SUCCESS==s?(e.remove(!0),i.app.core.pseCommonService.updateIsReadOnlyAndAssetType([e],"remove",o?"ctx":"wip"),i.app.core.pseCommonService.removItems(["ENOStrRefinementSpecification"==e.getType()?e.options.associatedRoot:e.getID()]),this.updateEditionMode(),i.app.core.contextManager.hasFiltersInDE()&&i.app.core.pseCommonService.triggerFilterReorderOnSort(),n.successAlert(`${e.getLabel()} is removed succesfully`)):n.errorAlert(`${e.getLabel()} is failed to remove`)})).catch((e=>{t.unmask(i.app.listView.getDEContainer()),e.message.contains('"400"')||e.message.contains('"500"')?n.errorAlert("",s.designenv.ContactAdmin,s.designenv.DataServiceFailed):e.message.contains('"404"')&&n.errorAlert("",s.designenv.QueryFailed,s.designenv.DataServiceFailed)})):n.warningAlert(s.replace(s.designenv.warningDoesntExist,{label:e.options.label}))}))}updateEditionMode(){this.app.core.contextManager.getActiveDesignEnv().getContext().getAllDescendants().length||this.app.getGlobalModelEvent().publish({event:"ENXModel/ReadWriteTriggered",data:!1})}removeItems(e){let i=this;this.removeItemsPromises=[],t.mask(this.app.listView.getDEContainer(),s.designenv.removingMaskTitle);var o=!0,r=!0;let a=e.filter((e=>e.getParent().getKind()==this.app.core.designEnvConstants.KIND_CONTEXT)),d=e.filter((e=>e.getParent().getKind()==this.app.core.designEnvConstants.KIND_WIP));i.app.core.wsDataService.getFolderContent(this.app.deFolderNodes[1]).then((e=>{let l=(e&&e.data&&e.data.items?e.data.items:[]).reduce(((e,t)=>(e["DEContextActor"==t.actorType?"DEContextActor":"DEWIPActor"].push(t),e)),{DEContextActor:[],DEWIPActor:[]});a.length&&(a=a.filter((e=>!!l.DEContextActor.find((t=>t.objectId==e.getID()))||(n.warningAlert(s.replace(s.designenv.warningDoesntExist,{label:e.options.label})),!1)))),d.length&&(d=d.filter((e=>!!l.DEWIPActor.find((t=>t.objectId==e.getID()))||(n.warningAlert(s.replace(s.designenv.warningDoesntExist,{label:e.options.label})),!1))));let c=[];this.addRemovalItemesToPromise(a),this.addRemovalItemesToPromise(d),Promise.allSettled(this.removeItemsPromises).then((e=>{e.forEach(((e,t)=>{if("rejected"==e.status){0==t?o=!1:r=!1;let i=e.reason;i.message.contains('"400"')||i.message.contains('"500"')?n.errorAlert("",s.designenv.ContactAdmin,s.designenv.DataServiceFailed):i.message.contains('"404"')&&n.errorAlert("",s.designenv.QueryFailed,s.designenv.DataServiceFailed)}})),o&&(i.removeItemsFromView(a),c=a.map((e=>e.getType()==this.app.core.designEnvConstants.TYPE_ADVANCED_FILTER?e.options.associatedRoot:e.options.resourceid)),i.app.core.pseCommonService.updateIsReadOnlyAndAssetType(a,"remove","ctx"),i.app.probeMethods.triggerPadTrackerEvent("DGX-RemoveItems-Ctx",a.length)),r&&(i.removeItemsFromView(d),c=c.concat(d.map((e=>e.options.resourceid))),i.app.core.pseCommonService.updateIsReadOnlyAndAssetType(d,"remove","wip"),i.app.probeMethods.triggerPadTrackerEvent("DGX-RemoveItems-WIP",d.length)),i.app.core.pseCommonService.removItems(c),i.updateEditionMode(),i.app.core.contextManager.hasFiltersInDE()&&i.app.core.pseCommonService.triggerFilterReorderOnSort(),t.unmask(i.app.listView.getDEContainer()),n.successAlert(s.designenv.contentRemovedsuccessMessage)}))}))}addRemovalItemesToPromise(e){if(Array.isArray(e)&&e.length>0){let t=e.map((e=>e.options.actorId));this.removeItemsPromises.push(this.app.core.wsDataService.removeFolderContents({folderId:e[0].getParent().getID(),ids:t}))}}removeItemsFromView(e){var t=this;if(Array.isArray(e)&&e.length>0){let i=e.map((e=>e.getID()));this.app.core.dsEnvEventManager.publish(this.app.core.designEnvConstants.EVENTS_REMOVE_ITEMS,{parentNode:e[0].getParent(),ids:i});e.map((e=>t.app.core.dataProvider.getFilterAppliedProductId(e)))}}confirmToRemoveItems(e){if(1==this.isdontShowRemoveItemsDialog)return void e();this.designExpUXDialog=i.getInstance(this.app);let t=this.designExpUXDialog.getButtons({onOkCallback:e,onCloseDialogCallback:this.onCloseDialog.bind(this)});this.designExpUXDialog.buildRemoveItemsConfirmationDialog({title:s.designenv.removeItemsDialogTitle,message:s.designenv.removeItemsDialogMessage,buttons:t,showDonNotShowAttr:!0})}onCloseDialog(e,t){e.dsModel.dialog.close(),this.isdontShowRemoveItemsDialog=t}})),define("DS/DesignEnvironmentUX/commands/RemoveItemsFromFolderCmd",["DS/DesignEnvironmentUX/commands/RemoveItemsGenericCmd"],(e=>class extends e{constructor(e){super(e,"Design_Env_remove_items_command"),this.app=e.app}execute(){let e=this.app.core.contextManager.getSelectedItems();Array.isArray(e)?this.confirmToRemoveItems(this.removeItems.bind(this,e)):e&&this.confirmToRemoveItems(this.remove.bind(this,e))}})),define("DS/DesignEnvironmentUX/commands/RemoveContentCmd",["DS/DesignEnvironmentUX/commands/RemoveItemsGenericCmd"],(e=>class extends e{constructor(e){super(e,"Design_Env_remove_content_command"),this.app=e.app}execute(){let e=this.app.core.contextManager.getSelectedItems();Array.isArray(e)?0==e.length?this.confirmToRemoveItems(this.remove.bind(this,this.app.core.contextManager.getSelectedContext())):this.confirmToRemoveItems(this.removeItems.bind(this,e)):this.confirmToRemoveItems(this.remove.bind(this,e))}})),define("DS/DesignEnvironmentUX/ws/WSAccess",["DS/WAFData/WAFData","DS/DesignEnvironmentUX/utils/DesignEnvUtils"],(function(e,t){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this)}return i.prototype.getKind=function(){return"Static"},i.prototype.initialize=function(e){return new Promise(function(t,n){var s=[],o=[];if(!0===e.addDefaults&&(o=o.concat(["DS/DesignEnvironmentUX/ws/WSMisc","DS/DesignEnvironmentUX/ws/WSDesignEnv","DS/DesignEnvironmentUX/ws/WSDesignExp"])),Array.isArray(e.WSDefinitionAMDs)&&(o=o.concat(e.WSDefinitionAMDs)),Array.isArray(o))for(var r=0;r<o.length;r++){var a=r;s.push(new Promise(function(e,t){require([o[a]],(function(t){i.prototype=Object.assign(i.prototype,t.prototype),e()}),t)}.bind(this)))}Promise.all(s).then(t).catch(n)}.bind(this))},i.prototype.executeRequest=function(i,n,s,o){var r=t.getSecurityContext();if(UWA.is(r,"string")&&!0!==s&&(n.headers.SecurityContext=r,!0!==o)){var a=t.getUser();a&&a.login&&(n.headers.SecurityToken=a.login+"|"+r+"|preferred")}return e.authenticatedRequest(i,n)},i.prototype.executeRequestPromise=function(e,t){var i=this;return new Promise((function(n,s){t.onComplete=function(e){var t=function(e){return"string"==typeof e&&e?JSON.parse(e):e}(e);n(t)},t.onFailure=function(e,t){e.response=JSON.parse(t),s(e)},t.onTimeout=function(e){s(e)},["POST","DELETE"].includes(t.method)&&"string"!=typeof t.data&&(t.data=JSON.stringify(t.data)),i.executeRequest(e,t)}))},new i})),define("DS/DesignEnvironmentUX/services/WSDataService",["DS/DesignEnvironmentUX/ws/WSAccess","i18n!DS/DesignEnvironmentUX/assets/nls/DesignEnvironmentUX"],((e,t)=>class{constructor(e){this.core=e&&e.app?e.app.core:e}addFolderContent(t,i){return e.addExperienceAssets({actorKind:t._options.kind,deId:t._parentNode.getID(),assets:i.map((e=>e.getID()))})}getRootsForFilters(t){return e.getFiltersFromIds(t)}getDesignExperienceLabel(t){var i=this;return new Promise((n=>{t.isReadOnly||t.shouldFetchLabel?t.shouldFetchLabel?i.deFetchDB(t.pids[0]).then((e=>{n(e)})).catch((()=>{n("")})):e.fetch(t).then((e=>{let t="string"==typeof e?JSON.parse(e):e;t=t.results&&t.results.length?t.results[0].attributes.find((e=>"ds6w:label"==e.name)):"",n(t?t.value:t)})):n()}))}deFetchDB(e){let t=this.core.dataProvider.app.getDgvModel()._getFetchFunc(!0);return new Promise((i=>{t({data:{physicalid:[e]},autoAttSelection:!0}).then((e=>{let t="string"==typeof e?JSON.parse(e):e;i(t.results&&t.results.length?t.results[0].attributes.find((e=>"ds6w:label"==e.name)).value:"")}))}))}getFolderContent(t){let i=this;var n,s=t.getKind(),o=i.core.dataBuilder;return new Promise((function(r){if("designenv"==s)r(o.buildContentOptions(void 0));else if(["cow","ctx","wip"].includes(s))if(!i.core.dataProvider.app.isReadOnly&&i.core.dataProvider.app.getIsReadOnlyInWeb()){let n={results:[]};e.getExperienceAssetsonIndex({deId:t.getID()}).then((e=>{(e="string"==typeof e?JSON.parse(e):e).result&&1==e.result.length&&(e.result[0].outputs.Context&&e.result[0].outputs.Context.length>1&&e.result[0].outputs.Context.sort(((e,t)=>e.app_index-t.app_index)),e.result[0].outputs.WIP&&e.result[0].outputs.WIP.length>1&&e.result[0].outputs.WIP.sort(((e,t)=>e.app_index-t.app_index)),e.result[0].outputs&&(n.results=i.core.dataProvider.buildDataForPE(e.result[0].outputs))),n.results&&n.results.length&&(n.results=n.results.filter((e=>e.AssetType))),r(i.core.dataBuilder.buildContentOptions(n.results.length?n:void 0))}))}else e.getExperienceAssets({actorKind:s,deId:t.getID()}).then((i=>{n="string"==typeof i?JSON.parse(i):i,!i.hasOwnProperty("")&&n.results&&n.results.length?(n.results=n.results.filter((e=>e.AssetType)),50==n.results.length?e.getExperienceAssets({actorKind:s,deId:t.getID(),hasPagination:!0}).then((e=>{let t="string"==typeof e?JSON.parse(e):e;!e.hasOwnProperty("")&&t.results&&t.results.length&&(n.results=n.results.concat(t.results.filter((e=>e.AssetType)))),r(o.buildContentOptions(n))})):r(o.buildContentOptions(n))):r(o.buildContentOptions(void 0))}))}))}saveUnsavedFilter(t){return e.saveUnsavedFilter(t)}getDefaultFilterName(t){return e.getDefaultFilterName(t)}removeFolderContents(t){return t.ids=this.core.dataProvider.getItemsAsArray(t.ids),e.removeExperienceAssets(t)}inAppsSearch(t){return e.inAppsSearch(t)}})),define("DS/DesignEnvironmentUX/DesignEnvCore",["DS/DesignEnvironmentUX/services/DesignEnvEventsManager","DS/DesignEnvironmentUX/utils/DesignEnvConstants"],((e,t)=>{let i={};return class{constructor(e){i={app:e},this.initialize()}initialize(){this.mandatoryPromises=[],this.mandatoryStartupPromises=[],this.dsEnvEventManager=new e(i),this.initServices()}start(){let e=this;return new Promise(((t,i)=>{Promise.allSettled(e.mandatoryPromises).then((()=>{Promise.allSettled(e.mandatoryStartupPromises).then((()=>{t(!0)}))}))}))}initServices(){this.loadConstant(),this.servicesMap=[{key:"commandService",name:"CommandsService"},{key:"contextManager",name:"DesignEnvContextManager"},{key:"searchService",name:"DesignEnvSearchService"},{key:"dataProvider",name:"DesignEnvDataProvider"},{key:"factory",name:"DesignEnvFactory"},{key:"pseCommonService",name:"PseCommonService"},{key:"dataBuilder",name:"DataBuilder"},{key:"wsDataService",name:"WSDataService"}],this.loadServices(this.servicesMap)}loadServices(e){let t=this;return e.forEach((e=>{let i=new Promise(((i,n)=>{t.requireService(e,i,n)}));t.mandatoryPromises.push(i)})),this}requireService(e,t,n){let s=this;require(["DS/DesignEnvironmentUX/services/"+e.name],(n=>{let o=new n(i);o.initialize&&o.initialize(),s[e.key]=o,t()}))}loadConstant(){this.designEnvConstants=t}isValidSelectionForOpen(){return!0}}})),define("DS/DesignEnvironmentUX/DesignEnvironment",["DS/DesignEnvironmentUX/DesignEnvCore","DS/DesignEnvironmentUX/services/DesignEnvAlertManager","DS/DesignEnvironmentUX/utils/DesignEnvUtils"],((e,t,i)=>class{constructor(e){let n,s,o,r;e&&(n=e.modelEvent,i.setModelEvents(e.modelEvent),s=e.globalModelEvent,o=e.dgvModel,r=e.isReadOnlyInWeb,this.probeMethods=e.probeMethods,this.getModelEvent=()=>n,this.getGlobalModelEvent=()=>s,this.getIsReadOnlyInWeb=()=>r,this.getDgvModel=()=>o,this.setDgvModel=e=>{o=e}),e&&i.isValidDesignEnv(e.designEnvCtx)?this.initialize(e):t.errorAlert("Dropped item is not a valid Design environemt item.")}initialize(t){this.core=new e(this),this.loadApp(t)}loadApp(e){let t=this;this.core.start().then((()=>{this.core.isValidSelectionForOpen(e.designEnvCtx)&&(t.core.dsEnvEventManager.subscribe(t.core.designEnvConstants.EVENT_CLEAN_APP,t.cleanApp.bind(t)),this.core.contextManager.setNextOpenSelection(e.designEnvCtx),t.core.dsEnvEventManager.publish(t.core.designEnvConstants.EVENT_LAUNCH_COMMAND,{commandId:t.core.designEnvConstants.OPEN_DESIGN_ENV_COMMAND_ID}))}))}cleanApp(){this.core.dsEnvEventManager.unsubscribeAll()}})),define("DS/DesignEnvironmentUX/models/DesignEnvItemModel",["DS/TreeModel/TreeNodeModel","DS/DesignEnvironmentUX/services/DesignEnvEventsManager","DS/DesignEnvironmentUX/utils/DesignEnvConstants"],((e,t,i)=>class extends e{constructor(e){e.grid=e&&e.grid?e.grid:{},super(e),this.options=e}getID(){return this.options.resourceid}getRootID(){return this.options.associatedRoot}getType(){return this.options.objectType}getDisplayType(){return this.options.displayType}getKind(){return this.options.kind}getContext(){return i.KIND_DESIGNENV==this.getKind()?this.getChildren().find((e=>i.KIND_CONTEXT==e.getKind())):void 0}getWip(){return i.KIND_DESIGNENV==this.getKind()?this.getChildren().find((e=>i.KIND_WIP==e.getKind())):void 0}getCow(){return i.KIND_DESIGNENV==this.getKind()?this.getChildren().find((e=>i.KIND_COW==e.getKind())):void 0}getContents(){let e=[];return i.KIND_DESIGNENV!=this.getKind()?this.getChildren():(e.push.apply(e,this.getContext().getChildren()),e.push.apply(e,this.getWip().getChildren()),e)}})),define("DS/DesignEnvironmentUX/services/DesignEnvFactory",["DS/DesignEnvironmentUX/models/DesignEnvItemModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/DesignEnvironmentUX/collections/DesignEnvTreeDocument","DS/DesignEnvironmentUX/services/HelperService","UWA/Core","DS/UIKIT/Spinner","css!DS/UIKIT/UIKIT.css"],((e,t,i,n,s,o,r,a)=>{let d=null;return class{constructor(e){return d||this.getNewInstance(e)}getNewInstance(e){return this.app=e&&e.app?e.app:{},d=this,this}createDesignEnvItem(t){let i=this._buildDesignEnvItemOptions(t);return new e(i)}createSubFolder(t){let i=this._buildOptionsForSubFolder(t);return new e(i)}createContentItem(t,i){let n=this._buildOptionsForContent(t,i);return new e(n)}createDataGridViewLayout(e){return new i({cellHeight:38,rowsHeader:!1,columnsHeader:!1})}createDataGridView(e){return e.placeholder=this.createLoadingElement(this),new t(e)}createLoadingElement(e){return o.createElement("div",{class:"mask-wrapper",html:{tag:"div",class:"mask-content",html:[new r({visible:!0,animate:!0,spin:!0}),o.createElement("span",{class:"text font-size",text:e.app.core.dataProvider.getNLS().readOnlyModeLoadMessage})]}})}createModel(){return new n({})}_buildOptionsForContent(e,t){return{resourceid:e.objectId,kind:t?"cowItem":"content",label:e.displayName,displayType:e.displayType,objectType:e.objectType,associatedRoot:this.app.core.dataProvider.getFilterAppliedProductIdFromFilter(e.objectId),icons:[{iconName:t?"part-position wux-ui-3ds":this.app.core.designEnvConstants.BOTH_FILTERS.includes(e.objectType)||e.isFiltered?"filter":"product",fontIconFamily:WUXManagedFontIcons.Font3DS}],actorId:e.actorID}}_buildOptionsForSubFolder(e){let t=e.label===this.app.core.designEnvConstants.LABEL_CONTEXT,i=e.label===this.app.core.designEnvConstants.LABEL_COW;return{resourceid:e.objectId,label:e.displayName,type:e.objectType,kind:t?this.app.core.designEnvConstants.KIND_CONTEXT:i?this.app.core.designEnvConstants.KIND_COW:this.app.core.designEnvConstants.KIND_WIP,deid:e.deid,children:[],sortInfo:i?3:t?1:2,icons:[s.getIconPath(t?"I_Context_Font-Icon_32x32":i?"I_CenterOfTheWorld_FontIcon_32x32":"I_Work-in-Progress_Font_32x32")]}}_buildDesignEnvItemOptions(e){return{resourceid:e.objectId,label:e.displayName,kind:this.app.core.designEnvConstants.KIND_DESIGNENV,deid:e.objectId,detype:e.objectType,objectType:e.objectType,children:[],icons:[s.getIconPath("I_Design-Experience_Font-Icon_32x32")],grid:{version:0}}}}})),define("DS/DesignEnvironmentUX/views/DesignEnvLeftSidePanel/js/mixins/DesignEnvListViewManager",["DS/Utilities/UUID","DS/DesignEnvironmentUX/utils/DesignEnvUtils","i18n!DS/DesignEnvironmentUX/assets/nls/DesignEnvironmentUX","DS/DesignEnvironmentUX/utils/Utils"],((e,t,i,n)=>class{constructor(e){this.options=e,this.core=this.options&&this.options.core?this.options.core:{},this.initialize()}initialize(){this.core.dsEnvEventManager.subscribePlatformEvent(this.core.designEnvConstants.EVENT_CROSS_HEIGHLIGHT_SELECT,this.applyCrossHighlights.bind(this)),this.core.dsEnvEventManager.subscribe(this.core.designEnvConstants.EVENTS_RESET_VIEW,this._resetView.bind(this)),this.core.dsEnvEventManager.subscribe(this.core.designEnvConstants.EVENTS_ADD_ITEM,this._addContent.bind(this)),this.core.dsEnvEventManager.subscribe(this.core.designEnvConstants.EVENTS_REMOVE_ITEMS,this._removeContents.bind(this)),this.assetsToHighlightOnlyInDE=[]}getDgvViewOptions(){let e=this,t=UWA.extend({treeDocument:e.getModels(),columns:e.getColumnsInfo()},e.getDefaultOptions());return this.handleDataGridViewAction(t)}handleDataGridViewAction(e){return e.onDragStartCell=this._dragStart.bind(this),e.onContextualEvent=this._onContextualEvent.bind(this),e.onDropCell=this._dropCell.bind(this),e.onDragOverCell=this._dragOverCell.bind(this),e}getTabLabel(){return i.designenv.tablabel}getDefaultOptions(){return{defaultColumnDef:{width:"auto",typeRepresentation:"string"},cellDragEnabledFlag:!0,showRowIndexFlag:!1,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",showContextualMenuColumnFlag:!this.options.isReadOnly,selectionBehavior:this.getSelectionBehavior(),treeNodeCellOptions:{expanderStyle:"triangle",buildLinks:!1}}}getSelectionBehavior(){return{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0}}getColumnsInfo(){return[{dataIndex:"tree",typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,resizableFlag:!1}]}handleDataGridViewEvents(e){this.dgView=e,e.addEventListener("click",(function(e,t){t?.nodeModel&&!e.target?.getParents()[1].hasAttribute("is-active")&&(["ctx","wip","cow"].includes(t.nodeModel.getKind())||"content"==t.nodeModel.getKind()&&e.target.getParents()[1].hasAttribute("is-selected"))&&e.target.getParents()[1].setAttribute("is-active","")}))}onSelectionUpdated(e){let t;this.isInternalCall=!0;let i=this,n=[];if(this.isSelectionFromDE=!1,!this.isCrossHighLights){e.forEach((e=>{this.selectAllContents(e)})),this.filteredDeAssets=[],this.pseFilters=this.options.isReadOnly?[]:i.core.pseCommonService.getAllPseFilters();let s=this.getModels().getSelectedNodes();this.isSelectionFromMultiSelect=!1,this.options.isReadOnly?(this.options.deFolderNodes.forEach((e=>{"designenv"!=e.getKind()&&this.core.contextManager.updateFolderBorder(e.getKind(),"remove")})),1==s.length&&this.core.dataProvider.getDeTypes().includes(s[0].getKind())?(this.core.contextManager.updateFolderBorder(s[0].getKind(),"update"),s[0].unselect(),s=[]):i.filteredDeAssets=s.filter((e=>!i.core.dataProvider.getDeTypes().includes(e.getKind())))):s.forEach((e=>{let t=this.pseFilters.find((t=>t.options.resourceid==e.getID()&&t.options.filtered&&t.options.filterId));i.core.contextManager.isFilter(e)?i.core.contextManager.isDeFilterAvailableInDGV(e)&&i.filteredDeAssets.push(e):t?this.assetsToHighlightOnlyInDE.push(e):i.filteredDeAssets.push(e),s.length>1&&(this.core.pseCommonService.isItemAvailableInPSE(e)||this.core.dataProvider.getDeTypes().includes(e.getKind())||n.push(e)),this.isSelectionFromDE=!0})),t=i.filteredDeAssets.map((e=>this._getId(e))),this.options.isReadOnly?this.options.isReadOnly&&this.applyCrossHighlights(this.buildEventDataForReadOnly(t)):this.core.pseCommonService.selectNodes(t),n.length&&!s.find((e=>this.core.dataProvider.getDeTypes().includes(e.getKind())))&&(n.forEach((e=>{this.isSelectionFromMultiSelect=!0,e.select()})),n=[]),this.isSelectionFromDE=!1}this.isInternalCall=!1}buildEventDataForReadOnly(e){return{data:{attributes:{},sharedID:this.core.contextManager.getSharedId(),paths:e,focusOn:!1,tenant:t.getPlatformId(),version:"1.1"},metadata:{appid:t.getAppId(),xappid:t.getAppId(),originWidgetId:t.getWidgetId(),uid:t.uid(),timestamp:Date.now()}}}checkForMismatch(e,t){return e.length<t.length||!t.every((t=>e.some((e=>e.options.resourceid===t.options.resourceid&&!e.options.filtered||e.options.filterId===t.options.resourceid))))}applyCrossHighlights(e){let t=this;"undefined"!=typeof widget&&null!==widget&&widget.id;if(!e||!e.data||!Array.isArray(e.data.paths))return;if(this.isInternalCall)return void(this.isInternalCall=!1);if(this.isSelectionFromMultiSelect)return void(this.isSelectionFromMultiSelect=!1);this.isCrossHighLights=!0;let i=[],n=!1,s=this.options.isReadOnly?[]:this.core.pseCommonService.getChildren(),o=this.getModels().getAllDescendants().filter((e=>!this.core.dataProvider.getDeTypes().includes(e.options.kind))),r=s.length;if(n=!this.options.isReadOnly&&this.checkForMismatch(s,o),this.getModels().unselectAll(),this.core.contextManager._activeDesignEnv&&this.core.contextManager._activeDesignEnv.getContext()&&(i=this.core.contextManager._activeDesignEnv.getContext().__children),o.length&&o.forEach((i=>{function s(e,n){let s=t.core.contextManager.isFilter(i)?t.core.dataProvider.getFilterAppliedProductId(i):void 0,o=t.options.isReadOnly?[]:t.core.pseCommonService.getModels().getNodesById(e);!n&&o.length&&(t.core.pseCommonService.isPSEFilter(o[0])||t.core.contextManager.isFilter(i))?(i.getID()==o[0].options.filterId||o[0].options.filtered&&!o[0].options.filterId&&i.getID()==o[0].options.resourceid)&&i.select():n?e!=i.getID()||t.core.contextManager.isFilter(i)?(e==i.getID()&&t.core.contextManager.isFilter(i)||o.length&&o[0].options.filtered&&!o[0].options.filterId&&i.getID()==o[0].options.resourceid)&&i.select():i.select():e!=i.getID()&&(e!=s||!t.options.isReadOnly&&t.core.contextManager.isDeFilterAvailableInDGV(i))||i.select()}(r||this.options.isReadOnly)&&e.data.paths.forEach((e=>{Array.isArray(e)?e.forEach(s):s(e)})),this.options.isReadOnly||(!e.data.paths.length&&e.data.dePaths&&e.data.dePaths.length&&n&&e.data.dePaths.forEach((e=>s(e,!0))),!e.data.paths.length&&t.assetsToHighlightOnlyInDE.length&&(t.assetsToHighlightOnlyInDE.forEach((e=>s(e.getID(),!0))),t.assetsToHighlightOnlyInDE=[]),e.data.paths.length&&e.data.dePaths&&e.data.designAssetTypeSelection&&e.data.dePaths.forEach((e=>s(e,!0))),e.data.dePaths&&e.data.dePaths.length>1&&!e.data.designAssetTypeSelection&&e.data.dePaths.forEach((e=>s(e,!0))))})),this.isCrossHighLights=!1,!i.length||this.options.isReadOnly||this.options.getIsReadOnlyInWeb()||this.options.getGlobalModelEvent().publish({event:"ENXModel/ReadWriteTriggered",data:!!i.filter((e=>e._isSelected)).length}),this.core.contextManager.getActiveDesignEnv()&&this.options.deFolderNodes&&this.options.deFolderNodes.filter((e=>!e.isExpanded())).length){let e=this.core.contextManager.isWipSelected(),t=this.core.contextManager.isCtxSelected(),i=this.core.contextManager.isCowSelected();t&&!this.options.deFolderNodes[1].isExpanded()&&(this.options.deFolderNodes[1].highlight(),this.core.contextManager.updateFolderBorder("ctx","update")),e&&!this.options.deFolderNodes[2].isExpanded()&&(this.options.deFolderNodes[2].highlight(),this.core.contextManager.updateFolderBorder("wip","update")),i&&!this.options.deFolderNodes[3].isExpanded()&&(this.options.deFolderNodes[3].highlight(),this.core.contextManager.updateFolderBorder("cow","update")),!this.options.deFolderNodes[0].isExpanded()&&(e||t||i)&&(this.options.deFolderNodes[0].highlight(),this.core.contextManager.updateFolderBorder("designenv","update"))}let a=this.options.deFolderNodes?this.options.deFolderNodes.filter((e=>e.isHighlighted())):[];a.length&&!t.core.dataProvider.getItemsAsArray(t.core.contextManager.getSelectedItems()).length&&a.forEach((e=>{e.unhighlight(),t.core.contextManager.updateFolderBorder(e.getKind(),"remove")})),setTimeout((()=>{e?.data?.dePaths?.length||e?.data?.paths?.length||e.data.designAssetTypeSelection||t.core.contextManager.updateFolderBorder("ALL","remove")}),200),t.options.isReadOnly||t.options.getIsReadOnlyInWeb()||t.core.pseCommonService.getPseContext().isLinkedTo3D()&&t.core.pseCommonService.getModels()._cmdProxy.setReadOnlyRootSelection&&t.core.pseCommonService.getModels()._cmdProxy.setReadOnlyRootSelection(!!this.core.contextManager.isCtxSelected())}selectAllContents(e){e&&e.getChildren()&&e.getChildren().length>0&&(e.isSelected()&&!e.areAllChildrenSelected()?e.selectAll():e.isSelected()||e.areAllChildrenUnselected()||e.unselectAll())}_getId(e){return e.getType()==this.core.designEnvConstants.TYPE_ADVANCED_FILTER?this.core.dataProvider.getFilterAppliedProductIdFromFilter(e.getID()):e.getID()}_addContent(e){this.core.dataProvider.isFromCommand=!0,this.core.dataProvider.addContent(e),"ctx"!==e.kind||this.options.getIsReadOnlyInWeb()||this.options.getGlobalModelEvent().publish({event:"ENXModel/ReadWriteTriggered",data:!0})}_resetView(e){this.core.dataProvider.resetView(e)}_removeContents(e){let t=this.getModels(),i=t.getAllDescendants().filter((t=>e.ids.indexOf(t.getID())>=0));t.prepareUpdate(),1==e.removeAll?e.parentNode.removeChildren():i.forEach((t=>{e.parentNode.removeChild(t)})),i.forEach((e=>{t.removeRoot(e)})),t.pushUpdate()}_onContextualEvent(e){var t=this;return new Promise((function(i){if(e.cellInfos){let i=e.cellInfos.nodeModel;i._isSelected||t.getModels().unselectAll(),t.options.core.contextManager.setSelectedContext(i),i.isSelected()||i.select(),t.selectAllContents(i)}i(t.options.core.commandService.renderMenu())}))}_dragOverCell(e,t){let i=this.core.designEnvConstants;if(!this.options.isReadOnly&&!this.options.getIsReadOnlyInWeb()){if(e.dataTransfer)switch(t.nodeModel.options.kind){case i.KIND_CONTEXT:case i.KIND_WIP:case i.KIND_DESIGNENV:e.dataTransfer.dropEffect="copy",e.preventDefault();break;case i.KIND_COW:e.preventDefault();break;default:this._dragStart(e,t)}return!0}}_dropCell(e,s){let o=this;this.unknown_types=[];let r=s.nodeModel,a=this.core.designEnvConstants;switch(r.options.kind){case a.KIND_CONTEXT:case a.KIND_WIP:case a.KIND_COW:e.preventDefault(),e.stopPropagation();var d={deid:r.options.deid,kind:r.options.kind};try{d.data=JSON.parse(e.dataTransfer.getData("text"))}catch(e){wrongDropFormat=!0}var l=d.data.data?d.data.data.items:[];if(l.length){if(r.options.kind==a.KIND_COW){if(l.length>1){o.core.contextManager.hasCowContent()?this.core.dataProvider.displayWarning(this.core.dataProvider.getNLS().unableToSetCow):this.core.dataProvider.displayWarning(this.core.dataProvider.getNLS().multipleCowItemsError);break}if("AxisSystemReference"!=l[0].objectType){this.core.dataProvider.displayWarning(i.replace(i.designenv.unsupported_drop_cow,{label:l[0].displayName,type:l[0].objectType}));break}if(o.core.contextManager.hasCowContent()){if(this.core.contextManager.getActiveDesignEnv().getContents().length){this.core.dataProvider.displayWarning(this.core.dataProvider.getNLS().unableToSetCow);break}o.core.dataProvider.replaceOrUnsetCowAsset()}o._addContent(d);break}l=l.filter((e=>{if("ENOStrRefinementVDRPSpec"!==e.objectType||this.core.dataProvider.app.isVDRPEnabled)if("AxisSystemReference"===e.objectType)this.core.dataProvider.displayWarning(i.replace(i.designenv.unsupported_drop,{type:e.objectType}));else{if(t.hasVDRPRoles()||"VPMReferenceExtPos"!==e.objectType)return n.getAuthorisedRoots().includes(e.objectType)||o.unknown_types.push(e.objectType),e;this.core.dataProvider.displayWarning(i.designenv.unauthorisedDrop)}else this.core.dataProvider.displayWarning(i.replace(i.designenv.vdrpTypeNotSupported,{label:e.displayName}))})),this._areTypesAuthorised(this.unknown_types).then((e=>{if(e&&e.length&&(l=l.filter((t=>!e.includes(t.objectType)))),l){let e=l.filter((e=>e.path&&e.path.length>1));if(e.length){let t=e.filter((e=>l.find((t=>t.objectId==e.path[0].resourceid))));l=t.length?l.filter((e=>!t.find((t=>t.objectId==e.objectId)))):l}}let t=l.filter((e=>"ENOStrRefinementSpecification"==e.objectType&&!e.filterId&&!e.filterTitle)).map((e=>e.objectId));t.length?o.core.dataProvider._getRootsForFilters(t).then((e=>{const t=new Set;d.data.data.items=l.filter((n=>{if("ENOStrRefinementSpecification"===n.objectType){if(n.rootId=e.find((e=>e[n.objectId]))[n.objectId].rootPhysicalId,n.isFiltered=!0,t.has(n.rootId))return o.core.dataProvider.displayWarning(i.replace(i.designenv.FiltersFromSameRootMessage,{label:n.filterTitle})),!1;t.add(n.rootId)}return!0})),o._addContent(d)})):(d.data.data.items=l,o._addContent(d))}))}}}_areTypesAuthorised(e){this.invalidTypes=[];let t=this,s=["DS/PADUtils/PADWSAccess"];return new Promise(((o,r)=>{require(s,(s=>{s.getTypesHierarchy({types:e,onComplete:function(s){JSON.parse(s).types_hierarchies.forEach((s=>{e.includes(s.type)&&!n.getAuthorisedRoots().find((e=>s.hierarchy.includes(e)))&&(t.invalidTypes.push(s.type),t.options.getDgvModel().options.context.displayNotification({msg:i.replace(i.designenv.unsupported_drop,{type:s.type}),eventID:"warning"}))})),console.log(t.invalidTypes),o(t.invalidTypes)},onFailure:function(e){r()}})}))}))}_dragStart(i,n){let s=this,o=n.draggedNodes&&n.draggedNodes.length&&n.draggedNodes[0].options.kind?n.draggedNodes:n.nodeModel;o?.length&&"designenv"===o[0].getKind()&&(o.splice(1),this.core.dataProvider.app.isDndFromLeftPanel=!0);let r={protocol:"3DXContent",version:"1.1",source:e.v4(),widgetId:"undefined"==typeof widget?e.v4():widget.id,data:{items:[]}};function a(e){e.getType()&&r.data.items.push({envId:t.getPlatformId(),serviceId:s.core.contextManager.getServiceId(),contextId:t.getSecurityContext(),objectId:e.getID(),objectType:e.getType(),displayName:e.getLabel(),displayType:e.getDisplayType(),designEnvType:e.getKind()?e.getKind():"",associatedRoot:e.options.associatedRoot})}var d;return d=o,Array.isArray(d)?d.forEach((e=>{a(e)})):a(d),i.dataTransfer.setData("text",JSON.stringify(r)),i.dataTransfer.effectAllowed="all",!1}})),define("DS/DesignEnvironmentUX/views/DesignEnvLeftSidePanel/js/DesignEnvListView",["DS/DesignEnvironmentUX/views/DesignEnvLeftSidePanel/js/mixins/DesignEnvListViewManager","DS/Utilities/UUID","css!DS/DesignEnvironmentUX/DesignEnvironmentUX"],((e,t,i)=>{let n={};return class extends e{constructor(e){super(e),n.core=e&&e.core?e.core:{},this.initializeView()}initializeView(){this.elements={},this.elements.container=UWA.createElement("div",{class:"designenvpanel-main"}),this._buildDataGridView()}getDEContainer(){return this.elements.container}setVisible(e){e?this.elements.container.removeAttribute("hidden"):this.elements.container.setAttribute("hidden","")}addDesignEnv(e){let t=this;return new Promise((function(i){n.core.dataProvider.getDesignEnvItem(e).then((e=>{t.getModels().removeRoots(),t.getModels().addRoot(e),i(e)}))}))}getDataGridViewInstance(){return n.dgv?n.dgv:this._buildDataGridView()}getModels(){return n.model}_buildDataGridView(){var e=this;return new Promise((function(i){let s=UWA.extend({identifier:"DataGridView-DesignEnvPanel-"+t.v4()},e.getDgvViewOptions());s.layout=n.core.factory.createDataGridViewLayout();let o=n.core.factory.createDataGridView(s);n.dgv=o,n.model=n.core.factory.createModel(),o.treeDocument=n.model,o.getContent().addClassName("designenv-dgv"),o.getContent().inject(e.elements.container),o.layout.setColumnPinned("ContextualMenuColumn","unpinned"),o.getNodesXSO().onPostAdd(e.onSelectionUpdated.bind(e)),o.getNodesXSO().onPostRemove(e.onSelectionUpdated.bind(e)),e.handleDataGridViewEvents(o),i()}))}}})),define("DS/DesignEnvironmentUX/commands/OpenDesignEnvItemCmd",["DS/ApplicationFrame/Command","DS/DesignEnvironmentUX/views/DesignEnvLeftSidePanel/js/DesignEnvListView"],((e,t)=>class extends e{constructor(e){super(e,"Open_Design_Env_item_command"),this.app=e.app}execute(e){this.launchOpenItem()}launchOpenItem(){let e=this;require(["DS/DesignEnvironmentUX/utils/DesignEnvCtx"],(function(t){var i={appId:e.app.core.contextManager.getAppId()};t.initialize(i),i={designEnvCtx:"my_sandbox"},t.setContext(i)})).bind(this),this.navigateToDesignEnvListView()}navigateToDesignEnvListView(){let e=new t(this.app);this.app.listView=e,this.app.getGlobalModelEvent().publish({event:"ENXModel/DesignEnv/leftSidePanel/loadTab",data:{designenvpanel:e}}),this.app.getGlobalModelEvent().publish({event:"ENXModel/DesignEnv/leftSidePanel/content"})}}));