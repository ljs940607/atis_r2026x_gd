/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/DMUwebR3Mux/DMUwebR3Mlist",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/Controls/ProgressBar","DS/CollectionView/CollectionViewStatusBar","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ComboBox","i18n!DS/DMUwebR3Mux/assets/nls/DMUwebR3Mux.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],(function(e,t,n,i,l,a,o,s,r,d,c,u,m){"use strict";let g=window.WUXManagedFontIcons.Font3DS;var p,f,y,h,w=function(e,t,n,i){return p=n.options.grid.analysisStateNbKO,f=i.options.grid.analysisStateNbKO,y=n.options.grid.analysisStateDisp,h=i.options.grid.analysisStateDisp,y===h?p===f?0:p<f?-1:1:y<h?-1:1};return t.extend({init:function(t){let p,f,y,h={},b={},C=t.onSelect,v=t.onUnselect,x=t.onFiltersModified,I=t.onInfo,S=t.cbDnD,F=t.columns,M=t.parent,k=t.getFilterValues,E=t.onPublishTo3DSwym,D=t.getIsrTypes,R=t.onRelations,T=t.allowRelations,j=t.allowCopyLink,A=t.onCopyLink,O=t.allowUpdateSimulation,P=t.getCSIcomputeToken,V=t.onIssueCells,N=t.onTaskCells,B=t.onIssueAssigneesCells,_=t.onTaskAssigneesCells,L=t.onMaturityState,U=t.onAnalysisState,Q=t.onMetricIssue,W=t.getR2VActivityInfo,q=t.allowMaturityState,z=t.onValidationState,G=t.allowValidationState,H=t.onUpdateSimulation,X=t.getPreviousConfig,J={show:!1,total:[],completed:[],failed:[]},K=t.onMassCreate,Y=t.onPref,Z=["private","inwork","frozen","released","obsolete","default","exists","inprogress","failed","passed","prepare","donenoko","startedwithko","startednoko","donewithko","notcomputed","create","assign","active","review","closed","notstarted","ongoing","completed","complete"],$=[{type:r.STATUS.NB_ITEMS},{position:"far",type:r.STATUS.NB_SELECTED_ROWS}];function ee(e){return{id:e.options.grid.id,parents:e.getParents().map((function(e){return e.options.grid.id}))}}function te(t,n){let i=e.createElement("div",{class:"r3mtweaker "+n});return i.value=t,i.getStringFromValue=function(e){return e||""},i.computeContentSize=function(){let e=15;for(let t=i.childNodes.length-1;t>=0;--t)e+=i.childNodes[t].getDimensions().width;return e},i}function ne(e){if(f)return e&&e.nodeModel&&e.cellView?f.getCellDefaultTooltip(e,-1!==(e.nodeModel.options.grid.description||"").search("\n")):f.getCellDefaultTooltip(e)}function ie(e){if(!f)return;if(!e||!e.nodeModel||!e.cellView)return f.getCellDefaultTooltip(e);let t=f.getCellDefaultTooltip(e);return{getAllInformationCB:function(){return e.nodeModel.options.grid.validStateWarning?{model:{shortHelp:e.nodeModel.options.grid.validStateWarning},updateModel:!1}:t.getAllInformationCB()}}}function le(e,t,n,i,l,a,r,d){let c;if(n){let l,a=Z.indexOf(t)>-1,o=0;if("r3mCellAnalysisState_itfQueryRunning"===t?(l="r3mCellAnalysisState_itfQueryRunning",o=e&&e.nodeModel&&e.nodeModel.options.grid?e.nodeModel.options.grid.analysisStateProgress:0):l="r3mR2VCellState_itfQueryRunning"===t?"r3mR2VCellState_itfQueryRunning":"r3mCellState_"+t+i+(a?"":"_NoColor"),f._reusableCellContentManager.isRegistered(l)||f.registerReusableCellContent({id:l,buildContent:r.bind(null,n,i,a,t,d)}),o>0&&"r3mCellAnalysisState_itfQueryRunning"===t){let e=te("","r3mstatus");new s({value:o}).inject(e),c=e}else c=f.reuseCellContent(l)}e.cellView._setReusableContent(c),e.cellView.tooltipInfos=new o(a?ie(e):f.getCellDefaultTooltip(e))}function ae(t,n,i,l,a){let o=te(t,"r3mstatus");return e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+l:""}).inject(o),a&&(o.style.textAlign="start",o.style.paddingLeft="5px"),o}function oe(t){var n=e.createElement("div",{class:"spinner spinning",styles:{display:"flex","justify-content":"center",transform:"translate3d(0,0,0)"}}).inject(t);e.createElement("span",{class:"spinner-bar"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n)}function se(t,n,i,l){let a=te(t,"r3mstatus");if("startedwithko"===l||"donewithko"===l){let o=e.createElement("span",{class:i?"r3mstatuscolored r3m"+l:""}).inject(a);e.createElement("span",{html:t+" "}).inject(o),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-attention"}).inject(o),e.createElement("span",{html:" "+n}).inject(o)}else if("startedButNotIndexed"===l){let n=e.createElement("span",{class:"r3mstatuscolored r3m"+l}).inject(a);e.createElement("span",{html:t+" "}).inject(n),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-clock"}).inject(n)}else if("computed"===l){let i=e.createElement("span",{class:"r3mstatuscolored r3m"+l}).inject(a);e.createElement("span",{html:t+" "}).inject(i),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-interference-metric"}).inject(i),e.createElement("span",{html:" "+n}).inject(i)}else if("computedButNotIndexed"===l){let n=e.createElement("span",{class:"r3mstatuscolored r3m"+l}).inject(a);e.createElement("span",{html:t+" "}).inject(n),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-clock"}).inject(n)}else if(l.contains("r3mCellAnalysisState_itfQueryRunning"))oe(a);else if("Running"===l){let n=e.createElement("span",{class:"r3mstatuscolored r3m"+l}).inject(a);e.createElement("span",{html:t+" "}).inject(n)}else if("Queued"===l){let n=e.createElement("span",{class:"r3mstatuscolored r3mRunning"}).inject(a);e.createElement("span",{html:t+" "}).inject(n)}else e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+l:""}).inject(a);return a}function re(e){if(!(f&&e&&e.nodeModel&&e.cellView))return;if("person"===e.nodeModel.getAttributeValue("type"))return f.defaultOnCellRequest(e);let t=e.nodeModel.options.grid;t&&void 0===t.title&&"r2vsurvey"===t.serviceId?(f._reusableCellContentManager.isRegistered("r3mR2VCellState_itfQueryRunning")||f.registerReusableCellContent({id:"r3mR2VCellState_itfQueryRunning",buildContent:function(e){let t=te(e,"r3mR2V_Running");return oe(t),t}.bind(null,"r3mR2VCellState_itfQueryRunning")}),le(e,"r3mR2VCellState_itfQueryRunning","r3mR2VCellState_itfQueryRunning",0,t.id,!1,ae,!0),W({serviceId:t.serviceId,objectId:t.id,validatedObjId:e.nodeModel._parentNode._parentNode.options.grid.id,text:e.nodeModel._parentNode._options.grid.id,i3dx:t.i3dx})):le(e,t.title,t.title,0,t.id,!1,ae,!0)}function de(e,t){if(void 0===e||void 0===t)return-1;var n=e.replace(/[{(0-9) }]/g,""),i=t.replace(/[{(0-9) }]/g,"");if(n===m.owner||n===m.assignees||n===m.coordinators||n===m.contributors||n===m.informeduser||i===m.owner||i===m.assignees||i===m.coordinators||i===m.contributors||i===m.informeduser)return 0;const l=e.toLowerCase(),a=t.toLowerCase();return l<a?-1:l>a?1:0}function ce(e){if(!(f&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=(t.maturity||"").split(".");n=n[n.length-1].toLowerCase().replace("_","").replace(" ",""),le(e,n,t.maturityDisp,0,t.id,!1,ae,!1)}function ue(e){if(!(f&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;le(e,(t.validState||"").toLowerCase(),t.validStateDisp,0,t.id,!0,ae,!1)}function me(e){if(!(f&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=D();t.analysisState=t.analysisState?t.analysisState:"";let i="running"===t.analysisState||"unknown"===t.analysisState?"r3mCellAnalysisState_itfQueryRunning":t.analysisState;i=i||"",le(e,-1===n.indexOf(t.type)?"":i,t.analysisStateDisp,t.analysisStateNbKO,t.id,!0,se,!1),"unknown"===t.analysisState&&n.indexOf(t.type)>-1&&U([t.id])}function ge(t){if(!(f&&t&&t.nodeModel&&t.cellView))return;let n,i=t.nodeModel.options.grid,l=i.id,a=i.validStateWarning,s=(l&&b[l]&&i.validState||"").toLowerCase(),r=D(),d="r3mCellState_validstatewarning";if(!(r.indexOf(i.type)>-1)||f.layout.getColumnVisibleFlag("analysisStateDisp")){if(r.indexOf(i.type)>-1?(s="inprogress"===s||"failed"===s&&("computed"===i.analysisState||"notcomputed"===i.analysisState||"startednoko"===i.analysisState)?"minorWarning":"majorWarning",d=d+s+i.analysisState):(s="inprogress"===s?"minorWarning":s,d+=s),a)f._reusableCellContentManager.isRegistered(d)||f.registerReusableCellContent({id:d,buildContent:function(t,n){let i=te(t,"r3mwarning");var l,a;return(l="attention",a="minorWarning"===n?"r3miconcolor":"r3mwarningcolor",e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+l+" "+a})).inject(i),e.createElement("span",{html:t,class:"r3mwarningtext"}).inject(i),i}.bind(null,a,s)}),n=f.reuseCellContent(d);else if(!a&&r.indexOf(i.type)>-1&&"running"===i.analysisState){if(i.analysisStateProgress>0&&("running"===i.analysisState||"unknown"===i.analysisState))return;f._reusableCellContentManager.isRegistered("r3mCellState_itfQueryRunning")||f.registerReusableCellContent({id:"r3mCellState_itfQueryRunning",buildContent:function(e){let t=te(e,"r3mwarning");return oe(t),t}.bind(null,"r3mCellState_itfQueryRunning")}),n=f.reuseCellContent("r3mCellState_itfQueryRunning")}t.cellView._setReusableContent(n),t.cellView.tooltipInfos=new o(ie(t))}}function pe(e){if(!f||!e||!e.nodeModel)return;let t=f.layout.getDataIndexFromColumnIndex(e.columnID);return Boolean(e.nodeModel.options.grid[t])}function fe(e){let t=e.nodeModel.options.grid;if("Issue"===t.type||"Task"===t.type)return t.r3massignees=void 0!==t.r3massignees?t.r3massignees:"running","Issue"===t.type?""===t.r3massignees||"running"===t.r3massignees||0===t.r3massignees.length?t.r3massignees:t.r3massignees.map((function(e){return{label:e.label.trim(),url:""===e.url?void 0:e.url}})):"Task"===t.type?""===t.r3massignees||"running"===t.r3massignees||0===t.r3massignees.length?t.r3massignees:t.r3massignees.map((function(e){return{label:e.label.trim(),url:""}})):void 0}function ye(e){let t=e.nodeModel.options.grid;if("Task"===t.type&&(t.r3mTaskCandiAssignment=void 0!==t.r3mTaskCandiAssignment?t.r3mTaskCandiAssignment:"running","running"!==t.r3mTaskCandiAssignment))return""===t.r3mTaskCandiAssignment?t.r3mTaskCandiAssignment:t.r3mTaskCandiAssignment.map((function(e){return{label:e.label.trim(),url:""}}))}function he(e){if(!f||!e||!e.nodeModel)return;let t=f.layout.getDataIndexFromColumnIndex(e.columnID),n=e.nodeModel.options.grid[t];return n?{url:e.nodeModel.options.grid[t+"Img"]?"":void 0,label:n}:void 0}function we(e){C(e.map(ee))}function be(e){v(e.map(ee))}function Ce(){setTimeout((function(){f.reapplySortModel();var t=JSON.parse(localStorage.getItem("r3mGridFilters"));t&&t.filterModel&&!e.equals(t.filterModel,{})&&(p.setFilterModel({}),p.setFilterModel(t.filterModel))}),10)}function ve(){var e=f.getNodesXSO().get();e&&0!==e.length&&f.ensureNodeModelVisible(e[0],!1)}function xe(t,n,i){let l=te(n,"");if(i.contains("r3mIssueState_Blank"))return l;if(i.contains("r3mCellIssue_QueryRunning"))oe(l);else if("r3mIssuePriority"===f.layout.getDataIndexFromColumnIndex(t.columnID)){let t="";"High"===n?t="high wux-ui-3ds wux-ui-3ds-level-high":"Low"===n?t="low wux-ui-3ds wux-ui-3ds-level-low":"Medium"===n?t="medium wux-ui-3ds wux-ui-3ds-level-medium":"Urgent"===n&&(t="urgent wux-ui-3ds wux-ui-3ds-alert"),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+t+" r3mIssuePriority"+n}).inject(l),e.createElement("span",{html:"  "+n}).inject(l)}return l}function Ie(e,t,n,i){let l,a;"r3mCellIssue_QueryRunning"===t?(a="r3mCellIssue_QueryRunning",e.cellView&&e.cellView.elements&&e.cellView.elements.KPIColorDiv&&e.cellView.elements.KPIColorDiv.hide()):a="r3mCellState_"+t+n,f._reusableCellContentManager.isRegistered(a)||f.registerReusableCellContent({id:a,buildContent:i.bind(null,e,n,t)}),l=f.reuseCellContent(a),e.cellView._setReusableContent(l),e.cellView.getContent().removeAttribute("no-tweaker")}function Se(e){var t=f.columns[e.columnID].dataIndex,n=[];(n=f.getTreeDocument().getSelectedNodes().filter((function(e){return!e.options.grid.isNonEditable}))).length||n.push(e.nodeModel),p.withTransactionUpdate((function(){n.forEach((function(e){if(e.options.grid.hasOwnProperty(t)){var n={};n[t]=e.options.grid.r3mIssueApprovals,e.updateOptions({grid:n})}}))}))}function Fe(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3mIssueApprovals;return void 0!==t&&"running"!==t&&""!==t?"independantBoolean":void 0}function Me(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3massignees;return void 0!==t&&"running"!==t&&""!==t?"user":void 0}function ke(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3mTaskCandiAssignment;return void 0!==t&&"running"!==t&&""!==t?"user":void 0}function Ee(e,t){let n=void 0!==t?t:"running";if("running"!==n)return f.defaultOnCellRequest(e);Ie(e,"running"===n?"r3mCellIssue_QueryRunning":n,n,xe)}function De(e){if(!(f&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;"Issue"!==t.type&&"Task"!==t.type&&(t.r3massignees=""),Ee(e,t.r3massignees),"running"===t.r3massignees&&("Issue"===t.type&&B([t.id]),"Task"===t.type&&_([t.id]))}function Re(e){if(!(f&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;"Issue"!==t.type&&(t.r3mIssueApprovals=t.r3mIssuePriority=t.r3mIssueResolvedBy="");var n=f.layout.getDataIndexFromColumnIndex(e.columnID);if("r3mIssueApprovals"===n)Ee(e,t.r3mIssueApprovals);else if("r3mIssueResolvedBy"===n)Ee(e,t.r3mIssueResolvedBy);else if("r3mIssuePriority"===n){t.r3mIssuePriority=void 0!==t.r3mIssuePriority?t.r3mIssuePriority:"running",Ie(e,"running"===t.r3mIssuePriority?"r3mCellIssue_QueryRunning":t.r3mIssuePriority,t.r3mIssuePriority,xe)}"running"===t.r3mIssueResolvedBy&&V([t.id])}function Te(e){if(!(f&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;"Task"!==t.type&&(t.r3mTaskCandiAssignment=t.r3mTaskEstiFinDate=t.r3mTaskEstiDuration="");var n=f.layout.getDataIndexFromColumnIndex(e.columnID);"r3mTaskCandiAssignment"===n?Ee(e,t.r3mTaskCandiAssignment):"r3mTaskEstiDuration"===n?Ee(e,t.r3mTaskEstiDuration):"r3mTaskEstiFinDate"===n&&Ee(e,t.r3mTaskEstiFinDate),"running"===t.r3mTaskCandiAssignment&&N([t.id])}function je(e){if(e.nodeModel&&"person"===e.nodeModel.getAttributeValue("type"))return{label:e.nodeModel.getAttributeValue("fullName")}}function Ae(e){if(!(f&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;var n="";"NotStarted"===t.reviewContriDisplay?n=m.rvwNotStarted:"OnGoing"===t.reviewContriDisplay?n=m.rvwOnGoing:"Completed"===t.reviewContriDisplay&&(n=m.rvwCompleted),le(e,(t.reviewContriDisplay||"").toLowerCase(),n,0,t.id,!0,ae,!1)}function Oe(e,t){let n,i=this[t],l={label:i.title,grid:i},a=h[t];return i.icon&&(l.icons=[{iconPath:i.icon}]),e.search({match:function(e){e.nodeModel.options.grid.id===i.id&&(n=e.nodeModel)}}),a.forEach((e=>{e.updateOptions(l),Object.keys(i.children||{}).forEach(Oe.bind(i.children,e))})),n}function Pe(e,t){let n,i=this[t],a={label:i.title,grid:i,icons:i.icons},o=h[t];i.icon&&(a.icons=[{iconPath:i.icon}]);let s=D();return-1===J.total.indexOf(i.id)&&s.indexOf(i.type)>-1&&J.total.push(i.id),(e.getChildren()||[]).some((e=>{if(e.options.grid.id===i.id)return n=e})),n||(n=new l(a),e.addChild(n),o?o.push(n):o=h[t]=[n]),i.noSort&&(n.sortChildren=function(e){e.isRecursive&&this.getChildren().forEach((function(t){t.sortChildren(e)}))}),o&&o.forEach((e=>{e.updateOptions(a),Object.keys(i.children||{}).forEach(Pe.bind(i.children,e))})),n}function Ve(){if(!f.getToolbar())return;f.getToolbar().updateNodeModel("filterClose",{visibleFlag:!1});let e=k();e.myselection=0,x(e)}function Ne(){let e=k(),t=m.pnlMyVal;return 1===e.myselection?t=m.pnlMySelection:1===e.owner&&(t=m.pnlOrga),t}this.updateFilterSelectionLabel=function(t,n,i){let l=i||Ne(),a=k();f.getToolbar().updateNodeModel("filterLabel",{grid:{visibleFlag:!0,data:l}}),f.getToolbar().updateNodeModel("caIcon",{visibleFlag:!!i}),(i||"removeStatusDiv"===t)&&function(t,n){if(f.getToolbar().elements.nearContainer.querySelectorAll(".r3mCAStatus").forEach((function(e){f.getToolbar().elements.nearContainer.children[1].removeChild(e)})),"removeStatusDiv"!==t)if("running"===t){let t=e.createElement("div",{class:"r3mCAStatus"});new s({shape:"spinner",height:15}).inject(t),f.getToolbar().elements.nearContainer.children[1].appendChild(t)}else{let i="rvwStatusNotStarted",l=m.rvwStatusNotStarted;"partial"===t?(i="rvwStatusNotStarted",l=m.rvwStatusPartial):"inProgress"===t?(i="rvwStatusInProgress",l=m.rvwStatusInProgress):"failed"===t?(i="rvwStatusFailed",l=m.rvwStatusFailed):"passed"===t&&(i="rvwStatusPassed",l=m.rvwStatusPassed);let a=e.createElement("div",{class:"r3mCAStatus"});a.value="";let o=e.createElement("span",{class:"r3mReviewStatusColored "+i}).inject(a);e.createElement("span",{html:l+" "}).inject(o),n&&n>0&&(e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-attention"}).inject(o),e.createElement("span",{html:" "+n.toString()}).inject(o)),f.getToolbar().elements.nearContainer.children[1].appendChild(a)}}(t,n),f.getToolbar().updateNodeModel("filterClose",{visibleFlag:!!a.myselection})},this.deleteNodes=function(e,t){let n=h[e],i=h[t];n&&i&&(1===i.length?h[t]=void 0:h[t]=h[t].filter((function(e){return e.getParent()!==n[0]})),n[0].removeChildren())},this.updateValidations=function(e,t,n,i){p.withTransactionUpdate((function(){Object.keys(e).forEach((function(e){var t=n?Oe.call(this,p,e):Pe.call(this,p,e);b[e]||(b[e]=t),i&&t.expand()}),e)})),t||Ce()},this.updateStatusBar=function(e,t){"success"===t&&-1!==J.completed.indexOf(e)||"failure"===t&&-1!==J.failed.indexOf(e)||("success"===t&&-1===J.completed.indexOf(e)?J.completed.push(e):"failure"===t&&-1===J.failed.indexOf(e)&&J.failed.push(e),function(){let e=J.total.length;if(e>0){var t=e>0?(J.completed.length+J.failed.length)/e*100:100;if(e-(J.completed.length+J.failed.length)<=0&&(J.completed.length=J.failed.length=0,t=100),J.show){const e=$.findIndex((e=>"progressId"===e.id));-1===e&&100!==t?($.push({type:r.STATUS.CUSTOM,id:"progressId",position:"center",dataElements:{typeRepresentation:"progress",value:t,tooltip:m.gridAnalysisFilterStatus}}),f.buildStatusBar($)):-1!==e&&100===t?($=$.filter((e=>"progressId"!==e.id)),J.show=!1,f.buildStatusBar($)):f.elements.statusBar.getNodeModelByID("progressId").updateOptions({grid:{data:t}})}}}())},this.checkFilterAndFetchValue=function(){if(!f||!p)return;let e=JSON.parse(localStorage.getItem("r3mGridFilters"));if(-1!==f.sortModel.findIndex((e=>"analysisStateDisp"===e.dataIndex||"validStateWarning"===e.dataIndex))||e&&e.filterModel&&(e.filterModel.hasOwnProperty("analysisStateDisp")||e.filterModel.hasOwnProperty("validStateWarning"))){let e=D();p.getAllDescendants().forEach((function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&"unknown"===n.analysisState&&(J.show=!0,U([n.id],!1))}))}},this.setInfoState=function(e){let t=f.getToolbar().array3[0].tweaker.elements.container,n=t.hasClassName("r3mInfoColor");n&&!e?t.removeClassName("r3mInfoColor"):!n&&e&&t.addClassName("r3mInfoColor")},this.expanReviewNode=function(e,t){setTimeout((function(){f.subscribeOnceToAllCellsRendered((function(){Object.keys(e).forEach((function(e){b[e]&&b[e].expandAll()}),e);var n=[];t&&t.objects&&t.objects.forEach((function(e){f&&f.model&&f.model.forEach((function(t){t&&t.options&&t.options.grid&&t.options.grid.id&&t.options.grid.id===e.highlightId&&n.push(t)}))})),p.withTransactionUpdate((function(){f.unselectAll(),f.setActiveCell(-1,!1,!1),n.forEach((function(e){f.selectNodeModel(e,!0,!1)})),f.ensureNodeModelVisible(n[0],!1,!0)}))}))}),30)},this.getSelectedRows=function(){return f.getNodesXSO().get().map(ee)},this.onTenantModified=function(e){let t={tree:"title",name:"name",typeDisp:"type",maturityDisp:"maturity",validStateDisp:"validState",description:"description",owner:"owner",originator:"originator",organization:"organization",dateModif:"dateModif",dateCreat:"dateCreat",collabSpace:"collabSpace"};y.forEach((n=>{n.text=e[t[n.dataIndex]?t[n.dataIndex]:n.dataIndex]}))},this.removeValidation=function(e){p.withTransactionUpdate((function(){e.forEach((function(e){b[e]&&p.removeRoot(b[e]);let t=h[e]&&h[e].indexOf(b[e]);t>-1&&h[e].splice(t,1),!h[e].length&&delete h[e],delete b[e]})),Ce()}))},this.removeAll=function(){f.getNodesXSO().empty(),p.empty(),h={},b={}},function(){function t(e,t){var n=e.getSize(),i=t.getSize(),l=(i.width-n.width)/2,a=(i.height-n.height)/2;e.setStyles({left:l<0?0:l,top:a<0?0:a})}function l(){let e=this.showCustomViewsDialog();function i(){Object.keys(e.buttons).forEach((function(t){e.buttons[t].removeEventListener("click",l)})),e.removeEventListener("close",i),n.removeResizeListener(M)}t(e.elements.container,M),Object.keys(e.buttons).forEach((function(t){e.buttons[t].addEventListener("click",i)})),e.addEventListener("close",i),n.addResizeListener(M,(function(){t(e.elements.container,M)}))}y=[{dataIndex:"tree",text:F.title,typeRepresentation:"user",onCellRequest:re,compareFunction:de,groupableFlag:!1,getCellValue:je},{dataIndex:"name",text:F.name,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"reviewContriDisplay",text:F.r3mReviewMemberContribution,onCellRequest:Ae,width:100,groupableFlag:!1},{dataIndex:"typeDisp",text:F.type,width:150,visibleFlag:!1,groupableFlag:!1,alignment:"center"},{dataIndex:"maturityDisp",text:F.maturity,onCellRequest:ce,width:90,groupableFlag:!1},{dataIndex:"validStateDisp",text:F.validState,onCellRequest:ue,width:100,groupableFlag:!1},{dataIndex:"validStateWarning",icon:{iconName:"attention",fontIconFamily:g},onCellRequest:ge,width:60,minWidth:30,groupableFlag:!1},{dataIndex:"analysisStateDisp",text:F.analysisState,onCellRequest:me,width:150,compareFunction:w,visibleFlag:!1,groupableFlag:!1},{dataIndex:"description",text:F.description,getCellTooltip:ne,width:300,groupableFlag:!1},{dataIndex:"owner",text:F.owner,typeRepresentation:"user",hasCellValue:pe,getCellValue:he,width:150,groupableFlag:!1},{dataIndex:"originator",text:F.originator,typeRepresentation:"user",hasCellValue:pe,getCellValue:he,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"organizationDisp",text:F.organization,width:100,visibleFlag:!1,groupableFlag:!1},{dataIndex:"dateModif",text:F.dateModif,typeRepresentation:"datetime",width:150,groupableFlag:!1},{dataIndex:"dateCreat",text:F.dateCreat,typeRepresentation:"datetime",width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"r3massignees",text:F.r3mAssignees,getCellTypeRepresentation:Me,onCellRequest:De,getCellValue:fe,editableFlag:!1,visibleFlag:!1},{dataIndex:"collabSpace",text:F.collabSpace,visibleFlag:!1,groupableFlag:!1},{dataIndex:"r3mIssueName",text:F.r3mIssueName,editableFlag:!1,visibleFlag:!1,width:"auto"},{dataIndex:"r3mIssuePriority",text:F.r3mIssuePriority,onCellRequest:Re,typeRepresentation:"url",editableFlag:!1,visibleFlag:!0,width:"auto"},{dataIndex:"r3mIssueApprovals",text:F.r3mIssueApprovals,editionPolicy:"EditionInPlace",setCellValue:Se,getCellTypeRepresentation:Fe,onCellRequest:Re,editableFlag:!0,visibleFlag:!1},{dataIndex:"r3mIssueResolvedBy",text:F.r3mIssueResolvedBy,onCellRequest:Re,editableFlag:!1,visibleFlag:!1},{dataIndex:"r3mTaskCandiAssignment",text:F.r3mTaskCandiAssignment,getCellTypeRepresentation:ke,onCellRequest:Te,getCellValue:ye,editableFlag:!1,visibleFlag:!1},{dataIndex:"r3mTaskEstiFinDate",typeRepresentation:"datetime",text:F.r3mTaskFinDate,onCellRequest:Te,editableFlag:!1,visibleFlag:!1},{dataIndex:"r3mTaskEstiDuration",text:F.r3mTaskDuration,onCellRequest:Te,editableFlag:!1,visibleFlag:!1,width:"auto"}],p=new i({shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});var o=e.createElement("div",{class:"r3mListPlaceHolder"});e.createElement("p",{html:m.placeHolderFst,styles:{"text-align":"center"}}).inject(o);var s=e.createElement("div",{styles:{"font-weight":"normal","text-align":"center"}}).inject(o);e.createElement("span",{html:m.placeHolderSnd+" "}).inject(s),e.createElement("span",{class:"fonticon fonticon-list-filter"}).inject(s);var r={identifier:"r3mDataGridView",treeDocument:p,defaultColumnDef:{width:"auto",height:"auto",editableFlag:!1},columns:y,rowSelection:"multiple",cellSelection:{defaultValue:"none"},rowGroupingEnabledFlag:!1,sortModel:[{dataIndex:"tree",sort:"asc"}],rowDragEnabledFlag:!0,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!0,activateAllCellsRenderedEventFlag:!0,placeholder:o,recId:"r3mValidationList",onContextualEvent:async function(t){if(t){var n=[],i=t.cellInfos;if(t.collectionView&&i)if(-1===i.rowID&&-1!==i.columnID){let e=f.layout.getDataIndexFromColumnIndex(t.cellInfos.columnID);"tree"===e&&(e="label");var a=["typeDisp","maturityDisp","validStateDisp","analysisStateDisp","validStateWarning","owner"].indexOf(e)>-1?"set":"string";if(p.getFilterManager().getFilters().hasOwnProperty(e)){var o=p.getFilterManager().getFilters()[e];o&&o.defaultFilterModel&&(o.defaultFilterModel=[])}else p.getFilterManager().setPropertyFilterModel(e,{filterId:a});(n=t.collectionView.buildDefaultContextualMenu(t,{pin:!0,firstColumnsVisibility:!1,sizeColumnToFit:!0,columnsManagement:!1})).push({type:"PushItem",title:m.mnuExpandAllRows,icon:{iconName:"flow-tree-expand-down",fontIconFamily:g},action:{callback:function(){p.withTransactionUpdate((function(){Object.values(b).forEach((function(e){e.expandAll()}))}))}}}),n.push({type:"PushItem",title:m.mnuCollapseAllRows,icon:{iconName:"flow-tree-expand-up",fontIconFamily:g},action:{callback:function(){p.withTransactionUpdate((function(){Object.values(b).forEach((function(e){e.collapseAll()}))}))}}}),n.push({type:"SeparatorItem",title:""}),"label"!==e&&n.push({type:"PushItem",title:m.mnuHideCol,action:{callback:function(){f.layout.setColumnVisibleFlag(f.layout.getDataIndexFromColumnIndex(t.cellInfos.columnID),!1,{isUserInteraction:!0})}}}),n.push({type:"SeparatorItem",title:""}),n.push({type:"PushItem",title:m.mnuCustomView,action:{callback:l.bind(t.collectionView)}})}else if(-1!==i.columnID&&-1!==i.rowID){var s=f.getNodesXSO().get();s.some((function(e){return e.canBeExpanded()&&(!e.isExpanded()||e.getAllDescendants().some((function(e){return e.canBeExpanded()&&!e.isExpanded()})))}))&&n.push({type:"PushItem",title:m.mnuExpandAll,icon:{iconName:"flow-tree-expand-down",fontIconFamily:g},action:{callback:function(){p.withTransactionUpdate((function(){f.getNodesXSO().get().forEach((function(e){e.expandAll()}))}))}}}),s.some((function(e){return e.canBeExpanded()&&(e.isExpanded()||e.getAllDescendants().some((function(e){return e.canBeExpanded()&&e.isExpanded()})))}))&&n.push({type:"PushItem",title:m.mnuCollapseAll,icon:{iconName:"flow-tree-expand-up",fontIconFamily:g},action:{callback:function(){p.withTransactionUpdate((function(){f.getNodesXSO().get().forEach((function(e){e.collapseAll()}))}))}}}),n.length&&n.push({type:"SeparatorItem"});let t=T(),i=await O(),l=q(),a=G(),o=j();(t&&t.length||l&&l.length||a&&a.length)&&n.push({type:"PushItem",title:m.mnuRelations,icon:{iconName:"object-related",family:g},action:{callback:R}}),o&&o.length&&n.push({title:m.mnuShare,type:"PushItem",submenu:[{title:m.mnuPubToSwym,type:"PushItem",icon:{iconName:"logo-3dswym",family:g},action:{callback:E}},{title:m.mnuCopyLink,type:"PushItem",icon:{iconName:"link",family:g},action:{callback:A}}]}),l&&l.length&&n.push({type:"PushItem",title:m.mnuMaturity,icon:{iconName:"collaborative-lifecycle-management",family:g},action:{callback:L}}),a&&a.length&&a[0].display&&n.push({type:"PushItem",title:m.mnuValidation,icon:{iconName:"check",family:g},action:{callback:z}}),i>0&&n.push({type:"PushItem",title:m.mnuUpdateSimulation,state:2===i?"disabled":"enabled",icon:{iconName:"update",family:g},action:{callback:function(){P().then((function(t){if(0===t.countAll)H({isrJobConfig:"8"});else{let s=[];var n=8*((t.countAll>15?15:t.countAll)+1),i=0;for(n=n>=128?128:n;n>=8<<i;)s.push((8<<i).toString().concat(m.csiIsrConfigGB)),i++;let r=e.createElement("div",{class:"r3mCsiCompute"}),g=m.csiIsrUpdateIsrlbl;e.createElement("label",{text:g,styles:{"margin-bottom":"0px","font-size":"14px","font-weight":"normal"}}).inject(r);var l=X(),a=new u({elementsList:s,enableSearchFlag:!1,value:l,displayStyle:"normal"});a.inject(r),a.elements.container.setStyles({width:"5%","margin-left":"5px"});var o=new d({immersiveFrame:void 0,title:m.csiIsrUpdateIsr,content:r,modalFlag:!0,activeFlag:!1,buttons:{Ok:new c({onClick:function(){o.destroy(),H({isrJobConfig:s[a.selectedIndex].toString().replace(m.csiIsrConfigGB,"")})}}),Cancel:new c({onClick:function(){o.destroy()}})}})}}))}}})}return n}}};Object.keys(S).forEach((function(e){r[e]=S[e]})),S=null,f=new a(r),f.getContent().addClassName(r.identifier),window.__karma__&&(f.layout.addCellCoordinates=!0);var h=f.getNodesXSO();h.options.getElementID=void 0,h.onPostAdd(we),h.onPostRemove(be),f.addEventListener("DSpointerhit",(function(e,t){e&&e.multipleHitCount>1&&t&&t.columnID>=0&&t&&t.rowID>=0&&I()})),p.onPostCollapse((function(){setTimeout((function(){f.invalidateLayout({updateCellAttributes:!1,updateCellLayout:!0,freePool:!0})}),0)})),p.onPostExpand((function(){setTimeout((function(){f.invalidateLayout({updateCellAttributes:!1,updateCellLayout:!0,freePool:!0})}),0),function(){let e=D();p.getAllDescendants().forEach((function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&t.isExpanded()&&Q([n.id],!1)}))}()})),p.getFilterManager().subscribe("filterModelChange",(function(){setTimeout((function(){let t=e.clone(p.getFilterManager().filterModel,!0);t=Object.keys(t).reduce(((e,n)=>(t[n].filterModel&&Object.keys(t[n].filterModel).length>0&&(e[n]=t[n]),e)),{}),localStorage.setItem("r3mGridFilters",JSON.stringify({filterModel:t})),ve()}),10)})),p.getModelEvents().subscribe({event:"sortChildren"},(function(){setTimeout((function(){ve()}),10)}));var C=e.createElement("div",{class:"r3mPanel wux-windows-window-maincontent"}).inject(M),v=e.createElement("div",{class:"wux-windows-window-header"}).inject(C);let V=Ne();f.setToolbar({entries:[{id:"caIcon",dataElements:{visibleFlag:!1,typeRepresentation:"functionIcon",icon:{iconName:"change-action wux-ui-3ds",fontIconFamily:g},position:"near"}},{id:"filterLabel",dataElements:{typeRepresentation:"string",readOnly:!0,position:"near",value:V}},{id:"filterClose",dataElements:{visibleFlag:!0,typeRepresentation:"functionIcon",icon:{iconName:"close wux-ui-3ds",fontIconFamily:g},position:"near",value:Ve}},{id:"massCreate",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"fonticon fonticon-wux-ui-3ds-review wux-ui-3ds-review DMUReviewPanelIcon",fontIconFamily:g},position:"far",value:K}},{id:"listFilter",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"list-filter",fontIconFamily:g},position:"far",value:function(){require(["DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Toggle","DS/Controls/ButtonGroup"],(function(i,l,a,o){let s,r,d=e.createElement("div"),c=k(),u=e.createElement("div").inject(d);var g;let p=localStorage.getItem("R3MwebPrefs")&&JSON.parse(localStorage.getItem("R3MwebPrefs")).myselection;("1"===localStorage.getItem("R3MFromCopylink")||p)&&(g=new a({label:m.pnlMySelection,value:"idMySelection",type:"checkbox",checkFlag:1===c.myselection}).inject(u),u=e.createElement("div",{styles:{"margin-top":"10px"}}).inject(d));var f=new e.createElement("span",{class:"fonticon fonticon-3ds-who",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(u),y=e.createElement("label",{text:m.pnlOwner,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterOwner",styles:{"margin-left":"2px"}}).inject(u);u=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var h=new o({disabled:c.myselection}).inject(u),w=new a({label:m.pnlMe,value:0,type:"radio",checkFlag:0===c.owner,disabled:c.myselection});h.addChild(w);var b=new a({label:m.pnlOwnByMe,value:"pnlOwnByMe",type:"checkbox",checkFlag:1===c.ownbyme,disabled:0===c.owner?1:0}),C=new a({label:m.pnlAssignToMe,value:"pnlAssignToMe",type:"checkbox",checkFlag:1===c.assigntome,disabled:0===c.owner?1:0}),v=new a({label:m.pnlWhereContribute,value:"pnlWhereContribute",type:"checkbox",checkFlag:1===c.wherecontribute,disabled:0===c.owner?1:0});b.elements.container.setStyles({marginLeft:"20px"}),C.elements.container.setStyles({marginLeft:"20px"}),v.elements.container.setStyles({marginLeft:"20px"}),h.addChild(b),h.addChild(C),h.addChild(v);var I=new a({label:m.pnlOrga,value:1,type:"radio",checkFlag:1===c.owner,disabled:c.myselection});function S(){b.getContent().dsModel.disabled=!w.checkFlag||w.disabled?1:0,C.getContent().dsModel.disabled=!w.checkFlag||w.disabled?1:0,v.getContent().dsModel.disabled=!w.checkFlag||w.disabled?1:0}h.addChild(I),b.getContent().dsModel.checkFlag=1===c.ownbyme,C.getContent().dsModel.checkFlag=1===c.assigntome,v.getContent().dsModel.checkFlag=1===c.wherecontribute,w.getContent().dsModel.checkFlag=0===c.owner,I.getContent().dsModel.checkFlag=1===c.owner,S(),u=e.createElement("div").inject(d);var F=e.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(u),E=e.createElement("label",{text:m.pnlMaturity,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterMaturity",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(u);u=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var D=new a({label:m.pnlReleased,value:"idReleased",type:"checkbox",checkFlag:1===c.released,disabled:c.myselection}).inject(u),R=new a({label:m.pnlObsolete,value:"idObsolete",type:"checkbox",checkFlag:1===c.obsolete,disabled:c.myselection}).inject(u);u=e.createElement("div").inject(d);var T=e.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(u),j=e.createElement("label",{text:m.pnlType,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterType",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(u);u=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var A=new a({label:m.pnlRvw,value:"idRvw",type:"checkbox",checkFlag:1===c.rvw,disabled:c.myselection}).inject(u),O=new a({label:m.pnlIsr,value:"idIsr",type:"checkbox",checkFlag:1===c.isr,disabled:c.myselection}).inject(u),P=new a({label:m.pnlMsr,value:"idMsr",type:"checkbox",checkFlag:1===c.msr,disabled:c.myselection}).inject(u),V=new a({label:m.pnlMkp,value:"idMkp",type:"checkbox",checkFlag:1===c.mkp,disabled:c.myselection}).inject(u);function N(e){return Array.isArray(e.value)?e.value[0]:e.checkFlag?1:0}function B(){n.removeResizeListener(M),s.destroy()}w&&w.addEventListener("buttonclick",(function(){S()})),I&&I.addEventListener("buttonclick",(function(){S()})),g&&g.addEventListener("buttonclick",(function(){f&&(f.style.color=g.checkFlag?"#BCBCBC":"#000000"),y&&y.setAttributes({class:g.checkFlag?"r3mFilterPanelDisable":"r3mFilterOwner"}),h&&(w.disabled=g.checkFlag?1:0,I.disabled=g.checkFlag?1:0,S()),F&&(F.style.color=g.checkFlag?"#BCBCBC":"#000000"),E&&E.setAttributes({class:g.checkFlag?"r3mFilterPanelDisable":"r3mFilterMaturity"}),T&&(T.style.color=g.checkFlag?"#BCBCBC":"#000000"),j&&j.setAttributes({class:g.checkFlag?"r3mFilterPanelDisable":"r3mFilterMaturity"}),D&&(D.disabled=g.checkFlag?1:0),R&&(R.disabled=g.checkFlag?1:0),A&&(A.disabled=g.checkFlag?1:0),O&&(O.disabled=g.checkFlag?1:0),P&&(P.disabled=g.checkFlag?1:0),V&&(V.disabled=g.checkFlag?1:0)}));var _=new i({emphasize:"primary",label:m.pnlOK,onClick:function(){B(),J.total.length=J.completed.length=J.failed.length=0,x({rvw:N(A),isr:N(O),mkp:N(V),msr:N(P),ownbyme:N(b)||!N(C)&&!N(v)?1:0,assigntome:N(C),wherecontribute:N(v),owner:N(I),released:N(D),obsolete:N(R),myselection:g?N(g):0,mycreation:0})}}),L=new i({label:m.pnlCancel,onClick:B});s=e.createElement("div",{class:"wux-windows-modalDialog",styles:{}}).inject(M),r=new l({title:m.pnlTitle,ensureHeightDefinitionOnHierarchy:!0,content:d,resizableFlag:!0,height:345,position:{of:M,constraint:M},buttons:{Cancel:L,Ok:_}}),r.elements.container.inject(s),r.addEventListener("close",B),t(r.elements.container,M),n.addResizeListener(M,(function(){t(r.elements.container,M)}))}))}}},{id:"mePref",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"cog",fontIconFamily:g},position:"far",value:Y}},{id:"sidePanel",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"info",fontIconFamily:g},position:"far",value:I}}]}).inject(v);var N=e.createElement("div",{class:"wux-windows-window-content"}).inject(C);f.inject(N),n.addEventOnElement(C,C,"dimensionsChanged",(function(){var e=window.getComputedStyle(N),t=e?e.getPropertyValue("padding-top"):"";t=""===t?0:parseInt(t,10);var n=e?e.getPropertyValue("padding-bottom"):"";n=""===n?0:parseInt(n,10);var i=v.offsetHeight+t+n;N.setStyle("height",i?"calc(100% - "+i+"px)":"100%")})),f.buildStatusBar($)}()}})}));