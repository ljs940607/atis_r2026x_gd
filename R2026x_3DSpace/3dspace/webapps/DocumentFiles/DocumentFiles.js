define("DS/DocumentFiles/ContextMenu",["UWA/Core","UWA/Class","UWA/Promise","DS/DocumentCommands/DocumentFileCommandsV2","DS/Menu/Menu"],(function(e,t,n,o,i){"use strict";return t.extend({init:function(t){var n=this;n.ctrl=t,i.hide();var a=n.options={fetchSecurityContext:function(){return n.ctrl.options.fetchSecurityContext()||widget.getValue("credentials")},getSelectedNodes:function(){return n.ctrl.controller.files.treeDocument.getSelectedNodes()},getParentDocument:function(){return n.ctrl.parentId},getModifyAccess:function(){return n.ctrl.e6wDocument.dataelements.hasModifyAccess},getDocumentFromNodeModel:function(e){return e.options.data},getOrigin:function(){return{source:e.is(widget.data.appId)?widget.data.appId:widget&&widget.environment&&widget.environment.data&&widget.environment.data._data&&widget.environment.data._data._x_appId?widget.environment.data._data._x_appId:"DocumentManagement",widgetId:widget.id,component:"contextmenu"}},platformUrls:n.ctrl.options.platformServices,events:n.ctrl.events,isFromContextMenu:!0,container:n.ctrl.elements.toolbarcontainer,ctrl:n.ctrl,uaSource:"Files"};n.publicDocumentCommands=new o(a);var s=n.publicDocumentCommands.commands;n.rawItems=[s.Preview,s.OfficeWebEdition,s.Edit,s.LockAndDownload,s.Lock,s.UndoEdit,s.Unlock,s.Update,s.UpdateAndUnlock,s.FileIterations,s.CopyLink,s.Download,s.Delete],t.options.customization&&t.options.customization.postContextMenuItemsPreparation&&t.options.customization.postContextMenuItemsPreparation(n.rawItems,n.options,t.options)},rawItems:[],selectionChanged:function(){var e=this;e.promise=e.publicDocumentCommands.getWebUXContextMenuItemsForCurrentSelection(e.rawItems,!0)}})})),define("DS/DocumentFiles/FilesEvents",["UWA/Core","UWA/Class"],(function(e,t){"use strict";return t.extend({init:function(e){this.ctrl=e},connect:function(e,t,n){var o=this;this.ctrl.events.addEventListener("user-dropped-files",(function(e){t.publicDocumentCommands.commands.UploadFile.execute(e.files)})),this.ctrl.events.addEventListener("user-selects-files-for-upload",(function(e){t.publicDocumentCommands.commands.UploadFile.execute(e.files)})),this.ctrl.events.addEventListener("docv2-show-notification",(function(t){e.helper.showNotification(t.level,t.title,t.subtitle,t.message,t.sticky,t.allowUnsafeHTML)})),this.ctrl.events.addEventListener("enox-files-collection-count-changed",(function(t){e.switchView(e.view)})),this.ctrl.events.addEventListener("enox-file-node-selection-changed",(function(e){t.selectionChanged()})),this.ctrl.events.addEventListener("enox-docfiles-switch-view",(function(t){e.switchView(t)})),this.ctrl.events.addEventListener("search-toggle-change",(function(e){t.selectionChanged()})),this.ctrl.events.addEventListener("enox-files-parent-changed",(function(e){t.selectionChanged(),o.ctrl.events.publish({event:"reset-search-textbox"})})),require(["DS/PlatformAPI/PlatformAPI"],(function(n){n.subscribe("docm-file-added-to-document",(function(t){t.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==t.documentId&&e.files.addFiles(t.newFiles,"FilesFacet")})),n.subscribe("docm-files-deleted-from-document",(function(t){t.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==t.documentId&&e.files.removeFilesByIds(t.deletedFileIds)})),n.subscribe("docm-file-updated-to-document",(function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach((e=>{e.options.data.id==n.oldFileId&&(e.options.updateData(n.updatedFile),t.selectionChanged())}))})),n.subscribe("docm-file-edited-in-document",(function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach((e=>{e.options.data.id==n.file.id&&(e.options.updateData(n.file),t.selectionChanged())}))})),n.subscribe("Lifecycle.Modification",(function(n){((n="string"==typeof n?JSON.parse(n):n).Refresh.modified&&n.Refresh.modified[0]&&"RestoreIteration"==n.Refresh.modified[0].operation||n.Refresh.created&&n.Refresh.created[0]&&"RestoreIteration"==n.Refresh.created[0].operation)&&n.tenant==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.Refresh.modified[0].physicalid&&e.files.treeDocument.getRoots().forEach((o=>{if(o.options.data.id==e.files.treeDocument.getSelectedNodes()[0].options.data.id)e.data.getFile(e.ctrl.parentId,n.Refresh.created[0].physicalid).then((function(e){o.options.updateData(e.files),t.selectionChanged()}))}))})),n.subscribe("docm-file-locked-in-document",(function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach((e=>{e.options.data.id==n.file.id&&(e.options.updateData(n.file),t.selectionChanged())}))})),n.subscribe("docm-file-undoedited-in-document",(function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach((e=>{e.options.data.id==n.file.id&&(e.options.updateData(n.file),t.selectionChanged())}))})),n.subscribe("docm-file-unlocked-in-document",(function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach((e=>{e.options.data.id==n.file.id&&(e.options.updateData(n.file),t.selectionChanged())}))}))}))}})})),define("DS/DocumentFiles/views/Toolbar",["UWA/Core","UWA/Class","DS/Tweakers/GeneratedToolbar","DS/DocumentFiles/Commands","DS/DocumentCommands/DocumentFileCommandsV2","DS/Utilities/Utils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(e,t,n,o,i,a,s){"use strict";return t.extend({init:function(e){var t=this;t.ctrl=e,e.toolbar=this,t.selectionChanged=a.debounce((function(){t.publicDocumentCommands.selectionChangedForWebUXToolbar(t.GeneratedToolbar),t.privateCommands.selectionChangedForWebUXToolbar(t.GeneratedToolbar),t.ctrl.options.customization&&t.ctrl.options.customization.selectionChangedForWebUXToolbar&&t.ctrl.options.customization.selectionChangedForWebUXToolbar(t.GeneratedToolbar,t.ctrl.options)}),10),t.ctrl.events.subscribe({event:"selection-add"},(function(){t.selectionChanged()})),t.ctrl.events.subscribe({event:"selection-remove"},(function(){t.selectionChanged()}))},build:function(t){var a=this;let r,l={entries:[]};var c={fetchSecurityContext:function(){return a.ctrl.options.fetchSecurityContext()||widget.getValue("credentials")},getWorkUnderHeaders:function(){let t=s.get(),n=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=n?{"DS-Change-Authoring-Context":"pid:"+n}:{}},getSelectedNodes:function(){return a.ctrl.controller.files.treeDocument.getSelectedNodes()},getParentDocument:function(){return a.ctrl.parentId},getModifyAccess:function(){return a.ctrl.e6wDocument.dataelements.hasModifyAccess},getDocumentFromNodeModel:function(e){return e.options.data},getOrigin:function(){return{source:e.is(widget.data.appId)?widget.data.appId:widget&&widget.environment&&widget.environment.data&&widget.environment.data._data&&widget.environment.data._data._x_appId?widget.environment.data._data._x_appId:"DocumentManagement",widgetId:widget.id,component:"toolbar"}},platformUrls:a.ctrl.options.platformServices,events:a.ctrl.events,container:t,ctrl:a.ctrl,uaSource:"Files"};a.privateCommands=new o(c);var d=a.privateCommands.commands;a.publicDocumentCommands=new i(c);var m=a.publicDocumentCommands.commands;l.entries=[d.SearchTextBox,d.SearchToggle,m.UploadFile,m.Preview,m.OfficeWebEdition,m.Edit,m.LockAndDownload,m.Lock,m.UndoEdit,m.Unlock,m.Update,m.UpdateAndUnlock,m.FileIterations,m.CopyLink,m.Download,m.Delete,d.SortSwitcher,d.ViewSwitcher],a.ctrl.options.customization&&a.ctrl.options.customization.postToolbarItemsPreparation&&a.ctrl.options.customization.postToolbarItemsPreparation(l.entries,c,a.ctrl.options),a.ToolbarTreeDocument=n.prototype.createTreeDocument(l),r=a.ToolbarTreeDocument;let u=a.GeneratedToolbar=new n({items:r,direction:"horizontal",overflowManagement:"dropdown",executionContext:{}});return a.privateCommands.connectToWebUXToolbar(u),a.publicDocumentCommands.connectToWebUXToolbar(u),a.ctrl.options.customization&&a.ctrl.options.customization.connectToWebUXToolbar&&a.ctrl.options.customization.connectToWebUXToolbar(u,c,a.ctrl.options),u.inject(t),u},selectionChanged:void 0})})),define("DS/DocumentFiles/views/UploadPane",["UWA/Core","UWA/Controls/Abstract","DS/Utilities/Dom","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],(function(e,t,n,o,i,a){"use strict";return e.Controls.Abstract.extend({name:"enox-files-upload-pane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.uploadPane=this,this._parent({})},build:function(t){var o=this;this.elements.container=e.createElement("div",{class:o.ctrl.getClassNames("-uploadpane")});var s=e.createElement("div",{class:o.ctrl.getClassNames("-uploadpane-center")});(s.inject(this.elements.container),o.ctrl.options.readonly)?e.createElement("span",{class:o.ctrl.getClassNames("-uploadpane-center-msg"),text:a.get("NO_FILES_ATTACHED")}).inject(s):(n.generateIcon({iconName:"drag-drop",fontIconSize:"2x"}).inject(s),e.createElement("span",{class:o.ctrl.getClassNames("-uploadpane-center-msg"),text:a.get("DROP_A_FILE_OR")}).inject(s),o.uploadButton=this.elements.container.uploadButton=new i({input:!1,multiple:!0,buttonText:a.get("UPLOAD_FILE"),attributes:{title:a.get("UPLOAD_FILE")},buttonClassName:"primary "+o.ctrl.getClassNames("-uploadbutton"),events:{onChange:function(e){var t=e.target.files.length>0?e.target.files:e.dataTransfer.files;o.ctrl.events.publish({event:"user-selects-files-for-upload",data:{cancelled:!1,files:t}})},onClick:function(){event.target.value=""}}}),o.uploadButton.inject(s));o.inject(t)},show:function(){this.elements.container.show()},hide:function(){this.elements.container.hide()}})})),define("DS/DocumentFiles/actions/SearchTextBox",["UWA/Core","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],(function(e,t){"use strict";var n=function(e){return{id:"SearchTextBox",dataElements:{docV2Private:!0,typeRepresentation:"string",allowResetToUndefinedByUIFlag:!0,label:t.get("Search"),tooltip:t.get("Search"),position:"far",category:"search",events:{change:function(e,t,n){console.log(e,t,n)}},visibleFlag:!1,priority:10},updateForSelection:function(t,n){console.log(this,e,n),t({visibleFlag:!!e.searchActive}),e.searchActive?(this.action._associatedView.focus(),e.events.publish({event:"search-text-change",data:this.grid.data})):e.events.publish({event:"search-text-change",data:""})},onNodeLiveUpdate:function(t,n,o){e.events.publish({event:"search-text-change",data:n})},extend:function(t,n){var o=this;this.action=t,e.events.addEventListener("reset-search-textbox",(function(t){console.log("reset-search-textbox",o,e),o.action.updateOptions({grid:{data:""}})}))},execute:function(){n.execute({options:e})}}};return n.execute=function(e){e.options.getSelectedNodes()},n})),define("DS/DocumentFiles/views/TilePane",["UWA/Core","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/modelProviders/CollectionViewTreeDocumentModelProvider"],(function(e,t,n){"use strict";return e.Controls.Abstract.extend({name:"enox-documentfiles-tilepane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.tilePane=this,this._parent({})},build:function(o){var i=this;i.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}});let a=n.inherit({name:"FileTileViewTreeDocumentModelProvider",getPropertyValue:function(e,t){return"subLabel"===t?e.options.subLabel.cloneNode(!0):this._parent(e,t)}});var s={model:i.ctrl.controller.files.treeDocument,useDragAndDrop:!0,shouldCellAllowUnsafeHTMLContentAt:function(e,t){return["subtitle","description"].includes(t)},displayedOptionalCellProperties:["contextualMenu","description","activeFlag"],onDropBlank:function(e,t){e.preventDefault(),e.stopPropagation(),i.ctrl.dndManager&&i.ctrl.dndManager.handleDrop(e),this.onDropBlankDefault(e,t)},displayPropertiesTooltip:!1};i.ctrl.options.restrictDND&&(delete s.useDragAndDrop,delete s.onDropBlank),i.rcv=this.ctrl.tilesRCV=new t(s).inject(i.elements.container),i.rcv.modelProvider=new a,i.rcv.getContextualMenu=function(e,t,n){return[""]},i.rcv.onContextualEvent={callback:function(e){return e&&e.cellInfos?(i.ctrl.contextMenu.selectionChanged(),i.ctrl.contextMenu.promise):(e.cellCtxMenuRequired,[])}},i.rcv.onPostCellRequest((function(e){e.nodeModel.options.data.thumbnailRequested||!["gif","jpg","png","giff","jpeg"].includes(e.nodeModel.options.data.dataelements.fileExtension.toLowerCase())||e.nodeModel.options.data.dataelements.image.includes("fcs/media")||(i.ctrl.controller.data.generateFileThumbnail(i.ctrl.parentId,e.nodeModel.options.data.id,e.nodeModel.options.data.dataelements.title,e.nodeModel.options.data.dataelements.format),e.nodeModel.options.data.thumbnailRequested=!0)})),i.rcv.onSelectionAdd((function(e,t){i.ctrl.events.publish({event:"enox-file-node-selection-add",data:e}),i.ctrl.events.publish({event:"enox-file-node-selection-changed",data:e})})),i.rcv.onSelectionRemove((function(e,t){i.ctrl.events.publish({event:"enox-file-node-selection-remove",data:e}),i.ctrl.events.publish({event:"enox-file-node-selection-changed",data:e})})),i.inject(o)}})})),define("DS/DocumentFiles/views/Topbar",["UWA/Core","DS/DocumentFiles/views/Toolbar"],(function(e,t){"use strict";return e.Controls.Abstract.extend({name:"enox-documentfiles-topbar",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this._parent({})},build:function(n){var o=this;o.elements.container=e.createElement("div",{class:this.getClassNames("-topbar")}),o.elements.toolbar=new t(o.ctrl),o.elements.toolbar.build(o.elements.container),o.elements.container.inject(n)},updateToolbar:function(){this.elements.toolbar.selectionChanged()}})})),define("DS/DocumentFiles/actions/SearchToggle",["UWA/Core","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],(function(e,t){"use strict";var n=function(e){return{id:"SearchToggle",dataElements:{docV2Private:!0,typeRepresentation:"functionIcon",icon:{iconName:"search",fontIconFamily:1},label:t.get("Search"),tooltip:t.get("Search"),position:"far",category:"search",value:function(t){t.options=e,n.execute(t)},visibleFlag:!0,priority:10},updateForSelection:function(t,n){t({icon:{iconName:"search",fontIconFamily:1,className:e.searchActive?"search-active":""}})},execute:function(){n.execute({options:e})}}};return n.execute=function(e){e.options.searchActive=!e.options.searchActive;e.options.getSelectedNodes();e.options.events.publish({event:"search-toggle-change",data:e.options.searchActive})},n})),define("DS/DocumentFiles/actions/SortSwitcher",["UWA/Core","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],(function(e,t){"use strict";var n=function(e){return{id:"SortSwitcher",dataElements:{docV2Private:!0,typeRepresentation:"chevronMenuIcon",icon:{iconName:"date-sorting-31-1",fontIconFamily:1},value:{menu:[{type:"RadioItem",title:t.get("e6wFileField.title"),name:"title",dataIndex:"tree",sort:"asc",sortType:"string",icon:{iconName:"alpha-sorting-a-z",fontIconFamily:1},action:{callback:function(e){n.execute(e,this)},context:{options:e}}},{type:"RadioItem",title:t.get("e6wFileField.owner"),name:"owner",dataIndex:"owner",sort:"asc",sortType:"string",icon:{iconName:"alpha-sorting-a-z",fontIconFamily:1},action:{callback:function(e){n.execute(e,this)},context:{options:e}}},{type:"RadioItem",title:t.get("e6wFileField.fileExtension"),name:"fileExtension",dataIndex:"fileExtension",sort:"asc",sortType:"string",icon:{iconName:"alpha-sorting-a-z",fontIconFamily:1},action:{callback:function(e){n.execute(e,this)},context:{options:e}}},{type:"RadioItem",title:t.get("e6wFileField.modified"),name:"modified",dataIndex:"modified",sort:"desc",sortType:"date",icon:{iconName:"date-sorting-31-1",fontIconFamily:1},action:{callback:function(e){n.execute(e,this)},context:{options:e}}}]},label:t.get("e6wFileField.modified"),tooltip:t.get("e6wFileField.modified"),position:"far",category:"stable area",visibleFlag:!0,priority:10},updateForSelection:function(e,t){},extend:function(t,n){var o=e.ctrl.controller.files.sortModel;null==o&&(o={sortAttribute:"modified",sort:"desc",dataIndex:"modified"}),t.options.grid.data.menu.forEach((e=>{e.action.context.name=e.name,e.action.context.dataIndex=e.dataIndex,e.action.context.action=t,e.action.context.radioItem=e,e.action.this=e,e.state="",o.sortAttribute==e.action.context.name&&(e.state="selected","string"==e.sortType?e.icon.iconName="asc"==o.sort?"alpha-sorting-a-z":"alpha-sorting-z-a":"date"==e.sortType&&(e.icon.iconName="asc"==o.sort?"date-sorting-1-31":"date-sorting-31-1"),e.sort=o.sort,t.selectedDataIndex=e.dataIndex,t.selectedDataIndex6w=e.dataIndex6w,t.updateOptions({icon:e.icon,tooltip:e.title,label:e.title}))}))}}};return n.execute=function(e,t){e.context.action.options.grid.data.menu.forEach((e=>{e.state=""})),t.state="selected",e.context.action.selectedDataIndex!=e.context.dataIndex?(e.context.action.selectedDataIndex=e.context.dataIndex,e.context.options.events.publish({event:"applySortModel",data:[{sortAttribute:t.name,sort:t.sort,dataIndex:t.dataIndex}]}),e.context.action.updateOptions({icon:t.icon,tooltip:t.title,label:t.title})):(t.sort="asc"==t.sort?"desc":"asc","string"==t.sortType?t.icon.iconName="asc"==t.sort?"alpha-sorting-a-z":"alpha-sorting-z-a":"date"==t.sortType&&(t.icon.iconName="asc"==t.sort?"date-sorting-1-31":"date-sorting-31-1"),e.context.action.selectedDataIndex=e.context.dataIndex,e.context.options.events.publish({event:"applySortModel",data:[{sortAttribute:t.name,sort:t.sort,dataIndex:t.dataIndex}]}),e.context.action.updateOptions({icon:t.icon,tooltip:t.title,label:t.title}))},n})),define("DS/DocumentFiles/utils/Helper",["UWA/Core","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages"],(function(e,t,n){"use strict";return function(o){var i={localStorageName:"ENOXFilesUXViewMode",prefix:"Files_",showNotification:function(e,o,i,a,s,r){var l={level:e,title:o,subtitle:i,message:a,sticky:s,allowUnsafeHTML:r||!1};window.notifs||(window.notifs=n,t.setNotificationManager(window.notifs),t.setStackingPolicy(5)),window.notifs.addNotif(l)},saveViewMode:function(t){var n=this;o.options&&o.options.filePanelHelperOptions&&(n.localStorageName=o.options.filePanelHelperOptions.localStorageName?o.options.filePanelHelperOptions.localStorageName:n.localStorageName,n.prefix=o.options.filePanelHelperOptions.prefix?o.options.filePanelHelperOptions.prefix:n.prefix);var i=localStorage.getItem(n.localStorageName);(i=e.Json.isJson(i)?JSON.parse(i):{})[e.is(widget.data.appId)?n.prefix+widget.data.appId:widget&&widget.environment&&widget.environment.data&&widget.environment.data._data&&widget.environment.data._data._x_appId?n.prefix+widget.environment.data._data._x_appId:n.prefix+"DocumentManagement"]=t,localStorage.setItem(n.localStorageName,JSON.stringify(i))},loadViewMode:function(){var t=this;o.options&&o.options.filePanelHelperOptions&&(t.localStorageName=o.options.filePanelHelperOptions.localStorageName?o.options.filePanelHelperOptions.localStorageName:t.localStorageName,t.prefix=o.options.filePanelHelperOptions.prefix?o.options.filePanelHelperOptions.prefix:t.prefix);var n=localStorage.getItem(t.localStorageName);if(e.Json.isJson(n)){var i=(n=JSON.parse(n))[e.is(widget.data.appId)?t.prefix+widget.data.appId:widget&&widget.environment&&widget.environment.data&&widget.environment.data._data&&widget.environment.data._data._x_appId?t.prefix+widget.environment.data._data._x_appId:t.prefix+"DocumentManagement"];return"tile"==i||"grid"==i?i:"tile"}return"tile"}};return i.ctrl=o,o.helper=i,i}})),define("DS/DocumentFiles/data/Columns",["UWA/Core","UWA/Class","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],(function(e,t,n){"use strict";return t.extend({ready:void 0,predefinedColumns:[{name:"title",includeAlways:!0,typeRepresentation:"url",dataIndex:"tree",pinned:"left",width:"300",className:"preview-column"},{name:"revision",typeRepresentation:"integer",includeAlways:!0},{name:"comments",typeRepresentation:"string",includeAlways:!0,readonly:"false",editableFlag:!0},{name:"lockStatus",typeRepresentation:"string",visibleFlag:!0,needsCustomImplementation:!0,include:"lockerInfo",fields:["lockerInfo.name","lockerInfo.firstname","lockerInfo.lastname"]},{name:"owner",typeRepresentation:"user",includeAlways:!0,needsCustomImplementation:!0,include:"ownerInfo",includeAlways:!0,fields:["ownerInfo.name","ownerInfo.firstname","ownerInfo.lastname"]},{name:"originated",typeRepresentation:"datetime",visibleFlag:!1},{name:"modified",typeRepresentation:"datetime",includeAlways:!0},{name:"fileSize",typeRepresentation:"integer",visibleFlag:!1},{name:"fileExtension",typeRepresentation:"string",visibleFlag:!1,include:"files",includeAlways:!0,fields:["files.name","files.title","files.revision","files.locker","files.image"]},{name:"ownerInfo",conditionalInclude:"owner",include:"ownerInfo",includeAlways:!0,hiddenAlways:!0,fields:["ownerInfo.name","ownerInfo.firstname","ownerInfo.lastname"]}],customizedColumns:{mandatoryComment:{name:"comments",dataIndex:"comments",includeAlways:!0,readonly:"false",editableFlag:!0,text:n.get("e6wFileField.comments"),customHeader:{buildContent:function(t){const o=e.createElement("div",{styles:{display:"flex","align-items":"center"}}),i=e.createElement("span",{styles:{"margin-left":"7px"}});i.textContent=n.get("e6wFileField.comments");const a=e.createElement("div",{styles:{color:"red"}}),s=e.createElement("i");return s.textContent="*",a.appendChild(s),o.appendChild(i),o.appendChild(a),o}}}},predefinedColumnsDictionary:void 0,customColumnsSelectableDictionary:void 0,customColumnsDictionary:void 0,customColumns:void 0,init:function(t){var o=this;o.ready=e.Promise.deferred(),o.predefinedColumnsDictionary={},o.customColumnsSelectableDictionary={},o.customColumnsDictionary={},o.customColumns=[],o.predefinedColumnsDictionary={},o.predefinedColumns.forEach((e=>{e.text=n.get("e6wFileField."+e.name),e.typeRepresentation&&(null==e.dataIndex&&(e.dataIndex=e.name),o.predefinedColumnsDictionary[e.name]=e)})),"Enabled"==t.options.mandatoryCommentConfigSetting&&(o.predefinedColumnsDictionary.comments=o.customizedColumns.mandatoryComment)},getColumns:function(){var e=this;return Object.keys(e.predefinedColumnsDictionary).map((t=>e.predefinedColumnsDictionary[t]))}})})),define("DS/DocumentFiles/utils/ExtensionUtils",["UWA/Core","DS/WebappsUtils/WebappsUtils"],(function(e,t){"use strict";var n="snresources/images/icons/large/I_IGES200x150.png",o="snresources/images/icons/large/I_STEP200x150.png",i="snresources/images/icons/large/I_ComposerSmg200x150.png",a="snresources/images/icons/large/I_TableDoc200x150.png",s="snresources/images/icons/large/I_PresDoc200x150.png",r="snresources/images/icons/large/I_TextDoc200x150.png",l="snresources/images/icons/large/l_DIAG200x150.png",c="snresources/images/icons/large/I_ImageFile200x150.png",d="snresources/images/icons/large/I_VideoFile200x150.png",m="snresources/images/icons/large/I_AudioFile200x150.png",u="snresources/images/icons/large/I_UnknownFile200x150.png",p={content:"snresources/images/icons/large/I_UnknownFile200x150.png","*":u,sldprt:"snresources/images/icons/large/I_SWV1_Part200x150.png",sldasm:"snresources/images/icons/large/I_SWV1_Assembly200x150.png",slddrw:"snresources/images/icons/large/I_SWV1_Drawing200x150.png",eprt:"snresources/images/icons/large/I_EPRT200x150.png",easm:"snresources/images/icons/large/I_EASM200x150.png",edrw:"snresources/images/icons/large/I_EDRW200x150.png",catpart:"snresources/images/icons/large/I_CATV5_Part200x150.png",catproduct:"snresources/images/icons/large/I_CATV5_Assembly200x150.png",catdrawing:"snresources/images/icons/large/I_CATV5_Drawing200x150.png","3dxml":"snresources/images/icons/large/I_3DXML200x150.png","3mf":"snresources/images/icons/large/I_3MF200x150.png",dwg:"snresources/images/icons/large/I_DWG200x150.png",dxf:"snresources/images/icons/large/I_DXF200x150.png",sldxml:"snresources/images/icons/large/l_SLDX200x150.png",u3d:"snresources/images/icons/large/l_3PDF200x150.png",iges:n,igs:n,obj:"snresources/images/icons/large/I_OBJ200x150.png",stp:o,step:o,stl:"snresources/images/icons/large/I_STL200x150.png",vrml:"snresources/images/icons/large/I_VRML200x150.png",smg:i,smggeom:i,smgxml:i,smgview:i,smgsce:i,axf:"snresources/images/icons/large/I_AxF200x150.png",xls:a,xlsx:a,xltx:a,xltm:a,xlt:a,xlsm:a,xlsb:a,numbers:a,csv:a,ppt:s,pptx:s,potm:s,potx:s,ppsm:s,pps:s,keynote:s,txt:r,log:r,doc:r,docx:r,rtf:r,mpp:"snresources/images/icons/large/l_PROJ200x150.png",vsd:l,vsdx:l,pdf:"snresources/images/icons/large/I_PDFdoc200x150.png",png:c,jpg:c,jpeg:c,gif:c,tiff:c,tif:c,bmp:c,psd:c,ai:c,"image/*":c,wmv:d,mp4:d,mov:d,avi:d,mpg:m,wma:m,mp3:m,wav:m,zip:"snresources/images/icons/large/I_ZIPDoc200x150.png",multidocument:"snresources/images/icons/large/docWithMultiFiles.png"},f="snresources/images/icons/small/I_IGES22x22.png",g="snresources/images/icons/small/I_STEP22x22.png",h="snresources/images/icons/small/I_ComposerSmg22x22.png",v="snresources/images/icons/small/I_TableDoc22x22.png",w="snresources/images/icons/small/I_PresDoc22x22.png",D="snresources/images/icons/small/I_TextDoc22x22.png",x="snresources/images/icons/small/l_DIAG22x22.png",S="snresources/images/icons/small/I_ImageFile22x22.png",I="snresources/images/icons/small/I_VideoFile22x22.png",C="snresources/images/icons/small/I_AudioFile22x22.png",b="snresources/images/icons/small/I_UnknownFile22x22.png",F={content:"snresources/images/icons/small/I_UnknownFile22x22.png","*":b,sldprt:"snresources/images/icons/small/I_SWV1_Part22x22.png",sldasm:"snresources/images/icons/small/I_SWV1_Assembly22x22.png",slddrw:"snresources/images/icons/small/I_SWV1_Drawing22x22.png",eprt:"snresources/images/icons/small/I_EPRT22x22.png",easm:"snresources/images/icons/small/I_EASM22x22.png",edrw:"snresources/images/icons/small/I_EDRW22x22.png",catpart:"snresources/images/icons/small/I_CATV5_Part22x22.png",catproduct:"snresources/images/icons/small/I_CATV5_Assembly22x22.png",catdrawing:"snresources/images/icons/small/I_CATV5_Drawing22x22.png","3dxml":"snresources/images/icons/small/I_3DXML22x22.png","3mf":"snresources/images/icons/small/I_3MF22x22.png",dwg:"snresources/images/icons/small/I_DWG22x22.png",dxf:"snresources/images/icons/small/I_DXF22x22.png",sldxml:"snresources/images/icons/small/l_SLDX22x22.png",u3d:"snresources/images/icons/small/l_3PDF22x22.png",iges:f,igs:f,obj:"snresources/images/icons/small/I_OBJ22x22.png",stp:g,step:g,stl:"snresources/images/icons/small/I_STL22x22.png",vrml:"snresources/images/icons/small/I_VRML22x22.png",smg:h,smggeom:h,smgxml:h,smgview:h,smgsce:h,axf:"snresources/images/icons/small/I_AxF22x22.png",xls:v,xlsx:v,xltx:v,xltm:v,xlt:v,xlsm:v,xlsb:v,numbers:v,csv:v,ppt:w,pptx:w,potm:w,potx:w,ppsm:w,pps:w,keynote:w,txt:D,log:D,doc:D,docx:D,rtf:D,mpp:"snresources/images/icons/small/l_PROJ22x22.png",vsd:x,vsdx:x,pdf:"snresources/images/icons/small/I_PDFdoc22x22.png",png:S,jpg:S,jpeg:S,gif:S,tiff:S,tif:S,bmp:S,psd:S,ai:S,"image/*":S,wmv:I,mp4:I,mov:I,avi:I,mpg:C,wma:C,mp3:C,wav:C,zip:"snresources/images/icons/small/I_ZIPDoc22x22.png",multidocument:"snresources/images/icons/small/I_MultipleDocuments22x22.png"};return{getThumbnail:function(e){return p[e]||u},getIcon:function(e){return F[e]||b}}})),define("DS/DocumentFiles/actions/ViewSwitcher",["UWA/Core","DS/Tweakers/TypeEnums","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],(function(e,t,n){"use strict";var o=function(e){var o=e.ctrl.controller.view,i=t.Layout.DataGridView;return"grid"==o?i=t.Layout.DataGridView:"tile"==o&&(i=t.Layout.SmallTile),{id:"ViewSwitcher",dataElements:{docV2Private:!0,typeRepresentation:"layout",tooltip:n.get("SwitchView"),value:i,possibleValues:[t.Layout.DataGridView,t.Layout.SmallTile],position:"far",category:"stable area",visibleFlag:!0,priority:10},updateForSelection:function(e,t){},onNodeUpdate:function(n){var o="",i=n.getAttributeValue("data"),a="object"==typeof i?i.value:i;a===t.Layout.DataGridView.value?o="grid":a===t.Layout.SmallTile.value&&(o="tile"),e.events.publish({event:"enox-docfiles-switch-view",data:o})},extend:function(e,t){}}};return o.execute=function(e,t){},o})),define("DS/DocumentFiles/Commands",["UWA/Core","UWA/Class","DS/DocumentFiles/actions/SearchTextBox","DS/DocumentFiles/actions/SearchToggle","DS/DocumentFiles/actions/SortSwitcher","DS/DocumentFiles/actions/ViewSwitcher"],(function(e,t,n,o,i,a){"use strict";return t.extend({init:function(e){this.commands={SearchTextBox:new n(e),SearchToggle:new o(e),SortSwitcher:new i(e),ViewSwitcher:new a(e)}},commands:[],connectToWebUXToolbar:function(e){e.items.prepareUpdate(),e.items.getRoots().forEach((e=>{e.options.docV2Private&&e.options.extend&&e.options.extend(e)})),e.items.pushUpdate()},selectionChangedForWebUXToolbar:function(t){t.items.getRoots().forEach((t=>{t.options.docV2Private&&(t.options.grid.action=t,t.options.grid.data&&(t.options.grid.data.argument&&(t.options.grid.data.argument.action=t),t.options.grid.data.value&&!e.is(t.options.grid.data.value,"string")&&(t.options.grid.data.value.action=t)),t.options.updateForSelection&&t.options.updateForSelection((function(e){t.updateOptions(e)})))}))}})})),define("DS/DocumentFiles/data/Model",["UWA/Core","DS/TreeModel/TreeNodeModel","DS/Tweakers/TypeRepresentationFactory","DS/Controls/Label","DS/DocumentFiles/utils/ExtensionUtils","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],(function(e,t,n,o,i,a){"use strict";var s=new n;function r(t,n,o){n.customization&&n.customization.preMakeModelDataOptions&&n.customization.preMakeModelDataOptions(t,n),t.dataelements.originated&&(t.dataelements.originated=new Date(t.dataelements.originated)),t.dataelements.modified&&(t.dataelements.modified=new Date(t.dataelements.modified)),e.is(t.dataelements.fileSize,"string")&&(t.dataelements.fileSize=parseInt(t.dataelements.fileSize)),e.is(t.dataelements.revision,"string")&&(t.dataelements.revision=parseInt(t.dataelements.revision)),s.generateView(t.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){t.dataelements.modifiedAsString=e.getContent().getText()}}),""==t.dataelements.reservedby&&(t.dataelements.reservedby=void 0),t.dataelements.type=t.type;var r={data:t,grid:t.dataelements,lowercase:{}};r.label=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,r.lowercase.label=r.label.toLowerCase(),r.title=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,r.icons=[{iconName:"doc-text"}],r.grid.tree=r.title,r.thumbnail=t.dataelements.indexedImage||t.dataelements.image,(null==r.thumbnail||r.thumbnail.contains("I_CDM_Document108x144.png"))&&(r.thumbnail=n.platformServices["3DSpace"]+"/"+i.getThumbnail(l(r.title))),r.taxonomies=[t.type],"TRUE"!=t.dataelements.isDocumentType||r.taxonomies.includes("Document")||r.taxonomies.push("Document"),r.icons=[n.platformServices["3DSpace"]+"/"+i.getIcon(l(r.title))],t.relateddata&&t.relateddata.ownerInfo&&1==t.relateddata.ownerInfo.length&&t.relateddata.ownerInfo[0].dataelements&&(t.dataelements.owner={label:t.relateddata.ownerInfo[0].dataelements.firstname+" "+t.relateddata.ownerInfo[0].dataelements.lastname,username:t.relateddata.ownerInfo[0].dataelements.name},t.dataelements.owner.labelAndUsername=t.dataelements.owner.label+" ("+t.dataelements.owner.username+")",r.lowercase.owner={label:t.dataelements.owner.label.toLowerCase(),username:t.dataelements.owner.username.toLowerCase()},n.platformServices&&n.platformServices["3DSwym"]&&(t.dataelements.owner.icon=n.platformServices["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.ownerInfo[0].dataelements.name+"/format/mini")),t.relateddata&&t.relateddata.originatorInfo&&1==t.relateddata.originatorInfo.length&&t.relateddata.originatorInfo[0].dataelements&&(t.dataelements.originator={label:t.relateddata.originatorInfo[0].dataelements.firstname+" "+t.relateddata.originatorInfo[0].dataelements.lastname,username:t.relateddata.originatorInfo[0].dataelements.name},n.platformServices&&n.platformServices["3DSwym"]&&(t.dataelements.originator.icon=n.platformServices["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.originatorInfo[0].dataelements.name+"/format/mini")),t.relateddata&&t.relateddata.lockerInfo&&1==t.relateddata.lockerInfo.length&&t.relateddata.lockerInfo[0].dataelements&&(t.dataelements.lockerInfo={label:t.relateddata.lockerInfo[0].dataelements.firstname+" "+t.relateddata.lockerInfo[0].dataelements.lastname,username:t.relateddata.lockerInfo[0].dataelements.name},t.dataelements.lockerInfo.labelAndUsername=t.dataelements.lockerInfo.label+" ("+t.dataelements.lockerInfo.username+")",r.lowercase.locker={label:t.dataelements.lockerInfo.label.toLowerCase(),username:t.dataelements.lockerInfo.username.toLowerCase()},n.platformServices&&n.platformServices["3DSwym"]&&(t.dataelements.lockerInfo.icon=n.platformServices["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.lockerInfo[0].dataelements.name+"/format/mini"));var c=[];return t.dataelements&&e.is(t.dataelements.title,"string")&&c.push(l(t.dataelements.title)),t.dataelements.fileExtension=c.join(", "),r.subLabel=function(t){var n=e.createElement("div",{class:"NameAndState"});return s.generateView(t.grid.owner,{readOnly:!0,typePath:"user",onViewCreated:function(e){e.inject(n)}}),n}(r),r.description=function(t){var n=e.createElement("div",{class:"property-description"});return s.generateView(a.get("e6wFileField.modified")+":",{readOnly:!0,typePath:"string",onViewCreated:function(e){e.inject(n)}}),s.generateView(t.grid.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){e.inject(n)}}),n}(r),r.lowercase.comments=t.dataelements.comments.toLowerCase(),r.getAttributeValueForFiltering=function(e){switch(console.log(e),e){case"owner":return t.dataelements.owner.labelAndUsername;case"lockStatus":return t.dataelements.lockerInfo?t.dataelements.lockerInfo.labelAndUsername:void 0;default:return r.getAttributeValue?r.getAttributeValue(e):o.getAttributeValue(e)}},n.customization&&n.customization.postMakeModelDataOptions&&n.customization.postMakeModelDataOptions(r,n),r}function l(e){return e.substring(e.lastIndexOf(".")+1,e.length)||e}var c=function(e,n){var o=r(e,n);o.updateData=function(e){i.updateOptions(r(e,n,i))};var i=new t(o);return o.getAttributeValue=i.getAttributeValue.bind(i),i};return c.getFileExtension=l,c})),define("DS/DocumentFiles/views/GridPane",["UWA/Core","DS/DataGridView/DataGridView","DS/TreeModel/DataModelSet","DS/Tweakers/TypeRepresentationFactory","DS/Controls/TooltipModel","DS/Utilities/Utils","DS/DocumentFiles/data/Columns","DS/DocumentCommands/Helper","DS/Utilities/StringUtils","i18n!DS/DocumentFiles/assets/nls/DocumentFiles","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,n,o,i,a,s,r,l,c,d){"use strict";var m=new o;return e.Controls.Abstract.extend({name:"enox-documentfiles-gridpane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.gridPane=this,this._parent({})},build:function(n){var o=this;o.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}});var a=new s(o.ctrl).getColumns(),u="documentfiles-";o.ctrl.options.filePanelHelperOptions&&(u=o.ctrl.options.filePanelHelperOptions.prefix?o.ctrl.options.filePanelHelperOptions.prefix:u);var p=(e.is(widget.data.appId)?u+widget.data.appId:widget&&widget.environment&&widget.environment.data&&widget.environment.data._data&&widget.environment.data._data._x_appId?u+widget.environment.data._data._x_appId:u+"DocumentManagement")+"-gridview";a.forEach((e=>{"ReadMode"==o.ctrl.options.mode&&1==e.editableFlag&&(e.editableFlag=!1),"title"==e.name?e.getCellValue=function(e){return{label:e.nodeModel.getLabel(),func:function(e){!e.context.nodeModel.isSelected()&&e.context.nodeModel.select(),o.ctrl.events.publish({event:"enox-file-launch-preview",data:{nodeModel:e.context.nodeModel}})}}}:"owner"==e.name||"originator"==e.name?e.getCellValue=function(t){if(t.nodeModel)return o.ctrl.options.platformServices["3DSwym"]?{icon:o.ctrl.options.platformServices["3DSwym"]+"/api/user/getpicture/login/"+t.nodeModel.getAttributeValue(e.name).username+"/format/mini",label:t.nodeModel.getAttributeValue(e.name).label}:{label:t.nodeModel.getAttributeValue(e.name).label}}:"lockStatus"==e.name?(e.onCellRequest=function(e){var t=o.datagridview.reuseCellContent("lockStatusCell"),n=[],a={},s={};e.nodeModel.options.data.dataelements.locker&&(n.includes(e.nodeModel.options.data.dataelements.locker)||(n.push(e.nodeModel.options.data.dataelements.locker),s[e.nodeModel.options.data.dataelements.locker]=[]),s[e.nodeModel.options.data.dataelements.locker].push(e.nodeModel.options.data.dataelements.title),e.nodeModel.options.data.relateddata.lockerInfo&&e.nodeModel.options.data.relateddata.lockerInfo.length>0&&(a[e.nodeModel.options.data.dataelements.locker]=e.nodeModel.options.data.relateddata.lockerInfo[0].dataelements)),t.greenKey.hide(),t.redLock.hide(),t.singleUser.hide(),t.singleUser.empty();var r,l,d=n.length,u=o.ctrl.options.user;if(d>0)if(n.includes(u.id)){t.redLock.hide(),t.greenKey.show();var p=(r=a[u.id])?r.firstname+" "+r.lastname:u.id;l={label:p},o.ctrl.options.platformServices["3DSwym"]&&(l.icon=o.ctrl.options.platformServices["3DSwym"]+"/api/user/getpicture/login/"+u.id+"/format/mini"),m.generateView(l,{readOnly:!0,typePath:"user",onViewCreated:function(e){e.inject(t.singleUser),t.singleUser.show(),e.tooltipInfos=new i({shortHelp:c.get("LockedByUsername",{username:u.id})})}})}else t.redLock.show(),t.greenKey.hide(),n.forEach((function(e){var n=(r=a[e])?r.firstname+" "+r.lastname:e;l={label:n},o.ctrl.options.platformServices["3DSwym"]&&(l.icon=o.ctrl.options.platformServices["3DSwym"]+"/api/user/getpicture/login/"+e+"/format/mini"),m.generateView(l,{readOnly:!0,typePath:"user",onViewCreated:function(n){n.inject(t.singleUser),t.singleUser.show(),n.tooltipInfos=new i({shortHelp:c.get("LockedByUsername",{username:e})})}})}));e.cellView.setReusableContent(t)},e.compareFunction=function(e,t,n,o,i){var a="",s="",r="",c="";return n.options.data.dataelements.locker&&(r=n.options.data.relateddata.lockerInfo&&n.options.data.relateddata.lockerInfo.length>0?(a=n.options.data.relateddata.lockerInfo[0].dataelements).firstname+" "+a.lastname:n.options.data.dataelements.locker),o.options.data.dataelements.locker&&(c=o.options.data.relateddata.lockerInfo&&o.options.data.relateddata.lockerInfo.length>0?(s=o.options.data.relateddata.lockerInfo[0].dataelements).firstname+" "+s.lastname:o.options.data.dataelements.locker),l.compareLocal(r,c)}):"fileSize"==e.name&&(e.getCellValue=function(e){return r.formatBytes(e.nodeModel.options.data.dataelements.fileSize,2).split(" ")[0]},e.getCellSemantics=function(e){return{units:r.formatBytes(e.nodeModel.options.data.dataelements.fileSize,2).split(" ")[1]}},e.getCellTooltip=function(e){return e.nodeModel?new i({shortHelp:e.nodeModel.options.data.dataelements.fileSize+" "+d.get("fileSizeBytes")}):o.datagridview.getCellDefaultTooltip(e)})}));var f=window.localStorage.getItem("wux-collectionView-dataGridView");null!=f&&(f=JSON.parse(f))[p]&&(delete f[p].columnsSortModel,window.localStorage.setItem("wux-collectionView-dataGridView",JSON.stringify(f))),o.ctrl.options.customization&&o.ctrl.options.customization.preDataGridColumnBinding&&o.ctrl.options.customization.preDataGridColumnBinding(a,o.ctrl.options),o.datagridview=new t({identifier:p,treeDocument:o.ctrl.controller.files.treeDocument,columns:a,autoRowHeightFlag:!0,rowDragEnabledFlag:!1,cellDragEnabledFlag:!0,rowGroupingEnabledFlag:!1,defaultColumnDef:{editableFlag:!1,resizableFlag:!0,sortableFlag:!0,typeRepresentation:"string"},selectionMode:"row",showContextualMenuColumnFlag:!0,rowSelection:"multiple",cellSelection:"none",showSelectionCheckBoxesFlag:!0,showRowIndexFlag:!1,sortModel:[o.ctrl.controller.files.sortModel],layoutOptions:{useLastColumnWidthAutoFlag:!0},onContextualEvent:function(e){if(e&&e.collectionView)return e.cellInfos&&e.cellInfos.nodeModel?(o.ctrl.contextMenu.selectionChanged(),o.ctrl.contextMenu.promise):e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!0,sizeColumnToFit:!0})},onDragStartCell:function(e,t){this.onDragStartCellDefault(e,t),e.dataTransfer.effectAllowed="copy";var n=o.ctrl.controller.files.treeDocument.getSelectedNodes();e.dataTransfer.setData("Text",JSON.stringify(o.app.make3DXContent(n))),e.dataTransfer.setData(("from"+widget.data.appId).toLowerCase(),"a")}}).inject(o.elements.container),this.ctrl.events.addEventListener("applySortModel",(function(e){o.datagridview.sortModel=e})),this.ctrl.events.addEventListener("enox-files-data-needs-sorting",(function(e){o.datagridview.reapplySortModel()})),console.log(o.datagridview.getCustomViewsManager().getCurrentCustomView()),o.datagridview.getCustomViewsManager().onCustomViewsSave=function(e,t){console.log(e),console.log(t)};o.datagridview.getTreeDocument().onNodeModelUpdate((function(e){var t="Document",n=e.data.attributes,i=e.data.attributes.comments,a=e.data.previousAttributes.comments;if(e.data.nodeModel._oldComment=a,e.data.nodeModel._newComment=i,i||a)if("Enabled"==o.ctrl.options.mandatoryCommentConfigSetting&&0==i.trim().length)e.data.nodeModel.updateOptions({grid:{comments:e.data.nodeModel._oldComment}}),o.ctrl.options.events.publish({event:"docv2-show-notification",data:{level:"warning",title:c.get("CommentFieldMandatory",{typeNLS:t}),subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}});else{var s=e.data.nodeModel.options.data.id,r=o.ctrl.e6wDocument.id;if(e.data.nodeModel._isUpdateInProgress)return;e.data.nodeModel._isFromFailure?e.data.nodeModel._isFromFailure?e.data.nodeModel._isFromFailure=!1:(e.data.nodeModel._isFromFailure=!0,e.data.nodeModel.updateOptions({grid:{comments:e.data.nodeModel._oldComment}}),o.ctrl.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:c.get("YouCannotUpdateX",{typeNLS:t}),subtitle:c.get("VerifyCredentials"),message:c.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}})):n&&!e.data.nodeModel._isFromFailure?(e.data.nodeModel._isFromFailure=!1,e.data.nodeModel._isUpdateInProgress=!0,o.ctrl.controller.data.updateAttributes(n,r,s,i).then((t=>{console.log(t),require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("docm-file-edited-in-document",{platformId:o.ctrl.options.platformServices.platformId,documentId:r,file:t.data[0]})})),e.data.nodeModel._isUpdateInProgress=!1})).catch((n=>{e.data.nodeModel._isFromFailure=!0,e.data.nodeModel._isUpdateInProgress=!1,e.data.nodeModel.updateOptions({grid:{comments:e.data.nodeModel._oldComment}}),o.ctrl.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:c.get("YouCannotUpdateX",{typeNLS:t}),subtitle:c.get("VerifyCredentials"),message:c.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}})}))):e.data.nodeModel._isFromFailure=!1}})),o.datagridview.registerReusableCellContent({id:"lockStatusCell",buildContent:function(){var t=new e.Element("div",{class:"wux-tweakers wux-tweakers-string-label lockStatus"}),n=e.createElement("span",{class:"fonticon fonticon-key reservations-key"}).inject(t);t.greenKey=n,t.greenKey.hide();var o=e.createElement("span",{class:"fonticon fonticon-lock reservations-lock"}).inject(t);t.redLock=o,t.redLock.hide();var i=e.createElement("div",{class:"singleUser"}).inject(t);return t.singleUser=i,t.singleUser.hide(),t}}),o.inject(n)}})})),define("DS/DocumentFiles/data/Data",["UWA/Core","UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/DocumentManagement/DocumentManagement","DS/DocumentFiles/utils/ExtensionUtils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(e,t,n,o,i,a,s){"use strict";return t.extend({init:function(e){this.ctrl=e},getFiles:function(t){var o=this;return new n((function(n,s){i.getDocuments([t],{tenant:o.ctrl.options.platformServices.platformId,securityContext:o.ctrl.options.fetchSecurityContext(),tenantUrl:o.ctrl.options.platformServices["3DSpace"],additionalURLParams:"$include=none,files,ownerInfo,lockerInfo&$fields=isDocumentType,all",onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;if(null!=e.data[0].dataelements.fileExtension){var i=e.data[0].dataelements.fileExtension.replace(".","");e.data[0].dataelements.typeicon=o.ctrl.options.platformServices["3DSpace"]+"/"+a.getIcon(i)}n({docId:t,files:e.data[0].relateddata.files,e6wDocument:e.data[0]})}else console.error("Data.GetFiles onComplete Failed",e),s(e)},onFailure:function(t){t.error?o.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t.error):e.is(t,"string")?o.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t):o.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES")),s(t)}})}))},getFile:function(t,i){var a=this;return new n((function(n,s){var r=encodeURIComponent(a.ctrl.options.fetchSecurityContext())??void 0,l=a.ctrl.options.platformServices["3DSpace"]+"/resources/v1/modeler/documents/"+t+"/files/"+i+"/";o.authenticatedRequest(l,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:r},onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;n({docId:t,files:e.data[0]})}else console.error("Data.GetFiles onComplete Failed",e),s(e)},onFailure:function(t){t.error?a.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t.error):e.is(t,"string")?a.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t):a.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES")),s(t)}})}))},generateFileThumbnail:function(t,i,a,s){var r=this;return new n((function(n,l){var c=encodeURIComponent(r.ctrl.options.fetchSecurityContext())??void 0,d=r.ctrl.options.platformServices["3DSpace"]+"/resources/v1/modeler/documents/generateFileThumbnail",m={id:t,fileId:i,title:a,format:s};o.authenticatedRequest(d,{method:"POST",type:"json",data:JSON.stringify(m),headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:c},onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;n({docId:t,files:e.data[0]})}else console.error("Data.GetFiles onComplete Failed",e),l(e)},onFailure:function(t){t.error?r.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t.error):e.is(t,"string")?r.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t):r.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES")),l(t)}})}))},getLatestCSRF:function(){var t=this;return new e.Promise((function(e,n){o.authenticatedRequest(t.ctrl.options.platformServices["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",onComplete:function(n){t.csrf=JSON.parse(n).csrf,e(t.csrf)},onFailure:function(e){console.warn("Failed to get CSRF"),n(e)}})}))},getHeaders:function(t){let n={},o=s.get();var i=e.is(o)&&e.is(o.change.id)?o.change.id:null;return n=""!=i?{SecurityContext:t,"DS-Change-Authoring-Context":"pid:"+i}:{SecurityContext:t},n},updateAttributeServiceCall:function(e,t,i,a,s){var r=this;return new n((function(e,n){var l=encodeURIComponent(r.ctrl.options.fetchSecurityContext())??void 0,c=r.ctrl.options.platformServices["3DSpace"]+"/resources/v1/modeler/documents/"+t+"/files/"+i+"/",d={csrf:s,data:[{id:i,dataelements:{comments:a,updateAction:"MODIFY"}}]};console.log(d),o.authenticatedRequest(c,{method:"PUT",type:"json",data:JSON.stringify(d),headers:r.getHeaders(l),onComplete:function(t){e(t)},onFailure:function(e){n(e)}})}))},updateAttributes:function(e,t,o,i){var a=this;return new n((function(n,s){a.getLatestCSRF().then((n=>a.updateAttributeServiceCall(e,t,o,i,n))).then((e=>{n(e)})).catch((e=>{console.log("Service Failed"),s(e)}))}))}})})),define("DS/DocumentFiles/data/Collection",["DS/TreeModel/TreeDocument","DS/TreeModel/BaseFilter","DS/DocumentFiles/data/Model"],(function(e,t,n){"use strict";return function(o){var i={ctrl:o,options:o.options,count:0,treeDocument:new e({useAsyncPreExpand:!0,shouldAcceptDrag:function(e,t){return!1},shouldAcceptDrop:function(e,t){return!0}}),sortModel:{sortAttribute:"modified",sort:"desc",dataIndex:"modified"},clear:function(){return i.treeDocument.removeRoots(),o.options.requestId=(new Date).getTime()},addFiles:function(e,t){i.treeDocument.prepareUpdate(),console.log(t+" Prepare Update");var a=[];return e.forEach((function(e){UWA.is(e.dataelements.title)?a.push(i.treeDocument.addRoot(new n(e,o.options))):console.error("unable to add file to list, since invalid",e)})),i.treeDocument.reapplyFilterModel(),i.treeDocument.pushUpdate(),console.log(t+" PushUpdate"),o.options.events.publish({event:"enox-files-data-needs-sorting"}),a},removeFilesByIds:function(e){i.treeDocument.getRoots().forEach((t=>{e.includes(t.options.data.id)&&setTimeout((()=>{t.remove()}),1)}))},reloadFileById:function(e,t){i.treeDocument.getRoots().forEach((n=>{e==n.options.data.id&&o.controller.data.getFile(o.parentId,e).then((function(e){n.options.updateData(e.files),t&&t()}))}))}},a=t.inherit({publishedProperties:{},isDataFiltered:function(e){if(this.filterModel&&this.filterModel.query){var t=this.filterModel.query.toLowerCase(),n=e.options.lowercase.label.contains(t),o=e.options.lowercase.comments.contains(t),i=!1;e.options.lowercase.owner&&(i=e.options.lowercase.owner.label.contains(t)||e.options.lowercase.owner.username.contains(t));var a=!1;return e.options.lowercase.locker&&(a=e.options.lowercase.locker.label.contains(t)||e.options.lowercase.locker.username.contains(t)),!(n||o||i||a)}return!1},isEmpty:function(){return!this.filterModel||void 0===this.filterModel.query}}),s=i.treeDocument.getFilterManager();return s.registerFilter("superFilter",a),i.treeDocument.setFilterModel({label:{filterId:"stringRegexp"},revision:{filterId:"numberWithCondition"},fileSize:{filterId:"number"},fileExtension:{filterId:"set"},lockStatus:{filterId:"set"},owner:{filterId:"set"},comments:{filterId:"stringRegexp"},originated:{filterId:"dateWithCondition"},modified:{filterId:"dateWithCondition"},superFilter:{filterId:"superFilter"}}),o.events.addEventListener("search-text-change",(function(e){console.log(e),UWA.is(e,"string")&&e.trim().length>0?s.setPropertyFilterModel("superFilter",{filterId:"superFilter",filterModel:{query:e}}):s.setPropertyFilterModel("superFilter",{filterId:"superFilter"})})),i.treeDocument.getModelEvents().subscribe({event:"addChild"},(function(e,t,n){i.count++,o.events.publish({event:"enox-files-collection-count-changed",data:i.count})})),i.treeDocument.getModelEvents().subscribe({event:"removeChild"},(function(e,t,n){i.count--,o.events.publish({event:"enox-files-collection-count-changed",data:i.count})})),o.options.events.subscribe({event:"enox-files-node-selection-add"},(function(e){var t=i.treeDocument.getSelectedNodes();o.options.events.publish({event:"enox-files-node-selection-changed",data:t})})),o.options.events.subscribe({event:"enox-files-node-selection-remove"},(function(e){i.treeDocument.getSelectedNodes();o.options.events.publish({event:"enox-files-node-selection-changed",data:i.treeDocument.getSelectedNodes()})})),i}})),define("DS/DocumentFiles/data/Controller",["UWA/Core","UWA/Class","UWA/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DocumentFiles/data/Collection","DS/DocumentFiles/data/Data","DS/DocumentFiles/utils/Helper","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","DS/DocumentCommonInfra/TrackerAPI"],(function(e,t,n,o,i,a,s,r,l,c){"use strict";return t.extend({init:function(t){var n=this;t.controller=this,this.ctrl=t,this.controller=this,this.files=new i(t),this.data=new a(t),this.helper=new s(t),this.ready=e.Promise.deferred(),this.getPlatformServicesPromise=new e.Promise((function(e,n){o.getPlatformServices({platformId:t.options.tenant,onComplete:function(n){console.log(n),n.length&&(console.error("getPlatformServices returned an array"),n=n[0]),t.options.platformServices=n,console.log("getPlatformServices resolved"),e(n)},onFailure:function(e){console.error("Failed to get platform services",e),n(e)}})})),this.getCurrentUserPromise=new e.Promise((function(e,n){o.getUser({platformId:t.options.tenant,onComplete:function(n){t.options.user=n,e(n)},onFailure:function(e){console.error("Failed to get current user for files",e),n(e)}})})),this.getJobsProcessorPromise=t.options.getJobsProcessorPromise||new e.Promise((function(e,t){var n={};window.widget&&window.widget.app&&window.widget.app.jobs&&"doco-jobs"==window.widget.app.jobs.name&&window.widget.app.progressPane&&"doco-progress"==window.widget.app.progressPane.name?(n=window.widget.app,e(n.jobs)):(console.warn("FileController had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],(function(t,o){null==n.jobs&&(n.jobs=new t(n)),null==n.progressPane&&(n.progressPane=new o(n),window.widget&&window.widget.body?n.progressPane.inject(window.widget.body):n.progressPane.inject(document.body)),e(n.jobs)})))})),e.Promise.all([this.getPlatformServicesPromise,this.getCurrentUserPromise,this.getJobsProcessorPromise]).then((function(e){var n={securityContext:t.options.fetchSecurityContext(),platformUrls:t.options.platformServices};return l.getcommentAsMandtoryConfigValue(n).promise})).then((e=>{t.options.mandatoryCommentConfigSetting=e,n.ready.resolve(!0);var o=new Date-window.filesPaneLoadStart;c.sendTrackerPageEvent({category:"docm.filesPane.ready",action:"click",label:"Document Filespane Ready",pd:{},pv:{totalTimeTaken:o}})})),this.view=this.helper.loadViewMode()},loadFiles:function(){var e=new Date,t=-1,n={},o=this;this.ready.promise.then((function(){o.data.getFiles(o.ctrl.parentId).then((function(e){e.files&&(n.fileExtensions=e.files.map((e=>r.getFileExtension(e.dataelements.title)))),t=1,n.numberOfFiles=e.files.length,n.docId=e.docId,n.type=e.e6wDocument.type,o.ctrl.parentId==e.docId&&(o.files.addFiles(e.files,"Files Facet"),o.ctrl.e6wDocument=e.e6wDocument)}),(function(){t=0})).finally((function(){o.ctrl.finishLoading();var i=new Date-e;c.sendTrackerPageEvent({category:"docm.files.ready",action:"auto",label:"Document Files Ready",pd:{docId:n.docId,docType:n.type,fileExtensions:n.fileExtensions},pv:{totalTimeTaken:i,status:t,numOfFiles:n.numberOfFiles}})}))}))},clearAll:function(){this.files.clear()},switchView:function(e){this.files.count>0?"grid"==e?(this.ctrl.tilePane.hide(),this.ctrl.uploadPane.hide(),this.ctrl.gridPane.show(),this.view=e,this.helper.saveViewMode(e)):"tile"!=e&&null!=e||(this.ctrl.uploadPane.hide(),this.ctrl.gridPane.hide(),this.ctrl.tilePane.show(),this.view="tile",this.helper.saveViewMode(this.view)):("grid"!=e&&"tile"!=e||(this.view=e,this.helper.saveViewMode(this.view)),this.ctrl.gridPane.hide(),this.ctrl.tilePane.hide(),this.ctrl.uploadPane.show())}})})),define("DS/DocumentFiles/utils/DnDManager",["UWA/Core","DS/DataDragAndDrop/DataDragAndDrop","DS/DocumentCommonInfra/components/UploadFileDialog","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","DS/DocumentFiles/data/Controller"],(function(e,t,n,o,i){"use strict";return function(e){var n={init:function(e){this.ctrl=e;var o=e.uploadPane.elements.container,i=e.gridPane.elements.container,a=e.getClassNames("-drag-over"),s={drop:function(t,o,i){e.options.readonly||(e.elements.content.removeClassName(a),n.handleDrop(i))},enter:function(t,n){e.options.readonly||e.elements.content.addClassName(a)},over:function(t,n){e.options.readonly||e.elements.content.addClassName(a)},leave:function(t,n){e.options.readonly||e.elements.content.removeClassName(a)}};t.droppable(o,s),t.droppable(i,s),e.dndManager=this},handleDrop:function(t){e.options.readonly||t.dataTransfer.files&&t.dataTransfer.files.length>0&&e.events.publish({event:"user-dropped-files",data:{cancelled:!1,files:t.dataTransfer.files}})}};return n.init(e),n}})),define("DS/DocumentFiles/FilesPane",["UWA/Core","UWA/Promise","DS/CoreEvents/ModelEvents","DS/DocumentFiles/data/Controller","DS/DocumentFiles/views/Topbar","DS/DocumentFiles/views/UploadPane","DS/DocumentFiles/views/GridPane","DS/DocumentFiles/views/TilePane","DS/DocumentFiles/ContextMenu","DS/DocumentFiles/FilesEvents","DS/DocumentFiles/utils/DnDManager","DS/Controls/Loader","DS/Controls/ModalContainer","css!DS/DocumentFiles/DocumentFiles.css"],(function(e,t,n,o,i,a,s,r,l,c,d,m,u){"use strict";return e.Controls.Abstract.extend({name:"enox-documentfiles",options:{className:""},_options:{},modelEvents:void 0,init:function(e){this.inputFiles=e.files,this.events=e.events||new n,delete e.events,this._parent(e),this.options.events=this.events,e.events=this.events,this.events._pubsub._spyEvents=function(e,t){widget&&widget.showEventLogs&&console.log("ENOXFiles:",e,t,this)},this.buildSkeleton()},buildSkeleton:function(){var t=this;this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.elements.container.dsModel=this,this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.loader=new m,this.startLoading(),new o(this),this.controller.ready.promise.then((function(){new i(t).build(t.elements.content),t.buildContentPanes(),t.contextMenu=new l(t),new c(t).connect(t.controller,t.toolbar,t.contextMenu)}))},buildContentPanes:function(){this.elements.panes=e.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new a(this).build(this.elements.panes),new s(this).build(this.elements.panes),new r(this).build(this.elements.panes),new d(this)},initialize:function(){var e=[];if(this.inputFiles)for(let t=0;t<this.inputFiles.length;t++)e.push(this.inputFiles[t]);this.controller.showPreselectedFiles(e)},setParentId:function(e){this.parentId=e,this.startLoading(),this.controller.clearAll(),this.controller.loadFiles(),this.events.publish({event:"enox-files-parent-changed"})},getParentId:function(){return this.parentId},startLoading:function(){this.loader.on(),u.createModal(this.elements.container,this.loader.elements.container)},finishLoading:function(){this.loader.off(),u.removeModal(this.elements.container)}})})),define("DS/DocumentFiles/FilesFacet",["UWA/Core","UWA/Class","DS/EditPropWidget/facets/Common/FacetsBase","DS/DocumentFiles/FilesPane","DS/CoreEvents/ModelEvents"],(function(e,t,n,o,i){return t.extend(n,{init:function(e){window.filesPaneLoadStart=new Date,this._parent(e),this.options.events=new i,this.componentRefresh=!1,this.buildView(e)},buildView:function(t){var n=this;this.elements.container=e.createElement("div",{class:"files"});var i=n.getModel();n.registerFacetEvents(),console.log(i),n.filesPane=new o(n.makefilePaneOptions(t)),n.filesPane.inject(n.elements.container)},makefilePaneOptions:function(e){return{events:this.options.events,fetchSecurityContext:function(){return e.context&&e.context.getSecurityContext()?e.context.getSecurityContext().SecurityContext:null!=e.securityContextFromAppPreference&&null!=e.securityContextFromAppPreference?e.securityContextFromAppPreference:void console.error("getSecurityContext undefined. this cannot be. this needs to be corrected")},tenant:e.tenant}},updateFacet:function(){this.selectionModified(this.getModel().get("objectId"))},registerFacetEvents:function(){var e=this;this.options.events.addEventListener("enox-file-launch-preview",(function(t){console.log(e),e.filesPane.toolbar.publicDocumentCommands.commands.Preview.execute(t.nodeModel)}))},selectionModified:function(e){e&&(this.filesPane&&this.filesPane.getParentId()!==e&&this.filesPane.setParentId(e),this.componentRefresh=!0)},onResize:function(){},onRefresh:function(){}})}));