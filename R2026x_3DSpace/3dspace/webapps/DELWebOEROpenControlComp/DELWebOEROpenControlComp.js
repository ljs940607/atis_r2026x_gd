define("DS/DELWebOEROpenControlComp/helper/ContextHelper",[],(function(){"use strict";const e={getMfgContext:function(t,o,i){var n={context:[],ids:[]},r={},l=e.getProcessContext(t,o);if(l&&l.context)for(let e of l.context)if(e.scope===i&&e.implementedScope){n.context=e.implementedScope,e.implementedScope.forEach((e=>{r[e.id]||(r[e.id]=!0,n.ids.push(e.id))}));break}return n},getMfgInstallContext:function(t,o,i,n){var r={context:[],ids:[]},l=e.getMfgContext(t,o,i);if(l&&l.context)for(let e of l.context)n===e.id&&UWA.is(e.context,"array")&&(r.context=e.context,e.context.forEach((e=>{-1===r.ids.indexOf(e.parent)&&r.ids.push(e.parent)})));return r},getMfgInstallOccurrences:function(t,o,i,n){var r={context:[],ids:[]},l=e.getMfgContext(t,o,i);if(l)for(let e of l.context)n===e.id&&e.context&&(r.context=e.context,r.ids=r.ids.concat(e.context.map((e=>`${e.parent}_${e.instance}_${n}`))));return r},getMfgInstallOccurrencesForContext:function(t,o,i,n,r){var l=e.getMfgInstallOccurrences(t,o,i,n);return l.context=l.context.filter((e=>e.parent===r)),l.ids=l.ids.filter((e=>e.includes(r))),l},getProcessContext:function(t,o){var i={context:[],ids:[]},n=e.getContextScope(t,o);return n&&(i.context=n,i.ids=n.map((e=>e.scope))),i},getProcessContextOccurrences:function(t,o,i){var n={context:[],ids:[]},r=e.getProcessContext(t,o);if(r&&r.context)for(let e of r.context)if(e.scope===i){n.context=r.context,n.ids=e.contextOccurrence.slice();break}return n},getContextScope:function(e,t){var o,i;return e&&UWA.is(e.member,"array")&&t&&e.member.forEach((e=>{(i=e.find((function(e){return e.refid===t})))&&(o=i.contextScope)})),o},getAllPhysicalIds:function(t,o){var i=o?[o]:[],n=e.getContextScope(t,o);return n&&n.forEach((e=>{i.push(e.scope),e.contextOccurrence&&e.contextOccurrence.forEach((e=>{i=i.concat(e.split("_"))})),e.implementedScope&&e.implementedScope.forEach((e=>{i.push(e.id),e.context&&e.context.forEach((e=>{i.push(e.parent),i.push(e.instance)}))}))})),i},getInstallInstanceIds:function(t,o){var i=[],n=e.getContextScope(t,o);return n&&n.forEach((e=>{e.implementedScope&&e.implementedScope.forEach((e=>{e.context&&e.context.forEach((e=>{i.push(e.instance)}))}))})),i}};return e})),define("DS/DELWebOEROpenControlComp/commands/DELWebOERFilterCommand",["UWA/Core","DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/Logger/Logger","DS/DELWebOERCommonUtils/utils/XSOManager","DS/DELWebOERCommonUtils/utils/NodeUtils"],(function(e,t,o,i,n){"use strict";return t.extend({name:"DELWebOERFilterCommand",logger:o.getLogger("DS/DELWebOEROpenControlComp/commands/DELWebOERFilterCommand"),init:function(e={}){this.ec=e.executionContext,e.args&&(this.roots=e.args.items,this.NGFUXId=e.args.NGFUXId)},getAppParams:function(){let e=this.ec.getComponent("Viewer");var t=this.ec.getComponent("DELCommonUtilsServices");return{widgetId:t.getWidgetId(),appId:t.getAppId(),NGFUXId:this.NGFUXId?this.NGFUXId:e.getNGFUXID(),shareFilterSpec:!0}},getRoots:function(){let e=this.roots;if(!this.roots){e=this.ec.getComponent("Viewer").getRoots(),e&&e.length>0&&(e=e.map((e=>({id:e.getModelIdentification(),filtered:!1}))))}return e},getSelectorManager:function(){return i.getCSO()},getSelection:function(){var e=i.getCSO().get()||[],t=[];return e.forEach((e=>{t.push(n.getRirPath(e))})),{path:t}},beginExecute:function(){this.execute(),this.done()},endExecute:function(){this._parent()}})})),define("DS/DELWebOEROpenControlComp/form/FormDocument",["DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],(function(e,t){"use strict";var o=function(...t){e.apply(this,t)};return(o.prototype=Object.create(e.prototype)).constructor=o,o.prototype.removeRootNode=function(e){let t,o=this.getRoots();o&&o.length>0&&(t=o.find((function(t){return t.options.fieldId===e})),t&&this.removeRoot(t))},o.prototype.createRootNode=function(e,o){var i=new t({label:o?o.label:null,fieldId:e,grid:{className:"oer-form-expander"}});return this.removeRootNode(e),this.addRoot(i),i},o.prototype.getFieldNode=function(e){let t,o=this.search({match:function(t){if(e&&t.nodeModel.options.fieldId===e)return!0}});return o&&o.length>0&&(t=o.find((t=>t.options.fieldId===e))),t},o.prototype.createFieldNode=function(e,o,i){var n,r,l={label:o?o.label:null,fieldId:e,grid:{value:void 0,fieldValue:"",typeRepresentation:"string",semantics:{}}},s=o?o.possibleValues:[];return s&&(1===s.length&&UWA.merge(l.grid,s[0]),l.grid.semantics=function(e){return e&&e.length>1?{possibleValues:e,displayStyle:"combo",allowResetToUndefinedByUIFlag:!0}:{possibleValues:e,displayStyle:"combo",disabled:!0}}(s)),this.removeFieldNode(e),r=new t(l),i&&((n=this.getRoots().find((e=>e&&e.options&&e.options.fieldId===i))).addChild(r),n.expandAll()),r},o.prototype.removeFieldNode=function(e){var t,o=this.getFieldNode(e);o&&(t=o.getParent())&&t.removeChild(o)},o.prototype.updateAttribute=function(e,t,o){let i=this.getFieldNode(e);i&&i.setAttribute(t,o)},o.prototype.disableField=function(e){let t=this.getFieldNode(e);if(t){let e=t.getAttributeValue("semantics");e&&(e.disabled=!0,t.setAttribute("semantics",e))}},o})),define("DS/DELWebOEROpenControlComp/form/ProcessFormV3",["DS/Controls/Button","DS/DELWebCommonControls/FormV3","DS/WUXAutoComplete/AutoComplete","DS/DELWebOERCommonUtils/utils/CommonUtils","DS/TreeModel/TreeDocument","DS/Controls/Toggle","DS/Controls/ButtonGroup","text!DS/DELWebOEROpenControlComp/assets/json/ConstantsV3.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp","css!DS/DELWebOEROpenControlComp/assets/css/OpenControl.css"],((e,t,o,i,n,r,l,s,a)=>{"use strict";const c=JSON.parse(s);function d(t,s){this._options=s||{},this._tokens=[],this._model=t,this._modelEvents=s.modelEvents,this._openButton=new e({onClick:(...e)=>{s.onOpen&&s.onOpen.apply(s,e)}}),this._cancelButton=new e({onClick:(...e)=>{s.onCancel&&s.onCancel.apply(s,e)}}),this._fieldIdMap={},Object.keys(c.AccordeonContent).forEach((t=>{this._fieldIdMap[t]={},this._fieldIdMap[t].model=new n(this._getModelOptions.call(this,t));let d=this._fieldIdMap[t].model,p={elementsTree:d,placeholder:a.get("PlaceHolder."+t+".Title"),...c.AccordeonContent[t].AutoComplete,columnOptions:{getCellClassName:function(e){if(d&&d.options&&d.options.shouldBeSelected&&!d.options.shouldBeSelected(e.nodeModel))return"del-form-autocomplete-disable-cell"}}};this._fieldIdMap[t].control=new o(p),this._fieldIdMap[t].content=new UWA.Element("div",{class:"del-accordeon-content"});let u=new UWA.Element("div",{class:s.filter?"del-autocomplete-container-with-filter":"del-autocomplete-container-without-filter"}).inject(this._fieldIdMap[t].content);if(this._fieldIdMap[t].control.inject(u),s.filter){this.buttonGroup=new l({type:"checkbox"}),this.implicitFilteringToggle=new r({type:"switch",label:a.get("Form.ImplicitFiltering.Title"),value:!0,checkFlag:!1}),this.implicitFilteringToggle.disabled=!0,this.buttonGroup.addChild(this.implicitFilteringToggle);let o=new UWA.Element("div",{class:"del-filterbutton-container"}).inject(this._fieldIdMap[t].content);this._fieldIdMap[t].filterButton=new e({icon:{iconPath:i.getAssetsUrl("DELWebOEROpenControlComp","icons/22/I_FilterCommand.png")}}).inject(o),this._fieldIdMap[t].filterButton.disabled=!0;let n=this;this._fieldIdMap[t].filterButton.addEventListener("buttonclick",(function(){n._modelEvents.publish({event:`on${t}FilterSelect`,data:{data:t,origin:"FormHelper"}})}))}})),this._formOptions={identifier:"oer-process-form",formOptions:{buttonGroup:this.buttonGroup,accordeon:{items:[{header:a.get("Form.Process.Expander.Title"),content:this._fieldIdMap.ProcessContext.content},{header:a.get("Form.Mfg.Expander.Title"),content:this._fieldIdMap.MfgScopedItem.content},{header:a.get("Form.Resource.Expander.Title"),content:this._fieldIdMap.Resource.content}],style:"simple",exclusive:!1}},dialogOptions:{title:a.get("Dialog.Process.Title"),position:{my:"bottom",at:"center",offsetY:-100},buttons:{Open:this._openButton,Cancel:this._cancelButton}},frameContainer:s.container},!0===this._options.defaultShow&&this._createForm(),this._subscribeEvents()}return d.prototype._getModelOptions=function(){return{shouldBeSelected:function(e){let t=!0;return!0===e.getAttributeValue("disabled")&&(t=!1),t}}},d.prototype._subscribeEvents=function(){let e=this;[{event:"onGetFieldValue",handler:e._onGetFieldValue},{event:"onFilterApplied",handler:e._onFilterApplied},{event:"onFilterRemoved",handler:e._onFilterRemoved},{event:"onFilterCancelled",handler:e._onFilterCancelled},{event:"onFormComplete",handler:()=>{e._openButton.disabled=!1}},{event:"onFormClean",handler:e.destroy}].forEach((t=>{e._tokens.push(e._modelEvents.subscribe({event:t.event},t.handler.bind(e)))}))},d.prototype._addFormListener=function(){let e=this;e._processForm.addEventListener("onClose",e._options.onCancel),Object.keys(c.AccordeonContent).forEach((function(t){e._autoCompleteControlEventListner.addListeners.call(e,e._fieldIdMap[t].control,t),e._autoCompleteModelEventListners.addListeners.call(e,e._fieldIdMap[t].model)}))},d.prototype._removeFormListener=function(){let e=this;this._processForm&&(this._processForm.removeEventListener("onClose",this._options.onCancel),Object.keys(c.AccordeonContent).forEach((function(t){e._autoCompleteControlEventListner.removeListeners.call(e,e._fieldIdMap[t].control,t),e._autoCompleteModelEventListners.removeListeners.call(e,e._fieldIdMap[t].model)})))},d.prototype._getPossibleValues=function(e){var t=[],o={};if(e&&e.length>0){let i=t;e.forEach((e=>{let n=e?e.split(c.Context.delimeter):[];for(let e=0;e<n.length;e+=2){let t={},r=n[e],l=n[e-1];t.label=l?`${this._getAttributeValue(r,c.Attributes.label)} (${this._getAttributeValue(l,c.Attributes.label)})`:`${this._getAttributeValue(r,c.Attributes.label)}`,t.value=this._getAttributeValue(r,c.Attributes.label),t.fieldValue=n.slice(0,e+1),t.icon=this._getAttributeValue(r,c.Attributes.iconUrl),t.children=[],o[t.label]?i=o[t.label].children:(o[t.label]=t,i.push(t)),i=o[t.label].children}i=t}))}return t},d.prototype._setFilterButtonState=function(e,t,o){if(this._fieldIdMap[e]&&this._fieldIdMap[e].filterButton){if(UWA.is(t,"boolean")){let o=this._fieldIdMap[e].filterButton.getContent();!0===t?o.addClassName("del-filter-button-active"):o.removeClassName("del-filter-button-active")}UWA.is(o,"boolean")&&(this._fieldIdMap[e].filterButton.disabled=!o)}},d.prototype._toggleFilterButton=function(e,t){if(this._fieldIdMap[e]&&this._fieldIdMap[e].filterButton){let o=this._fieldIdMap[e].filterButton.getContent();!0===t?o.addClassName("del-filter-button-active"):o.removeClassName("del-filter-button-active")}},d.prototype._onFilterApplied=function(e){let t=this;e&&e.data&&e.data.fieldId&&(t._fieldIdMap[e.data.fieldId].control.disabled=!0,this._setFilterButtonState(e.data.fieldId,!0))},d.prototype._onFilterRemoved=function(e){let t=this;if(e&&e.data&&e.data.fieldId){let o=t._getLeafNodes(t._fieldIdMap[e.data.fieldId].model);UWA.is(o,"array")&&o>1&&(t._fieldIdMap[e.data.fieldId].control.disabled=!1),this._setFilterButtonState(e.data.fieldId,!1)}},d.prototype._onFilterCancelled=function(e){},d.prototype._getAttributeValue=function(e,t){var o=this._model.get("attributesMap");return o&&o[e]?o[e][t]:{}},d.prototype._triggerSelect=function(e,t){this._modelEvents.publish({event:`on${e}Select`,data:{data:t,origin:"FormHelper"}})},d.prototype._autoCompleteControlEventListner=function(){let e=function(e,t,o){let i=this._fieldIdMap[t].model.getSelectedNodes();i.length>0&&this._triggerSelect(t,i.map((e=>e.options.fieldValue)))},t=function(e,t,o){},o=function(e,t,o){let i=this._fieldIdMap[t].model&&this._fieldIdMap[t].model.getSelectedNodes?this._fieldIdMap[t].model.getSelectedNodes():null;i&&0===i.length?(this._openButton.disabled=!0,this._setFilterButtonState(t,null,!1),this._triggerSelect(t,i.map((e=>e.options.fieldValue)))):this._setFilterButtonState(t,null,!0)};return{addListeners:function(i,n,r){i.addEventListener("show",t.bind(this,i,n,r)),i.addEventListener("hide",e.bind(this,i,n,r)),i.addEventListener("change",o.bind(this,i,n,r))},removeListeners:function(i,n,r){i.removeEventListener("show",t.bind(this,i,n,r)),i.removeEventListener("hide",e.bind(this,i,n,r)),i.removeEventListener("change",o.bind(this,i,n,r))}}}(),d.prototype._autoCompleteModelEventListners=function(){let e=[],t=function(e){let t=function e(t){t&&t.getChildren&&t.getChildren().length>0?(t.setAttribute("disabled",!0),t.getChildren().forEach(e)):t.setAttribute("disabled",!1)};if(e&&e.getRoots){e.getRoots().forEach(t)}},o=function(e){let o=e.getXSO().get(),i=function e(t){t.setAttribute("disabled",!0),t.getChildren().length>0&&t.getChildren().forEach(e)};o&&o.length>0?o.forEach((e=>{if(e.isRoot())e.getBrothers().length>0&&e.getBrothers().forEach((e=>{i(e)}));else{let t=e.getParent();t.setAttribute("disabled",!0);let o=t.getBrothers&&t.getBrothers()||[];o&&o.length>0&&o.forEach((e=>{i(e)}))}})):t(e)};return{addListeners:function(t){e.push(t.getXSO().onPostAdd(o.bind(this,t))),e.push(t.getXSO().onPostRemove(o.bind(this,t)))},removeListeners:function(t){let o=t.getXSO();e.length>0&&(e.forEach((e=>{o&&o.unsubscribe&&o.unsubscribe(e)})),e=[])},setInitialDisableState:t}}(),d.prototype._createForm=function(){if(!this._processForm){this._processForm=new t(this._formOptions),this._openButton.disabled=!0;let e=this._processForm.getAccordeon();Object.keys(c.AccordeonContent).forEach(((t,o)=>e.expandItem(o))),this._addFormListener(),this._modelEvents.publish({event:"onProcessFormDisplayed",data:{data:{state:!0},origin:"FormHelper"}})}},d.prototype._getLeafNodes=function(e){let t=[],o=function e(o){if(o&&o.getChildren&&0===o.getChildren().length)return void t.push(o);(o&&o.getChildren?o.getChildren():[]).forEach(e)};if(e&&e.getRoots){e.getRoots().forEach((e=>{o(e)}))}return t},d.prototype._onGetFieldValue=function(e){let t=this,{fieldId:o,ids:i,idsToSelect:n,filterActivated:r}=e&&e.data?e.data:{},l=this._model.get("fieldToValuesMap"),s=function(e,t){let o,i=t.split("_"),n=function e(t){if(t&&t.options.fieldValue.toString()===i.toString())return void(o=t);(t&&t.getChildren?t.getChildren():[]).forEach(e)};if(e&&e.getRoots){e.getRoots().forEach((e=>{n(e)}))}return o};t._setFilterButtonState(o,!0===r),l||(l={},t._model.set("fieldToValuesMap",l)),i&&i.length>0?(l[o]=t._getPossibleValues(i),function(e){if(Object.keys(c.AccordeonContent).indexOf(e)>-1){let o=t._fieldIdMap[e].model,i=t._fieldIdMap[e].control;o.prepareUpdate(),o.empty(),o.pushUpdate();let r=t._model.get("fieldToValuesMap")[e];if(UWA.is(r,"array")){o.prepareUpdate(),o.loadModel(r),o.expandAll(),o.pushUpdate();let l=t._getLeafNodes(o);if(1===l.length)i.selectedItems=l[0],i.disabled=!0;else{if(UWA.is(n,"array")&&n.length>0){let r=[];n.forEach((e=>{let t=s(o,e);t&&r.push(t)})),r.length>0&&(i.selectedItems=r,t._triggerSelect(e,r.map((e=>e.options.fieldValue))))}i.disabled=!1}t._autoCompleteModelEventListners.setInitialDisableState(o)}}}(o),i.length>1&&t._createForm(),1===i.length&&t._triggerSelect(o,[i[0].split(c.Context.delimeter)])):(this._fieldIdMap[o].model.prepareUpdate(),this._fieldIdMap[o].model.empty(),this._fieldIdMap[o].model.pushUpdate(),this._fieldIdMap[o].control.selectedItems=[],this._fieldIdMap[o].control.disabled=!0)},d.prototype.isVisible=function(){return!!this._processForm},d.prototype.toggleProcessFilterVisibility=function(e){if(this._fieldIdMap[c.Fields.ProcessContext]&&this._fieldIdMap[c.Fields.ProcessContext].filterButton){let t=this._fieldIdMap[c.Fields.ProcessContext].filterButton;!0===e?t.show():t.hide()}this.implicitFilteringToggle&&(this.implicitFilteringToggle.checkFlag=!e)},d.prototype.destroy=function(){this._removeFormListener(),Object.keys(c.AccordeonContent).forEach((e=>{this._fieldIdMap[e].model.destroy(),this._fieldIdMap[e].control.destroy()})),this._fieldIdMap={};let e=this._modelEvents;this._tokens.forEach(e.unsubscribe),this._processForm&&this._processForm.destroy()},d})),define("DS/DELWebOEROpenControlComp/form/ProcessFormV2",["DS/Controls/Button","DS/DELWebCommonControls/FormV2","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","text!DS/DELWebOEROpenControlComp/assets/json/ConstantsV2.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp","css!DS/DELWebOEROpenControlComp/assets/css/OpenControl.css"],((e,t,o,i,n,r)=>{"use strict";const l=JSON.parse(n);function s(t,n){this._options=n||{},this._tokens=[],this._model=t,this._modelEvents=n.modelEvents,this._openButton=new e({onClick:(...e)=>{n.onOpen&&n.onOpen.apply(n,e)}}),this._cancelButton=new e({onClick:(...e)=>{n.onCancel&&n.onCancel.apply(n,e)}}),this._fieldIdMap={},Object.keys(l.AccordeonContent).forEach((e=>{this._fieldIdMap[e]={},this._fieldIdMap[e].model=new i(this._getModelOptions.call(this,e));let t=this._fieldIdMap[e].model,n={elementsTree:t,placeholder:r.get("PlaceHolder."+e+".Title"),...l.AccordeonContent[e].AutoComplete,columnOptions:{getCellClassName:function(e){if(t&&t.options&&t.options.shouldBeSelected&&!t.options.shouldBeSelected(e.nodeModel))return"del-form-autocomplete-disable-cell"}}};this._fieldIdMap[e].control=new o(n)})),this._formOptions={identifier:"oer-process-form",formOptions:{items:[{header:r.get("Form.Process.Expander.Title"),content:this._fieldIdMap.ProcessContext.control},{header:r.get("Form.Mfg.Expander.Title"),content:this._fieldIdMap.MfgScopedItem.control}],style:"simple",exclusive:!1},dialogOptions:{title:r.get("Dialog.Process.Title"),position:{my:"bottom",at:"center",offsetY:-100},buttons:{Open:this._openButton,Cancel:this._cancelButton}},frameContainer:n.container},this._subscribeEvents()}return s.prototype._getModelOptions=function(){return{shouldBeSelected:function(e){let t=!0;return!0===e.getAttributeValue("disabled")&&(t=!1),t}}},s.prototype._subscribeEvents=function(){let e=this;[{event:"onGetFieldValue",handler:e._onGetFieldValue},{event:"onFilterApplied",handler:e._onFilterApplied},{event:"onFilterCancelled",handler:e._onFilterCancelled},{event:"onFormComplete",handler:()=>{e._openButton.disabled=!1}},{event:"onFormClean",handler:e.destroy}].forEach((t=>{e._tokens.push(e._modelEvents.subscribe({event:t.event},t.handler.bind(e)))}))},s.prototype._addFormListener=function(){let e=this;e._processForm.addEventListener("onClose",e._options.onCancel),Object.keys(l.AccordeonContent).forEach((function(t){e._autoCompleteControlEventListner.addListeners.call(e,e._fieldIdMap[t].control,t),e._autoCompleteModelEventListners.addListeners.call(e,e._fieldIdMap[t].model)}))},s.prototype._removeFormListener=function(){let e=this;this._processForm&&(this._processForm.removeEventListener("onClose",this._options.onCancel),Object.keys(l.AccordeonContent).forEach((function(t){e._autoCompleteControlEventListner.removeListeners.call(e,e._fieldIdMap[t].control,t),e._autoCompleteModelEventListners.removeListeners.call(e,e._fieldIdMap[t].model)})))},s.prototype._getPossibleValues=function(e){var t=[],o={};if(e&&e.length>0){let i=t;e.forEach((e=>{let n=e?e.split(l.Context.delimeter):[];for(let e=0;e<n.length;e+=2){let t={},r=n[e],s=n[e-1];t.label=s?`${this._getAttributeValue(r,l.Attributes.label)} (${this._getAttributeValue(s,l.Attributes.label)})`:`${this._getAttributeValue(r,l.Attributes.label)}`,t.value=this._getAttributeValue(r,l.Attributes.label),t.fieldValue=n.slice(0,e+1),t.icon=this._getAttributeValue(r,l.Attributes.iconUrl),t.children=[],o[t.label]?i=o[t.label].children:(o[t.label]=t,i.push(t)),i=o[t.label].children}i=t}))}return t},s.prototype._onFilterApplied=function(e){let t=this;Object.keys(l.AccordeonContent).forEach((function(e){t._fieldIdMap[e].control.disabled=!0}))},s.prototype._onFilterCancelled=function(e){},s.prototype._getAttributeValue=function(e,t){var o=this._model.get("attributesMap");return o&&o[e]?o[e][t]:{}},s.prototype._autoCompleteControlEventListner=function(){const e="MfgScopedItem";let t=function(e,t,o){let i=this._fieldIdMap[t].model.getSelectedNodes();i.length>0&&this._modelEvents.publish({event:`on${t}Select`,data:{data:i.map((e=>e.options.fieldValue)),origin:"FormHelper"}})},o=function(e,t,o){},i=function(t,o,i){let n=this._fieldIdMap[o].model&&this._fieldIdMap[o].model.getSelectedNodes?this._fieldIdMap[o].model.getSelectedNodes():null;n&&0===n.length&&(this._openButton.disabled=!0,"ProcessContext"===o&&this._fieldIdMap[e].model&&(this._fieldIdMap[e].model.prepareUpdate(),this._fieldIdMap[e].model.empty(),this._fieldIdMap[e].model.pushUpdate(),this._fieldIdMap[e].control.disabled=!1))};return{addListeners:function(e,n,r){e.addEventListener("show",o.bind(this,e,n,r)),e.addEventListener("hide",t.bind(this,e,n,r)),e.addEventListener("change",i.bind(this,e,n,r))},removeListeners:function(e,n,r){e.removeEventListener("show",o.bind(this,e,n,r)),e.removeEventListener("hide",t.bind(this,e,n,r)),e.removeEventListener("change",i.bind(this,e,n,r))}}}(),s.prototype._autoCompleteModelEventListners=function(){let e=[],t=function(e){let t=function e(t){t&&t.getChildren&&t.getChildren().length>0?(t.setAttribute("disabled",!0),t.getChildren().forEach(e)):t.setAttribute("disabled",!1)};if(e&&e.getRoots){e.getRoots().forEach(t)}},o=function(e){let o=e.getXSO().get(),i=function e(t){t.setAttribute("disabled",!0),t.getChildren().length>0&&t.getChildren().forEach(e)};o&&o.length>0?o.forEach((e=>{if(e.isRoot())e.getBrothers().length>0&&e.getBrothers().forEach((e=>{i(e)}));else{let t=e.getParent();t.setAttribute("disabled",!0);let o=t.getBrothers&&t.getBrothers()||[];o&&o.length>0&&o.forEach((e=>{i(e)}))}})):t(e)};return{addListeners:function(t){e.push(t.getXSO().onPostAdd(o.bind(this,t))),e.push(t.getXSO().onPostRemove(o.bind(this,t)))},removeListeners:function(t){let o=t.getXSO();e.length>0&&(e.forEach((e=>{o&&o.unsubscribe&&o.unsubscribe(e)})),e=[])},setInitialDisableState:t}}(),s.prototype._onGetFieldValue=function(e){let o=this,{fieldId:i,ids:n}=e&&e.data?e.data:{},r=this._model.get("fieldToValuesMap"),s=function(e){let t=[],o=function e(o){if(o&&o.getChildren&&0===o.getChildren().length)return void t.push(o);(o&&o.getChildren?o.getChildren():[]).forEach(e)};if(e&&e.getRoots){e.getRoots().forEach((e=>{o(e)}))}return t};r||(r={},o._model.set("fieldToValuesMap",r)),n&&n.length>0&&(r[i]=o._getPossibleValues(n),function(e){if(Object.keys(l.AccordeonContent).indexOf(e)>-1){let t=o._fieldIdMap[e].model,i=o._fieldIdMap[e].control;t.prepareUpdate(),t.empty(),t.pushUpdate();let n=o._model.get("fieldToValuesMap")[e];if(UWA.is(n,"array")){t.prepareUpdate(),t.loadModel(n),t.expandAll(),t.pushUpdate();let e=s(t);1===e.length?(i.selectedItems=e[0],i.disabled=!0):i.disabled=!1,o._autoCompleteModelEventListners.setInitialDisableState(t)}}}(i),n.length>1&&function(){if(!o._processForm){o._processForm=new t(o._formOptions),o._openButton.disabled=!0;let e=o._processForm.getAccordeon();Object.keys(l.AccordeonContent).forEach(((t,o)=>e.expandItem(o))),o._addFormListener(),o._modelEvents.publish({event:"onProcessFormDisplayed",data:{data:{state:!0},origin:"FormHelper"}})}}(),1===n.length&&o._modelEvents.publish({event:`on${i}Select`,data:{data:[n[0].split(l.Context.delimeter)],origin:"FormHelper"}}))},s.prototype.isVisible=function(){return!!this._processForm},s.prototype.destroy=function(){this._removeFormListener(),Object.keys(l.AccordeonContent).forEach((e=>{this._fieldIdMap[e].model.destroy(),this._fieldIdMap[e].control.destroy()})),this._fieldIdMap={};let e=this._modelEvents;this._tokens.forEach(e.unsubscribe),this._processForm&&this._processForm.destroy()},s})),define("DS/DELWebOEROpenControlComp/helper/ContextHelperV3",[],(function(){"use strict";const e="ImplicitFilteringWithTransientFlow",t="ImplicitFilteringWithoutTransientFlow",o={getMfgContext:function(e,t,i){var n={context:[],ids:[]},r={},l=o.getProcessContext(e,t);if(l&&l.context)for(let e of l.context)if(e.scope===i&&e.implementedScope){n.context=e.implementedScope,e.implementedScope.forEach((e=>{r[e.id]||(r[e.id]=!0,n.ids.push(e.id))}));break}return n},getResourceContext:function(e,t,i){var n={context:[],ids:[]},r={},l=o.getProcessContext(e,t);if(l&&l.context)for(let e of l.context)if(e.scope===i&&e.resource){n.context=e.resource,e.resource.forEach((e=>{r[e.id]||(r[e.id]=!0,n.ids.push(e.id))}));break}return n},getProcessContext:function(e,t){var i={context:[],ids:[]},n=o.getContextScope(e,t);return n&&(i.context=n,i.ids=n.map((e=>e.scope))),i},getAllPhysicalIds:function(e,t){var i=t?[t]:[],n=o.getContextScope(e,t);return n&&n.forEach((e=>{i.push(e.scope),e.contextOccurrence&&e.contextOccurrence.forEach((e=>{i=i.concat(e.split("_"))})),e.implementedScope&&e.implementedScope.forEach((e=>{i.push(e.id),e.context&&e.context.forEach((e=>{i.push(e.parent),i.push(e.instance)}))})),UWA.is(e.resource,"array")&&e.resource.forEach((e=>{i.push(e.id)}))})),i},getInstallInstanceIds:function(e,t){var i=[],n=o.getContextScope(e,t);return n&&n.forEach((e=>{e.implementedScope&&e.implementedScope.forEach((e=>{e.context&&e.context.forEach((e=>{i.push(e.instance)}))}))})),i},getContextScope:function(e,t){var o,i;return e&&UWA.is(e.member,"array")&&t&&e.member.forEach((e=>{(i=e.find((function(e){return e.refid===t})))&&(o=i.contextScope)})),o},getAllMfgContextOccurrence:function(e,t,i){var n={context:[],ids:[]},r=o.getMfgContext(e,t,i);if(r)for(let e of r.context)e.context?(n.context=n.context.concat(e.context),n.ids=n.ids.concat(e.context.map((t=>`${t.parent}_${t.instance}_${e.id}`)))):n.ids=n.ids.concat(e.id);return n},getResourceOccurrence:function(e,t,i){var n={context:[],ids:[]},r=o.getResourceContext(e,t,i);if(r)for(let e of r.context)n.ids=n.ids.concat(e.id);return n},getImplicitFilterForProcessContext:function(i,n,r){var l=!1,s=o.getProcessContext(i,n);if(s&&s.context)for(let o of s.context)if(o.scope===r){l=o.implicitFiltering===e||o.implicitFiltering===t;break}return l},getAllProcessContextOccurrences:function(e,t){var i={context:[],ids:[]},n=o.getProcessContext(e,t);if(n&&n.context)for(let e of n.context)i.context=n.context,i.ids=[...i.ids,...e.contextOccurrence];return i}};return o})),define("DS/DELWebOEROpenControlComp/helper/ContextHelperV2",[],(function(){"use strict";const e={getMfgContext:function(t,o,i){var n={context:[],ids:[]},r={},l=e.getProcessContext(t,o);if(l&&l.context)for(let e of l.context)if(e.scope===i&&e.implementedScope){n.context=e.implementedScope,e.implementedScope.forEach((e=>{r[e.id]||(r[e.id]=!0,n.ids.push(e.id))}));break}return n},getProcessContext:function(t,o){var i={context:[],ids:[]},n=e.getContextScope(t,o);return n&&(i.context=n,i.ids=n.map((e=>e.scope))),i},getAllPhysicalIds:function(t,o){var i=o?[o]:[],n=e.getContextScope(t,o);return n&&n.forEach((e=>{i.push(e.scope),e.contextOccurrence&&e.contextOccurrence.forEach((e=>{i=i.concat(e.split("_"))})),e.implementedScope&&e.implementedScope.forEach((e=>{i.push(e.id),e.context&&e.context.forEach((e=>{i.push(e.parent),i.push(e.instance)}))}))})),i},getInstallInstanceIds:function(t,o){var i=[],n=e.getContextScope(t,o);return n&&n.forEach((e=>{e.implementedScope&&e.implementedScope.forEach((e=>{e.context&&e.context.forEach((e=>{i.push(e.instance)}))}))})),i},getContextScope:function(e,t){var o,i;return e&&UWA.is(e.member,"array")&&t&&e.member.forEach((e=>{(i=e.find((function(e){return e.refid===t})))&&(o=i.contextScope)})),o},getAllMfgContextOccurrence:function(t,o,i){var n={context:[],ids:[]},r=e.getMfgContext(t,o,i);if(r)for(let e of r.context)e.context?(n.context=n.context.concat(e.context),n.ids=n.ids.concat(e.context.map((t=>`${t.parent}_${t.instance}_${e.id}`)))):n.ids=n.ids.concat(e.id);return n},getAllProcessContextOccurrences:function(t,o){var i={context:[],ids:[]},n=e.getProcessContext(t,o);if(n&&n.context)for(let e of n.context)i.context=n.context,i.ids=[...i.ids,...e.contextOccurrence];return i}};return e})),define("DS/DELWebOEROpenControlComp/form/FormColumns",[],(function(){"use strict";return[{dataIndex:"tree",typeRepresentation:"string",alignment:"near",width:"175",minWidth:"15",alwaysVisibleFlag:!0,editableFlag:!1,getCellClassName:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("className"):""}},{dataIndex:"value",getCellTypeRepresentation:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("typeRepresentation"):"string"},getCellSemantics:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("semantics"):void 0},getCellEditableState:function(e){return!e.nodeModel||!e.nodeModel.getAttributeValue("readOnly")},allowUnsafeHTMLContent:!1,width:"250",minWidth:"10",alwaysVisibleFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace"},{dataIndex:"withFilter",width:"5",typeRepresentation:"functionIcon",hasCellValue:function(e){return e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter")},getCellSemantics:function(e){if(e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter"))return{icon:{iconName:"filter",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},disabled:!0}}}]})),define("DS/DELWebOEROpenControlComp/mixins/OpenControlPartFabricationMixin",["DS/DELWebOERCommonUtils/mixins/IndexServicesMixin","DS/DELWebOERCommonUtils/utils/CommonUtils","text!DS/DELWebOEROpenControlComp/assets/json/PartFabricationPayloads.json"],(function(e,t,o){"use strict";let i="Path",n="dsprcs:ItemSpecification",r="DELOER.RAWMaterials.Count",l=async function(e){let i=await this.executeRequestPromise(`${this.get3DSpaceUrl()}/resources/v1/modeler/dsprcs/invoke/dsprcs:expand?$mask=dsprcs:MfgProcessMask.Structure.ModelView_Flat.Index`,{method:"POST",payload:function(e){var i,n=JSON.parse(o).processExpand;return n.id=e.id?e.id:"",e.filter&&(n.config_filter=t.getValue(e.filter,"config_filter"),(i=t.getValue(e.filter,"config_filter_id"))&&(n.config_filter_id=i.physical_id)),e.scopedMfg&&e.scopedMfg.id&&(n.parameters={mfgItemId:e.scopedMfg.id}),n}(e)});return function(e){let t=[];return e&&e.totalItems>0&&e.member.forEach((function(e){let o=e[n];o&&o.totalItems>0&&o.member.forEach((function(e){e&&e.itemOcc&&t.push(e.itemOcc)}))})),{paths:t}}(i)},s=async function(e){let t=await this.getProgressiveExpand(function(e){var t=JSON.parse(o).progressiveExpandV2;return t.batch.expands[0].root.physical_id=e.id,t.batch.expands[0].filter=function(){let t=[],o=[];return(e=e||{}).filter&&t.push(e.filter),function(e){let t;e&&e.length>0&&(t=UWA.is(e[0],"string")?[e]:e,o=o.concat(t.map((e=>({physical_id_path:e})))))}(e.pathFilter),o.length>0&&t.push({prefix_filter:{prefix_path:o}}),0===t.length&&t.push({all:1}),{and:{filters:t}}}(),t}(e));return function(e){var t={paths:[]};return e&&UWA.is(e.results,"array")&&e.results.forEach((e=>{e[i]&&t.paths.push(e[i])})),t}(t)},a=function(e,t){let o;return e&&e.length>0&&e.forEach((function(e){o=!!(e&&e.paths&&e.paths.length&&e.paths.length<t)})),o},c={isPartFabrication:async function(e){let t,o=this,i=localStorage.getItem(r)?parseInt(localStorage.getItem(r)):1e3,n=!1;if(e&&e.process){let r,c=e.process.context?e.process.context:"",d=e.mfg&&e.mfg.context?e.mfg.context:"";r=await l.call(o,{id:c,scopedMfg:{id:d},filter:e.process.filter}),r&&r.paths&&r.paths.length>0&&d&&(t=await s.call(o,{id:d,pathFilter:r.paths}),n=a([t],i))}else if(e&&e.length>0){let r=[];e.forEach((function(e){"MBOM"===e.pprType&&r.push(s.call(o,{id:e.id,filter:e.filter}))})),t=await Promise.all(r),n=a(t,i)}return n}};return c=Object.assign(c,e),c})),define("DS/DELWebOEROpenControlComp/model/Model",[],(function(){"use strict";return function(){var e={};return{set:function(t,o){e[t]=o},get:function(t){return e[t]?e[t]:null},remove:function(t){delete e[t]},clear:function(){e={}}}}})),define("DS/DELWebOEROpenControlComp/mixins/OpenControlCompWebServicesMixin",["DS/DELWebOERCommonUtils/mixins/IndexServicesMixin","DS/DELWebOERCommonUtils/utils/CommonUtils","DS/DELWebOEROpenControlComp/helper/ContextHelperV2","DS/DELWebOEROpenControlComp/helper/ContextHelperV3","text!DS/DELWebOEROpenControlComp/assets/json/ServicePayloads.json","text!DS/DELWebOEROpenControlComp/assets/json/Constants.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp"],(function(e,t,o,i,n,r,l){"use strict";const s="Installation",a=JSON.parse(r).EffectivityAttribute;let c={computeVolumeFilter:async function(e,o,i={}){let r,s,a,c,d=this,p=JSON.parse(n);return e&&o&&(r=await async function(e){let t,o,i=p.expandV2;return i.batch.expands[0].root.physical_id=e,t=await d.getProgressiveExpand(i),t&&t.results&&t.results.length>0&&(o=t.results[0]),o}(o),r&&r.boundingbox&&(s=p.publicVolumeFilterSpec,a=t.getValue(s,"specification"),c=t.getValue(a,"allVolumes"),s.rootID=e,s.rootAlias=r["ds6w:label"],!0===i.withFilter?(s.applyFilter=0,s.displayFilter=1):(s.applyFilter=1,s.displayFilter=0),a.title=l.get(a.title),a.referencedObject.identifier=e,c[0].allVolumes=[this.getVolumeFilter(e,r.boundingbox,i.installVolumeOffSet)])),s},computeVolumeFilterV2:async function(e,o,i={}){let r,a,c,d=this,p=JSON.parse(n),u=[];if(e&&o){(UWA.is(o,"array")?o:[o]).forEach((e=>u.push(async function(e){let t,o,i=p.expandV2;return i.batch.expands[0].root.physical_id=e,t=await d.getProgressiveExpand(i),t&&t.results&&t.results.length>0&&(o=t.results[0]),o}(e))));let n=(await Promise.all(u)).filter((e=>e["ds6w:type"]&&e["ds6w:type"]===s));UWA.is(n,"array")&&n.length>0&&(r=p.publicVolumeFilterSpec,a=t.getValue(r,"specification"),c=t.getValue(a,"allVolumes"),r.rootID=e,r.rootAlias=n.map((e=>e["ds6w:label"])).join(", "),!0===i.withFilter?(r.applyFilter=0,r.displayFilter=1):(r.applyFilter=1,r.displayFilter=0),a.title=l.get(a.title),a.referencedObject.identifier=e,c[0].allVolumes=[],n.forEach((t=>{c[0].allVolumes.push(this.getVolumeFilter(e,t.boundingbox,i.installVolumeOffSet))})))}return r},getVolumeFilter:function(e,t,o=0){let i,r=JSON.parse(n).volumeFilter,s=function(e,t){return e.map((e=>`${e+t}`))},a=function(e,t){return s(e,-t/2)},c=Number.isNaN(Number(o))?0:10*Number(o);var d,p;return t&&t.max&&t.min&&(i=s(t.max,c),r.displayName=l.get(r.displayName),r.parameters.root_path_physicalid=[[e]],r.parameters.corner_max=(d=i,p=t.min,d.map(((e,t)=>""+(e-p[t])))),r.parameters.transformation_matrix=[1,0,0,0,1,0,0,0,1,...a(t.min,c)]),r},getInstallOccurrencesForFilter:async function(e){let t,o=JSON.parse(n).expandV2,i=[];return o.batch.expands[0].root.physical_id=e.filterRootIds[0],o.batch.expands[0].filter=function(e){let t=[],o=[];return(e=e||{}).filter&&t.push(e.filter),e.paths.length>0&&e.paths.forEach((e=>function(e){let t;e&&e.length>0&&(t=UWA.is(e[0],"string")?[e]:e,o=o.concat(t.map((e=>({physical_id_path:e})))))}(e))),o.length>0&&t.push({prefix_filter:{prefix_path:o}}),{and:{filters:t}}}(e),o.batch.expands[0].graph={descending_condition_relation:{uql:"((flattenedtaxonomies:reltypes/DELFmiFunctionInstance))"}},o.batch.expands[0].aggregation_processors=[{truncate:{max_distance_from_prefix:1,match_only_refs:1,prefix_filter:{prefix_path:[{physical_id_path:[e.filterRootIds[0]]}]}}}],t=await this.getProgressiveExpand(o),t&&t.results&&t.results.length>0&&t.results.forEach((e=>{e.Path&&i.push(e.Path)})),i},getEffectivityContent:async function(e){let t,o={ids:e,domain:"ALL",view:"ALL",format:"TXT"},i={};return t=await this.executeRequestPromise(this.get3DSpaceUrl()+"/resources/v1/modeler/dscfg/invoke/dscfg:getEffectivityContent",{method:"POST",payload:o}),t&&UWA.is(t.effectivitiesContent,"array")&&t.effectivitiesContent.forEach((e=>{i[e.id]={},Object.keys(a).forEach((t=>{i[e.id][t]=e[a[t]]?e[a[t]]:""}))})),i},getUnitId:async function(e){let o,i,n,r=t.getValue(e,"model"),l=t.getValue(t.getValue(e,"unit"),"single");return l&&r&&(o=`[plc_build_unit_number]:${l} AND [plc_model_pid]:${r.identifier}`,i=await this.searchUnits(o),i&&UWA.is(i.member,"array")&&i.member.length>0&&(n=i.member[0].identifier)),n},getFilteredRep:async function(e){let t=this.getNavigateUrlOptions(),o={input_physical_ids:[],primitives:[{navigate_from_sr:{id:1,filter:{role:["591"]}}}],patterns:{Connection:[{id:1}]},attributes:["pathsr"],label:"Navigate_Rep_Connections_From_Process",version:3};if(!e)throw new Error("Invalid input, processId is mandatory to get published filtered representations");return o.input_physical_ids.push(e),t.payload=o,this.executeRequestPromise(t.url,t)},getPublishedRep:async function(e={}){let t,o,i=e.processId,n=e.unitId;if(i&&n&&(o=await this.getFilteredRep(i),o&&UWA.is(o.result))){let e=o.result.find((e=>!(!e||!e.input_object)&&e.input_object.physicalid===i));if(e&&e.outputs&&UWA.is(e.outputs.Connection,"array")){let o;o=e.outputs.Connection.find((e=>e.pathsr.contains(n))),o&&(t=o.physicalid)}}return t},getPublicFilterSpecification:async function(e={}){let t=this;if(!(e&&e.proxy&&e.NGFUXId&&e.rootId))throw new Error("Invalid Input, please check input params");const o=`onGetPublicFilter_OpenControl_${(e=e||{}).NGFUXId}_${e.rootId}`;return await new Promise((i=>{e.proxy.addEvent(o,function(t={}){e.proxy.removeEvent(o),i(t)}.bind(this)),e.proxy.getPublicFilterSpecification({rootId:e.rootId,widgetId:t.getWidgetComponent().getId(),NGFUXId:e.NGFUXId,eventName:o})}))},searchUnits:async function(e){let t=new URL(`${this.get3DSpaceUrl()}/resources/v1/modeler/dspfl/dspfl:Unit/search?$mask=dsmvpfl:UnitBaseMask`);return t.searchParams.set("$searchStr",e),await this.executeRequestPromise(t.toString(),{dataType:"json",method:"GET"})},getCapableResource:function(e){var t,o,i=this;return(t=i.getNavigateUrlOptions(),o={label:"Navigate",input_physical_ids:[],version:3,primitives:[{navigate_to_sr:{id:1,filter:{role:["490"]},mode:"path"}}],patterns:{resourceArea_pathSR:[{id:1}]},attributes:["ds6w:label","physicalid","ds6w:type","pathsr"]},o.input_physical_ids.push(e),t.payload=o,i.executeRequestPromise(t.url,t)).then((function(t){let o,i,n=[];return t&&t.result&&(o=t.result.find((t=>t.input_object&&t.input_object.physicalid===e)),o&&o.outputs&&o.outputs.resourceArea_pathSR&&(i=o.outputs.resourceArea_pathSR.find((t=>t.owner&&t.owner.physicalid===e)),n=i.elements)),n}))},getCapableResourceV2:async function(e){var t,o,i=this;return(t=i.getNavigateUrlOptions(),o={label:"Navigate",input_physical_ids:[],version:3,primitives:[{navigate_to_sr:{id:1,filter:{role:["490"]},mode:"path"}}],patterns:{resourceArea_pathSR:[{id:1}]},attributes:["ds6w:label","physicalid","ds6w:type","pathsr"]},o.input_physical_ids=e,t.payload=o,i.executeRequestPromise(t.url,t)).then((function(t){let o,i,n={};return t&&t.result&&e.forEach((e=>{o=t.result.find((t=>t.input_object&&t.input_object.physicalid===e)),o&&o.outputs&&o.outputs.resourceArea_pathSR&&(i=o.outputs.resourceArea_pathSR.find((t=>t.owner&&t.owner.physicalid===e)),i&&UWA.is(i.elements,"array")&&i.elements.length>0&&(n[e]={resourceId:i.elements[0].physicalid}))})),n}))},getInstallPredecessors:function(e,t){var o=this,i={assemblyid:e,installinstids:[t],predecessor:!0,successor:!1,nodependency:!1,graphconstraint:!1};return o.executeRequestPromise(`${o.get3DSpaceUrl()}/resources/v1/modeler/dsmfg/invoke/dsmfg:getMfgItemInstallDependencies`,{method:"POST",payload:i}).then((function(e){return e&&e[t]&&e[t].predecessors?e[t].predecessors:[]})).fail((function(i){o.logger.debug(i),o.logger.error("Error occurred while fetching predecessors for mfg ",e," install -",t)}))},getContextScope:function(e){var t=this,o={refid:e,stopDAG:"MBOM",firstParentScope:!1};return t.executeRequestPromise(`${t.get3DSpaceUrl()}/resources/v1/modeler/dsprcs/invoke/dsprcs:getScopeContext`,{method:"POST",payload:o}).fail((function(o){t.logger.debug(o),t.logger.error("Error occurred while fetching context scope for process id ",e)}))},getUnitInfo:async function(e){let t;return e&&(t=await this.executeRequestPromise(`${this.get3DSpaceUrl()}/resources/v1/modeler/dspfl/dspfl:Unit/${e}?$mask=dsmvpfl:UnitBaseMask`,{dataType:"json",method:"GET"})),t},getUnitFilterExpression:async function(e,t){let o,i=function(e){let t;return e&&e.member&&e.member.length>0&&(t=e.member[0]),t};if(e&&t){let r=i(await this.getUnitInfo(t));if(r){let t=i(r.model)||{},s=t.name,a={name:s,identifier:t.id},c=[{unit:{name:s,selections:[{single:Number(r.unitNumber)}]}}];o=JSON.parse(n).publicUnitFilterSpec,o.rootID=e,o.specification.title=l.get(o.specification.title),o.specification.referencedObject.identifier=e,o.specification.filter.filterSpecifications[0].filterCriteria[0].configurationFilterDefinition.volatileFilter.filterSelection={model:a,criteria:c}}}return o},updateScopedManuAssemWithContext:async function(e,t){let i=this,r=o.getProcessContext(t,e),l=o.getMfgContext(t,e,UWA.is(r.context,"array")&&r.context[0]?r.context[0].scope:null),a=[],c=[],d=Object.assign({},t),p=[];if(UWA.is(l.context,"array")&&l.context.forEach((e=>{e.type===s&&UWA.is(e.context,"array")?e.context.forEach((e=>{e.parent&&-1===a.indexOf(e.parent)&&a.push(e.parent)})):c.push(e.id)})),c.length>0&&a.length>0){let t=[];a.forEach((e=>{let t=JSON.parse(n).expandV2;t.batch.expands[0].root.physical_id=e,t.batch.expands[0].graph={descending_condition_relation:{uql:"((flattenedtaxonomies:reltypes/DELFmiFunctionInstance))"}},t.batch.expands[0].aggregation_processors=[{truncate:{max_distance_from_prefix:1,match_only_refs:1,prefix_filter:{prefix_path:[{physical_id_path:[e]}]}}}],p.push(i.getProgressiveExpand(t))}));let o=await Promise.all(p);UWA.is(o,"array")&&o.forEach((e=>{UWA.is(e.results,"array")&&e.results.forEach((e=>{e.Path&&t.push(e.Path)}))})),d&&UWA.is(d.member,"array")&&e&&d.member.forEach((o=>{let i=o.find((function(t){return t.refid===e}));if(i){let e=i.contextScope;UWA.is(e,"array")&&e.forEach((e=>{if(UWA.is(e.implementedScope)){let o=[];e.implementedScope.forEach((e=>{e.type!==s&&t.forEach((t=>{-1!==t.indexOf(e.id)&&(o.push({...e}),e.context||(e.context=[]),e.context.push({parent:t[0],instance:t[1]}))}))})),e.implementedScope=e.implementedScope.concat(o)}}))}}))}return d},updateResourceToContext:async function(e,t){let o=i.getAllProcessContextOccurrences(t,e),n=[];if(UWA.is(o.context,"array")&&(o.context.forEach((e=>{n.push(e.scope)})),n.length>0)){let o=await this.getCapableResourceV2(n);o&&t&&UWA.is(t.member,"array")&&e&&t.member.forEach((t=>{let i=t.find((function(t){return t.refid===e}));i&&UWA.is(i.contextScope,"array")&&i.contextScope.forEach((e=>{e.scope&&o[e.scope]&&o[e.scope].resourceId?(e.resource=[],e.resource.push({id:o[e.scope].resourceId})):e.resource=[]}))}))}return t},updateImplicitFilterToContext:async function(e,t){const o="bo.dellmiimplicitfilteringext.v_implicitfilteringmode";let n=i.getAllProcessContextOccurrences(t,e),r=[];if(UWA.is(n.context,"array")&&(n.context.forEach((e=>{r.push(e.scope)})),r.length>0)){let i=await this.getAttributeForIds(r,[o]);i&&t&&UWA.is(t.member,"array")&&e&&t.member.forEach((t=>{let n=t.find((function(t){return t.refid===e}));n&&UWA.is(n.contextScope,"array")&&n.contextScope.forEach((e=>{e.scope&&i[e.scope]&&i[e.scope][o]?e.implicitFiltering=i[e.scope][o]:e.implicitFiltering=!1}))}))}return t}};return c=Object.assign(c,e),c})),define("DS/DELWebOEROpenControlComp/mixins/OpenProcessV2Mixin",["DS/DELWebOEROpenControlComp/helper/ContextHelperV2","DS/DELWebOEROpenControlComp/form/ProcessFormV2","DS/DELWebOERCommonUtils/utils/CommonUtils","text!DS/DELWebOEROpenControlComp/assets/json/ConstantsV2.json"],(function(e,t,o,i){"use strict";const n=JSON.parse(i);return{_openProcessV2:async function(i){let r,l,s=this,a=[],c=()=>{let e=s.getModelEvents();s._publish("onFormClean"),a.forEach(e.unsubscribe),s.model.remove("attributes"),s.model.remove("formData"),s.model.remove("publicFilterSpec")},d=async function(){var e=[],t=s.model.get("formData");s._showMask();try{e.push(async function(){let e=s.model.get("formData"),t=await s.getCapableResource(e.process.context);UWA.is(t,"array")&&t.length>0&&(e.rsc=t.map((e=>({context:e.physicalid,pprType:s.PPRTYPES.RESOURCE}))))}()),e.push(async function(){let e,t=s.model.get("formData"),o=[];if(t.mfg&&UWA.is(t.mfg.contextOccurrence,"array")&&(e=t.mfg.contextOccurrence,e&&e.length>0)){e.forEach((function(e){let i=e.length>1?e[e.length-2]:null;i&&o.push(s.getInstallPredecessors(t.mfg.context,i))}));let i=await Promise.all(o);t.mfg.predecessors={},e.forEach((function(e,o){let n=e.length>1?e[e.length-2]:null;i[o]&&(t.mfg.predecessors[n]=i[o])}))}}()),!0===i.usePublication&&e.push(async function(){let e,t,o,n=s.model.get("formData"),r=n.mfg?n.mfg.context:null,l=n.process?n.process.context:null,a=i.filterProxy,c=i.NGFUXId;l&&r&&!0===i.withFilter&&(t=await s.getPublicFilterSpecification({proxy:a,NGFUXId:c,rootId:r}),o=await s.getUnitId(t),o&&(e=await s.getPublishedRep({processId:l,unitId:o}),e&&(n.publishedRep={context:e})))}()),!0===i.enablePartFabrication&&e.push(s.isPartFabrication(s.model.get("formData")));let o=await Promise.all(e);i.enablePartFabrication&&Array.isArray(o)&&o.length>0&&t&&t.mfg&&(t.mfg.outofScope=o[o.length-1]),s._removeMask();let n={results:[function(){let e=function(e){var t,o;return e&&(o=e.contextOccurrence&&e.contextOccurrence.length>0?e.contextOccurrence[e.contextOccurrence.length-1]:e.context,Object.assign(e,{id:o,occurrence:e.contextOccurrence?1===e.contextOccurrence.length?[]:e.contextOccurrence:[]}),delete e.context,delete e.contextOccurrence,delete e.scopedMfg,t=e),t};var o=e(t.process),i=function(e){var t=[];if(e&&UWA.is(e.scopedMfg,"array")){let o=e.contextOccurrence||[],i=e.predecessors||[],n=e.scopedMfg;delete e.context,delete e.contextOccurrence,delete e.scopedMfg,delete e.predecessors,n.forEach((n=>{let r=o.findIndex((e=>e[e.length-1]===n)),l=-1!==r?o[r]:[],s=UWA.is(l,"array")&&l.length>2?l[l.length-2]:null,a=s?i[s]:null;r>-1&&o.splice(r,1);let c=Object.assign({},e,{id:n,occurrence:l?1===l.length?[]:l:[],predecessors:a});t.push(c)}))}return t}(t.mfg),n=UWA.is(t.rsc,"array")?t.rsc.map((e=>({id:e.context,pprType:e.pprType}))):null,r=e(t.publishedRep);return o.scopedMfg=i,o.resource=n,o.publishedRep=r,o}()],version:i.version};s._executeHander(i.onOpen,n)}catch(e){s._removeMask(),s.logger.log(e),s._handleError(i,`Error occurred while fetching resource/predecessors for mfg ${t&&t.mfg&&t.mfg.context?t.mfg.context:""}`,"DELOP_E00")}finally{c()}},p=()=>{let e=s.model.get("formData");c(),i.filterProxy&&e.mfg&&e.mfg.context&&i.filterProxy.resetNGFilterUI({appId:s.getExecutionContext().getSourceApp().getId(),widgetId:s.getWidgetComponent().getId(),roots:e.mfg.context}),this._executeHander(i.onCancel)},u=async()=>{if(!0===i.showForm){let o=await this.getAttributeForIds(e.getAllPhysicalIds(r,i.id),Object.values(n.Attributes),Object.values(n.FileAttributes)),a=e.getInstallInstanceIds(r,i.id);if(a&&a.length>0){let e=await s.getEffectivityContent(a);UWA.extend(o,e,!0)}this.model.set("attributesMap",o);let c=Object.assign({},{onOpen:d,onCancel:p,modelEvents:s.getModelEvents(),container:this._getContainer()});l=new t(this.model,c)}else s.subscribe({event:"onGetFieldValue"},(e=>{let{fieldId:t,ids:o}=e&&e.data||{};o&&o.length>1&&this._handleError(i,`Multiple ids found for ${t}`,"DELOP_E02",{fieldId:t})}))},f=function(){l&&l.isVisible()?s._publish("onFormComplete"):d()},m=async e=>{let t=s.model.get("formData"),n=i.buildId;if(n&&!0===i.withFilter){s.logger.debug(`Apply filter for the unit ${n}`);let e=await s.getUnitFilterExpression(t.mfg.context,n),i=s.model.get("publicFilterSpec"),r=i?o.mergeFilterSpecification(i,e,o.ENUMS.FILTER_COMBINATION_SPEC.INTERSECTION):e;s.model.set("publicFilterSpec",r)}s._openFilter({items:[{id:t.mfg.context,type:t.mfg.type,pprType:t.mfg.pprType,withFilter:!0,publicFilterSpec:s.model.get("publicFilterSpec")}],onApply:(o=[])=>{UWA.is(o,"array")?o.forEach((o=>{if(UWA.is(o,"object")){let n;o.filterRootIds&&1===o.filterRootIds.length&&(n=o.filterRootIds[0],t.mfg.context===n&&(o.CVQueryV2={filter:s._getCVQueryFilter(n,i.filterProxy,o)},t.mfg.filter=o.CVQueryV2.filter,t.mfg.withFilter=!0,t.process.filter=o.CVQueryV2.filter,s._publish("onFilterApplied",{fieldId:e.fieldId}),e.onFilterApplied&&e.onFilterApplied(o)))}else s.logger.error("filterData is not valid, filterData should be an object")})):s.logger.error("Callback is not valid, results should be an array")},onCancel:o=>{t.mfg.filter=null,t.mfg.withFilter=!1,t.process.filter=null,t.process.withFilter=!1,s._publish("onFilterCancelled",{fieldId:e.fieldId}),e.onFilterCancelled&&e.onFilterCancelled(o)},showConfirmationDialog:!l||!l.isVisible(),filterProxy:i.filterProxy,NGFUXId:i.NGFUXId})},h=function(e,t,o={}){t&&t.ids&&t.ids.length>0&&s._publish("onGetFieldValue",{fieldId:e,ids:t.ids,...o})},g=async function(e){let t=(e=UWA.is(e,"array")?e:[e]).map((e=>UWA.is(e,"string")?e:UWA.is(e,"array")?e[e.length-1]:null)),o=[],r=[],a=null;e.forEach((e=>{UWA.is(e,"array")&&e.length>0?(r.push(e),o.push(e[0])):o.push(e)}));let c=[...new Set(o)];1===c.length&&(a=c[0]);let d=s.model.get("formData"),u={fieldId:n.Fields.MfgScopedItem,onFilterApplied:function(){f()},onFilterCancelled:function(e){e&&!0===e.result||l&&l.isVisible()?f():p()}};if(UWA.is(t,"array")&&t.length>0&&UWA.is(a))if(d.mfg={context:a,scopedMfg:t,contextOccurrence:r,pprType:s.PPRTYPES.MBOM},!0===i.installAutoApplyVolume){let e=await s.computeVolumeFilterV2(d.mfg.context,d.mfg.scopedMfg,{installVolumeOffSet:i.installVolumeOffSet,withFilter:i.withFilter});s.model.set("publicFilterSpec",e),m(u)}else!0===i.withFilter?m(u):f()},b=function(t=[]){let o,l=s.model.get("formData");if(1===t.length){let c=t[0];o=c[0],l.process={context:o,contextOccurrence:c,pprType:s.PPRTYPES.PROCESS,withFilter:i.withFilter},a=e.getAllMfgContextOccurrence(r,i.id,s.model.get("formData").process.context),h(n.Fields.MfgScopedItem,a)}else s._handleError(i,"Unable to get process information","DELOP_E00");var a};if(!(i&&i.onOpen&&i.onError&&i.onCancel))throw new Error("Invalid input, please check the input params");try{if(i.scopedMfg){!0===i.withFilter&&function(e){if(UWA.is(e.scopedMfg,"array")&&e.scopedMfg.length>0){let t=[];e.scopedMfg.forEach((e=>{let o=e.occurence?e.occurence[0]:e.id;t.push(o)}));let o=[...new Set(t)];if(1===o.length){let t=i.filterProxy.getFilterSpec(o[0],{V2:{}});t&&t.filter&&(e.withFilter=!0,e.filter=t.filter)}}}(i),UWA.is(i.scopedMfg,"array")&&i.scopedMfg.length>0&&i.scopedMfg.forEach((async e=>{let t=await this.getTaxonomies([e.id]);e.pprType=this.getPPRType(t[e.id])})),UWA.is(i.resource,"array")&&i.resource.length>0&&i.resource.forEach((async e=>{let t=await this.getTaxonomies([e.id]);e.pprType=this.getPPRType(t[e.id])}));let e={results:[i],version:i.version};s._executeHander(i.onOpen,e)}else s._showMask(),(()=>{const e={ProcessContext:b,MfgScopedItem:g};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.push(s.subscribe({event:`on${t}Select`},(function(o){let i=o?o.data:null;s.logger.debug(`Value of the ${t} is ${i}`),e[t](i)})))})(),a.push(s.subscribe({event:"onProcessFormDisplayed"},s._removeMask.bind(s))),r=await s.getContextScope(i.id),r=await s.updateScopedManuAssemWithContext(i.id,r),s.model.set("context",r),await u(),((t,o)=>{let r=e.getAllProcessContextOccurrences(t,o);r&&r.ids.length>0?(s.model.set("formData",{}),h(n.Fields.ProcessContext,r)):(s.model.set("formData",{process:{context:i.id,type:i.type,pprType:s.PPRTYPES.PROCESS,withFilter:i.withFilter}}),f())})(r,i.id)}catch(e){s._removeMask(),s.logger.log(e),s._handleError(i,e.message,"DELOP_E00")}}}})),define("DS/DELWebOEROpenControlComp/form/ProcessForm",["DS/Controls/Button","DS/DELWebCommonControls/Form","DS/DELWebOEROpenControlComp/form/FormDocument","DS/DELWebOEROpenControlComp/form/FormColumns","text!DS/DELWebOEROpenControlComp/assets/json/Constants.json","text!DS/DELWebOEROpenControlComp/assets/json/FormFieldsConfig.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp"],((e,t,o,i,n,r,l)=>{"use strict";const s=JSON.parse(n),a=JSON.parse(r);function c(t,n){this._options=n||{},this._tokens=[],this._model=t,this._modelEvents=n.modelEvents,this._openButton=new e({onClick:(...e)=>{n.onOpen&&n.onOpen.apply(n,e)}}),this._cancelButton=new e({onClick:(...e)=>{n.onCancel&&n.onCancel.apply(n,e)}}),this._formOptions={identifier:"oer-process-form",formOptions:{maxVisibleRowCount:Object.keys(a).length,treeDocument:new o,columns:i},dialogOptions:{title:l.get("Dialog.Process.Title"),position:{my:"bottom",at:"center",offsetY:-100},buttons:{Open:this._openButton,Cancel:this._cancelButton}},frameContainer:n.container},this._subscribeEvents()}return c.prototype._subscribeEvents=function(){let e=this;[{event:"onGetFieldValue",handler:e._onGetFieldValue},{event:"onFilterApplied",handler:e._onFilterApplied},{event:"onFilterCancelled",handler:e._onFilterCancelled},{event:"onFormComplete",handler:()=>{e._openButton.disabled=!1}},{event:"onFormClean",handler:e.destroy}].forEach((t=>{e._tokens.push(e._modelEvents.subscribe({event:t.event},t.handler.bind(e)))}))},c.prototype._addFormListener=function(){let e=this;e.getTreeDocument().onNodeModelUpdate((function(t){var o=t.data?t.data.nodeModel:{};if(e.getTreeDocument().prepareUpdate(),o&&o.options&&o.options.fieldId){let i=o.options.grid.semantics;if(i&&i.possibleValues){let e=i.possibleValues.find((function(e){return o.getAttributeValue("value")===e.value}));o.setAttribute(s.Context.fieldValue,e[s.Context.fieldValue])}t.data.attributes.value&&e._modelEvents.publish({event:`on${o.options.fieldId}Select`,data:{data:o.getAttributeValue(s.Context.fieldValue),origin:"FormHelper"}})}e.getTreeDocument().pushUpdate()})),e._processForm.addEventListener("onClose",e._options.onCancel)},c.prototype._removeFormListener=function(){this._processForm&&this._processForm.removeEventListener("onClose",this._options.onCancel)},c.prototype._getPossibleValues=function(e,t){var o=[],i=(e,t)=>{let o="",i="",n=t?t.split(s.Context.delimeter):[];switch(e){case s.Fields.MfgInstallOccurrence:n.length>2&&(o=`${this._getAttributeValue(n[2],s.Attributes.label)} (${this._getAttributeValue(n[1],s.Attributes.label)})`,Object.keys(s.EffectivityAttribute).forEach((e=>{i+=`${l.get("Form."+e+".Title")}: ${this._getAttributeValue(n[1],e)?this._getAttributeValue(n[1],e):""}\n`})));break;case s.Fields.ProcessContextOccurrence:n.forEach((e=>{""!==o?o+=`, ${this._getAttributeValue(e,s.Attributes.label)}`:o=`${this._getAttributeValue(e,s.Attributes.label)}`})),i=o;break;default:o=`${this._getAttributeValue(n[0],s.Attributes.label)}`,i=o}return{label:o,description:i}},n=e=>{let t=e?e.split(s.Context.delimeter):[""];return this._getAttributeValue(t[t.length-1],s.Attributes.iconUrl)};return t&&t.length>0&&(o=t.map((t=>{let o=i(e,t);return{[s.Context.fieldValue]:t,value:o.label,label:o.label,withFilter:void 0,icon:{iconPath:n(t)},description:o.description}}))),o},c.prototype._getParentFieldId=function(e){return e&&a[e]?a[e].parent:null},c.prototype.getPopulatedFields=function(e){var t=[],o=0;return a[e]&&(o=a[e].position,t=Object.keys(a).filter((e=>a[e].position<=o))),t.sort(((e,t)=>a[e].position-a[t].position))},c.prototype._disablePopulatedFields=function(e){let t=this.getPopulatedFields(e),o=this;UWA.is(t,"array")&&t.forEach((function(e){o.disableField(e)}))},c.prototype._onFilterApplied=function(e){let{fieldId:t}=e&&e.data?e.data:{};this.isVisible()&&this._disablePopulatedFields(t)},c.prototype._onFilterCancelled=function(e){let{fieldId:t}=e&&e.data?e.data:{};this._updateAttribute({fieldId:t,attribute:"withFilter",value:!1})},c.prototype._updateAttribute=function(e){let t=this.getTreeDocument();t&&t.updateAttribute(e)},c.prototype._getAttributeValue=function(e,t){var o=this._model.get("attributesMap");return o&&o[e]?o[e][t]:{}},c.prototype._onGetFieldValue=function(e){let o,i,n=this,{fieldId:r,ids:s}=e&&e.data?e.data:{},c=this._model.get("fieldToValuesMap"),d=[],p=function(e){let t=n.getTreeDocument();n._openButton.disabled=!0,t.prepareUpdate(),function(e,t){t&&t.forEach((t=>{var o=n._getParentFieldId(t);t&&(o?e.createFieldNode(t,{label:l.get(a[t].label),possibleValues:n._model.get("fieldToValuesMap")[t]},o):e.createRootNode(t,{label:l.get(a[t].label)}))}))}(t,e),t.pushUpdate()};c||(c={},n._model.set("fieldToValuesMap",c)),s&&s.length>0&&(c[r]=n._getPossibleValues(r,s),n._processForm?(i=n._getParentFieldId(r),o=n.getTreeDocument().getFieldNode(i),o||d.push(i),d.push(r),p(d)):s.length>1&&(n._processForm=new t(n._formOptions),n._addFormListener(),d=n.getPopulatedFields(r),p(d),n._modelEvents.publish({event:"onProcessFormDisplayed",data:{data:{state:!0},origin:"FormHelper"}})))},c.prototype.isVisible=function(){return!!this._processForm},c.prototype.disableField=function(e){let t=this.getTreeDocument();t&&t.disableField(e)},c.prototype.getTreeDocument=function(){if(this._processForm)return this._processForm.getDataGridView().getTreeDocument()},c.prototype.destroy=function(){let e=this._modelEvents;this._removeFormListener(),this._tokens.forEach(e.unsubscribe),this._processForm&&this._processForm.destroy()},c})),define("DS/DELWebOEROpenControlComp/mixins/OpenProcessV3Mixin",["DS/DELWebOEROpenControlComp/helper/ContextHelperV3","DS/DELWebOEROpenControlComp/form/ProcessFormV3","DS/DELWebOERCommonUtils/utils/CommonUtils","DS/DELWebViewerCommon/DELCommonUtils","DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","text!DS/DELWebOEROpenControlComp/assets/json/ConstantsV3.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp"],(function(e,t,o,i,n,r,l,s,a,c){"use strict";const d=JSON.parse(a),p="PROCESS",u="3DViewer";return{_openFilterV3(e={}){var t,o,a,d,p=this,u=e.items||[],f=e.showConfirmationDialog,m=e.onApply,h=e.onCancel,g=e.filterProxy,b=(e.NGFUXId,!1),x=[],C=p._getContainer(),F=function(e){n.removeModal(C),p.publish({event:"onFilterCancel",data:{data:e,origin:"DELWeb3DFilterCmd"}}),h&&h(e)};return a=function(){t(),f?d():F({result:!1,filterData:u})},o=function(e){if(e){if(x.length>0){let t=function(e){return e&&UWA.is(e.filterRootIds,"array")?e.filterRootIds[0]:null},o=t(e);if(o){let i=x.findIndex((e=>t(e)===o));i>-1?x[i]=e:x.push(e)}}else x.push(e);b&&x.length!==u.length||(n.removeModal(C),m&&m(x))}},t=function(){g&&g.removeEvent&&(g.removeEvent("ApplyNGFilter",o),g.removeEvent("NGFilter_Close",a))},d=function(){var e,t,o,i=document.getElementsByClassName("wux-controls-modalContainer"),n=function(e){let i={result:e,filterData:u};t.removeEventListener("close",o),t.destroy(),F(i)};o=n.bind(n,!1),UWA.is(i,"array"),i.length>0?((e=new r({})).inject(i[0]),(t=new l({immersiveFrame:e,title:c.get("Dialog.Title"),content:c.get("Dialog.FilterCancelled.Message"),buttons:{Ok:new s({onClick:n.bind(n,!0)}),Cancel:new s({onClick:n.bind(n,!1)})}})).addEventListener("close",o)):p.logger.error("App Overlay container not found, so dialog cannot be created")},UWA.is(u,"array")&&u.length>0&&(g.addEvent("NGFilter_Close",a),g.addEvent("ApplyNGFilter",o),function(){let e=!1,t=u.filter((e=>e.filterSpec||e.publicFilterSpec));return t.length>0&&(e=!0,b=!0,t.forEach((e=>{let t={rootID:e.id,rootAlias:e.label,applyFilter:1,displayFilter:0,forceUpdate:0,serviceId:"3DSpace"};e.publicFilterSpec&&(1===e.publicFilterSpec.displayFilter&&p._removeMask(),g.removeRoot(e.id),i.setPublicFilterSpecification({proxy:g,publicFilterSpec:{...t,...e.publicFilterSpec}}))}))),e}()||(p.filterCommandHandlerId?(p._removeMask(),p.executeCommand({handlerId:p.filterCommandHandlerId,args:{items:u.map((e=>({id:e.id,filtered:!1}))),NGFUXId:e.NGFUXId}})):p._handleError(e,"Unable to open/apply filter as filterCommandHandlerId is not available","DELOP_E00")),n.createModal(C,document.createElement("span"))),{removeSubscriptions:t}},async _openV3(e={}){let t=this,o=[],n=e.items||[],r=n.filter((e=>!0===e.withFilter||e.publicFilterSpec||e.filterSpec)),l=e.filterProxies[u]&&e.filterProxies[u].filterProxy?e.filterProxies[u].filterProxy:e.filterProxy,s=e.filterProxies[u]&&e.filterProxies[u].NGFUXId?e.filterProxies[u].NGFUXId:e.NGFUXId,a=function(e=[]){return n.forEach(((t,o)=>{let i=e.find((e=>e.id===t.id));i?n[o]=i:t.withFilter=!1})),n},c=async function(i){let n=!1;if(!0===e.enablePartFabrication)try{n=await t.isPartFabrication(i),i.forEach((e=>{e.outofScope=n}))}catch(e){t.logger.error("Part Fabrication check failed due to -",e)}UWA.is(o,"array")&&o.length>0&&o.forEach((function(e){e.removeSubscriptions&&e.removeSubscriptions()}));let r={results:i,version:e.version};"V1"===e.version?e.onOpen(r):t._executeHander(e.onOpen,r)};if(!(e&&e.items&&e.onOpen&&e.onCancel&&e.onError))throw new Error("Invalid input, mandatory params are missing, please check the input params");r.length>0?l&&s?o.push(t._openFilterV3({items:r,onApply:async(e=[])=>{if(UWA.is(e,"array")){for(let o of e)if(UWA.is(o,"object")){let e=UWA.is(o.filterRootIds,"array")?o.filterRootIds[0]:null;if(e)for(let n of r)if(n.id===e){let r=await i.getPublicFilterSpecification({proxy:l,NGFUXId:s,rootId:e});n.withFilter=!0,n.filter=t._getCVQueryFilter(e,l,o),n.publicFilterSpec=r}}else t.logger.error("filterParam is not valid, filterParam should be an object");let o=a(r);c(o)}else t.logger.error("Callback is not valid, results should be an array")},onCancel:async t=>{if(t&&t.result&&t.filterData){t.filterData.forEach((function(e){e.withFilter=!1}));let e=a(r);c(e)}else this._executeHander(e.onCancel)},showConfirmationDialog:!0,filterProxy:l,NGFUXId:s})):t._handleError(e,"Invalid input, Unable to open/apply filter as filter Proxy and NGFUXId is mandatory and is not available ","DELOP_E01"):c(n)},_openProcessV3:async function(n){let r,l,s=this,a=[],c=[],f=n.filterProxies&&n.filterProxies[u]&&n.filterProxies[u].filterProxy?n.filterProxies[u]:null,m=n.filterProxies&&n.filterProxies[p]&&n.filterProxies[p].filterProxy?n.filterProxies[p]:null,h=function(){UWA.is(a,"array")&&a.length>0&&(a.forEach((function(e){e.removeSubscriptions&&e.removeSubscriptions()})),a=[])},g=()=>{let e=s.getModelEvents();s._publish("onFormClean"),c.forEach(e.unsubscribe),s.model.remove("attributes"),s.model.remove("formData"),s.model.remove("mbomPublicFilterSpec"),s.model.remove("processPublicFilterSpec"),s.model.remove("resourcePublicFilterSpec")},b=async function(){var e=[],t=s.model.get("formData");try{h(),e.push(async function(){let e,t=s.model.get("formData"),o=[];if(t.mfg&&UWA.is(t.mfg.contextOccurrence,"array")&&(e=t.mfg.contextOccurrence,e&&e.length>0)){e.forEach((function(e){let i=e.length>1?e[e.length-2]:null;i&&o.push(s.getInstallPredecessors(t.mfg.context,i))}));let i=await Promise.all(o);t.mfg.predecessors={},e.forEach((function(e,o){let n=e.length>1?e[e.length-2]:null;i[o]&&(t.mfg.predecessors[n]=i[o])}))}}()),!0===n.usePublication&&e.push(async function(){let e,t,o,r=s.model.get("formData"),l=r.mfg?r.mfg.context:null,a=r.process?r.process.context:null,c=f.filterProxy,d=f.NGFUXId;a&&l&&!0===n.withFilter&&(t=await i.getPublicFilterSpecification({proxy:c,NGFUXId:d,rootId:l}),o=await s.getUnitId(t),o&&(e=await s.getPublishedRep({processId:a,unitId:o}),e&&(r.publishedRep={context:e})))}()),!0===n.enablePartFabrication&&e.push(s.isPartFabrication(s.model.get("formData")));let o=await Promise.all(e);n.enablePartFabrication&&Array.isArray(o)&&o.length>0&&t&&t.mfg&&(t.mfg.outofScope=o[o.length-1]),s._removeMask();let r={results:[function(){let e=function(e){var t,o;return e&&(o=e.contextOccurrence&&e.contextOccurrence.length>0?e.contextOccurrence[e.contextOccurrence.length-1]:e.context,Object.assign(e,{id:o,occurrence:e.contextOccurrence?1===e.contextOccurrence.length?[]:e.contextOccurrence:[]}),delete e.context,delete e.contextOccurrence,delete e.scopedMfg,t=e),t};var o,i=e(t.process),n=function(e){var t=[];if(e&&UWA.is(e.scopedMfg,"array")){let o=e.contextOccurrence||[],i=e.predecessors||[],n=e.scopedMfg;delete e.context,delete e.contextOccurrence,delete e.scopedMfg,delete e.predecessors,n.forEach((n=>{let r=o.findIndex((e=>e[e.length-1]===n)),l=-1!==r?o[r]:[],s=UWA.is(l,"array")&&l.length>2?l[l.length-2]:null,a=s?i[s]:null;r>-1&&o.splice(r,1);let c=Object.assign({},e,{id:n,occurrence:l?1===l.length?[]:l:[],predecessors:a});t.push(c)}))}return t}(t.mfg),r=(o=t.rsc,UWA.is(o)&&o.context?[{id:o.context,pprType:o.pprType,withFilter:!!UWA.is(o.withFilter,"boolean")&&o.withFilter,filter:UWA.is(o.filter)?o.filter:null,publicFilterSpec:UWA.is(o.publicFilterSpec)?o.publicFilterSpec:null}]:[]),l=e(t.publishedRep);if(i.scopedMfg=n,i.resource=r,i.publishedRep=l,!0===i.implictFilter&&UWA.is(i.scopedMfg,"array")&&i.scopedMfg.length>0){let e=i.scopedMfg.find((e=>UWA.is(e.filter)));UWA.is(e)?(i.filter=e.filter,i.withFilter=!0):(i.filter=null,i.withFilter=!1)}return Object.assign({},i)}()],version:n.version};s._executeHander(n.onOpen,r)}catch(e){s._removeMask(),s.logger.log(e),s._handleError(n,`Error occurred while fetching resource/predecessors for mfg ${t&&t.mfg&&t.mfg.context?t.mfg.context:""}`,"DELOP_E00")}finally{g()}},x=()=>{let e=s.model.get("formData");g();let t=function(e,t){e&&t&&t.context&&e.resetNGFilterUI({appId:s.getExecutionContext().getSourceApp().getId(),widgetId:s.getWidgetComponent().getId(),roots:t.context})};t(m.filterProxy,e.process),t(f.filterProxy,e.mfg),t(f.filterProxy,e.rsc),this._executeHander(n.onCancel)},C=async()=>{if(!0===n.showForm){let o=await this.getAttributeForIds(e.getAllPhysicalIds(r,n.id),Object.values(d.Attributes),Object.values(d.FileAttributes)),i=e.getInstallInstanceIds(r,n.id);if(i&&i.length>0){let e=await s.getEffectivityContent(i);UWA.extend(o,e,!0)}this.model.set("attributesMap",o);let a=!UWA.is(n.publicFilterSpec)&&!UWA.is(n.buildId)&&!0===n.withFilter,c=Object.assign({},{onOpen:b,onCancel:x,modelEvents:s.getModelEvents(),container:this._getContainer(),filter:n.withFilter,defaultShow:a});l=new t(this.model,c)}else s.subscribe({event:"onGetFieldValue"},(e=>{let{fieldId:t,ids:o}=e&&e.data||{};o&&o.length>1&&this._handleError(n,`Multiple ids found for ${t}`,"DELOP_E02",{fieldId:t})}))},F=function(){l&&l.isVisible()?s._publish("onFormComplete"):b()},y=function(e,t,o){t&&UWA.is(t.ids,"array")&&s._publish("onGetFieldValue",{fieldId:e,ids:t.ids,...o})},E=function(e){let t={},o=function(e){let t={idsToSelect:[],filterActivated:!1,filter:null,publicFilterSpec:null},o=function(e){e.occurrence&&e.occurrence.length>1?t.idsToSelect.push(e.occurrence.join("_")):e.id&&t.idsToSelect.push(e.id),UWA.is(e.filter)&&(t.filterActivated=!0,t.filter=e.filter,t.publicFilterSpec=e.publicFilterSpec)};return UWA.is(e,"array")&&e.length>0?e.forEach((e=>{o(e)})):UWA.is(e)&&e.id&&o(e),t};switch(e){case d.Fields.ProcessContext:t=o(n);break;case d.Fields.MfgScopedItem:t=o(n.scopedMfg);break;case d.Fields.Resource:t=o(n.resource);break;default:t={}}return t},_=function(e){return h(),new Promise(((t,o)=>{if(e.filterProxy&&e.NGFUXId){let n={fieldId:e.fieldId,onFilterApplied:function(){},onFilterCancelled:function(e){e&&!0===e.result||l&&l.isVisible()||x()}},r=e.data||null;r&&r.context&&a.push(s._openFilterV3({items:[{id:r.context,type:r.type,pprType:r.pprType,withFilter:!0,publicFilterSpec:e.publicFilterSpec}],onApply:async(l=[])=>{if(UWA.is(l,"array")){for(let t of l)if(UWA.is(t,"object")){let o;if(t.filterRootIds&&1===t.filterRootIds.length&&(o=t.filterRootIds[0],r.context===o))if(!0===t.empty)r.filter=null,r.withFilter=!1,r.publicFilterSpec=null,s._publish("onFilterRemoved",{fieldId:n.fieldId});else{t.CVQueryV2={filter:s._getCVQueryFilter(o,e.filterProxy,t)},r.filter=t.CVQueryV2.filter,r.withFilter=!0;let l=await i.getPublicFilterSpecification({proxy:e.filterProxy,NGFUXId:e.NGFUXId,rootId:o});r.publicFilterSpec=l,s._publish("onFilterApplied",{fieldId:n.fieldId}),n.onFilterApplied&&n.onFilterApplied(t)}}else s.logger.error("filterData is not valid, filterData should be an object");t()}else o("Callback is not valid, results should be an array"),s.logger.error("Callback is not valid, results should be an array")},onCancel:e=>{r.filter=null,r.withFilter=!1,s._publish("onFilterCancelled",{fieldId:n.fieldId}),n.onFilterCancelled&&n.onFilterCancelled(e),t()},showConfirmationDialog:!l||!l.isVisible(),filterProxy:e.filterProxy,NGFUXId:e.NGFUXId}))}else{let e="Invalid input, Unable to open/apply filter as filter Proxy and  NGFUXId is mandatory and is not available ";o(e),s._handleError(n,e,"DELOP_E01")}}))},v=async function(){await _({filterProxy:m.filterProxy,NGFUXId:m.NGFUXId,fieldId:d.Fields.ProcessContext,data:s.model.get("formData")?s.model.get("formData").process:null,publicFilterSpec:s.model.get("processPublicFilterSpec")})},S=async function(){await _({filterProxy:f.filterProxy,NGFUXId:f.NGFUXId,fieldId:d.Fields.MfgScopedItem,data:s.model.get("formData")?s.model.get("formData").mfg:null,publicFilterSpec:s.model.get("mbomPublicFilterSpec")})},I=async function(){await _({filterProxy:f.filterProxy,NGFUXId:f.NGFUXId,fieldId:d.Fields.Resource,data:s.model.get("formData")?s.model.get("formData").rsc:null,publicFilterSpec:s.model.get("resourcePublicFilterSpec")})},O=function(e){let t=s.model.get("formData"),o=E(d.Fields.Resource);if(1===e.length){let i=s.getPPRType(s.model.get("attributesMap")[e[0][0]].taxonomies)||this.PPRTYPES.RESOURCE;t.rsc={context:e[0][0],pprType:i,filter:o.filter,withFilter:!!UWA.is(o.filter),publicFilterSpec:o.publicFilterSpec}}else t.rsc=null},P=async function(e){let t=(e=UWA.is(e,"array")?e:[e]).map((e=>UWA.is(e,"string")?e:UWA.is(e,"array")?e[e.length-1]:null)),i=[],r=[],l=null;e.forEach((e=>{UWA.is(e,"array")&&e.length>0?(r.push(e),i.push(e[0])):i.push(e)}));let a=[...new Set(i)];1===a.length&&(l=a[0]);let c=s.model.get("formData");if(UWA.is(t,"array")&&t.length>0&&UWA.is(l)){let e,i=E(d.Fields.MfgScopedItem),a=s.getPPRType(s.model.get("attributesMap")[l].taxonomies)||this.PPRTYPES.MBOM;c.mfg={context:l,scopedMfg:t,contextOccurrence:r,pprType:a,filter:i.filter,withFilter:!!UWA.is(i.filter),publicFilterSpec:i.publicFilterSpec},!0===n.installAutoApplyVolume&&(e=await s.computeVolumeFilterV2(c.mfg.context,c.mfg.scopedMfg,{installVolumeOffSet:n.installVolumeOffSet,withFilter:n.withFilter}),e&&s.model.set("mbomPublicFilterSpec",e));let p=n.buildId;if(p&&!0===n.withFilter){s.logger.debug(`Apply filter for the unit ${p}`);let e=await s.getUnitFilterExpression(c.mfg.context,p),t=s.model.get("mbomPublicFilterSpec"),i=t?o.mergeFilterSpecification(t,e,o.ENUMS.FILTER_COMBINATION_SPEC.INTERSECTION):e;i&&s.model.set("mbomPublicFilterSpec",i)}UWA.is(s.model.get("mbomPublicFilterSpec"))&&await S(),F()}},D=async function(t=[]){let o=s.model.get("formData");if(1===t.length){let i=t[0],a=i[0],c=e.getImplicitFilterForProcessContext(r,n.id,a),p=E(d.Fields.ProcessContext),u=s.getPPRType(s.model.get("attributesMap")[a].taxonomies)||this.PPRTYPES.PROCESS;o.process={context:a,contextOccurrence:i,pprType:u,withFilter:n.withFilter,implictFilter:c,filter:p.filter,reframe:UWA.is(n.reframe)?n.reframe:null,operation:UWA.is(n.operation)?n.operation:null},n.withFilter&&l.toggleProcessFilterVisibility(!c),n.publicFilterSpec&&(s.model.set("processPublicFilterSpec",n.publicFilterSpec),await v())}else o.process=null;!async function(){let t=s.model.get("formData"),o=t.process&&t.process.context?t.process.context:null;var i=e.getResourceOccurrence(r,n.id,o);y(d.Fields.Resource,i,E(d.Fields.Resource))}(),function(){let t=s.model.get("formData"),o=t.process&&t.process.context?t.process.context:null;var i=e.getAllMfgContextOccurrence(r,n.id,o);y(d.Fields.MfgScopedItem,i,E(d.Fields.MfgScopedItem))}()};if(!(n&&n.onOpen&&n.onError&&n.onCancel))throw new Error("Invalid input, please check the input params");try{s._showMask(),(()=>{const e={ProcessContext:D,MfgScopedItem:P,Resource:O,ProcessContextFilter:v,MfgScopedItemFilter:S,ResourceFilter:I};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&c.push(s.subscribe({event:`on${t}Select`},(function(o){let i=o?o.data:null;s.logger.debug(`Value of the ${t} is ${i}`),e[t](i)})))})(),c.push(s.subscribe({event:"onProcessFormDisplayed"},s._removeMask.bind(s))),await async function(){return r=await s.getContextScope(n.id),r=await s.updateScopedManuAssemWithContext(n.id,r),r=await s.updateResourceToContext(n.id,r),n.withFilter&&(r=await s.updateImplicitFilterToContext(n.id,r)),s.model.set("context",r),r}(),await C(),((t,o)=>{let i=e.getAllProcessContextOccurrences(t,o);i&&i.ids.length>0?(s.model.set("formData",{}),y(d.Fields.ProcessContext,i,E(d.Fields.ProcessContext))):(s.model.set("formData",{process:{context:n.id,type:n.type,pprType:s.PPRTYPES.PROCESS,withFilter:n.withFilter}}),F())})(r,n.id)}catch(e){s._removeMask(),s.logger.log(e),s._handleError(n,e.message,"DELOP_E00")}}}})),define("DS/DELWebOEROpenControlComp/mixins/OpenProcessV1Mixin",["DS/DELWebOEROpenControlComp/form/ProcessForm","DS/DELWebOEROpenControlComp/helper/ContextHelper","DS/DELWebOERCommonUtils/utils/CommonUtils","text!DS/DELWebOEROpenControlComp/assets/json/Constants.json"],(function(e,t,o,i){"use strict";const n=JSON.parse(i);return{_openProcess:async function(i){let r,l,s=this,a=[],c=()=>{let e=s.getModelEvents();s._publish("onFormClean"),a.forEach(e.unsubscribe),s.model.remove("attributes"),s.model.remove("formData"),s.model.remove("publicFilterSpec")},d=async function(){var e=[],t=s.model.get("formData");s._showMask();try{e.push(async function(){let e=s.model.get("formData"),t=await s.getCapableResource(e.process.context);UWA.is(t,"array")&&t.length>0&&(e.rsc={context:t[0].physicalid,pprType:s.PPRTYPES.RESOURCE})}()),e.push(async function(){let e,t=s.model.get("formData");t.mfg&&(e=t.mfg.contextOccurrence,e&&e.length>1&&(t.mfg.predecessors=await s.getInstallPredecessors(t.mfg.context,e[e.length-2])))}()),!0===i.usePublication&&e.push(async function(){let e,t,o,n=s.model.get("formData"),r=n.mfg?n.mfg.context:null,l=n.process?n.process.context:null,a=i.filterProxy,c=i.NGFUXId;l&&r&&!0===i.withFilter&&(t=await s.getPublicFilterSpecification({proxy:a,NGFUXId:c,rootId:r}),o=await s.getUnitId(t),o&&(e=await s.getPublishedRep({processId:l,unitId:o}),e&&(n.publishedRep={context:e})))}()),!0===i.enablePartFabrication&&e.push(s.isPartFabrication(s.model.get("formData")));let o=await Promise.all(e);i.enablePartFabrication&&Array.isArray(o)&&o.length>0&&t&&t.mfg&&(t.mfg.outofScope=o[o.length-1]),s._removeMask();let n={results:[function(){let e=function(e){var t,o;return e&&(o=e.contextOccurrence&&e.contextOccurrence.length>0?e.contextOccurrence[e.contextOccurrence.length-1]:e.context,Object.assign(e,{id:o,occurrence:e.contextOccurrence?1===e.contextOccurrence.length?[]:e.contextOccurrence:[]}),delete e.context,delete e.contextOccurrence,delete e.scopedMfg,t=e),t};var o=e(t.process),i=e(t.mfg),n=e(t.rsc),r=e(t.publishedRep);return o.scopedMfg=i,o.resource=n,o.publishedRep=r,o}()],version:i.version};i.onOpen(n)}catch(e){s._removeMask(),s.logger.log(e),s._handleError(i,`Error occurred while fetching resource/predecessors for mfg ${t&&t.mfg&&t.mfg.context?t.mfg.context:""}`,"DELOP_E00")}finally{c()}},p=()=>{let e=s.model.get("formData");c(),i.filterProxy&&e.mfg&&e.mfg.context&&i.filterProxy.resetNGFilterUI({appId:s.getExecutionContext().getSourceApp().getId(),widgetId:s.getWidgetComponent().getId(),roots:e.mfg.context}),i.onCancel()},u=async()=>{if(!0===i.showForm){let o=await this.getAttributeForIds(t.getAllPhysicalIds(r,i.id),Object.values(n.Attributes),Object.values(n.FileAttributes)),a=t.getInstallInstanceIds(r,i.id);if(a&&a.length>0){let e=await s.getEffectivityContent(a);UWA.extend(o,e,!0)}this.model.set("attributesMap",o);let c=Object.assign({},{onOpen:d,onCancel:p,modelEvents:s.getModelEvents(),container:this._getContainer()});l=new e(this.model,c)}else s.subscribe({event:"onGetFieldValue"},(e=>{let{fieldId:t,ids:o}=e&&e.data||{};o&&o.length>1&&this._handleError(i,`Multiple ids found for ${t}`,"DELOP_E02",{fieldId:t})}))},f=function(){l&&l.isVisible()?s._publish("onFormComplete"):d()},m=async e=>{let t=s.model.get("formData"),n=i.buildId;if(n&&!0===i.withFilter){s.logger.debug(`Apply filter for the unit ${n}`);let e=await s.getUnitFilterExpression(t.mfg.context,n),i=s.model.get("publicFilterSpec"),r=i?o.mergeFilterSpecification(i,e,o.ENUMS.FILTER_COMBINATION_SPEC.INTERSECTION):e;s.model.set("publicFilterSpec",r)}s._openFilter({items:[{id:t.mfg.context,type:t.mfg.type,pprType:t.mfg.pprType,withFilter:!0,publicFilterSpec:s.model.get("publicFilterSpec")}],onApply:(o=[])=>{UWA.is(o,"array")?o.forEach((o=>{if(UWA.is(o,"object")){let n;o.filterRootIds&&1===o.filterRootIds.length&&(n=o.filterRootIds[0],t.mfg.context===n&&(o.CVQueryV2={filter:s._getCVQueryFilter(n,i.filterProxy,o)},t.mfg.filter=o.CVQueryV2.filter,t.mfg.withFilter=!0,t.process.filter=o.CVQueryV2.filter,s._publish("onFilterApplied",{fieldId:e.fieldId}),e.onFilterApplied&&e.onFilterApplied(o)))}else s.logger.error("filterData is not valid, filterData should be an object")})):s.logger.error("Callback is not valid, results should be an array")},onCancel:o=>{t.mfg.filter=null,t.mfg.withFilter=!1,t.process.filter=null,t.process.withFilter=!1,s._publish("onFilterCancelled",{fieldId:e.fieldId}),e.onFilterCancelled&&e.onFilterCancelled(o)},showConfirmationDialog:!l||!l.isVisible(),filterProxy:i.filterProxy,NGFUXId:i.NGFUXId})},h=function(e,t){t&&t.ids&&t.ids.length>0&&(s._publish("onGetFieldValue",{fieldId:e,ids:t.ids}),1===t.ids.length&&s._publish(`on${e}Select`,t.ids[0]))},g=async function(e){let t=s.model.get("formData"),o=(r=[],(i=[e])&&(r=i.map((e=>e.split(n.Context.delimeter)[0]))),r);var i,r;o&&1===o.length&&(t.mfg.contextOccurrence=e.split(n.Context.delimeter),f())},b=function(){let e=s.model.get("formData");var o=t.getMfgInstallOccurrencesForContext(r,i.id,e.process.context,e.mfg.scopedMfg,e.mfg.context);h(n.Fields.MfgInstallOccurrence,o)},x=async function(e){let o=s.model.get("formData");o.mfg.context=e;let a,c={fieldId:n.Fields.MfgInstallContext,onFilterApplied:async function(e){let l=t.getMfgInstallOccurrencesForContext(r,i.id,o.process.context,o.mfg.scopedMfg,o.mfg.context),a=[];l&&UWA.is(l.ids,"array")&&l.ids.forEach((e=>a.push(e.split(n.Context.delimeter)))),e.filter=e.CVQueryV2.filter,e.paths=a;let c=await s.getInstallOccurrencesForFilter(e);UWA.is(c,"array")&&c.length>0?(c=c.map((e=>e.join(n.Context.delimeter))),h(n.Fields.MfgInstallOccurrence,{ids:c})):f()},onFilterCancelled:function(e){e&&!0===e.result||l&&l.isVisible()?b():p()}};try{!0===i.installAutoApplyVolume?(a=await s.computeVolumeFilter(o.mfg.context,o.mfg.scopedMfg,{installVolumeOffSet:i.installVolumeOffSet,withFilter:i.withFilter}),s.model.set("publicFilterSpec",a),m(c)):!0===i.withFilter?m(c):b()}catch(e){s._removeMask(),s.logger.log(e),s._handleError(i,e.message,"DELOP_E00")}},C=function(e){let o=s.model.get("formData"),a={fieldId:n.Fields.MfgScopedItem,onFilterApplied:function(){f()},onFilterCancelled:function(e){e&&!0===e.result||l&&l.isVisible()?f():p()}};o.mfg={context:e,scopedMfg:e,pprType:s.PPRTYPES.MBOM},t.getMfgInstallOccurrences(r,i.id,o.process.context,e).ids.length>0?function(){let e=s.model.get("formData");var o=t.getMfgInstallContext(r,i.id,e.process.context,e.mfg.context);h(n.Fields.MfgInstallContext,o)}():!0===i.withFilter?m(a):f()},F=function(e){let o=s.model.get("formData");var l;o.process.contextOccurrence=e.split(n.Context.delimeter),o.process.context,l=t.getMfgContext(r,i.id,s.model.get("formData").process.context),h(n.Fields.MfgScopedItem,l)},y=function(e){var o;s.model.get("formData").process={context:e,pprType:s.PPRTYPES.PROCESS,withFilter:i.withFilter},o=t.getProcessContextOccurrences(r,i.id,s.model.get("formData").process.context),h(n.Fields.ProcessContextOccurrence,o)};if(!(i&&i.onOpen&&i.onError&&i.onCancel))throw new Error("Invalid input, please check the input params");try{if(i.scopedMfg){if(i.scopedMfg=function(e){let t=e.occurrence?e.occurrence[0]:e.id,o=i.filterProxy.getFilterSpec(t,{V2:{}}),n={...e};return o&&(n.withFilter=!0,n.filter=o.filter),n}(i.scopedMfg),i.scopedMfg&&i.scopedMfg.id&&!i.scopedMfg.pprType){let e=await this.getTaxonomies([i.scopedMfg.id]);i.scopedMfg.pprType=this.getPPRType(e[i.scopedMfg.id])}if(i.resource&&i.resource.id&&!i.resource.pprType){let e=await this.getTaxonomies([i.resource.id]);i.resource.pprType=this.getPPRType(e[i.resource.id])}let e={results:[i],version:i.version};i.onOpen(e)}else s._showMask(),(()=>{const e={ProcessContext:y,ProcessContextOccurrence:F,MfgScopedItem:C,MfgInstallContext:x,MfgInstallOccurrence:g};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.push(s.subscribe({event:`on${t}Select`},(function(o){let i=o?o.data:null;s.logger.debug(`Value of the ${t} is ${i}`),e[t](i)})))})(),a.push(s.subscribe({event:"onProcessFormDisplayed"},s._removeMask.bind(s))),r=await s.getContextScope(i.id),s.model.set("context",r),await u(),(()=>{let e;e=t.getProcessContext(r,i.id),e&&e.ids.length>0?(s.model.set("formData",{}),h(n.Fields.ProcessContext,e)):(s.model.set("formData",{process:{context:i.id,type:i.type,pprType:s.PPRTYPES.PROCESS,withFilter:i.withFilter}}),f())})()}catch(e){s._removeMask(),s.logger.log(e),s._handleError(i,e.message,"DELOP_E00")}}}})),define("DS/DELWebOEROpenControlComp/OpenControlComp",["DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/DELWebOERCommonUtils/DELWebBaseComponent","DS/DELWebOERCommonUtils/mixins/TypesUtilsMixin","DS/DELWebOEROpenControlComp/mixins/OpenControlCompWebServicesMixin","DS/DELWebOEROpenControlComp/model/Model","DS/DELWebOEROpenControlComp/mixins/OpenControlPartFabricationMixin","DS/DELWebOEROpenControlComp/mixins/OpenProcessV1Mixin","DS/DELWebOEROpenControlComp/mixins/OpenProcessV2Mixin","DS/DELWebOEROpenControlComp/mixins/OpenProcessV3Mixin","DS/DELWebViewerCommon/DELCommonUtils","text!DS/DELWebOEROpenControlComp/assets/json/Constants.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp"],(function(e,t,o,i,n,r,l,s,a,c,d,p,u,f,m){"use strict";const h=JSON.parse(f);class g extends n{constructor(e={}){super(e),this.filterCommandHandlerId=e.filterCommandHandlerId}async initialize(){await super.initialize(),this.model=new s}async clean(){this.abortAllRequests(),await super.clean()}async destroy(){await super.destroy()}_publish(e,t){this.publish({event:e,data:{data:t,origin:"OpenController"}})}_showMask(){this.publish({event:"START_DEL_TPB",data:{stepValue:1,simulateProgressInStep:!0,fullBarForEachStep:!0,steps:[{weight:100,text:m.get("ProgressBar.Text.Loading")}]}})}_removeMask(){this.publish({event:"COMPLETE_DEL_TPB"})}async _openFilter(n={}){var r,l,s,a,c=this,d=n.items||[],p=n.showConfirmationDialog,f=n.onApply,h=n.onCancel,g=n.filterProxy,b=(n.NGFUXId,!1),x=[],C=c._getContainer(),F=function(t){e.removeModal(C),c.publish({event:"onFilterCancel",data:{data:t,origin:"DELWeb3DFilterCmd"}}),h&&h(t)};s=function(){r(),g.resetNGFilterUI({appId:c.getExecutionContext().getSourceApp().getId(),widgetId:c.getWidgetComponent().getId(),rootIds:d.map((e=>e.id))}),p?a():F({result:!1,filterData:d})},l=function(t){t&&!t.empty&&(x.push(t),b&&x.length!==d.length||(r(),e.removeModal(C),f&&f(x)))},r=function(){g.removeEvent("ApplyNGFilter",l),g.removeEvent("NGFilter_Close",s)},a=function(){var e,n,r,l=document.getElementsByClassName("wux-controls-modalContainer"),s=function(e){let t={result:e,filterData:d};n.removeEventListener("close",r),n.destroy(),F(t)};r=s.bind(s,!1),UWA.is(l,"array"),l.length>0?((e=new t({})).inject(l[0]),(n=new o({immersiveFrame:e,title:m.get("Dialog.Title"),content:m.get("Dialog.FilterCancelled.Message"),buttons:{Ok:new i({onClick:s.bind(s,!0)}),Cancel:new i({onClick:s.bind(s,!1)})}})).addEventListener("close",r)):c.logger.error("App Overlay container not found, so dialog cannot be created")},UWA.is(d,"array")&&d.length>0&&(g.addEvent("NGFilter_Close",s),g.addEvent("ApplyNGFilter",l),function(){let e=!1,t=d.filter((e=>e.filterSpec||e.publicFilterSpec));return t.length>0&&(e=!0,b=!0,t.forEach((async e=>{let t={rootID:e.id,rootAlias:e.label,applyFilter:1,displayFilter:0,forceUpdate:0,serviceId:"3DSpace"};e.publicFilterSpec&&(1===e.publicFilterSpec.displayFilter&&c._removeMask(),await u.setPublicFilterSpecification({proxy:g,publicFilterSpec:{...t,...e.publicFilterSpec}}))}))),e}()||(c.filterCommandHandlerId?(c._removeMask(),c.executeCommand({handlerId:c.filterCommandHandlerId,args:{items:d.map((e=>({id:e.id,filtered:!1}))),NGFUXId:n.NGFUXId}})):c._handleError(n,"Unable to open/apply filter as filterCommandHandlerId is not available","DELOP_E00")),e.createModal(C,document.createElement("span")))}_getContainer(){return this.mainContainer||(this.mainContainer=this.getUIFrameComponent().addLayer(UWA.Element.create("div",{class:"del-oer-open-control-container"}),{top:0,bottom:0,right:0,left:0,zIndex:1e5,pointerEvents:"none",class:"del-oer-open-control-container-layer"})),this.mainContainer}_getCVQueryFilter(e,t,o={}){let i=o.CVQueryV2;return i&&!i.batch||(i=t.getFilterSpec(e,{V2:{}})),i&&i.filter?i.filter:null}async _open(e={}){let t=this,o=e.items||[],i=o.filter((e=>!0===e.withFilter||e.publicFilterSpec||e.filterSpec)),n=function(e=[]){return o.forEach(((t,i)=>{let n=e.find((e=>e.id===t.id));n?o[i]=n:t.withFilter=!1})),o},r=async function(o){let i=!1;if(!0===e.enablePartFabrication)try{i=await t.isPartFabrication(o),o.forEach((e=>{e.outofScope=i}))}catch(e){t.logger.error("Part Fabrication check failed due to -",e)}let n={results:o,version:e.version};"V1"===e.version?e.onOpen(n):t._executeHander(e.onOpen,n)};if(!(e&&e.items&&e.onOpen&&e.onCancel&&e.onError))throw new Error("Invalid input, mandatory params are missing, please check the input params");i.length>0?e.filterProxy&&e.NGFUXId?t._openFilter({items:i,onApply:async(o=[])=>{if(UWA.is(o,"array")){o.forEach(((o={})=>{if(UWA.is(o,"object")){let n=UWA.is(o.filterRootIds,"array")?o.filterRootIds[0]:null;n&&i.forEach((function(i){i.id===n&&(i.withFilter=!0,i.filter=t._getCVQueryFilter(n,e.filterProxy,o))}))}else t.logger.error("filterParam is not valid, filterParam should be an object")}));let l=n(i);r(l)}else t.logger.error("Callback is not valid, results should be an array")},onCancel:async t=>{if(t&&t.result&&t.filterData){t.filterData.forEach((function(e){e.withFilter=!1}));let e=n(i);r(e)}else"V1"===e.version?e.onCancel():this._executeHander(e.onCancel)},showConfirmationDialog:!0,filterProxy:e.filterProxy,NGFUXId:e.NGFUXId}):t._handleError(e,"Invalid input, Unable to open/apply filter as filter Proxy and NGFUXId is mandatory and is not available ","DELOP_E01"):r(o)}async _executeHander(e,t){let o=e.handler,i=e.args,n=this.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent);o&&n.hasHandler(o)?n.executeHandler({id:o,args:{...t,...i}}):this.logger.warn(`${o} Handler not found, please include correct package in your app id card`)}_handleError(e,t,o="DELOP_E00",i){let n=i?h.ErrorCodes[o].replace({}):h.ErrorCodes[o],r=m.replace(m.get(n),i);if(this.logger.debug(t),!e.onError)throw this.logger.error(t),this.logger.error("onError hander is not available, please provide onError to manage errors"),new Error(r);{let t={results:[],error:{code:o,message:r},version:e.version};"V1"===e.version?e.onError(t):this._executeHander(e.onError,t)}}async open(e){let t,o=this;if(!(e&&UWA.is(e.items,"array")&&e.onOpen&&e.onError&&e.onCancel))throw new Error("Invalid input, please check the input params");if(this.logger.debug("OpenControl open invoked with params",e),e&&e.items){if(e.items.length>0)if(t=await this.getTaxonomies(e.items.map((e=>e.id))),e.items.forEach((function(e){e.pprType=o.getPPRType(t[e.id])})),e.items.some((e=>r.isProcess(e.pprType))))if(1===e.items.length){let t={...e.items[0],showForm:e.showForm,container:e.container,onOpen:e.onOpen,onCancel:e.onCancel,onError:e.onError,filterProxy:e.filterProxy,NGFUXId:e.NGFUXId,filterProxies:e.filterProxies,enablePartFabrication:e.enablePartFabrication,version:e.version?e.version:"V1",args:e.args};switch(e.version){case"V1":this.logger.warn("Version V1 is deprecated and will be removed from 25x FD04, use version V3 of open."),this._openProcess(t);break;case"V2":this._openProcessV2(t);break;case"V3":this._openProcessV3(t);break;default:this.logger.warn("Use version V2 or V3 of open, default version V1 is deprecated and will be removed from 25x FD04"),this._openProcess(t)}}else this._handleError(e,`${this.PPRTYPES.PROCESS} type not supported in MultiRoots Scenarios`,"DELOP_E04",{type:this.PPRTYPES.PROCESS});else switch(e.version){case"V1":this.logger.warn("Version V1 is deprecated and will be removed from 25x FD04, use version V3 of open."),this._open(e);break;case"V2":this._open(e);break;case"V3":this._openV3(e);break;default:this.logger.warn("Use version V2 or V3 of open, default version V1 is deprecated and will be removed from 25x FD04."),this._open(e)}}else this._handleError(e,"items property is missing","DELOP_E01")}getProxy(){}getExposedComponent(){return this.publicAPI=super.getExposedComponent(),this.publicAPI.open=this.open.bind(this),this.publicAPI}}return g.prototype.mixinProperties(g,l),g.prototype.mixinProperties(g,r),g.prototype.mixinProperties(g,a),g.prototype.mixinProperties(g,c),g.prototype.mixinProperties(g,d),g.prototype.mixinProperties(g,p),g}));