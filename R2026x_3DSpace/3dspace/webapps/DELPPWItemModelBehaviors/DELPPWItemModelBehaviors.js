define("DS/DELPPWItemModelBehaviors/ImplementBehaviorBase",["UWA/Core","UWA/Class/Promise"],(function(e,t){"use strict";return function(n,o,i,r,a,s,c,l,u){const g="ProcessImplementLink";var f,m,p,d,I=function(t,n,i,r){var s=e.is(t)?a.getNLSValue(t):n;o.info(s,i),r&&r(s)},S=function(t,n,i,r,s){var c=e.is(t)?a.getNLSValue(t):i;e.is(n,"string")&&n.length>0&&(c=n),o.warn(c,r),s&&s(c)};return f=function(e,t,n,i,r,c){var l,u,f={},m=a.getNLSValue("ImplementBehavior.CreateScope.LogMessage"),p=a.getNLSValue("ImplementBehavior.CreateScope.Success"),P=a.getNLSValue("ImplementBehavior.CreateScope.Failed"),h=o.log(m),y=function(e){I(e,p,h,r),o.notify("linkCreated",f)},L=function(e,t){S(e,t,P,h,c)};l=s.canCreateScopeLink({fromSideRefPID:e,toSideRefPID:t,fromSideAbsPath:n,toSideAbsPath:i});const A=o.getPreferenceValue("copyModelProductToItemUponSL");l.canCreateLink?s.getScopeLinkType()===g?s.createScopeLink(e,t,{onComplete:y,onFailure:L,copyModelProductToItemUponSL:A}):(u=d(n)).hasImplementLink?L(null,a.getNLSValue("ImplementBehavior.Validation.ImplLinkExists",{obj1:u.implementingName,obj2:u.implementedName})):s.createScopeLink(e,t,{onComplete:y,onFailure:L,copyModelProductToItemUponSL:A}):L(null,l.errorMessage)},m=function(t,n,r,c){var u,f,m,p,P,h,y,L,A=[],v=a.getNLSValue("ImplementBehavior.CreateScope.LogMessage"),R=a.getNLSValue("ImplementBehavior.CreateScope.Success"),M=a.getNLSValue("ImplementBehavior.CreateScope.Failed"),C=o.log(v),D=function(t,n){I(t,R,C,r),e.is(n)&&(n.connections.forEach((function(e){A.push(e.toJSON())})),o.notify("createImplementLink",A))},k=function(e,t){S(e,t,M,C,c)};if(e.is(t,"array")&&t.length>0&&e.is(n,"array")&&n.length>0){f=t[t.length-1],u=i.getReferenceIdFromInstance(f),p=n[n.length-1],m=i.getReferenceIdFromInstance(p),L=s.canCreateScopeLink({fromSideRefPID:u,toSideRefPID:m,fromSideInstPID:f,toSideInstPID:p,fromSideAbsPath:t,toSideAbsPath:n});const e=o.getPreferenceValue("copyModelProductToItemUponSL");if(L.canCreateLink)if(s.getScopeLinkType()===g)s.createScopeLink(u,m,{onComplete:D,onFailure:k,copyModelProductToItemUponSL:e});else if(s.validateIfScoped(t,n))(y=d(t,n)).hasImplementLink?y.withSameProduct?s.createScopeLink(u,m,{onComplete:D,onFailure:k,copyModelProductToItemUponSL:e,implementLinks:y.implementLinks}):k(null,a.getNLSValue("ImplementBehavior.Validation.ImplLinkExists",{obj1:y.implementingName,obj2:y.implementedName})):(P=s.getPathToPartialOrFullScope(t,n),h=s.getImplementingPathsToPartialOrFullScope(t),s.createScopeAndImplementLink(u,h,m,P,{onComplete:D,onFailure:k,copyModelProductToItemUponSL:e}));else{if(o.getPreferenceValue("skipVaidationIfScopedCheck")&&l.isAKindOf(undefined,"Provide"))return void s.createScopeLink(u,m,{onComplete:D,onFailure:k,copyModelProductToItemUponSL:e});k(null,a.getNLSValue("ImplementBehavior.Validation.ScopeNotValid"))}else k(null,L.errorMessage)}else o.debug("Input parameters are invalid."),k()},d=function(t,n){var o,r,a,c,l,u,g,f=!1,m=!1,p=null,d=null;return o=e.is(t,"array")&&t.length>0?s.getImplLinksOfImplementing(t):null,e.is(o,"array")&&o.length>0&&(f=!0,e.is(n)&&!0===(m=o.some((function(t){const o=e.is(n,"array")&&n.length>0?n[n.length-1]:n;return e.equals(t.get("to"),[o])})))&&(g=o),c=(u=o[0]).getAttribute("from"),l=i.getReferenceModel(c),e.is(l)&&(d=l.get("PLMEntity.V_Name")),r=u.getAttribute("to"),a=i.getReferenceModel(r),e.is(a)&&(p=a.get("PLMEntity.V_Name"))),{hasImplementLink:f,withSameProduct:m,implementingName:d,implementedName:p,implementLinks:g}},p=function(n,o,r,a){var c,l,u;return e.is(n,"array")&&n.length>0&&s.isUnderScope(n)&&e.is(r,"array")&&r.length>0?(l=n,u=r,c=new t((function(e,t){m(l,u,e,t)}))):c=function(e,n,o,r){return new t((function(t,a){var s=i.isReference(e)?e:i.getReferenceIdFromInstance(e),c=i.isReference(n)?n:i.getReferenceIdFromInstance(n);f(s,c,o,r,t,a)}))}(o,a,n,r),c},{onStart:function(){},isScoped:function(e){return s.isScoped(e)},isPartialScoped:function(e){return s.isPartialScoped(e)},getPartialScopeLinkType:function(){return s.getPartialScopeLinkType()},getScopeLinkType:function(){return s.getScopeLinkType()},getImplementLinkType:function(){return s.getImplementLinkType()},getScopeLinksOfImplemented:function(e){return s.getScopeLinksOfImplemented(e)},getPartialScopeLinks:function(e){return s.getPartialScopeLinks(e)},getPathToScope:function(e){return s.getPathToScope(e)},findInstanceWhoseParentIsScoped:function(e){return s.findInstanceWhoseParentIsScoped(e)},createScopeLink:function(n){var r,a={},s=[];return e.is(n,"array")&&n.length>0?(o.notify("startProgress",a),s=n.map((function(e){return p(e.implementingAbsPath,e.implementingPID,e.implementedAbsPath,e.implementedPID,e.isPartialScope)})),r=t.allSettled(s).then((function(){var r,s=u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),c=[],g=i.isReference(n[0].implementingPID)?n[0].implementingPID:i.getReferenceIdFromInstance(n[0].implementingPID),f=i.isReference(n[0].implementedPID)?n[0].implementedPID:i.getReferenceIdFromInstance(n[0].implementedPID);r=i.getReferenceModel(g),l.isAKindOf(r.get("type"),"Provide")||l.isAKindOf(r.get("type"),"DELServicePartReference")?i.getCurrentStates([f],s,(function(n){e.is(n)&&"RELEASED"===n.get(f)?((widget.getValue("isReleaseMaturitySynced")||o.getPreferenceValue("isReleaseSyncXENEnabled")&&widget.getValue("fromXen"))&&c.push(new t((function(e,t){i.syncMaturity([r],s,widget.getValue("isChangeRequiredSynced")||o.getPreferenceValue("isReleaseSyncXENEnabled")&&widget.getValue("fromXen"),e,t)}))),t.all(c).then((function(){var e=[];e.onComplete=function(){o.notify("referenceChanged",r),o.notify("stopProgress",a)},e.onFailure=function(){o.notify("referenceChanged",r),o.notify("stopProgress",a)},e.forceDBMode=!0,i.fetchRoot(r.get("PID"),e)}))):o.notify("stopProgress",a)})):(o.notify("referenceChanged",r),o.notify("stopProgress",a))}))):(o.debug("Input parameters are invalid."),r=t.reject("ImplementBehavior.Validation.InvalidInput")),r},createImplementLink:function(t,n,r,c){var l,u,g,f,m=a.getNLSValue("ImplementBehavior.Validation.ScopeNotValid"),p=function(t,n){var o=e.is(t)?a.getNLSValue(t):null;e.is(n)&&(o=n),u.errorMessage=o,c(u)};if(u={linkType:t.type,target:i.getReferenceModel(t.implementingAbsPath[t.implementingAbsPath.length-1]).get("PID"),source:i.getReferenceModel(t.implementedAbsPath[t.implementedAbsPath.length-1]).get("PID")},e.is(t.fromSideAbsPath)&&e.is(t.fromSideAbsPath)||(t.fromSideAbsPath=t.implementingAbsPath,t.toSideAbsPath=t.implementedAbsPath),e.is(t.fromSideRefPID)||(t.fromSideRefPID=t.implementingPID),s.canCreateImplementLink(t).canCreateLink){let n=s.isPartialScoped(t.fromSideRefPID)?[t.fromSideRefPID]:t.implementingAbsPath,i=t.implementedAbsPath;g=(l=s.getPathsToScope(n,i)).implementingPathToScope,f=l.implementedPathToScope,e.is(g)&&e.is(f)?s.createImplementLink(g,f,{connectionParams:t.connectionParams,onComplete:function(e,t){o.notify("createImplementLink",t.toJSON()),r(u)},onFailure:p}):p(null,m)}else p(null,m)},deleteScopeLink:function(n){var i,r,c={},l=[],u=e.is(n,"array")?n:[n],g=a.getNLSValue(this.getScopeLinkType()),f=a.getNLSValue("DeleteLink.LogMessage",{linkType:g}),m=a.getNLSValue("DeleteLink.Success",{linkType:g}),p=a.getNLSValue("DeleteLink.Failure",{linkType:g});return u.length>0?(o.notify("startProgress",c),u.forEach((function(n){r=s.getScopeLinksOfImplementing(n),e.is(r)&&r.length>0&&(l=r.map((function(e){return new t((function(t,n){!function(e,t,n){var i=o.log(f);s.deleteScopeLink(e,{onComplete:function(e,n){I(e,m,i,t),o.notify("linkDeleted",[n.deletedConnections])},onFailure:function(e,t){S(e,t,p,i,n)}})}(e.get("PID"),t,n)}))})))})),i=t.allSettled(l).then((function(){o.notify("stopProgress",c)}))):(o.debug("Unable to delete scope links as input parameters are invalid."),i=t.reject("ImplementBehavior.Validation.InvalidInput")),i}}}})),define("DS/DELPPWItemModelBehaviors/MfgItemBehavior",["UWA/Core"],(function(e){"use strict";return{plugins:["MfgItemPlugin","ResourcePlugin","BIPlugin","DatabasePlugin","PlatformPlugin","WebServicePlugin"],creator:function(t,n,o,i,r,a,s,c){return{webservice:function(t,c,l,u){var g,f,m,p,d,I,S,P,h,y,L,A,v,R={noTimeout:!0},M={},C={silentMode:!0,updateItem:!0},D="";n.notify("startProgress",R);const k=n.getPreferenceValue("copyModelProductToItemUponSL"),b=n.getPreferenceValue("copyModelParentToChild"),V=["Ignored","Failed","PartiallySuccess"];if(e.is(l)&&e.is(l.logMessage)&&(f=n.log(l.logMessage)),(c=c||{}).product&&(p=c.product.referencePID,S=c.product.OccPath,D=e.is(c.product.productConfigFilter)?c.product.productConfigFilter:""),c.mfgItem&&(d=c.mfgItem.referencePID,P=c.mfgItem.instancePID,v=c.mfgItem.topRootMfgItemPID),y=function(t){e.is(I)&&n.notify(I,M),e.is(t)?n.notify("updateBIModelFromServerResponse",t):(n.info(l.logMessage+" "+i.getNLSValue("completed"),f),r.getBICmdState()),n.notify("stopProgress",R)},h=function(t){var o,i,r=[];return t.instancesAndReferences.forEach((function(t){o=t.attributesValue,!!e.is(o.isInstanceOf)&&(i=a.getInstance(o.PID),e.is(i)&&n.notify("instanceAdded",[i,C]))})),t.connections.forEach((function(e){r.push(a.getConnection(e.PID))})),r.length>0&&n.notify("connectionAdded",[r]),r},"Create"===t){if(s.isCreateMBOMv2()){const{rawXMLPhantomNodeConfig:t,rawXMLLinkAuthoringConfig:r}=this.getRawXMLsRequired4CreateMBOM();return m={rootProductID:p,productOccPath:Array.isArray(S)?S.join(","):"",rootMfgItemID:d,engConfigFilter:D,mfgInstanceID:e.is(P)?P:"",scopeCreation:l.scopeCreation,prefix:l.prefix,computeResultReport:!!e.is(l.computeResultReport)&&l.computeResultReport,isOpennessComputationRequired:l.isOpennessComputationRequired,topRootMfgItemPID:v,copyModelProductToItemUponSL:k,copyModelParentToChild:b,xmlPhantomNodeConfig:e.is(t,"string")?t:null,xmlLinkAuthoringConfig:e.is(r,"string")?r:null},void o.callScalCreateMBOM(m).then((e=>{n.info(i.getNLSValue("CreateMfgItemStructure.jobSubmit.Success")),n.notify("stopProgress",R)})).catch((t=>{e.is(t)&&e.owns(t,"message")&&"MfgItem_has_children"===t.message?n.warn(i.getNLSValue("JobStatusUI.jobSubmit.Resubmit")):n.warn(i.getNLSValue("CreateMfgItemStructure.jobSubmit.Fail")),n.notify("stopProgress",R)}))}g="POST",I="createMfgItemStructure",m=e.Json.encode({rootProductID:p,productOccPath:Array.isArray(S)?S.join(","):"",rootMfgItemID:d,engConfigFilter:D,mfgInstanceID:e.is(P)?P:"",scopeCreation:l.scopeCreation,prefix:l.prefix,computeResultReport:!!e.is(l.computeResultReport)&&l.computeResultReport,topRootMfgItemPID:v,copyModelProductToItemUponSL:k,copyModelParentToChild:b}),l.onComplete=function(t,o,r){if(e.is(r.resultReport)&&e.is(r.resultReport.GlobalErrors,"array")){const t=r.resultReport,o=Object.values(t);let a=[];for(let t=0;t<o.length;t++)for(let n=0;n<o[t].length;n++){const i=o[t][n].Status;V.includes(i)&&a.push(o[t][n].ErrorMessages),e.is(o[t][n].Messages)&&e.is(o[t][n].Messages.UserMessage,"string")&&o[t][n].Messages.UserMessage.length>0&&a.push(o[t][n].Messages.UserMessage)}return a.length>0&&n.warn(l.logMessage+" "+i.getNLSValue("failed"),f),e.is(u)&&u(r),void n.notify("stopProgress",R)}(L=a.getReference(t)).setAdditionalInfo({queriedForConnections:!0}),n.notify("referenceAdded",[L,"",C]),e.is(u)&&u(r),y(r)}}else if("Update"===t){const t=e.is(c.mfgItem.processConfigFilter)?c.mfgItem.processConfigFilter:"";if(!0===l.backgroundJobFlag){const{rawXMLPhantomNodeConfig:r,rawXMLExpandNodeConfig:a,rawXMLLinkAuthoringConfig:s}=this.getRawXMLsRequired4UpdateMBOM();return m={mbomUpdateMode:"mbomPull",rootProductID:p,rootMfgItemID:d,backgroundJobflag:l.backgroundJobFlag,scopeCreation:l.scopeCreation,prefix:l.prefix,engConfigFilter:D,mfgConfigFilter:t,updateIntermediateScopedAssemblies:l.updateIntermediateScopedAssemblies,computeResultReport:!1,topRootMfgItemPID:v,copyModelProductToItemUponSL:k,copyModelParentToChild:b,xmlPhantomNodeConfig:e.is(r,"string")?r:null,xmlExpandNodeConfig:e.is(a,"string")?a:null,xmlLinkAuthoringConfig:e.is(s,"string")?s:null},void o.callScalUpdateMBOM(m).then((e=>{n.info(i.getNLSValue("UpdateMfgItemStructure.jobSubmit.Success")),n.notify("stopProgress",R)})).catch((e=>{n.warn(i.getNLSValue("UpdateMfgItemStructure.jobSubmit.Fail")),n.notify("stopProgress",R)}))}I="updateMfgItemStructure",g="PUT",m=e.Json.encode({mbomUpdateMode:"mbomPull",rootProductID:p,rootMfgItemID:d,backgroundJobflag:l.backgroundJobFlag,scopeCreation:l.scopeCreation,prefix:l.prefix,engConfigFilter:D,mfgConfigFilter:t,updateIntermediateScopedAssemblies:l.updateIntermediateScopedAssemblies,computeResultReport:!0,topRootMfgItemPID:v,copyModelProductToItemUponSL:k,copyModelParentToChild:b}),l.onComplete=function(t,o,r,s){if(!e.is(t)){const t=r.resultReport,o=Object.values(t);let a=[];for(let t=0;t<o.length;t++)for(let n=0;n<o[t].length;n++){const i=o[t][n].Status;V.includes(i)&&a.push(o[t][n].ErrorMessages),e.is(o[t][n].Messages)&&e.is(o[t][n].Messages.UserMessage,"string")&&o[t][n].Messages.UserMessage.length>0&&a.push(o[t][n].Messages.UserMessage)}return a.length>0?(n.warn(i.getNLSValue("Info.PartialUpdate.Title"),f),a.forEach((function(e){n.log(e,f)}))):n.info(i.getNLSValue("Info.NoUpdate.Title"),f),void n.notify("stopProgress",R)}e.is(o)?(L=a.getReference(o),n.notify("referenceAdded",[L,"",C])):e.is(s)&&s?(A=a.getReference(p),n.notify("referenceAdded",[A,"",C]),h(r)):h(r),y(r)}}else"rerouteScopeLink"!==t&&"rerouteLink"!==t||(g="POST",m=e.Json.encode(l),l=e.merge(l,{appenedURL:"RerouteMfgItem"}),(l=e.merge(l,{logMessage:i.getNLSValue("MIL.LogMessage")})).onComplete=function(t,o,i){var r,a;r=i.succeeded,(a=Object.keys(r)).length>0&&(I="RerouteMfgItem",a.forEach((function(t){var o=r[t];Object.keys(o).forEach((function(t){const i=h(o[t]);e.is(i)&&i.length>0&&n.notify("connectionAddedInvokeBI",[i])}))}))),e.is(u)&&u(i),y(i)});l.onFailure=function(t){if(e.is(l.logMessage)){let o=l.logMessage+" "+i.getNLSValue("failed");e.is(t)&&(o=o+". "+t.message),n.warn(o,f)}n.notify("stopProgress",R),e.is(u)&&u()},o.webserviceAndProcessing(g,m,l)},getRawXMLsRequired4CreateMBOM:function(){return{rawXMLPhantomNodeConfig:c.getServerConfigurationRawXML("DELWebMfgAssetsPhantomNodeConfig.xml"),rawXMLLinkAuthoringConfig:c.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml")}},getRawXMLsRequired4UpdateMBOM:function(){return{rawXMLPhantomNodeConfig:c.getServerConfigurationRawXML("DELWebMfgAssetsPhantomNodeConfig.xml"),rawXMLExpandNodeConfig:c.getServerConfigurationRawXML("DELWebMfgAssetsExpandNodeConfig.xml"),rawXMLLinkAuthoringConfig:c.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml")}},getBrokenMfgItemStatus:function(e,t){r.getBrokenMfgItemStatus(e,t)},getPhantomNodeItems:function(){return r.getPhantomNodeItems()},getBIModel:function(e){return r.getBIModel(e)},getJobStatuses:function(){return o.getJobStatuses()},isCreateMBOMv2:function(){return s.isCreateMBOMv2()},isUpdateMBOMv2:function(){return s.isUpdateMBOMv2()},createMBOMOnResubmit:function(e,t){return o.createMBOMOnResubmit(e,t)},updateMBOMOnResubmit:function(e,t){return o.updateMBOMOnResubmit(e,t)},refreshMBOMJob:function(e){return o.refreshMBOMJob(e)},getReferenceTypes:function(e){return o.getReferenceTypes(e)}}}}})),define("DS/DELPPWItemModelBehaviors/SpecifyScopeIntentDialog",["UWA/Core"],(function(e){"use strict";return function(t,n){const o=function(o,i,r){const a=[n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.message.line1"),n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.message.line2")].map((e=>`<p>${e}</p>`)).join("");let s=e.createElement("div",{class:"specifyScopeIntent-container",html:a}),c=e.createElement("div",{class:"specifyScopeIntent-content-container"});s.inject(c),"function"!=typeof i?function(o,i,r){let a=t.create("Dialog",{title:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Title"),domId:"specifyScopeIntentDialog",identifier:"specifyScopeIntentDialog",content:o,minHeight:150,minWidth:400,modalFlag:!0,resizableFlag:!0,customButtonsDefinition:[{label:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Button.Cancel"),emphasize:"primary",onClick:function(){e.is(i,"function")&&i(),a.close()}},{label:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Button.Fabrication"),emphasize:"secondary",onClick:function(){e.is(r,"function")&&r(),a.close()}}]});a.close=function(){this.destroy()}}(c,o,r):"function"!=typeof r?function(o,i,r){let a=t.create("Dialog",{title:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Title"),domId:"specifyScopeIntentDialog",identifier:"specifyScopeIntentDialog",content:o,minHeight:150,minWidth:400,modalFlag:!0,resizableFlag:!0,customButtonsDefinition:[{label:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Button.Cancel"),emphasize:"primary",onClick:function(){e.is(i,"function")&&i(),a.close()}},{label:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Button.Assembly"),emphasize:"secondary",onClick:function(){e.is(r,"function")&&r(),a.close()}}]});a.close=function(){this.destroy()}}(c,o,i):function(o,i,r,a){let s=t.create("Dialog",{title:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Title"),domId:"specifyScopeIntentDialog",identifier:"specifyScopeIntentDialog",content:o,minHeight:150,minWidth:400,modalFlag:!0,resizableFlag:!0,customButtonsDefinition:[{label:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Button.Cancel"),emphasize:"primary",onClick:function(){e.is(i,"function")&&i(),s.close()}},{label:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Button.Assembly"),emphasize:"secondary",onClick:function(){e.is(r,"function")&&r(),s.close()}},{label:n.getNLSValue("ImplementBehavior.SpecifyScopeIntent.Button.Fabrication"),emphasize:"secondary",onClick:function(){e.is(a,"function")&&a(),s.close()}}]});s.close=function(){this.destroy()}}(c,o,i,r)};return{show:function(e,t,n){o(e,t,n)}}}})),define("DS/DELPPWItemModelBehaviors/AssignProductBehavior",["UWA/Core","DS/DELPPWItemModelBehaviors/SpecifyScopeIntentDialog"],(function(e,t){"use strict";return{plugins:["DatabasePlugin","ResourcePlugin","WebServicePlugin","ProductImplementPlugin","AttributePlugin","DicoPlugin"],creator:function(n,o,i,r,a,s,c,l){var u,g,f,m,p,d;return u=function(t,n,r,c,l,u){var g,f,m,p,d=0,I=0,S={instancesAndReferences:[],connections:[]},P=a.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),h=a.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml");u=u||{},e.is(u.securityContextOverride,"string")&&(P.SecurityContext=u.securityContextOverride),m=function(t,n){e.is(u.onFailure,"function")&&u.onFailure(n)},f=function(t){var n=i.getConnectionParser(),a={stackedReferences:[],stackedInstances:[],stackedConnections:[]},s={queriedForConnections:!0},c={queriedForChildren:!0,queriedForConnections:!0,queriedForDocuments:!1};e.is(t)&&(e.is(t.instancesAndReferences)&&t.instancesAndReferences.forEach((function(t){var n,o,i=t.attributesValue;Object.prototype.hasOwnProperty.call(i,"isInstanceOf")?(n=e.merge(i,s),a.stackedInstances.push(n),e.is(t["to.attributesValue"])&&(o=e.merge(t["to.attributesValue"],c),a.stackedReferences.push(o))):(o=e.merge(i,c),a.stackedReferences.push(o))})),e.is(t.connections)&&t.connections.forEach((function(e){n.parse(e,a)})),a.onComplete=function(n){var i=[];(!e.is(n.instancesAndReferences)||n.connections.length<2/*!UWA.is(scopeConnModel) || !UWA.is(implConnModel)*/)&&o.debug("Instance or scope or implement model is empty for instance PID:"+t.instancesAndReferences[0].attributesValue.PID),n.instancesAndReferences.forEach((function(e){e.isInstance()&&i.push(e)})),o.notify("instanceAdded",i),n.instancesAndReferences.forEach((function(e){"PROCESS"===e.toJSON().PPRTYPE&&S.instancesAndReferences.push(e.toJSON())})),n.connections.forEach((function(e){S.connections.push(e.toJSON())})),o.notify("connectionAdded",[n.connections]),I++,r.length===I&&(e.is(u.onComplete,"function")&&u.onComplete(n),o.notify("assignProduct",S)),o.notify("updateBIModelFromServerResponse",t)},i.addToCollections(a))};let y=s.getImplementingPathsToPartialOrFullScope(n);if(Array.isArray(y)&&1===y.length){!0===(s.isScoped(y)||s.isPartialScoped(y))&&(y=[])}p={processID:t,processUpperScopePath:e.Json.encode(y)},e.is(h,"string")&&(p.xmlLinkAuthoringConfig=h),r.forEach((function(t){var n=e.clone(p),r=e.clone(l[d]);g=i.getReferenceModel(t),n.productPath=e.Json.encode(c[d]),n.productRefPID=g.get("PID"),n.type=r.V_Type,n.attributes=r;const s=o.getPreferenceValue("copyModelProductToItemUponSL");n.copyModelProductToItemUponSL=s;const u=o.getPreferenceValue("copyModelParentToChild");n.copyModelParentToChild=u,Object.prototype.hasOwnProperty.call(r,"PLMEntity.V_Name")||(r["PLMEntity.V_Name"]=g.get("PLMEntity.V_Name")),a.webServiceRequest({url:"dsmfg/private/V0/invoke/assignproduct",method:"POST",headers:P,context:this,data:e.Json.encode(n),onComplete:f,onFailure:m,onTimeout:m,onCancel:m}),d++}),this)},g=function(t,n,o,i){return new Promise((function(r,s){var c,l=a.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),u=i||{},g=a.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml");e.is(u.securityContextOverride,"string")&&(l.SecurityContext=u.securityContextOverride),c={productID:n,processType:o.V_Type,processData:o},e.is(g,"string")&&(c.xmlLinkAuthoringConfig=g),a.webServiceRequest({url:t,method:"POST",headers:l,data:e.Json.encode(c),onFailure:function(e,t){s(t)},onTimeout:s,onComplete:r})}))},f=function(t,n,r,a,s,c){var l=function(t){return new Promise((function(n,o){var r=i.getConnectionParser(),a={silentMode:!0,stackedReferences:[],stackedInstances:[],stackedConnections:[],onComplete:function(e){n(e)}};e.is(t)&&e.is(t.instancesAndReferences)&&e.is(t.connections)?(a.stackedReferences=t.instancesAndReferences.map((function(t){return e.merge(t,{queriedForChildren:!0,queriedForConnections:!0,queriedForDocuments:!0})})),t.connections.forEach((function(e){r.parse(e,a)})),i.addToCollections(a)):o()}))};return new Promise((function(u,f){var m=[],p={};Array.isArray(t)&&Array.isArray(n)&&(o.notify("startProgress",p),m=t.map((function(t,o){return new Promise((function(u,f){var m=e.clone(n[o]),p=i.getReferenceModel(t),d=i.getDisplayName(p),I=p.get("PID");g(r,I,m,c).then(l).then((function(e){a(e,m,d),u(e)})).catch((function(e){s(d,e),f()}))}))})),Promise.allSettled(m).then((function(e){var t,n=function(e){return e.value};t=e.some((function(e){return"rejected"===e.state}))?e.filter((function(e){return"fulfilled"===e.state})).map(n):e.map(n),o.notify("stopProgress",p),t.length>0?u(t):f()})).catch((function(){o.notify("stopProgress",p),f()})))}))},m=function(t,n,i,a,s){var c;a=a||{},o.notify("stopProgress",n),c=e.is(s)&&e.is(s.message,"string")?s.message:r.getNLSValue("AssignProdBehavior.ErrorLinkCreation.Title"),o.warn(c,t),o.debug("AssignProdBehavior.ErrorLinkCreation.Title. ERROR during product assign: "+i),e.is(a.onFailure,"function")&&a.onFailure(c,i)},p=function(t,n,a,s,c,l,u){let g=e.is(u)?u:s;o.info(r.getNLSValue(a,{processName:i.getDisplayName(g),productName:c}),l),o.notify(t,n)},d=function(t,n,s,c,u,g,f){var m=t.instancesAndReferences[2],d=t.instancesAndReferences[0].get("PID"),I=a.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});e.is(g.securityContextOverride,"string")&&(I.SecurityContext=g.securityContextOverride),i.getCurrentStates([d],I,(function(t){var a=[],g=widget.getValue("fromXen"),S=null;switch(u){case"createMfgItemAndScope":S="CreateMfgItemAndScope.Success";break;case"createMfgItemAndResultingProduct":S="createMfgItemAndResultingProductLink.Success";break;default:S="WrongNLSKey"}e.is(t)&&"RELEASED"===t.get(d)&&(l.isAKindOf(m.get("type"),"Provide")||l.isAKindOf(m.get("type"),"DELServicePartReference"))?((widget.getValue("isReleaseMaturitySynced")||!0===g&&o.getPreferenceValue("isReleaseSyncXENEnabled"))&&a.push(new Promise((function(e,t){i.syncMaturity([m],I,widget.getValue("isChangeRequiredSynced")||g&&o.getPreferenceValue("isReleaseSyncXENEnabled"),e,t)}))),Promise.all(a).then((function(t){var a=[];a.onComplete=function(t){e.is(t,"array")&&(t=t[0]),m.set("current",t.get("current")),o.notify("referenceAdded",m),p(u,c,S,n,s,f)},a.onFailure=function(){m.set("current",t.results[0].maturityState),o.notify("referenceAdded",m),o.warn(r.getNLSValue("MaturitySync.UIChangeFailed")),o.notify(u,c)},a.forceDBMode=!0,i.fetchRoot(m.get("PID"),a)})).catch((function(){o.warn(r.getNLSValue("MaturitySync.changeStateFailed")),o.notify("referenceAdded",m),p(u,c,S,n,s,f,m)}))):(null===t&&o.warn(r.getNLSValue("MaturitySync.retrieveCurrentStateFailed")),o.notify("referenceAdded",m),p(u,c,S,n,s,f,m))}))},{unassignProduct:function(t,n){var i,a,c,l=[],u=[],g=[],f={};i={onComplete:function(){o.notify("stopProgress",f),e.is(n)&&e.is(n.onComplete)?n.onComplete():o.info(r.getNLSValue("UnassignProduct.DeleteSuccess"))},onFailure:function(t){o.notify("stopProgress",f),e.is(n)&&e.is(n.onFailure)?n.onFailure():o.warn(t)}},e.is(n)&&(i=e.merge(i,n)),e.is(t,"array")&&0!==t.length&&(o.notify("startProgress",f),t.forEach((function(t){l.push(new Promise((function(n,i){a=s.getImplLinksOfImplementing(t);const l=function(t,i){o.notify("linkDeleted",[i.deletedConnections]);var a=e.is(t)?r.getNLSValue(t):"";n&&n(a)};e.is(a)&&a.length>0&&(a.forEach((function(e){var t=e.get("PID");g.push(new Promise((function(e,n){s.deleteImplementLink(t,{onComplete:l,onFailure:n})})))})),Promise.allSettled(g).then((function(){c=s.getScopeLinksOfImplementing(t),e.is(c)&&c.length>0&&c.forEach((function(e){var t=e.get("PID");u.push(new Promise((function(e,n){s.deleteScopeLink(t,{onComplete:l,onFailure:n})})))})),Promise.allSettled(u).then((function(){n()}),(function(){i()}))}),(function(){i()})))})))})),Promise.allSettled(l).then((function(){i.onComplete()}),(function(e){var t=0,n=0;for(t=0;t<e.length;t++)"rejected"===e[t].state&&n++;n===e.length?i.onFailure(r.getNLSValue("UnassignProduct.DeleteFailure")):i.onFailure(r.getNLSValue("UnassignProduct.PatialFailure"))})))},assignProduct:function(n){var a,c,g,f,p,d,I,S,P,h,y,L,A,v,R,M,C,D,k,b=[],V=[],N=[],O=[],E=[],F=[],T=[],B={},w={},U=new t(o.getBehavior("UXFactoryBehavior"),r);let x;if(A=function(t,n,i,a){const c=r.getNLSValue("ImplementBehavior.Consumption.LogMessage"),l=r.getNLSValue("ImplementBehavior.Consumption.Success"),u=r.getNLSValue("ImplementBehavior.Consumption.Failed"),g=o.log(c);s.consumeReferenceWithScopeLink(t,n.prodPID,n.mfgPID,n.mfgInstPID,{}).then((t=>{if(e.is(t)){if(e.is(t.instancesAndReferences,"array")){const e=[];t.instancesAndReferences.forEach((t=>{t.isInstance()&&e.push(t)})),o.notify("instanceAdded",e)}e.is(t.connections,"array")&&o.notify("connectionAdded",[t.connections]),o.info(l,g)}i()})).catch((()=>{o.warn(u,g),a()}))},v=function(){o.info(r.getNLSValue("Success.ProductAssigned.Title",{mfgItem:L}),h),o.notify("stopProgress",B),e.is(n.onComplete,"function")&&n.onComplete()},R=function(e,t){m(h,B,t,n,e)},e.is(n)&&(M=n.securityContextOverride,g=n.mbomReferenceId,a=n.mbomInstanceId,c=n.bodyInstanceIds,S=n.bodyAbsolutePaths,p=n.mbomAbsolutePaths[0],P=n.isInstancePossible,f=e.is(n.newMfgAttributes)?n.newMfgAttributes:{V_Type:"DELAsmAssemblyModelDisciplines/Provide"}),e.is(p,"array")&&p.length>0)x=s.isUnderScope(p);else{const t=s.getScopeLinks(g);x=e.is(t,"array")&&t.length>0,p=g}for(d=0;d<S.length;d++)if(s.validateIfScoped(p,S[d]))V.push(S[d]),N.push(c[d]),O.push(f[d]);else{if(!o.getPreferenceValue("skipVaidationIfScopedCheck")||!x)return void o.warn(r.getNLSValue("AssignProdBehavior.NotScoped.Title"));E.push(S[d]),F.push(c[d]),T.push(f[d])}e.is(g,"array")&&g.length>0&&(g=g[0]),o.notify("startProgress",B),y=i.getReferenceModel(g),L=e.is(y)?i.getDisplayName(y):"";const j=[];if(E.length>0)for(d=0;d<E.length;d++){const e=new Promise(((e,t)=>{const n={prodPID:i.getReferenceModel(F[d]).get("PID"),mfgPID:g,mfgInstPID:a},s=function(){},c=function(){A("ManufacturingAssembly",n,e,t)},u=function(){A("ManufacturingMadeFrom",n,e,t)};if(l.isAKindOf(y.get("type"),"CreateAssembly")||l.isAKindOf(y.get("type"),"CreateKit"))U.show(s,c,"");else{if(!(l.isAKindOf(y.get("type"),"CreateMaterial")||l.isAKindOf(y.get("type"),"ElementaryEndItem")||l.isAKindOf(y.get("type"),"Provide")))return o.warn(r.getNLSValue("AssignProdBehavior.DiffEBOM.NotSupportedType")),void o.notify("stopProgress",B);U.show(s,c,u)}}));j.push(e)}if(0===V.length)return void Promise.all(j).then(v).catch(R);for(d=0;d<V.length;d++)b.push(s.getPathToPartialOrFullScope(p,V[d]));h=o.log(r.getNLSValue("ProductAssign.LogMessage",{mfgItem:L})),w.securityContextOverride=M,w.onComplete=()=>{j.length>0?Promise.all(j).then(v).catch(R):v()},w.onFailure=(e,t)=>{j.length>0?Promise.all(j).then((()=>R(e,t))).catch((()=>R(e,t))):R(e,t)};let W=!1;if(e.is(n.newMfgAttributes)&&e.is(n.newMfgAttributes[0])&&e.is(n.newMfgAttributes[0].type)){W=n.newMfgAttributes[0].type.contains("DELServiceSpareItemReference")}const J=o.getPreferenceValue("insertSpareItemOnAssign");if(I=s.getImplementingPathsToPartialOrFullScope(p),J&&W){const t=i.getInstance(S[0][0]).get("isAggregatedBy");let n;if(e.is(p,"array")){n=i.getInstance(p[0]).get("isAggregatedBy")}else n=p;D=e.is(a)?i.getReferenceIdFromInstance(a):n,w.computeResultReport=!0,w.insertSpareItemOnAssign=!0;let o=s.getImplementingPathsToPartialOrFullScope(p);if(Array.isArray(o)&&1===o.length){!0===(s.isScoped(o)||s.isPartialScoped(o))&&(o=[])}s.consumeImplementedItems(t,b,n,D,o,w)}else!0===P?u(g,I,N,b,O,w):(D=i.getReferenceIdFromInstance(a),C=b[0],k=i.getReferenceIdFromInstance(C[C.length-1]),s.createScopeAndImplementLink(D,I,k,C,w))},createMfgItemAndScopeLink:function(t,n,i,s){var c,l=s||{},u=e.is(l.onComplete,"function")?l.onComplete:null,g=e.is(l.onFailure,"function")?l.onFailure:null;c=o.log(i),f(t,n,"dsmfg/private/V0/invoke/createMfgItemAndScope",(function(t,n,i){var r={},s=t.instancesAndReferences[2],u=a.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});e.is(l.securityContextOverride,"string")&&(u.SecurityContext=l.securityContextOverride),e.is(t)&&Array.isArray(t.instancesAndReferences)?d(t,n,i,r,"createMfgItemAndScope",l,c):(o.notify("referenceAdded",s),p("createMfgItemAndScope",r,"CreateMfgItemAndScope.Success",n,i,c))}),(function(t,n){e.is(n)&&e.is(n.message,"string")&&n.message.length>0?o.warn(r.getNLSValue("CreateMfgItemAndScope.FailureWithMessage",{productName:t,message:n.message}),c):o.warn(r.getNLSValue("CreateMfgItemAndScope.Failure",{productName:t}),c)}),l).then((function(t){var n=t.map((function(e){return{toObject:e.instancesAndReferences[0],fromObject:e.instancesAndReferences[1],createdObject:e.instancesAndReferences[2]}}));e.is(u,"function")&&u(n)})).catch((function(){e.is(g,"function")&&g()}))},createMfgItemAndResultingProductLink:function(t,n,i,a){var s,c=a||{},l=e.is(c.onComplete,"function")?c.onComplete:null,u=e.is(c.onFailure,"function")?c.onFailure:null;s=o.log(i),f(t,n,"dsmfg/private/V0/invoke/createMfgItemAndResultingProduct",(function(t,n,o){var i={};e.is(t)&&Array.isArray(t.instancesAndReferences)?d(t,n,o,i,"createMfgItemAndResultingProduct","ResultingProduct",c):p("createMfgItemAndResultingProduct",i,"createMfgItemAndResultingProductLink.Success",n,o,s)}),(function(t,n){e.is(n)&&e.is(n.message,"string")&&n.message.length>0?o.warn(r.getNLSValue("createMfgItemAndResultingProductLink.FailureWithMessage",{productName:t,message:n.message}),s):o.warn(r.getNLSValue("createMfgItemAndResultingProductLink.Failure",{productName:t}),s)}),c).then((function(t){var n=t.map((function(e){return{toObject:e.instancesAndReferences[0],fromObject:e.instancesAndReferences[1],createdObject:e.instancesAndReferences[2]}}));e.is(l,"function")&&l(n)})).catch((function(){e.is(u,"function")&&u()}))}}}}})),define("DS/DELPPWItemModelBehaviors/ProductImplementBehavior",["UWA/Core","UWA/Class/Promise","DS/DELPPWItemModelBehaviors/ImplementBehaviorBase","DS/DELPPWItemModelBehaviors/SpecifyScopeIntentDialog"],(function(e,t,n,o){"use strict";return{plugins:["DatabasePlugin","AttributePlugin","ResourcePlugin","ProductImplementPlugin","MfgItemPlugin","DicoPlugin","WebServicePlugin"],creator:function(i,r,a,s,c,l,u,g,f){const m="ProcessImplementLink",p=l.getScopeLinkType(),d=l.getPartialScopeLinkType(),I=l.getImplementLinkType(),S="DELMBOMContextualImplementCnx";var P,h,y,L,A,v,R,M,C,D,k,b,V,N,O,E,F,T=function(t,n,o,i){var a=e.is(t)?c.getNLSValue(t):n;r.info(a,o),i&&i(a)},B=function(t,n,o,i,a){var s=e.is(t)?c.getNLSValue(t):o;e.is(n,"string")&&n.length>0&&(s=n),r.warn(s,i),a&&a(s)};P=function(t,n){var o,i,r=t;if(t.length>0)if(Array.isArray(n.occPath)?o=n.occPath:Array.isArray(n.rirPath)&&(o=n.rirPath.filter(((e,t)=>t%2!=0))),e.is(o))for(i=0;i<o.length;i++){let e=o[i];const n=t.findIndex((t=>t.includes(e)));if(-1!==n){r=t.slice(0,n);break}}else r=[];return r},h=function(e){let t,n,o=[];if(t=Array.isArray(e)?e:e.split(","),t.length>1){n=t.slice(0,t.length-1);let e=a.getParentReferenceIdFromInstance(n[0]),i=a.getImpacted(e,!1,{relationTypes:[p,d]}).map((t=>L(t,e)));i.length>0&&o.push(i);let r=[];n.forEach((e=>{let t=[],n=a.getImpacted(e,!1,{onlyInstanceRelations:!0,relationTypes:[I,S]});r.push(e),n.forEach((n=>{var o=y(n,e,r);Array.isArray(o)&&t.push(o[o.length-1])})),t.length>0&&o.push(t)}))}return o},y=function(t,n,o){var i,r,a,s,c;return r=t.get("from"),a=Array.isArray(r)?r[r.length-1]:r,s=(c=t.get("to"))[c.length-1],n===a?e.is(o)?o.toString().indexOf(r.toString())>-1&&(i=c):i=c:n===s&&(e.is(o)?o.toString().indexOf(c.toString())>-1&&(i=Array.isArray(r)?r:[a]):i=Array.isArray(r)?r:[a]),i},L=function(e,t){var n,o;return n=e.get("from"),o=e.get("to"),n===t?o:n},A=function(t,n,o,s,l){var g,f,m={},p={};g=e.Json.encode({selectedHigherProductID:t,selectedMfgItemID:n,rootMfgItemID:n,reviseMfgItem:o,copyModelProductToItemUponSL:r.getPreferenceValue("copyModelProductToItemUponSL")}),(s=e.merge(s,{appenedURL:"ReconnectScopeLink"})).onComplete=function(e,t,n){var o,u;if(n.connections.length>0&&(o=a.getConnection(n.connections[0].PID),i.getMediator().notify("connectionAdded",[o])),n.instancesAndReferences.length>0){u=n.instancesAndReferences.filter((e=>"PRODUCT"===e.attributesValue.PPRTYPE))[0].attributesValue.PID,r.notify("addProductOrPart",{pid:u})}r.info(s.logMessage+" "+c.getNLSValue("completed"),f),r.notify("stopProgress",m),r.notify("reconnectScope",p),r.notify("updateBIModelFromServerResponse",n),l(e,t)},s.onFailure=function(e,t){r.warn(s.logMessage+" "+c.getNLSValue("failed"),f),r.notify("stopProgress",m),l(e,t)},s.onTimeout=function(e,t){r.warn(s.logMessage+" "+c.getNLSValue("timeout"),f),r.notify("stopProgress",m),l(e,t)},r.notify("startProgress",m),e.is(s)&&e.is(s.logMessage)&&(f=r.log(s.logMessage)),u.webserviceAndProcessing("POST",g,s)},v=function(e,t,n,o,i,a){var s,u,g={},f=c.getNLSValue("ImplementBehavior.CreateScope.LogMessage"),p=c.getNLSValue("ImplementBehavior.CreateScope.Success"),d=c.getNLSValue("ImplementBehavior.CreateScope.Failed"),I=r.log(f),S=function(e){T(e,p,I,i),r.notify("linkCreated",g)},P=function(e,t){B(e,t,d,I,a)};s=l.canCreateScopeLink({fromSideRefPID:e,toSideRefPID:t,fromSideAbsPath:n,toSideAbsPath:o});const h=r.getPreferenceValue("copyModelProductToItemUponSL");s.canCreateLink?l.getScopeLinkType()===m?l.createScopeLink(e,t,{onComplete:S,onFailure:P,copyModelProductToItemUponSL:h}):(u=k(n)).hasImplementLink?P(null,c.getNLSValue("ImplementBehavior.Validation.ImplLinkExists",{obj1:u.implementingName,obj2:u.implementedName})):l.createScopeLink(e,t,{onComplete:S,onFailure:P,copyModelProductToItemUponSL:h}):P(null,s.errorMessage)},C=function(t,n,o,i){var s,u,f,p,d,I,S,P,h=[],y=c.getNLSValue("ImplementBehavior.CreateScope.LogMessage"),L=c.getNLSValue("ImplementBehavior.CreateScope.Success"),A=c.getNLSValue("ImplementBehavior.CreateScope.Failed"),v=r.log(y),R=function(t,n){T(t,L,v,o),e.is(n)&&(n.connections.forEach((function(e){h.push(e.toJSON())})),r.notify("createImplementLink",h))},M=function(e,t){B(e,t,A,v,i)};if(e.is(t,"array")&&t.length>0&&e.is(n,"array")&&n.length>0){u=t[t.length-1],s=a.getReferenceIdFromInstance(u),d=n[n.length-1],p=a.getReferenceIdFromInstance(d),P=l.canCreateScopeLink({fromSideRefPID:s,toSideRefPID:p,fromSideInstPID:u,toSideInstPID:d,fromSideAbsPath:t,toSideAbsPath:n});const e=r.getPreferenceValue("copyModelProductToItemUponSL");if(P.canCreateLink)if(l.getScopeLinkType()===m)l.createScopeLink(s,p,{onComplete:R,onFailure:M,copyModelProductToItemUponSL:e});else if(l.validateIfScoped(t,n))(S=k(t,n)).hasImplementLink?S.withSameProduct?l.createScopeLink(s,p,{onComplete:R,onFailure:M,copyModelProductToItemUponSL:e}):M(null,c.getNLSValue("ImplementBehavior.Validation.ImplLinkExists",{obj1:S.implementingName,obj2:S.implementedName})):(I=E(t,n),f=l.getImplementingPathsToPartialOrFullScope(t),l.createScopeAndImplementLink(s,f,p,I,{onComplete:R,onFailure:M}));else{if(r.getPreferenceValue("skipVaidationIfScopedCheck")&&g.isAKindOf(undefined,"Provide"))return void l.createScopeLink(s,p,{onComplete:R,onFailure:M,copyModelProductToItemUponSL:e});M(null,c.getNLSValue("ImplementBehavior.Validation.ScopeNotValid"))}else M(null,P.errorMessage)}else r.debug("Input parameters are invalid."),M()},k=function(t,n){var o,i,r,s,c,u,g=!1,f=!1,m=null,p=null;return o=e.is(t,"array")&&t.length>0?l.getImplLinksOfImplementing(t):null,e.is(o,"array")&&o.length>0&&(g=!0,e.is(n)&&(f=o.some((function(t){return e.equals(t.get("to"),n)}))),s=(u=o[0]).getAttribute("from"),c=a.getReferenceModel(s),e.is(c)&&(p=c.get("V_Name")),i=u.getAttribute("to"),r=a.getReferenceModel(i),e.is(r)&&(m=r.get("V_Name"))),{hasImplementLink:g,withSameProduct:f,implementingName:p,implementedName:m}},M=function(e,t,n,o,i,a){var s=c.getNLSValue("ImplementBehavior.Consumption.LogMessage"),u=c.getNLSValue("ImplementBehavior.Consumption.Success"),g=c.getNLSValue("ImplementBehavior.Consumption.Failed"),f=r.log(s);t=l.getImplementingPathsToPartialOrFullScope(t),l.createScopeAndImplementLink(e,t,n,o,{onComplete:function(){T(null,u,f,i)},onFailure:function(e,t){B(null,t,g,f,a)}})},R=function(t,n,o,i,a,s,u,g){var f=c.getNLSValue("ImplementBehavior.Consumption.LogMessage"),m=c.getNLSValue("ImplementBehavior.Consumption.Success"),p=c.getNLSValue("ImplementBehavior.Consumption.Failed"),d=null,I=r.log(f),S={instancesAndReferences:[],connections:[]},P={};P={computeResultReport:!0,onComplete:function(t,n,o){e.is(n)?(T(t,m,I,s),n.connections.forEach((function(e){S.connections.push(e.toJSON())})),n.instancesAndReferences.forEach((function(e){S.instancesAndReferences.push(e.toJSON())})),r.notify("createStructure",S)):(e.is(o)&&e.is(o.resultReport)&&e.is(o.resultReport.GlobalErrors,"array")&&o.resultReport.GlobalErrors.length>0&&e.is(o.resultReport.GlobalErrors[0])&&e.is(o.resultReport.GlobalErrors[0].Messages)&&e.is(o.resultReport.GlobalErrors[0].Messages.UserMessage,"string")&&o.resultReport.GlobalErrors[0].Messages.UserMessage.length>0&&(d=o.resultReport.GlobalErrors[0].Messages.UserMessage),e.is(o)&&e.is(o.resultReport)&&e.is(o.resultReport.CreatedItems,"array")&&e.is(o.resultReport.CreatedItems.length>0)&&e.is(o.resultReport.CreatedItems[0])&&e.is(o.resultReport.CreatedItems[0].ErrorMessages,"array")&&(d=e.is(o.resultReport.CreatedItems[0].ErrorMessages.length>0)?o.resultReport.CreatedItems[0].ErrorMessages[0]:p),B(t,d,p,I,u)),e.is(o)&&e.is(o.resultReport)?(mfgItemUXBehavor=r.getBehavior("MfgItemUXBehavor"),e.is(undefined)?mfgItemUXBehavor.createMfgItemCreateReportUI({title:c.getNLSValue("MfgItemConsumeReportUI.Dialog.Title"),report:o.resultReport,mode:"erroronly_report"}):r.debug("Result report is avialable in response, but uxFactoryBehavior is not avialable")):r.debug("Result report is not avialable in response")},onFailure:function(e,t){B(e,t,p,I,u)}},e.is(g)&&(P.insertSpareItemOnAssign=g);const h=r.getPreferenceValue("copyModelProductToItemUponSL");P.copyModelProductToItemUponSL=h;const y=r.getPreferenceValue("copyModelParentToChild");P.copyModelParentToChild=y,l.consumeImplementedItems(t,n,o,i,a,P)},D=function(n,o,i,r){var s,c,u;return e.is(n,"array")&&n.length>0&&l.isUnderScope(n)&&e.is(i,"array")&&i.length>0?(c=n,u=i,s=new t((function(e,t){C(c,u,e,t)}))):s=function(e,n,o,i){return new t((function(t,r){var s=a.isReference(e)?e:a.getReferenceIdFromInstance(e),c=a.isReference(n)?n:a.getReferenceIdFromInstance(n);v(s,c,o,i,t,r)}))}(o,r,n,i),s},N=function(e,n,o,i,r){var a,s,c,l,u;return a=e,s=n,c=o,l=i,u=r,new t((function(e,t){O(a,s,c,l,u,e,t)}))},O=function(t,n,o,i,s,u,g){var f,m,p,d,I,S,P,h=[],y=[],L=[],A=c.getNLSValue("ImplementBehavior.CreateScope.LogMessage"),v=c.getNLSValue("ImplementBehavior.CreateScope.Success"),R=c.getNLSValue("ImplementBehavior.CreateScope.Failed"),M=r.log(A),C=function(e,t){B(e,t,R,M,g)},D=r.getBehavior("UXFactoryBehavior");const k="CREATE_PARTIALSCOPE"===s,V="STRETCH_PARTIALSCOPE"===s,N="DELETE_PARTIALSCOPE"===s,O="SWITCH_TO_FULLSCOPE"===s;I={onComplete:function(e,t){T(e,v,M,u),t.connections.forEach((function(e){L.push(e.toJSON())})),r.notify("createImplementLink",L)},onFailure:C,cmdAction:s};const F=function(){if(O)I.isSwitchToPartialScopeLink=O,h=E(t,n),y=l.getImplementingPathsToPartialOrFullScope(t);else if(V){I.isStretchPartialScopeLink=V,h=E(t,n),y=l.getImplementingPathsToPartialOrFullScope(t);const o=n[n.length-1];if(Array.isArray(P)){let t=P.indexOf(o);for(t+=1;t<P.length;t++)S=e.is(S)?S+","+P[t]:P[t]}I.targetPrdOccPath=S,I.targetProductID=d,d=l.getPartialScopeLinks(f)[0].get("to")}else if(N){if(I.isDeletePartialScopeLink=N,Array.isArray(P))for(let t=0;t<P.length;t++)S=e.is(S)?S+","+P[t]:P[t];I.targetPrdOccPath=S}else k&&(I.isCreatePartialScopeLink=k,h=E(t,n),y=l.getImplementingPathsToPartialOrFullScope(t));I.copyModelProductToItemUponSL=r.getPreferenceValue("copyModelProductToItemUponSL"),l.manageScopeAndImplementLink(f,m,d,h,I,y)};if(e.is(t,"array")&&t.length>0){if(m=t[t.length-1],f=a.getReferenceIdFromInstance(m),p=a.getReferenceModel(f),!0===l.isScoped(f))return void C(null,c.getNLSValue("ImplementBehavior.Validation.ScopeLinkExists",{objectName:p.get("V_Name")}));if(k&&!0===l.isPartialScoped(f))return void C(null,c.getNLSValue("ImplementBehavior.Validation.PartialScopeLinkExists",{objectName:p.get("V_Name")}));if(V&&!1===l.isPartialScoped(f))return void C(null,c.getNLSValue("ImplementBehavior.Validation.NoPartialScopeLinkExists",{objectName:p.get("V_Name")}));if(e.is(n)&&e.is(n,"array")&&n.length>0){if(d=a.getReferenceIdFromInstance(n[n.length-1]),V){const e=l.getPartialScopeLinks(f)[0].get("to");if(d===e)return void C(null,c.getNLSValue("ImplementBehavior.Validation.StretchPartialScopeToSamePrd"))}}else{d=e.is(o)?o:l.getPartialScopeLinks(f)[0].get("to");const i=b(t);n=i}if(P=b(t),k)F();else if(null===P)if(N)D.showConfirmation(c.getNLSValue("Confirmation.AreYouSure"),c.getNLSValue("Confirmation.DeletePartialScopeImplBroken"),null,(function(t){e.is(t,"boolean")&&t?F():g()}));else{if(!O)return void C(null,V?c.getNLSValue("ImplementBehavior.Validation.StretchPartialScopeImplBroken"):c.getNLSValue("ImplementBehavior.Validation.SwtichPartialScopeImplBroken"));F()}else F()}else e.is(o)&&e.is(i)?(f=i,d=e.is(n)&&e.is(n,"array")&&n.length>0?a.getReferenceIdFromInstance(n[n.length-1]):o,m=null,F()):(r.debug("Input parameters are invalid."),C())},E=function(t,n){let o=[];if(!e.is(n))return o;const i=l.getPathsTillUpperScope(t,n),r=((t,n)=>{let o=null;const i=l.isUnderPartialScope(t);return e.is(i)&&i&&(o=l.getPathsTillUpperPartialScope(t,n)),o})(t,n);return o=i,Array.isArray(r)&&Array.isArray(i)?o=((...e)=>{let t=e[0];const n=e.length;for(let o=1;o<n;o++)e[o].length<t.length&&(t=e[o]);return t})(r,i):Array.isArray(r)&&(o=r),o},b=function(t){var n,o,i,r,s,c=function(t){var n,o=!1;return n=a.getReferenceModel(t),e.is(n)&&"PROCESS"===n.get("PPRTYPE")&&(o=!0),o};if(Array.isArray(t)){if(0===(n=t).length)return null;if(!c(n[n.length-1]))return null;if(!l.isPartialScoped(n))return null;if(l.isUnderPartialScope(n)){s=[],i=n.slice(0);do{if(!l.isPartialScoped(i))break;if(r=l.getImplLinksOfImplementing(i),!e.is(r)||r.length>1||0===r.length){s=null;break}s=r[0].get("to").concat(s),i=V(i)}while(Array.isArray(i))}else if(r=l.getImplLinksOfImplementing(n),e.is(r)){if(1!==r.length)return null;s=r[0].get("to")}else s=[]}else s=c(o=t)&&l.isScoped(o)?[]:null;return s},V=function(t){var n,o,i,r=null;return Array.isArray(t)&&t.length>0&&(i=l.findInstanceWhoseParentIsPartialScoped(t),e.is(i)&&(0===i.absPathIndex?o=i.instanceModel.get("isAggregatedBy"):n=t.slice(0,i.absPathIndex))),e.is(n)?r=n:e.is(o)&&(r=o),r},F=function(n,o){const i=a.isReference(n)?n:a.getReferenceIdFromInstance(n),s=a.isReference(o)?o:a.getReferenceIdFromInstance(o);return u={IDFrom:i,IDTo:s,type:l.getScopeLinkType()},new t((function(t,n){const o={url:"dsmfg/private/V0/MfgElement/connection/validateBrokenScope",method:"POST",headers:f.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(u),onComplete:function(o){const a=!!e.is(o.isScopeLinkBroken,"boolean")&&o.isScopeLinkBroken;if(a){const e=r.getBehavior("UXFactoryBehavior"),o=c.getNLSValue("BrokenScope.Confirmation.Title"),l=c.getNLSValue("BrokenScope.Reason.Text"),u=function(e){e?t({isScopeLinkBroken:a,implementedRefId:s,implementingRefId:i}):n()};e.showConfirmation(o,l,null,u)}else t({isScopeLinkBroken:a,implementedRefId:s,implementingRefId:i})},onFailure:function(){n()}};f.webServiceRequest(o)}));var u};let w=new n(i,r,a,s,c,l,u,g,f);return e.extend(w,{onStart:function(){},PartialScopeAction:{CREATE_PARTIALSCOPE:"CREATE_PARTIALSCOPE",STRETCH_PARTIALSCOPE:"STRETCH_PARTIALSCOPE",SWITCH_TO_FULLSCOPE:"SWITCH_TO_FULLSCOPE",DELETE_PARTIALSCOPE:"DELETE_PARTIALSCOPE"},isImplementLinkPossible:function(e,t){return l.isImplementLinkPossible(e,t)},getScopeLinksOfImplementing:function(e){return l.getScopeLinksOfImplementing(e)},getPartialScopeLinksOfImplementing:function(e){return l.getPartialScopeLinksOfImplementing(e)},isProductImplementLinkValidForOccPath:function(e,t,n){return l.isProductImplementLinkValidForOccPath(e,t,n)},createEngMadeFromItem:function(t,n){var o=n.get("PID");const i=c.getNLSValue("ImplementBehavior.createEngMadeFromItem.LogMessage"),a=c.getNLSValue("ImplementBehavior.createEngMadeFromItem.Success"),s=c.getNLSValue("ImplementBehavior.createEngMadeFromItem.Failed"),u=c.getNLSValue("ImplementBehavior.createEngMadeFromItem.NotSupportedType.Failed"),f=r.log(i);g.isAKindOf(n.get("type"),"CreateMaterial")||g.isAKindOf(n.get("type"),"ElementaryEndItem")?l.createEngMadeFromItem(t,o).then((t=>{if(e.is(t)){if(e.is(t.instancesAndReferences,"array")){const e=[];t.instancesAndReferences.forEach((t=>{t.isInstance()&&e.push(t)})),r.notify("instanceAdded",e)}e.is(t.connections,"array")&&r.notify("connectionAdded",[t.connections]),r.info(a,f)}})).catch((()=>{r.warn(s,f)})):r.warn(u,f)},consumeImplementedItems:function(n){var i,s,u,f,m,p={},d=new o(r.getBehavior("UXFactoryBehavior"),c);return e.is(n,"array")&&n.length>0?(r.notify("startProgress",p),i=t.allSettled((s=[],u=[],f=[],m=function(t,n,o,i){const s=c.getNLSValue("ImplementBehavior.Consumption.LogMessage"),u=c.getNLSValue("ImplementBehavior.Consumption.Success"),g=c.getNLSValue("ImplementBehavior.Consumption.Failed"),f=r.log(s),m=a.getReferenceModel(n.referencePID);l.consumeReferenceWithScopeLink(t,n.referencePID,n.targetReferencePID,"",{"PLMEntity.V_Name":m.get("V_Name"),"PLMEntity.V_description":"",V_Type:"DELAsmAssemblyModelDisciplines/Provide",type:"Provide"}).then((t=>{if(e.is(t)){if(e.is(t.instancesAndReferences,"array")){const e=[];t.instancesAndReferences.forEach((t=>{t.isInstance()&&e.push(t)})),e.length>0&&r.notify("instanceAdded",e)}e.is(t.connections,"array")&&r.notify("connectionAdded",[t.connections]),r.info(u,f)}o()})).catch((()=>{r.warn(g,f),i()}))},n.forEach((function(o,i){var p=new t((function(t,s){var p=null,I=null,S=null,P=null,h=e.is(o.targetInstancePIDsArray)&&o.targetInstancePIDsArray.length>0?o.targetInstancePIDsArray:o.targetReferencePID;if(l.validateIfScoped(h,o.instancePIDsArray)){const m=a.getParentReferenceIdFromInstance(o.instancePID);if(e.is(m)&&l.isPartialScoped(m)){const t=l.getPartialScopeLinks(m);if(e.is(t)&&e.is(t[0])){const n=t[0].get("from");if(e.is(o.targetInstancePIDsArray)){let e=!1;for(const t of o.targetInstancePIDsArray)if(a.getReferenceIdFromInstance(t)===n){e=!0;break}e||(p=o.instancePIDsArray)}}}if(null===p&&(p=E(o.targetInstancePIDsArray,o.instancePIDsArray)),I=a.getReference(o.targetReferencePID),g.isAKindOf(I,"DELConstructionStructure")){const e=c.getNLSValue("ImplementBehavior.ConstructionStructureConsumption.Failed");return r.warn(e),void s(e)}let d=!1;(g.isAKindOf(I,"DELConstructionWorkElementEach")||g.isAKindOf(I,"DELConstructionWorkElementArea")||g.isAKindOf(I,"DELConstructionWorkElementLength"))&&(d=!0);let h=!1;e.is(o.targetReferencePID)&&(h=l.isPartialOrFullScoped(o.targetReferencePID));const y=r.getPreferenceValue("insertSpareItemOnAssign");if(y&&(g.isAKindOf(I,"DELServiceAssemblyReference")||g.isAKindOf(I,"DELServiceKitReference")||g.isAKindOf(I,"DELServicePartReference")||g.isAKindOf(I,"DELServiceAttachingItemReference"))){S=e.is(o.targetInstancePIDsArray,"array")&&o.targetInstancePIDsArray.length>0?o.targetInstancePIDsArray:o.targetReferencePID,P=e.is(o.instancePIDsArray,"array")&&o.instancePIDsArray.length>0?o.instancePIDsArray:o.referencePID;const{ebomRootPID:r,ebomPathToScope:a,mbomRootPID:c}=l.getConsumptionInfoFromOccurence(S,P);u.push(a),f=l.getImplementingPathsToPartialOrFullScope(o.targetInstancePIDsArray),Array.isArray(f)&&1===f.length&&l.isPartialOrFullScoped(f)&&(f=[]),i===n.length-1?R(o.rootReferencePID,u,o.targetRootReferencePID,o.targetReferencePID,f,t,s,y):t()}else if(g.isAKindOf(I,"Provide")||g.isAKindOf(I,"ProcessContinuousProvide")||g.isAKindOf(I,"ContinuousByProduct")||g.isAKindOf(I,"MBOMContinuousPhaseReference")||g.isAKindOf(I,"DELServicePartReference")||g.isAKindOf(I,"DELServiceAttachingItemReference")||g.isAKindOf(I,"DELServiceSpareItemReference")||g.isAKindOf(I,"DELContinuousServicePartReference")||d&&!h)M(o.targetReferencePID,o.targetInstancePIDsArray,o.referencePID,p,t,s);else{S=e.is(o.targetInstancePIDsArray,"array")&&o.targetInstancePIDsArray.length>0?o.targetInstancePIDsArray:o.targetReferencePID,P=e.is(o.instancePIDsArray,"array")&&o.instancePIDsArray.length>0?o.instancePIDsArray:o.referencePID;const{ebomRootPID:r,ebomPathToScope:a,mbomRootPID:c}=l.getConsumptionInfoFromOccurence(S,P);u.push(a),h?f=[]:(f=l.getImplementingPathsToPartialOrFullScope(o.targetInstancePIDsArray),Array.isArray(f)&&1===f.length&&l.isPartialOrFullScoped(f)&&(f=[])),i===n.length-1?R(r,u,c,o.targetReferencePID,f,t,s):t()}}else{const n=()=>D(o.targetInstancePIDsArray,o.targetReferencePID,o.instancePIDsArray,o.referencePID);if(r.getPreferenceValue("skipVaidationIfScopedCheck")){let i=!1;if(e.is(o.targetInstancePIDsArray,"array")&&o.targetInstancePIDsArray.length>0)i=l.isUnderScope(o.targetInstancePIDsArray);else{const t=l.getScopeLinks(o.targetRootReferencePID);i=e.is(t,"array")&&t.length>0}i?d.show((function(){t()}),(function(){m("ManufacturingAssembly",o,t,s)}),(function(){m("ManufacturingMadeFrom",o,t,s)})):n().then(t,s)}else n().then(t,s)}}));s.push(p)})),s)).then((function(){r.notify("stopProgress",p)}))):(r.debug("Input parameters are invalid."),i=t.reject("ImplementBehavior.Validation.InvalidInput")),i},reconnectScope:function(e,t,n,o){A(e,t,!1,n,o)},reviseAndReconnectScope:function(e,t,n,o){A(e,t,!0,n,o)},prereqChecksForReconnectScope:function(e,t,n,o,i){var a=r.getBehavior("ModelBehavior");"ReconnectScope"===e?a.isReadOnly(t,n,o,i):"ReviseAndReconnectScope"===e&&a.isLatestRevision(t,n,o,i)},managePartialScopeLink:function(n){let o,i={};return e.is(n,"object")?(r.notify("startProgress",i),o=N(n.implementingAbsPath,n.implementedAbsPath,n.implementedPID,n.implementingPID,n.cmdAction).then((()=>{r.notify("stopProgress",i)})).catch((()=>{r.notify("stopProgress",i)}))):(r.debug("Input parameters are invalid."),o=t.reject("ImplementBehavior.Validation.InvalidInput")),o},updateDataMaterializationLinkUsage:function(n,o,i){return new t((function(t,r){var a={rpConnectionPID:n,newValue:o},s={url:"dsmfg/private/V0/invoke/updateDataMaterializationLinkUsage",method:"POST",data:e.Json.encode(a),context:self,onComplete:function(e){t(e)},onFailure:function(t){e.is(i.onFailure,"function")&&i.onFailure(t),r()}};f.webServiceRequest(s)}))},validateBrokenScopeLinkPromise:function(e,t){return F(e,t)},getImpactedObjects:function(t,n,o,i){var r=[];return e.is(i)&&(i=Array.isArray(i)?i:[i]).forEach((function(i){var a;switch(i.get("type")){case p:case d:a=L(i,t);break;case I:case S:a=y(i,n,o);break;default:console.log("Invalid Type")}e.is(a)&&r.push(a)})),r},getConnectedObjects:function(t,n,o,i){let r,s,c,l,u,g,f,m=this,A=[],v=!1,R=!1;r=Array.isArray(o)?o:o.split(","),l=i[p]||[],u=i[d]||[],c=l.concat(u),g=i[I]||[],f=i[S]||[],g=g.concat(f),g.length>0&&g.forEach((t=>{var o;o=y(t,n,r.toString()),e.is(o)&&(A.push({occPath:o}),v=!0)})),!v&&c.length>0&&c.forEach((n=>{var o,i,s;if(o=L(n,t),i=t,0===r.length&&(A.push({rirPath:[o]}),R=!0),s=a.getParentInstancesFromCollection(o),Array.isArray(s)){let t=s.filter((t=>{let n,o=t.get("PID");return n=a.getImpacted(o,!1,{onlyInstanceRelations:!0,relationTypes:[I,S]}).some((t=>{var n,r,s,c=!1;return n=y(t,o),Array.isArray(n)&&(s=n[n.length-1],r=a.getReferenceIdFromInstance(s),c=e.is(r)&&r===i),c})),!n}));t.forEach((e=>{var t=e.get("PID");A.push({rirPath:a.transformToRIROccurrencePath([t])}),R=!0}))}}));let M=[];return A.some((t=>{var n=!1;return e.is(t,"object")&&(e.is(t.occPath)||e.is(t.rirPath)&&t.rirPath.length>1)&&(n=!0),n}))&&(M=h(o)),A=A.map((t=>{var n=t;return e.is(t,"object")&&(t.ctxPath=P(M,t)),n})),v||R||!e.is(n)||(s=a.getInstancesFromCollection(t),Array.isArray(s)&&s.length>0&&s.forEach((e=>{var t,n,i,r,s;t=e.get("PID"),n=e.get("isInstanceOf"),(r=(r=Array.isArray(o)?o:o.split(",")).slice()).push(t),i=a.getImpacted(t,!1,{onlyInstanceRelations:!0,relationTypes:[I,S]}),s=m.getConnectedObjects(n,t,r,{[I]:i}),A=A.concat(s)}))),A},checkItemHasPartialScopeNImpLink:function(t,n){let o=!1;const i=l.isPartialScoped(t);if(e.is(i)&&!0===i){const e=l.getImplLinksOfImplementing([n]);Array.isArray(e)&&e.length>0&&(o=!0)}return o}})}}}));