define("DS/DELWebOERPreferencesComp/PreferencesComp",["DS/DELWebOERCommonUtils/DELWebBaseComponent"],(function(e){"use strict";const t="oldValue",i="value",s="onEdit",n="endEdit";return class extends e{constructor(e){super(e),this.preferencesMap={},this.configFile=e.configFile,this.nlsAMDPath=e.nlsAMDPath,this.preferences=null,this.widget=null}async initialize(){let e,r=this;if(r.widget=this.getWidgetComponent(),await super.initialize(),!this.widget)throw new Error("getSessionWidget function not found in the Widget Proxy Component, it is mandatory to have a getSessionWidget function in proxy component");if(r.widget.addEvent(s,(function(){r._updatePreferencesMap(t)})),r.widget.addEvent(n,(function(e){e&&!0===e.submitted&&(r._updatePreferencesMap(i),r.publish({event:"onUpdatePreferences",data:{data:r.getPreferencesObject()}}))})),e=await this.loadJson(this.configFile),await this.loadNLS(this.nlsAMDPath),!e||!e.preferences)throw new Error("Configuration File provided does not match the specifications, please provide right configuration");this.preferences=e.preferences,this.addPreferences(this.preferences)}_updatePreferencesMap(e){let t=this,i=t.getPreferencesObject();Object.keys(i).forEach((s=>{t.preferencesMap[s]||(t.preferencesMap[s]={}),t.preferencesMap[s][e]=i[s]}))}addPreferences(e){let t=this,i=function(){return t.widget.getValue("x3dPlatformId")?t.widget.getValue("x3dPlatformId"):"OnPremise"};e&&(e=e.filter((e=>!e.platform||("OnPremise"===e.platform?i():"OnCloud"===e.platform&&!i()))),t.widget.mergePreferences(e))}async clean(){await super.clean(),this.preferencesMap={}}async destroy(){await super.destroy(),delete this.preferencesMap,delete this.options,delete this.widget,delete this.nlsAMDPath,delete this.configFile}getExposedComponent(){return this.publicAPI=super.getExposedComponent(),this.publicAPI.addPreferences=this.addPreferences.bind(this),this.publicAPI.getPreferencesObject=this.getPreferencesObject.bind(this),this.publicAPI.isPreferencesModified=this.isPreferencesModified.bind(this),this.publicAPI.getValue=this.getValue.bind(this),this.publicAPI.setValue=this.setValue.bind(this),this.publicAPI}getPreferencesObject(){let e={};return this.widget.getPreferences().forEach((t=>{e[t.name]=t.value})),e}isPreferencesModified(e){let s=this,n=!1;return e&&e.length>0&&(n=e.some((e=>!!s.preferencesMap[e]&&s.preferencesMap[e][t]!==s.preferencesMap[e][i]))),n}getValue(e){return this.widget.getValue(e)}setValue(e,t){return this.widget.setValue(e,t)}}}));