define("DS/CATMBSEProperties/utils/Services",["UWA/Core","UWA/Class","UWA/Class/Options","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Logger/Logger","DS/WidgetServices/securityContextServices/SecurityContextServices"],(function(e,t,i,n,o,r){"use strict";return t.singleton(i,{name:"catmbse-services",tenant:null,_logger:null,options:{},init:function(e){this._parent(e),this._logger=o.getLogger(this.name)},instance:function(){return this._logger.log("instance"),this},getTenant:function(){return this._logger.log("getTenant"),this.tenant},setTenant:function(e){this._logger.log("setTenant"),this.tenant=e},app_initialization:function(t,i){this._logger.log("app_initialization");var o=this,r=!1;try{e.is(this.getOption("platform_services"),"array")||(r=!0)}catch(e){r=!0}r?i?(o.setOption("platform_services",i),t()):(o._logger.log("get Platform Services"),n.getPlatformServices({onComplete:function(e){o.setOption("platform_services",e),void 0!==window.widget&&window.widget&&void 0!==window.widget.getValue("x3dPlatformId")&&window.widget.getValue("x3dPlatformId")&&window.widget.getValue("x3dPlatformId").trim().length>0?o.setTenant(window.widget.getValue("x3dPlatformId")):o.setTenant(e[0].platformId),t()},onFailure:function(e){throw o._logger.error("Cannot retrieve the Platform Services"),new Error("Cannot retrieve the Platform Services")}})):(o._logger.log("Platform Services already initialized"),t())},get3DSpaceBaseUrl:function(t){this._logger.log("get3DSpaceBaseUrl");var i,n=this;if(!e.is(n.getOption("platform_services"),"array"))throw new Error("Platform services not initialize yet");e.is(t)||(t=n.getTenant());try{for(var o=0;o<this.getOption("platform_services").length;o++)if(n.getOption("platform_services")[o].platformId==t){i=n.getOption("platform_services")[o]["3DSpace"];break}}catch(e){i=n.get3DSpaceUrl()}return e.is(i)||(i=n.get3DSpaceUrl()),i},get3DSpaceUrl:function(e){this._logger.log("get3DSpaceUrl",e);var t=location.protocol+"//"+location.hostname,i="3DSpace";return e&&(e.serverUrl=t,e.serverUri=i),t+"/"+i},getAppSecurityContext:function(t){this._logger.log("getAppSecurityContext");var i=this;return new Promise((function(n,o){e.is(t)?n(t):widget.hasPreference("xPref_CREDENTIAL")?n(widget.getValue("xPref_CREDENTIAL")):widget.hasPreference("security_ctx")?n(widget.getValue("security_ctx")):widget.hasPreference("securityContext")?n(widget.getValue("securityContext")):r.getInstance({tenant:i.getTenant()}).getValidSecurityContext({context:this,onSuccess:function(e){n(e.SecurityContext)},onFailure:function(e){i._logger.error("cannot get security context",e),o(e)}})}))},form3DXContent:function(e,t,i){return{protocol:"3DXContent",version:"2.1",source:widget.getValue("appId"),widgetId:widget.id,data:{items:this.getItemDetailsToShare(e,t,i)}}},getItemDetailsToShare:function(e,t,i){var n=[];return e.forEach((function(e){n.push({envId:t,serviceId:"3DSpace",contextId:i,objectId:e.options.id,objectType:e.getAttributeValue("type"),displayName:e.options.label,i3dx:e.getAttributeValue("i3dx"),displayType:e.getAttributeValue("type"),objectState:e.options.iteration,objectTaxonomies:[e.getAttributeValue("type"),e.getAttributeValue("contentType")]})})),n},checkClientVersion:function(t,i){return t.startsWith("CATIA Magic")?!(!e.is(i)||""===i)&&(!i.startsWith("2022x")&&("2024x"!==i&&!(i.startsWith("2024x.HF")||i.startsWith("2024x.Refresh1")||i.startsWith("2024x.Refresh2")))):(t.startsWith("CATIA Dymola")||t.startsWith("CATIA Stimulus")||t.startsWith("CATIA ControlBuild"),!1)},isStandardProfile:function(t,i){return!(!e.is(i)||"SystemResourceVersion"!==i)||("CATIA Magic Profile"===t||"CATIA Magic SysML v2 Standard Library"===t)}})})),define("DS/CATMBSEProperties/components/datagridview.toolbar",["i18n!DS/CATMBSEProperties/assets/nls/CATMBSEProperties","text!DS/CATMBSEProperties/assets/config/conf.json"],(function(e,t){"use strict";var i=JSON.parse(t);return{getToolbarModel:function(t,n){var o=t===i.mode.usedmodel?"withProfiles":"withHistory";return{entries:[{id:o,dataElements:{typeRepresentation:"independantBoolean",value:!1,tooltip:e.options[o],label:e.options[o]},onNodeUpdate:n}]}}}})),define("DS/CATMBSEProperties/components/datagridview.columns",["DS/TreeModel/BaseFilter","text!DS/CATMBSEProperties/assets/config/conf.json","i18n!DS/CATMBSEProperties/assets/nls/CATMBSEProperties"],(function(e,t,i){"use strict";var n=JSON.parse(t),o=e.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue("contentType");return!(!this.filterModel||!this.filterModel.excludedTypes)&&(-1!==this.filterModel.excludedTypes.indexOf(t)&&!e.isRoot())},isEmpty:function(){return void 0===this.filterModel.excludedTypes}}),r=e.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue("isHistorical");return!(!this.filterModel||!this.filterModel.hideHistory)&&(!0===t&&!e.isRoot())},isEmpty:function(){return void 0===this.filterModel.hideHistory}});return{getDataGridViewColumns:function(e){var t=this,o=[{text:i.column.tree,dataIndex:"tree",editableFlag:!1,sortableFlag:!1,alwaysVisibleFlag:!0,width:300,getCellClassName:function(e){let t=e.nodeModel;if(t&&t.options.hasOwnProperty("mbse_highlight"))return"catmbse-node-highlighted"}}];return e===n.mode.usedmodel?o.push({text:i.column.isLastIteration,dataIndex:"isLastIteration",editableFlag:!1,sortableFlag:!0,width:95,typeRepresentation:"boolean"}):o.push({text:i.column.usage,dataIndex:"usage",editableFlag:!1,sortableFlag:!0,width:95,typeRepresentation:"tag",getCellValue:function(e){if(e.nodeModel){var t,o=e.nodeModel.getAttributeValue("usage"),r=e.nodeModel.options.tag,s=UWA.is(r)&&""!==r?r.split("/")[1]:null;return o&&(t=o!==n.usage.deleted&&null!==s?s+" ("+i.usage[o]+")":i.usage[o]),t}}}),o.push({text:i.column.maturity,dataIndex:"state",editableFlag:!1,sortableFlag:!0,width:95,typeRepresentation:"tag"},{text:i.column.name,dataIndex:"name",editableFlag:!1,sortableFlag:!1,width:95,typeRepresentation:"string",visibleFlag:!1},{text:i.column.contentVersion,dataIndex:"contentVersion",editableFlag:!1,sortableFlag:!1,width:95,typeRepresentation:"string",visibleFlag:!1},{text:i.column.contentType,dataIndex:"contentType",editableFlag:!1,sortableFlag:!1,width:95,typeRepresentation:"string",visibleFlag:!1},{text:i.column.owner,dataIndex:"ownerFullname",editableFlag:!1,sortableFlag:!1,width:95,typeRepresentation:"string",visibleFlag:!1,getCellValue:function(e){if(e.nodeModel){var t=e.nodeModel.getAttributeValue("ownerName"),i=e.nodeModel.getAttributeValue("ownerFullname");return null!==i?i:t}}},{text:i.column.modifier,dataIndex:"modifierFullname",editableFlag:!1,sortableFlag:!1,width:95,typeRepresentation:"string",visibleFlag:!1,getCellValue:function(e){if(e.nodeModel){var t=e.nodeModel.getAttributeValue("modifierName"),i=e.nodeModel.getAttributeValue("modifierFullname");return null!==i?i:t}return null}}),o.forEach((function(e){"state"===e.dataIndex?e.getCellClassName=function(e){let i=e.nodeModel;if(i){let e=i.options.grid.state,n=i.options.grid.policy,o=t.getAndCreateMaturityClass(n,e,"wux-controls-label");return i.options.hasOwnProperty("mbse_highlight")&&(o+=" catmbse-node-highlighted"),o}return{}}:"usage"===e.dataIndex?e.getCellClassName=function(e){let t=e.nodeModel;if(t){let e,i=t.options.grid.usage;return i&&(e="usage-status-"+i),t.options.hasOwnProperty("mbse_highlight")&&(e+=" catmbse-node-highlighted"),e}return{}}:e.getCellClassName=function(e){let t=e.nodeModel;if(t&&t.options.hasOwnProperty("mbse_highlight"))return"catmbse-node-highlighted"}})),o},getAndCreateMaturityClass:function(e,t,i){if("string"!=typeof t)return"";var n=t.replace(/(\.| )/g,"-");return"lc-status-"+e.replace(/(\.| )/g,"-")+"-"+n+(i?"-withClass":"")},registerProfileFilter:function(e){e.getFilterManager().registerFilter("stringProfile",o)},registerHistoryFilter:function(e){e.getFilterManager().registerFilter("booleanHistory",r)},getDefaultFilterModel:function(e){var t={label:{filterId:"stringRegexp"},state:{filterId:"set"},contentVersion:{filterId:"set"}};return"catmbse-usedmodel"===e?t.isLastIteration={filterId:"set"}:(t.usage={filterId:"set"},t.contentType={filterId:"set"}),t}}})),define("DS/CATMBSEProperties/components/datagridview.menu",["UWA/Core","DS/CATMBSEProperties/utils/Services","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/CATMBSEProperties/assets/nls/CATMBSEProperties"],(function(e,t,i,n){"use strict";return{getOpenWithCompatibleApps:function(n,o,r){if(n){var s=t.form3DXContent([n],o,r),a=new i;return a.set3DXContent(s,!1),e.is(a.retrieveCompatibleApps,"function")?new Promise((function(t){e.is(a.retrieveCompatibleApps,"function")?a.retrieveCompatibleApps((function(e){t(e)})):t([])})):void 0}},getMenu:function(e,t){var i=[],n=e.collectionView.treeDocument.getSelectedNodes();if(1===n.length){n[0];var o=this._createOpenWithMenu(t);o&&i.push(o)}return i},_createOpenWithMenu:function(e){var t,i=this;return e&&e.length>0&&((t=this._createMenuItem(n.menu.open_with,"open-menu-dot")).submenu=[],e.forEach((function(e){t.submenu.push(i._createMenuItem(e.text,e.fonticon,e.handler,null,null,e.icon))}))),t},_createMenuItem:function(e,t,i,n,o,r,s){var a={type:"PushItem",title:e};return r&&(a.icon=r),t&&(a.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+t}),i&&(a.action={callback:i.bind(this)}),n&&(a.state="disabled",o&&(a.tooltip=o)),s&&(a.id=s),a}}})),define("DS/CATMBSEProperties/utils/WebServices",["UWA/Core","DS/WAFData/WAFData","DS/CATMBSEProperties/utils/Services","text!DS/CATMBSEProperties/assets/config/conf.json"],(function(e,t,i,n){"use strict";var o=JSON.parse(n);function r(i,n,o){var r=i;return r.method="POST",e.is(r.headers)||(r.headers={}),r.headers.Accept="application/json",r.headers["Content-Type"]="application/json",r.headers["Accept-Language"]="en",r.data=JSON.stringify(o),t.authenticatedRequest(n,r)}function s(e){return{condition:"and",rules:[{field:"dsmvmbse:cid",operator:"in",value:e}]}}return{getStatesAttributes:function(t){var n=t;if(!e.is(n,"object"))throw new Error("Invalid inputs for WebServices.getStatesAttributes");n.headers||(n.headers={}),n.headers.SecurityContext=n.contextId,r(n,i.get3DSpaceBaseUrl(n.tenant)+o.url.getStatesAttributes,{policies:o.defaultPolicies})},expandModel:function(e){"catmbse-usedmodel"===e.mode?this.getUsedModels(e):this.getUsingModels(e)},getUsedModels:function(t){var n=t;if(!e.is(n,"object"))throw new Error("Invalid inputs for WebServices.getUsedModels");n.headers||(n.headers={}),n.headers.SecurityContext=n.contextId,r(n,i.get3DSpaceBaseUrl(n.tenant)+o.url.searchModel+"&$fields=dsmvmbse:ModelTitle,dsmvmbse:name,dsmvmbse:ModelContentType,dsmvmbse:ModelContentVersion,dsmvmbse:state,dsmvmbse:policy,dsmvmbse:ModelUUID,dsmvmbse:Icon,dsmvmbse:UsedDirectModel",s([n.id]))},getUsingModels:function(t){var n=t;if(!e.is(n,"object"))throw new Error("Invalid inputs for WebServices.getUsingModels");n.headers||(n.headers={}),n.headers.SecurityContext=n.contextId,r(n,i.get3DSpaceBaseUrl(n.tenant)+o.url.searchModel+"&$fields=dsmvmbse:ModelTitle,dsmvmbse:name,dsmvmbse:ModelContentType,dsmvmbse:ModelContentVersion,dsmvmbse:state,dsmvmbse:policy,dsmvmbse:ModelUUID,dsmvmbse:Icon,dsmvmbse:UsingDirectModel",s([n.id]))},getAllHistorical:function(t){var n=t;if(!e.is(n,"object"))throw new Error("Invalid inputs for WebServices.getAllHistorical");n.headers||(n.headers={}),n.headers.SecurityContext=n.contextId,r(n,i.get3DSpaceBaseUrl(n.tenant)+o.url.searchModel+"&$fields=dsmvmbse:UsingBranch",s([n.id]))},bulkFetch:function(t){var n=t;if(!e.is(n,"object"))throw new Error("Invalid inputs for WebServices.bulkFetch");n.headers||(n.headers={}),n.headers.SecurityContext=n.contextId;var a,l,d,c=i.get3DSpaceBaseUrl(n.tenant)+o.url.searchModel+"&$fields=dsmvmbse:ModelTitle,dsmvmbse:name,dsmvmbse:ModelContentType,dsmvmbse:ModelContentVersion,dsmvmbse:state,dsmvmbse:policy,dsmvmbse:ModelUUID,dsmvmbse:Icon";n.branchOnly?(l=n.ids,d=[],l.forEach((function(e){d.push({condition:"and",rules:[{field:"dsmvmbse:branch",operator:"=",value:e}]})})),a={condition:"or",rules:d}):a=s(n.ids),r(n,c,a)},getBranchInfo:function(t){var n=t;if(!e.is(n,"object"))throw new Error("Invalid inputs for WebServices.getBranchInfo");n.headers||(n.headers={}),n.headers.SecurityContext=n.contextId;var s=i.get3DSpaceBaseUrl(n.tenant)+o.url.getBranchInfo,a=[];t.ids.forEach((function(e){a.push({id:e})})),r(n,s,{branchInfoRequests:a})},getPerson:function(n){var r=n;if(!e.is(r,"object"))throw new Error("Invalid inputs for WebServices.getBranchInfo");r.headers||(r.headers={}),r.headers.SecurityContext=r.contextId,function(e,i,n){var o="en";"zh"===o&&void 0===n&&(o+="_CN"),e.method="GET",e.headers.Accept="application/json",e.headers["Content-Type"]="application/json",e.headers["Accept-Language"]=o,t.authenticatedRequest(i,e)}(r,i.get3DSpaceBaseUrl(r.tenant)+o.url.pno.person+n.trigram)}}})),define("DS/CATMBSEProperties/components/datagridview",["UWA/Core","UWA/Class/View","UWA/Class/Events","DS/Logger/Logger","DS/Windows/ImmersiveFrame","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Loader","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreenInstance","DS/CATMBSEProperties/components/datagridview.columns","DS/CATMBSEProperties/components/datagridview.toolbar","DS/CATMBSEProperties/components/datagridview.menu","DS/CATMBSEProperties/utils/WebServices","DS/CATMBSEProperties/utils/Services","text!DS/CATMBSEProperties/assets/config/conf.json","i18n!DS/CATMBSEProperties/assets/nls/CATMBSEProperties"],(function(e,t,i,n,o,r,s,a,l,d,c,u,g,h,m,p,f,b){"use strict";var v=JSON.parse(f);return t.extend(i,{name:"catmbse-datagridview",_logger:null,className:".catmbse-datagridview",mode:"catmbse-usedmodel",modelID:null,contextId:null,tenant:null,elements:{toolbar:{}},mapBranchTitle:{},mapPNO:{},_columnVisibilityBackup:{},hasStandardProfiles:!1,init:function(t){var i=this;this._logger=n.getLogger(this.name),this._logger.log("init"),this.elements.container=new e.createElement("div"),this.elements.container.addClassName("catmbse-datagridview"),this.elements.container.inject(t.parentContainer),this.loader=(new l).inject(t.parentContainer),e.is(t.mode)&&(this.mode=t.mode),e.is(t.modelID)&&(this.modelID=t.modelID),e.is(t.contextId)&&(this.contextId=t.contextId),e.is(t.tenant)&&(this.tenant=t.tenant),this.createModel(),this.setImmersiveFrame(),this.notifManager=d;let o=new c;o.setNotificationManager(this.notifManager),o.setStackingPolicy(17),o.inject(this.elements.container),this._getStatesAttributes().then((function(e){i.addCSSMaturityClasses(e,"wux-controls-label")}),(function(){i.addCSSMaturityClasses(null,"wux-controls-label")})),this.beginBlockingTransaction(),this.getSystemModel().then((function(e){i._processRelationships(e.node,e.relationships).then((function(t){e.node.expand(),i.render(),i._postUpdate(t),i.getNodesFullName(),i.endBlockingTransaction()}),(function(){i._logger.error("Failed to expand SystemModel"),i.endBlockingTransaction()}))}),(function(){i._logger.error("Failed to get SystemModel"),i.render(),i.endBlockingTransaction()}))},hide:function(e){this.elements.toolbar[this.mode]&&this.elements.toolbar[this.mode].hide()},show:function(e){this.elements.toolbar[this.mode]&&this.elements.toolbar[this.mode].show()},destroy:function(){this.elements.container&&this.elements.container.remove(),this.elements.toolbar[this.mode]&&this.elements.toolbar[this.mode].remove()},onResize:function(){this.elements.container.getSize().width<400?(this.showOnlyTree||this.hideShowColumns(!1),this.showOnlyTree=!0):this.showOnlyTree&&(this.hideShowColumns(!0),this.showOnlyTree=!1)},hideShowColumns:function(e){var t=this;this.datagridview&&this.columns.forEach((function(i){"tree"!==i.dataIndex&&(!0===e?t.datagridview.layout.setColumnOrGroupProperties(i.dataIndex,{visibleFlag:t._columnVisibilityBackup[i.dataIndex]}):(t._columnVisibilityBackup[i.dataIndex]=i.visibleFlag,t.datagridview.layout.setColumnOrGroupProperties(i.dataIndex,{visibleFlag:!1})))}))},createModel:function(){this.model=new s({useAsyncPreExpand:!0}),this.model.onPreExpand(this._preExpandCBV2.bind(this)),this.isUsedModelFacet()?u.registerProfileFilter(this.model):u.registerHistoryFilter(this.model)},render:function(){this.buildDataGridView(),this.immersiveFrame.inject(this.elements.container)},setImmersiveFrame:function(){this._logger.log("setImmersiveFrame"),this.immersiveFrame||(this.immersiveFrame=new o({reactToPointerEventsFlag:!1}))},_getDGVIdentifier:function(){return this.mode+"-datagridview-"+this.modelID.replace(/cid:([A-F0-9]{32})\/branch:([A-F0-9]{32})/,"$1-$2")},buildDataGridView:function(){this._logger.log("buildDataGridView");var e=this;this.columns=u.getDataGridViewColumns(this.mode),this.datagridview=new r({identifier:this._getDGVIdentifier(),height:"inherit",treeDocument:this.model,columns:this.columns,defaultColumnDef:{typeRepresentation:"string",width:"auto"},rowGroupingOptions:{depth:1,hideGroupedColumns:!0,canNodeBeGrouped:e=>!e.isRoot(),getGroupingNodeLabel:function(e){return e.options.children[0].getAttributeValue("title")},getGroupingNodeIcons:function(e){return[{iconName:"group",iconSize:{height:"16px",width:"16px"}}]},getGroupingNodeOptions:function(e,t){return e.collapse(),{}}},layoutOptions:{rowsHeader:!1,useLastColumnWidthAutoFlag:!0},cellSelection:"none",rowSelection:"single",cellActivationFeedback:"row",sortModel:[{dataIndex:"tree",sort:"asc"}],onContextualEvent:function(t){if(t.cellInfos){if(t.cellInfos&&-1===t.cellInfos.rowID)return t.collectionView.buildDefaultContextualMenu(t);var i=t.collectionView.treeDocument.getSelectedNodes();return 1===i.length?h.getOpenWithCompatibleApps(i[0],e.tenant,e.contextId).then((function(e){return h.getMenu(t,e)})):void 0}}}),this.setupXSO(),this.setToolbar(),this.onResize(),this.immersiveFrame.setContentInBackgroundLayer(this.datagridview.getContent())},setupXSO:function(){var e=this;this.isUsedModelFacet()&&(this.nodesXSO=this.datagridview.getNodesXSO(),this.nodesXSO.onPostAdd((function(t){t.forEach((function(t){e.highlightSimilar(t,!0)}))})),this.nodesXSO.onPostRemove((function(t){t.forEach((function(t){e.highlightSimilar(t,!1)}))})))},highlightSimilar:function(e,t){var i=this;if(this.isUsedModelFacet()&&e){var n=e.options.id,o=e.options.iteration,r=this.model.getRoots()[0].getAllDescendants().filter((function(t){return t!==e}));i._getNodesById(r,n,o).forEach((function(e){t?e.options.mbse_highlight=!0:delete e.options.mbse_highlight,i.datagridview.updateRowView(e.getRowID(),{updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!0})}))}},updateHighlight:function(){var e=this;if(this.isUsedModelFacet()){var t=this.model.getSelectedNodes();t&&t.forEach((function(t){e.highlightSimilar(t,!0)}))}},isUsedModelFacet:function(){return this.mode===v.mode.usedmodel},isUsingModelFacet:function(){return this.mode===v.mode.usingmodel},setToolbar:function(){this.elements.toolbar[this.mode]=e.createElement("div",{class:"catmbse-datagridview-toolbar"}),this.toolbar=this.datagridview.setToolbar(g.getToolbarModel(this.mode,this.refreshFilter.bind(this))),this.elements.toolbar[this.mode].appendChild(this.toolbar.getContent()),this.elements.toolbar[this.mode].inject(this.elements.container.closest(".IDCardInnerBottomArea").getElementsByClassName("actionArea")[0]),this.updateToolbarState()},updateToolbarState:function(){let e=this.toolbar.visibleFlag;this.isUsedModelFacet()&&(this.hasStandardProfiles?e||this.toolbar.show():e&&this.toolbar.hide())},refreshFilter:function(t){this._logger.log("refreshFilter");var i=this;if(i.toolbar){var n=i.toolbar.getNodeModelByID("withProfiles"),o=i.toolbar.getNodeModelByID("withHistory");if(n)n.getAttributeValue("data")?i._resetFilterModel():(i._resetFilterModel(),i._setContentTypeFilter());else if(o){o.getAttributeValue("data")?(i._resetFilterModel(),i.model.historyFetched?i._resetFilterModel():i.getHistoricalUsage().then((function(){i.model.historyFetched=!0,i.historicalBranches&&(i.beginBlockingTransaction(),m.bulkFetch({ids:i.historicalBranches,tenant:i.tenant,contextId:i.contextId,branchOnly:!0,onComplete:function(t){i._logger.debug("bulkFetch.onComplete"),i.endBlockingTransaction();var n=e.is(t,"string")?JSON.parse(t):t,o=[];n.models.forEach((function(e){var t={id:e.cid,branch:e.branchName,branchid:e.branch,iteration:e.iteration,grid:{isHistorical:!0,usage:v.usage.deleted,modifierName:i._getModifier(e),modifierFullname:null,ownerName:i._getOwner(e),ownerFullname:null},children:null,hasBeenExpanded:!0};i._processAttributes(e,t),t.label=i._getDisplayName(t);var n=new a(t);i.model.getRoots()[0].addChild(n),o.push(n)})),i._getBranchTitle(o),i.getNodesFullName(),i.datagridview.reapplySortModel(),i.refreshFilter(),i.groupRows()},onFailure:function(e){i._logger.debug("bulkFetch.onFailure",e),i.endBlockingTransaction()}}))}))):(this._resetFilterModel(),this._setHistoryFilter())}}this.datagridview&&this.datagridview.reapplySortModel()},getHistoricalUsage:function(){this._logger.log("getHistoricalUsage");var t=this;return new Promise((function(i,n){var o=[],r=t.model.getRoots()[0].getAllDescendants();r&&r.forEach((function(e){e&&e.options.branchid&&o.push(e.options.branchid)})),t.beginBlockingTransaction(),m.getAllHistorical({id:t.modelID,tenant:t.tenant,contextId:t.contextId,onComplete:function(n){t._logger.debug("getAllHistorical.onComplete"),t.endBlockingTransaction();var r=e.is(n,"string")?JSON.parse(n):n;if(1===r.models.length){var s=r.models[0].attributes.usingBranch;s&&(t.historicalBranches=s.filter((function(e){return!o.includes(e)})))}i()},onFailure:function(e){t._logger.debug("getAllHistorical.onFailure",e),t.endBlockingTransaction(),i()}})}))},getSystemModel:function(){this._logger.log("getSystemModel");var t=this;return new Promise((function(i,n){m.expandModel({mode:t.mode,id:t.modelID,tenant:t.tenant,contextId:t.contextId,onComplete:function(o){t._logger.debug("expandModel.onComplete"),t.endBlockingTransaction();var r=e.is(o,"string")?JSON.parse(o):o;if(1===r.models.length){var s=r.models[0],l={id:s.cid,branch:s.branchName,branchid:s.branch,iteration:s.iteration,grid:{modifierName:t._getModifier(s),modifierFullname:null,ownerName:t._getOwner(s),ownerFullname:null},children:null,hasBeenExpanded:!0};t._processAttributes(s,l),l.label=t._getDisplayName(l);var d=p.checkClientVersion(s.attributes.contentType,s.attributes.contentVersion);console.log("isVersionSupported="+d+" for "+s.attributes.contentType+" "+s.attributes.contentVersion);var c=new a(l);t._getBranchTitle([c]),t.model.addRoot(c),i({node:c,relationships:r.relationships||[]})}else n()},onFailure:function(e){t._logger.log("expandModel.onFailure",e),n()}})}))},_getBranchTitle:function(t){for(var i=this,n=[],o=0;o<t.length;o++){var r=t[o].options.branchid;-1===n.indexOf(r)&&n.push(r)}this.beginBlockingTransaction(),m.getBranchInfo({ids:n,tenant:this.tenant,contextId:this.contextId,onComplete:function(n){i._logger.debug("getBranchInfo.onComplete"),i.endBlockingTransaction();var o=e.is(n,"string")?JSON.parse(n):n;i.updateBranchTitle(t,o)},onFailure:function(e){i._logger.debug("getBranchInfo.onFailure",e),i.endBlockingTransaction()}})},groupRows:function(){var e=this;this.isUsingModelFacet()&&(this.datagridview.groupRows({dataIndexesToGroup:["name"],ignorePreprocess:!0}),setTimeout((function(){e.datagridview.reapplySortModel()}),500))},updateBranchTitle:function(t,i){var n=this;this.model.withTransactionUpdate((function(){e.is(i.branchInfoRequests,"array")&&i.branchInfoRequests.forEach((function(e){e.title&&n._getNodesByBranchId(t,e.id).forEach((function(t){var i={branch:t.options.branch,iteration:t.options.iteration,grid:{branchTitle:e.title,title:t.options.grid.title}};i.label=n._getDisplayName(i),t.updateOptions(i)}))}))}))},_processAttributes:function(e,t){Object.keys(e.attributes).forEach((function(i){"icon"===i?t.icons=[{iconPath:e.attributes[i],iconSize:{height:"16px",width:"16px"}}]:t.grid[i]=e.attributes[i]})),t.grid.i3dx=this._computei3dx(e.cid,e.attributes.contentType)},_getNodesById:function(e,t,i){var n=[];return e.forEach((function(e){e.options.id!==t||e.options.iteration!==i&&null!==e.options.iteration||n.push(e)})),n},_getNodesByBranchId:function(e,t){var i=[];return e.forEach((function(e){e.options.branchid===t&&i.push(e)})),i},_preExpandCBV2:function(t){var i=this;!t.target.options.hasBeenExpanded&&e.is(t.target.options.id)?(this.beginBlockingTransaction(),this._expandModel(t.target).then((function(e){i._processRelationships(e.node,e.relationships).then((function(e){i.endBlockingTransaction(),i._postUpdate(e),t.target.options.hasBeenExpanded=!0,t.target.preExpandDone()}),(function(){i._logger.error("Failed to process rel nodes"),i.endBlockingTransaction()}))}),(function(){i._logger.error("Failed to expand SystemModel"),t.target.preExpandDone(),i.endBlockingTransaction(),i.alertMessage("error","Failed to expand SystemModel")}))):t.target.preExpandDone()},_postUpdate:function(e){this.updateHighlight(),this._getBranchTitle(e),this.datagridview.reapplySortModel(),this.refreshFilter(),this.updateToolbarState(),this.groupRows()},_getIterationFromTag:function(t){return e.is(t)&&""!==t?t.split("/")[1]:null},_processRelationships:function(t,i){var n=this,o={idToRel:{},fullids:[],ids:[]},r=[];return i.forEach((function(t){let i,s;var a=n._getIterationFromTag(t.attributes.tag);n.isUsedModelFacet()?(i=t.toCid,e.is(a)&&e.is(i)&&""!==i&&(s=i+"/"+a)):i=t.fromCid,e.is(i)&&i.contains(v.suffixCid.separator)?r.push(t):(e.is(s)&&""!==s?o.fullids.push(s):e.is(i)&&""!==i&&o.fullids.push(i),e.is(i)&&""!==i&&(o.ids.push(i),o.idToRel[i]=t))})),n.processLimitedAccessNodes(t,r),new Promise((function(i,r){n._fetchAttributesV2(o.fullids).then((function(r){var s=[];o.ids.forEach((function(i){var l=r[i],d=o.idToRel[i];if(l){var c={id:l.cid,iteration:l.iteration,branch:l.branchName,branchid:l.branch,relid:e.is(d)?d.cid:null,tag:e.is(d)?d.attributes.tag:null,grid:{lastiteration:n._getLastIteration(l),modifierName:n._getModifier(l),modifierFullname:null,ownerName:n._getOwner(l),ownerFullname:null}};n.isUsedModelFacet()?(c.grid.isLastIteration=c.iteration===c.grid.lastiteration,c.children=[]):(c.children=null,c.hasBeenExpanded=!0,e.is(c.tag)&&""!==c.tag?c.tag.split("/")[1]===t.options.iteration?c.grid.usage=v.usage.synchro:c.grid.usage=v.usage.outdated:c.grid.usage=v.usage.latest),n._processAttributes(l,c),c.label=n._getDisplayName(c),c.isStandardProfile=p.isStandardProfile(c.grid.contentType,c.grid.policy),c.isStandardProfile&&(n.hasStandardProfiles=!0),s.push(new a(c))}})),n.model.withTransactionUpdate((function(){s.forEach((function(e){t.addChild(e)}))})),i(s)}),(function(){r()}))}))},processLimitedAccessNodes:function(e,t){var i=this;t.forEach((function(t){t.cid;var n=i.isUsedModelFacet()?t.toCid:t.fromCid;n.contains(v.suffixCid.denied)?e.addChild(new a({id:t.cid,label:b.denied,grid:{},icons:[{iconName:"block",iconSize:{height:"16px",width:"16px"}}]})):n.contains(v.suffixCid.deactivated)&&e.addChild(new a({id:t.cid,label:b.deactivated,grid:{},icons:[{iconName:"trash-recycle",iconSize:{height:"16px",width:"16px"}}]}))}))},_getLastIteration:function(e){var t=null;if(e.history)for(var i=e.history.branches,n=0;n<i.length;n++)if(i[n].uuid===e.branch){t=i[n].lastIteration;break}return t},_getOwner:function(e){var t=null;if(e.history)for(var i=e.history.branches,n=0;n<i.length;n++)if(i[n].uuid===e.branch){t=i[n].owner;break}return t},_getModifier:function(e){var t=null;if(e.history)for(var i=e.history.branches,n=0;n<i.length;n++)if(i[n].uuid===e.branch){t=i[n].modifier;break}return t},_fetchAttributesV2:function(t,i){var n=this;return new Promise((function(o,r){m.bulkFetch({ids:t,tenant:n.tenant,contextId:n.contextId,branchOnly:i,onComplete:function(t){n._logger.debug("bulkFetch.onComplete");var i=e.is(t,"string")?JSON.parse(t):t,r={};i.models&&i.models.forEach((function(e){r[e.cid]=e})),o(r)},onFailure:function(e){n._logger.debug("bulkFetch.onFailure",e),r()}})}))},_expandModel:function(t){var i=this;return new Promise((function(n,o){m.expandModel({mode:i.mode,id:t.options.id,tenant:i.tenant,contextId:i.contextId,onComplete:function(r){i._logger.debug("expandModel.onComplete");try{var s=e.is(r,"string")?JSON.parse(r):r;n({node:t,relationships:s.relationships||[]})}catch(e){i._logger.error(e),o()}},onFailure:function(e){i._logger.debug("expandModel.onFailure",e),o()}})}))},_computei3dx:function(e,t){return"i3dx:"+t.split(" ")[1]+"!"+e.replace("cid:","").replace("branch:","").replace("/",":")},_getDisplayName:function(t){var i=t.grid.title,n=t.branch,o=t.grid.branchTitle,r=t.iteration,s=i+" |";return e.is(o)&&(s+=" ["+o+"]"),e.is(n)&&(s+=" "+n),e.is(r)&&"catmbse-usingmodel"!==this.mode&&(s+=" ("+r+")"),s},_getStatesAttributes:function(){var t=this;return new Promise((function(i,n){m.getStatesAttributes({tenant:t.tenant,contextId:t.contextId,onComplete:function(n){t._logger.debug("getStatesAttributes.onComplete");var o=e.is(n,"string")?JSON.parse(n):n;i(o)},onFailure:function(){n()}})}))},addCSSMaturityClasses:function(e,t){var i=this;if(e&&e.policies){var n={};e.policies.forEach((function(e){n[e.policyName]=e.states})),v.defaultPolicies.forEach((function(e){var o=n[e];o&&i._createMaturityClasses(e,o,t)}))}else i._defaultMaturityClasses(t)},_defaultMaturityClasses:function(e){var t=this;v.defaultPolicies.forEach((function(i){t._createMaturityClasses(i,v.maturity_color,e)}))},_createMaturityClasses:function(e,t,i){var n=this;t.forEach((function(t){var o=t.activeColor,r="{color:"+("#FFFFFF"===o?"#000000":"#FFFFFF")+" ; background-color:"+o+";}",s=n._cleanValueForCSS(t.stateSysName),a="lc-status-"+n._cleanValueForCSS(e)+"-"+s+(i?"-withClass":""),l="."+a+(i?" ."+i:"");n._createCSSClass(a,r,l)}))},_cleanValueForCSS:function(e){return e.replace(/(\.| )/g,"-")},_createCSSClass:function(e,t,i){if(null===document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.id=e;let o=i||"."+e;n.innerHTML=o+t,document.getElementsByTagName("head")[0].appendChild(n)}},_resetFilterModel:function(){this.model.setFilterModel(u.getDefaultFilterModel(this.mode))},_setContentTypeFilter:function(){var e=u.getDefaultFilterModel(this.mode);e.contentType={filterId:"stringProfile",filterModel:{excludedTypes:["CATIA Magic Profile","CATIA Magic SysML v2 Standard Library"]}},this.model.setFilterModel(e)},_setHistoryFilter:function(){var e=u.getDefaultFilterModel(this.mode);e.isHistorical={filterId:"booleanHistory",filterModel:{hideHistory:!0}},this.model.setFilterModel(e)},beginBlockingTransaction:function(){this.loader.on()},endBlockingTransaction:function(){this.loader.off()},getNodesFullName:function(){var e=this,t=this.model.getRoots()[0],i=[];this._getTrigramToFetch(i,t),t.getAllDescendants().forEach((function(t){e._getTrigramToFetch(i,t)})),i.forEach((function(t){e.getFullName(t).then((function(i){e._updateNodesWithFullName(t,i)}),(function(){e._logger.warn("no fullname found for "+t)}))}))},_updateNodesWithFullName:function(e,t){var i=[this.model.getRoots()[0]];(i=i.concat(this.model.getRoots()[0].getAllDescendants())).forEach((function(i){let n=i.getAttributeValue("ownerFullname"),o=i.getAttributeValue("ownerName"),r=i.getAttributeValue("modifierFullname"),s=i.getAttributeValue("modifierName"),a={grid:{}},l=!1;o===e&&null===n&&(a.grid.ownerFullname=t,l=!0),s===e&&null===r&&(a.grid.modifierFullname=t,l=!0),l&&i.updateOptions(a)}))},_getTrigramToFetch:function(e,t){let i=t.getAttributeValue("ownerName"),n=t.getAttributeValue("ownerFullname"),o=t.getAttributeValue("modifierName"),r=t.getAttributeValue("modifierFullname");if(null===n){let t=i;-1===e.indexOf(t)&&e.push(t)}if(null===r){let t=o;-1===e.indexOf(t)&&e.push(t)}},getFullName:function(t){var i=this;return new Promise((function(n,o){e.is(i.mapPNO[t])?n(i.mapPNO[t]):m.getPerson({trigram:t,tenant:i.tenant,contextId:i.contextId,onComplete:function(o){i._logger.debug("getPerson.onComplete");var r=e.is(o,"string")?JSON.parse(o):o;i.mapPNO[t]=r.firstname+" "+r.lastname,n(i.mapPNO[t])},onFailure:function(){o()}})}))},alertMessage:function(e,t,i){t=t?t.replace(/(\r\n|\n|\r)/gm,"<br>"):"",this.notifManager.addNotif({level:e,message:t,sticky:i})}})})),define("DS/CATMBSEProperties/facets/CATMBSEModelUsageFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/Logger/Logger","DS/EditPropWidget/facets/Common/FacetsBase","DS/CATMBSEProperties/components/datagridview","DS/CATMBSEProperties/utils/Services","i18n!DS/CATMBSEProperties/assets/nls/CATMBSEProperties","css!DS/CATMBSEProperties/CATMBSEProperties.css"],(function(e,t,i,n,o,r,s,a){"use strict";var l=i.extend(o,{_logger:null,modelCID:null,name:null,init:function(e){this._logger=n.getLogger(this.name),this._parent(e),this.contextId=e.securityContextFromAppPreference,this.tenant=e.tenant,this.buildLayout()},buildLayout:function(){this._logger.log("buildView"),this.elements.container=e.createElement("div",{class:"catmbse-modelusage"}),this.multiselDisplay=e.createElement("div",{class:"notSupported"}).inject(this.elements.container),this.iconHolder=e.createElement("span",{class:"blockIcon"}).inject(this.multiselDisplay),this.infoMsgH2Tag=e.createElement("h2",{class:"information_msg"}).inject(this.multiselDisplay),this.multiselDisplay.hide()},initComponent:function(){this._logger.log("initComponent");var e=this;s.getAppSecurityContext(this.contextId).then((function(t){e.datagridview=new r({parentContainer:e.elements.container,mode:e.name,modelID:e.getModelID(),tenant:e.tenant?e.tenant:s.getTenant(),contextId:t})}))},refreshNode:function(e){this._logger.log("refreshNode",e)},getModelID:function(){return this.getModel().get("objectId")},updateFacet:function(){if(this._logger.log("updateFacet"),!this.getModel())return this.datagridview&&this.datagridview.hide(),this.notApplicable(),!1;var e=this.getModelID();if(!e)return this.notApplicable(),!1;this.multiselDisplay.hide(),this.datagridview?this.hasChanged(e)?(this.modelCID=e,this.datagridview.destroy(),this.initComponent()):this.datagridview.show():(this.modelCID=e,s.app_initialization(this.initComponent.bind(this)))},hasChanged:function(t){return!e.is(this.modelCID)||this.modelCID!==t},destroyComponent:function(){this._logger.log("destroyComponent"),this.datagridview&&this.datagridview.destroy(),e.is(this.destroy,"function")&&this.destroy()},notApplicable:function(){this._logger.log("notApplicable"),this.infoMsgH2Tag.setText(a.msg_not_supported_selection),this.iconHolder.addClassName("wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-block"),this.multiselDisplay.show(),this.datagridview&&this.datagridview.hide()},hide:function(){return this.datagridview&&this.datagridview.hide(this.name),this._parent.apply(this,arguments)},show:function(){return this.datagridview&&this.datagridview.show(this.name),this._parent.apply(this,arguments)},onResize:function(){this._logger.log("onResize"),this.datagridview&&this.datagridview.onResize()},onRefresh:function(){this._logger.log("onRefresh"),this.updateFacet()}});return l})),define("DS/CATMBSEProperties/facets/CATMBSEUsedModelFacet",["UWA/Core","UWA/Class","DS/CATMBSEProperties/facets/CATMBSEModelUsageFacet","text!DS/CATMBSEProperties/assets/config/conf.json"],(function(e,t,i,n){"use strict";var o=JSON.parse(n);return i.extend({name:o.mode.usedmodel})})),define("DS/CATMBSEProperties/facets/CATMBSEUsingModelFacet",["UWA/Core","UWA/Class","DS/CATMBSEProperties/facets/CATMBSEModelUsageFacet","text!DS/CATMBSEProperties/assets/config/conf.json"],(function(e,t,i,n){"use strict";var o=JSON.parse(n);return i.extend({name:o.mode.usingmodel})}));