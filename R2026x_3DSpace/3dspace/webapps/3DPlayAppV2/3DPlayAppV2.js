var id="";"undefined"!=typeof widget&&widget.id&&(id=widget.id),window["3DPlay.ProbesManager.clapDone"]=!0,window.performance.mark(id+"clap");try{window.top.performance.mark(id+"clap")}catch(e){window["3DPlay.ProbesManager.TopWindowNotAvailable"]=!0}var mark=id+"_3DPlayApp";window.performance.mark(mark);var status="";window["3DPlay.AFRV2"]=!0,define("DS/3DPlayAppV2/3DPlayAppAFR",["DS/WAfrAppManager/App","DS/WebUtils/Logger","DS/3DPlayWidget/Widget3DPlay","DS/WebSystem/Environment","DS/WebSystem/Settings","UWA/Promise","DS/WebUtils/ProbesManager","DS/WebUtils/Tracker","DS/3DPlaySupport/SupportList","DS/3DPlaySupport/AssetSupport","DS/WebUtils/Profiler","DS/3DPlayWidgetControllers/3DPlayWidgetProxy","DS/WebUtils/WebServices","DS/3DPlayWidget/3DPlayWidgetLinkManager","DS/CoreEvents/Events","DS/3DPlayWAFRMigration/WAFR2Utils","text!3DPlayApp/assets/json/CAT3DPLAW_AP.idcard.json","DS/3DPlayWAFRMigration/CommandsManager"],(function(e,i,t,n,r,o,a,s,d,p,l,g,c,u,w,D,P,y){"use strict";var f,h=new g;P=JSON.parse(P);var S=["i18n!DS/ENOCockpitV2/assets/nls/ENOCockpitV2.json","DS/PADServices/views/private/AppStructure"],v={};require(S.concat(["i18n!DS/3DPlayApp/assets/nls/3DPlayApp"]),(function(e,i,t){v=e,C=i})),a.createProbe("Widget_EntryPoint",mark).end();var A=a.createProbe("Unified_Widget_2");A.begin();var m,x,b,W,_,C,V=!1,E=!1,I=!1,T=["3DSPACE","EV6","R2VSURVEY"];widget.getValue("x3dPlatformId")||widget.setValue("x3dPlatformId",c.getTenant()),"OnPremise"!==widget.getValue("x3dPlatformId")&&n.set("3DPlay.Plateform.Cloud",!0);var O=i("3DPlay.3DPlayAppAFR");return class extends e{constructor(e){O.warn("constructor",e),super(e),_=this,D.setCurrentSpecialization("X3DPLAW_AP")}setUp(e){D.setExecutionContext(this._executionContext),O.warn("setUp",e),A.end(),a.createProbe("Widget_3DPlay").begin(),b=w.subscribe({event:"onRootAdded"},(function(e){W=e})),I=!1;var i,n,r={};return e&&(i=e.sourceApp),new Promise((o=>{if(this.widget=widget,e.sourceApp){if(e.sourceApp.view){this.view=e.sourceApp.view;e.sourceApp.appMainDiv;e.sourceApp.appMainDiv||widget.body.firstChild}if(i.options.id===this.options.id)return e.done(),void(this.pad3DViewer=i.pad3DViewer);var a;if("outside"===status){var d=l.stop("3DPlayAppTimer");d>0&&(a={timeOustSide3DPlay:d})}s.trackPageEvent("transitions","transition-from",i.options.title,void 0,a),this.pad3DViewer=i.pad3DViewer;var g=void 0!==this.pad3DViewer;if(g){if(!i.isDisposeCalled()){var c={disposeFrameWindow:!1,appInfo:"X3DPLAW_AP"};i.dispose(c),c.preferredType&&(n=c.preferredType)}y.isAFR2()||y._reset(),r={ctx:this.pad3DViewer.getCommandContext(),pad3DViewer:this.pad3DViewer,appMainDiv:i.appMainDiv};let e=_.pad3DViewer.getViewer();e&&e.updateViewPanelUIConfiguration&&e.updateViewPanelUIConfiguration({useShadingIllustration:!0,useOutline:!0});try{(m=_.pad3DViewer.getRoots())&&(m=!(!Array.isArray(m)||!m.length))}catch(e){m=!1}}u.update(!0),e.done(),o()}else u.init().then((function(){u.update(!0)})),e.done(),o();status="inside",l.start("3DPlayAppTimer"),r.callbacks={ASSET:{LOADINGFINISHED:function(e){if(m)return V=!1,void(m=!1);var i=e.loadAssetInfo;V="string"==typeof i||!(i&&T.indexOf(i.provider)>-1)}},experience:{experienceready:[function(e){_.pad3DViewer=e.pad3DViewer,_.experience=e,widget.dispatchEvent("onWidgetAndAppReady",_)}]}};var w={options:r,widgetCB:function(i){x=i,h.waitLoadEvent((function(e){x.wModel.setCurrentContent(e)})),h.waitRefreshEvent((function(){widget.dispatchEvent("onRefresh")})),_.appMainDiv=i.wModel.getCanvasDiv(),x.wPlayer.lightbox||g?(e.done(),m&&x.wModel.setCurrentContentFromSwitch(_.pad3DViewer.getRoots())):e.done(_.appMainDiv)}};n?p.getExperienceID({provider:"3DSPACE",type:n},{},(function(e){w.experience=e,t({widget:widget,applicationFrameOptions:w})})):t({appSpecializations:f&&f.appSpecializations,widget:widget,applicationFrameOptions:w})}))}dispose(e){O.warn("dispose",e);var i=this;return new Promise((e=>{if(status="outside",!I){I=!0;var t={disposeFrameWindow:!E,cleaarSession:!0};if(f&&P.afrSpecializations.indexOf(f.appSpecializations)>-1&&(t.appSpecializations=f.appSpecializations),!0===V)if(i.pad3DViewer)if(i.experience&&!i.experience.disposed)i.experience.clearView(),i.pad3DViewer.getFrameWindow().getViewer().render();f.appSpecializations||h.dispose(),x.dispose(t),f.appSpecializations||(x=null,i.experience=null,i=null),E=!1,e()}}))}onWillEnter(e){return O.warn("onWillEnter",e),new Promise(((i,t)=>{var n={};if(n[e.id])return t(new Error(n[e.id]));i()}))}onWillLeave(e){return O.warn("onWillLeave",e),new Promise(((i,t)=>{var n=!1,r=v.SpecificData_NoTransition,o={};if(o[e.id]?r=o[dstApp.options.id]:n=!0,P.afrSpecializations.indexOf(e.options.afrAppId)>=-1)f={appSpecializations:e.options.afrAppId},i();else{if(n&&this.experience&&this.experience.acceptSwitch&&(n=this.experience.acceptSwitch(e)),n&&this.pad3DViewer&&this.pad3DViewer.getController().hasAnyEffectiveFlexibleAssembly()&&(n=!1,r=S.transitionRefusedFlexibleAssemblies),!n)return t(new Error(r));if(E=!0,this.experience&&this.experience.publish("EXPERIENCE/TRANSITION",e),!m&&W&&!0!==W.fromLoadJSON){const e="xsceneStoredObjects";if(W.rootLog){C.setWidget(window.widget);var a=C.retrieveData(e);if(W.filterId){W.serviceId||(W.serviceId="3DSpace");({})[W.filterId]={associatedProduct:W.id},C.addFilter(a,W.filterId,W.id),C.addOpenFilter(a,[W.filterId])}else if("r2vsurvey"===W.serviceId)a.pCloudServiceId=W.serviceId,C.addPointCloud(a,W.idPath[0],W.soiId),C.addOpenPointCloud(a,W.soiId);else{W.serviceId||(W.serviceId="3DSpace"),C.addProductPath(a,W.idPath,!0);var d=[W.idPath];C.addOpenProduct(a,d)}C.persistData(e,a)}}if(W=void 0,this.pad3DViewer){b&&w.unsubscribe(b);var p={timeIn3DPlay:l.stop("3DPlayAppTimer")};l.start("3DPlayAppTimer"),s.trackPageEvent("transitions","transition-to",e.title?e.title:"",void 0,p);var g=window.widget;g.addEvent("onChangeFlexibleAssembliesSupport",(function(e,i){require("DS/PADUtils/PADSettingsMgt").setSetting(e,i)})),g.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:require("i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer").flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),require("DS/PADUtils/PADSettingsMgt").setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1),this.pad3DViewer.getController()._disableElasticLoadingForTransition(),this.pad3DViewer.getController()._disableStaticMappingSupport()}i()}}))}}})),define("DS/3DPlayAppV2/Widget",["DS/PADUtils/PADSettingsMgt","DS/WebSystem/Environment","DS/WebUtils/Logger"],(function(e,i,t){"use strict";t("3DPlay.3DPlayAppAFR");function n(e={}){this._appTitle=e.appTitle,this._appOptionsFiltePath=e.appConfigPath||"DS/ENOCockpitV2/assets/json/ENO3DViewerInfraOptions.json",this._identifiers={view:e.viewIdentifier},this._options=null,this._widgetProxy=null}return n.prototype.initialize=function(e){return new Promise(((e,t)=>{!0!==this._isComponentInitialized?this._initWidget().then(this._widgetReady.bind(this)).then(e).catch((e=>{i.isSet("3DPlay.Debug")&&console.error("Widget.initialize\n\tFatal error during initialization",e),t("Fatal error during initialization")})):e()}))},n.prototype.clean=function(){return new Promise((e=>e()))},n.prototype.destroy=function(e){return new Promise((e=>{delete this._appTitle,delete this._appOptions,delete this._identifiers,delete this._options,delete this._widgetProxy,e()}))},n.prototype.canBeParallelized=function(e){return!1},n.prototype._initWidget=function(i){return new Promise(((i,t)=>{try{this._widgetProxy=this.getExecutionContext().getComponent("AFR_WidgetProxyComponent"),this._widgetProxy=this._widgetProxy||widget,this._widgetProxy.setTitleHeader&&this._widgetProxy.setTitleHeader({brand:this._widgetProxy.getValue("brand"),appTitle:this._appTitle,title:""});let t="en";this._widgetProxy.getLanguage&&void 0!==this._widgetProxy.getLanguage()?t=this._widgetProxy.getLanguage():null===this._widgetProxy.lang&&void 0===this._widgetProxy.lang||(t=this._widgetProxy.lang),e.setSetting("lang",t),i()}catch(e){t(e)}}))},n.prototype._widgetReady=function(){return i.isSet("3DPlay.Debug")&&console.log("Widget._widgetReady called"),new Promise((e=>{this.getExecutionContext().setContext("WidgetReady",!0),this._isComponentInitialized=!0,e()}))},n.prototype.updateTitle=function(){return i.isSet("3DPlay.Debug")&&console.log("Widget.updateTitle called"),new Promise(((e,i)=>{this.getViewer().getContentName().then((i=>{this._widgetProxy.setTitle&&this._widgetProxy.setTitle(i.contentName),e()})).catch((e=>{this._widgetProxy.setTitle&&this._widgetProxy.setTitle(e.contentName),i()}))}))},n.prototype.getSessionWidget=function(){return i.isSet("3DPlay.Debug")&&console.log("Widget.getSessionWidget called"),"undefined"!=typeof widget?widget:null},n.prototype.getWidgetDOM=function(){return i.isSet("3DPlay.Debug")&&console.log("Widget.getWidgetDOM called"),this._widgetProxy.view.elements.container||widget.body.firstChild},n.prototype.getOptions=function(){return i.isSet("3DPlay.Debug")&&console.log("Widget.getOptions called"),this._options},n.prototype.getViewer=function(){return i.isSet("3DPlay.Debug")&&console.log("Widget.getViewer called"),this.getComponentFromIdentifier(this._identifiers.view)},n.prototype.getAppTitle=function(){return i.isSet("3DPlay.Debug")&&console.log("Widget.getOptions called"),this._appTitle},n}));