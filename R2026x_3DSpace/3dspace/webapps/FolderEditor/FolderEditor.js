function loadModules(...e){return new Promise((t=>{require(e,(function(){t([...arguments])}))}))}function blockDefault(e){e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.indexOf("Files")>=0&&e.preventDefault()}async function notifyWidgetReady(){let[e]=await loadModules("DS/IPClassifyUtil/IPSettingsMgr");e.isWebInWin()?require(["DS/FolderEditor/utils/FolderEditorEvents"],(function(e){e.notifyFolderEditorReady()})):widget.dispatchEvent("onFolderEditorReady")}function getRequires(){return["UWA/Core","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPServicesMgr","DS/IPClassifyUtil/IPContext","DS/FolderEditor/FolderComponent","DS/FolderEditor/FolderIdCardCont","DS/FolderEditor/FolderTreeCont","DS/FolderEditor/Folder_CSO","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/commands/FolderCommands","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderCommunication","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/IPClassifyUtil/IPClassifyModelEvents","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/CredentialsView","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUtil/PlatformAPIWrapper","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils",window.IPConfig.settingsFile,"DS/IPClassifyUXUtil/IPClassifyLoaderGlobal"]}async function initBookmark(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F,T,x){let P=this,A=e._subscriptionTokens;P.options=P.options||{},P.checkOnCommand=!1,n.set(P),window.performance.mark("loadRequire_end"),window.performance.measure(P.probeHeader+"loadRequire","createWidget_begin","loadRequire_end");var k=function(e){if(e){var t=E.getWidgetNls(e.label)||p[e.label];t=t||p.default_pref_label,e.label=t||e.label,e.options&&e.options.forEach((function(e){e.label=p[e.label]}))}};let N=JSON.parse(T);[N.padsettings.enopad.run_options,N.padsettings.enopad.debug_options].forEach(((e,t)=>{for(let i in e)o.setSetting(i,e[i].value,{init:!0}),0===t&&o.setPreferences(i,e[i])}));var M=function(e){var t=o.getSpecificWidgetPreference(e);t&&t.length>0&&k(t[0]),"useIndexAccleration"==e&&(t[0].onchange="onUseOnlyDBChange",widget.addEvent("onUseOnlyDBChange",(function(){var e=JSON.parse(JSON.stringify(widget.getPreference("autoSwitch")));widget.getValue("useIndexAccleration")?e.disabled=!1:e.disabled=!0,widget.addPreference(e),widget.dispatchEvent("onEdit")}))),"autoSwitch"==e&&(t[0].disabled=!widget.getValue("useIndexAccleration")),widget.mergePreferences(t)};"function"==typeof window.updateSettings&&window.updateSettings(N),widget.setValue("tenantAware",!0),C.subscribeOnce({event:"onNoPlatform"},(function(){f._getInstance()._isTenantInitialized=!1,widget.setBody(" "),UWA.createElement("div",{text:p.get("noPlatform_error"),class:"FolderEditor_auth_error"}).inject(widget.body)})),P.updateTitle=function(){P.setTitle&&P.setTitle(P._label)},C.subscribe({event:"onCustoViewChange"},(async function(e){let[t,o]=await loadModules("DS/FolderEditor/utils/FolderEditorUtil","DS/IPClassifyUtil/IPClassifyModelEvents");await t.setContentViewPreference(e,!1),o.publish({event:"ENOBook/AttributesCustomization/columnSwitchDone",data:{}})})),C.subscribe({event:"onPad_security_ctx"},P.updateTitle.bind(P)),C.subscribe({event:"onPad_tenant"},P.updateTitle.bind(P)),C.subscribe({event:"switch_row_hdr"},(e=>{P.getPADTreeListView().changeDgvLayout({rowsHeader:e.rowsHeader})})),E.getPreferenceOrder().forEach((function e(t){"string"==typeof t?M(t):t.debug?"1"===widget.getValue("debug_me")&&M(t.name):t.condition?!0===o.getSetting(t.condition)?e(t.A):t.B&&e(t.B):widget.addPreference(t)})),o.isWebInWin()&&widget.setValue("autoSwitch","Never"),o.setSetting("activateTreeFilter",!1),window.authoringModeODT&&widget.setValue("useIndexAccleration",!1),["x3dPlatformId"].forEach((function(e){var t=widget.getPreference(e);k(t)})),P.widget.addEvent("endEdit",o.updateWidgetPreferences.bind(o)),o.updateWidgetPreferences(),o.setSetting("activate_autodownload",!1),o.setSetting("EditModeActivated",!0),o.setSetting("compactMode",!0);let U=P.widget.getValue("appId")||P.widget.getValue("x3dAppId")||window.IPConfig.defaultAppId;P.widget.getValue("x3dAppId")||P.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:U}),P.widget.getValue("appId")||P.widget.addPreference({name:"appId",type:"hidden",defaultValue:U}),P.widget.addEvent("onPlatformIdChange",(function(e,t){"x3dPlatformId"==e&&C.publish({event:"onPad_tenant"})})),f.setWidgetRefresh(P.onRefresh.bind(P));let O=a.onBookmarkOpening((async()=>{let e=await h.getCurrentBookmarkInfo();e&&P.setTitle(e.getLabel())}));A.push(O),C.subscribe({event:"activate_tree_filter"},(e=>{o.setSetting("activateTreeFilter",e),c.notifyTaggerStatusChange()}));var R=y.getWidgetId()+y.getTenantID()+widget.getValue("x3dAppId");if(w.subscribe(R,(function(){let e=require("DS/FolderEditor/views/FolderMode");console.log("Event - Refresh Calling widget- called"),e.switchtoAuthoringMode(!0),C.publish({event:"refresh_content"}),C.publish({event:"refresh_tree"})})),c.onFolderRename((function(e){e.getID()===a.getCurrentBookmarkId()&&UWA.is(widget)&&P.setTitle(e.getLabel())})),P.setTitle=function(e){var t=y.getTenantID();let o=[];try{o=i.getTenantsPreference()}catch(e){console.log(e)}var n=o.filter((function(e){return e.value===t}))[0];n=n?n.label:t;var r=widget.getPreference("pad_security_ctx").value;P._csName&&P._currentSC===r?P._setTitle(e,n,P._csName):require(["DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService"],(function(o){o.getscandcollab({tenant:t}).then((t=>{(UWA.is(t,"string")?JSON.parse(t):t).collabspaces.forEach((function(e){!!r&&r.endsWith("."+e.name)&&(P._currentSC=r,P._csName=e.title.trim())})),e&&P._setTitle(e,n,P._csName)})).catch((e=>{}))}))},P._setTitle=function(e,t,o){let i=e||"";P._label=e,widget.setTitle(i)},P.getEditMode=function(){return require("DS/IPClassifyUtil/IPSettingsMgr").getSetting("EditModeActivated")},P._onRefreshFolder=function(e){var t=!1,o=[],i=require("DS/FolderEditor/views/FolderMode");let n=require("DS/IPClassifyUtil/IPClassifyModelEvents"),r=require("DS/FolderEditor/utils/WidgetHandlerUtil"),s=require("DS/FolderEditor/Folder_Clipboard"),l=e&&e.authored&&Array.isArray(e.authored.deleted),d=!e||!e.authored;if(d||i.switchtoAuthoringMode(!l),n.publish({event:"bookmark-product-expand-cancel-refresh"}),!l||(n.publish({event:"remove_nodes",data:e.authored.deleted}),0==s.removeDeletedNodeFromClipboard(e.authored.deleted)&&s.ClearClipboard(),1!==Object.keys(e.authored).length)){if(e&&e.authored&&UWA.is(e.authored.connected,"array")){var c=a.getCurrentBookmarkId(),u=e.authored.connected;if(u.length>0)for(var h=0;h<u.length;h++){var g=u[h];if(UWA.is(g,"array")){var f=g[0];if(g.length>1&&o.push(g[1]),f==c){t=!0;break}}}}e&&e.authored&&(UWA.is(e.authored.created,"array")||UWA.is(e.authored.modified,"array"))&&n.publish({event:"refresh_nodes",data:{created:e.authored.created,modified:e.authored.modified}}),t&&n.publish({event:"refresh_content",data:{objectId:o}}),d&&(n.subscribeOnce({event:"onCompleteRefreshNodes"},(()=>{require("DS/IPClassifyUtil/IPClassifyAlert").displayNotification({message:p.msg_info_refresh,className:"primary"})})),i.updateIconAndSettings(!1),r.refreshWidgetContent(),require(["DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUtil/PlatformAPIWrapper"],(function(e,t){e.isActiveBookmarkActivated()&&t.publish("FolderEditor.ActiveFolderCheck",{})})),P.widget.refreshDuetoChangeInPreference=!1,P.widget.changeInPreference={})}},_.subscribe("FolderEditor.refresh",P._onRefreshFolder.bind(P)),w.subscribe("DS/ENO/refresh",P._onRefreshFolder.bind(P)),null===P.folderTree_Cont||void 0===P.folderTree_Cont){P.core=t,P._buildSkeleton(),x.setContainer("global",this.widget.body.globalLoaderContainer),x.addComponentsToLoad("global",{widget:p.Widget_Loading});P.widget.addEvent("endEdit",(function(){P.widget.getPreferences().forEach((function(e){var t="boolean"===e.type&&UWA.is(e.value,"string")?P.convertToBool(e.value):e.value;P.widget.setValue(e.name,t)}))})),P.folderGlobal_div=P.widget.body.container,P.folderTree_div=P.widget.body.left_side_div,P.folderSlide_div=P.widget.body.slide_div,P.folderTreeDoc_div=P.widget.body.right_side_div,P.folderIdCard_div=P.widget.body.top_right_side_div,P.folderContent_div=P.widget.body.bottom_right_side_div;var L=P._initializeFolderEditorComponent.bind(P);let e=null,i=new Promise((t=>{e=t}));if(null===P.folderContent_Cont){var B={actionBarReadyPromise:e,x3dAppId:P.widget.getValue("x3dAppId"),lang:P.widget.lang?P.widget.lang:P.widget.getValue("lang"),layout:{view_customization:null,css_view_class:P.css_view_class,store_roots_in_pref:!0,padshell:!0},authorize_setStructure:!0,settings:N};if(!0===o.getSetting("resetCustomization"))localStorage.removeItem("PADTreeListDefinition."+P.widget.getValue("x3dAppId")+"_"+widget.getValue("x3dPlatformId")),L(B);else{let e=v.getContentViewPreference();var V=[];if(e){var W=e.preference;B.layout.view_customization=W;var j=widget.getValue("vMigration");if(W&&j!==W.version){console.log("Bookmark migration needed for preferences");var H=new Promise((function(t,o){require(["DS/FolderMigration/FolderMigration"],(function(i){i.migratePreferences(e,j).then(t).catch(o)}))}));V.push(H)}}Promise.all(V).then((function(){L(B)}))}P.waitForCtxReady=function(){return i},P.GetFilterSpec=function(e,t){return{filter:{prefix_filter:{prefix_path:t.V2.prefixPathArray}}}},P.getSelectedNodes=function(){var e=d.getTempSelection();return e||a.getSelectedNodes()},P.getCurrentFolder=function(){var e=v.getCurrentSecurityContextAndFolderData(!1);return JSON.stringify(e)},P.getSecurityContext=function(){var e=v.getTenant();let t=o.getWebCredential();return t?{SecurityContext:t,tenant:e.value}:null},P.RefreshView=function(e){var t=!1,o=e.created,i=e.modified,n=e.deleted,r=[];if(o.forEach((function(e){"Duplicate"===e.operation||"Revise"===e.operation?t=!0:console.log("  unknown operation :",e.operation)})),n.length>0&&n.forEach((function(e){"Delete"===e.operation&&e.physicalid.length>0&&r.push(e.physicalid)})),!t&&i.length>0){var s={};s.modified=i,C.publish({event:"refresh_content_nodes",data:s})}return r.length>0&&C.publish({event:"remove_nodes",data:r}),!0===t&&C.publish({event:"refresh_content",data:{keepExpandStatus:!0}}),e},P.beginBlockingTransaction=function(e){require(["DS/UIKIT/Mask"],(function(t){t.mask(P.folderContent_div,e)}))},P.endBlockingTransaction=function(){require(["DS/UIKIT/Mask"],(function(e){e.unmask(P.folderContent_div)}))},P.author=function(e){},P.insertNodes=function(e){var t=[];function o(e){-1===t.indexOf(e.resourceid)&&t.push(e.resourceid)}for(var i in e)e.hasOwnProperty(i)&&e[i].forEach(o);var n=t[0];P._insertOrAdd(n,"insert")},P.addRoots=function(e){if(e.pids.length>0){var t=e.pids[0];P._insertOrAdd(t,"add",!0)}},P._insertOrAdd=function(e,t,o){require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode(!0),C.publish({event:"refresh_tree",data:{creation:!0,expandCurrent:o,objectId:e}}),C.publish({event:"refresh_content",data:{objectId:e,insertMode:t}})},P.displayNotification=function(e){g.displayNotification({title:e.title?e.title:null,subtitle:e.subtitle?e.subtitle:null,message:e.msg,className:e.eventID})},P.getPADTreeDocument=function(){return P.folderComponent?P.folderComponent.getPADTreeDocument():this.options.model},P.toggleView=function(e){P.folderComponent&&UWA.is(P.folderComponent.toggleView)&&P.folderComponent.toggleView(e)},P.getPADTreeListView=function(){return P.folderComponent.getPADTreeListView()},P.getContentView=function(){return P.folderComponent},P.compactMode=function(e){C.publish({event:"update_view_mode",data:e})}}}}function preferenceIsNotSet(e){return void 0===widget.getValue(e)||null===widget.getValue(e)}async function buildServicePromise(){let[e]=await loadModules("DS/FolderEditor/service/FolderEditorWebService");await e.getServicesPromise()}async function buildPluginsPromise(){let[e]=await loadModules("DS/FolderEditor/plugins/PluginsManager");await e.initialize()}async function buildSettingsPromise(){let[e]=await loadModules("DS/FolderEditor/utils/SettingsHandler");await e.initialize()}function FolderEditor(e){"use strict";let t=buildPluginsPromise(),o=[];var i={widget:null,promiseInit:null,folderContent_Cont:null,folderTree_div:null,folderTreeDoc_div:null,folderTree_Cont:null,folderIdCard_div:null,folderIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,folderTree_W_NotLinked:!1,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:!1,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:!1,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(e){var t=this;this.widget=e.widget,e.launchWithReadMode&&(this.widget.launchWithReadMode=this.widget.readOnly=e.launchWithReadMode),this.widget.showDBCmd=e.showDBCmd,this.widget.folderToOpen=e.folderToOpen,this.widget.nativeAuthMode=e.nativeAuthMode,this.widget.multiselection=e.multiselection,this.reInitialize=e.reInitialize;var o=null,i={};this.widget=e.widget,this.widget.changeInPreference={},this.widget.refreshDuetoChangeInPreference=!1,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onDestroy",this.onDestroy.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this)),this.widget.addEvent("onFocus",this.onFocus.bind(this)),this.widget.addEvent("onEdit",(function(){o||(o=o||{},t.widget.preferences.forEach((function(e){"hidden"!==e.type&&(o[e.name]=t.widget.getValue(e.name))})))})),this.widget.addEvent("endEdit",(function(e){require(["DS/FolderEditor/Folder_CSO"],(e=>{e._manageOpenWith(!0)})),!(!e||!e.submitted&&!e.needRefresh)&&o&&(t.widget.changeInPreference={},Object.keys(o).forEach((function(e){i[e]=t.widget.getValue(e),o[e]!==i[e]&&(t.widget.changeInPreference[e]=i[e])})),UWA.log(t.widget.changeInPreference),t.widget.refreshDuetoChangeInPreference=!0,o=null)}))},onRefresh:function(e){require("DS/IPClassifyUtil/PlatformAPIWrapper").publish("DS/ENO/refresh",e)},setCtxMenu:function(e,t,o){require(["DS/FolderEditor/commands/FolderCommands"],(function(o){o&&o.showWebInWinCtxMenu(e,t)}))},insertSelectedSearchObjs:function(e){var t=e[0].split(",");require(["DS/FolderEditor/service/BkOperationsUtils"],(function(e){!async function(){try{await e.processAddOperation(t)}catch(e){console.error("Error trying to execute command","ActiveFolder",e)}}()}))},onWebInWinFilterChange:function(e){require(["DS/FolderEditor/tagger/TaggerContentProxy"],(function(t){e.proxyId===t.getProxy().getProxyId()&&(["addFilterChangeListener","addCriteriaChangeListener"].indexOf(e.event_id)>=0?t.onFilterBIFilteringEvent(e.data):"colorize"==e.event_id?t.filterBIColorize(e.data):"unColorize"==e.event_id&&t.onFilterBIUnColorize(e.data))}))},onClearSelection:function(){},onDestroy:function(){this.folderTree_Cont&&this.folderTree_Cont.destroy(),this.folderIdCard_Cont&&this.folderIdCard_Cont.destroy(),this.folderComponent&&this.folderComponent.destroy();let e=require("DS/IPClassifyUtil/IPClassifyModelEvents");o.forEach((t=>{e.unsubscribe(t)})),o=[]},onFocus:async function(){widget._isFocus=!widget._isFocus;let[e]=await loadModules("DS/IPClassifyUtil/IPClassifyModelEvents");!1!==widget._isFocus&&void 0!==widget._isFocus||e.publish({event:"activate_tree_filter",data:!1})},onResize:function(){var e=this;setTimeout((function(){e.folderGlobal_div&&e.folderIdCard_Cont&&0!==e.folderGlobal_div.clientWidth&&e.folderIdCard_Cont.updateDisplayPath()}),500),require(["DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyModelEvents"],(function(e,t){widget._isFocus||e.isWidgetMaximized()||t.publish({event:"activate_tree_filter",data:!1})}))},setSupportedTenant:function(){return new Promise(((e,t)=>{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(o=>{o.getAppInfo({appId:widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):window.IPConfig.defaultAppId,onComplete:function(t){t.platforms.length>0&&widget.setValue("x3dPlatformId",t.platforms[0].id),e()},onFailure:t})}))}))},expandToBookmarkExternally:function(e){if(this.folderTree_Cont){require("DS/FolderEditor/Folder_CSO").dispatchBookmarkIdSelection(e.ids[0]),this.folderTree_Cont.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:e.ids},partiallyExpandPath:e.isToBeExpandedPartially,onComplete:function(){dscef&&dscef.sendString('{"operation":"expand successful"}')},onFailure:async function(e){dscef&&dscef.sendString('{"operation":"expand failed"}');let[t]=await loadModules("DS/IPClassifyUtil/IPClassifyAlert");t.displayNotification({message:e instanceof Error?e.message:e,className:"error"})}})}},onLoad:async function(){document.addEventListener("dragenter",blockDefault),document.addEventListener("dragover",blockDefault),document.addEventListener("drop",blockDefault),require(["DS/IPClassifyUtil/IPClassifyUtility"],(function(e){e.setPCSEntry(widget.id+"_FolderWidgetLoad",!0)}));let[e]=await loadModules("DS/IPClassifyUtil/IPSettingsMgr");var t=e.isWebInWin();if(t)widget.folderToOpen&&widget.nativeAuthMode&&"true"===widget.nativeAuthMode&&require(["DS/FolderEditor/views/FolderMode"],(e=>{e.switchtoAuthoringMode()}));else{require(["DS/MSFDocumentManagement/WidgetIntegration"],(function(e){widget.MSFDocumentClient=e,widget.MSFDocumentClient.ConnectWidgetWithMSF()}))}require(["DS/FolderEditor/Folder_CSO"],(e=>{e._assignTenantFromX3DContentId();var o=widget.getValue("x3dPlatformId"),i=Promise.resolve();o||t||(i=this.setSupportedTenant()),i.then(this._preLoad.bind(this))}));let o=new Promise((e=>{(window.hasOwnProperty("dsDashboardWindow")&&window!==dsDashboardWindow.top&&window.top.require?window.top.require:window.require)(["DS/Dashboard/WidgetLinkManager"],e)})),i=new Promise((e=>{require(["DS/RouteWebAppUX/Utilities/RouteLinkWidget"],e)}));Promise.all([i,o]).then((e=>{let t=e[0];let o=this._widgetLink=t.init(widget,{appIds:["ENXROUT_AP","ENOPRGA_AP"],open:!0});t.subscribeForRouteEvents(widget),require(["DS/FolderEditor/utils/FolderEditorWidgetLinkMngt"],(e=>{e.bindForLinkAndContextChange(o)}))}))},_preLoad:function(){var e=this;this.probeHeader=this.widget.id+"_"+this.widget.getTitle()+"_",window.performance.mark("onLoad_begin"),window.performance.measure(this.probeHeader+"createToOnLoad","createWidget_begin","onLoad_begin");var t=!0;if(preferenceIsNotSet("vMigration")&&preferenceIsNotSet("pad_security_ctx"))widget.setValue("vMigration",7);else{var o=widget.getValue("vMigration");(o=o||0)<7&&(t=!1,console.log("Bookmark migration needed"),require(["DS/FolderMigration/FolderMigration"],(function(t){t.migrate(7).then((function(){widget.migrated=!0,e._onLoad()}))})))}t&&e._onLoad()},_onLoad:async function(){var e=this;let[i]=await loadModules("DS/IPClassifyUtil/IPSettingsMgr");var n=i.isWebInWin();this.promiseInit=new Promise((function(t){n?require(["DS/FolderEditor/utils/FolderEditorEvents"],(function(e){e.onFolderEditorReadyforWenInWin((function(){t()}))})):e.widget.addEvent("onFolderEditorReady",(function(){t()}))}));let r=(async()=>{let[e,o,i]=await loadModules("DS/IPClassifyUXUtil/CredentialsView","DS/FolderEditor/utils/FolderEditorControl","i18n!DS/FolderEditor/assets/nls/FolderEditor");await e.initializeTenant();let n=buildSettingsPromise(),r=buildServicePromise();["pad_security_ctx","x3dPlatformId","cred_project","cred_org"].forEach((e=>{widget.addPreference({name:e,type:"hidden"})}));let s={};s.widgetCBOnPopup=o.onTenantSecurityCTXPopup,s.withWarningDialog=!0,s.withPreferred=!0;let l=null;try{l=await e.render(s)}catch(e){console.log(e)}if(!l)throw"No credentials available";await r,await n,await t,t.then((()=>{require(["DS/FolderEditor/plugins/PluginsManager","DS/FolderEditor/utils/ServerDataAccess"],(function(e,t){let o=new Set;e.getTypesToLoad(o),o&&o.size>0&&t.getSubTypes(o,!0)}))}))})();require(["DS/FolderEditor/utils/SettingsHandler","DS/PADServices/utils/PlatformURL","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/IPClassifyUtil/IPServicesMgr","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt"],(function(t,i,n,s,l){let a=s.getUserLogin()?Promise.resolve():n.getConnectedUserInfo(),d=i.retrievePlatformUrl();var c=[],u=new Promise((function(e){require(getRequires(),(function(){e(arguments)}))}));if(c.push(u),!0!==e.reInitialize){let e=new Promise(((e,o)=>{require([t.getColumnsDefinition()],(t=>{let o=JSON.parse(t),{MP_SELECTED_TYPES:i,MP_SELECTED_EXTS:n,MP_SELECTED_COLS:r,attributesParams:s}=o;l.addAttributesParams(s),l.setDefaultView({MP_SELECTED_TYPES:i,MP_SELECTED_EXTS:n,MP_SELECTED_COLS:r}),e()}))}));c.push(e)}c.push(d),c.push(r),c.push(a),Promise.all(c).then((function(t){initBookmark.apply(e,[{_subscriptionTokens:o},...t[0]])})).catch((e=>{console.log(e)}))}))},_slidderMoveEndCallback:function(){this.folderIdCard_Cont&&this.folderIdCard_Cont.updateDisplayPath()},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){var e=new UWA.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});e.inject(widget.body);var t=require("DS/Windows/ImmersiveFrame"),o=require("DS/WebUAUtils/WebUAUtils"),i=require("DS/WidgetServices/WidgetServices"),n=new t;n.inject(e),this.widget.immersiveFrame=n,"false"!==i.getUrlParameter("UAPanel")&&o.setPanelHelpMode({immersiveFrame:n}),this.widget.body.container=UWA.createElement("div",{class:"FolderEditor_global_container"}).inject(n.getFreeZone(),"top"),this.widget.body.globalLoaderContainer=UWA.createElement("div",{class:"FolderEditor_global_loader"}).inject(this.widget.body.container),this.widget.body.left_side_div=UWA.createElement("div",{class:"FolderEditor_left_side_div"}).inject(this.widget.body.container),this.widget.body.right_side_div=UWA.createElement("div",{class:"FolderEditor_right_side_div"}).inject(this.widget.body.container),this.widget.body.top_right_side_div=UWA.createElement("div",{class:"FolderEditor_top_right_side_div"}).inject(this.widget.body.right_side_div),this.widget.body.bottom_right_side_div=UWA.createElement("div",{class:"FolderEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div)}},convertToBool:function(e){return"true"===e.toLowerCase()},_initializeFolderEditorComponent:function(e){var t=this,o=require("DS/FolderEditor/FolderTreeCont"),i=require("DS/FolderEditor/utils/FolderEditorControl"),n=require("DS/FolderEditor/FolderComponent"),r=require("DS/FolderEditor/utils/FolderEditorKeyboardListener"),s=(require("DS/LifecycleServices/LifecycleServicesSettings"),require("DS/IPClassifyUtil/IPClassifyUtility")),l=require("DS/FolderEditor/utils/SettingsHandler");let a=require("DS/IPClassifyUXUtil/IPClassifyLoaderGlobal");l.isTreeViewVisible()?t.folderTree_Cont||(t.folderTree_Cont=new o({lang:t.widget.lang?t.widget.lang:t.widget.getValue("lang"),css_view_class:t.css_view_class,events:{onReady:function(){i.setTreeCont(this),t.folderTree_Cont=this,notifyWidgetReady()}}})):notifyWidgetReady();var d=t._retrieveinitializationOpts({actionBarReadyPromise:e.actionBarReadyPromise}),c=UWA.extend(e,d);c.multiselection=!1!==this.widget.multiselection,function(){let e=[];l.getComputedColumns().forEach((t=>{e.push(new Promise((function(e){require([t],(function(t){t?t.isAdditionalColumnsAvailable((function(o){!0===o?e(t):e()})):e()}))})))})),Promise.all(e).then((function(e){let o=[];var i;e.forEach((e=>{e&&o.push(e)})),(i=o).length&&(c.additionalColumnsModules=i),t.folderComponent=new n(c,t.folderTree_Cont)}))}(),t.promiseInit.then((()=>{if(a.removeComponentToLoad("global","widget"),t.folderTree_Cont){t.folderTree_Cont._doScrolltotheSavedPosition(),s.setPCSEntry(widget.id+"_FolderWidgetLoad",!1),s.sendPCSTracketPageEvent("FolderWidget_Performance","FolderWidgetLoad",widget.id+"_FolderWidgetLoad");var e=window.performance.getEntriesByName("createWidget_begin");e&&e.length>0&&(window.performance.mark("createWidget_end"),window.performance.measure(t.probeHeader+"createWidget","createWidget_begin","createWidget_end"))}})),r.startObservingKeyboard()},_retrieveinitializationOpts:function({actionBarReadyPromise:e}){var t=this,o=require("DS/FolderEditor/FolderIdCardCont");return{renderTo:t.folderContent_div,events:{onActionBarReadyToBuild:function(){t.elements=this.elements,t.options=this.options,t.togglePanel=this.togglePanel,null===t.folderIdCard_Cont&&new o({lang:t.widget.lang?t.widget.lang:t.widget.getValue("lang"),css_view_class:t.css_view_class,events:{onReady:function(){t.folderIdCard_Cont=this,t.folderIdCard_Cont.render().inject(t.folderIdCard_div)}}}),e()},onReady:function(){t.folderContent_Cont=this,t.addEvent=t.folderContent_Cont.addEvent.bind(t.folderContent_Cont),t.folderContent_Cont.options.renderTo&&t.folderContent_Cont.render().inject(t.folderContent_Cont.options.renderTo),t.promiseInit.then((function(){t.folderContent_Cont._OnPADComponentReady(),loadModules("DS/FolderEditor/utils/FolderEditorUtil","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt").then((async([e,t,o])=>{const i=o.getViewMode();i&&t.publish({event:"update_view_mode",data:{viewMode:i||"comfortable"}})})),t.widget.dispatchEvent("onFolderComponentReady"),"undefined"!=typeof dscef&&dscef.sendString("BookmarkEditorReady")})),require(["DS/IPClassifyUtil/IPClassifyCommunication","DS/IPClassifyUtil/IPSettingsMgr"],(function(e,o){if(o.isWebInWin()){var i;const o=function(o){clearTimeout(i),i=setTimeout((function(){var o=t.folderContent_Cont.getPADTreeDocument().getXSO().get(),i=[];o.forEach((function(e){i.push(e.getID())})),e.publish("onObjectSelected",i);var n=[];o.forEach((function(e){var t={id:e.getID(),label:e.getLabel(),type:e.options.type,cadMaster:e.options.grid["ds6w:cadMaster"],kind:e.options.grid["ds6w:kind"],contentStructure:e.options.grid["ds6w:contentStructure"]};n.push(t)})),e.publish("selectedObjectsInContent",n)}),o)};t.folderContent_Cont.getPADTreeDocument().getXSO().onChange((function(){o(20)}))}}))},onToggleView:function(){require("DS/FolderEditor/ActionBar/FolderCommandManager").updateCommands()}}}}};return i.init(e),i}define("DS/FolderEditor/views/xBookInitError",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],(function(e,t,o){"use strict";return t.extend(o,{init:function(e){this._parent(e),this.elements.container=UWA.createElement("div",{class:"pad_error_all"}),this.elements.errormsg=UWA.createElement("span",{class:"pad_error_msg"}),this.elements.errormsg.innerHTML=e.msg,this.elements.errormsg.inject(this.elements.container)},render:function(){return this}})})),define("DS/FolderEditor/commands/ActionBar_SelectAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPContext","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i){"use strict";return t.extend({labelTopBar:i.ActionBar_SelectAllCmd,isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){let e=this.options.context;var t=e.options.model?e.options.model:e.getPADTreeDocument(),o=t.getRoots();if(o.length){t.prepareBroadcastSelect(),t.prepareUpdate(),t._selected_paths=[];var i=[];o.forEach((function(e){e.select(),e.processDescendants({processNode:function(){this.isVisible()&&i.push(this)}})})),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()}},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_SelectSiblingCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPContext","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i){"use strict";return t.extend({labelTopBar:i.ActionBar_SelectSiblingCmd,isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){let e=this.options.context;var t=e.options.model?e.options.model:e.getPADTreeDocument(),o=t.getSelectedNodes();t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var i=[],n=[];o.forEach((function(e){var t=e.getParent(),o=JSON.stringify(e.getOccurencePath());i.push(o),t.getChildren().forEach((function(e){var t=JSON.stringify(e.getOccurencePath());-1===i.indexOf(t)&&o!==t&&(n.push(e),i.push(t))}))})),t.multiselect(n),t.pushUpdate(),t.pushBroadcastSelect()},endExecute:function(){}})})),define("DS/FolderEditor/commands/tools/ImportCSVFilesUtils",["UWA/Core"],(function(e){"use strict";return{formatBytes:function(e,t){if(0===e)return"0 Byte";var o=t+1||3,i=Math.floor(Math.log(e)/Math.log(1e3));return(e/Math.pow(1e3,i)).toPrecision(o)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]},getStringByte4UTF8:function(e){for(var t=[0,1,1,1,2,3,2,3,4,3],o=0,i=0;i<e.length;i++)o+=t[encodeURIComponent(e.charAt(i)).length];return o},Sanitize:{encode:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}},removeControllCode:function(e){return e.replace(/[\t\r\n]/g,"")},escapeControllCode:function(e){return e.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}}})),define("DS/FolderEditor/utils/QueriesManager",["DS/IPClassifyUXUtil/utils/CancellablePromise"],(e=>class{constructor({maxThreadNumber:e,datas:t,fcn:o}){this._answers=null,this._globalPromise=null,this._resolveCallback=null,this._rejectCallback=null,this._maxThreadNumber=e,this._callback=o,this._queue=t,this._inProgress=[],this._failed=!1,this._answers=[]}_next(){if(this._inProgress.length<this._maxThreadNumber&&this._queue.length>0&&!0!==this._globalPromise.isCancelled){let e=this._queue.shift(),t=this._callback(e);this._inProgress.push(t),t.then((e=>{this._answers.push(e),this._failed||this._next()})).catch((e=>{this._failed=!0,console.log(e),this._rejectCallback(e)})).finally((()=>{this._inProgress.splice(this._inProgress.indexOf(t),1),0===this._inProgress.length&&0===this._queue.length&&this._resolveCallback(this._answers)}))}}execute(){return this._globalPromise||(this._globalPromise=new e(((e,t)=>{this._resolveCallback=e,this._rejectCallback=t})),this._globalPromise.onCancel((()=>{this._resolveCallback()})),0===this._queue.length?this._resolveCallback([]):setTimeout((()=>{this._next()}))),this._globalPromise}})),define("DS/FolderEditor/commands/ActionBar_SelectInversionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPContext","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i){"use strict";function n(e,t,{tounselect:o,selection:i}){e&&e.forEach((e=>{i.has(e)||(o.has(e)||t.push(e),n(e.getChildren(),t,{tounselect:o,selection:i}))}))}return t.extend({labelTopBar:i.ActionBar_SelectInversionCmd,isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){let e=this.options.context,t=e.options.model?e.options.model:e.getPADTreeDocument(),o=new Set,i=new Set;t.getSelectedNodes().forEach((e=>{e.getParents().forEach((e=>{o.add(e)})),e.getAllDescendants().forEach((e=>{o.add(e)})),o.add(e),i.add(e)})),t.getChildren().forEach((e=>{o.add(e)}));let r=[];n(t.getChildren(),r,{tounselect:o,selection:i}),t.withTransactionUpdate((()=>{t.multiunselect([...o]),t.multiselect(r)})),t.pushBroadcastSelect()},endExecute:function(){}})})),define("DS/FolderEditor/commands/tools/_xBookExport",[],(function(){"use strict";return{execute:function(e){require(["DS/FolderEditor/commands/tools/xBookExporter","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/IPClassifyUtil/IPClassifyModelEvents","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPSettingsMgr","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(t,o,i,n,r,s){switch(e.command_id){case"Print":var l=e.xnav_app.getPADTreeListView().getManager(),a=n.isWebInWinEnvironment()||r.isWebInWin();l.openPrintableViewWindow(a);break;case"ExportCSV":l=e.xnav_app.getPADTreeListView().getManager();var d=o.updateNLSforexport(e.xnav_app.getPADTreeDocument());let i=e.xnav_app.getContentView().handleUpdateColumnsInChunks();Promise.all([d,i]).then((()=>{t.generateCsv({context:e.xnav_app,csv_base_file_name:s.csv_base_file_name})})).catch((e=>{console.error(e)}))}setTimeout((function(){e.cmd&&e.cmd.enable()}),500)}))}}})),define("DS/FolderEditor/popup/RemoveFromFavoritesPopup",["UWA/Controls/Abstract","DS/Controls/Button","DS/Windows/Dialog","DS/WidgetServices/WidgetServices","i18n!DS/FolderEditor/assets/nls/RemoveFromFavoritesPopup"],(function(e,t,o,i,n){return e.extend({init:function(e){this._parent(e),this.buildSkeleton(e)},buildSkeleton:function(e){var r=e.favorite.options.favoriteTitle,s=UWA.createElement("div",{class:"removeFromFav-commonContent",styles:{display:"flex","flex-direction":"row"}}),l=UWA.createElement("div",{class:"removeFromFav-warning",styles:{height:"100%","padding-right":"10px"}});i.get3DSpaceUrlAsync({onComplete:function(e){var t=e+"/webapps/FolderEditor/assets/images/warning.png";l.innerHTML='<img src="'+t+'"></img>'}}),l.inject(s);var a=UWA.createElement("div",{class:"removeFromFav-Label"});a.inject(s),UWA.createElement("p",{class:"removeFromFav-paragraph-title",text:n.replace(n.title,{favname:r}),styles:{"font-weight":"bold"}}).inject(a),UWA.createElement("p",{class:"removeFromFav-paragraph",text:n.subtitle}).inject(a),UWA.createElement("p",{class:"removeFromFav-paragraph",text:n.replace(n.question,{favname:r})}).inject(a);var d=n.replace(n.popuptitle,{favname:r}),c=new o({immersiveFrame:widget.immersiveFrame,title:d,content:s,activeFlag:!1,modalFlag:!0,resizableFlag:!0,width:400,buttons:{Ok:new t({label:n.buttonRemove,onClick:function(t){t.preventDefault(),t.stopPropagation(),e.callback(!0),c.destroy()}}),Cancel:new t({onClick:function(){e.callback(!1),c.destroy()}})}});c.getContent().addClassName("bookmark_removeFromFavPopUp"),c.addEventListener("close",(function(t){e.callback("none"),c.destroy()}))}})})),define("DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization",["UWA/Core","UWA/Class","DS/FolderEditorOpenness/FolderEditorOpenness","DS/IPClassifyUtil/IPSettingsMgr","DS/Logger/Logger"],(function(e,t,o,i,n){"use strict";var r=n.getLogger("DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization");return t.singleton({name:"FolderEditorManageSecurityContextCustomization",init:function(e){this._parent(e),this._isSecurityContextComputedByOpening=o.useComputedSecurityContext()},adaptSecurityContextToCurrentFolder:function(e){if(e&&this._isSecurityContextComputedByOpening){var t,n=[],s=widget.getPreference("pad_security_ctx");if(s){var l=s.options;Array.isArray(l)?l.forEach((function(e){e.value&&n.push(e.value)})):r.warn("The widget has no options for pad_security_ctx preference")}else r.warn("The widget has no pad_security_ctx preference");if(n.length>0)try{t=o.computeSecurityContext(e,n)}catch(e){r.warn("FolderEditorOpenness throws exception",e)}t&&-1!==n.indexOf(t)?(widget.setValue("pad_security_ctx",t),i.setSetting("pad_security_ctx",t)):r.warn('SecurityContext "'+t+'" returned by FolderEditorOpenness is not valid')}}})})),define("DS/FolderEditor/views/additionalColumns/FavoriteTitleColumn",["UWA/Core","UWA/Class","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(e){var t={filterId:"string",text:o.column_FavoriteTitle,icon:{iconName:"favorite-on",fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:"favoriteTitle",typeRepresentation:"string",editableFlag:!0,alignment:"left",sortableFlag:!0,editionPolicy:"DelayedEditionOnClick",customisation:{dataIndex:"favoriteTitle",exportable:{lock:!0,value:!1},layout:{removable:!1}},getCellValueForExport:function(e){return-1===e.rowID?o.ViewTooltip.favoriteTitle:e.cellModel}};this._columnDataIndex=["favoriteTitle"],this._columnDef={favoriteTitle:t},e(!0)},getName:function(){return"favoriteTitle"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e){return void 0===e.favoriteTitle},updateAttributes:function(e,t){},getAdditionalColumnsUXDGV:function(t){var o=this._columnDataIndex[0],i=e.clone(this._columnDef[o]),n=!1;t.every(((r,s)=>((n=r.dataIndex===o)&&(t[s]=e.extend(t[s],i,!0)),!n))),n||t.push(i)}})})),define("DS/FolderEditor/commands/ActionBar_AddFileCmd",["UWA/Core","UWA/Controls/Input","DS/ApplicationFrame/Command"],(function(e,t,o){"use strict";return o.extend({labelTopBar:e.i18n("Add New Document"),isInsert:!0,input_file:null,datas:{},init:function(e){this._parent(e,{isAsynchronous:!1,isEnabled:!0})},beginExecute:function(){},execute:function(){require("DS/FolderEditor/commands/FolderCommands").uploadFileCmd()},endExecute:function(){},clearInput:function(){this.input_file&&(this.input_file.destroy(),this.input_file=null)}})})),define("DS/FolderEditor/popup/BookmarkConfirmationWthCheckBx",["UWA/Class","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/Windows/Dialog","DS/Controls/Button","DS/Form/Form","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r,s){function l(e,t){return e.getModelItem(t)?e.getModelItem(t).value:void 0}let a;function d(e){return e.find((e=>{let t=!0===e.requiredFlag&&void 0===e.value,o=t?e:null;return!t&&e.children&&(o=d(e.children)),o}))}function c(e){return!d(e.getModelItem())}function u(e,t){t.disabled=!c(e)}return e.singleton({launch:async function(e,{title:d,infoTitle:c,headerMessage:p,fields:h,noFields:g,userChoices:f,detailsMessage:m}){let v,_,S;f.indexOf("withCopy")>-1&&(o.addComponentsToLoad("global",{loadCred:null}),v=t.getCredentialFormFields({creationType:e,defaultSC:a}),v.finally((()=>{o.removeComponentToLoad("global","loadCred")})),_=await v,S=_.fields?_.fields:null);let C=d,y=null,b=null,E=[],D=null,w=[];if(f.indexOf("withShortcut")>-1&&w.push({label:s.Paste_as_Shortcut,value:"shortcut"}),S&&(w.length>=1?w.unshift({label:s.Paste_as_Duplicate,value:"copy"}):w.push({label:s.Paste_as_Duplicate,value:"copy"})),f.indexOf("withBookmark")>-1&&w.push({label:s.Paste_to_Bookmark,value:"bookmark"}),f.indexOf("withMove")>-1&&w.push({label:s.Paste_to_move,value:"move"}),0===w.length)return Promise.reject(s.msg_error_createNew);let I=function(e){let t=e.value,o="copy"===t;b.updateModelItem("sectionCopy",{visibleFlag:o}),b.updateModelItem("headerMessage",{visibleFlag:o}),D&&(o?D.show():D.hide());let i=m?m[t]:"";b.updateModelItem("sectionMessage",{visibleFlag:!!i,value:i})},F={dupOrShortcut:{id:"dupOrShortcut",typeRepresentation:"stringChoice",context:"stdTemplate",value:w[0].value,semantics:{possibleValues:w},onNodeUpdate:I,onNodeLiveUpdate:I},prefix:{id:"prefix",label:s.PrefixLine,typeRepresentation:"string",semantics:{placeholder:s.prefixPlaceholder,allowResetToUndefinedByUIFlag:!0,viewOptions:{maxLength:20}},moreInformation:{title:s.PrefixLine,...s.helpPrefix},value:""},suffix:{id:"suffix",label:s.SuffixLine,typeRepresentation:"string",semantics:{placeholder:s.suffixPlaceholder,allowResetToUndefinedByUIFlag:!0,viewOptions:{maxLength:20}},moreInformation:{title:s.SuffixLine,...s.helpSuffix},value:""},multipleChoice:{id:"multipleChoice",typeRepresentation:"stringChoice",context:"stdTemplate",value:["withItems"],semantics:{allowMultipleValuesFlag:!0,possibleValues:[{label:s.confirmation_copyMassive_checkBox,value:"withItems"}]}}},T=["prefix","suffix","multipleChoice"],x=(!h||h.indexOf("dupOrShortcut")>=0)&&(!g||g.indexOf("dupOrShortcut")<0);if(x&&E.push(F.dupOrShortcut),S&&f.indexOf("withCopy")>-1){let e=[...S];T.forEach((t=>{(!h||h.indexOf(t)>=0)&&e.push(F[t])})),x?(y={id:"sectionCopy",label:s.CopySettings,style:"default",children:e},E.push(y)):e.forEach((e=>E.push(e)))}if(p&&E.unshift({id:"headerMessage",typeRepresentation:"string",value:p,readOnly:!0,visibleFlag:"copy"===w[0].value}),m){let e=m[w[0].value];E.unshift({id:"sectionMessage",typeRepresentation:"string",value:e||"",readOnly:!0,visibleFlag:!!e})}return await new Promise(((e,t)=>{let o=null,d=new n({label:s.confirmation_ok_Paste,disabled:!0,onClick:function(t){let i;b.getModelItem("prj")&&b.getModelItem("org")&&(i=_.credentials.find((e=>e.prjname===b.getModelItem("prj").value&&e.orgname===b.getModelItem("org").value)),i&&(a=i.ctxname)),e({isCopy:"copy"===l(b,"dupOrShortcut"),isShortcut:"shortcut"===l(b,"dupOrShortcut"),isMove:"move"===l(b,"dupOrShortcut"),isBookmark:"bookmark"===l(b,"dupOrShortcut"),suffix:l(b,"suffix"),prefix:l(b,"prefix"),keepItems:!l(b,"multipleChoice")||l(b,"multipleChoice").indexOf("withItems")>=0,credential:i?i.ctxname:null}),o.destroy()}});if(0===E.length)t(s.msg_error_createNew);else{b=new r({_identifier:"pasteForm",usePaddingFlag:!0,model:E,onModelUpdate:function(){u(this,d)}});let e=widget.immersiveFrame;c&&S&&(D=UWA.createElement("span",{title:c,class:"InfoPanel fonticon fonticon-info"}).inject(b.getContent())),u(b,d);let t=50*E.reduce(((e,t)=>{e=e+1+(t.children?t.children.length:0)}),0);o=new i({immersiveFrame:e,title:C,content:b,width:500,height:t,resizableFlag:!0,modalFlag:!0,events:{onClose:function(e){this.destroy()}},buttons:{Ok:d,Cancel:new n({label:s.confirmation_cancel,onClick:function(e){o.destroy()}})}}),o.getContent().addClassName("selectPasteORShortcut")}}))}})})),define("DS/FolderEditor/commands/FolderActionBarCmds",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/IPClassifyUtil/IPContext","DS/IPClassifyUtil/IPServicesMgr","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/IPClassifyUtil/IPClassifyModelEvents"],(function(e,t,o,i,n,r){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){let e=this.options.context,t=e.options.model?e.options.model:e.getPADTreeDocument();switch(this.options.ID){case"treelistview":case"graphview":case"tileview":case"thumbnailview":case"datagridview":e.toggleView(this.options.ID);break;case"Print":case"PrintOptions":case"ExportCSV":case"ExportCSVOptions":if("Print"===this.options.ID&&i.printWindowOpen())return;this.disable(),require(["DS/FolderEditor/commands/tools/_xBookExport"],(o=>{o.execute({command_id:this.options.ID,cmd:this,xnav_app:e,model:t})}));break;case"ColumnVisibility":n.getCmdCheckHeaderByContext("ActionBar_FindInCtxCmd")&&r.publish({event:"close_findInCtx_panel"}),require(["DS/FolderEditor/commands/tools/ColumnCustomization"],(t=>{var o=e.options.views?e.options.views.datagridview:void 0;t.execute({context:this.options.context,command_id:this.options.ID,cmd:this,xnav_app:e,dgv:o})}))}}})})),define("DS/FolderEditor/utils/SettingsHandler",[],(()=>{let e=[],t={},o=new Set,i=new Set,n=new Set,r={},s={},l={},a=null,d=new Promise((e=>{a=e})),c=null;function u(e,t){let s=new Set;return e.forEach((e=>{1===t&&i.add(e),2===t&&n.add(e),s.add(e),o.add(e),r[e]=e,this._widgetSettings.types[e].forEach((l=>{1===t&&i.add(l),2===t&&n.add(l),s.add(l),o.add(l),r[l]=e}))})),s}return{_widgetSettings:null,_init:function(){for(let e in this._widgetSettings.sections){let t=this._widgetSettings.sections[e];t._roots=t.roots?u.call(this,t.roots,1):new Set;let i=t.expandDef,n=null;i&&(n=this._widgetSettings.expandDef[i]),t._subs=n?u.call(this,n.sub.types,2):new Set,t.accept&&(t._accept=u.call(this,t.accept,0)),t.type&&o.add(t.type)}},initialize:async function(){let e=null,t=null;if(window.IPConfig.filesToPrepare){let t=[],o=[];for(let e in window.IPConfig.filesToPrepare)t.push(window.IPConfig.filesToPrepare[e]),o.push(e);e=new Promise((e=>{require(t,(function(){for(let e=0;e<arguments.length;e++)l[o[e]]=arguments[e];e()}))}))}return window.IPConfig.widgetNls&&(t=new Promise(((e,t)=>{require([window.IPConfig.widgetNls],(function(t){e(t)}),(function(){t()}))}))),c=new Promise((o=>{require(["DS/FolderEditor/service/FolderEditorWebService","text!DS/FolderEditor/assets/FolderEditorConf.json"],((i,n)=>{s=JSON.parse(n),i.getWidgetSettings().then((i=>{this._widgetSettings=i,this._init(),e.then(o),t&&t.then((e=>{l.widgetNls=e})).catch((e=>{console.error("Module loading failed : widgetNls")}))})).catch((e=>{console.log(e)}))}))})),c.then(a),c},getIconType:function(){return window.IPConfig.iconType?window.IPConfig.iconType:"font"},getHelpLocation:function(){return window.IPConfig.helpFile?window.IPConfig.helpFile:"FolderEditor/help"},getConfigSetting:function(e){return s.settings[e]&&s.settings[e].value},getLoadedFile:function(e){return l[e]},getWidgetNls:function(e){let t=this.getLoadedFile("widgetNls");return t?t[e]:void 0},parseMe:function(e,t){let o=e;try{o="string"==typeof e?JSON.parse(e):e}catch(e){t&&!0===t.noLogs||console.log(e)}return o},getPrefPrefix:function(){return window.IPConfig.preferencePrefix?window.IPConfig.preferencePrefix:"Folder"},getSettingParameter:function(e){return window.IPConfig.parameters&&window.IPConfig.parameters[e]},getColumnsDefinition:function(){return"text!"+window.IPConfig.columnDefinition},getToolbarCmds:function(){return window.IPConfig.toolbarCmds},getPreferenceOrder:function(){return window.IPConfig.preferences},getLayoutPreference:function(e){return window.IPConfig.layout&&window.IPConfig.layout[e]},getUserAppId:function(){return window.IPConfig.userAppId},getDefaultAppId:function(){return window.IPConfig.defaultAppId},getRepository:function(){return window.IPConfig.mepreferenceRepositoryName},isTreeViewVisible:function(){return!1!==this.getLayoutPreference("treeView")},waitReady:async function(){return d},getDefinedSections:function(){return window.IPConfig?window.IPConfig.sections.map((e=>e.name)):[]},isDefinedSection:function(e){return window.IPConfig.sections.find((t=>t.name===e))},getComputedColumns:function(){return window.IPConfig.computedColumns},getSections:function(o){if(0===e.length){let o=null==window.activatePersonalBookmark||window.activatePersonalBookmark;window.IPConfig.sections.forEach(((i,n)=>{let r=this._widgetSettings.sections[i.name];if(r&&("Personal"!==i.name||o&&!0===this._widgetSettings.personal)){let o={...r,...i};e.push(o),t[o.name]=o}}))}return o?t:e},isHardSection:function(e){let t=this.getSection(e);return t&&!t.type},isSection:function(e){return!!this.getSection(e)},getSection:function(e){return this.getSections(!0)[e]},getRoots:function(e){let t=this.getSection(e);return t.roots||(t.type?[t.type]:null)},getSubElementTypes:function(e){let t=this.getExpandDefinition(e);return t.sub._types||(t.sub._types=[],t.sub.types&&t.sub.types.forEach((e=>{t.sub._types.push(e),this.getDerivatives(e).forEach((e=>{t.sub._types.push(e)}))}))),t.sub._types},getSubElementRelations:function(e){return this.getExpandDefinition(e).sub.rels},getAllExpandRelations:function(e){let t=this.getExpandDefinition(e),o=t.content.rels?t.content.rels:[];return t.content.relsV2&&t.content.relsV2.forEach((e=>{e.forEach((e=>o.push(e)))})),o},getExpandRelations:function(e){return this.getExpandDefinition(e).content.rels},getExpandRelationsV2:function(e){return this.getExpandDefinition(e).content.relsV2},getSearchRelations:function(e){return this.getExpandDefinition(e).content.search},getDefaultTypeSection:function(e){let t=e;return e&&(t=r[e]),window.IPConfig.main[t]},getDefaultSection:function(e){let t=this.getDefaultTypeSection(e);if(e&&!t){let o=this.getSections(!0);for(let i in o)o[i].type===e&&(t=i)}return t||window.IPConfig.default},isSearchSupported:function(e){let t=this.getExpandDefinition(e);return t&&t.content&&t.content.search},isTreeSection:function(e){let t=this.getSection(e);return t&&(!!t.roots||!!t.type)},isRootSection:function(e){let t="string"==typeof e?this.getSection(e):e?e.sectionElement:null;return t&&!!t.roots},isFavoriteSection:function(e){let t=this.getSection(e);return t&&!!t.favorite},isRootElement:function(e,t){let o=!1;if(t){let i=t?this.getSection(t):null;o=i&&(!!i._roots&&i._roots.has(e)||!!i._accept&&i._accept.has(e)||i.type===e)}else o=i.has(e);return o},isSubElement:function(e,t){let o=!1;if(t){let i=this.getSection(t);o=i&&!!i._subs&&i._subs.has(e)}else o=n.has(e);return o},isTypeAccepted:function(e,t){let o=this.getSection(t);return o&&!!o._accept&&o._accept.has(e)},isExternalObject:function(e){let t="string"==typeof e;return(t?e:e.getID()).startsWith("cid:")||!t&&(!!e.getAttributeValue("links")||!!e.getAttributeValue("serviceId")&&"3DSpace"!==e.getAttributeValue("serviceId"))},getExpandDefinition:function(e){let t=this._widgetSettings.sections[e],o=t&&t.expandDef,i=null;return o&&(i=this._widgetSettings.expandDef[o]),i},isExternalObjectSupported:function(e,{type:t}={}){!e&&t&&(e=this.getDefaultSection(t));let o=this.getExpandDefinition(e);return o&&o.content&&!!o.content.links},getTreeTypes:function(e){let t=this.getSection(e);return[...t._roots,...t._subs]},getOOTBTreeTypes:function(e){return[...this.getRoots(e),...this.getSubElementTypes(e)]},isTreeType:function(e,t){let i=!1;if(t){let o=this.getSection(t);i=o.type===e||!!o._roots&&o._roots.has(e)||!!o._subs&&o._subs.has(e)||!!o._accept&&o._accept.has(e)}else i=o.has(e);return i},getDerivatives:function(e){return this._widgetSettings.types[e]},getSectionRootNls:function(e){let t=this.getSection(e),o=!!t.roots&&t.roots[0];return this.getTreeTypeNls(o)},getSectionSubNls:function(e,t){let o=this.getSection(e),i=!!o.sub&&o.sub.types[0];return this.getTreeTypeNls(i,t)},getOOTBType:function(e){let t=r[e];return t||e},getOOTBTypeNls:function(e,t){let o=this.getOOTBType(e);return this.getTreeTypeNls(o,t)},getTreeTypeNls:function(e,t){if(this.isSection(e))return this.getSectionSubNls(e,t);let o=e||window.IPConfig.defaultType;"string"!=typeof o&&(o=o.getType());let i=this._widgetSettings.typesNls[o]?this._widgetSettings.typesNls[o]:o;return t?i.toLowerCase():i},buildNlsWithType:function(e,t,o,i){return this.buildNls(e,t,{typeStruct:this.getTreeTypeNls(o,i)})},buildNls:function(e,t,o){let i=e[t],n={};if(o)if("string"!=typeof i)for(let t in i)n[t]=e.replace(i[t],o);else n.message=e.replace(i,o);return n}}})),define("DS/FolderEditor/Folder_Clipboard",["UWA/Class"],(function(e){"use strict";return e.singleton({name:"folder_clipboard",_currentFolder:null,_currentSelectedNodes:null,_Mode:null,_IsEmpty:!0,_IsExternalDrop:!0,init:function(e){this._parent(e)},addInFolderClipboard:function(e,t,o){if(!UWA.is(t))throw new Error("No folderNode specified");if(!UWA.is(e))throw new Error("No selected nodes specified");o=o.toUpperCase(),this._Mode=o,this._IsEmpty=!1,this._currentFolder=t,this._currentSelectedNodes=UWA.extend([],e)},removeDeletedNodeFromClipboard:function(e){if(!this._IsEmpty)return this._currentSelectedNodes=this._currentSelectedNodes.filter((function(t){return!e.includes(t.getID())}))},IsEmpty:function(){return this._IsEmpty},ClearClipboard:function(){this._IsEmpty=!0},getTreeNode:function(){return this._currentFolder},getSelectedNodes:function(){return this._currentSelectedNodes},getMode:function(){return this._Mode},SetAsExternalDrop:function(e){this._IsExternalDrop=e},IsExternalDrop:function(){return this._IsExternalDrop}})})),define("DS/FolderEditor/commands/ActionBar_SelectLeavesCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPContext","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i){"use strict";return t.extend({labelTopBar:i.ActionBar_SelectLeavesCmd,isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){let e=this.options.context;var t=e.options.model?e.options.model:e.getPADTreeDocument(),o=t.getSelectedNodes();t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();let i=new Set,n=[];o.forEach((function(e){i.has(e)||e.processDescendants({processNode:function(){i.add(this),!this.isVisible()||!1!==this.hasChildren()&&"collapsed"!==this.getState()||n.push(this)}}),i.add(e)})),t.multiselect(n),t.pushUpdate(),t.pushBroadcastSelect()},endExecute:function(){}})})),define("DS/FolderEditor/utils/FolderCommunication",["DS/IPClassifyUtil/PlatformAPIWrapper","UWA/Utils/InterCom","DS/IPClassifyUXUtil/OpenWithMenuBuilder"],(function(e,t,o){"use strict";let i=null;function n(){return UWA.is(widget)&&widget.id?"padcompassSocket_"+widget.id:"padcompassSocket"}function r(){return null===i&&(i=new t.Socket(n()),i.subscribeServer("com.ds.compass",window.parent)),i}var s={publish:function(t,o,i){e.publish(t,o),!1!==i&&e.publish("webinwin:web:notification",JSON.stringify({event:t,content:o}))},subscribe:function(t,o,i){var n=window,r=function(){if(n===top||n.parent)return o.apply(this,arguments);throw new Exception("widget has been destroyed")};e.subscribe(t,r),!1!==i&&e.subscribe("webinwin:win:notification",(function(e){"string"==typeof e&&(e=JSON.parse(e)),e&&e.event===t&&r(e.content)}))},setObject_on_compass:async function(e){if(0===e.nodes_2_open.length)r().dispatchEvent("onResetX3DContent",{},n());else{let t=await o.build3DXContent(e.nodes_2_open);0===t.data.items.length?r().dispatchEvent("onResetX3DContent",{},n()):r().dispatchEvent("onSetX3DContent",t,n())}},open_app:function(e,t){r().addListener("launchApp",(function(e){UWA.is(t,"function")&&t(e)})),r().dispatchEvent("onLaunchApp",e,n())}};return s})),define("DS/FolderEditor/commands/ActionBar_RemoveContentCmd",["UWA/Core","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Remove Content"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/commands/FolderCommands"],(function(e){}))},beginExecute:function(){},execute:function(){require("DS/FolderEditor/commands/FolderCommands").RemoveContentCmd()},endExecute:function(){}})})),define("DS/FolderEditor/commands/tools/xBookExporter",["i18n!DS/FolderEditor/assets/nls/FolderEditor","UWA/Class","UWA/Class/Options","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/IPClassifyUtil/IPServicesMgr","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal"],(function(e,t,o,i,n,r,s){"use strict";var l='<table style="border:1px solid black; border-collapse:collapse;">',a="</table><br/>",d='<th style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:.8em; padding-top:5px; paddingbottom:4px;word-break:break-word;display:table-cell;">',c="</th>",u="<tr>",p="</tr>",h="<td>",g="</td>";function f(e,t,o){for(var i=e.length,n=0;n<i;n++){o(t,e[n],n)}}function m(e,t){return function(e){let t="";if("NULL"===e)t="";else{/(\d+)\/(\d+)\/(\d+)@\d+:\d+:\d+:\w+/.test(e)&&(e=r.formatDateObj(e).toUTCString());var o=Date.parse(e);isNaN(o)||(t=new Date(o).toLocaleString(r.getLanguage()))}return t}(e.options.grid[t])}function v(e){return""+e}function _(e,t){if("tree"===e)return t.options.label;var o=null;if("function"==typeof E.customizedColumnRenderers[e])o=E.customizedColumnRenderers[e](t);else switch(typeof t.options.grid[e]){case"string":o=t.options.grid[e];break;case"number":o=v(t.options.grid[e]);break;case"boolean":o=(!0===t.options.grid[e])+"";break;default:o=""}return o}function S(e,t,o){var i=[];i.push(v(o.getDepth())),i.push(_("tree",o)),t.forEach((function(e){var t=e.kind;if(t)if("date"===t)i.push(m(o,e.dataIndex));else i.push(_(e.dataIndex,o));else i.push(_(e.dataIndex,o))})),e.rows.push(i)}function C(t,o){o||(o=i.getAvailableColumns());var n={};o.forEach((function(e){n[e]=!0}));var r={kept:[],labels:[],keys:["tree"]},s=null;return r.labels.push(e.export_level),r.labels.push(null),t.forEach((function(e){var t=!(!e.customisation||!e.customisation.exportable)&&e.customisation.exportable.value,o=void 0!==t&&!t;"tree"===e.dataIndex?s=e.text:!n[e.dataIndex]||o||E.options.columns_to_remove[e.dataIndex]||(r.labels.push(function(e){return e.text?e.text:e.dataIndex}(e)),r.keys.push(e.dataIndex),r.kept.push(e))})),r.labels[1]=s||"unknown",r}function y(){this._str=""}function b(e){var t=e||{};this._debug=!0===t.debug,this._builder=new y}y.prototype={CRLF:"\r\n",append:function(e){this._str+=e+""},toString:function(){return this._str}},b.prototype={render:function(e){var t=this;return f(e.tables,e.columns,(function(e,o){t._builder.append(l),t._builder.append("<thead><tr>"),f(e,null,(function(e,o){t._builder.append(d),t._builder.append(o),t._builder.append(c)})),t._builder.append("</tr></thead>"),t._builder.append("<tbody>"),f(o.rows,null,(function(e,o){t._builder.append(u),f(o,null,(function(e,o){t._builder.append(h),t._builder.append(o),t._builder.append(g)})),t._builder.append(p)})),t._builder.append("</tbody>"),t._builder.append(a)})),this._builder.toString()}};var E={customizedColumnRenderers:{"ds6w:created":function(e){return m(e,"ds6w:created")},"ds6w:modified":function(e){return m(e,"ds6w:modified")},"ds6w:reserved":function(t){var o=t.options.grid["ds6w:reserved"];return o&&"true"===o.toLowerCase()?e.tooltip_reserved:e.tooltip_unreserved}},options:{columns_to_remove:{tree:!0},csv_base_file_name:e.csv_base_file_name_product}},D={printHtml:function(e){var t,o,i,r,s=(t=e.context,o=e.columns,i={columns:null,tables:[]},r=C(t.getPADTreeListView().getManager().layout.columns,o),i.columns=r.labels,t.options.model.getRoots().forEach((function(e){var t=null;e.isVisible()&&(t={rows:[]},i.tables.push(t),S(t,r.kept,e),e.processDescendants({processNode:function(){this.isVisible()&&S(t,r.kept,this)}}))})),i),l=(new b).render(s);n.printhtml(l)},generateCsv:function(t){t.csv_base_file_name&&(E.options.csv_base_file_name=t.csv_base_file_name);var o=t.context.getPADTreeListView().getManager(),i=t.context.getPADTreeListView().getManager().layout.columns;t.columns;t.columns||C(i).keys;s.addComponentsToLoad("global",{exportMask:e.exportMask});var r=o.getAsCSV({addLevelInformation:!0,forceQuotes:!0});n.downloadfile(r,E.options.csv_base_file_name+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv"),s.removeComponentToLoad("global","exportMask")}};return r.isReplayedODT()&&(D.getExportableColumns=C),t.singleton(D)})),define("DS/FolderEditor/utils/ExpandProductHandler",["DS/IPClassifyUXUtil/utils/CancellablePromise","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/IPClassifyUXUtil/IPClassifyUXUtilities/view/IPClassifyLevelSel","DS/IPClassifyUtil/IPClassifyModelEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n){"use strict";return class{constructor(){this.progressCount=0,this.cancellablePromise=void 0,this.token=void 0}_resetExpandFlow(){this.progressCount=0,this.cancellablePromise=void 0}_startLoader(){this.token=i.subscribe({event:"bookmark-product-expand-cancel-refresh"},(()=>{t.removeComponentToLoad("global","expandProductsLoader"),this._cancelExpand()}));let e={cancel:()=>this._cancelExpand()};t.addComponentsToLoad("global",{expandProductsLoader:n.folderLoader_expanding_products},{withCancel:!0,withPercent:!0,cancelObject:e})}_updateLoaderProgress(e,o){let i=e/o*100;t.updateComponentPercent("global","expandProductsLoader",`${i}%`)}_cancelExpand(){i.publish({event:"bookmark-product-expand-cancel-event"}),this.cancellablePromise&&this.cancellablePromise.cancel(),this._resetExpandFlow()}callExpand(e){e.expandAll()}callNExpand(e){new o({events:{onApply:async t=>{this._callNExpand(e,t)}}})}_callNExpand(e,t){e.expandNLevels({numberOfLevelsToExpand:parseInt(t,10),initialLevel:e.getNodeDepth()})}async _expandNodeHelper(o,n){this._startLoader();let r=o.length;for(let t=0;t<r;t++){let i=o[t];this.cancellablePromise=new e((e=>{let t=i.onPostExpand((()=>{i.removeEventListener(t),e()}));null===i.options.children||i.isExpanded()&&!i.hasChildren()?e():n?this._callNExpand(i,n):this.callExpand(i)})),await this.cancellablePromise,this.progressCount++,this._updateLoaderProgress(this.progressCount,r)}t.removeComponentToLoad("global","expandProductsLoader"),this.token&&(i.unsubscribe(this.token),this.token=void 0),this._resetExpandFlow()}async _expandWithLevel(e){new o({events:{onApply:async t=>{await this._expandNodeHelper(e,t)}}})}async _expandWithoutLevel(e){await this._expandNodeHelper(e)}async expandPromise(e,t){t?await this._expandWithLevel(e,t):await this._expandWithoutLevel(e)}}})),define("DS/FolderEditor/views/FolderLoader",["i18n!DS/FolderEditor/assets/nls/FolderEditor","UWA/Controls/Abstract","UWA/Class/Options","DS/Controls/Loader","DS/Controls/Button"],(function(e,t,o,i,n){"use strict";return t.singleton(o,{name:"FolderLoader",_UILoader:null,_counter:0,_offTimeout:null,_onTimeout:null,_isCustomTextDisplayed:!1,_defaultText:"",_customText:"",_buttonCB:null,init:function(t){this._parent(t),this._defaultText=e.folderLoader_loading,this.elements.container=UWA.createElement("div",{class:"folderLoader_topBarContainer"}),this.render(t),this.elements.viewContainer=UWA.createElement("div",{class:"folderLoaderContainer"}).inject(this.elements.container),this._UILoader=new i({height:60,fadeDuration:0,showButtonFlag:!1}).inject(this.elements.viewContainer),this._button=new n({label:e.folderLoader_cancel,emphasize:"primary"}).inject(this._UILoader.elements.container);var o=this;this._button.elements.container.addClassName("folderLoader_cancelButton"),this._button.addEventListener("buttonclick",(function(e){o._buttonCB&&o._buttonCB()})),o.elements.container.hide()},render:function(e){var t=e&&e.renderTo?e.renderTo:document.body;this.elements.container.inject(t)},on:function(t,o,i){var n=this;n.elements.container.show(),o?(this._buttonCB=o,this._button.label=void 0!==i?i:e.folderLoader_cancel,this._button.show()):this._button.hide(),this._defaultText=t||e.folderLoader_loading,this._customText=this._defaultText,this._isCustomTextDisplayed?this._UILoader.text=this._text:this._UILoader.text=this._defaultText,this._counter++,this._offTimeout&&clearTimeout(this._offTimeout),this._2sTimeout||(this._2sTimeout=setTimeout((function(){n.elements.viewContainer.addClassName("folderLoaderShown"),n._10sTimeout||(n._10sTimeout=setTimeout((function(){n._isCustomTextDisplayed=!0,n._UILoader.text=n._customText}),8e3))}),2e3)),n._UILoader.on()},off:function(){var e=this;this._counter--,0===this._counter&&(e._offTimeout=setTimeout((function(){e._2sTimeout&&clearTimeout(e._2sTimeout),e._10sTimeout&&clearTimeout(e._10sTimeout),e.elements.viewContainer.removeClassName("folderLoaderShown"),e._offTimeout=null,e._isCustomTextDisplayed=!1,e._2sTimeout=null,e._10sTimeout=null,e._customText="",e._buttonCB=null,setTimeout((function(){0===e._counter&&(e.elements.container.hide(),e._UILoader.off())}),1e3)})))}})})),define("DS/FolderEditor/commands/ActionBar_SelectChildrenCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPContext","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i){"use strict";return t.extend({labelTopBar:i.ActionBar_SelectChildrenCmd,isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){let e=this.options.context;var t=e.options.model?e.options.model:e.getPADTreeDocument();let o=t.getSelectedNodes();t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();let i=new Set,n=[];o.forEach((function(e){n.push(e),i.has(e)||e.processDescendants({processNode:function(){i.add(this),n.push(this)}}),i.add(e)})),t.multiselect(n),t.pushUpdate(),t.pushBroadcastSelect()},endExecute:function(){}})})),define("DS/FolderEditor/views/FolderRevisionReportPanel",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Controls/Tab","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n){"use strict";var r=t.extend(o,{name:"GenericReportPanel",_logger:null,_panel:null,options:{},init:function(e){this._parent(e);var t=this;require(["DS/Logger/Logger"],(function(o){t._logger=o.getLogger(r),t.setOptions(e),t._createPanel(e)}))},_fillTab:function(t,o){for(var i="<ul>",n=0,r=t.entries.length;n<r;n++)i+="<li>"+t.entries[n]+"</li>";i+="</ul>";var s=new e.Element("div",{html:i,class:"tab-content"}),l=new e.Element("div");return l.style.padding="2px",l.appendChild(s),{label:t.label+" ("+t.entries.length+")",isSelected:0===o,content:l,index:o,icon:t.icon}},_createTab:function(e,t){var o,i=this,r=0;e.information.length>0&&(o=i._fillTab({label:n.information,entries:e.information,icon:{iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS}},r),e.tab.add(o),r++),e.success.length>0&&(o=i._fillTab({label:n.success,entries:e.success,icon:{iconName:"check",fontIconFamily:WUXManagedFontIcons.Font3DS}},r),e.tab.add(o),r++),e.warning.length>0&&(o=i._fillTab({label:n.warning,entries:e.warning,icon:{iconName:"alert",fontIconFamily:WUXManagedFontIcons.Font3DS}},r),e.tab.add(o)),e.tab.inject(t)},_createPanel:function(t){var o=this;require(["DS/Windows/Panel"],(function(n){var r=new e.Element("div",{styles:{"vertical-align":"top","min-height":"286px",position:"relative"}}),s=new e.Element("div",{class:"wux-control-inline-container"});r.inject(s);var l=new e.Element("div",{class:"wux-control-container"}),a=new i({displayStyle:"strip"});a.reorderFlag=!1,a.pinFlag=!0,a.showComboBoxFlag=!1,a.editableFlag=!1,a.multiSelFlag=!0,a.centeredFlag=!1,a.touchMode=!0;var d={tab:a};void 0!==t.success&&null!==t.success&&Array.isArray(t.success)&&(d.success=t.success),void 0!==t.warning&&null!==t.warning&&Array.isArray(t.warning)&&(d.warning=t.warning),void 0!==t.information&&null!==t.information&&Array.isArray(t.information)&&(d.information=t.information),o._createTab(d,l),o._panel=new n({title:t.title,content:l,position:{my:"center",at:"center"},width:600,allowedDockAreas:0,immersiveFrame:widget.immersiveFrame,resizableFlag:!0,collapsibleFlag:!1,minWidth:600,minHeight:85}),(d.success.length>15||d.warning.length>15)&&(o._panel.height=400),o._panel.elements.container.classList.add("BookmarkReportPanel")}))}});return r})),define("DS/FolderEditor/commands/ActionBar_RelationIPExplorer",["DS/ApplicationFrame/Command"],(function(e){"use strict";return e.extend({labelTopBar:UWA.i18n("Where used"),isInsert:!0,datas:{},init:function(e){e.isEnabled=!1,this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t){}))},beginExecute:function(){},execute:function(){require(["DS/FolderEditor/utils/FolderCommunication"],(function(e){e.open_app({appId:"ENORIPE_AP"},(function(e){if("no_app"===e.response){var t=require("DS/IPClassifyUtil/IPClassifyAlert"),o=require("i18n!DS/FolderEditor/assets/nls/FolderEditor");t.displayNotification({...o.msg_error_appWhereUsedNotFound,className:"error"})}}))}))},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_SelectParentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPContext","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i){"use strict";return t.extend({labelTopBar:i.ActionBar_SelectParentCmd,isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){let e=this.options.context;var t=e.options.model?e.options.model:e.getPADTreeDocument(),o=t.getSelectedNodes();if(o.length){t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var i=[];o.forEach((function(e){var t=e.getParent();t.options._isTrueRoot||i.push(t)})),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()}},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_FolderDownloadCmd",["UWA/Core","DS/ApplicationFrame/Command"],(function(e,t){"use strict";let o=new Promise((e=>{require(["DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/ServerDataAccess","DS/FolderEditor/ActionBar/FolderCommandManager","DS/IPClassifyUXUtil/ProgressPaneExecution","DS/FolderEditor/service/FolderServices","i18n!DS/FolderEditor/assets/nls/FolderEditor"],((...t)=>{e(t)}))}));return t.extend({labelTopBar:e.i18n("Folder Download"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:async function(){let[e,t,i,n,r,s]=await o;var l={},a=e.getSelectedNodes(),d=[],c="function"==typeof a[0].getType?a[0].getType():null;await t.isKindOfs(c,["Workspace","Workspace Vault","Personal Workspace"])&&(i.getCommand("FolderDownload").disable(),l.id=a[0].getID(),d.push(l),n.execute({title:s.replace(s.progressPanel_download,{bookmarkname:a[0].getLabel()}),datas:d,query:e=>r.FolderDownload(e)}).then((()=>{i.getCommand("FolderDownload").enable(),console.log("command enabled")}))),this.end()},endExecute:function(){}})})),define("DS/FolderEditor/utils/GridUtils",[],(()=>({getFontDetails:function(e){let t=e;var o=12,i=10;t&&t.layout&&t.layout.collectionView&&t.layout.collectionView._getCurrentTouchMode()&&(o=14,i=20);var n="Ariel";if(t&&t.layout&&t.layout.collectionView){let e=t.layout.collectionView.elements.leftPoolContainer;if(e){let t=e.getElementsByClassName("wux-tweakers-string-label");if(t&&t.length>0){let e=t[0];o=(o=e.getStyle("font-size"))?parseInt(o.replace("px","")):12,n=e.getStyle("font-family")}}}return{fontSize:o,fontMargin:i,fontSytle:n}},getColumnWidth:function(e,t){var o=0,i=e;return i&&i.layout&&i.layout.getColumnWidth&&(o=i.layout.getColumnWidth(t)),o}}))),define("DS/FolderEditor/utils/WidgetHandlerUtil",["DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyModelEvents"],((e,t,o,i)=>{let n=new Map([["allow-products-expand",1],["filtered-content",1],["show-sub-folders",1],["activateBIFilter",1],["useIndexAccleration",1],["activateTXO",1],["activateDGV",1]]);let r=null;return{MAX_NUMBER_EXPAND:1e4,ROOTS_PER_PAGE:200,MAX_NUMBER_FAVORITES:30,loadModules:async(...e)=>new Promise((t=>{require(e,(function(){t([...arguments])}))})),manageException(e,o){if(!e.cancelled){let i=e;(e.stack||e.err)&&(console.log(e),i={message:e.message}),e.serverErr&&(i=e.serverErr,i.error&&(i={message:i.error})),o=o||{},t.displayNotification({className:"error",...i,...o})}if(o.throwIt)throw e},hasCATIASession:()=>!!window.confirmModifiedInSession,setServiceMapping(e){r=e},getServiceMapping:()=>r,createSingleton:o.createSingleton,setTreeTaggerPreference:function(e,t){t=JSON.stringify(t),t=o.jsonZip(t),widget.setValue(e,t)},getTreeTaggerPreference:function(e){return function(e){if(e)try{e=o.jsonUnzip(e),e=JSON.parse(e)}catch(t){e={}}else e={};return e}(window.widget?widget.getValue(e):void 0)},isTreeTaggerActive:function(){return!0===e.getSetting("activateTreeFilter")},refreshWidgetContent:function(){var e={change:widget.changeInPreference,isPreferenceChangeCauseOfRefresh:widget.refreshDuetoChangeInPreference},t=null;if(e.isPreferenceChangeCauseOfRefresh&&Object.keys(e.change).length>0)for(var o in e.change){if(!n.has(o)){t="allRefresh";break}1!==n.get(o)||(t="contentRefresh")}e.isPreferenceChangeCauseOfRefresh&&!t||(i.publish({event:"refresh_content"}),"contentRefresh"!==t&&i.publish({event:"refresh_tree"}))}}})),define("DS/FolderEditor/views/ViewLoader",["UWA/Class","UWA/Promise"],(function(e,t){"use strict";var o={graphview:"graphview",tileview:"tileview",thumbnailview:"thumbnailview",datagridview:"datagridview"};Object.freeze(o);var i=["onDragOverGraph","onDropBlankGraph","onDragLeaveGraph"],n=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],r=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],s=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"];return e.extend({init:function(e){this.options=e,this.viewPromises={}},loadView:function(e,o){this.viewPromises[e]||(this.viewPromises[e]=new t((t=>{this.buildOptions(e).then((o=>{this.requireView(e,o,t)}))})),this.viewPromises[e].catch((()=>{console.error("error during loading of the view"),this.viewPromises[e]=null}))),this.viewPromises[e].then(o)},requireView:function(e,t,i){var n=this,r=this.options.amd[e],s=function(){n.postLoad(e),i&&i()};require([r],(function(i){var r=n.options.component;r.options.views[e]=new i(t),e===o.datagridview?r.options.views[e].initialize().then((function(){s()})):s()}))},postLoad:function(e){var t=this.options.component;switch(t.options.views[e].isActiveView=t.options.active_view===e,e){case o.thumbnailview:t.options.views.thumbnailview.isActiveView&&t.options.views.thumbnailview.setModel(t.options.model),t.options.isReady.thumbnailview=!0;break;case o.datagridview:t.options.views.datagridview.isActiveView&&t.options.views.datagridview.setModel(t.options.model),t.options.isReady.datagridview=!0;break;case o.tileview:t.options.views.tileview.isActiveView&&t.options.views.tileview.setModel(t.options.model),t.options.isReady.tileview=!0}t.options.model.applyActiveView(e)},buildOptions:function(e){switch(e){case o.tileview:return this._buildTileViewOptions();case o.thumbnailview:return this._buildThumbnailViewOptions();case o.datagridview:return this._builddatagridViewOptions();default:throw new Error("Invalid View Trying to load")}},mapCallbacks:function(e,t){var o=t,i={};return e.forEach((function(e){UWA.is(o.options.views_cb[e],"function")?i[e]=o.options.views_cb[e]:UWA.is(o[e],"function")&&(i[e]=o[e].bind(o))})),i},_buildGraphViewOptions:function(){var e=this;return new t((function(t,o){var n=e.options.component,r={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:n};r.active_view=UWA.clone(n.options.active_view),r.isActiveView="graphview"===r.active_view;var s=e.mapCallbacks(i,n);r=UWA.extend(r,s,!0),UWA.is(n.getOnContextualEvent)&&(r.onContextualEvent=n.getOnContextualEvent()),t(r)}))},_buildTileViewOptions:function(){var e=this;return new t((function(t,o){var i=e.options.component,r={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:i};r.active_view=UWA.clone(i.options.active_view),r.isActiveView="tileview"===r.active_view;var s=e.mapCallbacks(n,i);r=UWA.extend(r,s,!0),UWA.is(i.getOnContextualEvent)&&(r.onContextualEvent=i.getOnContextualEvent()),t(r)}))},_buildThumbnailViewOptions:function(){var e=this;return new t((function(t,o){var i=e.options.component,n={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:i};n.active_view=UWA.clone(i.options.active_view),n.isActiveView="thumbnailview"===n.active_view;var s=e.mapCallbacks(r,i);n=UWA.extend(n,s,!0),UWA.is(i.getOnContextualEvent)&&(n.onContextualEvent=i.getOnContextualEvent()),t(n)}))},_builddatagridViewOptions:function(){var e=this;return new t((function(t,o){var i=e.options.component,n={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:i};n.active_view=UWA.clone(i.options.active_view),n.isActiveView="datagridview"===n.active_view,n.view_customization=i.options.layout.view_customization,n.callbacks=e.mapCallbacks(s,i),i.options.additionalColumnsModules&&(n.additionalColumnsModules=i.options.additionalColumnsModules),t(n)}))}})})),define("DS/FolderEditor/views/FolderStatusInfos",["UWA/Controls/Abstract","UWA/Class/Options","i18n!DS/IPClassifyUXUtil/assets/nls/IPClassifyUXUtilities.json","DS/UIKIT/Tooltip","DS/IPClassifyUtil/IPServicesMgr"],(function(e,t,o,i,n){"use strict";var r=e.extend(t,{name:"folder_status",_tooltipInfo:null,init:function(e){this._parent(e),this.elements.container=UWA.createElement("span",{class:this.getClassNames()+" fonticon fonticon-info"}),this._tooltipInfo=new i({className:this.getClassNames("_tooltipInfo"),target:this.elements.container,position:"top left",trigger:"touch",events:e.events}),this.getOption("status")&&this._tooltipInfo.setBody(this.getOption("status")),this.getOption("renderTo")&&this.inject(this.getOption("renderTo"))},setStatus:function(e){this._tooltipInfo.setBody(e)}});return r.buildStatus=function(e){var t=UWA.createElement("div",{class:"folder_status_msg"});let i=e.tree_content;if(i){if(!UWA.is(i.nbObjectsSelected))throw new Error("Invalid status. Parameter nbObjectsSelected missing");i.nbObjectsInTree?i.nbObjectsInTree>0?(1===i.nbObjectsInTree?UWA.createElement("div",{text:o.FolderStatusInfos_oneObjectInTree}).inject(t):UWA.createElement("div",{text:i.nbObjectsInTree+o.FolderStatusInfos_nbObjectsInTree}).inject(t),UWA.createElement("div",{text:i.nbObjectsSelected+o.FolderStatusInfos_nbObjectsSelected}).inject(t)):UWA.createElement("div",{text:o.FolderStatusInfos_noObjectInTree}).inject(t):i.nbObjectsSelected?UWA.createElement("div",{text:i.nbObjectsSelected+o.FolderStatusInfos_nbObjectsSelected}).inject(t):UWA.createElement("div",{text:o.FolderStatusInfos_noObjectInTree}).inject(t);var r="read"!=require("DS/FolderEditor/views/FolderMode").getCurrentModeType()?o.FolderStatusInfos_authoringModeEnabled:o.FolderStatusInfos_authoringModeDisabled;UWA.createElement("div",{text:r,style:"border-top: 1px;"}).inject(t)}var s=n.getTenantsPreference();return e.Tenant&&s.length>1&&UWA.createElement("div",{text:o.FolderStatusInfos_Tenant+e.Tenant}).inject(t),t},r})),define("DS/FolderEditor/views/additionalColumns/ApprovalStatusColumn",["UWA/Core","UWA/Class","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUtil/IPServicesMgr","DS/IPClassifyUtil/PlatformAPIWrapper","DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUXUtil/CredentialsView"],(function(e,t,o,i,n,r,s,l){"use strict";return t.singleton({init:function(e){this._parent(e),n.subscribe("updateRouteContent-"+widget.id,(function(e){require(["DS/RouteWebAppUX/scripts/RouteWebAppApprovalStatusUX"],(t=>{let i=t.getApprovalStatusValue(e);Object.entries(i).map((e=>{var t=e[1].approvalStatus,i=e[1].approvalStatusModel;let n={};n[e[0]]={grid:{ApprovalStatus:t,approvalStatusModel:i}},o.publish({event:"updateContentNodes",data:{items:n}})}))}))}))},isAdditionalColumnsAvailable:function(e){if(!0!==window.isReplayODT){var t={text:s.column_ApprovalStatus,dataIndex:"ApprovalStatus",typeRepresentation:"user",editableFlag:!1,alignment:"center",sortableFlag:!1,visibleFlag:!1,customisation:{dataIndex:"ApprovalStatus",exportable:{lock:!1,value:!0},layout:{removable:!1}}};this._columnDataIndex=["ApprovalStatus"],this._columnDef={ApprovalStatus:t}}e(!0!==window.isReplayODT)},getName:function(){return"ApprovalStatus"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e){return void 0===e.ApprovalStatus},updateAttributes:function(e,t){let o=e.nodes.filter((e=>!r.isExternalObject(e))).map((e=>({id:e.getID()})));var n={},s={};s.tenant=i.getPlatformId(),s.securityContext=l.getCredential();n={};var a={data:o,option:s};require(["DS/RouteWebAppUX/scripts/RouteWebAppApprovalStatusUX"],(function(e){e.getColumnApprovalStatusValue(a).then((function(e){var o="string"==typeof e?JSON.parse(e):e;Object.entries(o).map((e=>{var t=e[1].approvalStatus,o=e[1].approvalStatusModel;n[e[0]]={ApprovalStatus:t,approvalStatusModel:o}})),t({pids:n})})).catch((function(){console.log("Exception"),t({})}))}))},getAdditionalColumnsUXDGV:function(t){var o=this._columnDataIndex[0],i=e.clone(this._columnDef[o]),n=!1;t.every(((r,s)=>((n=r.dataIndex===o)&&(t[s]=e.extend(t[s],i,!0)),!n)))}})})),define("DS/FolderEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUXUtil/IPClassifyUXUtilities/view/IPClassifyLevelSel","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/ExpandProductHandler","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r){"use strict";return t.extend({labelTopBar:e.i18n("Expand N levels"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=require("DS/FolderEditor/Folder_CSO");var t=e.getSelectedContent(),s=null;s=e.getSelectedBookmark();let l=new n;1===t.length?l.callNExpand(t[0]):t.length>1?l.expandPromise(t,true):null===s?i.displayNotification({message:r.msg_warning_noselection,className:"warning"}):new o({events:{onApply:function(e){s.expand({expandLevel:parseInt(e),clearLast:!0,initialLevel:s.getNodeDepth(),_expandChildren:!1})}}})},endExecute:function(){}})})),define("DS/FolderEditor/Folder_CSO",["UWA/Core","UWA/Controls/Abstract","DS/Utilities/Utils","DS/IPClassifyUXUtil/CredentialsView","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/LifecycleCmd/CommandMediator"],(function(e,t,o,i,n,r,s,l,a,d,c){"use strict";var u=null;function p(){var e=r.jsonUnzip(widget.getValue(a.getPrefPrefix().toLowerCase()+"TreeSelectedNode")||"{}");e=JSON.parse(e);var t=n.getTenantID();return e[t||"OnPremise"]}function h(e){return function(){if(null===u){u={};var e=widget.getValue("X3DContentId");if(e){var t=UWA.is(e,"string")?r.softJsonParser(e):e;if(t.data&&t.data.items&&t.data.items.length>0){var o=t.data.items[0];o&&(u=o)}widget.setValue("X3DContentId",void 0)}}return u}()[e]||this&&this._nextSelection&&this._nextSelection[e]}function g(e){let t=widget.getValue("x3dPlatformId"),o=!1;var n=I();n&&"OnPremise"!==n&&(o=t!==n,widget.setValue("x3dPlatformId",n));let r=F();return e&&!o||r&&r.split(".").length>=3&&i.setCredential(r),o}let f={id:"",label:"",type:"",serviceId:"3DSpace",sourceId:"",links:null,i3dx:"",getID:function(){return this.id},getType:function(){return this.type},getLabel:function(){return this.label},getSection:function(){return this.section?this.section:this.type?a.getDefaultSection(this.type):null},getRoot:function(){return null},isTreeElementType:function(){return a.isTreeType(this.getType(),this.section)},getSourceId:function(){if(!this.sourceId&&l.getServiceMapping()){let e=this.getAttributeValue("serviceId");this.sourceId=l.getServiceMapping()[e],this.sourceId=this.sourceId?this.sourceId:e}return this.sourceId},getAttributeValue:function(e){return this[e]}};function m(e){let t=e.id,o={...f,...e};return a.isDefinedSection(t)&&(o={...o,id:t,label:d["name_Section_"+t],type:t,isFavorite:!1}),o}function v(e){return m({id:e})}let _=null,S=null,C=o.debounce((()=>{c.dispatchEvent("update")}),100);let y=o.debounce((function(){s.publish({event:"updateBMESelection",data:{}}),C()}),20);function b(e){s.publish({event:"preOpenBookmark",data:{id:_.getID()}}),s.publish({event:"openBookmark",data:{id:_.getID(),options:e}})}function E(e){T._isInstantiated()?b(e):setTimeout((()=>{b(e)}))}let D={};class w{constructor(){this._nextSelection=null;let e=a.getDefaultSection();_=v(e),S=e,_.section=S,D={};let t=p();if(t){let e=t.split(",");if(e.length>1){_=v(e[e.length-1]);let t=e[1];a.isSection(t)&&(_.section=t),_.sectionId=t,E()}}if(widget&&widget.folderToOpen){let e=self.widget.folderToOpen;this.dispatchBookmarkIdSelection(e)}else this._manageOpenWith(void 0,!0)}setNextSelection({objectId:e,contentId:t}){this._nextSelection={objectId:e,contentId:t}}clearX3DContentItem(){u&&delete u.contentId,this._nextSelection&&delete this._nextSelection}clearX3DItem(){this._nextSelection=null,u=null}_manageOpenWith(e,t){let o=this.dispatchBookmarkNodeSelection.bind(this);this.getDefaultModelFromId.bind(this);e&&this.clearX3DItem();let i=this.getX3DBookmarkId();g(e),require(["DS/FolderEditor/utils/OpenWithHandler"],(function(e){new e({X3DItem:u,FolderID:i,dispatchBookmarkNodeSelection:o,commonModel:f}).handleOperation()}))}dispatchBookmarkPropsSelection(e,t){let o=this.getDefaultModelFromProperties(e);this.dispatchBookmarkNodeSelection(o,t)}dispatchBookmarkIdSelection(e,t){let o=this.getDefaultModelFromId(e);this.dispatchBookmarkNodeSelection(o,t)}dispatchBookmarkNodeSelection(e,t){let o=e.section?e.section:a.getDefaultSection(e.getType()),i=e&&(_.getID()!==e.getID()||_.getID()===e.getID()&&o!==_.section||t&&t.force);return i&&(_=e,_.section=void 0!==_.section?_.section:a.getDefaultSection(_.getType()),E(t)),i}registerTreeDocument(e,t){t.getXSO().onChange(y),D[e]=t}getCurrentBookmarkSection(){return _&&_.section?_.section:_?null:S}getCurrentBookmarkId(e){let t=this.getCurrentBookmarkElement(e);return t?t.getID():null}getCurrentBookmarkElement(e){return e&&a.isSection(_.getID())?null:_}getCurrentEltTypeNls(){let e=this.getCurrentBookmarkElement(),t="";if(e){let o=e.getType();e.sectionElement&&!e.sectionElement.type&&e.sectionElement.roots&&(o=e.sectionElement.roots[0]),t=a.getTreeTypeNls(o)}return t}updateCurrentBookmarkElement(e){_.getLabel()||e.getID()!==_.getID()||(_=e,_.section||(_.section=S))}setInfoOnTreeNode(e){for(let t in f){e[t]||(e[t]=f[t])}e.label=e.options.label,e.id=e.id?e.id:e.getID(),Object.defineProperty(e,"source",{get:function(){return"www"===this.getAttributeValue("serviceId")?"www":this.getAttributeValue("serviceId")}}),Object.defineProperty(e,"indexModeParameter",{get:function(){return"3DSpace"!==this.getAttributeValue("serviceId")&&"www"!==this.getAttributeValue("serviceId")}}),Object.defineProperty(e,"sourceName",{get:function(){return this.indexModeParameter?"fedsearch":""}})}getAllSelectedNodes(){let e={};for(var t in D)e[t]=D[t].getSelectedNodes();return e}getSelectedBookmark(){let e=this.getSelectedBookmarks();return e.length>0?e[0]:null}getSelectedBookmarks(){let e=this.getAllSelectedNodes(),t=e.TREE?e.TREE:[];if(0==t.length){let e=this.getCurrentBookmarkElement();e&&e.getLabel()&&(e.options=e.options?e.options:{},t=[e])}return t}getSelectedContent(){let e=this.getAllSelectedNodes();return e.CONTENT?e.CONTENT:[]}getSelectedNodes(){let e=this.getSelectedContent();return 0==e.length&&(e=this.getSelectedBookmarks()),e}}let I=h.bind(null,"envId"),F=h.bind(null,"contextId");w.prototype.getDefaultModelFromId=v,w.prototype.getDefaultModelFromProperties=m,w.prototype.getX3DBookmarkId=h.bind(w,"objectId"),w.prototype.getX3DContentId=h.bind(w,"contentId"),w.prototype.getX3DCmdToLaunch=h.bind(w,"launchCmdOnContent"),w.prototype.getX3DTenant=I,w.prototype.getX3DCredentials=F,w.prototype.getStoredSelection=p;let T=l.createSingleton(w);T._assignTenantFromX3DContentId=g;let x={onChange:function(e){return s.subscribe({event:"updateBMESelection"},e)},onPrepareBookmarkOpening:function(e){return s.subscribe({event:"preOpenBookmark"},e)},onBookmarkOpening:function(e){return s.subscribe({event:"openBookmark"},e)}};for(var P in x)T[P]=x[P];return T})),define("DS/FolderEditor/views/additionalFacets/AttachmentsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/WidgetServices/WidgetServices","DS/ENOXAttachmentsUX/AttachmentsPane","DS/FolderEditor/Folder_CSO"],(function(e,t,o,i,n,r,s){return t.extend(o,i,{init:function(e){this._parent(e),this.buildView(e)},buildView:function(t){this.elements.container=e.createElement("div",{class:"doc_fitting"});var o={parentObject:{parentId:null},connectorOptions:{fetchSecurityContext:function(){return t.appContext.getSecurityContext().replace("ctx::","")},platformUrls:t.appContext.getPlatformUrls()},hideSpecifications:t.hideSpecifications,supportedTypes:t.supportedTypes,readonly:t.readonly,webinwin:n.isWebInWinEnvironment()};this.pane=new r(o),this.pane.inject(this.elements.container)},isTypeSupported:function(e){let t=["VPMReference","Document"];for(let o=0;o<t.length;++o)if(e.indexOf(t[o])>-1)return!0;return!1},updateFacet:function(){var e=this,t=this.getModel();this._currentId=t.get("objectId"),1==s.getSelectedNodes().length&&(t.addEventOnce("onChangeAttributes",(function(t){t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB)&&e.selectionModified()})),(null==this._previousId||t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB))&&this.selectionModified(),this._previousId=this._currentId)},selectionModified:function(){var e={parentId:this._currentId};this.pane.setParentObject(e)}})})),define("DS/FolderEditor/views/additionalFacets/SpecificationsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/WidgetServices/WidgetServices","DS/ENOXSpecificationsUX/SpecificationsPane","DS/FolderEditor/Folder_CSO"],(function(e,t,o,i,n,r,s){return t.extend(o,i,{init:function(e){this._parent(e),this.buildView(e)},buildView:function(t){this.elements.container=e.createElement("div",{class:"doc_fitting"});var o={parentObject:{parentId:null},connectorOptions:{fetchSecurityContext:function(){return t.appContext.getSecurityContext().replace("ctx::","")},platformUrls:t.appContext.getPlatformUrls()},hideAttachments:t.hideAttachments,supportedTypes:t.supportedTypes,readonly:t.readonly,webinwin:n.isWebInWinEnvironment()};this.pane=new r(o),this.pane.inject(this.elements.container)},isTypeSupported:function(e){let t=["VPMReference"];for(let o=0;o<t.length;++o)if(e.indexOf(t[o])>-1)return!0;return!1},updateFacet:function(){var e=this,t=this.getModel();this._currentId=t.get("objectId"),1==s.getSelectedNodes().length&&(t.addEventOnce("onChangeAttributes",(function(t){t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB)&&e.selectionModified()})),(null==this._previousId||t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB))&&this.selectionModified(),this._previousId=this._currentId)},selectionModified:function(){var e={parentId:this._currentId};this.pane.setParentObject(e)}})})),define("DS/FolderEditor/utils/FolderEditorControl",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/FolderEditorOpenness/FolderEditorOpenness","DS/IPClassifyUtil/IPServicesMgr","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/PlatformCredSelector","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r,s,l,a){"use strict";var d;class c{constructor(){this._Content=null,this._TreeCont=null,this._isDebugMode=!1,this._onWidgetRefresh=null,this._waiters={treeCont:[]},d=this.checkRolesAvailability()}}let u={_getContentGridView:function(){return this._Content&&this._Content.getPADTreeListView()?this._Content.getPADTreeListView():null},getContentRootNodes:function(){return this._Content?this._Content.getPADTreeDocument().getRoots():[]},getTreeRootSections:function(){return this._TreeCont?this._TreeCont._rootNodes:{}},getContentMode:function(){return this._Content?this._Content.getCurrentModeType():null},isContentViewAvailable:function(){return!!this._Content},getColumnsUnitNls:function(){return this._getContentGridView()?this._getContentGridView().getColumnsUnitNls():null},getContentColumns:function(){return this._getContentGridView()&&this._getContentGridView().getManager()?this._getContentGridView().getManager().columns:null},getGridViewRowHeight:function(){return this._Content?this._Content.getGridViewRowHeight():null},getVisibleTreeNode:function(e,t){return this._TreeCont?this._TreeCont._getVisibleNodeById(e,t):null},getAvailableCurrentBookmarkPath:function(){return this._TreeCont?this._TreeCont.getExistingBookmarkPath():null},getContentActiveView:function(){return this._Content?this._Content.getActiveView():null},getTreeCont:async function(){return this._TreeCont?this._TreeCont:new Promise((e=>{this._waiters.treeCont.push(e)}))},getWidgetRefresh:function(){return this._onWidgetRefresh},setContent:function(e){this._Content=e},setTreeCont:function(e){this._TreeCont=e,this._waiters.treeCont.forEach((e=>{e(this._TreeCont)}))},setIdCardCont:function(e){this._IdCardCont=e},setWidgetRefresh:function(e){this._onWidgetRefresh=e},getActiveFolder:function(){return{origin:widget.id,id:void 0!==this._activeFolderId?this._activeFolderId:null,label:this._activeFolderLabel,sc:this._activeFolderSc,disabledId:this._activeFolderDisabledId}},setActiveFolder:function(e,t,o,i){this._activeFolderId=e,this._activeFolderLabel=t,this._activeFolderSc=o,this._activeFolderDisabledId=i},isDebugMode:function(){return this._isDebugMode},setDebugMode:function(e){this._isDebugMode=e},isCustomizedEnv:function(){return void 0===this._isCustomizedEnv&&(this._isCustomizedEnv=t.useComputedSecurityContext(),this._isCustomizedEnv=!1),this._isCustomizedEnv},isActiveBookmarkActivated:function(){return void 0===this._isActiveBookmarkActivated&&(this._isActiveBookmarkActivated=t.isActiveBookmarkActivated()),this._isActiveBookmarkActivated},isImportCSVActivated:function(){return void 0===this._isImportCSVActivated&&(this._isImportCSVActivated=t.isImportCSVActivated()),this._isImportCSVActivated},checkRolesAvailability:function(){return new Promise((t=>{e.getGrantedRoles((e=>{if(e.length>0){const o=new Set(e.map((e=>e.id)));t(o)}}))}))},onTenantSecurityCTXPopup:function(){l.removeComponentToLoad("global","widget")},getPlaceholder:function(){return this._placeholder=this._placeholder?this._placeholder:new Promise((function(e){require(["DS/FolderEditor/views/FolderPlaceHolder"],(function(t){e(new t)}))}))},getAvailableRoles:async function(){return d}};for(let e in u)c.prototype[e]=u[e];return(window.spyOn||window.pageObjectEnv||window.nativeReplay)&&(c.prototype._getTreeCont=function(){return this._TreeCont},c.prototype._getContent=function(){return this._Content},c.prototype._getIdCardCont=function(){return this._IdCardCont}),s.createSingleton(c)})),define("DS/FolderEditor/utils/FolderSearch",["DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUtil/IPClassifyModelEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices"],(function(e,t,o,i,n){"use strict";var r={tree:"ds6w:label"};let s={"ds6w:cadMaster":"attribute[XCADExtension.V_CADOrigin]"};return i.createSingleton(class{constructor(){this._scrollingWasReset=null,this._currentSearch=null,this._searchInfo=null,this._indexInfo=null,this._lListener=[],this._lListenerResult=[],this._originFolder=null,this._previousViewCommand=null,this._defaultPredicates=["ds6w:label","physicalid","mxid","ds6w:type","ds6w:identifier","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:reservedBy","relcount","taxonomies","ds6w:kind","ds6w:contentStructure","ds6w:cadMaster","ParentBk","owner","ds6w:responsibleUid","internal_link_vaultedobjectslink","ds6w:i3dx"],this.batchInfoIndex=new Map,this.countToShowOnBreadCrumb=0,this.countToLoadOnGrid=0,this.searchingInRoot=!1,this.combinedNresult=0,this.nextSearchResultLength=0,this._currentBatchesNresults=0,this.defaultRelPredicates=["bks.TreeOrder","physicalid"],this._attrPredicateMap=new Map,this._predAttrMapDefault=this._defaultPredicates.map((e=>[e,s[e]])),this.defaultRelPredicates.forEach((e=>this._predAttrMapDefault.push([e,null]))),this._predAttrMap=new Map(this._predAttrMapDefault);this._searchInfo={with_indexing_date:!0,select_predicate:UWA.clone(this._defaultPredicates),select_relPredicate:UWA.clone(this.defaultRelPredicates),select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25},this._facets=null,t.getModelEvents().subscribe({event:"search_cleared"},this.clearSearch.bind(this,!0))}_getSingletonInstance(){return this}setInitialSearchData(){this.batchInfoIndex.clear(),this.rootSearchNo=0,this.countToShowOnBreadCrumb=0,this.searchingInRoot=!1,this.combinedNresult=0}setNumberResults(e){this._searchInfo.nresults=e}getNumberResults(){return this._searchInfo.nresults}setPreviousView(e){this._previousViewCommand=e}getPreviousView(){return this._previousViewCommand}setPredicates(e){this._attrPredicateMap.clear();for(let e in s)this._attrPredicateMap.set(s[e],e);this._predAttrMap=new Map(this._predAttrMapDefault),this.addPredicates(e)}setRootBookmarks(e){this._roots=e}getRootBookmarks(){return this._roots}addPredicates(e){var t=this;Array.isArray(e)&&e.forEach((function(e){var o=e.ds6w;if(o&&"thumbnail"!==o){var i=null;if(e.attrDBName)for(var n in i=e.attrDBName)t._attrPredicateMap.set(i[n],o);t._predAttrMap.set(o,i)}})),this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())}removePredicates(e){for(var t=this,o=0;o<e.length;++o)if(t._predAttrMap.delete(e[o].dataIndex),e[o].attrDBName){var i=e[o].attrDBName;for(var n in i)t._attrPredicateMap.delete(i[n])}this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())}getAuthAttributes(){var e=Array.from(this._predAttrMap.values());return e=e.filter((function(e){return null!=e})),[].concat.apply([],e)}getIndexPredicates(){return Array.from(this._searchInfo.select_predicate)}getRelIndexPredicates(){return Array.from(this._searchInfo.select_relPredicate)}getIndexPredicateForTree(){return["ds6w:label","physicalid","mxid","ds6w:type","ds6w:created","ds6w:responsibleUid","icon_2ddefaultthb.subtype","ds6w:classification"]}getIndexRelPredicateForTree(){return["bks.TreeOrder","physicalid"]}getAttrPredicateMap(){return this._attrPredicateMap}onSearchChange(e){"function"==typeof e&&this._lListener.push(e)}onSearchResult(e){"function"==typeof e&&this._lListenerResult.push(e)}_notifyChange(e){if(this.isSearchActive()||e){var t=this;e||(e=t._currentSearch),this._lListener.forEach((function(e){e.call(null,t._currentSearch)}))}}changeSortField(e,t){var i=this._getDS6WFromColumnIndex(e),n=this._getColumnPredicate(i);if(!n||!n.startsWith("ds6w"))return{message:o.get("msg_info_SortNonAvailable"),className:"primary"};this._searchInfo.order_field!==n&&(this._searchInfo.order_field=n,this.setInfoIndex(null,!1)),t&&this._notifyChange()}changeOrderSort(e,t){null!=e&&this._searchInfo.order_by!=e&&(this._searchInfo.order_by=e,this.setInfoIndex(null,!1)),t&&this._notifyChange()}changeSearch(e,t){if(""===e&&(e=null),this._currentSearch!==e||!e){this.setInfoIndex(null,!e);var o=this._currentSearch;this._currentSearch=e,!0!==t&&this._notifyChange(o),e&&i.sendTrackerPageEvent("FolderWidget_iconBar","Search")}}columnIsAvailable(e){return null!=this._getColumnPredicate(e)}_getColumnPredicate(e){var t=this._getDS6WFromColumnIndex(e),o=this.getSearchInfo().select_predicate.indexOf(t)>=0?t:null;return o=!o&&this.getSearchInfo().select_predicate.indexOf(t)>=0?t.toLowerCase():o}_getDS6WFromColumnIndex(e){var t=r[e];return t||(t=e),t}getSearchInfo(){return this._searchInfo}setSearchCallResult(e,t){t&&(this._currentBatchesNresults=0),this._currentBatchesNresults+=e.length}getSearchCallResult(){return this._currentBatchesNresults}getNextStartNum(e){return"OnPremise"!=n.getTenantID()?e.nhits-Number(e.next_start.substring(1,e.next_start.indexOf(" ",2))):e.nhits-Number(e.next_start.substring(0,e.next_start.indexOf(" ")))}setScrollEndStatus(){this._hasReachedEnd=!0,0!=this.batchInfoIndex.size&&(this._hasReachedEnd=[...this.batchInfoIndex].every((e=>e[1].nresults<this.getResultsCount())))}getScrollEndStatus(){return!(this.countToShowOnBreadCrumb>this.getResultsCount())||!!this._hasReachedEnd}setCountForBreadCrumb(e){this.countToShowOnBreadCrumb+=e}getCountForBreadCrumb(e){let t={};return t.nresults=this.combinedNresult+e.length,t.nhits=this.countToShowOnBreadCrumb,t.searchingInRoot=!0,t}setBatchInfoIndex(e,t,o){this.batchInfoIndex.set(e,t),o&&this.setCountForBreadCrumb(t.nhits)}getBatchInfoIndex(e){return 0!=this.batchInfoIndex.size?null==this.batchInfoIndex.get(e)?null:this.batchInfoIndex.get(e):null}getCountToLoadOnGrid(){return this.searchingInRoot?this.countToLoadOnGrid:null}setCountToLoadOnGrid(){let e;e=this.getResultsCount()>this.getSearchCallResult()?this.getSearchCallResult():this.getResultsCount(),this.countToLoadOnGrid=this.countToLoadOnGrid+e}async _updateIndexUserInfo(){let e=this._indexInfo,i=e;if(e){var n=this.getDateLastIndexation();e.lastIndexation=n;let t=await new Promise((e=>require(["DS/FolderEditor/service/FolderServices"],e)));var r=await t.getCurrentBookmarkInfo();e.objectName=r.getLabel(),i={...e},e.linkInfo&&(i.nhits+=e.linkInfo.nhits,i.nmatches+=e.linkInfo.nmatches)}var s=t.getModelEvents();s.publish({event:"searchUpdated",data:i}),s.publish({event:"update_toolbar_warning",data:{message:e&&e.searchingInRoot?o.searchReasultWarningMsg:"",type:"search",key:"searchInRoot"}})}wasScrollingReset(){return this._scrollingWasReset}setInfoIndex(e,t){var o=this;this._indexInfo=e,this._indexInfo||this.resetInfoIndex(),!1!==t&&(this._lListenerResult.forEach((function(t){t.call(o,e)})),this._updateIndexUserInfo())}resetInfoIndex(e){this.countToLoadOnGrid=0,this._indexInfo=null,this._scrollingWasReset=e&&e.resetScrolling}getOrderFieldForTree(){var e=this.getOrderField();for(var t in r)r[t]===e&&(e=t);return e}getOrderField(){return this.getSearchInfo()?this.getSearchInfo().order_field:null}getOrderBy(){return this.getSearchInfo()?this.getSearchInfo().order_by:null}getInfoIndex(){return this._indexInfo}getNumberLastResult(){return this._indexInfo?this._indexInfo.nresults:0}getNumberHits(){return this._indexInfo?this._indexInfo.nhits:0}getDateLastIndexation(){var e=null,t=this.getInfoIndex();if(t&&t.sources){var o=null;t.sources.forEach((function(e){if(e.indexingDate)var t=e.indexingDate;for(var i in t)t[i]&&-1!==t[i]&&(o?t[i]<o&&(o=t[i]):o=t[i])})),o&&(e=new Date(1e3*o))}return e}isSearchActive(){return!!this.getSearchValue()}isSearchInProgress(){return!!this._indexInfo&&!!this._currentSearch}getSearchValue(){return this._currentSearch}getOriginFolder(){return this._originFolder}setOriginFolder(e){this._originFolder=e}clearSearch(e){this.changeSearch("",e)}getResultsCount(t){let o=0,i=e.getGridViewRowHeight();if(i){let e=(window.widget?window.widget:document).body.getDimensions().height;i&&e&&(o=Math.ceil(e/i))}return o=o>0?10*o:10,t?Math.max(t,o):o}},{staticProperties:["searchingInRoot","batchInfoIndex"]})})),define("DS/FolderEditor/views/additionalColumns/RelationColumns",["DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/FolderEditor/utils/FolderSearch","DS/ENORIPE_RelationsColumns/RelationsColumns","DS/PADUtils/PADProbes","DS/PADServices/utils/AttributesMgtV2"],(function(e,t,o,i,n){"use strict";let r=null;return i.initialize({padid:widget.id,padtitle:widget.getTitle()}),o.isAdditionalColumnsAvailable((function(i){if(!0===i){let i=n.__proto__.createOutputsRequest;n.__proto__.createOutputsRequest=function(e,o){let n=null;return n=void 0===o&&"fetch"===e?{select_predicate:t.getIndexPredicates(),select_file:["thumbnail_2d","icon"]}:i.apply(this,arguments),n},n.__proto__.getAvailableColumns=e.getAvailableColumns,n.__proto__.getColumnsToNotNls=()=>[],n.__proto__.hasNLS=e.hasNLS,o.setPreferenceProxy()}})),o.relationNodesExpanded(!1),o.getOnCellClickCB=function(e){if(-1!==this.getManagedColumnNames().indexOf(e))return function(t){t.nodeModel&&(t.nodeModel.options.grid[e]>0&&require(["DS/FolderEditor/utils/FolderEditorEvents"],(function(t){t&&t.notifyRightSidePanelOpen(e)})))}},o.getAdditionalColumnsUXDGV_ENORIPE=o.getAdditionalColumnsUXDGV,o.getAdditionalColumnsUXDGV=function(t){const i=e.getView().MP_SELECTED_COLS.map((e=>e.dataIndex||e.ds6w));let n=i.indexOf("ContextualMenuColumn");n=n<0?i.length:n,this.getManagedColumnNames().forEach((e=>{if(i.includes(e)){var o=t.findIndex((t=>t.dataIndex===e));-1!==o&&delete t[o].notInPreference}else{var r=this._buildDGVColumn(e);r.notInPreference=!0,t.splice(n,0,r),n++}})),o.getAdditionalColumnsUXDGV_ENORIPE(t)},r=o,r})),define("DS/FolderEditor/views/FolderMode",["DS/Controls/TooltipModel","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderSearch","DS/IPClassifyUtil/IPClassifyAlert","DS/CoreEvents/ModelEvents","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/WebUAUtils/WebUAUtils","DS/FolderEditor/utils/SettingsHandler","DS/IPClassifyUtil/IPClassifyUtility"],(function(e,t,o,i,n,r,s,l,a,d,c){"use strict";var u=null,p=null;let h;let g=null,f=null;return s.createSingleton(class{constructor(){g&&r.getModelEvents().unsubscribe(g),f&&clearInterval(f),this._tooltip=new e,this._currentModeType=!1!==widget.getValue("useIndexAccleration")?"read":"authoring",this._instantTime=null,this._lastRefreshMode=null,this._modelEvents=null,g=r.getModelEvents().subscribe({event:"switch_to_author"},this.switchtoAuthoringMode.bind(this)),f=setInterval((()=>{this.updateToolTip()}),1e4),this._modelEvents=new n}getGeneratedTooltip(){return this._tooltip}switchModeButtonUI({toActivate:e}={}){c.sendTrackerPageEvent("FolderWidget_iconBar","Active Mode"),h=e;(e=>{clearTimeout(p),p=setTimeout((()=>{if(void 0===h||"read"===this.getCurrentModeType()===h){o.isSearchActive()&&(o.clearSearch(),r.publish({event:"switch_search",data:{show:!1}})),"read"==this.getCurrentModeType()?(this.setCurrentMode("authoring"),this.updateIconAndSettings()):(this.setCurrentMode("read"),this.updateIconAndSettings());try{s.refreshWidgetContent()}catch(e){console.log(e),d.getSections().forEach((e=>{l.removeComponentToLoad("treeView",e.name+"Tree")}))}}}),e)})(300)}updateIconAndSettings(e,t){var o=e||!0;if(widget.refreshDuetoChangeInPreference){var i=widget.changeInPreference;i.hasOwnProperty("useIndexAccleration")&&(i.useIndexAccleration?this.setCurrentMode("read"):this.setCurrentMode("authoring"),this._modelEvents.publish({event:"changeInContentFilterType"})),(i.hasOwnProperty("filtered-content")||i.hasOwnProperty("allow-products-expand"))&&this._modelEvents.publish({event:"onSpecificPreferenceChange"})}(o&&this._registerTimeandModeOfRefresh(this.getCurrentModeType()),"read"==this.getCurrentModeType())&&(this._enableIndexModeSwitch(),this.stopRefresh(),(!widget.refreshDuetoChangeInPreference||Object.keys(i).length>0)&&r.publish({event:"resetReadIndex"}));if("authoring"==this.getCurrentModeType())if(widget.getValue("useIndexAccleration")){var n=widget.getValue("autoSwitch");this._enableAuthoringMode(),this.setIndexModeAfterTimeInterval(n)}else this._enableAuthoringMode();this.updateToolTip()}_enableAuthoringMode(){r.publish({event:"update_index_icon",data:{mode:"authoring"}})}_enableIndexModeSwitch(){r.publish({event:"update_index_icon",data:{mode:"read"}})}getCurrentModeType(){return this._currentModeType}setCurrentModeType(e){this._currentModeType=e}onSpecificPreferenceChange(e){this._modelEvents.subscribe({event:"onSpecificPreferenceChange"},e)}_registerTimeandModeOfRefresh(e){this._instantTime=(new Date).getTime(),this._lastRefreshMode=e}updateToolTip(){var e=this._instantTime,o=Math.floor(((new Date).getTime()-e)/1e3);o=o<60?o+" "+t.indexMode.seconds:o/60<60?Math.floor(o/60)+" "+t.indexMode.minutes:Math.floor(o/3600)+" "+t.indexMode.hours;var i="read"==this._currentModeType?t.indexMode.IndexModeTooltip:t.indexMode.AuthoringModeTooltip,n="read"==this._currentModeType?t.indexMode.IndexModelongHelp:t.indexMode.AuthoringModelongHelp;if(this._tooltip.shortHelp=i,this._tooltip.longHelp=n,this._tooltip.title=t.indexMode.title,!this._tooltip.moreHelpCB&&window.IPConfig.indexModeHelp){var s={helpid:"indexMode"};s.content={"indexMode.PanelHelp":window.IPConfig.indexModeHelp};var l=a.getMoreHelpCallback(s);this._tooltip.moreHelpCB=l}r.publish({event:"toolbar_update_command",data:{commandID:"indexMode",data:{tooltip:this._tooltip}}})}setIndexModeAfterTimeInterval(e){var o=this;if(this.stopRefresh(),!isNaN(e)){var n=parseInt(e);u=setTimeout((function(){widget.getPreference("useIndexAccleration").value&&(o.setCurrentMode("read"),o.updateIconAndSettings(!0,!0),i.displayNotification({message:t.replace(t.indexMode.info_msg_DataNotUptoDate,{timeElapsed:n}),title:t.indexMode.info_msg_IndexModeTitle,className:"info"}))}),60*n*1e3)}}stopRefresh(){u&&clearTimeout(u)}setCurrentMode(e,t){this.setCurrentModeType(e);let i=t&&t.silentSwitch;o.isSearchActive()||r.publish({event:"switchContentMode",data:{mode:e,silentSwitch:i}}),r.publish({event:"switchTreeMode",data:{mode:e,silentSwitch:i}})}switchtoAuthoringMode(e){e="boolean"==typeof e&&e,"read"==this.getCurrentModeType()&&(o.isSearchActive()&&0==e&&(o.clearSearch(),r.publish({event:"switch_search",data:{show:!1}})),this.setCurrentMode("authoring",{silentSwitch:e})),this.updateIconAndSettings()}})})),define("DS/FolderEditor/views/additionalColumns/LibraryClassesColumn",["UWA/Class","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService"],(function(e,t,o){"use strict";return e.singleton({init:function(e){this._parent(e)},getName:()=>"libraryClassesColumn",getManagedColumnNames:function(){return["ds6w:library"]},toBeUpdated(e,t){return this.getManagedColumnNames().some((o=>!this._areValuesEqual(e[o],t.getAttributeValue(o))||!t.getAttributeValue("isLibraryClassSet")))},isAdditionalColumnsAvailable:function(e){e(!0)},_areValuesEqual:(e,t)=>Array.isArray(e)&&Array.isArray(t)?JSON.stringify(e)===JSON.stringify(t):e===t,fetchLibraryClassesName(e){const t={inSource:"3DSpace",type:"json",method:"GET",query:{ids:e.join(",")},cache:-1,headers:{Accept:"application/json","content-type":"application/json"}};return o._executeQuery("/resources/v1/FolderManagement/Folder/library/classes",t,"libraryClassesColumn")},updateAttributes(e,o){if("authoring"===t.getCurrentModeType()){const t=this.fetchLibraryClassesName(e.pids);var i={};t.then((t=>{const n=t.result;e.nodes.forEach((e=>{void 0!==n[e.id]&&(i[e.id]={"ds6w:library":[...new Set(Object.values(n[e.id]).sort())]}),e.setAttribute("isLibraryClassSet",!0)})),o({pids:i})})).catch((e=>{o({})}))}else o({})},getAdditionalColumnsUXDGV:()=>!0})})),define("DS/FolderEditor/utils/FolderEditorEvents",["UWA/Class","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/utils/SettingsHandler"],(function(e,t,o,i){return e.singleton({EVT_CURRENT_FOLDER_CHANGE:"/FOLDER_EDITOR/CURRENTFOLDER_CHANGE",EVT_NODEMODEL_MODIFY:"/FOLDER_EDITOR/NODEMODEL_MODIFY",EVT_TREEFILTER_CHANGE:"/FOLDER_EDITOR/EVT_TREEFILTER_CHANGE",EVT_TREE_UPDATE:"/FOLDER_EDITOR/EVT_TREE_UPDATE",EVT_TAGGER_STATUS_CHANGE:"/FOLDER_EDITOR/EVT_TAGGER_STATUS_CHANGE",EVT_CURRENT_FOLDER_COLUMN_CHANGE:"/LIBRARY_EDITOR/CURRENT_LIBRARY_COLUMN_CHANGE",EVT_FOLDER_EDIOTR_READY:"onFolderEditorReady",createBookmarkForPublication:function(e,t){var o=e,n={From:"FolderEditor",FolderID:null,FolderLabel:null,FolderType:null,IsInDeletedItems:!1,IsFavorite:!!o&&!0===o.isFavorite,Timestamp:Date.now()};return!o||i.isHardSection(o.getID())&&!t||(n.FolderID=o.getID(),n.FolderLabel=o.getLabel(),n.FolderType=o.getType()),o&&"FolderSection_Trash"===o.getID()&&(n.IsInDeletedItems=!0),n},notifyFolderRename:function(e){if(!UWA.is(e,"array"))throw new Error("input parameter should be array");var i=this;e.forEach((function(e){var n=i.createBookmarkForPublication(e);o.publish("FolderEditor.FolderUpdated",JSON.stringify(n),!0),t.publish({event:i.EVT_NODEMODEL_MODIFY,context:e,data:e})}))},notifyFolderAttrChange:function(e,o){t.publish({event:"TreeOrderModified",context:e,data:{data:e.folders,parentNode:o}})},notifyFavoriteRename:function(e){t.publish({event:"rename_favorite",context:e,data:e})},notifyFolderLoadingEnd:function(e){if(!UWA.is(e))throw new Error("input parameter should be a TreeNodeModel");t.publish({event:this.EVT_FOLDER_LOADINGEND,context:e,data:e})},onFolderLoadingEnd:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");t.subscribe({event:this.EVT_FOLDER_LOADINGEND},e)},onFolderRename:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");t.subscribe({event:this.EVT_NODEMODEL_MODIFY},e)},onModAttr:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");t.subscribe({event:"TreeOrderModified"},e)},notifyCurrentFolderColumnChange:function(){t.publish({event:this.EVT_CURRENT_FOLDER_COLUMN_CHANGE})},onCurrentFolderColumnChange:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");t.subscribe({event:this.EVT_CURRENT_FOLDER_COLUMN_CHANGE},e)},notifyFolderEditorReady:function(){t.publish({event:this.EVT_FOLDER_EDIOTR_READY})},onFolderEditorReadyforWenInWin:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");t.subscribe({event:this.EVT_FOLDER_EDIOTR_READY},e)},notifyTreeUpdate:function(e){t.publish({event:this.EVT_TREE_UPDATE,data:e})},onTreeUpdated:function(e){t.subscribe({event:this.EVT_TREE_UPDATE},e)},notifyTaggerStatusChange:function(){t.publish({event:this.EVT_TAGGER_STATUS_CHANGE})},onTaggerStatusChange:function(e){t.subscribe({event:this.EVT_TAGGER_STATUS_CHANGE},e)},notifyRightSidePanelOpen:function(e){t.publish({event:"information-panel-open-fromDGV",data:{rdata:"right",dataIndex:e}})},subscribeEvents:function(){return t.subscribe({event:"welcome-panel-collapse"},(function(){t.publish({event:"triptych-hide-panel",data:"left"})})),t.subscribe({event:"welcome-panel-expand"},(function(){t.publish({event:"triptych-show-panel",data:"left"})})),t.subscribe({event:"information-panel-close"},(function(){t.publish({event:"triptych-hide-panel",data:"right"})})),t.subscribe({event:"information-panel-open"},(function(){t.publish({event:"triptych-show-panel",data:"right"})})),t.subscribe({event:"information-panel-open-fromDGV"},(function(e){t.publish({event:"triptych-show-panel",data:e})})),t},subEvent:function(e,o){if(!UWA.is(o,"function"))throw new Error("input parameter should be function");t.subscribe({event:e},o)},leftPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},leftPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},rightPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},rightPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},unsubscribeAll:function(){t.unsubscribeAll()}})})),define("DS/FolderEditor/plugins/PluginsManager",["DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/FolderEditor"],((e,t)=>{let o=[],i={},n={},r=["updateNodesFromRelations","prepareDataFromDB","prepareDataFromIndex","completeNode","prepareTreeData","completeTreeNode","updateTreeNode","fillTreeDrag","fillContentDrag","fillForDrop","updateCmdsRules","updateCmdsVariables","applyCmdsVariables","updatePropertiesPanel","addProbesNlsMapping","onRefreshContentView","getTypesToLoad"],s=new Set(["isDropAuthorized","dropLeftView","moveTreeElements","moveContent","moveExternalObject","removeContent","removeExternalLink","addcontent","addExternalObject","copyTreeElement","checkCopyTree","canBePasted","renameTreeElement"]);let l={initialize:function(){return new Promise((a=>{window.IPConfig.plugins.length>0?require(window.IPConfig.plugins,(function(...d){o=d,r.forEach((e=>{let t=[];o.forEach((o=>{o[e]&&t.push(o)})),t.length>0&&(i[e]=t)})),e.waitReady().then((()=>{o.forEach((t=>{if(t.getTypesByAction){let o=t.getTypesByAction();for(let t in o)if(s.has(t)){let i=n[t];i||(i=n[t]={});for(let n in o[t]){let r=o[t][n];i[n]=r;let s=e.getDerivatives(n);s&&s.length>0&&s.forEach((e=>{i[e]=r}))}}for(let e in n)l[e]=function(t){let o=t,i=!1;"object"==typeof t&&(o=t.type,i=!0);let r=n[e][o],s=null;if(r){const e=Array.prototype.slice.call(arguments);e.shift(),s=r(...e)}else if(!i)throw new Error("Unsupported action "+e+" for type "+o);return s}}})),s.forEach((e=>{l[e]||(l[e]=({silent:o})=>{if(!o){console.log("Unsupported action "+e+" for this widget");let o=t.unsupportedAction;if(e.startsWith("is"))throw new Error(o);return Promise.reject(o)}})})),a()}))})):a()}))},actionAuthorized:function({action:e,type:t}){return n[e]&&n[e][t]}};return r.forEach((e=>{l[e]=function(){let t=[],o=i[e];return o&&o.forEach((o=>{let i=o[e](...arguments);t.push(i)})),t}})),l})),define("DS/FolderEditor/utils/ServerDataAccess",["DS/FolderEditor/utils/SettingsHandler","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService"],((e,t)=>{let o={},i={};async function n(e){let n=[],r=[];if(e.forEach((e=>{let t=i[e];t?n.push(t):r.push(e)})),r.length>0){let s={};s.payload={types:r};let l=t.fetchSubTypes(s);l.then((e=>{r.forEach((t=>{let i=e[t]?e[t]:[];o[t]=i}))})).catch((()=>{e.forEach((e=>{delete i[e]}))})),n.push(l),r.forEach((e=>{i[e]=l}))}await Promise.all(n)}function r(t,i){let n=[];return{isKindOf:i.some((i=>{let r=t===i;if(!r){let s=e.getDerivatives(i),l=s||o[i];l?r=l.indexOf(t)>=0:n.push(i)}return r})),unknownTypes:n}}function s(e,t,o){return o&&(e=[...e]).unshift(t),e}return{getSubTypes:async function(t,i){let r=Array.isArray(t)||t instanceof Set;r||(t=[t]);let l=[],a={};return t.forEach((t=>{let n=e.getDerivatives(t),r=n||o[t];r?a[t]=s(r,t,i):l.push(t)})),l.length>0&&(await n(l),l.forEach((e=>{a[e]=s(o[e],e,i)}))),r?a:a[t]},isKindOfSync:function(e,t){return this.isKindOfsSync(e,[t])},isKindOfsSync:function(e,t){return r(e,t).isKindOf},isKindOfs:async function(e,t){let{isKindOf:i,unknownTypes:s}=r(e,t);return!i&&s.length>0&&(await n(s),i=s.some((t=>o[t]&&o[t].indexOf(e)>=0))),i},isKindOf:async function(e,t){return this.isKindOfs(e,[t])}}})),define("DS/FolderEditor/models/xTreeNodeModel",["DS/TreeModel/TreeNodeModel","DS/FolderEditor/Folder_CSO"],(function(e,t){"use strict";function o(o){e.call(this,o),t.setInfoOnTreeNode(this)}return o.prototype=Object.create(e.prototype),o})),define("DS/FolderEditor/popup/BookmarkLocationPopup",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Windows/Dialog","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/BookmarkLocationPopup","DS/Controls/TooltipModel"],(function(e,t,o,i,n,r,s,l){function a(){let e=0;if(document){let t=document.getElementsByClassName("xbook_component");t&&t.length>0&&(e=t[0].clientWidth)}return e}return e.extend({modal:null,onResize:function(){null!=this.ARWidget&&this.ARWidget.onResize()},init:function(e,d,c){this.elementsList=[],c=null!=c?c:{};var u=r.getSelectedNodes()[0].getLabel(),p=r.getCurrentBookmarkId(),h=null,g=UWA.createElement("div",{class:"bookmark_Open_Location-common-command"}),f=UWA.createElement("div",{class:"bookmark_Open_Location-common-command-div"});f.innerText=c.message,f.inject(g);let m=null,v=null,_=!1;c.radio?(m=new o({type:"radio"}),_=!0):v=UWA.createElement("ul",{class:"list-location-popup"});var S=null,C=null;let y={};for(var b=0;b<e.length;b++){let o=e[b],i=o.info[o.info.length-1],n=i.resourceid;if(y[n]=i,C=d(S=o.path.join(" \\ ")),c.radio){_=!1,0===b&&(_=!0,h=n);var E=new t({type:"radio",value:n,checkFlag:_});C.inject(E.getContent()),E.tooltipInfos=new l({longHelp:S}),m.addChild(E)}else{var D=UWA.createElement("div",{class:""}),w=UWA.createElement("li",{class:"list-element-location-popup"});w.tooltipInfos=new l({longHelp:S}),C.inject(D),D.inject(w),this.elementsList.push(D),w.inject(v)}}c.radio?(m.addEventListener("change",(function(e){var t=e.dsModel.value;h=t[0]})),m.inject(g)):v.inject(g);let I=r.getCurrentEltTypeNls();var F=c.title?c.title:s.replace(s.OpenLocation,{typeStruct:I})+" : "+u;this.dialog=new n({title:F,content:g,immersiveFrame:widget.immersiveFrame,minHeight:150,minWidth:400,modalFlag:!0,width:a()-130,resizableFlag:!0,buttons:{Ok:new i({label:c.okButtonLabel?c.okButtonLabel:"",disabled:!1,emphasize:"primary",onClick:function(t){t.dsModel.dialog.buttons.Ok.disabled=!0,c.onOkClick&&c.onOkClick({selectPathIDToNav:h,info:y[h],currNodeID:p,data:e})}}),Cancel:new i({emphasize:"secondary",onClick:function(e){e.dsModel.dialog.destroy()}})}}),this.dialog.getContent().addClassName("bookmark_Open_Location"),this.dialog.addEventListener("close",(function(e){console.log("Close on dialog : "+e.dsModel.title),e.dsModel=null}))},pushNotif:function(e){e.length!=this.elementsList.length&&console.log("/!\\ nb of notifs and nb of elements not equal.");for(var t=null,o=null,i=null,n=0;n<this.elementsList.length;n++)if(null!=e[n]){if(i=UWA.createElement("div"),"success"==e[n]&&(t=UWA.createElement("span",{class:"notif-element-location-popup green-notif",text:s.removeFromSearchNotif.success}),o=UWA.createElement("i",{class:"wux-ui-3ds-check wux-ui-3ds icon-notif-element-location-popup green-notif"})),"noChangeAllowed"==e[n]){let e=r.getCurrentEltTypeNls();t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:s.replace(s.removeFromSearchNotif.failNotAllowed,{typeStruct:e})}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})}"serverError"==e[n]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:s.removeFromSearchNotif.serverError}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),"noRelationFound"==e[n]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:s.removeFromSearchNotif.failNoRelationFound}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),o.inject(t,"top"),t.inject(i),i.inject(this.elementsList[n])}}})})),define("DS/FolderEditor/utils/BkAlert",["DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o){return{displayNotFoundBk:(i,n,r)=>{let s=o.get("msg_error_bookmarkNotFound");e.displayNotification({title:n?o.replace(s.title,{name1:n}):o.replace(s.title2,{typeStruct:t.getTreeTypeNls(r,!1)}),subtitle:o.replace(s.subtitle,{typeStruct:t.getTreeTypeNls(r,!1)}),message:s.message,id:"notFound"+i,debounce:!0,className:"error"})}}})),define("DS/FolderEditor/utils/FolderEditorWidgetLinkMngt",["DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/Folder_CSO"],(function(e,t){"use strict";class o{constructor(){this._filterOnIdMap=new Map,this._widgetLink=null}}let i={bindForLinkAndContextChange:function(e){this._widgetLink=e,this._widgetLink.addEventListener("link",this._linkWidget.bind(this)),this._widgetLink.addEventListener("unlink",this._unlinkWidget.bind(this));let t=this.widgetLink&&"function"==typeof this.widgetLink.getLinked?this._widgetLink.getLinked():[];t&&t.length>0&&t.forEach((e=>{e&&e.id&&this.addLinkedWidget(e.id)})),this._widgetLink.subscribe("ENOBookmarkEditor.contextChange",this.addLinkedId.bind(this)),this._widgetLink.subscribe("ENOBookmarkEditor.removeContext",this.removeLinkedId.bind(this))},_getLinkedWidgetsForContextChange:function(){return this._widgetLink.getLinked().filter((e=>"ENXROUT_AP"!==e.appId))},_linkWidget:function(e){e&&e.link.id&&this.addLinkedWidget(e.link.id)},_unlinkWidget:function(e){e&&e.link.id&&this.removeLinkedWidget(e.link.id)},getLinkedIds:function(){if(this._filterOnIdMap){const e=this._filterOnIdMap.values();return[...new Set([...e].flat())]}return[]},addLinkedWidget:function(e){this._filterOnIdMap.set(e,[])},removeLinkedWidget:function(t){if(this._filterOnIdMap.has(t)){let o=[],i=this._filterOnIdMap.get(t);i=Array.isArray(i)?i:[i],this._filterOnIdMap.delete(t);let n=this.getLinkedIds();i.forEach((e=>{-1===n.indexOf(e)&&o.push(e)})),o.length>0&&e.refreshWidgetContent()}},addLinkedId:function(e){let t=e&&e.data?e.data:e&&e.dropData&&e.dropData.data?e.dropData.data:null;if(t&&t.items){let e=t.linkId,o=t.items,i=[];o.forEach((t=>{t.hasOwnProperty("bookmarkRootId")&&""!=t.bookmarkRootId&&i.push(t.bookmarkRootId),!e&&t.hasOwnProperty("linkId")&&(e=t.linkId)})),this.changeLinkedIds(e,i)}},removeLinkedId:function(e){if(e&&e.dropData.data&&e.dropData.data.items){let t=e.dropData.data.items[0].linkId;this.changeLinkedIds(t,[])}else"String"==typeof e&&this.changeLinkedIds(e,[])},changeLinkedIds:function(o,i){let n=[],r=[];if(this._filterOnIdMap.has(o)){let e=this._filterOnIdMap.get(o);e=Array.isArray(e)?e:[e],this._filterOnIdMap.delete(o);let t=this.getLinkedIds();e.forEach((e=>{(i&&i.indexOf(e)>=0||-1===t.indexOf(e))&&n.push(e)})),i&&i.forEach((e=>{-1===t.indexOf(e)&&r.push(e)}))}else i&&(this._filterOnIdMap.set(o,i),r=i);i&&1===i.length&&t.dispatchBookmarkIdSelection(i[0]),this._filterOnIdMap.set(o,i),(r.length>0||n.length>0)&&e.refreshWidgetContent()}};for(let e in i)o.prototype[e]=i[e];return e.createSingleton(o)})),define("DS/FolderEditor/service/FolderEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPServicesMgr","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/utils/QueriesManager","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/SettingsHandler","UWA/Utils/Client","DS/FolderEditor/utils/FolderEditorWidgetLinkMngt"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v){"use strict";let _=null,S=null;function C(e){return UWA.is(e,"array")?e.toString():e}return{get3DSearchUrl:function(){return new Promise((function(e,t){l.get3DSearchUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}))},get3DSpaceUrl:function(){return new Promise((function(e,t){l.get3DSpaceUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}))},get3DSpaceUrlCancellable:function(){return new p((function(e,t){l.get3DSpaceUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}))},getWidgetSettings:function(){if(!this.widgetSettings){let e=f.getDefinedSections().map((e=>"sections="+e)).join("&");this.widgetSettings=new Promise(((t,o)=>{var i="/resources/v1/FolderManagement/Folder/settings?"+e;h._executeQuery(i,{type:"json",inSource:"3DSpace",withoutSC:!0},"loadSettings").then(t).catch(o)})),this.widgetSettings.catch((e=>{r.displayNotification({...o.msg_error_settings,className:"error"}),console.log(e),this.widgetSettings=null}))}return this.widgetSettings},getServiceFromSource:function(e){let t=this.getServiceMapping()[e];return t||null},getSourceFromService:function(e){let t=this.getServiceMapping(!0)[e];return t||null},getServiceMapping:function(e){let t=e?S:_;return t||{}},getServicesPromise:function(){if(!this.serviceMapping){let e="/login",t={method:"GET",type:"json",inSource:"3DSearch",withoutSC:!0};this.serviceMapping=h._executeQuery(e,t,"getservicemapping"),this.serviceMapping=this.serviceMapping.then((e=>{_={www:"www"},S={www:"www"},e.infos.sources.forEach((e=>{_[e.name]=e.service,S[e.service]=e.name})),c.setServiceMapping(S)})),this.serviceMapping.catch((e=>{r.displayNotification({message:o.msg_error_search_login,className:"error"}),console.log(e),this.serviceMapping=null}))}return this.serviceMapping},getHeadersInformations:function(){return new Promise(((e,t)=>{l.get3DSpaceUrlAsync({onComplete:t=>{var o={service:"3DSpace",serviceBaseUrl:t,tenant:l.getTenantID(),header:{SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL")}};e(o)},onFailure:()=>{t()}})}))},_getProductExpandConditions:function(){return new Promise(((e,t)=>{this.getWidgetSettings().then((t=>{let o="UPS"===t.modeler;e({types:o?["VPMReference","VPMRepReference","XCADNonPSBaseRepReference","Drawing","3DShape"]:["CATPart","CATProduct","CATIA Embedded Component","CATProcess","CATDrawing","CATAnalysis","CATShape"],noRel:["XCADBaseDependency","Reference Document"]})})).catch(t)}))},listContent_ExpandLevel_Structures:function(e){var t=l.getCancelObject();let o=this._getProductExpandConditions().then((async o=>{if(!t.isCancelled()){let l="(taxonomies:"+o.types.join(") OR (taxonomies:")+")",a="NOT (taxonomies:"+o.noRel.join(") AND NOT (taxonomies:")+")";var i=await this.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?output_format=cvjson",r={};UWA.extend(r,e);var s=new Date;let d=("listContent_ExpandLevel_Structures"+Math.random().toString(36).substring(2,9)+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");r.payload={batch:{expands:[{label:d,root:{physical_id:r.pid},graph:{descending_condition_object:{uql:l},descending_condition_relation:{uql:a}},filter:{all:1},parameters:{graph_advise:1}}]},outputs:{select_object:["physicalid"],format:"entity_relation_occurrence"}};let c=n.getCredential();r.headers={SecurityContext:c,"content-type":"application/json"},r.withSecurityToken=!0,r.type="json",r.data=UWA.Json.encode(r.payload),r.method="POST",r.timeout=12e4,t.handler=h._executeQueryWithError(i,r,"listContent_ExpandLevel_Structures")}}));return s.promiseCatcher(o),t},content:function(e){var t={};UWA.extend(t,e);var o="/resources/v1/FolderManagement/Folder/"+t.pid+"/getContent?filter="+("Yes"===t.filterChildren);return t.query={section:t.section},t.payload={},t.payload.Content="All"===t.content?"All":void 0,t.payload.select_predicate=a.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),t.method="POST",t.inSource="3DSpace",t.type="json",t.timeout=12e4,h._executeQuery(o,t,"content")},getParentPath:function(e){var t,o={};o.IDs=e.objectIds;return o.IDs&&(t=o.IDs),o.method="POST",o.inSource="3DSpace",o.type="json",o.headers={Accept:"application/json","content-type":"application/json"},o.query={section:e.section},o.payload={IDs:t,parentFolderId:"parent"},o.IDs="",o.data=UWA.Json.encode(o.payload),o.timeout=12e4,h._executeQuery("/resources/v1/FolderManagement/Folder/getParentPath",o,"getParentPath")},getRelatedBookmarks:function(e){var t={};t.contentId=e.contentId;var o="/resources/v1/FolderManagement/Folder/"+t.contentId+"/getRelatedBookmarks";return t.type="json",t.method="GET",t.inSource="3DSpace",t.headers={Accept:"application/json"},h._executeQuery(o,t,"getRelatedBookmarks")},roots:function(e){var t=e;t.method="POST",t.inSource="3DSpace",t.query={section:t.section},t.payload={},t.payload.Type="Personal Workspace"==t.type?"Personal":t.type,t.payload.CollabSpace=t.collabSpace,t.payload.select_predicate=a.getAuthAttributes();let o=v.getLinkedIds();return o&&o.length>0&&(t.payload.explicitRoots=o),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),t.type="json",t.timeout=12e4,h._executeQuery("/resources/v1/FolderManagement/Folder/roots",t,"roots")},getTreeOrder:function(e){var t,o=e;return o.IDs&&(t=o.IDs),o.method="POST",o.inSource="3DSpace",o.type="json",o.headers={Accept:"application/json","content-type":"application/json"},o.query={},o.payload={IDs:t,parentFolderId:o.parentId},o.IDs="",o.data=UWA.Json.encode(o.payload),o.timeout=12e4,h._executeQuery("/resources/v1/FolderManagement/Folder/treeOrder",o,"treeOrder")},allBookmarks:function(e){let t=f.getDefaultSection(),o=f.getRoots(t).map((e=>`(type:${e})`)).join(" OR "),i=v.getLinkedIds();return i&&i.length>0&&(o+=" AND physicalid:("+i.join(" OR ")+")"),e.start||(e.start=0),e.fetchAll=!0,e.noIcon=!0,this._performSearchQuery({...e,section:t},o,"allBookmarks")},fetchIndexAttributes:function(e){let t=e.idsPerAttrAndService,o=e.searchQuery;o=o?o+" AND ":"";let i=o.length,n=[];for(let e in t){let o=t[e];for(let t in o){let r=this.getSourceFromService(t);h.splitIdForSearch(e,o[t],i).forEach((e=>{n.push({query:e,sourceId:r})}))}}return new u({maxThreadNumber:4,datas:n,fcn:t=>this._performSearchQuery({...e,sourceId:t.sourceId,fetchAll:!0},o+t.query,"fetchAttrs")}).execute()},_performSearchQuery:function(e,t,o){var r={};UWA.extend(r,e);r.payload=Object.assign({},a.getSearchInfo()),r.select_predicate?r.payload.select_predicate=r.select_predicate:r.payload.select_predicate=r.payload.select_predicate,r.select_synthesis&&(r.payload.select_synthesis=r.select_synthesis);var s=new Date,l=Math.random().toString(36).substring(2,9);r.payload.label=("BookmarkSearch_"+o+l+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var d=widget.lang?widget.lang:widget.getValue("lang");r.payload.locale=d,r.payload.query=t,r.payload.tenant=i.getPlatformId(),e.fetchAll||(r.payload.next_start=e.next_start,r.payload.start=e.start),e.noIcon&&(r.payload.select_file=void 0),r.payload.source=[e.sourceId?e.sourceId:"3dspace"];var c=n.getCredential();return c&&(r.payload.login={"3dspace":{SecurityContext:c}}),r.method="POST",r.inSource="3DSearch",r.headers={"content-type":"application/json"},r.withoutSC=!0,r.type="json",e.order_field&&(r.payload.order_field=e.order_field,r.payload.order_by=e.order_by),e.searchPageCount&&(r.payload.nresults=e.searchPageCount),!0===e.fetchAll&&(r.payload.nresults=1e3),r.filters&&Object.keys(r.filters).length>0&&(r.payload.refine=r.filters),r.data=UWA.Json.encode(r.payload),h._executeQuery("/search",r,"searchInLibrary")},addExternalLink:function(e){return this.addExternalObject({id:e.id,objects:[g.getDefaultModelFromProperties({i3dx:e.url,serviceId:"www",label:e.urlTitle})]})},moveExternalObject:function(e){var t=e;let o=t.id,i=t.members;var n="/resources/v1/FolderManagement/Folder/"+o+"/movelinkedcontents";return t.headers={Accept:"application/json","content-type":"application/json"},t.method="POST",t.inSource="3DSpace",t.type="json",t.payload={members:i},t.data=UWA.Json.encode(t.payload),t.timeout=12e4,h._executeQuery(n,t,"moveExternalLink")},addExternalObject:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.id+"/addlinkedcontent";return t.headers={Accept:"application/json","content-type":"application/json"},t.method="POST",t.inSource="3DSpace",t.type="json",t.payload={data:{items:[]}},e.objects.forEach((e=>{let o={serviceId:e.getAttributeValue("serviceId"),objectId:e.getAttributeValue("i3dx")||e.getAttributeValue("uri"),displayName:"www"===e.getAttributeValue("serviceId")?e.getLabel():""};t.payload.data.items.push(o)})),t.data=UWA.Json.encode(t.payload),t.timeout=12e4,h._executeQuery(o,t,"addExternalObject")},getLinks:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/getlinkedcontent";return t.type="json",t.method="GET",t.inSource="3DSpace",t.headers={Accept:"application/json"},h._executeQuery(o,t,"getlinkedcontent")},getlinkProperties:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/getlinkProperties";return t.type="json",t.method="GET",t.inSource="3DSpace",t.headers={Accept:"application/json"},h._executeQuery(o,t,"getlinkProperties")},editLink:function(e){var t=e;return t.headers={Accept:"application/json","content-type":"application/json"},e.securityContext&&(t.headers.SecurityContext=e.securityContext,t.withoutSC=!0),t.method="POST",t.type="json",t.inSource="3DSpace",t.payload={},t.payload={members:t.members,selectdata:{}},t.urlTitle&&(t.payload.selectdata.appdata=t.urlTitle),t.url&&(t.payload.selectdata.uri=t.url),t.data=UWA.Json.encode(t.payload),t.timeout=12e4,h._executeQuery("/resources/v1/FolderManagement/Folder/editlinkedcontent",t,"editlinkedcontent")},removeExternalLink:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.id+"/removelinkedcontent";return t.headers={Accept:"application/json","content-type":"application/json"},t.method="POST",t.inSource="3DSpace",t.type="json",t.payload={},t.payload={members:e.members},t.data=UWA.Json.encode(t.payload),t.timeout=12e4,h._executeQuery(o,t,"removelinkedcontent")},AddBookmarkShortcut:function(e){var t=e;return t.payload={},t.payload.input_physical_ids={sourceID:e.ObjetcID,targetID:e.TargetFolderID},t.type="json",t.method="POST",t.inSource="3DSpace",t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),t.timeout=12e4,h._executeQuery("/resources/v1/FolderManagement/Folder/AddBookmarkShortcut",t,"roots")},DownloadFolderStructure:async function(e){var t=e;let o=await this.get3DSpaceUrl();var i=o+"/resources/v1/FolderManagement/Folder/FolderDownloadPost";return t.headers={"content-type":"application/json"},t.method="POST",t.data={physicalId:t.pid,FCSurl:o},t.data=UWA.Json.encode(t.data),t.timeout=12e4,h._executeQuery(i,t,"FolderDownloadPost")},async _findBookmarksInBookmark(e){const t=`${await this.get3DSpaceUrl()}/cvservlet/progressiveexpand/v2?output_format=cvjson`,o=`FindInBookmark_${Math.random().toString(36).substring(2,9)}_${(new Date).getTime()}`.replace(/[\s,\/]/g,(e=>" "===e?"_":","===e?"":"-"));"string"==typeof e.pid&&(e.pid=[e.pid]);let i=e.treeNode.section,r=f.getExpandDefinition(i).sub.rels.map((e=>`(taxonomies:${e})`)).join(" OR ");var s;e.searchFTSquery?s=e.pid.map(((t,i)=>({label:`${o}_${i}`,root:{physical_id:t},parameters:{graph_advise:1,limit_max_path:101},graph:{descending_condition_relation:{uql:r}},filter:{sequence_filter:{sequence:[{uql:`[ds6w:label]:(*${e.searchFTSquery}*)`}]}},aggregation_processors:[{truncate:{compute_matching_subpaths_lengths:1,sequence_filter:{sequence:[{uql:`[ds6w:label]:(*${e.searchFTSquery}*)`}]}}}]}))):e.rscIdToSearch&&(s=e.pid.map(((t,i)=>({label:`${o}_${i}`,root:{physical_id:t},parameters:{graph_advise:1,limit_max_path:101},graph:{descending_condition_relation:{uql:r}},filter:{sequence_filter:{sequence:[{uql:`(physicalid:${e.rscIdToSearch})`}]}},aggregation_processors:[{truncate:{compute_matching_subpaths_lengths:1,sequence_filter:{sequence:[{uql:`(physicalid:${e.rscIdToSearch})`}]}}}]}))));const l={batch:{expands:s},outputs:{select_object:a.getIndexPredicateForTree(),select_relation:a.getIndexRelPredicateForTree(),hits:{predefined_computation:["icons"]},format:"entity_relation_occurrence",matching_lengths:1}},d={...e,payload:l,headers:{SecurityContext:n.getCredential(),"content-type":"application/json"},type:"json",data:JSON.stringify(l),method:"POST",timeout:12e4};return h._executeQueryWithError(t,d,"_findBookmarksInBookmark")},getToolbar:function(){return h._executeQuery("/resources/v1/FolderManagement/Folder/toolsCommands",{method:"GET",inSource:"3DSpace",type:"json",withoutTenant:!0,withoutSC:!0,query:{touch:m.Features.touchEvents&&!m.Features.pointerEvents,activeFolder:d.isActiveBookmarkActivated(),importCSV:d.isImportCSVActivated(),customizedEnv:d.isCustomizedEnv(),readOnly:1==widget.launchWithReadMode},headers:{Accept:"text/xml,application/json",SecurityContext:void 0}},"commands")},getActionBar:function(e){return l.get3DSpaceUrlAsync({onComplete:function(t){var o=e,i=t+"/resources/v1/FolderManagement/Folder/commands";o.query={touch:m.Features.touchEvents&&!m.Features.pointerEvents,activeFolder:d.isActiveBookmarkActivated(),importCSV:d.isImportCSVActivated(),customizedEnv:d.isCustomizedEnv()},o.method="GET",o.headers={Accept:"text/xml,application/json"},o.withoutSC=!0,h._executeRequest(i,o,"commands")}})},folders:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/folders";return t.query={Level:t.level},t.method="GET",t.inSource="3DSpace",h._executeQuery(o,t,"folders")},folderTree:async function(e){var t=e;var o=await this.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+(t.pid||"root")+"/folderTree";t.headers={"content-type":"application/json"},t.query={section:t.section},t.data={expandList:C(t.expandList),level:t.level&&t.level+"",isRoot:t.isRoot?"true":""},t.explicitRoots&&t.explicitRoots.length>0&&(t.data.explicitRoots=t.explicitRoots);let i=v.getLinkedIds();if(i&&i.length>0&&t.isRoot&&(t.data.explicitRoots=i),t.partialExpandList&&t.partialExpandList.length>0&&(t.data.partialExpandList=t.partialExpandList),1==e.Read){t.data.Read=!0,t.data.nresults=a.getResultsCount(c.ROOTS_PER_PAGE);var n=e.sort?e.sort:{};t.data.sortOrder=n.sortOrder,t.data.sortMode="alpha"==n.sortMode?"ds6w:label":"ds6w:modified",t.data.nextStart=t.nextStart,t.data.refine=t.refine}else t.data.Read=!1;t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,h._executeRequest(o,t,"folderTree")},removecontent:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/removecontent";return t.headers={"content-type":"application/json"},t.IDs&&(t.data={IDs:C(t.IDs),isLinkedFolder:!0===t.isLinkedFolder?"TRUE":"FALSE"},t.data=UWA.Json.encode(t.data)),t.type="json",t.method="POST",t.inSource="3DSpace",t.timeout=12e4,h._executeQuery(o,t,"removeContent")},replaceContent:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/replacebycontent";return t.headers={"content-type":"application/json"},t.IDsRemoved&&t.IDsAdded&&(t.data={IDsRemoved:C(t.IDsRemoved),IDsAdded:C(t.IDsAdded)},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.inSource="3DSpace",t.timeout=12e4,h._executeQuery(o,t,"replaceContent")},getlastversion:function(e){var t=e;t.headers={"content-type":"application/json"};var o=t.objectsToTreat;return o&&(t.data=o),t.data=UWA.Json.encode(t.data),t.method="POST",t.inSource="3DSpace",t.timeout=12e4,h._executeQuery("/resources/v1/dslc/getlastversions?validIntents=E&",t,"getlastversion")},addcontent:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/content";if(t.headers={"content-type":"application/json"},t.IDs){var i=this._deduplicateContentId(t.IDs);t.data={IDs:C(i),fetchAttributes:e.fetchAttributes,opLinkedFolders:e.areLinkedFolders},t.data=UWA.Json.encode(t.data)}return t.inSource="3DSpace",t.method="POST",t.type="json",t.timeout=12e4,h._executeQuery(o,t,"addContent")},movecontent:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/content";return t.headers={"content-type":"application/json"},t.IDs&&t.SourceFolderId&&(t.data={checkSourceRelation:e.checkSourceRelation,IDs:C(t.IDs),SourceFolderId:t.SourceFolderId,opLinkedFolders:e.areLinkedFolders},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.inSource="3DSpace",t.type="json",t.timeout=12e4,h._executeQuery(o,t,"moveContent")},checkCopyfolder:function(e){var t=e,o="/resources/v1/FolderManagement/Folder";return t.headers={"content-type":"application/json"},t.PhysicalId&&(o+="/checkCount",t.data={physicalIds:C(t.PhysicalId)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.inSource="3DSpace",t.timeout=12e4,h._executeQuery(o,t,"copyFolder")},copyfolder:function(e){var t=e,o="/resources/v1/FolderManagement/Folder";t.headers={"content-type":"application/json"};let i=t.TargetPhysicalId?t.TargetPhysicalId:"root";return t.TargetPhysicalId=i,i&&t.PhysicalId&&(o+="/"+i,t.data={physicalIds:C(t.PhysicalId)},e.hasOwnProperty("withContent")&&(t.data.withContent=e.withContent),e.hasOwnProperty("prefix")&&(t.data.prefix=e.prefix),e.hasOwnProperty("suffix")&&(t.data.suffix=e.suffix),t.data=UWA.Json.encode(t.data)),t.method="POST",t.inSource="3DSpace",t.timeout=12e4,h._executeQuery(o,t,"copyFolder")},getFolderProperties:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/properties";return t.method="GET",t.inSource="3DSpace",t.type="json",h._executeQuery(o,t,"getFolderProperties")},getFavoritesProperties:function(e){var t=e;t.method="POST",t.inSource="3DSpace",t.headers={"content-type":"application/json"};var o={physicalids:t.phids};return t.data=JSON.stringify(o),h._executeQuery("/resources/v1/FolderManagement/Folder/favoritesInformation",t,"getFavoritesProperties")},getContentProperties:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/ContentProperties";return t.method="POST",t.inSource="3DSpace",t.payload={},t.payload.select_predicate=a.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),h._executeQuery(o,t,"getContentProperties")},setFolderProperties:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/update";return t.method="POST",t.inSource="3DSpace",t.headers={"content-type":"application/json"},t.query={section:t.section},t.type="json",t.data=UWA.Json.encode(t.properties),h._executeQuery(o,t,"setFolderProperties")},movefolder:function(e){var t=e,o="/resources/v1/FolderManagement/Folder";return t.headers={"content-type":"application/json"},t.TargetPhysicalId&&t.PhysicalId&&(o+="/"+t.TargetPhysicalId,t.data={physicalIds:C(t.PhysicalId)},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.inSource="3DSpace",t.timeout=12e4,h._executeQuery(o,t,"moveFolder")},getFolderPath:function(e){var t=e;return t.headers={"content-type":"application/json"},t.pids&&(t.data={folderIds:C(t.pids)},t.data=UWA.Json.encode(t.data)),t.query={section:t.section},t.method="POST",t.inSource="3DSpace",t.type="json",t.timeout=12e4,h._executeQuery("/resources/v1/FolderManagement/Folder/path",t,"getFolderPath")},newFolder:function(e){var t=e;t.method="POST",t.inSource="3DSpace",t.type="json",t.headers={"content-type":"application/json"};let o=e.parentBookmarkId&&""!==e.parentBookmarkId?e.parentBookmarkId:void 0,i=JSON.stringify({members:[{parentId:o||void 0,title:e.title?e.title:void 0,description:e.description?e.description:void 0}]});return t.data=i,t.forcedSecurityContext&&(0!=t.forcedSecurityContext.indexOf("ctx::")&&(t.forcedSecurityContext="ctx::"+t.forcedSecurityContext),t.headers.SecurityContext=t.forcedSecurityContext),h._executeQuery("/resources/v1/FolderManagement/Folder/create",t,"newBookmark")},transferOwnership:function(e){var t=e;t.inSource="3DSpace",t.method="POST",t.type="json",t.withCSRF=!0,t.headers={"content-type":"application/json"};var i={owner:e.user,data:[{id:e.objectId}]};return t.data=JSON.stringify(i),t.formatError=function(t){let i=t.serverErr;return t.serverErr=i=i||{},i.message=i.message?i.message:i.errorMessage,i.title=o.replace(o.cannotChangeOwner,{objectname:e.label,userId:e.user}),t},h._executeQuery("/resources/v1/modeler/dslc/ownership/transfer",t,"transferOwnership")},personSearch:function(e){var t=e;return t.query={searchStr:t.name},t.method="GET",t.inSource="3DSpace",h._executeQuery("/resources/v2/e6w/service/PersonSearch",t,"personSearch")},_deduplicateContentId:function(e){var t=[],o=[];return null!=e&&Array.isArray(e)&&e.forEach((function(e){o.indexOf(e)<0&&(o.push(e),t.push(e))})),t},checkConnectionAccess:function({bookmarkId:e}){let t={};var o="/resources/v1/FolderManagement/Folder/checkConnectAccess?id="+e;return t.type="json",t.method="GET",t.inSource="3DSpace",t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),h._executeQuery(o,t,"checkConnectionAccess")},findCSLInBookmarks:function(e){let t={method:"POST",inSource:"3DSpace",type:"json",headers:{Accept:"application/json","content-type":"application/json"},payload:e,timeout:12e4,data:UWA.Json.encode(e)};return h._executeQuery("/resources/v1/FolderManagement/Folder/getCSLBookmarks",t,"getCSLBookmarks")}}})),define("DS/FolderEditor/commands/PLMNewFolderCmd",["UWA/Core","DS/IPClassifyUtil/IPClassifyAlert","DS/ENONewWidget/command/NewContentCommandBase","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderSearch","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal"],(function(e,t,o,i,n,r,s,l,a){"use strict";return o.extend({_newType:"Workspace Vault",_commandName:i.newBookmark_typeNls,_localContext:null,underExecution:!1,labelTopBar:"",activeTopBar:!0,init:function(e){var o=this;this._parent({...e},{mode:"exclusive",isAsynchronous:!0}),this._setCommandEnableStatus(),this._menuItem=null;try{require(["DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/Menu","DS/TopBarProxy/MenuItem"],(function(e,n,r){var s=new e({id:widget.id}),a=new r({label:i.label_title_NewBookmark,onExecute:function(){l.isSearchActive()?t.displayNotification({...i.msg_warning_searchOpen,className:"error"}):o.executeTopBar()}});o._menuItem=a,s.addContent({add:o._menuItem})}))}catch(e){console.log("can't load top bar")}},_setCommandEnableStatus:function(){var e=this;e._localContext=e.options.context,null!=e._localContext&&"function"==typeof e._localContext.getEditMode&&(!0!==e.options.context.getEditMode()&&e.disable(),e.options.context.addEvent("editModeModified",(function(t){!0===t?e.enable():e.disable()})))},getType:function(){return this._newType},getCreationDialogParameters:function(){var o=this;s.getHeadersInformations().then((n=>{var s=[r.getCurrentBookmarkId()],l="";let a="Workspace Vault";0==s.length?a="Workspace":"FolderSection_AllFolders"===(l=s[0])&&(l="",a="Workspace"),this._newType=a;var d={type:a,notification:!0,events:{onSuccess:async function(n){o.underExecution=!1,t.displayNotification({message:i.msg_NewBookmarkSuccess.message,className:"success"}),await new Promise((e=>setTimeout(e))),n=e.is(n,"string")?JSON.parse(n):n,o._localContext.addRoots({pids:[n.result[0].identifier]})},onFailure:function(e){o.underExecution=!1,console.log(e)},onCancel:function(e){o.underExecution=!1,o.hideModalLoader(),console.log(e)}},silentMode:!1,viewType:"listView",options:{},activeTopBar:!0,labelTopBar:i.label_title_NewBookmark,commandName:this._commandName,context:n};l.length>0&&(d.options={parentPIDs:[l]}),this.launchCreateNew(d)}))},executeTopBar:function(){this.execute()},execute:function(){var e=this;this.underExecution||(this.underExecution=!0,this.showModalLoader(),require(["DS/ENONewWidget/ENONew/Events"],(function(t){t.addEvent("onCreationDialogAction",(function(t){t&&"ready"===t.action&&e.hideModalLoader()}))})),this.getCreationDialogParameters())},hideModalLoader:function(){a.removeComponentToLoad("global","new")},showModalLoader:function(){a.addComponentsToLoad("global",{new:i.New_Loading})}})})),define("DS/FolderEditor/tagger/TaggerContentProxy",["DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUXUtil/tagger/TaggerIPProxy"],(function(e,t,o,i,n,r){return i.createSingleton(class extends r{constructor(){super(e,{name:"Content",colorize:!0,exclude:!0,events:{addColorizeListener:e=>{this.filterBIColorize.call(this,e)},addUnColorizeListener:e=>{this.onFilterBIUnColorize.call(this,e)}}}),this._colorActives=null,this.activate(!0),o.onTaggerStatusChange((()=>{this.activate(!i.isTreeTaggerActive())}))}setTableFilter(e){this._tableFilter=e}getTableFilter(){return this._tableFilter}addObjectsTags(e,t){var o=super.addObjectsTags(e,t);return o.catch((()=>{console.log("Can retrieve objects Tags")})),o}updateColorNodes(e){let o=e||this._nodesToColorize;if(this._nodesToColorize={...o},this.isActive()&&o&&Object.keys(o).length>0&&this._colorActives&&this.facetsComputationActives()){let e={};var i=this._colorActives;for(let t=0;t<i.length;++t){let o=i[t].object,n=i[t].color;e[o]=n}t.fetchIndexAttributes({idsPerAttrAndService:o,select_predicate:i[0].predicate,select_synthesis:i[0].predicate}).then((t=>{let o=!1;t.forEach((t=>{let n=t.results;if(n&&this._colorByNodes)for(let t=0;t<n.length;++t){let r=n[t].attributes,s=null,l=[];for(let t=0;t<r.length;++t)"resourceid"===r[t].name?s=r[t].value:-1!==i[0].predicate.indexOf(r[t].name)&&l.push(e[r[t].value]);l.length>1?this._colorByNodes[s]="linear-gradient(0deg in hsl longer hue, lightgreen, blue)":1===l.length?this._colorByNodes[s]=l[0]:this._color=null,o=!0}})),o&&this._model.publish({event:"nodeColorUpdated",data:{}})})).catch((e=>{console.log("Failure during fetch of ID's for colorize")}))}}facetsComputationActives(){return super.facetsComputationActives()&&n.getSetting("activateBIFilter")}getCellKPIColor(e){var t=null;if(this.isActive()&&this._colorByNodes){var o=e.nodeModel.getID(),i=this._colorByNodes[o];t=i||"transparent"}return t}filterBIColorize(e){e&&e.tagColors&&!(e.tagColors.length<=0)&&e.tagColors[0].predicate&&this._isActive&&(this._colorByNodes={},this._colorActives=e.tagColors,this.updateColorNodes())}onFilterBIUnColorize(){this._colorByNodes=null,this._colorActives=null,this._model.publish({event:"nodeColorUpdated",data:{}})}})})),define("DS/FolderEditor/service/FolderEditorWebServiceReadMode",["DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPServicesMgr","DS/WidgetServices/WidgetServices","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/utils/SettingsHandler","UWA/Core","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/IPClassifyUXUtil/CredentialsView","DS/FolderEditor/utils/FolderEditorWidgetLinkMngt"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p){"use strict";let h=null,g=["physicalid","ds6w:globalType","ds6w:type","ds6w:label","ro.plminstance.V_treeorder"];function f(){var t=o.getWidgetValue("appId");return(t=t||o.getWidgetValue("x3dAppId"))+"-"+e.getUserId()+"-"+(new Date).getTime()}function m(e){return`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")}`}function v(e){let t=[],o={};for(let i in e){let n=e[i],r="label"===i?"ds6w:label":i;if(n.filterModel){let e=[],i=[],l=[],a=[],d=[],c=[],u="or";if(Array.isArray(n.filterModel)&&n.filterModel.length>0)n.filterModel.forEach((t=>{if(n.filterOptions&&n.filterOptions.filterTags){let e=n.filterOptions.filterTags.find((e=>e.sources.some((o=>s.getServiceFromSource(o)+"::"+e.object===t)))),i=e&&e.sixw?e.sixw:null;if(i){let t=o[i];t||(t=o[i]=[]),t.push(e)}}else t="string"==typeof t?`"${t.replace(/^[^:]*::/,"")}"`:t,e.push(t)}));else if(n.filterId.startsWith("date")||n.filterId.startsWith("number")){let t=n.filterId.startsWith("date")?m:e=>e;for(let o in n.filterModel)if("operator"!==o){let r=n.filterModel[o];switch(r.type){case"range":a.push(`${t(r.filter[0])}`),d.push(`${t(r.filter[1])}`);break;case"equal":e.push(`${t(r.filter)}`);break;case"notEqual":c.push(`${t(r.filter)}`);break;case"lessThan":l.push(`${t(r.filter)}`);break;case"lessThanOrEqual":d.push(`${t(r.filter)}`);break;case"greaterThan":i.push(`${t(r.filter)}`);break;case"greaterThanOrEqual":a.push(`${t(r.filter)}`);break;case"empty":e.push('""');break;case"notEmpty":c.push('""')}}u=n.filterModel.operator?n.filterModel.operator:u}else if(n.filterId.startsWith("string")&&Object.keys(n.filterModel).length>0){for(let t in n.filterModel)if("operator"!==t){let o=n.filterModel[t];switch(o.type){case"contains":e.push(`"*${o.filter}*"`);break;case"notContain":c.push(`"*${o.filter}*"`);break;case"empty":e.push('""');break;case"notEmpty":c.push('""');break;case"equal":e.push(`"${o.filter}"`);break;case"notEqual":c.push(`"${o.filter}"`);break;case"startsWith":e.push(`"${o.filter}*"`);break;case"endsWith":e.push(`"*${o.filter}"`)}}u=n.filterModel.operator?n.filterModel.operator:u}let p=[];i.length>0&&p.push(`[${r}]>(${i.join("or"===u?" OR ":" AND ")})`),l.length>0&&p.push(`[${r}]<(${l.join("or"===u?" OR ":" AND ")})`),a.length>0&&p.push(`[${r}]>=(${a.join("or"===u?" OR ":" AND ")})`),d.length>0&&p.push(`[${r}]<=(${d.join("or"===u?" OR ":" AND ")})`),e.length>0&&p.push(`[${r}]:(${e.join("or"===u?" OR ":" AND ")})`),c.length>0&&p.push(`[${r}]:NOT(${c.join("or"!==u?" OR ":" AND ")})`),p.length>0&&t.push(p.map((e=>`(${e})`)).join("or"===u?" OR ":" AND "))}}return{uql:t.map((e=>`(${e})`)).join(" AND "),refine:o}}function _(e){let t=null;if(e){let o=[];for(let t in e){let i=e[t];if(i&&i.length>0&&Array.isArray(i)){let e=[],n=[];i.forEach((t=>{if(t.object){let o=!0===t.excluded?n:e,i=t.object;if(!t.type||"string"===t.type)if(Array.isArray(i)){let e=[];i.forEach((t=>{e.push(t.replace("/","_47_"))})),i=e.join("/"),o.push(i+"/*")}else i=i.replace("/","_47_");o.push(i)}}));let r=t.split("/"),s=r[r.length-1];e.length>0&&o.push("["+s+']:("'+e.join('" OR "')+'")'),n.length>0&&o.push("NOT(["+s+']:("'+n.join('" OR "')+'"))')}}t=o.join(" AND ")}return t}function S(e,t,o){var i=new Date;let n=(e+Math.random().toString(36).substring(2,9)+"_"+i.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),r=[];o=o||{};let s=0;for(let e in t){let i=t[e].paths.map((e=>({physical_id_path:e})));s++;let l=[{prefix_filter:{prefix_path:i}}];if(o.filters){let e=_(o.filters);e&&l.push({sequence_filter:{sequence:[{uql:e}]}})}let a=[];o.level>=0&&i.length>0&&a.push({truncate:{max_distance_from_prefix:o.level,prefix_filter:{prefix_path:i}}});let d=o.max_output_paths?o.max_output_paths:null;if(o.findIn&&o.findIn.query){d=d||301;let e={sequence:[{uql:o.findIn.query}]};l.push({sequence_filter:e}),a.push({truncate:{max_distance_from_prefix:0,compute_matching_subpaths_lengths:1,match_only_refs:1,sequence_filter:e}})}let c={label:n+"_"+s,root:{physical_id:e}};l.length>0&&(c.filter={and:{filters:l}}),a.length>0&&(c.aggregation_processors=a),d&&(c.parameters={limit_max_path:d}),o.graph&&(c.graph=o.graph),r.push(c)}let l={batch:{expands:r},outputs:{select_object:o.select_object?o.select_object:["physicalid"],select_relation:o.select_relation?o.select_relation:["physicalid"],format:"entity_relation_occurrence"}};return l.outputs.select_object.push("cestamp"),l.outputs.select_relation.push("cestamp"),o.findIn&&o.findIn.query&&(l.outputs.matching_lengths=1),o.withIcons&&(l.outputs.hits={multivalues_in_arrays:1,predefined_computation:["icons"]}),l}function C(e,t,o,i,n){let r=[{truncate:{max_distance_from_prefix:1,prefix_filter:{prefix_path:[{physical_id_path:[o.pid]}]}}}];return n&&r.push({synthesis:{name:"xSynth",mode:"tree_leaf",group_by_facet:1,synthesis_only:1,exclude_root_from_count:!0}}),{label:e,root:{physical_id:o.pid},graph:{descending_condition_relation:{uql:t}},filter:y(i,o.pid,t),parameters:{graph_advise:1,limit_max_path:n||o.noSizeLimit?0:l.MAX_NUMBER_EXPAND},aggregation_processors:r}}function y(e,t,o){return e?{sequence_filter:{sequence:[{statement:"BEGIN"},{uql:"physicalid:"+t},{statement:"NEXT"},{uql:o},{statement:"NEXT"},{uql:e}]}}:{all:1}}return d.extend(s,{getFilteredContent:function(e){var t={};d.extend(t,e);var o="/resources/v1/FolderManagement/Folder/"+t.pid+"/cloudViewContent?filter=true&bookmarks=false";return t.payload={},t.payload.select_object=n.getIndexPredicates(),t.headers={"content-type":"application/json"},t.data=d.Json.encode(t.payload),t.query={section:t.section},t.method="POST",t.inSource="3DSpace",t.type="json",t.timeout=12e4,c._executeQuery(o,t,"content")},searchInFolder:function(e){var o={};d.extend(o,e);var r=null;if(e.pid){if(Array.isArray(e.pid)&&e.pid.length>200)return Promise.reject({serverErr:{error:{type:"warning",errorCode:"innerError",errorMessage:Nls.msg_warning_LimitInCtxSearchOnAllBookmarks}}});if(e.searchQuery&&e.searchQuery.length<3)return Promise.reject({serverErr:{error:{type:"warning",errorCode:"innerError",errorMessage:Nls.replace(Nls.SearchEnterMoreThan,{minNumber:3})}}});var s=a.isRootSection(e.type)?e.searchQuery:e.searchQuery+" AND NOT(physicalid:"+e.pid+")";let m=e.tableFilter,_=null;if(m){let e=v(m);e.uql&&(s+=" AND "+e.uql),_=e.refine}var l=widget.lang?widget.lang:widget.getValue("lang");if(o.payload=Object.assign({},n.getSearchInfo()),o.payload.query=s,o.payload.tenant=t.getPlatformId(),o.payload.locale=l,o.payload.label="searchIn_"+f(),o.payload.source=["3dspace"],!0!==o.synthesis){o.payload.select_predicate=n.getIndexPredicates(),o.payload.with_synthesis=e.with_synthesis?"true":"false";let t=n.getResultsCount();t&&(o.payload.nresults=t),o.payload.next_start=void 0,o.payload.start=void 0,o.payload.select_predicate=n.getIndexPredicates(),e.order_field&&(o.payload.order_field=e.order_field,o.payload.order_by=e.order_by);var h=n.getInfoIndex();null==h||e.searchingInRoot?e.searchingInRoot&&!e.isFirstSearch?o.payload.next_start=e.next_start:o.payload.start=0:o.payload.next_start=h.next_start}let S=a.getSearchRelations(e.section);var g=u.getCredential();g&&(o.payload.login={"3dspace":{SecurityContext:g}});let C=p.getLinkedIds();a.isRootSection(e.type)?o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:C&&C.length>0?C:e.pid,type_filter_rel:S}}}}:o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_rel:S}}}};let y=o.filters;(y&&Object.keys(y).length>0||_)&&(y=y||{},_=_||{},o.payload.refine=i.mergeRefineTags(y,_)),o.method="POST",o.inSource="3DSearch",o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l},o.type="json",o.data=d.Json.encode(o.payload),o.withoutSC=!0,o.timeout=12e4,r=c._executeQuery("/search",o,"searchInFolder")}return r},fetch:function(e){var t={};d.extend(t,e);var i=e.ids,n=null;if(i.length){var r=o.getLanguage(),s={physicalid:i,label:f()};t.fetchThumbnails&&(s.select_file=["thumbnail_2d","icon"]),t.select_predicate&&(s.select_predicate=t.select_predicate),t.query={tenant:e.tenant};u.getCredential();t.method="POST",t.inSource="3DSpace",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r},t.withSecurityToken=!0,t.type="json",t.data=d.Json.encode(s),t.withoutSC=!0,n=c._executeQuery("/cvservlet/fetch/v2",t,"loadThumbnails")}return n},loadThumbnails:function(e){return e.fetchThumbnails=!0,this.fetch(e)},getContentReadMode:function(e){var o={};d.extend(o,e);let i=e.tableFilter,r="NOT(flattenedtaxonomies:("+a.getOOTBTreeTypes(e.section).map((e=>'"types/'+e+'"')).join(" OR ")+"))";if(o.payload={},o.payload.query="NOT(physicalid:"+e.pid+")"+("All"===e.content?"":"AND "+r),e.exceptIds&&e.exceptIds.length>0&&(o.payload.query+=" AND NOT(physicalid:"+e.exceptIds.join(") AND NOT(physicalid:")+")"),i){let e=v(i).uql;e&&(o.payload.query+=" AND "+e)}if(o.payload.query.length>8e3)throw Notif,"MaxNumberOfCharactersExceeded";var s=new Date,l=Math.random().toString(36).substring(2,9);if(o.payload.label=("Folder_getContentReadMode"+l+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),!0!==o.synthesis){o.payload.select_predicate=n.getIndexPredicates(),o.payload.with_synthesis="false",null!==e.next_start?o.payload.next_start=e.next_start:o.payload.start=0,o.payload.nresults=n.getResultsCount(),o.payload.select_file=["icon","thumbnail_2d"];var p=e.sortModel;p&&o.payload.select_predicate.indexOf(p.dataIndex)>-1&&(o.payload.order_by=p.sort,o.payload.order_field=p.dataIndex)}else o.payload.label="tags_"+o.payload.label;var h=widget.lang?widget.lang:widget.getValue("lang");return o.filters&&Object.keys(o.filters).length>0&&(o.payload.refine=o.filters),o.payload.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0,with_relationship_search:!1},search_in_context:{expand:{root_physicalid:e.pid,expand_iter:"1",type_filter_rel:a.getExpandRelations(e.section)}}}},o.payload.locale=h,o.payload.tenant=t.getPlatformId(),o.payload.source=["3dspace"],o.payload.with_indexing_date="false",o.payload.login={"3dspace":{SecurityContext:u.getCredential()}},o.headers={"content-type":"application/json"},o.data=d.Json.encode(o.payload),o.method="POST",o.inSource="3DSearch",o.timeout=12e4,o.type="json",c._executeQuery("/search",o,"getContentReadMode")},getRoots:function(e){var o={};d.extend(o,e);o.payload={},o.payload.select_predicate=e.predicates?e.predicates:["ds6w:label","physicalid","mxid","ds6w:type","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:status","ds6w:description","ds6w:responsible","ds6w:modified","ds6w:created","ds6w:identifier","ds6w:reservedBy","flattenedtaxonomies"];var i=new Date,r=Math.random().toString(36).substring(2,9);if(o.payload.label=("Folder_read_getRoots"+r+"_"+i.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),!0!==o.synthesis_only){let t=e.sortModel;e.contentView?(t&&o.payload.select_predicate.indexOf(t.dataIndex)>-1&&(o.payload.order_by=t.sort,o.payload.order_field=t.dataIndex),o.payload.select_predicate=e.predicates?e.predicates:n.getIndexPredicates(),e.next_start?o.payload.next_start=e.next_start:o.payload.start=0,o.payload.nresults=n.getResultsCount(l.ROOTS_PER_PAGE)):(o.payload.order_by=t.sortOrder,o.payload.order_field="alpha"==t.sortMode?"ds6w:label":"ds6w:modified",o.payload.start=e.next_start,o.payload.nresults=n.getResultsCount(l.ROOTS_PER_PAGE)),o.payload.select_file=["icon","thumbnail_2d"]}else o.payload.label="tags_"+o.payload.label;o.filters&&Object.keys(o.filters).length>0&&(o.payload.refine=o.filters);let s=[...a.getRoots(e.section)].map((e=>`flattenedtaxonomies:"types/${e}"`)).join(" OR ");o.payload.query=s,e.exceptIds&&e.exceptIds.length>0&&(o.payload.query+=" AND NOT(physicalid:"+e.exceptIds.join(") AND NOT(physicalid:")+")");let h=p.getLinkedIds();h&&h.length>0&&(o.payload.query+=" AND physicalid:("+h.join(" OR ")+")");let g=e.tableFilter;if(g){let e=v(g).uql;e&&(o.payload.query+=" AND "+e)}var f=widget.lang?widget.lang:widget.getValue("lang");return o.payload.locale=f,o.payload.tenant=t.getPlatformId(),o.payload.source=["3dspace"],o.payload.indexmode="true",o.payload.with_indexing_date="true",o.payload.login={"3dspace":{SecurityContext:u.getCredential()}},o.headers={"content-type":"application/json"},o.data=d.Json.encode(o.payload),o.method="POST",o.inSource="3DSearch",o.timeout=12e4,o.type="json",c._executeQuery("/search",o,"Folder_read_getRoots")},expandFolder:function(e){s.get3DSpaceUrl().then((t=>{var o=t+"/cvservlet/progressiveexpand/v2?output_format=cvjson",i={};d.extend(i,e);var r=new Date;let s=("Bookmark_Expand_"+Math.random().toString(36).substring(2,9)+"_"+r.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var l=n.getIndexPredicateForTree();let p=n.getIndexRelPredicateForTree(),h=e.section,g=a.getExpandDefinition(h).sub.rels.map((e=>`(taxonomies:${e})`)).join(" OR "),f=[];i.multi_root_physicalid.forEach(((e,t)=>{let o={label:s+"_"+t,root:{physical_id:e},parameters:{graph_advise:1,limit_max_path:5001},graph:{descending_condition_relation:{uql:g}},filter:{all:1}};i.level>=0&&(o.aggregation_processors=[{truncate:{max_distance_from_prefix:i.level,prefix_filter:{prefix_path:[{physical_id_path:[e]}]}}}]),f.push(o)})),i.payload={batch:{expands:f},outputs:{select_object:l,select_relation:p,format:"entity_relation_occurrence"}};let m=u.getCredential();return i.headers={SecurityContext:m,"content-type":"application/json"},i.type="json",i.withSecurityToken=!0,i.data=d.Json.encode(i.payload),i.method="POST",i.timeout=12e4,c._executeQueryWithError(o,i,"expandFolder")}))},expandProductsForDisplay:function(e,t){var i=o.getCancelObject();let r=new Promise(((o,r)=>{if(!i.isCancelled()){var s=n.getIndexPredicates();h||(h=function(){const e=new RegExp("attribute\\[(.*?)\\]");let t=[];return require("DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt").getAvailableColumnsOpts().forEach((function(o){if(o.attrDBName&&o.attrDBName.length>0){let i=e.exec(o.attrDBName[0]);if(i&&i.length>1){let e=i[1].split(".");e.length>1&&t.push(e[0])}}})),t}());let i=[...s,"ds6w:globalType"];t={...t,withIcons:!0,select_object:i,select_relation:g};let l=S("Bookmark_PrdExpandDisp_",e,t),a=l;if(t.db){let o=[];for(let t in e){let i=e[t].paths;o=o.concat(i)}l={cv:a,db:{source:"cstorage",root_path_physicalid:o,expand_iter:`${void 0!==t.level?t.level:-1}`,label:l.batch.expands[0].label+"_db",select_bo:i,select_rel:g,compute_select_bo:["icon"],types:["VPMReference","VPMInstance","VPMRepReference","3DShape","Drawing"],extensions:h}}}this._executePrdExpand(l,t.db).then((e=>{e.results?(e.results.forEach((e=>{if(!e.Path)for(let t in e)Array.isArray(e[t])&&1===e[t].length&&(e[t]=e[t][0]);return e})),o(e)):o(e)})).catch(r)}}));return r.cancel=i.cancel,r},expandOfProducts:function(e,t){let o=S("Bookmark_PrdExpand_",e,t);return this._executePrdExpand(o)},_executePrdExpand:function(e,t){var o=!0!==t?"/cvservlet/progressiveexpand/v2?output_format=cvjson":"/resources/enoauthoring/expand/v2/progressive",i={};i.payload=e;let n=u.getCredential();return i.headers={SecurityContext:n,"content-type":"application/json"},!0!==t&&(i.withSecurityToken=!0),i.type="json",i.data=d.Json.encode(i.payload),i.method="POST",i.inSource="3DSpace",i.timeout=12e4,c._executeQuery(o,i,"_executePrdExpand")},getAllLinksFromIndex:function(e){var t={};return t.payload={rootIds:e.rootIds},t.query={section:e.section},t.headers={"content-type":"application/json"},t.type="json",t.data=d.Json.encode(t.payload),t.method="POST",t.inSource="3DSpace",t.timeout=12e4,c._executeQuery("/resources/v1/FolderManagement/Folder/getAllLinks",t,"getAllLinksFromIndex")},listContent_ExpandLevel_1:async function(e){let{pid:t,noSizeLimit:o,predicates:i,relPredicates:r,filters:s,section:l,synthesis:p,synthesis_only:h,content:g,noContent:f,onlyContent:m}=e;var v={};d.extend(v,e);var S=new Date;let y=("listContent_ExpandLevel_1"+Math.random().toString(36).substring(2,9)+"_"+S.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var b=i||n.getIndexPredicates(),E=r||n.getRelIndexPredicates();let D=_(s),w=[];v.payload={batch:{expands:w},outputs:{select_object:b,select_relation:E,format:"entity_relation"}};let I=null,F=a.getExpandRelations(l);F&&(I=F.map((e=>`(taxonomies:${e})`)).join(" OR "));let T=a.getExpandRelationsV2(l),x={pid:t,noSizeLimit:o};h||(!f&&I&&w.push(C(y+"_0",I,x,D,!1)),g&&T&&!m&&T.forEach(((e,t)=>{let o=e.map((e=>`(taxonomies:${e})`)).join(" OR ");w.push(C(y+"_"+(t+1),o,x,D,!1))}))),p&&(!I||!0===f&&"synthesis"!==f||w.push(C(y+"_Synth_0",I,x,D,!0)),g&&T&&T.forEach(((e,t)=>{let o=e.map((e=>`(taxonomies:${e})`)).join(" OR ");w.push(C(y+"_Synth_"+(t+1),o,x,D,!0))})),v.payload.outputs.synthesis=["xSynth"]),i||(v.payload.outputs.hits={multivalues_in_arrays:1,predefined_computation:["icons"]});let P=u.getCredential();return v.headers={SecurityContext:P,"content-type":"application/json"},v.type="json",v.withSecurityToken=!0,v.data=d.Json.encode(v.payload),v.method="POST",v.timeout=12e4,c._executeQueryWithError("/cvservlet/progressiveexpand/v2?output_format=cvjson",v,"listContent_ExpandLevel_1")}})})),define("DS/FolderEditor/views/additionalColumns/ThumbnailColumn",["UWA/Class","DS/FolderEditor/service/FolderEditorWebServiceReadMode"],(function(e,t){"use strict";var o=function(){return"thumbnail"};return e.singleton({init:function(e){this.allViewsSupported=!0,this._parent(e)},isAdditionalColumnsAvailable:function(e){e(!0)},getName:o,getManagedColumnNames:()=>["thumbnail","isThumbnailSet"],toBeUpdated:function(e,t){return!e.isThumbnailSet&&"3DSpace"===t.getAttributeValue("serviceId")},updateAttributes:function(e,o){t.loadThumbnails({ids:e.pids}).then((e=>{if(e){var t=e.results,i={};t?(t.forEach((function(e){var t=e.attributes,o=null,n=null,r=0;t.every((function(e){return"preview_url"===e.name?(n=e.value,r++):"resourceid"===e.name&&(o=e.value,r++),r<2})),i[o]={isThumbnailSet:!0},o&&n&&(i[o]={_root:{}},n&&(i[o].thumbnail="url("+n+")",i[o].isThumbnailSet=!0,i[o]._root.thumbnail=n))})),o({pids:i})):o({})}else o({})})).catch((()=>{o({}),console.log("Failure during thumbnail retrieval")}))}})})),define("DS/FolderEditor/service/FolderServices",["UWA/Core","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/tagger/TaggerContentProxy","DS/IPClassifyUtil/IPServicesMgr","DS/DocumentManagement/DocumentManagement","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/FolderUpload/FolderUpload","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/utils/SettingsHandler","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/plugins/PluginsManager","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/BkAlert","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUXUtil/ActionBar/IPCommandManager"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E){"use strict";let D={};function w(e,t){return new Promise(((o,n)=>{var r={pids:t,section:e};let s=null,l=1===t.length&&t[0];l&&D[l]?s=D[l]:(s=i.getFolderPath(r),l&&(D[l]=s,setTimeout((()=>{delete D[l]}),5e3))),s.then((e=>{e.error?n(e.error):o(e)})).catch((()=>{let e=null;t.length>0&&(e=t[0]),n()}))}))}var I=null;let F=null,T=null;function x(e){let t={},o={};return e.attributes.forEach((e=>{let i=e.name,n=i.lastIndexOf("/");n>0&&(i=i.substring(n+1));let r=e.format,s=o[i];if(!s||r===s){let n=t[i],s=e.value;n?Array.isArray(n)?n.push(s):t[i]=[n,s]:t[i]=s,o[i]=r}})),t}function P(e){e.label=C["Broken link"],e.service="__Unknown__",e.type="brokenLink",e.displayType=C["Broken link"],e.largeicon=_.getWebappsAssetUrl("FolderEditor","icons/BrokenLink_Thumbnail.png"),e.links=[{id:e.id,owner:e.owner}]}let A=e.createElement("iframe",{name:"bookmarkdownloaderFrame",styles:{display:"none"}}),k=e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"bookmarkdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}}),N={};return(I={_reset:function(){N={},F=null,T=null,o.onPrepareBookmarkOpening((()=>{F&&(F.cancel(),F=null),T=null})),o.onBookmarkOpening((async()=>{let e=o.getCurrentBookmarkSection();if(!e){let t=await i.getFolderProperties({pid:o.getCurrentBookmarkId(),type:"json"});e=v.getDefaultSection(t.type)}let n=v.getSection(e),r=null;r=n&&!0===n.favorite?[{id:o.getCurrentBookmarkId()}]:await I.getCurrentBookmarkPath(e);let l="root";v.isHardSection(e)&&(l+=","+e),r&&r.length>0&&r.forEach((e=>{l+=","+e.id}));var a=t.jsonUnzip(widget.getValue(v.getPrefPrefix().toLowerCase()+"TreeSelectedNode")||"{}");(a=JSON.parse(a))[s.getPlatformId()]=l,a=JSON.stringify(a),widget.setValue(v.getPrefPrefix().toLowerCase()+"TreeSelectedNode",t.jsonZip(a))}))},loadLinks:function(e,s){if(s=s||{},!e||e.length>0&&v.isRootSection(e[0])||!v.isExternalObjectSupported(s.section))return m.resolve();var l=o.getCurrentBookmarkId();let a=null,d=new m((async(u,p)=>{if(e&&e.length>0){let h=await this.getCurrentBookmarkInfo(),g={section:s.section};s&&s.expandAll?(g.rootIds=e,a=n.getAllLinksFromIndex(g)):(g.pid=e[0],a=i.getLinks(g)),a=m.all([a]),a.then((e=>{let n=e[0];if(o.getCurrentBookmarkId()===l){var a=n.contents;if(a){let e={},o=[],l={},g=s.filters?Object.keys(s.filters).length:0,f=!1;a.forEach((t=>{let n=i.getSourceFromService(t.service);if(n&&"www"!==t.service&&t.uri){let o=l[t.uri],i=!!o;if(o||(o=l[t.uri]=t,o.links=[]),o.links.push({id:t.id,owner:t.owner}),!i){let o=e[t.service];o||(o=e[t.service]=[]),o.push(t.uri)}}else n?(!s.searchQuery||t.uri&&t.uri.indexOf(s.searchQuery)>=0||t.appdata&&t.appdata.indexOf(s.searchQuery)>=0)&&(0===g||f)&&(t.type="wwwLink",t.displayType=C.wwwLinkType,t.serviceId=t.service,t.largeicon=_.getWebappsAssetUrl("IPClassifyUXUtil","icons/I_LinkTemp.png"),t.links=[{id:t.id,owner:t.owner}],o.push(t)):("__Unknown__"!==t.service&&console.error(t.service+" is unknown"),P(t),o.push(t))}));let v={nhits:o.length,nmatches:o.length,nresults:o.length},S=Promise.resolve();Object.keys(e).length>0&&(S=function(e,t,o,{filters:n,searchQuery:s,bkLeader:l}){let a=null,d={};d["[ds6w:i3dx]"]=e;let u=new m(((e,u)=>{a=i.fetchIndexAttributes({idsPerAttrAndService:d,filters:n,searchQuery:s}),a.then((async i=>{let n={infos:{nhits:0,nmatches:0,nresults:0}},s=[];if(i&&i.forEach((e=>{e.results&&(e.results.forEach((e=>{let i=x(e),n=t[i["ds6w:i3dx"]];n&&(i.serviceId=n.service,i.i3dx=n.uri,i.links=n.links,o.push(i)),delete t[i["ds6w:i3dx"]]})),s.push(r.addTags(e))),e.infos&&(n.infos.nhits+=e.infos.nhits,n.infos.nmatches+=e.infos.nmatches,n.infos.nresults+=e.infos.nresults)})),l)for(let e in t){let i=t[e];P(i),o.push(i)}await Promise.all(s),e(n)})).catch((e=>{console.log(e),u({...C.msg_error_loadIndexAttr,className:"error"})})).finally((()=>{c.removeComponentToLoad("contentView","loadAttributes")})),c.addComponentsToLoad("contentView",{loadAttributes:C.LoadAttributes_Loading},{withCancel:!0,cancelObject:{cancel:()=>{a.cancel(),e()}}})}));return u.addLinkedQuery(a),u}(e,l,o,{filters:s&&s.filters,searchQuery:s&&s.searchQuery,bkLeader:s&&!0===s.brokenLinks&&h.getAttributeValue("owner")===t.getUserId()}),d.addLinkedQuery(S)),S.then((e=>{if(n.contents=o,n.infos=v,e){n.infos=e.infos;for(let t in v)e.infos[t]=e.infos[t]?e.infos[t]+v[t]:v[t]}u(n)})).catch(p)}else p({...C.msg_error_contentnotavailable,title:C.replace(C.msg_error_contentnotavailable.title,{typeStruct:v.getTreeTypeNls(h.getType())}),className:"error"})}})).catch(p)}else u()}));return d.addLinkedQuery(a),d},getCurrentBookmarkInfo:async function(){let e=o.getSelectedBookmark(),t=o.getCurrentBookmarkId(),i=e&&e.getID()===t;if(!i&&T)return T;if(!i){let t=o.getCurrentBookmarkElement();e=t.getLabel()?t:null}let n=null;return n=e&&e.getID()===t?Promise.resolve(e):this.getBookmarkInfo(t),T=n.then((e=>{o.updateCurrentBookmarkElement(e);let t=o.getSelectedBookmark(),i=o.getCurrentBookmarkId();return t&&t.getID()===i?t:e})),T},getBookmarkInfo:async function(e){let t=o.getDefaultModelFromId(e),r=this.getAvailableBookmarkInfo(e),s=null;return r?s=Promise.resolve(r):v.isHardSection(e)?s=Promise.resolve(t):(s=new Promise(((r,s)=>{F="authoring"!==g.getCurrentModeType()?n.fetch({ids:[e],select_predicate:["type","label","physicalid","ds6w:classification","mxid"]}).then((e=>{e.results&&e.results.length>0&&(e.results[0].attributes.forEach((e=>{t[e.name]=e.value})),t.id=t.physicalid,t.folderClassification=t["ds6w:classification"]?t["ds6w:classification"].toUpperCase():"",t.isPersonal="Personal"===t["ds6w:classification"],t.isFavorite="FolderSection_favorite"===o.getCurrentBookmarkSection()),r(t)})).catch(s):i.getFolderProperties({pid:e,type:"json"}).then((e=>{if(e){for(var i in e)t[i]=e[i];t.physicalid=t.id,t.isPersonal="Personal"===t.folderClassification,t.isFavorite="FolderSection_favorite"===o.getCurrentBookmarkSection()}r(t)})).catch(s)})),s.finally((()=>F=null))),s},getAvailableCurrentBookmarkInfo:function(){return this.getAvailableBookmarkInfo(o.getCurrentBookmarkId())},getAvailableBookmarkInfo:function(e){return d.getVisibleTreeNode(e)},getCurrentBookmarkPath:function(e){let t=null,i=o.getCurrentBookmarkId(!0);if(i){let o=d.getAvailableCurrentBookmarkPath();t=o?Promise.resolve(o[i]):this.getBookmarkPathSoft(e,i)}return t},getBookmarkPathSoft:function(e,t){return t?new Promise((o=>{w(e,[t]).then((e=>{o(e[t])})).catch((e=>{console.log(e);let t={title:C.NoPathFound,className:"error"};e&&(t.message=e.message?e.message:e.toString(),a.displayNotification(t)),o()}))})):Promise.resolve([])},getBookmarksPath:function(e,t){let o=[];if(1===t.length){let i=t[0],n=N[i];n||(N=N||{},N[i]=n=w(e,t)),o.push(n)}else for(let i=0;i<t.length;i+=100){let n=w(e,t.slice(i,i+100));o.push(n)}return new Promise(((e,t)=>{Promise.all(o).then((t=>{let o={};t.forEach((e=>{o={...o,...e}})),e(o)})).catch(t)}))},addExternalLink:function(e){return i.addExternalLink({id:e.id,urlTitle:e.urlTitle,url:e.url})},editExternalLink:function(e){return i.editLink(e)},getlinkProperties:function(e){return i.getlinkProperties(e)},AddContent:async function(e){if(e.IDs.length>0){var t=e.folderId?e.folderId:o.getCurrentBookmarkId();if(t&&t.length)if("external"!==e.IDs.key)S.addcontent(e.target.getType(),{pid:t,IDs:e.IDs,fetchAttributes:e.fetchAttributes,areLinkedFolders:e.areLinkedFolders}).then((t=>{if(t&&t.error){var o=t.error;console.log("AddContent WebService Err : "+o),o.length>200&&(o=null),t.information&&a.displayNotification({message:t.information,className:"primary"}),e.callbacks.onFailure(t.advice?t:o)}else g.switchtoAuthoringMode(),e.callbacks.onComplete(t)})).catch(e.callbacks.onFailure);else try{!0===e.checkLinkExists&&await async function(e){let t={},o={};e.forEach((e=>{let i=e.getAttributeValue("serviceId");if("www"!==i){let n=t[i];n||(n=t[i]=[]);let r=e.getAttributeValue("i3dx");n.push(r),o[r]=e.getLabel()}}));let n={};n["[ds6w:i3dx]"]=t;let r=await i.fetchIndexAttributes({idsPerAttrAndService:n});r&&r.forEach((e=>{e.results&&e.results.forEach((e=>{let t=x(e);delete o[t["ds6w:i3dx"]]}))}));let s=Object.values(o).join(", ");if(s)throw{...C.error_nonIndexedI3dx,message:C.replace(C.error_nonIndexedI3dx.message,{objects:s})}}(e.IDs);let o=await S.addExternalObject(e.target.getType(),{objects:e.IDs,id:t});g.switchtoAuthoringMode(),e.callbacks.onComplete({objectsAdded:o.results.length,objectsAlreadyPresent:o.objectsAlreadyPresent?o.objectsAlreadyPresent:0})}catch(t){e.callbacks.onFailure(t)}else e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},RemoveContent:function(e){if(e.IDs.length>0){var t=1==e.isLinkedFolder,i=e.folderId?e.folderId:o.getCurrentBookmarkId();i&&i.length?"external"!==e.IDs.key?S.removeContent(e.source.getType(),{pid:i,IDs:e.IDs,isLinkedFolder:t}).then((t=>{var o=t;if(o&&o.error){var i=o.error;console.log("Remove WebService Err : "+i),i.length>200&&(i=null),e.callbacks.onFailure({error:i,networkErr:!1})}else e.callbacks.onComplete(t)})).catch(e.callbacks.onFailure):S.removeExternalLink(e.source.getType(),{members:e.IDs.map((e=>e.getAttributeValue("links")[0].id)),id:i}).then((t=>{let o=t.notExist.length,i=e.IDs.length-o;e.callbacks.onComplete({NumberOfContentRemoved:i,NumberOfContentNotRemoved:o})})).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},expandProducts:function(e){if(g.switchtoAuthoringMode(),e.IDs.length>0){o.getCurrentBookmarkId()?i.listContent_ExpandLevel_Structures({pid:e.IDs,onComplete:function(t){var o=[];if(t&&t.errors){var i=t.errors[0].reason;console.log("expand WebService Err : "+i),i.length>200&&(i=null),e.callbacks.onFailure(i)}else{for(var n=t.results,r=0;r<n.length;r++)n[r].resourceid&&null==n[r].from&&o.push(n[r].resourceid);e.callbacks.onComplete(o)}},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},MoveContent:function(e){if(e.IDs.length>0){var t=e.targetfolder?e.targetfolder||e.targetfolder:"",o=e.sourcefolder?e.sourcefolder||e.targetfolder:"";t&&t.length&&o&&o.length?"external"!==e.IDs.key?S.moveContent(e.targetNode.getType(),{pid:t,IDs:e.IDs,SourceFolderId:o,checkSourceRelation:e.checkSourceRelation,areLinkedFolders:e.areLinkedFolders}).then((t=>{if(g.switchtoAuthoringMode(),t&&t.error){var o=t.error;console.log("MoveContent WebService Err : "+o),o.length>200&&(o=null),e.callbacks.onFailure(o)}else e.callbacks.onComplete(t)})).catch(e.callbacks.onFailure):S.moveExternalObject(e.targetNode.getType(),{members:e.IDs.map((e=>e.getAttributeValue("links")[0].id)),id:t}).then((t=>{g.switchtoAuthoringMode(),e.callbacks.onComplete({objectsMoved:t.contents.length,objectsAlreadyPresent:t.objectsAlreadyPresent})})).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},MoveFolder:function(e){g.switchtoAuthoringMode();var t=e.targetfolder,o=e.sourcefolder,i=t?t.getID():"";o&&o.id;i.length&&e.IDs.length?S.moveTreeElements(t.getType(),{targetNode:t,PhysicalId:e.IDs,TargetPhysicalId:i}).then((t=>{var o=t&&"string"==typeof t?JSON.parse(t):void 0;if(o&&o.error){var i=o.error;console.log("MoveFolder WebService Err : "+i),i.length>200&&(i=null),e.callbacks.onFailure(o.advice?o:i)}else e.callbacks.onComplete(t)})).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)},CheckCopyFolder:function(e){var t=b.getCredential();e.IDs.length?S.checkCopyTree(e.typeForCopy,{PhysicalId:e.IDs,SecurityContext:t}).then((t=>{e.callbacks.onComplete(t)})).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)},isSourceAndTargetTypeSame:function(t,o){if(!t||!o)return true;if(e.is(t,"array")){if(!(t.length>0))return true;t=t[0]}return!!v.isSubElement(t.getType(),t.section)!==!!v.isSection(o.getType())},CopyFolder:function(e){g.switchtoAuthoringMode();var t=e.targetfolder,o=t?t.getID():"";o&&!v.isRootSection(o)||(o="");var i=e.credential?e.credential:b.getCredential();e.IDs.length?S.copyTreeElement(t.getType(),{PhysicalId:e.IDs,TargetPhysicalId:o,SecurityContext:i,withContent:e.withContent,prefix:e.prefix,suffix:e.suffix}).then((t=>{var o=t&&"string"==typeof t?JSON.parse(t):void 0;if(o&&o.error){var i=o.error;console.log("CopyFolder WebService Err : "+i),i.length>200&&(i=null),e.callbacks.onFailure({serverErr:o.advice?o:i})}else e.callbacks.onComplete(t)})).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)},downloadFiles:async function(e){var t=await i.get3DSpaceUrl(),n=b.getCredential(),r=o.getSelectedContent();require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/ModelEvents","DS/DocumentCommands/V2/Actions/Download"],(function(e,o,i){e.getPlatformServices({platformId:u.getTenantID(),onComplete:function(e){l.getDocuments(r.map((e=>e.getID())),{tenant:u.getTenantID(),securityContext:n,tenantUrl:t,onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;var n={fetchSecurityContext:function(){return b.getCredential()},getSelectedNodes:function(){return t.data},getDocumentFromNodeModel:function(e){return e},platformUrls:e,events:new o,isFromContextMenu:!0};n.events.subscribe({event:"docv2-show-notification"},(function(e){var t={title:e.title,subtitle:e.subtitle,message:e.message,className:e.level};a.displayNotification(t)}));new i(n);i.execute({options:n})}}})},onFailure:function(e){console.log(e)}})}))},previewFile:function(e){},FolderUpload:async function(e){var t=await i.get3DSpaceUrl(),n=widget.widgetDomain,r=widget.getPreference("pad_security_ctx").value.split("."),s=r[r.length-1],l=e.id,a=e.lable,d=(e={fetchSecurityContext:function(){return b.getCredential()},fetchCollabSpaceDisplayName:function(){return s},platformUrls:{"3DSpace":t,"3DDashboard":n,platformId:u.getTenantID()}},new h(e)),c=E.getCommandByContext("FolderUpload");d.events.subscribe({event:"operation-complete"},(function(e){require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode();var t=o.getCurrentBookmarkId();e.parentId==t&&(f.refreshWidgetContent(),console.log("After Completion of the Command..."))})),d.events.subscribe({event:"enable-folder-upload-command-in-ui"},(function(e){c.enable()})),d.events.subscribe({event:"disable-folder-upload-command-in-ui"},(function(e){c.disable()})),d.openFolderPicker(l,a)},AddShortcut:function(e){i.AddBookmarkShortcut({ObjetcID:e.id,TargetFolderID:e.targetID}).then((t=>{console.log(t),e.callbacks.onComplete(t)})).catch((t=>{e.callbacks.onFailure(t.err,t.serverErr,t.data)}))},FolderDownload:function(t){return new Promise(((o,n)=>{var r=new Date,s="Folder Download Start Command : "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds();console.log("NI4 : "+s),i.DownloadFolderStructure({pid:t.id}).then((t=>{o();var i=new Date,n="Request Ticket Complete Time: "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds();console.log("NI4 : "+n);var r=t?JSON.parse(t):void 0;if(r){if(r&&"success"==r.status){a.displayNotification({message:C.BookmarkDownload.BookmarkDownloadStarted,className:"success"});var s=(A.isInjected()||A.inject(document.body),k.isInjected()||k.inject(document.body),k.empty(),e.createElement("input",{name:"attachment",value:"true"}).inject(k),k);e.createElement("input",{name:r.ticketParamName,value:r.ticketExportStr}).inject(s),s.action=r.actionURL,s.submit()}if(r&&"failure"==r.status)if("LimitDocuments"==r.error)a.displayNotification({message:C.BookmarkDownload.BookmarkDownloadLimit,className:"warning"});else if("No_Documents"==r.error)a.displayNotification({message:C.BookmarkDownload.BookmarkNo_Documents,className:"warning"});else if("DocWithNOFileMultiFileFailure"==r.error){var l="";null!=r.msgMultiFile&&(l=C.BookmarkDownload.BookmarkDownloadMultiFileError+r.msgMultiFile),null!=r.msgNOFile&&(l+=C.BookmarkDownload.BookmarkDownloadNoFileError+r.msgNOFile),a.displayNotification({message:C.BookmarkDownload.DownloadStructureFailure+l,className:"error"})}else"DownloadStructureFailure"==r.error&&a.displayNotification({message:C.BookmarkDownload.DownloadStructureFailure,className:"error"})}})).catch((e=>{o()}))}))},replaceContent:function(e){var t=e.IDsRemoved.length;if(t===e.IDsAdded.length&&t>0){var n=o.getCurrentBookmarkId();n&&n.length?i.replaceContent({pid:n,IDsRemoved:e.IDsRemoved,IDsAdded:e.IDsAdded}).then((t=>{var o=t?JSON.parse(t):void 0;if(o&&o.error){var i=o.error;console.log("ReplaceContent WebService Err : "+i),i.length>200&&(i=null),o.information&&a.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(i)}else e.callbacks.onComplete(t)})).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},getlastversion:function(e){var t=e.objectsToTreat;i.getlastversion({objectsToTreat:t}).then((t=>{var o=t?JSON.parse(t):void 0;if(o&&o.error){var i=o.error;console.log("getlastversion WebService Err : "+i),i.length>200&&(i=null),o.information&&a.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(i)}else e.callbacks.onComplete(t)})).catch(e.callbacks.onFailure)}})._reset(),I})),define("DS/FolderEditor/views/additionalColumns/FolderIsLastRevisionColumn",["UWA/Core","UWA/Class","DS/FolderEditor/service/FolderServices","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderSearch","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/Folder_CSO","DS/IPClassifyUXUtil/ActionBar/IPCommandManager"],(function(e,t,o,i,n,r,s,l,a,d){"use strict";let c="ds6w:isLastRevision",u={filterId:"set",dataIndex:c,width:100,minWidth:80,maxWidth:200,sortableFlag:!1,alignment:"center",typeRepresentation:"functionIcon",getCellSemantics:function(e){var t=e.nodeModel;let o=p(t);var i=h(t);let n=t.getInternalValue(c);return o&&void 0!==n&&n.toString().length>0?"true"==n.toString().toLowerCase()?{icon:{iconClasses:"check wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check  dgv-lastversion-check"},disabled:i}:{icon:{iconClasses:"wrong wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong dgv-lastversion-wrong"},disabled:i}:{disabled:!0}},customisation:{dataIndex:c,exportable:{lock:!1,value:!0},layout:{removable:!1}}};function p(e){return!l.isTreeType(e.getType())&&"www"!==e.getAttributeValue("serviceId")}function h(e){return n.isSearchActive()||e.getDepth()>0||l.isExternalObject(e)}return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(e){!function(e){e()}((function(){e(!0)}))},getName:function(){return"ds6w:isLastRevision"},getManagedColumnNames:function(){return[c]},toBeUpdated:function(e,t){var o=!1;if(p(t))return void 0!==e[c]&&""!==e[c]||(o=!0),o},getOnCellClickCB:function(e,t){return!(e!==this.getName()||!t.target.className.contains("wux-button-icon-placeholder")&&!t.target.className.contains("wux-tweaker-function"))&&function(e){var t=e.nodeModel;if(!h(t)&&t.getDepth()<1&&!l.isTreeType(t.getType())){var o=d.getCommandByContext("UPSAuthReplaceByRevision");o.setNode(t),o&&o.begin()}}},updateAttributes:function(e,t){let i={},n=[];e.nodes.forEach((e=>{let t=e.getID();n.push({id:t})}));var r={lastVersionRequests:n};let s=Promise.resolve();r.lastVersionRequests.length>0&&(s=new Promise((e=>{o.getlastversion({objectsToTreat:r,callbacks:{onComplete:function(t){JSON.parse(t).lastVersionRequests.forEach((function(e){i[e.id]={},i[e.id][c]=e.islast})),e()},onFailure:function(t){e()}}})}))),s.then((()=>{let e={pids:i};e=JSON.stringify(e),t(e)}))},getAdditionalColumnsUXDGV:function(t){for(var o=[],i=0;i<t.length;i++)o.push(t[i].dataIndex);var n=e.clone(u),r=o.indexOf(c);-1!==r&&(t[r]=e.extend(t[r],n,!0))}})})),define("DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","DS/Logger/Logger","UWA/Class/Promise","DS/FolderEditor/Folder_CSO","DS/Controls/ComboBox","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/IPConfirmationDialog","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/UIKIT/Popover","DS/Tree/Tree","DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/Foundation/CsvParser","i18n!DS/FolderEditor/assets/nls/ImportCSVBookmarkPanel","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorControl","DS/Controls/ProgressBar","DS/UIKIT/Input/Text","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/IPClassifyUtil/PlatformAPIWrapper","css!DS/FolderEditor/FolderEditor.css","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/commands/tools/ImportCSVFilesUtils","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/service/FolderServices","DS/Controls/TooltipModel","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridViewLayout","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F,T,x,P,A,k,N,M,U,O,R,L,B,V){"use strict";var W=1e3,j=['"',"#","$","@","%","*",",","?","\\\\","<",">","\\[","\\]","|",":"],H=['"',"#","$","%","*",",","?","\\\\","<",">","\\[","\\]","|",":"];let X=null;var q=function(e,t){!0===t?e.addClassName("withBorder"):e.removeClassName("withBorder")};function z(e,t){e.setBadges({topRight:{iconPath:m.getWebappsAssetUrl("FolderEditor",t?"icons/22/I_FolderValid.png":"icons/22/I_FolderNG.png"),iconSize:{width:"10px",height:"10px"}}})}var G=t.extend(i,o,{name:"ImportCSVBookmark",_logger:null,defaultOptions:{parent:null,renderTo:null,data:{level:0,name:1,description:2,aclOwner:3,aclSecurityContext:4,toModel:function(e){return{level:e[0].trim(),label:e[1].trim(),description:e[2].trim(),acl:{owner:""===e[3].trim()?"@BLANK@":e[3].trim(),securityContext:""===e[4].trim()?"@BLANK@":e[4].trim()}}}}},_droppableType:{"application/vnd.ms-excel":"csv","text/csv":"csv"},_checkErrorRef:[],_currentFolderType:"",_currentFolder:null,_cancel:!1,_lv1SecCtxEmpty:!1,_browserLanguage:"",_mapSecurityContext:null,_errorTips:[],_errorReasons:null,init:function(t){var o=this;e.merge(t||{},o.defaultOptions);return o._browserLanguage=o.utils.getBrowserLanguage(),o._logger=n.getLogger(G),o._logger.log("init"),o._parent(t),o._mapSecurityContext={},new r((async function(t,i){o._currentFolder=await N.getCurrentBookmarkInfo(),o._currentFolderType=o._currentFolder?o._currentFolder.getType():void 0,V.getscandcollab({tenant:A.getTenantID()}).then((i=>{(e.is(i,"string")?JSON.parse(i):i).collabspaces.forEach((function(e){e.couples.forEach((function(t){o._mapSecurityContext[t.role.nls.trim()+"."+t.organization.name.trim()+"."+e.title.trim()]=t.role.name.trim()+"."+t.organization.name.trim()+"."+e.name.trim()}))})),o.inject(widget.body),t(o)})).catch(i)}))},closeDialog:function(){this.dialog&&this.dialog.destroy()},_destroyErrorTips:function(){this._errorTips.forEach((function(e){e.destroy()})),this._errorTips=[]},buildTooltip:async function(e){var t=await N.getCurrentBookmarkPath("FolderSection_AllFolders"),o=" ";if(t&&t.length>0)for(var i="",n=t.length,r=0;r<n;r++)o+=i+t[r].label,i="\\";""!==o.trim()&&new p({position:"bottom",target:e,body:o})},inject:function(){var t=this;t._logger.log("inject");var o=t._currentFolder?t._currentFolder.getLabel():"",i=widget.immersiveFrame;let n=e.createElement("div",{class:"encodingSection",text:_.encondingChoice}),r=this._encoding=new l({elementsList:["UTF-8","Shift-JIS","WINDOWS-1252"],value:X||("ja"===this._browserLanguage?"Shift-JIS":"UTF-8"),enableSearchFlag:!1}),s=e.createElement("div",{class:"drop-csv"}),a=e.createElement("input",{class:"drop-csv-input",type:"file"}),d=e.createElement("span",{class:"drop-csv-label"}),c=e.createElement("span",{class:"fonticon fonticon-publish fonticon fonticon-2x"}),u=e.createElement("p",{class:"drop-csv-label-p"}),p=this._iconLabel=e.createElement("span",{class:"icon-label",text:_.Drop_Csv_File}),h=e.createElement("div",{class:"preview-csv"}),g=e.createElement("div",{class:"prev-csv-read"}),f=e.createElement("div",{class:"preview-csv-tree"}),m=e.createElement("div",{class:"preview-csv-tree-msg"});r.inject(n),n.inject(u),c.inject(d),p.inject(d),u.inject(d),m.inject(f),g.inject(h),f.inject(h),a.inject(s),d.inject(s);var v=new e.createElement("div");s.inject(v),h.inject(v),t.notifyArea=new b({className:"detailmsg",value:"",disabled:!0});var S=[{label:_.Label_Import,disabled:!0,role:WUXCustomButtonRoleEnum.Validate,emphasize:"primary",onClick:function(e){t.importButton.disabled=!0,t.execImportCSV()}},{label:_.Cancel,tooltipInfos:new M({shortHelp:_.Cancel_Tooltip}),role:WUXCustomButtonRoleEnum.Escape,onClick:function(e){t._cancel=!0,t._destroyErrorTips(),t.closeDialog()}}],C=new w({immersiveFrame:i,title:_.Dialog_Title+o,width:450,height:215,resizableFlag:!0,customButtonsDefinition:S,identifier:"importCSVDialog",modalFlag:!0,content:v}),y=C.elements._titleP;return t.notifyArea.inject(e.Element.getElement.call(C.getContent(),".wux-windows-dialog-footer"),"top"),e.Element.getElement.call(C.getContent(),".wux-windows-dialog-footer").prepend(new e.Element("div",{class:"csvstatus"})),this.buildTooltip(y),t.csvStatusArea=e.Element.getElement.call(C.getContent(),".csvstatus"),t.dialog=C,t.importButton=C.getCustomButtons()[0],t.cancelButton=C.getCustomButtons()[1],t.dropZone=e.Element.getElement.call(v,".drop-csv"),t.dropInput=e.Element.getElement.call(v,".drop-csv-input"),t.dropLabel=e.Element.getElement.call(v,".drop-csv-label"),t.dropLabelPara=e.Element.getElement.call(v,".drop-csv-label-p"),v.addClassName("dialog-csv"),v.setStyle("height","100%"),e.Element.getElement.call(C.getContent(),".wux-windows-window-content").setStyle("align-content","center"),t.droppable(t.dropZone),t},reset:function(){var e=this;e._logger.log("reset"),e.filePreview&&e.filePreview.destroy(),e.tree=void 0,e.filePreview=void 0},_initProgress:function(e){this.progress&&this.progress.destroy(),this.csvStatusArea.empty(),this.progress=new y({shape:"circular",statusFlag:!1,emphasize:e,displayFlag:!1,displayStyle:"lite",height:30}),this.progress.inject(this.csvStatusArea),this.progress.value=0},droppable:function(e){var t=this,o=0;function i(t){u.unmask(e),a.displayNotification({message:t,className:"error"}),e.addClassName("error"),setTimeout((function(){e.removeClassName("error")}),W)}function n(o){var n=o.dataTransfer?o.dataTransfer.files:o.target.files;if(0===n.length)return!0;if(n.length>1)i(_.ErrorMsg_Drop_Multiple_File);else{var r=n[0].name.split(".");if(r.length<=1||"csv"!==r[r.length-1].toLowerCase())return console.warn("drop file:"+r[r.length-1].toLowerCase()),void i(_.ErrorMsg_Drop_File_Not_CSV);if(0===n[0].size)return i(_.ErrorMsg_Drop_File_Empty),!0;if(n[0].size>25600){var s=_.ConfirmMsg_Drop_File_Size_Large+" ("+P.formatBytes(n[0].size,2)+")";d.confirmDialog({title:_.Label_Confirm_Title,message:s,immersiveFrame:widget.immersiveFrame,buttonLabels:{Yes:_.Label_Button_Confirm,No:_.Label_Button_Cancel}}).then((()=>{t._loadCsv(e,n[0])}))}else t._loadCsv(e,n[0])}}t.dropInput.addEventListener("click",(function(e){this.value=null,A.isReplayedODT()&&e.preventDefault()}),!1),t.dropInput.addEventListener("change",n,!1),t.listeners={},t.listeners.clickable=t.dropInput.click.bind(t.dropInput),e.addEventListener("click",t.listeners.clickable),t.listeners.dragenter=function(e){q(this,!0),o++},e.addEventListener("dragenter",t.listeners.dragenter),t.listeners.dragleave=function(e){0===--o&&q(this,!1)},e.addEventListener("dragleave",t.listeners.dragleave),t.listeners.dragover=function(e){e.preventDefault()},document.addEventListener("dragover",t.listeners.dragover),t.listeners.drop=function(e){e.preventDefault();var t=e.dataTransfer.types;t&&((t.indexOf?-1!=t.indexOf("Files"):t.contains("Files"))&&n(e))},e.addEventListener("drop",t.listeners.drop)},_getOrCreateTreeContent:function(){var t=e.Element.getElement.call(this.dialog.getContent(),".preview-csv-tree");t.getElement(".tree-content")||e.createElement("div",{class:"tree-content"}).inject(t)},_loadCsv:function(t,o){if(!o.dontRead){var i=this;u.mask(t);var n=function(e){u.unmask(t),i.updateDroppedFile({name:o.name,size:o.size})};i._destroyErrorTips(),i._errorReasons=[],i.importButton.label=_.Label_Import,i.importButton.disabled=!0,i.reset(),q(t,!1),e.Element.getElement.call(i.dialog.getContent(),".wux-windows-window-content").setStyle("align-content","inherit");var s=e.Element.getElement.call(i.dialog.getContent(),".preview-csv-tree");s.setStyle("height","0px").setStyle("border","solid 0px"),s.empty(),this._getOrCreateTreeContent(),r.all([i._readFile(o)]).then((function(e){try{i._initProgress("info"),i.csvStatusArea.show();var t=v.parse(e[0]+"\r\n");if(t.length>0){var o=t[0];o.length>0&&isNaN(o[0])&&t.splice(0,1)}r.all([i.checkLines(t),i.checkRemoteStatus(t)]).then((function(e){var o=e[0].concat(e[1]).sort((function(e,t){return Math.abs(e.linePos)!==Math.abs(t.linePos)?Math.abs(e.linePos)<Math.abs(t.linePos)?-1:1:Math.abs(e.pos)<Math.abs(t.pos)?-1:1})).filter((function(e){return""!==e.reason}));i._errorReasons=o,i._prepareImportData(t,o,n)}))}catch(e){handleError(e.message)}}))}},_prepareImportData:function(t,o,i){var n,s=this,l=0===o.length;n=l?t:[],s.tree&&s.tree.destroy();var d=s._createDataGridView(),u=s._createTreeModel(n);u.treeDepth&&(d.columns[0].width=200+d.treeNodeCellOptions.depthIncrement*u.treeDepth);var h=new R,g=new O({dataModelSet:h});g.addChild(u),d.treeDocument=g,s.tree=d,s.root=u,r.all([s.resolveSecurityContextOfSelectedFolder(s.root),s._showPreview(d),s._getStructure(u.options.id,u.options.label,0,u)]).then((function(e){var o=e[0];e[1],e[2];u.options.appData.acl.securityContext=o;var i=s.root.getAllDescendants().filter((function(e){return e.options.appData.hasId}));if(l){var n=t.length-i.length;if(0===n)return s.notifyMessage("info",_.InfoMsg_Create_Target_Size_Zero),s.cancelButton.label=_.Close,s.importButton.label=_.Label_Import+"(0)",void(s.importButton.disabled=!0);if(null===o&&s._lv1SecCtxEmpty)return a.displayNotification({message:_.WarnMsg_SecurityContext_MissMatch,className:"warning"}),s.cancelButton.label=_.Close,s.importButton.label=_.Label_Import+"(0)",void(s.importButton.disabled=!0);s.importButton.disabled=!1,s.importButton.label=_.Label_Import+"("+n+")"}})).catch((function(e){a.displayNotification({message:_.ErrorMsg_Rest_Error+(e&&e.message?" "+e.message:""),className:"error"})})),i(d);var f=o.map((function(e){return Math.abs(e.linePos)})).filter((function(e,t,o){return o.indexOf(e)===t})).length,m=t.length-f,v=e.Element.getElement.call(s.dialog.getContent(),".tree-content");if(l)s.notifyMessage("info","["+m+"/"+t.length+"] "+_.InfoMsg_Load_Csv_Success),s.csvStatusArea.hide();else{s.notifyMessage("error","["+m+"/"+t.length+"]"+_.InfoMsg_Load_Csv_Error),s.progress.emphasize="high-attention",v.addClassName("csverror");var S=[_.Label_Column_Level,_.Label_Column_Name,_.Label_Column_Description,_.Label_Column_Owner,_.Label_Column_SecurityContext];o.forEach((function(o){var i=Math.abs(o.linePos),n=(s.options.data,e.createElement("div",{text:" ("+_.Label_LineNumber+":"+(i+1)+") "+o.reason,class:"errorline icon"+o.pos}));if(v.appendChild(n),o.pos){var r;r=S[o.pos]+" : "+t[i][o.pos];var l=new p({position:"bottom",target:n,body:P.Sanitize.encode(r)});s._errorTips.push(l)}}))}new c({element:v}),v.addClassName("csvshow")},undroppable:function(e){this.listeners&&(e.removeEventListener("click",this.listeners.clickable),e.removeEventListener("dragenter",this.listeners.dragenter),e.removeEventListener("dragleave",this.listeners.dragleave),e.removeEventListener("dragover",this.listeners.dragover),e.removeEventListener("drop",this.listeners.drop),this.listeners=null),e.setStyle("cursor","default"),this.dropLabel.setStyle("cursor","default"),e.addClassName("drop-disabled")},updateDroppedFile:function(t){var o=this;o.dialog.width=450,o.dialog.height=350;var i=e.createElement("span",{class:"csv-file",html:'<span class="csv-file-image"></span><span class="csv-file-name">'+t.name+" ("+P.formatBytes(t.size,2)+")</span>"});o.filePreview=i,o.dropLabel.setStyle("font-size","10px").setStyle("top","-5px").setStyle("float","right").setStyle("text-align","center"),o.dropZone.setStyle("height","40px").setStyle("border","initial").setStyle("cursor","pointer");var n=o._iconLabel;n.textContent=_.Change_Csv_File;var r=e.Element.getElement.call(o.dialog.getContent(),".preview-csv-tree");r.setStyle("height","100%"),r.setStyle("position","relative"),r.setStyle("border","1px solid #e2e4e3"),e.Element.getElement.call(o.dialog.getContent(),".preview-csv").setStyle("height","calc(100% - 40px)"),this._getOrCreateTreeContent(),setTimeout((function(){if(i.inject(o.dropLabel,"before"),o.undroppable(o.dropZone),!o.iconZone&&(o.iconZone=e.Element.getElement.call(o.dropZone,".fonticon"),o.iconZone)){o.iconZone.setStyle("cursor","pointer");var t=o.dropInput.click.bind(o.dropInput);o.iconZone.addEventListener("click",t,!1);var r=n;r.setStyle("cursor","pointer"),r.addEventListener("click",t,!1)}}),333.3333333333333)},_readFile:function(e){var t=this,o=new FileReader;return new r((function(i,n){o.onload=function(e){i(e.target.result)},X=t._encoding.value,o.readAsText(e,t._encoding.value)}))},checkLines:function(e){var t=this;return new r((function(o,i){var n=t.options.data,r=0,s="",l=[{}],a={},d=[],c=!0,u=new RegExp("^-*[0-9]+$");t._checkErrorRef=d;for(var p=A.isReplayedODT()?1:-1,h=0;h<e.length;h++){var g={reason:"",data:[],linePos:-1,pos:-1},f=e[h];if(f.length<5)g.reason=_.ErrorMsg_Column_Count,g.linePos=h,g.pos=null,d.push(g);else{if(c&&r>=0){g.pos=n.level;var m=f[n.level];if(!u.test(m)){g.reason=_.ErrorMsg_Level_Is_Not_Number,g.linePos=h*p,d.push(g),r=g.linePos,c=-1!==p;continue}if((m=parseInt(m))<=0){g.reason=_.ErrorMsg_Level_Origin,g.linePos=h*p,d.push(g),r=g.linePos,c=-1!==p;continue}if(!(r>=m||r+1===m)){g.pos=n.level,g.reason=_.ErrorMsg_Level_Is_Not_Sequencial,g.linePos=h*p,d.push(g),r=g.linePos,c=-1!==p;continue}if(r>=m)for(var v=r-m,S=0;S<v;S++)l.pop();if(s=f[n.name],l.length+1===m&&l.push({}),a=l[m-1]){if(a[s]){g.pos=n.name,g.reason=_.ErrorMsg_Name_Duplicate,g.linePos=h,r=m,d.push(g);continue}a[s]=!0}r=m}if(g.pos=n.name,""!==(s=f[n.name]).trim())if(s.length>=127)g.reason=_.ErrorMsg_Name_Max_Over,g.linePos=h,d.push(g);else{var C=j.join(""),y=new RegExp("["+C+"]");s=P.removeControllCode(s),f[n.name]=s,g.pos=n.description;var b=f[n.description];if(b.length>1024)g.reason=_.ErrorMsg_Desc_Max_Over,g.linePos=h,d.push(g);else{var E=y.exec(b);E?(g.reason=_.ErrorMsg_Avoid_Char+"("+E.map((function(e){return e})).join("&nbsp;")+")",g.linePos=h,d.push(g)):(b=P.escapeControllCode(b),f[n.description]=b)}}else g.reason=_.ErrorMsg_Name_Required,g.linePos=h,d.push(g)}}o(d)}))},checkRemoteStatus:function(e){var t=this;return new r((function(o,i){var n=t.options.data,s={listeners:{}},l=[];t.csvStatusArea.show(),t._lv1SecCtxEmpty=!1;var a=j.join(""),d=H.join(""),c=new RegExp("["+a+"]"),u=new RegExp("["+d+"]"),p=0,h=0,g=t.listSecurityContext(),f=-1;e.forEach((function(i,a){if(i.length<5)for(var d=i.length;d<5;d++)i.push("");var m={reason:"",data:[],linePos:-1,pos:-1};h++;var v=i[n.aclOwner];v=v.trim();var S=[],C=null;if(C=r.resolve(!0),0!==v.length){var y=u.exec(v);switch(!0){case P.getStringByte4UTF8(v)!==v.length:m.pos=n.aclOwner,m.reason=_.ErrorMsg_Owner_Is_Not_Ascii,m.linePos=a,l.push(m),C=r.resolve("NOCHECK");break;case null!==y:m.pos=n.aclOwner,m.reason=_.ErrorMsg_Avoid_Char+"("+y.map((function(e){return e})).join("&nbsp;")+")",m.linePos=a,l.push(m),C=r.resolve("NOCHECK");break;default:m.pos=n.aclOwner,C=t._checkOwner(a,v,s)}}S.push(C),m={reason:"",data:[],linePos:-1,pos:-1};var b=i[n.aclSecurityContext].trim();if(C=r.resolve(!0),0!==b.length)switch(y=c.exec(b),!0){case 3!==b.split(".").length:m.pos=n.aclSecurityContext,m.reason=_.ErrorMsg_SecCtx_Is_Invalid,m.linePos=a,l.push(m),C=r.resolve("NOCHECK");break;case null!==y:m.pos=n.aclSecurityContext,m.reason=_.ErrorMsg_Avoid_Char+"("+y.map((function(e){return e})).join("&nbsp;")+")",m.linePos=a,l.push(m),C=r.resolve("NOCHECK");break;default:m.pos=n.aclSecurityContext,C=t._checkSecurityContext(a,b,g)}else"1"===i[n.level].trim()&&(t._lv1SecCtxEmpty=!0);S.push(C);var E=a+"";r.all(S).then((function(o){if(!0===o[0]&&!0===o[1]&&0===t._checkErrorRef.filter((function(e){return Math.abs(e.linePos)===parseInt(E)})).length){var i=++p/e.length*100;f!==i&&(t.progress.value=i,f=i)}return o})).then((function(e){var t=null,r=null;e[0]||(t=_.ErrorMsg_Rest_Error,!1===e[0]&&(t=_.ErrorMsg_Owner_Does_Not_Exist)),t&&(r={reason:t,data:i,linePos:a,pos:n.aclOwner},l.push(r)),t=null,!1===e[1]&&(t=_.ErrorMsg_SecCtx_Does_Not_Exist),t&&(r={reason:t,data:i,linePos:a,pos:n.aclSecurityContext},l.push(r)),0===--h&&o(l)}))}))}))},_createTreeModel:function(e){var t=this,o=t.options.data,i=[],n=new f({id:t._currentFolder.id,label:t._currentFolder.getLabel(),level:0,appData:{acl:{}},icons:[m.getWebappsAssetUrl("FolderEditor","icons/22/foldersectionall.png")]});return i.push(n),e.forEach((function(e){var t=o.toModel(e);t.hasId=!1;var r=new f({level:t.level,label:t.label,appData:t,icons:[m.getWebappsAssetUrl("FolderEditor","icons/folder.png")]}),s=t.level;i[s]=r,i[s-1].addChild(r),n.treeDepth?n.treeDepth=parseInt(s)>n.treeDepth?parseInt(s):n.treeDepth:n.treeDepth=parseInt(s)})),n},_createDataGridView:function(){var e={};e.layout=new L({rowsHeader:!1,columnsHeader:!1,useLastColumnWidthAutoFlag:!1}),e._identifier="DGVImportCSV",e.rowSelection="single",e.showAlternateBackgroundFlag=!1,e.showRowBorderFlag=!1,e.showSelectionCheckBoxesFlag=!1,e.columns=[{dataIndex:"tree",sortableFlag:!1,editableFlag:!1,typeRepresentation:"string",pinned:"unpinned",width:300,minWidth:40}],this.dialog.height=323;var t=new U(e);return t.inject(this.dialog.getContent().getElement(".preview-csv-tree")),t},notifyMessage:function(e,t){this.notifyArea.setValue(t),this.notifyArea.getContent().setAttribute("title",t),this.notifyArea.setClassName("detailmsg show "+e)},_showPreview:function(t){var o=this;return new r((function(i,n){!function n(){null!==e.Element.getElement.call(o.dialog.getContent(),".wux-scroller")?(setTimeout((function(){t.treeDocument.expandAll(),u.unmask(e.Element.getElement.call(o.dialog.getContent(),".preview-csv-tree"))}),100),i(t)):setTimeout((function(){n()}),100)}()}))},_getStructure:function(e,t,o,i){var n=this;return new r((function(t,l){var a={onComplete:function(e){for(var s={},l=[],a=(e=JSON.parse(e)).folders,d=i.getChildren()||[],c=d.map((function(e){return e.getLabel()})),u=0;u<a.length;u++){var p=a[u],h=o+1,g={id:p.id,label:p.label,level:o+1};s[p.label]=g;var f=c.indexOf(p.label);if(-1!=f){var v=d[f];v.options.id=p.id,v.options.icons=[m.getWebappsAssetUrl("FolderEditor","icons/22/foldersectionall.png")],v.options.appData.hasId=!0,v.options.appData.modified=new Date(Date.parse(p.modified)),v.options.appData.acl.securityContext=n.resolveCurrentSecurityContextBy(p.organizationResponsible,p.project),v.updateOptions("icons"),l.push(n._getStructure(p.id,p.label,h,v))}}r.all(l).then((function(e){t(s)}))},onFailure:function(e){z(i,!1),l(i.options.label)}};let d=k.getSection(n._currentFolderType),c=n._currentFolder.section?n._currentFolder.section:s.getCurrentBookmarkSection();a.section=c,0===o&&d?(a.isRoot=!0,d.type&&(a.pid=e),x.folderTree(a)):(a.pid=e,a.isRoot=!1,x.folderTree(a))}))},resolveSecurityContextOfSelectedFolder:function(t){var o=this;return new r((function(i,n){"FolderSection_AllFolders"!==t.options.id?x.getFolderProperties({pid:t.options.id}).then((n=>{e.is(n,"string")&&(n=JSON.parse(n)),t.options.appData.acl.securityContext=o.resolveCurrentSecurityContextBy(n.organizationResponsible,n.project),i(t.options.appData.acl.securityContext)})).catch((e=>{z(t,!1),n({type:"check",message:"("+t.options.label+")",raw:e})})):(t.options.appData.acl.securityContext=o.utils.getCurrentSecurityContext(),i(t.options.appData.acl.securityContext))}))},resolveCurrentSecurityContextBy:function(e,t){var o=this.utils.getCurrentSecurityContext(),i=o.split("."),n=i[1],r=i[2];return n===e&&r===t?o:(this._logger.warn("can't resolve securityContext : "+e+"."+t),null)},execImportCSV:function(){var e=this;e._cancel=!1,e._initProgress("success"),e.csvStatusArea.show();var t=e.root.getAllDescendants(),o=[],i=0;let n=[];for(var s=0;s<t.length;s++){var l,d=t[s];d.options.appData.hasId?(l=e.getFolder(d),i++):(l=e.createFolder(d),"@BLANK@"!==d.options.appData.acl.owner&&n.push(e.changeOwner(d))),o.push(l)}var c=0,u=null,p=o.length-i;n.forEach((e=>o.push(e))),o.reduce((function(t,o){return t.then((function(t){e.progress.value=c/p*100,e.notifyMessage("info","["+c+"/"+p+"] "+_.InfoMsg_Folder_Creating),("create"===t.type&&!t.changeOwnerNeeded||"changeowner"===t.type)&&c++})).then(o)}),r.resolve({type:"dummy"})).catch((function(e){u=e.message||e})).then((function(t){if(e.cancelButton.label=_.Close,B.publish({event:"refresh_content",data:{folderInfo:e._currentFolder}}),B.publish({event:"update_tree_new_node",data:{node:e._currentFolder}}),null===u)e.progress.value=100,e.notifyMessage("info","["+p+"/"+p+"] "+_.InfoMsg_Folder_Create_Success),e.csvStatusArea.hide(),a.displayNotification({message:_.InfoMsg_Folder_Create_Success,className:"success"});else{e.notifyMessage("error","["+c+"/"+p+"] "+_.ErrorMsg_Folder_Create_Stoped),e.progress.emphasize="high-attention";let t="object"==typeof u&&u.title?u:{message:u};t.className="error","object"==typeof u&&u.serverErr&&(t={...t,...u.serverErr}),a.displayNotification(t)}}))},createFolder:function(e){var t=this;return function(){return new r((function(o,i){if(t._cancel)return t._logger.log("Import operation canceled"),void i({type:"create",message:_.ErrorMsg_Folder_Create_Stoped,raw:""});var n;if(null!==(n="@BLANK@"!==e.options.appData.acl.securityContext?e.options.appData.acl.securityContext:e.getParent().options.appData.acl.securityContext)&&(t._mapSecurityContext[n]&&(n=t._mapSecurityContext[n]),e.options.appData.acl.securityContext=n),widget.odtWrongCtx||null===n)return z(e,!1),void i({type:"create",message:_.WarnMsg_SecurityContext_MissMatch,raw:""});let r=e.getParent().options.id;x.newFolder({title:e.options.appData.label,description:e.options.appData.description,parentBookmarkId:"FolderSection_AllFolders"!==r?r:null,forcedSecurityContext:n}).then((t=>{if(null===t||t.error||!t.results||0===t.results.length){z(e,!1);var n=t&&t.message?t.message:_.ErrorMsg_Folder_Create_Stoped;return void i({type:"create",message:n,raw:t})}var r=t.results[0].physicalid;e.options.id=r;let s="@BLANK@"!==e.options.appData.acl.owner;s||z(e,!0),e.options.icons=[m.getWebappsAssetUrl("FolderEditor","icons/folder_created.png")],e.updateOptions("icons"),o({type:"create",message:null,raw:t,changeOwnerNeeded:s})})).catch((t=>{let o=S.msg_error_createNew;z(e,!1),i({type:"create",message:o,raw:t})}))}))}},changeOwner:function(e){return function(){return new r((function(t,o){x.transferOwnership({user:e.options.appData.acl.owner,objectId:e.options.id,label:e.options.appData.label}).then((o=>{z(e,!0),t({type:"changeowner",message:null,raw:o})})).catch(o)}))}},getFolder:function(t){return function(){return new r((function(o,i){x.getFolderProperties({pid:t.options.id}).then((n=>{e.is(n,"string")&&(n=JSON.parse(n)),new Date(Date.parse(n.modified)).getTime()!==t.options.appData.modified.getTime()?(z(t,!1),i({type:"check",message:_.ErrorMsg_Exist_Folder_Modified+"("+t.options.label+")",raw:n})):o({type:"check",message:null,raw:n})})).catch((e=>{z(t,!1),i({type:"check",message:_.ErrorMsg_Rest_Error+"("+t.options.label+")",raw:e})}))}))}},_checkOwner:function(t,o,i){var n=this;return new r((function(t,r){var s=""===o||i[o];if(s)t(s);else{var l=void 0!==i.listeners[o],a=i.listeners[o]||[];a.push(t),i.listeners[o]=a,l||x.personSearch({name:o}).then((t=>{if((t=e.is(t,"string")?JSON.parse(t):t).data.length>0){let e=!1;for(let{dataelements:{name:i}}of t.data)if(i===o){e=!0;break}a.forEach((t=>{t(e)})),i[o]=e}else a.forEach((function(e){e(!1)})),i[o]=!1})).catch((e=>{!0,n._logger.log("response error personSearch "),a.forEach((function(e){e(null)}))}))}}))},listSecurityContext:function(){var e=[],t=widget.getPreference("pad_security_ctx");if(t){var o=t.options;Array.isArray(o)&&o.forEach((function(t){t.value&&e.push(t.value.replace("ctx::",""))}))}return e},_checkSecurityContext:function(e,t,o){var i=this;return new r((function(e,n){return""===t||i._mapSecurityContext[t]?void e(!0):void e(-1!==o.indexOf(t))}))},utils:{getCurrentSecurityContext:function(){var e=widget.getPreference("pad_security_ctx").value;return e.contains("ctx::")&&(e=e.split("::")[1]),e},getBrowserLanguage:function(){return A.getLanguage()}}});return G})),define("DS/FolderEditor/tagger/TaggerTreeProxy",["DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUXUtil/tagger/TaggerIPProxy","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/WidgetHandlerUtil","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r,s){var l="tree_filter_v1";return r.createSingleton(class extends o{constructor(){super(e,{name:"Tree",onlyLocal:!0,exclude:!0,events:{addOpenTaggerListener:()=>{this._onOpenTagger()}}}),this.activate(!1);let t=r.getTreeTaggerPreference(l);this.setLocalFilter(t),e.subscribe({event:"filterUpdatedTree"},(e=>{!function(e){r.setTreeTaggerPreference(l,e)}(this.getTaggerTags())})),this._refreshNeeded=!0,n.onTaggerStatusChange((()=>{this.activate(r.isTreeTaggerActive())}))}activate(e){super.activate(e),this.refresh(!0)}refresh(e){!this.isActive()||!this._refreshNeeded&&e?this._refreshNeeded=this._refreshNeeded||!e:(this.populateData(),this._refreshNeeded=!1)}_onOpenTagger(){this.refresh(!0)}removeFilters(){var e=this.getProxy().getCurrentFilter();e&&e.localfilters&&Object.keys(e.localfilters).length>0&&(this.getProxy().clearLocalFilter(),this.getProxy().dispatchEvent("onFilterChange",{localfilters:{}}),i.displayNotification({message:s.msg_info_treeFilterRemove,className:"primary"}))}populateData(){var e=this.getFilterTags();t.allBookmarks({filters:e||{},select_predicate:["physicalid"]}).then((e=>{this.addTags(e)})).catch((()=>{console.error("Unable to update Content root node, Error in getting content Properties")}))}})})),define("DS/FolderEditor/utils/FavoritesUtil",["UWA/Utils","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/Folder_CSO"],(function(e,t,o,i,n,r,s,l,a,d,c,u){let p={isFolderAmongFavoriteFolders:function(e,o){var i=!1;let n=t.getTreeRootSections()[o];if(n&&e&&e.id){var r=n.getChildren();if(r)for(var s=0;s<r.length;s++){var l=r[s];if(e.id==l.id){i=l;break}}}return i},getFavorites:function(t){var o=this,i=t;let l=a.getSection(t.section);return new s((function(s,a){n.getUserPreferences({withTenant:!0,name:l.prefName}).then((n=>{var l=[];if(n.length>0){var c=e.base64Decode(n);(c=JSON.parse(c)).data&&c.data.data&&c.data.data.favorite_folders&&(l=c.data.data.favorite_folders)}for(var u=-1,p=0;p<l.length;p++)"Personal Workspace"==l[p].type&&(u=p),l[p].favoriteTitle=l[p].name;let h=Promise.resolve();if(-1!=u){var g=UWA.clone(l);g.splice(u,1),h=o.saveFavorites({section:t.section,favoriteFolders:g}),h.then((()=>{l=g})).catch((e=>{r.displayNotification({message:d.msg_error_nopreferences,className:"error"})}))}h.finally((()=>{t&&t.noAttributes?s(l):o.getFavoritesInformation(i,l).then(s).catch(a)}))})).catch((e=>{t&&!0===t.silent||r.displayNotification({message:d.msg_error_nopreferences,className:"error"}),a(e)}))}))},getFavoritesWithCheck:function({nodes:e,withServerCall:o,noAttributes:i,withNotification:n,silent:l,section:c}){let u={favorites:e,alreadyExist:[],allIds:[]},h=t.getTreeRootSections()[c],g=h&&h.isExpanded();g&&(u.favorites=[],e.forEach((e=>{this.isFolderAmongFavoriteFolders(e,c)?u.alreadyExist.push(e):(u.favorites.push(e),u.allIds.push(e.id))})));let f=Promise.resolve(u);return!o&&g||(f=new s((function(e,t){u.allIds=[],p.getFavorites({noAttributes:i,silent:l,section:c}).addLinkTo(this).then((t=>{var o,i,n=t;let r={};for(i=0;i<n.length;i++){r[n[i].id]=!0}for(o=0;o<u.favorites.length;o++){var s=u.favorites[o];s&&(r[s.id]?u.alreadyExist.push(s):(u.allIds.push(s.id),n.push(u.favorites[o])))}u.favorites=n,e(u)})).catch(t)}))),n&&f.then((e=>{e.alreadyExist.forEach((e=>{r.displayNotification({message:d.replace(d.get("msg_warning_FolderAlreadyAmongFavorites"),{typeStruct:a.getTreeTypeNls(e.type),foldername:e.name}),className:"warning"})}))})),f},getFavoritesInformation:function(e,t){return new Promise(((o,n)=>{var r=e&&e.hasOwnProperty("view")?e.view:"None";if(t&&t.length>0){for(var s=[],a=new Map,d=0;d<t.length;d++){var c=t[d];c&&c.id&&(s.push(c.id),a.set(c.id,c))}if(s.length){var u={phids:s};l.getFavoritesProperties(u).then((e=>{var t=[];if((e="string"==typeof e?JSON.parse(e):e).results)for(var n=0;n<e.results.length;n++){var s=e.results[n];if(s&&s.id){var l=a.get(s.id);s.favoriteTitle=l.favoriteTitle,l.hasOwnProperty("isPersonal")&&(s.isPersonal=l.isPersonal),s.toRemove=!1,"CONTENT"!==r&&(s.name=l.name),t.push(s)}}if(e.inaccessible&&e.inaccessible.length>0){let o=[];for(n=0;n<e.inaccessible.length;n++){var d=e.inaccessible[n];if(d)(l=a.get(d)).toRemove=!0,t.push(l),o.push({id:d})}i.publish({event:"remove_tree_nodes",data:{nodes:o}})}o(t)})).catch((()=>{o(t)}))}}else o(t)}))},saveFavorites:function(t){for(var i=t.favoriteFolders,l={data:{protocol:"3DXContent",version:"1.0",source:"ENOFOL3_AP",data:{favorite_folders:[]}}},c=0;c<i.length;c++){var u=i[c];if(u.id&&u.name){var p={id:u.id,name:u.name};p.type=u.type,p.mxid=u.mxid?u.mxid:void 0,u.isPersonal&&(p.isPersonal=!0),u.inherit&&(p.inherit=!0),l.data.data.favorite_folders.push(p)}}return new s((function(i,s){if(!t.noCheckLimit&&l.data.data.favorite_folders.length>o.MAX_NUMBER_FAVORITES)r.displayNotification({...d.msg_error_exceedFavoriteLimit,message:d.replace(d.msg_error_exceedFavoriteLimit.message,{maxLimit:o.MAX_NUMBER_FAVORITES}),className:"error"}),s({});else{let o=a.getSection(t.section);n.saveUserPreferences({withTenant:!0,name:o.prefName,value:e.base64Encode(JSON.stringify(l))}).addLinkTo(this).then((()=>{i(l.data.data.favorite_folders)})).catch((e=>{let t={message:d.msg_error_preferencessnotsaved,className:"error"};"string"==typeof e&&(t.title=t.message,t.message=e),r.displayNotification(t),s(e)}))}}))},removeFavorites:function(e,t){var o=this;e=Array.isArray(e)?e:[e];var n=[];return e.forEach((e=>{n.push(e.id)})),new Promise(((s,l)=>{o.getFavorites({noAttributes:!0,section:t,view:"FORREMOVE"}).then((a=>{for(var c=a,u=0,p=c.length-1;p>=0;p--){var h=c[p];-1!==n.indexOf(h.id)&&(c.splice(p,1),u++)}u>0?o.saveFavorites({section:t,favoriteFolders:c,noCheckLimit:!0}).then((o=>{if(1===e.length){var n=e[0].name?e[0].name:"";r.displayNotification({message:d.replace(d.get("msg_info_favoriteremoved"),{name1:n}),className:"success"})}else r.displayNotification({message:d.replace(d.get("msg_info_favoritesremoved"),{number:e.length}),className:"success"});i.publish({event:"remove_favorite",data:{favoriteFoldersToRemove:e,section:t}}),s(o)})).catch((e=>{l("WebService saveFavorites Err : "+e.err)})):l("FolderTreeCont favorite folder to remove, not found in list")})).catch((e=>{l("WebService getFavorites Err : "+e.err)}))}))},addFavorite:function(e,t){if(e){var o=Array.isArray(e)?[...e]:[e];return new Promise(((e,n)=>{let s=!0,l=a.getSection(t);o.every((e=>(s=l._accept.has(e.type),s))),s?this.getFavoritesWithCheck({nodes:o,withServerCall:!0,noAttributes:!0,withNotification:!0,section:t}).then((o=>{let s=o.favorites,l=o.allIds;p.saveFavorites({favoriteFolders:s,section:t}).then((o=>{let n=[];o.forEach((function(e){l.indexOf(e.id)>=0&&(n.push(e),r.displayNotification({message:d.replace(d.get("msg_info_favoriteadded"),{name1:e.name}),className:"success"}))})),i.publish({event:"favorite_added",data:{favoritesToAdd:n,section:t}}),e()})).catch((e=>{console.log("WebService _setFavorites Err : "+e.err),n(e)}))})).catch((e=>{console.log("WebService getFavorites Err : "+e.err),n(e)})):n({err:d.err_UnsupportedFavoriteType})}))}console.log("FolderTreeCont unable to addFavorite, newFavoriteFolder(s) is not define")},renameFavorite:function(e,t){var o=this;function i(){let t=d.get("msg_error_rename");r.displayNotification({title:d.replace(t.title,{name:e.name}),subtitle:t.subtitle,message:t.message,className:"error"})}let n=u.getCurrentBookmarkSection();return new s((function(s,l){o.getFavorites({section:n}).then((a=>{for(var u=!0,p=a,h=0,g=0;g<p.length;g++){var f=p[g];if(e.id==f.id){f.name===t&&(u=!1),f.name=t,h=1;break}}h?o.saveFavorites({favoriteFolders:p,section:n}).then((o=>{u&&(r.displayNotification({message:d.replace(d.get("msg_info_favoriterenamed"),{name1:e.name,name2:t}),className:"success"}),c.notifyFavoriteRename({id:e.id,favoriteTitle:t,section:n})),s(o)})).catch((e=>{i(),l(e)})):(i(),l("favorite folder to rename, not found in list"))})).catch((e=>{i(),l(e)}))}))}};return p})),define("DS/FolderEditor/commands/ActionBar_AddToFavoritesCmd",["UWA/Core","DS/FolderEditor/utils/FavoritesUtil","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/Folder_CSO","DS/Utilities/Utils","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/SettingsHandler"],(function(e,t,o,i,n,r,s){"use strict";let l=!1;return o.extend({labelTopBar:r.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(e){this._parent(e,{});var o=this;let a=e.context,d=n.debounce(this._adaptStateToCurrentFolder.bind(this),100);i.onChange(d),this.onStateChange((function(){if(!l)if(o.getState()){if((h=i.getSelectedNodes())&&h[0]){var e=h[0],n=e.getID(),a=e.getType(),d=e.getLabel(),c=e.getAttributeValue("mxid"),u=e.isPersonal;if(n&&s.isTypeAccepted(a,"FolderSection_favorite")){var p={id:n,name:d,type:a,isPersonal:u,mxid:c,inherit:"SHARED"===e.getAttributeValue("folderClassification")};t.addFavorite(p,"FolderSection_favorite").catch((e=>{console.log(e),i.getCurrentBookmarkId()===n&&(l=!0,o.setState(!1,!1))}))}}o.labelTopBar=r.label_ActionBar_RemoveFromFavorites}else{var h;if(h=i.getSelectedNodes()){var g=[];h.forEach((e=>{if(e.getID){var t=e.getID(),o=e.getType(),i={id:t,name:e.getLabel(),type:o,isPersonal:e.isPersonal};s.isTypeAccepted(o,"FolderSection_favorite")&&g.push(i)}})),g.length&&t.removeFavorites(g,"FolderSection_favorite").catch((e=>{1===g.length&&i.getCurrentBookmarkId()===g[0].id&&(l=!0,o.setState(!0,!1))}))}o.labelTopBar=r.label_ActionBar_AddToFavorites}l=!1})),this._adaptStateToCurrentFolder(a)},_adaptStateToCurrentFolder:function(e){var o=i.getSelectedNodes();if(o&&o[0]&&o[0].getID){var n=o[0],r={id:n.getID(),name:n.options.label,type:n.getType()};n.toRemove?(l=!0,this.setState(!0,!1)):t.getFavoritesWithCheck({nodes:[r],noAttributes:!0,silent:!0,section:"FolderSection_favorite"}).then((e=>{l=!0,this.setState(e.alreadyExist.length>0,!1)}))}}})})),define("DS/FolderEditor/service/BkOperationsUtils",["DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/ProgressPaneExecution","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUXUtil/ActionBar/IPCommandManager"],((e,t,o,i,n,r,s,l)=>{function a(e){return e?"string"!=typeof e?Promise.resolve(e):t.getBookmarkInfo(e):t.getCurrentBookmarkInfo()}function d(t,i,n,r){let l=t.getLabel(),a=t.getType();r=r||"",0!==i&&0!=n?e.displayNotification({message:s.replace(s.msg_info_Addinfolder,{objectsAlreadyPresent:i,objectsAdded:n,typeStruct:o.getTreeTypeNls(a),targetfolder:l})+r,className:"success"}):0==n?e.displayNotification({message:s.replace(s.msg_info_Addinfolder_2,{objectsAlreadyPresent:i,targetfolder:l}),className:"success"}):e.displayNotification({message:s.replace(s.msg_info_Addinfolder_1,{objectsAdded:n,typeStruct:o.getTreeTypeNls(a),targetfolder:l})+r,className:"success"})}function c(t,o,i){if(console.log(t),t&&t.title&&t.message)e.displayNotification({...t,className:"error"});else if(t&&t.advice){let o=s[i];e.displayNotification({title:o||i,subtitle:t.advice,message:t.error,className:"error"})}else if(t&&t.message&&t.message.contains("NetworkError")&&t.message.contains("500"))e.displayNotification({...s.msg_error_objectNoLongerAccessible,className:"error"});else if("string"==typeof t&&t.contains("No modify access to relationship 'Vaulted Objects'"))e.displayNotification({message:s.msg_error_NoModifyAccess,className:"error"});else{let o=s[i],n=o||i,r={className:"error"};r.message=n,t&&(r.message=t,r.title=n),e.displayNotification(r)}}function u(t){let i=[],n={space:[],external:[]};for(let e in n)n[e].key=e;let r={};t.forEach((t=>{let l="string"==typeof t?t:t.id;if(!r[l]){r[l]=!0;let a=o.isExternalObject(t)?"external":"space",d=n[a],c=l;if("space"!==a&&(c=t,"object"!=typeof c))throw e.displayNotification({...s.operationNotSupported,className:"error"}),"not supported";if(d.push(c),100===d.length){i.push(d);let e=[];e.key=a,n[a]=e}}}));for(let e in n){let t=n[e];t.length>0&&i.push(t)}return{list:i,count:Object.keys(r).length}}function p(e){let t={};return e.forEach((e=>{let o="string"==typeof e?e:e.getID();t[o]={}})),t}function h(e){let t=e.getAttributeValue("folderClassification")||e.getAttributeValue("ds6w:classification");return t&&"shared"===t.toLowerCase()}async function g(e,t){if(window.warnRefreshIfNeeded&&e.find((e=>h(e)))){let e=p(t);window.warnRefreshIfNeeded(e)}}async function f(e,t,{title:o,button:i}){let n=!0;if(window.onModifiedObjectsCheck&&e.find((e=>h(e)))){let e=p(t);n=(await window.confirmModifiedInSession(e,{title:o,button:i})).continue}return n}return{processRemoveOperation:function(t,i,d){return(async()=>{let c=null;if(t.length>0){let h=u(t),m=h.list,v=await a(i);if(!await f([v],t,{title:s.CMDRemoveContent,button:s.button_remove}))return;var p=l.getCommandByContext("RemoveContent");p.disable();let _=v.getLabel();if(c=await r.execute({title:s.replace(s.progressPanel_remove,{objectsAdded:h.count,targetfolder:v.getLabel()}),datas:m,query:e=>this.removeContent(e,v,d)}),!d){let i=0,r=0;if(c.forEach((e=>{e&&void 0!==e.numberOfContentNotRemoved&&(i+=e.numberOfContentNotRemoved,r+=e.numberOfContentRemoved)})),0==r&&i>0)e.displayNotification({message:s.replace(s.msg_info_objetnotremoved,{number:i,typeStruct:o.getTreeTypeNls(v.getType()),foldername:_}),className:"success"});else if(0==i&&r>0)e.displayNotification({message:s.replace(s.msg_info_objetremoved,{number:r,typeStruct:o.getTreeTypeNls(v.getType()),foldername:_}),className:"success"});else if(i>0&&r>0){let t=s.replace(s.msg_info_objetremoved,{number:r,typeStruct:o.getTreeTypeNls(v.getType()),foldername:_})+" "+s.replace(s.msg_info_objetnotremoved,{number:i,typeStruct:o.getTreeTypeNls(v.getType()),foldername:_});e.displayNotification({message:t,className:"success"})}r>0&&g([v],t),h.count>10&&n.publish({event:"refresh_content",data:{keepExpandStatus:!0}}),p.enable()}}else e.displayNotification({message:s.msg_warning_nocontent,className:"warning"});return c})()},processAddOperation:async function(e,t,o,{areLinkedFolders:l}={}){if(e.length>0){let c=e.length,p=1===e.length&&e[0].getLabel&&e[0].getLabel(),h=u(e).list,m=await a(t);if(!await f([m],e,{title:s.operation_add,button:s.toAdd}))return;let v=m.getLabel(),_=await r.execute({title:s.replace(s.progressPanel_add,{objectsAdded:c,targetfolder:v}),datas:h,query:e=>this.addContent(e,m,{title:p,checkLinkExists:o,areLinkedFolders:l})}),S=0,C=0;if(_.forEach((e=>{e&&(S+=e.objectsAdded,C+=e.objectsAlreadyPresent)})),0==S&&0==C||d(m,C,S),S>0){i.getCurrentBookmarkId()==m.getID()&&n.publish({event:"refresh_content",data:{keepExpandStatus:!0}}),g([m],e)}}},processMoveOperation:async function(t,l,d,{checkSourceRelation:c,areLinkedFolders:p}={}){let h={itemsNotInSourceFolder:[]};if(t.length>0){let m=t.length,v=u(t).list,_=await a(l),S=await a(d);if(!await f([S,_],t,{title:s.confirmation_move_title,button:s.Move_label}))return;let C=_.getID();answers=await r.execute({title:s.replace(s.progressPanel_move,{objectsAdded:m,targetfolder:S.getLabel()}),datas:v,query:e=>this.moveContent(e,C,S,{checkSourceRelation:c,areLinkedFolders:p})});let y=0,b=0;if(answers.forEach((e=>{e&&(y+=e.objectsMoved,b+=e.objectsAlreadyPresent,e.itemsNotInSourceFolder&&e.itemsNotInSourceFolder.forEach((e=>{h.itemsNotInSourceFolder.push(e)})))})),0==y&&0==b||function(t,i,n){let r=t.getLabel();0!==i&&0!==n?e.displayNotification({message:s.replace(s.msg_info_objetmoved,{objectsAlreadyPresent:i,objectsMoved:n,typeStruct:o.getTreeTypeNls(t.getType()),targetfolder:t.getLabel()}),className:"success"}):0==n?e.displayNotification({message:s.replace(s.msg_info_objetmoved_2,{objectsAlreadyPresent:i,targetfolder:r}),className:"success"}):e.displayNotification({message:s.replace(s.msg_info_objetmoved_1,{objectsMoved:n,typeStruct:o.getTreeTypeNls(t.getType()),targetfolder:t.getLabel()}),className:"success"})}(S,b,y),y>0){let e=i.getCurrentBookmarkId();e!=S.getID()&&e!=C||n.publish({event:"refresh_content",data:{keepExpandStatus:!0}}),g([S,_],t)}}return h},moveContent:function(e,o,r,{checkSourceRelation:s,areLinkedFolders:l}={}){let a=r.getID();return new Promise((d=>{t.MoveContent({IDs:e,targetNode:r,targetfolder:a,sourcefolder:o,checkSourceRelation:s,areLinkedFolders:l,callbacks:{onComplete:function(e){let t=0,r=0,s=null;e&&(t=e.objectsAlreadyPresent,r=e.objectsMoved,s=e.itemsNotInSourceFolder);let l=i.getCurrentBookmarkId();l&&l===o&&n.publish({event:"refresh_content",data:{keepExpandStatus:!0}}),d({objectsMoved:r,objectsAlreadyPresent:t,itemsNotInSourceFolder:s})},onFailure:function(e){d();let t=e.err||e.error||e;e&&e.serverErr&&e.serverErr.error&&"string"==typeof e.serverErr.error&&e.serverErr.error.length>0?c(e.serverErr.error,0,"msg_error_MoveInfolder"):("string"!=typeof t&&(t=t.toString()),c(t,0,"msg_error_MoveInfolder"))}}})}))},addContent:function(e,o,{title:i,checkLinkExists:n,fetchAttributes:r,areLinkedFolders:l}){return(async()=>{let u=await a(o);return await new Promise((o=>{let a={IDs:e,fetchAttributes:r,checkLinkExists:n,areLinkedFolders:l,target:u,folderId:u.getID(),callbacks:{onComplete:function(e){var t=0,i=0,n=null;e&&(t=e.objectsAlreadyPresent,i=e.objectsAdded,n=e.information?" ("+e.information+")":n);let r=n?null:{attributes:e.attributes,objectsAdded:i,objectsAlreadyPresent:t};o(r),n&&d(u,t,i,n)},onFailure:function(t){if(t&&t==s.AddContentError){let t={objectsAdded:0,objectsAlreadyPresent:e.length};o(t)}else{let e;o(),t&&t.serverErr&&"string"==typeof t.serverErr.error&&t.serverErr.error.length>0&&(e=t.serverErr.error);let n=e||t,r="msg_error_Addinfolder";i&&(r=s.replace(s.msg_error_Addinfolder_obj,{object:i})),c(n,u.getID(),r)}}}};t.AddContent(a)}))})()},removeContent:function(e,i,r){let l=i.getID();return new Promise((a=>{t.RemoveContent({IDs:e,source:i,folderId:l,callbacks:{onComplete:function(t){let o=0,i=0;if(t){var s=t;i=e.length-s.NumberOfContentRemoved,o=s.NumberOfContentRemoved}if(!r&&e.length<10)for(var d=0;d<e.length;d++){var c=e[d];let t="string"==typeof c?c:c.getID();n.publish({event:"remove_nodes",data:[t]})}a({bookmarkId:l,numberOfContentRemoved:o,numberOfContentNotRemoved:i})},onFailure:function(e){let t=e.err||e.error||e;if(a({bookmarkId:l,error:t,networkErr:!1!==e.networkErr}),e&&e.serverErr&&e.serverErr.error){const t=e.serverErr.error;"string"==typeof t&&t.length>0&&c(t,0,s.replace(s.msg_error_Removefromfolder,{typeStruct:o.getTreeTypeNls(i.getType(),!1)}))}else r||("string"!=typeof t&&(t=t.toString()),t.includes("Error: NetworkError")?c(t,0,"msg_error_OnRefreshCmdfailure"):c(t,0,s.replace(s.msg_error_Removefromfolder,{typeStruct:o.getTreeTypeNls(i.getType(),!1)})))}}})}))}}})),define("DS/FolderEditor/commands/ActionBar_AddExistingContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/service/BkOperationsUtils","DS/FolderEditor/utils/SettingsHandler"],(function(e,t,o,i,n,r){"use strict";return t.extend({labelTopBar:e.i18n("Add Content"),isInsert:!0,datas:{},_modalChooser:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/Folder_CSO","DS/IPClassifyUXUtil/IPClassifyUXUtilities/view/IPClassifyModalChooser","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderServices","DS/UIKIT/Mask"],(function(e,t,o,i,n,r,s){}));var t=this;widget.addEvent("onRefresh",(function(){UWA.is(t._modalChooser)&&(t._modalChooser.close(),t._modalChooser=null)}))},execute:async function(){var e=this,t=require("DS/FolderEditor/Folder_CSO"),n=require("DS/IPClassifyUXUtil/IPClassifyUXUtilities/view/IPClassifyModalChooser"),s=require("DS/IPClassifyUtil/IPClassifyAlert"),l=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),a=(require("DS/FolderEditor/utils/FolderEditorControl"),require("DS/FolderEditor/service/FolderServices"));if(t.getCurrentBookmarkId().length){let t=await a.getCurrentBookmarkInfo();var d=o.isWebInWin();if(d)d&&i.publish("SelectFromSearch",{});else{UWA.is(this._modalChooser)&&this._modalChooser.close();let o=r.getDefaultSection(t.type),i=o.roots?o.roots:[];o.sub&&o.sub.types&&o.sub.types.forEach((e=>i.push(e))),i=i.map((e=>"Not(types/"+e+")")).join(" AND "),e._modalChooser=new n({renderTo:document.body,in_apps_search:{precond:i,in_apps_callback:e._objects_selected.bind(e)}})}}else s.displayNotification({message:l.msg_warning_nocurrentfolder,className:"warning"})},_objects_selected:function(e){var t=require("DS/FolderEditor/Folder_CSO"),o=require("DS/IPClassifyUtil/IPClassifyAlert"),i=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),r=require("DS/IPClassifyUtil/IPServicesMgr");let s=require("DS/FolderEditor/service/FolderEditorWebService");var l=[],a=r.getPlatformId(),d=!1;e.forEach((function(e){var o=e.resourceid;let i=e.sourceid,n=null,r=null;if(i){var c=i.split(":");r=c[0],c.length>1&&(n=c[1])}n&&n!==a?d=!0:l.push(t.getDefaultModelFromProperties({id:o,serviceId:s.getServiceFromSource(r),i3dx:e["ds6w:i3dx"],title:e["ds6w:label"]}))})),!0===d&&o.displayNotification({message:i.msg_warning_addnotsupported_from_different_tenant,className:"warning"}),n.processAddOperation(l)},endExecute:function(){}})})),define("DS/FolderEditor/utils/BookmarkLocationUtil",["UWA/Core","UWA/Utils","UWA/Class","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/GridUtils","DS/FolderEditor/Folder_CSO","DS/FolderEditor/popup/BookmarkLocationPopup","DS/FolderEditor/utils/FolderEditorControl","i18n!DS/FolderEditor/assets/nls/BookmarkLocationPopup","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/Utilities/Dom","DS/FolderEditor/utils/FolderSearch","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/SettingsHandler"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m){"use strict";return o.singleton({openBookmark:async function(e){let t=e.getAttributeValue("_paths");if(void 0===t){t=(await this.updateNodesWithPath([e])).pids[e.id]._paths}if(t)if(1==t.length){let e=t[0].info,i=e[e.length-1];var o={id:i.resourceid,type:i.type,name:i.label};this._selectBookmarkInTree(o)}else{let e=l.getCurrentEltTypeNls();var i={message:c.replace(c.OpenLocationPopupLable,{typeStruct:e}),radio:!0,okButtonLabel:c.Open,onOkClick:e=>{this.locationPopop.dialog.close();var t={id:e.info.resourceid,type:e.info.type,name:e.info.label};this._selectBookmarkInTree(t)}};this.locationPopop=new a(t,this.getHtmlElemFromPath.bind(this),i)}},updateNodesWithPath:function(e){let t=h.getRootBookmarks(),o=t?Object.keys(t):null,i=Promise.resolve();if(o&&o.length>0){let s=o[0],l=t[s].getType(),a=m.getDefaultSection(l),d={},c={};e.forEach((e=>{let t=e.getAttributeValue("links");t=t||[{id:e.getID(),owner:e.getID()}],t.forEach((e=>c[e.owner]=!0)),d[e.getID()]=t}));let p=Object.keys(c);i=new Promise((e=>{n.getParentPath({objectIds:p,section:a}).then((async o=>{if(o.expandData&&o.labelData){let n=o.expandData,s=o.labelData,l={};for(var i in p.forEach((e=>{l[e]={roots:{},paths:[],element:null}})),Object.keys(n).forEach((e=>{let o=[],i=[],r=n[e].length;if(r>0){let a=e.toString(),d=l[a],c=s[e];d.element={resourceid:e,label:c.label,type:c.type};for(let t=r-1;t>=0;t--){const s=n[e][t];!d||d.roots[n[e][t].id]&&t!==r-1||(o.push(s.label),i.push(s),"1"===s.level&&(i.push(s),d.paths.push({path:[...o],info:[...i]}),o=[],i=[]))}if(d&&1==Object.keys(t).length){let e=[];d.paths.forEach(((o,i)=>{for(let i=0;i<o.info.length;i++)if(o.info[i].resourceid==Object.keys(t)){o.path.splice(0,i),o.info.splice(0,i),e.push(o);break}})),d.paths=[];for(let t=0;t<e.length;t++)d.paths.push({path:[...e[t].path],info:[...e[t].info]})}}})),l){let e=l[i];if(!e.element){let o=t[i];o?e.element={label:o.getLabel(),type:o.getType(),id:o.getID(),resourceid:o.getID()}:delete l[i]}}let a=await r.getCurrentBookmarkInfo(),c={};for(let e in d){let t=d[e],o=[];t.forEach((t=>{let i=t.owner,n=l[i];if(n){let r=n.paths;if(n.element){let o=[];i!==e?r.length>0?r.forEach((e=>{o.push({path:[...e.path,n.element.label],info:[...e.info,n.element],linkInfo:t})})):o.push({path:[n.element.label],info:[n.element],linkInfo:t}):0===r.length&&o.push({path:[a.getLabel()],info:[{resourceid:a.getID(),type:a.getType(),label:a.getLabel()}],linkInfo:t}),o.length>0&&(r=o)}r.length>0&&(o=[...o,...r])}})),o.length>0&&(c[e]={_paths:o,bookmarkLocation:o.length>1?u.replace(u.name_Section_ParentFolders,{number:o.length}):o[0].path.join(" > ")})}e({pids:c})}})).catch((t=>{console.log(t),e({})}))}))}return i},getResizedText:function(e,t,o,i){function n(e,t){if(e>=t.length)return t;let o="...";e-=3;let i=t.split(">");i=i.filter((e=>e!==o));let n=-1,r=i.length-1,s=0;for(;n<r;){if(!(s+i[r].length+1<e)){++r;break}if(s+=i[r].length+1,--r,!(s+i[n+1].length+1<e)){++r;break}++n,s+=i[n].length+1}let l="";for(let e=0;e<=n;++e)l+=i[e]+">";if(l+=o,i.length-r<=1&&n<0)l+=">"+i[i.length-1],l.length>e&&(l=l.substring(0,e-3)+o);else for(let e=r;e<i.length;++e)l+=">"+i[e];return l}let r=e/t,s=Math.floor(i.length*r);if(o.indexOf(":")>=0){if(s>o.length)return o;let e="...";return e+o.substring(o.length+e.length-s,o.length)}if(-1===o.indexOf(">")){if(s>o.length)return o;let e="...";return o.substring(0,s-e.length)+e}return n(s,e>=t?o:i)},getHtmlElemFromPath:function(e,t){var o=this,i=UWA.createElement("span",{class:"bk-ellipsys-root",titlex:e}),n=UWA.createElement("span",{class:"bk-ellipsys-child"});return n.innerText=e,n.inject(i),t?i.computeContentSize=function(){let e=0;var o=s.getFontDetails(t);if(o){var i=o.fontSize,n=o.fontSytle;e=Math.ceil(p.computeStringWidth(this.title,i,n,!1,!1))}return e}:(i._prevWidth=0,i.addEvent("resize",(function(e){let t=this.getDimensions().width;this._prevWidth!=t&&(this._prevWidth=t,this.childNodes&&this.childNodes.length>0&&this.childNodes[0].getDimensions&&(this.childNodes[0].innerText=o.getResizedText(e.target.clientWidth,this.childNodes[0].getDimensions().width,this.getAttribute("titlex"),this.childNodes[0].innerText)))}))),i.setData=function(e){this.setAttribute("titlex",e),this.childNodes&&this.childNodes.length>0&&(this.childNodes[0].innerText=e)},i},_selectBookmarkInTree:function(e){l.setNextSelection({objectId:e.id,contentId:l.getSelectedNodes()[0].getID()}),l.getCurrentBookmarkId()!==e.id?l.dispatchBookmarkPropsSelection({id:e.id,type:e.type,label:e.name}):h.isSearchActive()&&h.clearSearch()}})})),define("DS/FolderEditor/utils/OpenWithHandler",["DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/BookmarkLocationUtil","DS/FolderEditor/popup/BookmarkLocationPopup","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/IPClassifyUtil/IPClassifyModelEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r,s,l,a){"use strict";return class{constructor(e){this.FolderID=e.FolderID,this.X3DItem=e.X3DItem,this.type=e.X3DItem.objectType,this.objectTitle=e.X3DItem.displayName,this.objectId=e.X3DItem.objectId,this.dispatchBookmarkNodeSelection=e.dispatchBookmarkNodeSelection,this.commonModel=e.commonModel}handleOperation(){this.node=this.commonModel,this.FolderID&&(this.node.id=this.FolderID),this.objectId&&(this.node.id=this.objectId,this.X3DItem.serviceId&&(this.node.serviceId=this.X3DItem.serviceId)),this.objectId&&e.isExternalObject(this.node)?(this._addLoader(),this._handlCSLObject()):this.FolderID&&this.type&&!e.isTreeType(this.type)?(this._addLoader(),this._handleObject()):this._openBookmark()}async _handlCSLObject(){try{if(this.X3DItem.i3dx){let e=this.X3DItem.i3dx,o=await t.findCSLInBookmarks({uri:e});if(o&&o.bookmarks&&o.bookmarks.length>0){let e=!0;this._getParentPath(o.bookmarks,e)}else this._removeLoader(),this._callWarningObjectNotAssociated()}}catch(e){console.log(e),this._removeLoader(),this._callNotSupported()}}async _getParentPath(o,i){try{let n,r=await t.getParentPath({objectIds:o,section:e.getDefaultSection(this.type)});if(r&&r.expandData){if(1===Object.keys(r.expandData).length){let e=o[0];n=this._rearrangeDataSingle(r,e,i),0===n.length&&(this._removeLoader(),this._callWarningObjectNotAssociated())}else n=this._rearrangeDataMultiple(r,o);if(n)if(1===n.length){let e=n[0].info.length,t=n[0].info[e-1],o=t.id?t.id:t.resourceid;this._removeLoader(),this._openBookmark(o)}else n.length>1&&(this._removeLoader(),this._callPopup(n))}}catch(e){console.log(e),this._removeLoader(),this._callNotSupported()}}_rearrangeDataSingle(e,t,o){let i=[],n=[],r=[],s=t||this.objectId,l=e.expandData[s],a=e.labelData[s];for(let e=l.length-1;e>=0;e--)"1"!=l[e].level?(i.push(l[e].label),n.push(l[e])):(i.push(l[e].label),n.push(l[e]),o&&(i.push(a.label),n.push({label:a.label,resourceid:s})),r.push({path:i,info:n}),i=[],n=[]);return 0===l.length&&o&&r.push({path:[a.label],info:[{label:a.label,id:s}]}),r}_rearrangeDataMultiple(e,t){let o=[],i=[],n=[];return t.forEach((t=>{let r=e.expandData[t],s=e.labelData[t];if(0===r.length)n.push({path:[s.label],info:[{label:s.label,resourceid:t}]});else if(r.length>0)for(let e=r.length-1;e>=0;e--){let l=r[e];"1"===l.level?(o.push(l.label),o.push(s.label),i.push(l),i.push({label:s.label,resourceid:t}),n.push({path:o,info:i}),o=[],i=[]):(o.push(l.label),i.push(l))}})),n}_callPopup(e){let t=this,n={title:a.openWithTitle+" "+widget.title,message:a.openWithMessage,radio:!0,okButtonLabel:a.CMDOpen,onOkClick:e=>{t.locationPopop.dialog.close();let o=e.selectPathIDToNav;t._openBookmark(o)}};this.locationPopop=new i(e,o.getHtmlElemFromPath.bind(o),n)}_openBookmark(e){let t;if(e?t={...this.commonModel,id:e}:this.FolderID&&(t=this.node),t){r.switchtoAuthoringMode(),this.dispatchBookmarkNodeSelection(t,e&&{idToHighlight:this.objectId})||l.publish({event:"select_content_from_openwith",data:this.X3DItem})}}_handleObject(){this._getParentPath([this.objectId])}_callWarningObjectNotAssociated(){let t,o=e.getWidgetNls("warningNotBookmarked");t=o?a.replace(o,{label:this.objectTitle,typeStruct:e.getTreeTypeNls()}):a.replace(a.warningNotAssociated,{label:this.objectTitle}),t&&(widget.options&&widget.options.title&&(t+=" "+widget.options.title),n.displayNotification({message:t,className:"warning"}))}_callNotSupported(){n.displayNotification({message:a.replace(a.openWithNotSupported,{label:this.objectTitle}),className:"warning"})}_addLoader(){let e="";this.objectTitle&&(e=" - "+this.objectTitle),s.addComponentsToLoad("global",{openWithBookmarkLoader:a.lookingForObject+e},{withCancel:!0,cancelObject:{cancel:()=>{}}})}_removeLoader(){s.removeComponentToLoad("global","openWithBookmarkLoader")}}})),define("DS/FolderEditor/controllers/CommonMode",["DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/WidgetHandlerUtil","UWA/Controls/Abstract"],(function(e,t,o,i,n){var r=[];var s=n.extend({defaultOptions:{filteringByService:!0,contentView:null},init:function(e){this._parent(e),this._contentHandleRequest=null},cancelQuery:function(){this._contentHandleRequest&&this._contentHandleRequest.cancel(),this._contentHandleRequest=null},cancelFacetsLoading:function(){this._taggerHandleRequest&&this._taggerHandleRequest.cancel&&this._taggerHandleRequest.cancel(),this._taggerHandleRequest=null},smartFilteringAvailable:function(){return!1},filteringByService:function(){return this.options.filteringByService},allContentLoadedWithoutFilterTable:function(){return!0},wasScrollingReset:function(){return!1},isInfiniteScrollingEnded:function(){let e=!0;if(this.withInfiniteScrolling&&this.withInfiniteScrolling()){let t=Math.min(o.getResultsCount(),i.ROOTS_PER_PAGE),n=this.getNumberLastResult();e=0===n||n<t,o.searchingInRoot&&(e=o.getScrollEndStatus())}return e},loadContents:function(){r.forEach((e=>{e.cancelQuery()})),r=[]},loadFacet:function(){var o=t.facetsComputationActives();(this.cancelFacetsLoading(),o)&&this.loadFacets.apply(this,arguments).then((async o=>{let i=o.synthesis?o.synthesis:o;i="string"==typeof i?JSON.parse(i):i,await t.addTags(i),o.updateTableFilter&&e.publish({event:"update_filter_with_tags",data:{tags:i.facets}})})).catch((e=>console.log("Cannot load the facets")))},areFacetsCalled:function(){return this.wasScrollingReset()||!!this._taggerHandleRequest},loadContent:function(){var e=this.loadContents.apply(this,arguments);return e&&e.catch((function(e){console.log("Error: "),console.log(e)})).finally((()=>{this._contentHandleRequest=null})),r.push(this),e},disable:function(){this.cancelQuery(),this.cancelFacetsLoading()}});return s})),define("DS/FolderEditor/plugins/product/PrdUtils",["DS/i3DXCompassServices/i3DXCompassPubSub","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUXUtil/OpenWithMenuBuilder","DS/IPClassifyUtil/IPServicesMgr"],((e,t,o,i,n)=>{let r={version:"2.2",results:[],structures:[],viewpoint:[]};function s(e,t,o,i){let n=null;e.forEach((e=>{let r=o[e];if(!r){let s=i[e],l=Object.keys(o).length+1+"",a={id:l,phid:e};s&&s["ds6w:cadMaster"]&&(a.CADOrigin=s["ds6w:cadMaster"]),t.results.push(a),o[e]=r={id:l,show:!0,children:[]},n&&n.children.push(o[e])}n=o[e]}))}function l(e,o,i){i=void 0===i||i;var n,l=UWA.clone(r),a={};let d={};for(n=0;n<e.length;n++){let t=e[n].getRoot().getID();void 0===a[t]&&(a[t]={paths:[]});let o=e[n].getOccurencePath((e=>{d[e.getID()]={"ds6w:cadMaster":e.getAttributeValue("ds6w:cadMaster")}}));a[t].paths.push(o)}let c=null,u={};c=Promise.resolve(),i&&(c=new Promise(((e,o)=>{t.expandOfProducts(a,{select_object:["ds6w:cadMaster","physicalid"]}).then((t=>{t.results&&t.results.forEach((e=>{if(e.Path){s(e.Path,l,u,d)}else e.resourceid&&(d[e.resourceid]=e)})),e(t.results)})).catch(o)}))),c.then((t=>{if(!t||0===t.length||0===Object.keys(u).length)for(var o in a){a[o].paths.forEach((e=>{s(e,l,u,d)}))}e.forEach((e=>{let t=u[e.getID()];t&&(t.select=!0)}));for(let e in a){u[e]&&l.structures.push({structure:[u[e]]})}})).catch((e=>{console.log(e)})).finally((()=>{o(l)}))}function a(e){return new Promise(((t,o)=>{i.getTypeInheritance(e).then((e=>{let o=!0;for(let t in e)if(e[t].indexOf("VPMReference")<0){o=!1;break}t(o)})).catch(o)}))}async function d(e){let t=!0;return e.every((e=>(t=e.isRoot(),t))),t}let c=!1;return{expandIsRequired:async function(e){let t=await Promise.all([d(e),a(e)]),o=t[0];return t[1]&&!o},selectedNodesContainsOnlyVPMReference:a,buildDataForSetTypes:l,setTypesForOFW:function(t){let i={widgetId:n.getWidgetId()};c||(e.subscribe("setTypesCallback",(async r=>{if(r.widgetId===n.getWidgetId()){var s=t.getSelectedNodesForOFW();if(s.length>0)if("ENOUC5C_AP"===r.appId&&1===s.length&&s[0].isRoot()){let t={objectId:s[0].getID(),envId:n.getPlatformId(),contextId:o.getCredential(),serviceId:s[0].getAttributeValue("serviceId")};e.publish("setObject",t),e.subscribe("launchAppCallback",(function(t){t.appId===r.appId&&t.widgetId===r.widgetId&&e.publish("setObject",{objectId:"",envId:n.getPlatformId(),contextId:"",serviceId:"3DSpace"})}));var a={appId:r.appId,widgetId:r.widgetId};e.publish("launchApp",a,(function(){e.publish("setTypes",i)}))}else{let t=await this.expandIsRequired(s);l(s,(function(o){var i=JSON.stringify(o),n={appId:r.appId,origin:"openWith",widgetId:r.widgetId};t&&(n.fileName="-file",n.fileContent=i),e.publish("launchApp",n,(function(e){console.log(e)}))}),t&&"SWXCSWK_AP"!==r.appId)}else{var d={appId:r.appId,widgetId:r.widgetId};e.publish("launchApp",d,(function(){e.publish("setTypes",i)}))}}})),c=!0),e.publish("setTypes",i)}}})),define("DS/FolderEditor/commands/OpenInCAD",["DS/ApplicationFrame/Command","DS/IPClassifyUtil/PlatformAPIWrapper","DS/IPClassifyUXUtil/CredentialsView","DS/WidgetServices/WidgetServices","DS/FolderEditor/plugins/product/PrdUtils","DS/IPClassifyUtil/IPContext"],(function(e,t,o,i,n,r){"use strict";function s(e){UWA.is(e.setObject,"object")?t.publish("webinwin:web:notification",JSON.stringify({operation:"open/setObject",operationVersion:"1.0",content:[{phid:e.setObject.objectId}]})):t.publish("webinwin:web:notification",JSON.stringify({operation:"open/setTypes",operationVersion:"1.0",content:e}))}return e.extend({init:function(e){this._parent(e)},execute:function(){this.getSelection()},getSelection:function(){var e=this.options.context.getPADTreeDocument().getSelectedNodesForOFW();if(i.isCatiaV5Environment()&&1===e.length&&e[0].isRoot()){s({setObject:{objectId:e[0].getID(),envId:i.getTenantID("OnPremise"),contextId:o.getCredential()}})}else{let t=!i.isSolidworksEnvironment();n.buildDataForSetTypes(e,(function(e){s(e)}),t)}}})})),define("DS/FolderEditor/dataProvider/FolderFindInDataProvider",["UWA/Class","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/FolderEditorEvents","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/FolderSearch","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/FolderFindInCtx","DS/IPClassifyUXUtil/ActionBar/IPCommandManager"],(function(e,t,o,i,n,r,s,l,a,d,c,u){"use strict";let p={},h=[];return class{constructor({grid:e,component:t}){this.autoCompleteKey="BM_FindInTree_savedQueries",this._grid=e,this._component=t,this.supportedSection=d.getDefaultSection(),h=d.getTreeTypes(this.supportedSection,!0),d.getSections().forEach((e=>{e.favorite&&(this.unSupportedSection=e.name)}));let o=d.getLoadedFile("findInTreeNls");for(let e in o)p[e]=o[e];this.NlsContent=c,this.NlsTree=p}getSupportedTypesForDrop(){return h}getGridView(){return this._grid}getTreeVisibleNodesyId(e){return this._component._getVisibleNodeById(e)}getTreeSectionNodeForFind(e){return this._component._rootNodes[e]}getTreeElementToAddCommand(){var e=this._component.getContent(),t=null;return e&&(t=e.getElement(".FolderTree_Cont-root_treeview_container")),t}getTreeSelectedNode(){return t.getSelectedBookmark()}expandTreeAndSelectNode(e){e.withLoader=!1,this._component.expandTreeAndSelectFolder(e)}expandStructureWithPath(){this._component.expandStructureWithPath.apply(this._component,arguments)}findTreeNodes(e){l._findBookmarksInBookmark(e)}onTreeFilterChange(e){n.subscribe({event:"filterUpdatedTree"},(t=>{e(t.hasFilter)}))}onTreeUpdated(e){return i.onTreeUpdated(e)}onCurrentSelectionChange(e,o){o&&"tree"===o.context?n.subscribe({event:"tree_cso_updated"},e):t.onBookmarkOpening(e)}getContentFilter(){return a.getProxy()}getTreeWidth(){return this._component.getContent().offsetWidth}findContentNodes(e){this._component.getPADTreeDocument()._findInCtx(e)}onContentFindClose(){n.publish({event:"close_findInCtx_panel"})}onContentSearchChange(e){return r.onSearchChange(e)}getContentColumnsToIgnore(){return["ContextualMenuColumn","ds6w:isLastRevision","bookmarkLocation","ApprovalStatus","favoriteTitle"]}}})),define("DS/FolderEditor/commands/ActionBar_FindinCtxCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/service/FolderServices","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderFindInCtx","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/dataProvider/FolderFindInDataProvider"],(function(e,t,o,i,n,r,s,l){"use strict";return class extends t{constructor(t){super(t,{mode:"exclusive",isAsynchronous:!1}),this.labelTopBar=e.i18n("FindinCtx"),this.isInsert=!0,this.datas={},this.launchType="ActionBar",this.findInCtx=null,s.subscribe({event:"refresh_content"},(()=>{this.findInCtx&&this.findInCtx.visibleFlag&&this.findInCtx.closeViewafterRefresh()})),s.subscribe({event:"close_findInCtx_panel"},(()=>{this.findInCtx&&this.findInCtx.visibleFlag&&this.findInCtx.close()}))}beginExecute(){}async execute(){let e=this.options.context,t=e.getPADTreeListView(),o=e.folderComponent;if(!t)return;this.findInCtx&&this.findInCtx.visibleFlag&&this.findInCtx.close();let i=this._getInformationforNodes(o),{nodes:r,isContentPresentInBookmark:s,findInBookmark:a}=i,d=null;if(r.length>0||s){let e=await this.getTitle(r,a);if(d={target:t.getManager().getContent(),placeholder:n.placeholder_findInCtx,nodesForFindInCtx:r,title:e,findInBookmark:a,dataProvider:new l({grid:t.getManager(),component:o}),multiselection:o.options.multiselection},"ActionBar"!==this.launchType&&(this.options.position=this.position),!this.findInCtx){let e=await new Promise((e=>require(["DS/IPClassifyFindInContext/FindInContent"],e)));this.findInCtx=new e}this.findInCtx.buidUI(d)}this.launchType="ActionBar"}endExecute(){}_getInformationforNodes(e){let t=i.getSelectedContent();if(0===t.length){let t=e.getPADTreeDocument().getRoots();return{nodes:this._getNodes(t,20),findInBookmark:!0,isContentPresentInBookmark:t.length>0}}return{nodes:this._getNodes(t,20),findInBookmark:!1,isContentPresentInBookmark:!0}}_getNodes(e,t){let o=[];if(e.length>0){if(widget.getPreference("allow-products-expand").value){for(let s=0;s<e.length;s++){if(!(o.length<t)){r.displayNotification({title:n.title_warning_FindInCtx_objectsLimit,message:n.replace(n.get("msg_warning_FindInCtx_objectsLimit"),{limit:t}),className:"info"});break}(i=e[s])&&i.options&&i.options.type&&"VPMReference"===i.options.type&&o.push(e[s])}return o.length>0?o:[]}return[]}return r.displayNotification({title:n.title_warning_FindInCtx_novalidobject,message:n.msg_warning_FindInCtx_novalidobject,className:"warning"}),this.findInCtx&&this.findInCtx.visibleFlag&&this.findInCtx.close(),[];var i}setLaunchType(e){this.launchType=e.type,this.position=e.position}async getTitle(e,t){let i=await o.getCurrentBookmarkInfo();return t?i.getLabel():1===e.length?e[0].options.label:`${e.length} ${n.findInCtxSearchView.objects}`}}})),define("DS/FolderEditor/utils/FolderListContent_Read",["UWA/Utils","DS/IPClassifyUXUtil/ProgressPaneExecution","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/service/FolderEditorWebServiceReadMode","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r,s){function l(e){let t=e.results;e.infos&&(e.infos.nresults=t?t.filter((e=>!e.from)).length:0,e.infos.nhits=e.infos.nresults)}return{listContent:function(e){let a=o.getFilterTags(),d=!0!==e.synthesis_only?o.getTableFilter():null;e.filters=a;let c=null;if(n.isRootSection(e.pid)){e.contentView=!0;let n=i.getFilterTags(),l=o.hasANDConditionInRefine(n,a);if(e.filters={...n,...a},e.tableFilter=d,l)c=Promise.resolve({infos:{},results:[]}),e.onComplete({infos:{},results:[]});else{let o=1,i=s.loadingRoots;if(e.indexInfo&&e.finalizeScrolling){i=s.loadingAllRoots;let t=e.indexInfo.nhits;e.currentNbObjects&&(t-=e.currentNbObjects),o=Math.ceil(t/e.indexInfo.nresults)}let n=[];for(let e=0;e<o;e++)n.push(1);let l=!1;c=t.execute({title:i,rejectOnFailure:!0,monoThread:!0,datas:n,query:()=>l?Promise.resolve():r.getRoots(e).then((e=>(0===e.infos.nresults&&(l=!0),e))),loaderInfo:{scope:"contentView",withPercent:n.length>0,nls:{loadRoots:i}}}).then((t=>{let o=null;t.forEach((e=>{e&&(o?(o.results=[...o.results,...e.results],!o.infos&&e.infos?o.infos=e.infos:o.infos.nresults+=e.infos.nresults):(o=e,o.results=o.results?o.results:[]))})),e.onComplete({...o,tableFilter:d})})).catch((t=>{e.onFailure(t.err,t.serverErr)}))}}else{n.getExpandRelations(e.section)&&("Yes"!==e.filterChildren?(c=e.finalizeScrolling?r.listContent_ExpandLevel_1({pid:e.pid,noSizeLimit:!0,predicates:e.predicates,synthesis_only:e.synthesis_only,filters:e.filters,section:e.section,synthesis:e.synthesis,noContent:!1,onlyContent:!0}).then((t=>{t.expandv2=!0,t.results&&t.results.length>0&&t.results[0].resourceid===e.pid&&t.results.shift(),l(t),e.onComplete(t)})):r.getContentReadMode({tableFilter:d,sortModel:e.sortModel,exceptIds:e.exceptIds,content:e.content,synthesis:e.synthesis,filterChildren:e.filterChildren,next_start:e.next_start,pid:e.pid,filters:e.filters,section:e.section}).then((t=>{e.onComplete({...t,tableFilter:d})})).catch((t=>{e.onFailure(t.err,t.serverErr)})),c.appliedFilter=e.filters):e.synthesis||(c=r.getFilteredContent({content:e.content,section:e.section,pid:e.pid}).then((t=>{t.expandv2=!0,l(t),e.onComplete(t)})).catch((t=>{console.log(t),e.onFailure(t)}))))}return c},listV2Content:function(e){let t=null,i=o.getFilterTags();return e.filters=i,n.isRootSection(e.pid)||(t=r.listContent_ExpandLevel_1({section:e.section,pid:e.pid,noSizeLimit:e.noSizeLimit,synthesis_only:e.synthesis_only,predicates:e.predicates,content:e.content,noContent:"Yes"===e.filterChildren&&!e.withSmartFiltering||!e.withSmartFiltering&&"synthesis",filters:e.filters,synthesis:e.synthesis,onComplete:e.onComplete,onFailure:e.onFailure}),t.appliedFilter=e.filters),t}}})),define("DS/FolderEditor/controllers/CommonContentMode",["DS/FolderEditor/controllers/CommonMode","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderListContent_Read","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/tagger/TaggerContentProxy"],(function(e,t,o,i,n,r,s){return e.extend({enable:function(){s.setUpdateMode(!1)},disable:function(){s.setUpdateMode(!0)},getInfoIndex:function(){return null},setInfoIndex:function(){},withInfiniteScrolling:function(){},loadIndexContents:function(e){let i={...e,next_start:null};let l=null!==this.getInfoIndex(),a=i.smartFiltering&&this.smartFilteringAvailable();i.withSmartFiltering=a,a&&!i.smartFiltering.fetchAllAttr&&(i.predicates=["physicalid"]);let d=[],c=!1;if(!l&&!e.resetScrolling)if(s.clearTags(),r.isRootSection(t.getCurrentBookmarkId()))i.synthesis=!0;else{let t=this.loadV2Objects(i),n=o.loadLinks([e.pid],{filters:s.getFilterTags(),section:e.section});d.push(t),d.push(n),c=!0}if(!a||!c){let e=this.loadObjects({...i,content:"noBks"});d.push(e)}let u=this._contentHandleRequest=new n(((e,t)=>{Promise.all(d).then((t=>{if(!u.isCancelled()){let o={};t.length>0&&(o=t[0],o.inProgress=this.withInfiniteScrolling(),o.smartFiltering=a?i.smartFiltering:void 0,t.forEach(((e,t)=>{t>0&&e&&e.contents&&(o.contents=[...o.contents,...e.contents])}))),e(o)}})).catch(t)}));return d.forEach((e=>{u.addLinkedQuery(e)})),u},allContentLoadedWithoutFilterTable:function(){return this._allContentLoaded},loadObjects:function(e){let t={...e},o=null,r=new n(((e,n)=>{let r=this.getInfoIndex();null!==r&&(t.next_start=r.next_start),t.onComplete=o=>{null==this._indexInfo&&(this._firstPageWithoutTableFilter=!o.tableFilter||(()=>{for(let e in o.tableFilter){if(o.tableFilter[e].filterModel)return!1}return!0})(),this._isPageRefreshed=!0),this.setInfoIndex(o.infos),o.expandv2&&this.setInfoIndex({...o.infos,nresults:0}),this._firstPageWithoutTableFilter&&(this._allContentLoaded=o.expandv2||this.isInfiniteScrollingEnded());var i=o.results;i=i||[];let n=o.expandv2?i:[];o.expandv2||i.forEach((e=>{if(e.attributes){let t={};e.attributes.forEach((e=>{let o=e.name,i=e.value;o.startsWith("ds6w")&&(o=o.substring(o.lastIndexOf("/")+1)),t[o]?Array.isArray(t[o])?t[o].push(i):t[o]=[t[o],i]:t[o]=i})),n.push(t)}})),n.forEach((e=>{e._scrollingContent=!0;for(let t in e)Array.isArray(e[t])&&1===e[t].length&&(e[t]=e[t][0]);return e}));var r={contents:n};!0===t.synthesis&&(r.synthesis=o),e(r)},t.onFailure=function(e,t){n(e&&e.serverErr?e:{err:e,serverErr:t})},o=i.listContent({...t,indexInfo:r,currentNbObjects:this._nbReturnedObjects}),o||e()}));return r.addLinkedQuery(o),!0===t.synthesis&&(this.loadFacet({...e,facetPromise:r}),this._taggerHandleRequest=o),r},loadV2Objects:function(e){this.isTagSet=!1,this.cancelQuery();let t={...e},o="Yes"!==e.filterChildren&&!r.isRootSection(e.pid),s=null,l=new n(((n,r)=>{t.next_start=null,o&&(t.synthesis=!0),t.onComplete=i=>{o||this.loadFacet(t),null==this._indexInfo&&(this._isPageRefreshed=!0);var r=(i="string"==typeof i?JSON.parse(i):i).results;(r=r||[]).length>0&&r[0].resourceid===e.pid&&r.shift(),r.map((e=>{for(let t in e)Array.isArray(e[t])&&1===e[t].length&&(e[t]=e[t][0]);return e}));let l=null;o&&r.length>0&&(l=r.pop().synthesis);var a={contents:r,synthesis:l,filters:s.appliedFilter,sorted:!0,inProgress:!1};n(a)},t.onFailure=function(e,t){r({err:e,serverErr:t})},s=i.listV2Content(t),t.withSmartFiltering||(this._initialFilter=s.appliedFilter)}));return l.addLinkedQuery(s),o&&(this.loadFacet({...e,facetPromise:l}),this._taggerHandleRequest=s),l},loadFacets:function(e){return e.facetPromise?e.facetPromise:new Promise(((t,o)=>{let n=UWA.clone(e);n.synthesis=!0,n.synthesis_only=!0,n.onComplete=e=>{let o=(e="string"==typeof e?JSON.parse(e):e).facets?e:{};e&&!e.facets&&e.results&&e.results.length>0&&(o=e.results.pop().synthesis),t({synthesis:o})},n.onFailure=o,this._taggerHandleRequest=i.listContent(n)}))}})})),define("DS/FolderEditor/popup/BookmarkExternalURLPopup",["UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/Label","DS/Controls/LineEditor","DS/Windows/Dialog","DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/BookmarkExternalURLPopup"],(function(e,t,o,i,n,r,s,l){return e.extend({modal:null,onResize:function(){null!=this.ARWidget&&this.ARWidget.onResize()},init:function(e){this.elementsList=[],e=null!=e?e:{};var r=UWA.createElement("div",{class:"bookmark-Add-External-Link-command"});let a=UWA.createElement("div",{class:"bm-add-link-row"});a.inject(r);new o({value:l.title,emphasize:"NONE",width:"100px",class:"bm-add-link-row-Label"}).inject(a);UWA.createElement("span",{class:"bm-add-link-row-asteric",text:" * "}).inject(a);let d=new i({}).inject(a);e.titleToChange&&(d.value=e.titleToChange),a=UWA.createElement("div",{class:"bm-add-link-row"}),a.inject(r);new o({value:l.url,emphasize:"NONE",width:"100px",class:"bm-add-link-row-Label"}).inject(a);UWA.createElement("span",{class:"bm-add-link-row-asteric",text:" * "}).inject(a);var c=new i({}).inject(a);e.urlToChange&&(c.value=e.urlToChange);let u=void 0!==e.title?e.title:l.title_add_new_link;this.dialog=new n({title:u,content:r,immersiveFrame:widget.immersiveFrame,minHeight:150,minWidth:200,width:500,modalFlag:!0,resizableFlag:!0,buttons:{Ok:new t({label:l.create,disabled:!1,emphasize:"primary",onClick:function(t){""===c.value||""===d.value?s.displayNotification({message:l.msg_warning_empty_values,className:"warning"}):(t.dsModel.dialog.buttons.Ok.disabled=!0,e.onOkClick&&(e.onOkClick({dataURL:c.value,dataURLTitle:d.value}),t.dsModel.dialog.destroy()))}}),Cancel:new t({emphasize:"secondary",onClick:function(e){e.dsModel.dialog.destroy()}})}}),this.dialog.getContent().addClassName("bookmark-Add-External-Link"),this.dialog.addEventListener("close",(function(e){console.log("Close on dialog : "+e.dsModel.title),e.dsModel=null}))}})})),define("DS/FolderEditor/popup/AddMovePopup",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Windows/Dialog","DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/AddMovePopup"],(function(e,t,o,i,n,r,s){return e.extend({init:function(e){this._parent(e),this.buildSkeleton(e),this.buttonGroup=null},buildSkeleton:async function(e){var l=UWA.createElement("div",{class:"addMove-commonContent"}),a=UWA.createElement("div",{class:"addMove-Label"});a.innerText=s.operationToPerform,a.inject(l);var d=this.buttonGroup=new o({type:"radio"});d.addChild(new t({type:"radio",label:s.Add,value:"copy",checkFlag:!0})),d.addChild(new t({type:"radio",label:s.Move,value:"move"})),d.inject(l);let c=r.getTreeTypeNls(e.objectValues.targetType);var u=s.replace(s.get("msg_Title"),{number:e.objectValues.noOfObjects,folderType:c.toLowerCase(),folderName:e.objectValues.targetBookmark}),p=new n({immersiveFrame:widget.immersiveFrame,title:u,content:l,activeFlag:!1,modalFlag:!0,resizableFlag:!0,height:150,width:400,buttons:{Ok:new i({onClick:function(t){t.preventDefault(),t.stopPropagation();var o=d.getContent().dsModel.value[0];e.callback(o),p.destroy()}}),Cancel:new i({onClick:function(){e.callback("none"),p.destroy()}})}});p.getContent().addClassName("bookmark_AddMovePopUp"),p.addEventListener("close",(function(t){e.callback("none"),p.destroy()}))}})})),define("DS/FolderEditor/utils/FolderEditorUtil",["UWA/Utils","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/service/FolderServices","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/Folder_CSO","DS/IPClassifyActive/utils/EventsManager","DS/IPClassifyActive/utils/WidgetDataProvider","DS/IPClassifyUtil/IPClassifyUtility","DS/LifecycleServices/LifecycleServicesSettings","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPServicesMgr","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/PlatformAPIWrapper","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","UWA/Utils/Client","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FavoritesUtil","DS/FolderEditor/popup/AddMovePopup","DS/FolderEditor/views/FolderMode","DS/FolderEditor/plugins/PluginsManager","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUtil/IPClassifyModelEvents","DS/ZipJS/deflate","DS/ZipJS/inflate"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F,T,x){let P={www:"link",__Unknown__:"link-off"};var A=null;function k(){return""}function N(e,o,i){if(!e)return;let n=e[o];n?(Array.isArray(n)||(n=[n]),t.is(i,"array")?n=[...n,...i]:n.push(i),e[o]=n):e[o]=i}function M(e){var t=f.jsonUnzip(e),o=null;try{o=JSON.parse(t)}catch(e){o=null}return o}function U(e){return f.jsonZip(JSON.stringify(e))}getStatusPref=function(){if(!A){var e=widget.getValue("view_status");A={},e&&(A=M(e))}return A||{}},saveStatus=function(e,t){var o=getStatusPref();o[e]=t,widget.setValue("view_status",U(o))},getStatus=function(e){return getStatusPref()[e]},getTreeListSort=function(e){var t=getStatus("treeSort");return t||e};function O(e,{name:t,value:o,object:i,dispValue:n}){let r={"ds6w:type":"type","ds6w:label":"label"};if("resourceid"==t||"physicalid"==t)e.resourceid=o;else if("type_icon_url"===t||"icon"==t)e.icons=[o];else if("preview_url"===t||"thumbnail_2d"==t)e.thumbnail=o;else if("taxonomies"===t){const t=Array.isArray(o)?o:[...o.split(",")];let i=t.find((e=>e.startsWith("types/")));i&&(i.startsWith("types/DOCUMENTS/Document")||i.startsWith("types/DOCUMENTS/CONTROLLED DOCUMENTS"))&&(e.checkout=!0,e.isDownloadable=!0),e.taxonomies?e.taxonomies.push(...t):e.taxonomies=[...t]}else if(t.startsWith("ds6w")){var s=t.split("/"),l=s[s.length-1];o=(o=i||o)||n,(n=n&&"ds6w:reserved"!==l?n:o)||(n=o),R.addValueInGrid(e,l,n),l!=t&&(e.grid[t]=o);var a=r[l];a&&(e[a]=o,e.grid[a]=o)}else"relcount"===t?"0"!==o&&(e.children=[]):e.grid[(d=t,c=d.toLowerCase(),u=y.getAvailableColumns(),p=null,Array.isArray(u)&&u.every((function(e){return c==e.toLowerCase()&&(p=e),null===p})),p=p||d)]=o;var d,c,u,p}var R={densityHeight:{compact:26,comfortable:38},nameRules:{maxLength:127},addValueInGrid:function(e,o,i){let n=d.getColumnsUnitNls();if(n){let r=n[o],s=i;if(r){if(t.is(i,"array")){s=[];for(let e=0;e<i.length;++e){let t=i[e];r.unit&&(t+=` ${r.unit}`),s.push(t)}}else s=r.unit?i+" "+r.unit:i;N(e.gridValue,o,i)}N(e.grid,o,s)}else{var r=e.grid[o];r&&!Array.isArray(r)&&(r=[r]),Array.isArray(r)&&r.push(i),Array.isArray(r)?e.grid[o]=r:e.grid[o]=i}},convertToExaleadDataFormatFederated:function(e){var t={children:null},o=e.attributes;if(t.grid={},t.gridValue={},t.icons=[],o)o.forEach((function(e){O(t,e)}));else{for(var n in e)O(t,{name:n,value:e[n]});t.taxonomies&&"string"==typeof t.taxonomies&&(t.taxonomies=t.taxonomies.length>0?t.taxonomies.split(","):null),t.grid["ds6w:kind"]&&"string"==typeof t.grid["ds6w:kind"]&&(t.grid["ds6w:kind"]=t.grid["ds6w:kind"].split(","))}if(e.id||(e.id=t.resourceid),t.padgrid={"ds6w:leaf":"False","ds6w:root":"True"},"read"==d.getContentMode()&&1==t.checkout&&(t.Documentlocked=t.grid["ds6w:reserved"]?t.grid["ds6w:reserved"].toString().toUpperCase():"FALSE",t.isDownloadable=!0),t.grid.serviceId="3DSpace",t.grid.sourceid){var r=t.grid.sourceid.split(":");t.grid.serviceId=i.getServiceFromSource(r[0]),r.length>1&&(t.grid.tenantId=r[1])}return F.prepareDataFromIndex(e,t),t},convertToExaleadDataFormat:function(e){if(Array.isArray(e.attributes)||e.resourceid)return this.convertToExaleadDataFormatFederated(e);var o={};o.resourceid=e.id,o.label=e.service&&"www"===e.service?e.appdata:e.label,o.type=e.type,o.isDownloadable=e.isDownloadable,o.checkout=e.checkout,t.is(e.mxid)&&(o.mxid=e.mxid),t.is(e.publishOnConnect)&&(o.publishOnConnect=e.publishOnConnect);var i=e.icon,n=e.largeicon,r=e.thumbnail?e.thumbnail:null;if(o.icons=i?[i]:[],o.thumbnail=null!==r?r:null!==n?n:i,e.service&&P[e.service]){var s={iconName:P[e.service],fontIconFamily:1};o.icons=[s]}t.is(e.description)&&t.is(e.description.replace,"function")&&(e.description=e.description.replace(/\\n/g," ")),o.grid={},o.gridValue={},o.padgrid={},o.grid["ds6wg:revision"]=e.revision,t.is(e.TreeOrder)&&(o.relationOrder=e.TreeOrder,o.grid.relationOrder=e.TreeOrder),o.grid.serviceId=e.service||"3DSpace";let l=e.description?e.description:"";o.grid["ds6w:description"]=l,o.grid["ds6w:modified"]=e.modified,o.grid["ds6w:created"]=e.created,o.grid["ds6w:type"]=e.displayType?e.displayType:e.type,o.grid["ds6w:policy"]=e.policy?e.policy:"",o.grid["ds6w:organizationResponsible"]=e.organizationResponsible?e.organizationResponsible:"",o.grid["ds6w:project"]=e.project?e.project:"",o.grid["ds6w:status"]=e.status?e.status:"";var a=E.getAttrPredicateMap();for(var d in e){let t=a.get(d);t&&e[d]&&e[d].length>0?R.addValueInGrid(o,t,e[d]):"string"==typeof e[d]?e[d].length>0&&(o.grid[d]=e[d]):o.grid[d]=e[d]}if(o.grid["ds6w:identifier"]||(o.grid["ds6w:identifier"]=e.name),e.service&&"www"===e.service&&(o.grid.Link=e.uri),t.is(e.locker)&&(o.grid["ds6w:reservedBy"]=e.locker),t.is(e.locked)?o.grid["ds6w:reserved"]=e.locked:o.grid["ds6w:reserved"]="",t.is(e.isDuplicated)&&(o.grid.isDuplicated=e.isDuplicated),t.is(e.isLastMinorRevision)&&(o.grid.isLastMinorRevision=e.isLastMinorRevision),t.is(e.svg)){var c=[{id:e.svg,format:"svg"}];o.grid.derivedOutputs=c}return o.padgrid["ds6w:leaf"]="False",o.padgrid["ds6w:root"]="True",o.gridValue.current=e.current_nonNls,o.gridValue["ds6w:status"]=e.current_nonNls,o.grid["ds6w:responsible"]=e.responsible,t.is(e.logicalDeleteBy)&&(o.grid.logicalDeleteBy=e.logicalDeleteBy),t.is(e.logicalDeleteStamp)&&(o.grid.logicalDeleteStamp=e.logicalDeleteStamp),t.is(o.thumbnail)&&(o.grid.thumbnail=o.thumbnail),o.children=null,F.prepareDataFromDB(e,o),o},convertToArray:function(e){return[{name:"ds6wg:revision",value:e.grid["ds6wg:revision"]},{name:"ds6w:description",value:e.grid["ds6w:description"]},{name:"ds6w:modified",value:e.grid["ds6w:modified"]},{name:"ds6w:created",value:e.grid["ds6w:created"]},{name:"ds6w:type",value:e.grid["ds6w:type"]},{name:"ds6w:policy",value:e.grid["ds6w:policy"]},{name:"ds6w:organizationResponsible",value:e.grid["ds6w:organizationResponsible"]},{name:"ds6w:project",value:e.grid["ds6w:project"]},{name:"ds6w:reservedby",value:e.grid["ds6w:reservedby"]},{name:"ds6w:reserved",value:e.grid["ds6w:reserved"]},{name:"isDuplicated",value:e.grid.isDuplicated},{name:"isLastMinorRevision",value:e.grid.isLastMinorRevision},{name:"derivedOutputs",value:e.grid.derivedOutputs},{name:"ds6w:leaf",value:e.padgrid["ds6w:leaf"]},{name:"ds6w:root",value:e.padgrid["ds6w:root"]},{name:"ds6w:responsible",value:e.grid["ds6w:responsible"]},{name:"ds6w:status",value:e.grid["ds6w:status"]}]},generateJSON:function(e){var t,o,i,n=e.length,r={};for(t=0;t<n;++t)i=e[t],o={...i},i.TreeOrder&&(o.relationOrder=i.TreeOrder),i.RelId&&(o.relId=i.RelId),r[i.id]=o;return r},shouldBeEditable:function(e){return n.isTreeType(e.getType())},onNodeModelUpdate:function(e){var t=e.data.nodeModel;if(n.isTreeType(t.getType()))if(t._resetting)t._resetting=!1;else if(!e.data.attributes||e.data.attributes.hasOwnProperty("label")||e.data.attributes.hasOwnProperty("favoriteTitle")){var o=t._lastUpdateTime?t._lastUpdateTime:0,i=Date.now()-o;if(t._lastUpdateTime=Date.now(),!(0!==o&&i<300)){var r=t.getID(),l=t.options.label,d=t.options.oldLabel,u=!1;if(t.isFavorite&&e.data.attributes.hasOwnProperty("favoriteTitle")?(l=e.data.attributes.favoriteTitle,d=e.data.previousAttributes.favoriteTitle,u=!0):t.isFavorite&&t.hasOwnProperty("bookmarkLabel")&&(u=!0),void 0===d&&(d=""),l!==d){var p=!0;if(l&&l.trim&&(l.trim()===d.trim()&&(p=!1),l=l.trim()),void 0!==l&&0===l.trim().length&&(s.displayNotification({message:a.get("msg_error_name_empty"),className:"error"}),p=!1),p)if(u){var h={id:r,name:d};D.renameFavorite(h,l).then((e=>{})).catch((e=>{t._resetting=!0,setTimeout((function(){t.withTransactionUpdate((function(){t.hasOwnProperty("bookmarkLabel")?this.setLabel(d):this.setAttribute("favoriteTitle",d)})),t._resetting=!1})),x.publish({event:"escape_action"})}))}else I.switchtoAuthoringMode(),F.renameTreeElement(t.getType(),{pid:r,type:t.getType(),section:n.getDefaultSection(t.getType()),properties:{Title:l}}).then((()=>{t.options.oldLabel=l,c.notifyFolderRename([t]),s.displayNotification({message:a.replace(a.get("msg_info_rename"),{name1:d,typeStruct:n.getTreeTypeNls(t.getType()),name2:l}),className:"success"}),x.publish({event:"escape_action"})})).catch((e=>{let o=a.get("msg_error_rename");s.displayNotification({title:a.replace(o.title,{name:d,typeStruct:n.getTreeTypeNls(t.getType())}),subtitle:n.getSettingParameter("uniqueName")?o.subtitle_oneName:o.subtitle,message:o.message,className:"error"}),t._resetting=!0,setTimeout((function(){t.withTransactionUpdate((function(){this.setLabel(d)})),t._resetting=!1})),x.publish({event:"escape_action"})}));else setTimeout((function(){if(u)t.withTransactionUpdate((function(){t.hasOwnProperty("bookmarkLabel")?this.setLabel(d):this.setAttribute("favoriteTitle",d)}));else{t.withTransactionUpdate((function(){this.setLabel(d)}));let e=require("DS/FolderEditor/commands/FolderCommands");e._cellToRename&&x.publish({event:"rename_label",data:{isTree:!!t.hasOwnProperty("pathId"),cellInfos:e._cellToRename.cellInfos}})}}))}}}},checkMoveOrCopyAcrossSharedAndPersonal:function(e,t,o){if(!e||!t)return!0;var i=0,n="shared";if(e.isPersonal&&(i++,n="personal"),t.isPersonal&&i++,1==i){var r=a.get("Move_label");o&&(r=a.get("Copy_label"));var l="",d="";return"personal"==n?(l=a.get("Personal_label"),d=a.get("Shared_label")):(l=a.get("Shared_label"),d=a.get("Personal_label")),s.displayNotification({message:a.replace(a.get("msg_error_MoveOrCopyAcrossSharedAndPersonal"),{move_copy:r,personal_shared:l,shared_personal:d}),className:"error"}),!1}return!0},getTenant:function(){var e=_.getPlatformId(),t=null;if(e){try{_.getTenantsPreference().every((function(o){return o.value===e&&(t=o),null===t}))}catch(e){t=null}null===t&&(t={label:e,value:e})}return t},getCtxAndBookmark:async function(){let e=await r.getCurrentBookmarkInfo();return this.getCurrentSecurityContextAndFolderData(void 0,e)},getCurrentSecurityContextAndFolderData:function(e,t){var o=t||p.getSelectedBookmark();!o&&p.getCurrentBookmarkId()&&(o={getLabel:k,getType:k,getID:()=>p.getCurrentBookmarkId()});var i=T.getCredential(),n=this.getTenant(),r=c.createBookmarkForPublication(o,e);return r.Tenant=n,r.SecurityContext=i,r},objectSelectionProvider:{widgetEventsProvider:{selection:"FolderEditor.Public.Bookmark"},widgetDataProvider:{getObjectForPublication:function(e){return e&&n.isTreeType(e.getType())?{FolderID:e.getID(),FolderLabel:e.getLabel()}:null}}},dipatchSecurityContextAndFolder:async function(){var e={current:null,active:null,origin:widget.id},t=await this.getCtxAndBookmark();e.current=t;var o=JSON.stringify(t);if(u.publish("FolderEditor.CurrentFolder",o),d.isActiveBookmarkActivated()){var i=d.getActiveFolder();e.active={origin:widget.id,id:"!"!==i.id?i.id:null,label:i.label,sc:i.sc},u.publish("FolderEditor.ActiveFolder",e.active)}u.publish("FolderEditor.Bookmark",e);var n=await r.getCurrentBookmarkInfo();g.setDataProvider(this.objectSelectionProvider),h.notifyObjectSelection(n)},_sortTreeColumn:function(e,t){var o=n.isTreeType(e.getType()),i=n.isTreeType(t.getType());return o&&!i?"asc"===this.sortOrder?-1:1:!o&&i?"asc"===this.sortOrder?1:-1:f.compareLabels(e.options.label,t.options.label)},sortingNodes:function(e){var t=this;return e.columns&&e.columns.forEach((function(e){var o=e.dataIndex;"tree"===o?e.sortFunction=t._sortTreeColumn:"ds6w:created"===o||"ds6w:modified"===o||"logicalDeleteStamp"===o||e.xnav_options&&"date"===e.xnav_options.kind?e.sortFunction=function(e,t){var i,r=n.isTreeType(e.getType()),s=n.isTreeType(t.getType());if(r&&!s)return"asc"===this.sortOrder?-1:1;if(!r&&s)return"asc"===this.sortOrder?1:-1;try{i=new Date(e.options.grid[o])>new Date(t.options.grid[o])?1:new Date(e.options.grid[o])<new Date(t.options.grid[o])?-1:0}catch(n){i=e.options.grid[o]<t.options.grid[o]?-1:1}finally{return i}}:e.sortFunction=function(e,t){var i=n.isTreeType(e.getType()),r=n.isTreeType(t.getType());if(i&&!r)return"asc"===this.sortOrder?-1:1;if(!i&&r)return"asc"===this.sortOrder?1:-1;var s=e.options.grid[o]?e.options.grid[o]:"",l=t.options.grid[o]?t.options.grid[o]:"";return f.compareLabels(s,l)}})),e},downloadFcs:function(o){if(t.is(o,"string")){var i=e.parseUrl(o),n=e.parseQuery(i.query);n.__fcs__attachment=!0,delete i.query;var r=e.composeUrl(i),s=document.createElement("form");s.style.display="none",s.method="POST",s.action=r,Object.keys(n).map((function(e){var t=document.createElement("input");t.setAttribute("name",e),t.setAttribute("value",n[e]),s.appendChild(t)})),document.body.appendChild(s),s.submit(),document.body.removeChild(s)}},downloadForTouchDevices:function(e){t.is(e,"string")&&(e+="&__fcs__attachment=true",t.createElement("a",{href:e,styles:{display:"hidden"}}).inject(document.body).click())},isTouchDevice:function(){return"ontouchstart"in document.documentElement},setBadge:function(e,t,o){var i={};i[t]=o,this.setBadges(e,i)},setBadges:function(e,t){var o=e.getBadges();for(var i in o=o||{},t){var n=t[i];o[i]=n?"string"==typeof n?{iconPath:n,iconSize:{width:"16px",height:"16px"}}:n:"none"}e.setBadges(o)},copyTexttoCLipboard:function(e,t){if("undefined"==typeof ClipboardItem)return navigator.clipboard.writeText(t);const o=t,i=new Blob([`<a href="${t}">${e}</a>`],{type:"text/html"}),n=new Blob([o],{type:"text/plain"}),r=new ClipboardItem({"text/html":i,"text/plain":n});return navigator.clipboard.write([r])},getDefaultView:function(){var e=getStatus("default_view");return e&&"treelistview"!==e?e:"datagridview"},getContentSortmodel:function(){var e=getTreeListSort(),t=[{sort:"asc",dataIndex:"tree"}];return e&&(e.id?t=[{sort:e.param?e.param.sortOrder:"asc",dataIndex:e.id}]:Array.isArray(e)&&(t=e)),t},getRightPanelStatus:function(){var e=getStatus("rightPanel");return e||{rightPanelState:!1,size:300}},getLeftPanelStatus:function(){var e=getStatus("leftPanel");return e||{leftPanelState:!0,isWelcomePanelCollapsed:!1}},getTreeViewScrollerPosition:function(){var e=getStatus("TreeViewScrollerPosition");return e||{x:0,y:0}},setDefaultView:function({view:e,fromUIInteraction:t}){t&&saveStatus("default_view",e)},setContentSortmodel:function(e){saveStatus("treeSort",e)},setRightPanelStatus:function(e){saveStatus("rightPanel",e)},setLeftPanelStatus:function(e){saveStatus("leftPanel",e)},setTreeViewScrollerPosition:function(e){saveStatus("TreeViewScrollerPosition",e)},getContentViewPreference:function(){var e=null,t=widget.getValue(n.getPrefPrefix()+"Custo_treelistview");return t&&(e=M(t)),e?{preference:e}:null},setContentViewPreference:function(e,t,o){return new Promise((function(i){try{e.selectedTypes=y.getSelectedTypes(),e.selectedExtensions=y.getSelectedExtensions()}catch(e){}e.version=o||widget.getValue("vMigration"),e.hasOwnProperty("columnsOptimized")&&e.columnsOptimized.forEach((function(e){e.hasOwnProperty("label")&&delete e.label})),"only"!==t&&widget.setValue(n.getPrefPrefix()+"Custo_treelistview",U(e)),t?l.setUserPreferences({preferences:[{name:widget.getValue("x3dAppId")+"_template",value:U(e)}]}).then((()=>{console.log("Saved as template"),i()})).catch((e=>{console.warn("Cannot save customization template"+(e&&e.err?e.err:e)),i()})):i()}))},getAddMovePopupResults:function(e,t){new(require("DS/FolderEditor/popup/AddMovePopup"))({callback:e,objectValues:t})},setTreeTaggerPreference:function(e,t){t=JSON.stringify(t),t=f.jsonZip(t),widget.setValue(e,t)},getTreeTaggerPreference:function(e){return function(e){if(e)try{e=f.jsonUnzip(e),e=JSON.parse(e)}catch(t){e={}}else e={};return e}(window.widget?widget.getValue(e):void 0)},isTreeTaggerActive:function(){return!0===v.getSetting("activateTreeFilter")},filterDBOnlyAttrs:function(e){for(var t=[],o=0;o<e.length;++o)(!e[o].attrDBName||e[o].attrDBName.length>0)&&t.push(e[o]);return t},isRelationsColumnsActive:function(){return!0===v.getSetting("Activate_relationsColumns")},isRelationsColumnVariableActivated:function(){return!0===v.getSetting("Activate_relationsColumns")},computeValueForFiltering:function({propertyId:e,internalValue:t,service:o}){let i=y.getColumn(e),n=t;return i&&!0===i.isAdditionalColumn?n=void 0===t?"":t:i&&"set"===i.filterId&&(n=void 0===t?"":(o||"3DSpace")+"::"+t),void 0===n?"":n}};return R})),define("DS/FolderEditor/views/additionalColumns/ClassificationAttributesColumn",["UWA/Class","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/FolderEditor/utils/FolderEditorUtil","DS/ClassificationUtil/ClassificationUtil"],(function(e,t,o,i,n,r){"use strict";return e.singleton({init(e){this._parent(e),this.__updateHeaderNLS=(e,t)=>{if(!t||!t[0])return;const o=t[0].properties;if(e&&e.columns){for(const t of o){const o=Object.values(e.columns).find((e=>e.classif&&e.dataIndex===t.curi));o&&(o.text=t.label)}this._isHeaderUpdated=!0}}},getName:()=>"classificationAttributes",isAdditionalColumnsAvailable:function(e){if(!1===UWA.is(e,"function"))throw new Error("A callback function should be defined");e(!0)},getDependentModuleNames:function(){return["manipulationUnitColumns"]},getManagedColumnNames(e){if(e&&e.columns)return this._filterClassificationColumns(e.columns);const o=t.getContentColumns();return o?this._filterClassificationColumns(o):[]},_getManagedColumnDBNames(){const e={},o=t.getContentColumns();return o?(Object.entries(o).forEach((([t,o])=>{if(o.classif&&o.attrDBName&&o.attrDBName.length>0){const t=o.attrDBName[0].match(/\[(.*?)\]/)[1];t&&(e[t]=o.dataIndex)}})),e):e},toBeUpdated(e,t){return this.getManagedColumnNames().some((o=>!this._areValuesEqual(e[o],t.getAttributeValue(o))||!t.getAttributeValue("isClassificationAttributeSet")))},getOnCellClickCB(e,t){this._isManagedColumn(e)&&this._isClickableEvent(t)&&require(["DS/FolderEditor/utils/FolderEditorEvents"],(function(e){e.notifyRightSidePanelOpen({classification:!0})}))},async updateAttributes(e,t){if("authoring"===o.getCurrentModeType()){const o=r.classificationAttributesPromise({apiVersion:"R2019x"}),i=this.fetchClassificationAttributes(e.pids);Promise.all([i,o]).then((o=>{this._processClassificationColumn(o[0],e),this.translateCells(o[1],e),t()}))}else{r.classificationAttributesPromise({apiVersion:"R2019x"}).then((o=>{this.translateCells(o,e),t()}))}},translateCells(e,t){if(e&&e[0]&&e[0].properties){const o=this._getManagedColumnDBNames(),i=e[0].properties;t&&t.nodes&&t.nodes.forEach((e=>{Object.entries(o).forEach((([t,o])=>{const n=i.find((e=>e.curi===o)).rangeValues;let r=e.getAttributeValue(o);if(r=Array.isArray(r)&&1===r.length?r[0]:r,n){const t=n.find((e=>e.value===r));t&&e.setAttribute(o,t.nlsValue)}}))}))}},fetchClassificationAttributes(e){const t={inSource:"3DSpace",type:"json",method:"POST",timeout:24e4,cache:-1,data:JSON.stringify({data:e.map((e=>({id:e})))}),headers:{Accept:"application/json","content-type":"application/json"}};return i._executeQuery("/resources/classification/v2/classifiedItems/fetch",t,"classificationAttributesUpdate")},_filterClassificationColumns:e=>Object.values(e).filter((e=>e.classif)).map((e=>e.dataIndex)),_areValuesEqual:(e,t)=>Array.isArray(e)&&Array.isArray(t)?JSON.stringify(e)===JSON.stringify(t):e===t,_isManagedColumn(e){return this.getManagedColumnNames().includes(e)},_isClickableEvent(e){const t=e.target.className;return t.includes("wux-tweakers-string-label")||t.includes("wux-ui-genereatedicon-fi")},_processClassificationColumn(e,t){const o=this._getManagedColumnDBNames();t.nodes.forEach((t=>{const i=e.data.find((e=>e.id===t.id));if(i){const e=this._processNodeClassification(i.classification,o);this._applyAttributesToNode(t,e),t.setAttribute("isClassificationAttributeSet",!0)}}))},_processNodeClassification:(e,t)=>e.reduce(((e,o)=>(Object.entries(o).forEach((([o,i])=>{if(!["classId","className","classTitle","classUsage"].includes(o)&&i){const n=t[o];if(n){const t=Array.isArray(i)?i:[i],o=e[n]||[];e[n]=[...new Set([...o,...t])]}}})),e)),{}),_applyAttributesToNode(e,t){Object.entries(t).forEach((([t,o])=>{1===o.length&&(o=o[0]),e.setAttribute(t,null),delete e.options.gridValue,n.addValueInGrid(e.options,t,o)}))},getAdditionalColumnsUXDGV:()=>!0})})),define("DS/FolderEditor/views/FolderRightSidePanelView",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/IPClassifyUtil/IPContext","DS/IPClassifyUtil/IPClassifyModelEvents","DS/Utilities/Utils","DS/WidgetServices/commandProxy/CommandProxy","DS/FolderEditor/Folder_CSO","UWA/Class/Model","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/FolderEditorEvents","DS/IPClassifyUtil/PlatformAPIWrapper","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/service/BkOperationsUtils","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/plugins/PluginsManager","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/utils/ServerDataAccess"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S){"use strict";let C=["Workspace","Workspace Vault","Document","CONTROLLED DOCUMENTS"];var y=[],b=t.extend({_context:null,_propertiesWdg:null,_callbackAdd:!1,_previousSelection:null,init:function(e){this._readOnlyStatus=null,this._subscriptionTokens=[],this._parent(e,{}),this._context=i.get();var t=this;if(this._propertiesWdg=null,this._context.elements.padshell){var n=new o((function(e){null==t._propertiesWdg?require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils"],(function(o,i,n){t._context.elements.padshell&&t.createPropertiesWidget({EditPropWidget:o,EditPropConstants:i,EditPropUtils:n}),e()})):e()}));n.then((function(e){t.addCallback()})),y.push(n)}widget.addEvent("onDestroy",this.destroy.bind(this))},createPropertiesWidget:function({EditPropWidget:e,EditPropConstants:t,EditPropUtils:o}){let i=this;if(i.EditPropUtils=o,null==i._propertiesWdg){i._propertiesWdg=new e({className:"enxpropertiestab",setEditButton:!0,readOnly:!(1!=widget.launchWithReadMode&&!m.hasCATIASession()),typeOfDisplay:t.ALL,selectionType:t.NO_SELECTION,multiselection:t.MULTISEL_MERGE,collapseTabs:!1,context:i._context,appId:widget.getValue("x3dAppId")}),v.updatePropertiesPanel(i._propertiesWdg,this.options);var r=i._context.elements.padshell.getRightPanelContent();i._propertiesWdg.inject(r),i._propertiesWdg.elements.container.getContent().addEvent("resize",(function(){i.size=i._context.elements.padshell._currentRight;var e={rightPanelState:i._context.elements.padshell.getRightOpen(),size:i.size};c.setRightPanelStatus(e)}));var s=c.getRightPanelStatus();s.rightPanelState?(i.size=i._context.elements.padshell._currentRight=s.size,i._context.togglePanel("right"),i.setPreferences(),i._selectionChange(),n.publish({event:"information-panel-visible"})):(i.size=i._context.elements.padshell._currentRight=s.size,i.setPreferences())}},destroy:function(){this._subscriptionTokens.forEach((e=>{n.unsubscribe(e)})),this._subscriptionTokens=[],this._parent()},updatePanelVisibility:function(e,t){"right"===t&&(this.setPreferences(),!0===e&&g.sendTrackerPageEvent("FolderWidget_iconBar","Information"))},addCallback:function(){var e=this;if(!1===e._callbackAdd&&(h.subscribe("DS/ENO/select",((t,o)=>{e._context.elements.padshell&&e._selectionChange(t,o)})),e._context.elements.padshell&&e._context.elements.padshell._modelEvents)){let t=e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1));e._subscriptionTokens.push(t),t=e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),e._subscriptionTokens.push(t),p.rightPanelOpen((function(t){if("right"===t||"right"===t.rdata){var o=e._context.elements.padshell.getRightOpen();o?o&&t.dataIndex&&(e._selectionChange(t),e.setPreferences()):(e._context.togglePanel("right"),t.dataIndex?e._selectionChange(t):e._selectionChange(),e.setPreferences())}})),p.rightPanelClose((function(t){"right"===t&&(e._context.elements.padshell.getRightOpen()&&(e._context.togglePanel("right"),e._selectionChange(),e.setPreferences()))})),e._callbackAdd=!0}},_selectionChange:function(e,t){if(!this._context.elements.padshell.getRightOpen()||!this.EditPropUtils||t&&(t.originWidgetId!==widget.id||"ENORIPE_Relations"===t.origin))return;var i=this,n=l.getSelectedNodes(),r=[];n.length&&n.forEach((function(e){var t=i.EditPropUtils.getModelFromSelectedNode(e);t&&r.push(t)}));i=this;var s=(async()=>{let t=m.hasCATIASession();t&&y.push(S.getSubTypes(C)),await o.all(y);let s=!t||n.every((e=>S.isKindOfsSync(e.getType(),C))),l=!s;this._readOnlyStatus!==l&&(this._readOnlyStatus=l,this._propertiesWdg.setReadonlyStatus(!s));let a=this._getSelectionsIds(r);e&&e.dataIndex&&e.dataIndex.classification?i._propertiesWdg.initDatas(r,"Classification"):e&&e.dataIndex?require(["i18n!DS/ENORIPE_RelationsColumns/assets/nls/ENORIPE_Columns","DS/ENORIPE_Relations/RelationsTabSettings"],(function(t,o){i._propertiesWdg.initDatas(r,"relations"),o.expandRelations([t.get(e.dataIndex)])})):this._isSameSelection(a)||i._propertiesWdg.initDatas(r),this._previousSelection=a})();y.push(s)},_getSelectionsIds:function(e){let t=[];if(Array.isArray(e))for(let o=0;o<e.length;o++){let i=e[o];i.getAllAttributes()&&i.getAllAttributes().objectId&&""!==i.getAllAttributes().objectId&&t.push(i.getAllAttributes().objectId)}else""!==e&&t.push(e);return t.sort()},_isSameSelection:function(e){if(null===this._previousSelection)return!1;if(this._previousSelection.length!==e.length)return!1;for(let t=0;t<this._previousSelection.length;t++)if(this._previousSelection[t]!==e[t])return!1;return!0},setPreferences:function(){var e=this._context.elements.padshell.getRightOpen(),t={rightPanelState:e,size:this.size};c.setRightPanelStatus(t),e?n.publish({event:"information-panel-visible"}):n.publish({event:"information-panel-hidden"})}});return b})),define("DS/FolderEditor/views/FolderLeftSidePanelView",["UWA/Core","UWA/Controls/Abstract","DS/FolderEditor/utils/FolderEditorUtil","DS/IPClassifyUtil/IPContext","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/SettingsHandler"],(function(e,t,o,i,n,r,s){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._subscriptionTokens=[],this._parent(e,{}),this._context=i.get(),this.addCallback(),widget.addEvent("onDestroy",this.destroy.bind(this))},destroy:function(){this._subscriptionTokens.forEach((e=>{n.unsubscribe(e)})),this._subscriptionTokens=[],this._parent()},updatePanelVisibility:function(e){"left"===e&&this.setPreferences()},addCallback:function(){var e=this;if(!1===this._callbackAdd&&this._context.elements.padshell&&this._context.elements.padshell._modelEvents){let t=this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this));this._subscriptionTokens.push(t),t=this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this)),this._subscriptionTokens.push(t),r.leftPanelOpen((function(t){"left"===t&&s.isTreeViewVisible()&&(!e._context.elements.padshell.getLeftOpen()&&widget.body.getSize().width,e._context.togglePanel("left"),e.setPreferences())})),r.leftPanelClose((function(t){"left"===t&&(e._context.elements.padshell.getLeftOpen()&&(e._context.togglePanel("left"),e.setPreferences()))})),this._callbackAdd=!0}},setPreferences:function(){var e=this._context.elements.padshell.getLeftOpen(),t={leftPanelState:e,isWelcomePanelCollapsed:!e};o.setLeftPanelStatus(t),e?n.publish({event:"welcome-panel-expanded"}):n.publish({event:"welcome-panel-collapsed"})},isLeftPanelOpen:function(){return this._context.elements.padshell.getLeftOpen()}})})),define("DS/FolderEditor/models/xBookNodeModel",["DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorUtil","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/IPClassifyUtil/IPSettingsMgr","DS/FolderEditor/utils/ServerDataAccess"],(function(e,t,o,i,n,r,s,l){"use strict";var a={label:"",icons:[],grid:{},gridValue:{},padgrid:{},resourceid:"",type:"",relationid:"",relationtype:"",relationOrder:-1,did:"",relcount:null,isPADHidden:!1,padstate:"collapsed",children:[],thumbnail:null,useAsyncPreExpand:!0,emptyStatusbarVisibleFlag:!0,contextualMenu:[{type:"SeparatorItem"}]},d=function(e){const t=l.isKindOfsSync(e.type,["Workspace","Workspace Vault"]);let o=this.computeLockStatus(e),i=o.locked?o.locked_by_me?"key":"lock":"lock-open",r=o.locked?n.tooltip_reserved:n.tooltip_unreserved;t||(this.options.statusbarIconMap.set("lock",{icon:i}),this.options.statusbarTooltipMap.set("lock",r)),u(this.options)};function c(r){var s=this;if(this._filterCtx={},this.options=UWA.clone(a),this.options.statusbarIconMap=new Map,this.options.statusbarTooltipMap=new Map,this.options.statusbarIcons=[],this.options.statusbarIconsTooltips=[],r&&r.grid){if(this.options.subLabel=r.grid["ds6w:responsible"],this.options.description=r.grid["ds6w:identifier"],this.options.thumbnail=r.thumbnail?r.thumbnail:t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png"),d.call(this,r),"TRUE"==r.grid.isLinkedFolder&&(this.options.statusbarIconMap.set("shortcut",{icon:"open-in-a-new-window"}),this.options.statusbarTooltipMap.set("shortcut",n.tooltip_shortcut)),r.nodeAttrs&&r.nodeAttrs.isFavorite){var l=r.favoriteTitle;this.options.statusbarIconMap.clear(),this.options.statusbarIconMap.set("favorite",{label:l,icon:"favorite-on",emphasize:"primary"})}u(this.options)}r&&UWA.is(r.relcount)&&0===r.relcount&&(r.children=null),this.options=UWA.extend(this.options,r),this.options.grid.bi_color="rgba(0, 0, 0, 0)",this.options.grid.serviceId=this.options.grid.serviceId?this.options.grid.serviceId:"3DSpace",e.call(this,this.options),this.options.getAttributeValueForFiltering=function(e){return i.computeValueForFiltering({service:s.getAttributeValue("serviceId"),internalValue:s.getInternalValue("tree"===e?"label":e),propertyId:e})},o.setInfoOnTreeNode(this)}function u(e){e.statusbarIcons=[...e.statusbarIconMap.values()],e.statusbarIconsTooltips=[...e.statusbarTooltipMap.values()]}c.prototype=Object.create(e.prototype);var p={getInternalValue:function(e){return this.options.gridValue&&this.options.gridValue[e]?this.options.gridValue[e]:this.getAttributeValue(e)},clearInternalValues:function(){this.options.gridValue={}},getType:function(){return this.type||this.getAttributeValue("type")||this.options.type||this.getAttributeValue("ds6w:type-original")},getOccurencePath:function(e){if(UWA.is(e,"function")&&e(this),!0!==this.isRelationsObjectNode&&!this.isRoot()&&this.getParent()){var t=this.getParent().getOccurencePath(e);return t.push(this.options.relationid),t.push(this.options.resourceid),t}return[this.options.resourceid]},getOccurencePathWithType:function(){if(!this.isRoot()&&this.getParent()){var e=this.getParent().getOccurencePathWithType();return e.push({resourceid:this.options.relationid,type:this.options.relationtype}),e.push({resourceid:this.options.resourceid,type:this.options.type}),e}return[{resourceid:this.options.resourceid,type:this.options.type}]},getNodeByPath:function(e,t,o,i){if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof o||o<0||o>=e.length)&&(o=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t!==o&&(this.isExpanded()||this.childComputed||void 0!==i&&!1!==i)){var n=e[t+1],r=this.getChildren();if(r&&0!==r.length){for(var s=null,l=0;l<r.length&&null===s;l++){var a=r[l];n===a.options.relationid&&(s=a)}return null===s?this:s.getNodeByPath(e,t+2,o,i)}return this}return this}},hasChildren:function(t){return e.prototype.hasChildren.call(this)||!!(t&&this.options._childrenFilterInfo&&this.options._childrenFilterInfo.filteredOutChildren.length)},getID:function(){return this.options.resourceid},getRelationID:function(){return!0===this.isRelationsObjectNode?null:this.options.relationid},getNodesById:function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},getChildByIds:function(e,t){var o,i=this.getChildren();if(i)for(var n=0;n<i.length;n++)if(void 0===e){if(i[n].getID()===t){o=i[n];break}}else if(i[n].getRelationID()===e){o=i[n];break}function r(o){var i;return void 0===e?o.getID()===t&&(i=o):o.getRelationID()===e&&(i=o),i}if(void 0===o&&void 0!==this.options._childrenFilterInfo&&this.options._childrenFilterInfo.filteredOutChildren&&this.options._childrenFilterInfo.filteredOutChildren.length>0)for(var s=this.options._childrenFilterInfo.filteredOutChildren,l=0;l<s.length;l++){var a=s[l];if(o=r(a))break;var d=a.getChildren();if(d)for(var c=0;c<d.length&&!(o=r(d[c]));c++);}return o},_removeFilterInfo:function(){delete this.options._filterInfo},_removeChildrenFilterInfo:function(){delete this.options._childrenFilterInfo},_getFilterInfo:function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},_getChildrenFilterInfo:function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},isFilteredByTags:function(){return!0===this._filterCtx.FTags},isFilteredForScroll:function(){return!0===this._filterCtx.FScroll},filterIO:function(e,t){t?this.filterOut(e):this.filterIn(e)},hasFilter:function(){return Object.values(this._filterCtx).find((e=>!0===e))},filterOut:function(e){var t=this.isRoot()?this.getTreeDocument():this.getParent();this._filterCtx[e]=!0,null!==t&&this.isVisible()&&this.hide()},filterIn:function(e,{includeParents:t}={}){if(delete this._filterCtx[e],!this.isVisible()&&!this.hasFilter()&&!this.isFiltered()&&(this.show(),t&&!this.isRoot())){this.getParent().filterIn(e,{includeParents:t})}},_getNodesById:function(e,t){var o=!1;if(this.getID()===e)"string"==typeof this.options.icons[0]&&(this.options.icons=[{iconPath:this.options.icons[0]}]),t.listOfFoundNodes.push(this),o=!0;else{var i=this.getChildren();if(i)for(var n=0;i&&n<i.length;n++)o=i[n]._getNodesById(e,t)||o}return o},updateAttributes:function(e,t){if(!UWA.is(e,"array")||!UWA.is(t,"array"))throw new Error("Invalid argument(s)");var o=t,i=t.tree?t.tree:r.getTreeColumn(),n={};e.forEach((e=>{UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\\n/g," ")),"ds6w:type"===e.name&&(n.type=e.value),e.name===i?n.label=e.value:"type_icon_url"===e.name?(n.icons=[],n.icons.push(e.value)):"preview_url"===e.name||"thumbnail_2d"===e.name?(n.thumbnail=e.value,n.grid=n.grid?n.grid:{},n.grid.thumbnail="url("+e.value+")"):-1!==o.indexOf(e.name)&&(n.grid||(n.grid={}),n.grid[e.name]=e.value,this.options.gridValue&&this.options.gridValue[e.name]&&(n.gridValue||(n.gridValue={}),n.gridValue[e.name]=e.value))})),this.updateOptions(n)},isDescendantOf:function(e){var t;if(t=e instanceof c?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var o=this.getParent();if(o)return o.isDescendantOf(t)}return!1},getDepth:function(){for(var e=this,t=0;!e.isRoot();)e=e.getParent(),t++;return t},getLeaves:function(){var e=[];return this.processDescendants({processNode:function(){!1===this.hasChildren()&&e.push(this)}}),e},updateOptions:function(o){o.grid&&(this.options.thumbnail||o.thumbnail||(o.thumbnail=t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),o.subLabel=o.grid["ds6w:responsible"]?o.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",o.description=o.grid["ds6w:identifier"]?o.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"",o.type=this.getType(),d.call(this,o)),e.prototype.updateOptions.call(this,o)},childValidationChecker:function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",(function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate((function(){var t=e.getChildren().filter((function(e){return!0===e.options.waiting4validation}));if(t.length>0)for(var o=0;o<t.length;o++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[o].getOccurencePath())),e.removeChild(t[o])})))}))}},_isLockedByMe:function(e){var t=!0,o=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:e.padgrid&&e.padgrid["ds6w:reservedBy"]?e.padgrid["ds6w:reservedBy"]:"",i=e.grid["ds6w:displayName"]?e.grid["ds6w:displayName"]:e.padgrid&&e.padgrid["ds6w:displayName"]?e.padgrid["ds6w:displayName"]:"",n=require("DS/IPClassifyUtil/IPServicesMgr"),r=n.getUserLogin()?n.getUserLogin():"",s=n.getUserName()?n.getUserName():"";t=!0;return o.trim().length>0?(t=o.toUpperCase().trim()===r.toUpperCase().trim()||!1)||(t=o.toUpperCase().trim()===s.toUpperCase().trim()||!1):i.trim().length>0&&(t=s.toUpperCase().trim()===i.toUpperCase().trim()||!1),t},computeLockStatus:function(e){let t=e||this.options,o=!1,i=!1,n=t.gridValue&&t.gridValue["ds6w:reserved"]?t.gridValue["ds6w:reserved"]:t.grid["ds6w:reserved"];var r=t.grid["ds6w:reservedBy"]||"",s=t.grid["ds6w:displayName"]||"";let l=require("DS/IPClassifyUtil/IPServicesMgr");if(n=Array.isArray(n)?n.indexOf("TRUE")>=0:null!=n&&n,o="boolean"==typeof n?n:!(!n||"TRUE"!==n.toUpperCase()),o){var a=widget.userId||l.getUserLogin();a=a||"";var d=widget.fullName||l.getUserName();d=d||"",i=!0,r.trim().length>0?(i=r.toUpperCase().trim()===a.toUpperCase().trim()||!1,i||(i=r.toUpperCase().trim()===d.toUpperCase().trim()||!1)):s.trim().length>0&&(i=d.toUpperCase().trim()===s.toUpperCase().trim()||!1)}return{locked:o,locked_by_me:i,reserveBy:s||r}}};for(var h in p)c.prototype[h]=p[h];return c.prototype.filterCTX={FScroll:"FScroll",RNode:"RNode",FTags:"FTags"},c})),define("DS/FolderEditor/utils/xBookCustoStorageOptim",["UWA/Core","DS/FolderEditor/utils/FolderEditorUtil","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/IPClassifyUtil/IPSettingsMgr"],(function(e,t,o,i){"use strict";var n={dataIndex:void 0,text:void 0,visibleFlag:void 0,sortableFlag:void 0,pinned:void 0,customisation:{layout:{width:200,minWidth:50,maxWidth:300,removable:!0},exportable:{lock:!1,value:!0},titleModified:void 0}};let r=["hasNLS","convertInfos","filterOptions"];function s(e,t){var o={};if(void 0===t)o=e;else for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){let a=i[n];if(r.indexOf(a)<0&&"function"!=typeof e[a])if(UWA.is(e[a],"object")){var l=s(e[a],t[a]);Object.getOwnPropertyNames(l).length>0&&(o[a]=l)}else e[a]!==t[a]&&"text"!==a&&(o[a]=e[a])}return o}function l(e,t,o){var i={};if(void 0===e)i=t;else{for(let r in t){let s=t[r];if(UWA.is(s,"object")){if("bi_color"!==o){var n=l(e[r],s,o);Object.getOwnPropertyNames(n).length>0&&(i[r]=n)}}else void 0===e[r]?i[r]=t[r]:i[r]=e[r]}for(let t in e){i[t]||(i[t]=e[t])}}return i}return{convertCusto4Preference:function(e,r,l){const a=o.getViewByID(o.getView().UUID_RELATED_VIEW);var d={custoOptimized:!0,MP_VERSION:e.MP_VERSION,MP_VIEW_NAME:a?a.MP_VIEW_NAME:o.getView().MP_VIEW_NAME,UUID_RELATED_VIEW:o.getView()?o.getView().UUID_RELATED_VIEW||o.getView().MP_UUID:void 0,viewMode:e.viewMode,defaultCellHeight:e.defaultCellHeight,defaultcolumnHeaderHeight:e.defaultcolumnHeaderHeight,rowsHeader:e.rowsHeader,selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columnsOptimized:[],lang:i.getSetting("lang")};t.setContentSortmodel(e.sortModel),e.custoFromTree&&(d.custoFromTree=e.custoFromTree);for(var c=0;c<e.columns.length;c++){var u=e.columns[c];var p=s(u,n);r[u.dataIndex]&&(p.text=u.text),d.columnsOptimized.push(p)}return d},convertPreference2Custo:function(i,r){var s=t.getContentSortmodel(),a={viewMode:i.viewMode,defaultCellHeight:i.defaultCellHeight,defaultcolumnHeaderHeight:i.defaultcolumnHeaderHeight,rowsHeader:i.rowsHeader,MP_VERSION:i.MP_VERSION,sortModel:s,MP_SELECTED_TYPES:o.getSelectedTypes(),MP_SELECTED_EXTS:o.getSelectedExtensions(),MP_SELECTED_COLS:[],MP_UUID:"localView",MP_VIEW_NAME:i.MP_VIEW_NAME,UUID_RELATED_VIEW:i.UUID_RELATED_VIEW};i.custoFromTree&&(a.custoFromTree=i.custoFromTree);for(var d=0;d<i.columnsOptimized.length;d++){var c=i.columnsOptimized[d];let t=n;var u=l(c,e.clone(t),c.dataIndex);a.MP_SELECTED_COLS.push(u)}return a}}})),define("DS/FolderEditor/commands/tools/ColumnCustomization",["UWA/Core","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/utils/xBookCustoStorageOptim","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n){"use strict";var r=null,s=null;return{execute:function(e){let t=e.context.getPADTreeListView();require(["DS/IPTableColumnCusto/IPTableColumnCusto","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/FolderEditor/service/FolderPreferenceService","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/FolderEditorUtil","i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences",o.getColumnsDefinition()],(function(e,i,n,l,a,d,c,u,p){let h=c.getContentViewPreference();h=h||{};try{for(var g=(r=r||JSON.parse(p)).allowedIndexAttributes,f=l.getModelEvents(),m=[],v=t.options.dgvLayout.getOrderedColumnsIndexes(),_=0;_<v.length;_++){var S=t.options.dgv.getColumnOrGroup(v[_]);"defaultSort"!==S.dataIndex&&(S.attrDBName||(S.removable=!1),m.push(S))}const d=h.preference&&(h.preference.columns||h.preference.columnsOptimized)||m;i.updateColumnsWithNLS(d,(function(i){try{const i=a.getAllViews();h.MP_VIEWS=[...i.local,...i.admin,...i.user];var r=t?t.options.viewMode:parameters.tree.options.viewMode,d=Boolean(t),c=t?t.options.dgvLayout.rowsHeader:void 0;t&&(t.columnOrdering=!0);const p=o.getUserAppId()||o.getDefaultAppId();s=new e({prefJson:h,appId:p,withMePref:n.isLoadPreferencesSuccess(),lockCombo:void 0,moreColumnsBtn:!1!==o.getSettingParameter("canAddColumns"),modelEvents:f,viewMode:r,appColumns:m,manageAttrFromInstance:!1,baseInstanceTypes:[],selectedTypes:a.getSelectedTypes(),selectedExtensions:a.getSelectedExtensions(),withDgv:d,dgvInfo:t,rowHeaderActivated:c,dbOnlyAttributes:!0,classificationAttributes:!0,allowedIndexAttributes:g,defaultAttributes:g,supportedIndexAttrs:["ds6w:docExtension"]});var u=[];u.push(f.subscribe({event:"ENOBook/AttributesCustomization/columnSwitchDone"},(function(){s.options.dgvInfo.columnOrdering=!0}))),u.push(f.subscribe({event:"IPTableColumnCusto/AttributesCustomization/columnModification"},(function(e){switch(e.what){case"save":e.MP_SELECTED_COLS&&e.MP_SELECTED_COLS&&a.updateSelectedParams({selectedExtensions:e.MP_SELECTED_COLS,selectedTypes:e.MP_SELECTED_COLS}),a.setLocalView(e),n.updateDGVByViewId("localView"),t&&t.saveCustoView(e.applyOnlyToThisApp),l.publish({event:"saveViewInWidget"}),u.forEach((function(e){f.unsubscribe(e)}));break;case"apply":e.MP_SELECTED_COLS&&e.MP_SELECTED_COLS&&a.updateSelectedParams({selectedExtensions:e.MP_SELECTED_COLS,selectedTypes:e.MP_SELECTED_COLS}),a.addView("_currentView",{...e,current:!0}),n.updateDGVByViewId("_currentView"),u.forEach((function(e){f.unsubscribe(e)}));break;default:console.warn("Unknown column modification kind:"+e.what)}})))}catch(e){console.error("Error in DictionaryAccess.updateColumnsWithNLS:",e)}}))}catch(e){console.error("Error processing preferences:",e)}}))},endExecute:function(){},_getColumnCusto:function(){return s}}})),define("DS/FolderEditor/service/FolderPreferenceService",["css!DS/IPTableMePreferences/IPTableMePreferences.css","DS/FolderEditor/utils/SettingsHandler","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/xBookCustoStorageOptim","DS/MePreferencesClientAPI/MePreferencesClientAPI","i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences"],(function(e,t,o,i,n,r,s,l,a){const d=(t.getUserAppId()||t.getDefaultAppId()).replace(/_AP$/,"");var c=void 0;function u(e){n.setLocalView(e)}function p(e){e!==n.getLocalView().UUID_RELATED_VIEW&&o.publish({event:"switch_view",data:{viewId:e}})}return{isLoadPreferencesSuccess:function(){return c},updateDGVByViewId:p,saveViewInLocal:function(){let e=n.getView();if(!0!==e.local){let t=UWA.clone(e);delete t.MP_ADMIN,u(t)}},initializePreferences:async function(){!function(){const e=r.getContentViewPreference();let t=null;e&&e.preference&&(t=s.convertPreference2Custo(e.preference,"datagridview"),u(t),n.setCurrentView(t.MP_UUID))}(),await async function(){try{let e=await l.readPreferences([{Repository:t.getRepository()}]);const o=e&&e.repositories&&e.repositories[0];if(o&&o.preferences){let e=null;if(o.preferences.forEach((o=>{o.value="json"===o.datatype&&"string"==typeof o.value?t.parseMe(o.value):o.value;let i=n.getView();if("ENOFOL3_TABLE_CUSTO"!==o.name||i&&!0===i.local||(e=o.value.MP_ACTIVE_VIEW||"defaultView"),o.value&&o.value.MP_VIEWS)for(const[e,t]of Object.entries(o.value.MP_VIEWS))n.addView(e,{...t});o.name===`${d}_TABLE_DENSITY`&&n.setViewMode(o.value),o.name===`${d}_TABLE_ROW_HDR`&&n.setRowsHeader("true"===o.value)})),e){const t=n.getViewByID(e);t&&n.setCurrentView(t.MP_UUID)}}c=!0}catch(e){const t=n.getView();n.setLocalView(t),n.setCurrentView("localView")}}();try{await async function(){let e=await i._executeQuery("/resources/v1/FolderManagement/Folder/page/adminView",{inSource:"3DSpace",method:"GET",type:"json",headers:{"content-type":"application/json"}},"adminView");const t=JSON.parse(e.views||"{}");for(const[e,o]of Object.entries(t))n.addView(e,{...o,MP_ADMIN:!0})}()}catch(e){console.log(e)}this.saveViewInLocal()},getMenuItems:async function(){let e=n.getAllViews(),t=n.getView(),o=[],i=!1,r=t.UUID_RELATED_VIEW||t.MP_UUID,s=e.admin.find((e=>e.MP_UUID===r)),l=!s&&e.user.find((e=>e.MP_UUID===r));n.getDefaultView().MP_UUID===r||s||l||(o.push({views:e.local}),i=!0);let d=e.local&&e.local.length>0&&e.local[0].MP_VERSION,c=[{views:[n.getDefaultView()]},...o,{section:a.commandMenu.admin,views:e.admin},{section:a.commandMenu.user,views:e.user}],u=[];const h=c.flatMap((e=>e.views)).find((e=>e.MP_UUID===r));return r=h?r:"localView",c.forEach((e=>{e.views.length>0&&(e.section&&u.push({type:"TitleItem",title:e.section}),e.views.forEach((e=>{let o=!t||!i&&e.local||e.MP_UUID!==r?"":"selected",n=o&&t&&d?{iconName:"attention",fontIconFamily:1,className:"IP_Warning"}:void 0;u.push({type:"CheckItem",icon:n,title:a.views[e.MP_VIEW_NAME]||e.MP_VIEW_NAME,tooltip:n?a.tooltip.modificationNotStored:void 0,state:o,action:{callback:async()=>{p(e.MP_UUID)}}})})))})),u}}})),define("DS/FolderEditor/models/_xBookCVParser",["DS/FolderEditor/models/xBookNodeModel","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUXUtil/utils/DictionaryAccess","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorUtil"],(function(e,t,o,i,n,r){"use strict";var s="ds6w:Document",l={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}};function a(e){return e.isExpanded()||"noChildren"===e.getState()}function d(t,o,i){let n=i.selectMatches,r=i.settingExpandAllNotShape,l=i.possibleParents,a=i.refresh,c=i.state;var u=t.hasChildren(!0);o._children.forEach((o=>{let a=o["ro.plminstance.V_treeorder"]||o.TreeOrder;a&&(a=parseFloat(a),a=isNaN(a)?-1:a);let c=a||-1,h=o.resourceid,g=o["ds6w:type"],f=o["ds6w:label"],m=o._to,v=u?t.getChildByIds(h,m.attributes.physicalid):null;if(UWA.is(v,"object")){var _=UWA.clone(m.attributes);_.relationOrder=c,_.grid.instanceName=f,_.grid.expandable="TRUE",delete v.options.waiting4validation,delete v.options.alternText;var S={needRequestNls:!0,changeState:!1};p(v,_,S)}else{var C=UWA.clone(m.attributes);C.relationid=h,C.relationtype=g,C.relationOrder=c,C.grid.instanceName=f,C.grid.expandable="TRUE",v=new e(C),t.addChild(v),v._manageNLS=!0}let y=!v.hasChildren(!0);r&&y?(v.setState({state:"noChildrenExpanded"}),v.options.children=void 0):(v.getState().startsWith("noChildren")||"expanded"===v.getState()&&y)&&(v.setState({state:"collapsed"}),v.options.children=[]),r&&v.options.grid.globaltype===s&&l.push(t),m._children.length>0&&d(v,m,i),n&&!0===m._select&&v.select()})),(!0!==a&&"expanded"!==t.getState()||!0===o._expandedNode)&&(t.setState({state:c}),t.options.padstate=c),t.childComputed=!0}Object.freeze(l);var c={};function u(e,t){for(var o={},i=e||{},n=Object.getOwnPropertyNames(i),r=0;r<n.length;r++)t[n[r]]?t[n[r]]!==e[n[r]]&&(o[n[r]]=e[n[r]]):o[n[r]]=e[n[r]];return o}function p(e,t,o){var n=!1,r=null,s={};t.label!==e.options.label&&(s.label=t.label,n=!0),function(e,t){var o=!1;if(e instanceof Array&&t instanceof Array){var i=e.length;if(i===t.length){for(var n=0;n<i;n++)if(e[n]!==t[n])return!1;o=!0}}return o}(t.icons,e.options.icons)||(s.icons=t.icons,n=!0),t.thumbnail&&t.thumbnail!==e.options.thumbnail&&(s.thumbnail=t.thumbnail,n=!0),t.display!==e.options.display&&(s.display=t.display,n=!0),t.type!==e.options.type&&(s.type=t.type,n=!0),null!==r||"expanding"!==e.getState()||o&&!1===o.changeState||(r=l.EXPANDED);var a=u(t.grid,e.options.grid);UWA.equals(a,{})||(s.grid=a,n=!0);var d=u(t.gridValue,e.options.gridValue);if(UWA.equals(d,{})||(s.gridValue=d,n=!0),t.padgrid){var c=u(t.padgrid,e.options.padgrid);UWA.equals(c,{})||(s.padgrid=c,n=!0)}n&&(o&&!0===o.deleteTempOptions&&(delete e.options.waiting4validation,delete e.options.alternText),e.updateOptions(s),e._manageNLS=!0,o&&o.needRequestNls&&e.isVisible()&&i.updateNLS(e)),r&&e.setState(r)}function h(e){for(var t=0,o=0;o<e.length;o++){t=e[o].options.grid.globaltype!==s?t+1:t}return t}return c.parse_attributes=function(e,t){var o=require("DS/IPClassifyUtil/IPSettingsMgr"),i={type:e["ds6w:type"],resourceid:e.resourceid,grid:{},gridValue:{}};for(let t in e){let o=e[t];UWA.is(o)&&UWA.is(o.replace,"function")&&(o=o.replace(/\n/g," "),e[t]=o),"string"==typeof o&&-1!==o.indexOf("[")&&-1!==o.indexOf("]")&&(o=o.replace("[",""),o=o.replace("]",""),-1!==o.indexOf('"')&&(o=o.replaceAll('"',""))),r.addValueInGrid(i,t,o)}let n=e.icon||e.type_icon_url;i.icons=n?[n]:[];let s=e[t];if(s&&(i.label=s,i.display=s),o.getSetting("activateFUN085903")){let t=e["ds6w:globalType"];t&&(i.grid.globaltype=t)}return i.grid&&i.grid.owner&&!i.grid["ds6w:responsible"]&&(i.grid["ds6w:responsible"]=i.grid.owner),i},c.process={expand:function(e){e.starting_from_root=void 0===e.starting_from_root||e.starting_from_root;var o=[],i=require("DS/IPClassifyUtil/IPSettingsMgr").getSetting("activateFUN085903")&&(-1===e.expand_level||e.expand_level>1);e.treedocument.prepareBroadcastSelect();let n=e.realExpandedNodes;n=n||Object.values(e.root_nodes);let r={};const s=require("DS/IPClassifyUXUtil/utils/DictionaryAccess");var l,u;n.forEach((t=>{r[t.getID()]=t;let o=t.getAllDescendants({onlyVisibleNodes:!0}),i=!0;"refresh"===e.mode&&(t.childComputed=!1,i=!1,t.options.children=[],t.setHasAsyncChildren(!0)),o.forEach((e=>{i&&s.updateNLS(e),a(e)&&(r[e.getID()]=e)}))})),l=e.treedocument,u=function(){var l={nodes:{}};e.response.results&&e.response.results.length>0&&e.response.results.forEach((function(o){if(o.from&&o.to){let e=l.nodes[o.from],t=l.nodes[o.to];e&&t&&(o._to=t,!0!==e._noChildren&&e._children.push(o))}else if(o.Path){if(e.selectMatches){let e=l.nodes[o.Path[o.Path.length-1]];e&&(e._select=!0),o.matching_lengths&&o.matching_lengths.length>0&&o.matching_lengths.forEach((e=>{let t=l.nodes[o.Path[e-1]];t&&(t._select=!0)}))}}else{var i=c.parse_attributes(o,t.getTreeColumn());let n=r[i.resourceid];l.nodes[i.resourceid]={attributes:i,_expandedNode:!!n,_noChildren:"refresh"===e.mode&&(!n||!a(n)&&0===n.getChildren().length),_children:[]}}}));var u="expanded",g=!1;"validate_branch"===e.mode?u="partiallyExpanded":"find_in_ctx"===e.mode?(u="partiallyExpanded",i=!1):"refresh"===e.mode&&(g=!0,i=!1),n.forEach((t=>{let n=t.getID(),r=l.nodes[n];if(r){let n=e.selectMatches;d(t,r,{selectMatches:n,settingExpandAllNotShape:i,possibleParents:o,refresh:g,state:u}),p(t,r.attributes,{changeState:!g}),n&&!0===r._select&&t.select(),delete t._manageNLS,s.updateNLS(t)}})),i&&function(e,t){t._collapseRepDuringExpandAll=!0;for(var o=0;o<e.length;o++){var i=e[o];1===i.getNumberOfChildren()&&0===h(i.getChildren())&&i.collapse()}delete t._collapseRepDuringExpandAll}(o,e.treedocument),e.treedocument.pushBroadcastSelect()},l.withTransactionUpdate(u)},insert_temporary_branches:function(t){if(!UWA.is(t.treedocument,"object")||!UWA.is(t.branches,"array"))throw new Error("Invalid input parameters");var i=[],r=[],s=[],l=[],a=[],d=t.treedocument,c=t.node_state?t.node_state:"partiallyExpanded",u=t.branches;return d.withTransactionUpdate((function(){u.forEach((function(d){var u,p=null,h=t.treedocument.getRoots(),g=0;for(u=0;u<h.length&&null===p;u++)if(d[0]===h[u].getID()){l.push(d[0]);var f=(p=h[u]).getNodeByPath(d,void 0,void 0,!0);f&&(p=f,g=d.indexOf(p.getID()))}if(p&&p.getID()!==d[d.length-1])for(var m=g+1;m<d.length;m+=2){var v=d[m],_=d[m+1],S={resourceid:_,relationid:v,label:n.loadingText,icons:[o.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")],thumbnail:o.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:n.loadingText,waiting4validation:!0},C=new e(S),y=p.getState();p.addChild(C),"collapsed"===y?(c!==y&&(p.setState({state:c}),p.options.padstate=c),p.childValidationChecker()):"partiallyExpanded"===y&&(p.setState({state:y}),p.options.padstate=y,-1===r.indexOf(_)&&r.push(_),-1===s.indexOf(v)&&s.push(v)),p=C,-1===i.indexOf(_)&&i.push(_),-1===a.indexOf(v)&&a.push(v)}}))})),{ids_to_fetch:i,relationids:a,rootsAlreadyLoaded:l,visibleNodesIds:r,visibleNodesRelIds:s}}},c})),define("DS/FolderEditor/infra/xBookComponent",["i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/UIKIT/Mask","DS/Utilities/Utils","DS/WebappsUtils/WebappsUtils","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/Folder_CSO","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/WidgetHandlerUtil","DS/Utilities/Dom"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y){"use strict";function b(e){var t=this,i={};return["doDnDDragStart","doDnDDrop"].forEach((function(e){o.is(t[e],"function")&&(i[e]=t[e].bind(t))})),i}function E(){var e=this,t={},o=new s((function(o){require([e.options.amd_custo.TreeDocument],(function(i){(t=b.call(e)).authorize_setStructure=e.options.authorize_setStructure,t.insert_replace=e.options.insert_replace,t.renderTo=e.options.renderTo,t.useAsyncPreExpand=!0,t.shouldBeSelected=function(e){return!e.hasOwnProperty("isRelationsObjectGroupingNode")||!e.isRelationsObjectGroupingNode},e.options.model=new i(t),p.registerTreeDocument("CONTENT",e.options.model),e.options.model.useAsyncPreExpand=t.useAsyncPreExpand,e.options.model.getModelEvents().subscribe({event:"onRootAdded"},(function(t){if(t.data.added_node&&!1===e.options.layout.withWelcomePanel){var o=t.data.added_node.getID();e.dispatchEvent("onAddPaths",{addedPaths:[[o]]})}}));var n=a.debounce((()=>{let t=e.options.model.getSelectedNodes(),o={};t.forEach((e=>{let t=e.getSourceId(),i=e.getAttributeValue("i3dx"),n=i,r=i?"[ds6w:i3dx]":"physicalid";i||(n=e.getID());let s=o[r+t];s||(s=o[r+t]={ids:[],key:r,source:t,serviceId:e.getAttributeValue("serviceId")}),s.ids.push(n)})),f.focusOnObjects(Object.values(o))}),200);e.options.model.getXSO().onChange(n),e.options.model.getModelEvents().subscribe({event:"onCenterGraph"},(function(t){e.options.views.treelistview?e.options.views.treelistview.getManager().scrollToNode(t.data,void 0,!1):e.options.views.datagridview.options.dgv.ensureNodeModelVisible(t.data),e.options.views.graphview&&e.options.views.graphview.reframeOn()})),e.options.model.addEventListener("beginBlockingTransaction",(function(t){e.beginBlockingTransaction(t.data)})),e.options.model.addEventListener("endBlockingTransaction",(function(){e.endBlockingTransaction()})),e.options.isReady.model=!0,o()}))}));return o.name="build",o}function D(e){var t=this;t.elements.container.empty(),o.createElement("div",{class:"xnav_hdr"}).inject(t.elements.container),o.createElement("div",{class:"xnav_body"}).inject(t.elements.container),o.createElement("div",{class:"xnav_footer"}).inject(t.elements.container);let i=o.createElement("div",{class:"xbook_viewmain"}),n=o.createElement("div",{class:"FolderEditor_contentView_loader"}).inject(i);h.setContainer("contentView",n);var r=new s((function(n,r){var l=[],a=t.elements.container.querySelector(".xnav_body"),d=new s((function(n,r){require(["DS/ENOXTriptych/js/ENOXTriptych","DS/IPClassifyUtil/IPClassifyModelEvents"],(function(r,s){var l=o.clone(t.options.layout.triptychOpts);l.modelEvents=s.getModelEvents(),l.container=t.elements.container.querySelector(".xnav_body");let a=o.createElement("div",{class:"xbook_viewright rightSidePanel"});t.elements.padshell=new r,t.elements.padshell.init(l,t.createRootListSlidder2(),i,a),t.elements.padshell.togglePanel=function(e){if("left"===e)t.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"});else{t.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"});let e=t.elements.padshell._modelEvents.subscribe({event:"triptych-clicked-overlay"},(function(e){e&&"right"===e&&s.publish({event:"onOverlayClick"})}));t._subscriptionTokens.push(e)}},s.publish({event:"on2DTriptychReady"}),require(["DS/IPClassifyUXUtil/ActionBar/IPCommandManager"],(function(e){var t=e.getCmdCheckHeaderByContext("RootPanel");t&&t.addCallback()})),e.then((()=>{w.call(t,{renderTo:i},n)}))}))}));d.name="slidder",l.push(d),s.all(l).then((function(e){t.options.isReady[t.options.active_view],t.elements.padstatus&&(!0===t.options.layout.padshell?t.elements.padstatus.inject(t.elements.padshell.getMainPanelContainer()):t.elements.padstatus.inject(a)),n()}))}));return r.name="buildSkeleton",r}function w(e,t){var o=this;require(["DS/FolderEditor/views/ViewLoader"],(function(i){var n={component:o,x3dAppId:o.options.x3dAppId,renderTo:e.renderTo,multiselection:o.options.multiselection,amd:{treelistview:o.options.amd_custo.TreeListView,tileview:o.options.amd_custo.TileGridView,thumbnailview:o.options.amd_custo.ThumbnailGridView,datagridview:o.options.amd_custo.DataGridView}};o.loader=new i(n),o.loader.loadView(o.options.active_view,(function(){t()}))}))}return i.extend(n,r,{_dispatchReady_NotDone:!0,defaultOptions:{widget:null,elements:null,toolbar_opts:null,multiselection:!0,layout:{padshell:!1,title_update:!0,view_customization:null,store_roots_in_pref:!0,drop_invite:"dynamic",keyboard_inputs:!0,withWelcomePanel:!1,triptychOpts:{left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:105,originalSize:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}}},amd_custo:{TreeDocument:"DS/FolderEditor/xBookDocument",TreeListView:null,TileGridView:null,ThumbnailGridView:null,DataGridView:null},views:{treelistview:null,graphview:null,tileview:null,thumbnailview:null,datagridview:null},views_cb:{},isReady:{model:!1,actionbar:!1,treelistview:!1,graphview:!1,tileview:!1,thumbnailview:!1}},setDnD_onGraph:function(){},init:function(i){this._subscriptionTokens=[],this._parent(i),this.options=o.extend(this.options,i,!0),this.elements.container=o.createElement("div",{class:"xbook_component"}),this.options.flags={};var n=this;require(["DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPServicesMgr"],(function(i,r){i.setSetting("lang",c.getLanguage()),r.app_initialization((function(r){if(r&&!0===r.success){var l=E.call(n),a=D.call(n,l);s.all([l,a]).then((function(){n.options.model.getVisibleAdditionalColumns=async function(){var e=[];let i=n.getPADTreeListView(),r=i&&i.getManager();if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length){let u=r?await t.getColumnsCompleted(r.columns):[];for(var s=0;s<n.options.additionalColumnsModules.length;s++){var l,a=[],d=n.options.additionalColumnsModules[s];l=r?d.getManagedColumnNames({columns:u}):d.getManagedColumnNames({columns:[]});for(var c=0;c<l.length;c++)(d.allViewsSupported||i&&o.is(i.isColumnHidden,"function")&&!i.isColumnHidden(l[c]))&&a.push(l[c]);a.length&&e.push({module:d,columns:a})}}return e},n._dispatchReady(!1),u.subscribe({event:"FolderEditor/expandStatus"},(function(t){t.status&&!0===t.status.expandTooLarge&&("find_in_ctx"===t.mode?S.displayNotification({message:e.replace(e.tooManyResultFound,{maxResult:i.getSetting("maxPathsForSearch")}),className:"warning"}):S.displayNotification({message:e.expandTooLarge,className:"warning"}))}))}))}else n._initialize_failure((function(){n.dispatchEvent("onReady",{error:!0})}))}))}))},render:function(){return this.elements.container},toggleView:function(e){if(e!==this.options.active_view){let t=y.isCurrentlyCalledFromUIInteraction();"treeview"===e&&(e=this.options.layout.amdTreeView),this.loader.loadView(e,(()=>{this.options.views[this.options.active_view].unsetModel(),this.options.active_view=e,this.options.model.applyActiveView(this.options.active_view),this.options.views[this.options.active_view].setModel(this.options.model),"graphview"===this.options.active_view&&this.options.views.graphview.reframeOn(),this.dispatchEvent("onToggleView",{view:this.options.active_view,fromUIInteraction:t})}))}},beginBlockingTransaction:function(e){l.mask(this.elements.container,e)},endBlockingTransaction:function(){l.unmask(this.elements.container)},onResize:function(){this.options.model.invalidateViewPort(),"graphview"===this.options.active_view&&this.options.views.graphview.setSize(),this.dispatchEvent("onParentResize")},getPADTreeDocument:function(){return this.options.model},getRoots:function(){return this.options.model.getRoots()},getPADTreeListView:function(){return this.options.views.datagridview},togglePanel:function(e,t){(this.elements.padshell?this.elements.padshell:this.elements.padinfo).togglePanel(e,t)},destroy:function(){this._subscriptionTokens.forEach((e=>{u.unsubscribe(e)})),this._subscriptionTokens=[],this._parent()},displayNotification:function(e){require(["DS/IPClassifyUtil/IPClassifyAlert"],(function(t){t.displayNotification(e)}))},_initialize_failure:function(t){var o=this;require(["DS/FolderEditor/views/xBookInitError"],(function(i){var n=e.initialization_error;o.elements.bigerror=new i({msg:n}),o._just_error_content(),o.displayNotification({message:n,className:"error"}),t()}))},_just_error_content:function(){this.elements.bigerror&&this.elements.container.setContent(this.elements.bigerror)},updateAttributesDelayed:function(e){this._debounceMethod=this._debounceMethod||a.debounce(this.updateColumns.bind(this),200),!(e&&e.collectionView&&e.collectionView.getRowModelLength&&0===e.collectionView.getRowModelLength())&&this._debounceMethod(e)},handleUpdateColumnsInChunks:async function(t){let{rejectOnCancel:o,columns:i}=t||{};let n=!1,r=null;h.addComponentsToLoad("global",{attrComputation:e.attrComputation},{withCancel:!0,cancelObject:{cancel:()=>{r&&r.cancel(),n=!0}}});let s=this.getPADTreeDocument().getChildren().length;h.updateComponentPercent("global","attrComputation","0%");try{for(let e=0;e<s;e+=100)if(!n){const t=e,n=Math.min(e+100,s),l=e/s*100;h.updateComponentPercent("global","attrComputation",`${l}%`),r=this.updateColumns({collectionView:this.getPADTreeListView().getManager(),startNodeIndex:t,endNodeIndex:n,columns:i,context:"OnCompletion",rejectOnCancel:o}),await r}}catch(e){C.manageException(e,{throwIt:!0})}finally{h.updateComponentPercent("global","attrComputation","100%"),h.removeComponentToLoad("global","attrComputation")}},updateColumns:function({columns:e,collectionView:t,startNodeIndex:o,endNodeIndex:i,context:n,rejectOnCancel:r}){let l=new v((async()=>{let r=e?this.options.additionalColumnsModules.filter((t=>e.indexOf(t.getName())>=0)):this.options.additionalColumnsModules;await new s((e=>setTimeout(e)));var a=[];if(t&&t.model){var d=t;a=i>=0?d.model.slice(o,i+1):d.model.slice(o,i)}if(a.length){let e=t.columns;var c=this.options.model.fillAdditionalColumnsValues(a,{additionalColumnsToFill:r,allAdditionalColumns:this.options.additionalColumnsModules,columns:e});if(l.addLinkedQuery(c),await c,a.forEach((e=>{e._manageNLS&&(delete e._manageNLS,_.updateNLS(e))})),"OnCompletion"!==n){let e={physicalid:{},"[ds6w:i3dx]":{}};a.forEach((t=>{let o=t.getAttributeValue("i3dx"),i=!!o;o=o||t.getID();let n=t.getAttributeValue("serviceId");n=n||"3DSpace";let r=i?e["[ds6w:i3dx]"]:e.physicalid,s=r[n];s||(r[n]=s=[]),s.push(o)})),f.updateColorNodes(e),"datagridview"===this.getActiveView()&&g.isRelationsColumnsActive()&&function(e,t){require(["DS/ENORIPE_RelationsColumns/RelationsColumns","DS/PADServices/utils/PlatformURL","DS/FolderEditor/utils/FolderSearch"],((o,i,n)=>{n.isSearchActive()||i.retrievePlatformUrl().then((()=>{var i=new Set(e.filter((e=>!e.isRelationsObjectNode&&!e._isProcessedForRelationsColumns)).map((e=>(e._isProcessedForRelationsColumns=!0,e.getID()))));if(i.size>0){var n=p.getSelectedContent();o.toBeUpdated({pids:[...i]},"SyncModelRefresh"),o.updateAttributes({pids:[...i],noIconUpdate:!0},(()=>{n.forEach((e=>e.select()))}),t.options.model)}}))}))}(a,this)}}}),{rejectOnCancel:r});return l}})})),define("DS/FolderEditor/views/FolderOrderCmd",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/SettingsHandler","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUtil/IPClassifyUtility"],(function(e,t,o,i,n,r,s,l){"use strict";return e.extend(t,o,{_name:"folder_orderTools",_defaultOptions:{sortMode:"alpha",sortOrder:"asc"},init:function({treeCont:e}){this._parent(),this._treeCont=e,this.sortMode=widget.getValue("sortMode")||this._defaultOptions.sortMode,this.sortOrder=widget.getValue("order")||this._defaultOptions.sortOrder},toggleButton:function(){this.sortMode="alpha",this._toggleButton()},toggleButtonDate:function(){this.sortMode="date",this._toggleButton()},_toggleButton:function(e){if(void 0!==e?(this.sortMode="defaultSort",this.sortOrder="asc"):this.sortOrder&&("asc"===this.sortOrder?this.sortOrder="desc":this.sortOrder="asc"),"read"==n.getCurrentModeType()){let e=this._treeCont;e._indexModeforReadData.resetInfoIndex(),r.getSections().filter((e=>!!e.roots)).forEach((t=>{let o=t.name;e._rootNodes[o].isExpanded()&&(e._rootNodes[o].collapse({updateView:!0}),e._rootNodes[o].expand({updateView:!0}))}))}else this.sortingNodesUnsensitiveCase();widget.setValue("sortMode",this.sortMode),widget.setValue("order",this.sortOrder)},isTreeSort:function(){return"defaultSort"==this.sortMode},isAlphaSort:function(){return"alpha"==this.sortMode},getSortMode:function(){return this.sortMode},sortingNodesUnsensitiveCase:function(){s.publish({event:"reapply_tree_sort",data:{sortModel:[{dataIndex:"tree",sort:this.sortOrder}]}})},sortingChildrenNodes:function(e,t){"defaultSort"==t&&(this.sortMode=t);let o=this._treeCont._folders_TreeView;o.prepareUpdateView(),e.sortChildren({isRecursive:!0,sortFunction:(e,t)=>("asc"===this.sortOrder?1:-1)*this.mySortFunction(e,t)}),o.pushUpdateView()},sortByDate:function(e,t){let o;try{o=new Date(e.options.created)>new Date(t.options.created)?1:new Date(e.options.created)<new Date(t.options.created)?-1:0}catch(i){o=e.options.created<t.options.created?-1:1}finally{return o}},mySortFunction:function(e,t){if(void 0!==e.sectionIndex)return("asc"===this.sortOrder?1:-1)*(e.sectionIndex-t.sectionIndex);if(!0===e.isFavorite)return 0;if("date"===this.sortMode)return this.sortByDate(e,t);if("defaultSort"==this.sortMode){if(r.isSubElement(e.getType(),e.section)&&r.isSubElement(t.getType(),e.section)){let o=parseFloat(e.options.relationOrder),i=parseFloat(t.options.relationOrder);return o>i?1:i>o?-1:0}return this.sortByDate(e,t)}return l.compareLabels(e.options.label,t.options.label)}})})),define("DS/FolderEditor/xBookDocument",["UWA/Core","DS/Logger/Logger","DS/i3DXCompassServices/i3DXCompassPubSub","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPServicesMgr","DS/WidgetServices/WidgetServices","DS/TreeModel/TreeDocument","DS/FolderEditor/models/xBookNodeModel","DS/FolderEditor/models/_xBookCVParser","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/PlatformAPIWrapper","DS/ApplicationFrame/CommandsManager","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/FolderEditor/tagger/TaggerContentProxy","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/plugins/product/PrdUtils","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderCommunication","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/IPClassifyUtil/PlatformAPIWrapper","DS/Utilities/Utils","DS/IPClassifyUXUtil/ActionBar/IPCommandManager"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F){"use strict";function T(e,t,{additionalColumnsModules:o,columns:i}){for(var n=0;n<o.length;n++){var r,s=o[n];i=i||[],r=s.getManagedColumnNames({columns:i});for(var l={},a=0;a<r.length;a++)l[r[a]]=e.options.grid[r[a]];if(!0===s.toBeUpdated(l,e)){var d=s.getName(),c=t[d];c||(c={pids:[],nodes:[]},t[d]=c);var u=e.getID();c.pids.push(u),c.nodes.push(e)}}}function x(e){if("object"!=typeof e)throw new Error(e+" is not a json object")}function P(e,t,o){let i=t.highLightNodes;return new Promise(((r,s)=>{var l=t.nodes[o];l.setState({state:"expanding"});let a={};a[l.getRoot().getID()]={paths:[l.getOccurencePath()]},m.expandProductsForDisplay(a,{db:!1,findIn:{query:t.query},filters:_.getFilterTags(),max_output_paths:n.getSetting("maxPathsForSearch")}).then((t=>{try{x(t);var o=l;o.isRoot()||(o=o.getRoot());let i={};i[o.getID()]=o;d.process.expand({treedocument:e,root_nodes:i,response:t,mode:"find_in_ctx",expand_level:-1,selectMatches:!0,realExpandedNodes:[l]}),S.publish({event:"reapply_content_sort"})}catch(e){console.log(e),e.type&&"TimeoutError"===e.type?(u.displayNotification({message:g.find_in_context_timeout,className:"error"}),function(e){for(var t=0;t<e.length;t++){var o=e[t];setPartialIfHasChildren(o),o.childComputed=!1,o.processDescendants({processNode:function(e){setPartialIfHasChildren(this),this.childComputed=!1}})}}([l])):u.displayNotification({message:g.generic_service_failure,className:"error"})}finally{var i;if(!0!==t.timeoutOccurs)e.getXSO().get().forEach((function(t){e._selection.push(t.getOccurencePath())})),0===l.options.relcount?(l.options.children=null,i="noChildrenExpanded"):i="partiallyExpanded",delete l._expandAllPending,l.setState({state:i}),N(!0),e.getXSO().empty();r()}})).catch((function(t){console.log(t),k(l),l._expandAllPending&&delete l._expandAllPending,N(!0),l.setState({state:"collapsed"}),i(e.getRoots(),[],[]),v.removeComponentToLoad("contentView","content"),t&&t.timeout&&u.displayNotification({message:g.find_in_context_timeout,className:"error"}),s()}))}))}function A(e,t,o){return new Promise((function(i,n){o<t.nodes.length?P(e,t,o).then((function(){A(e,t,o+1).then(i).catch(n)})):i()}))}function k(e){e.preExpandDone({preventExpandAll:!1,state:"collapsed"})}function N(e){var t=F.getCommandByContext("ExpandAll");t&&(e?t.enable():t.disable())}return l.extend({_broadcastSelect:!0,_selected_paths:[],id:"mainNodeModel",_selection:[],_selectedIdx:null,_focusOn:!1,_reframeFocus:!1,_currentApp:null,_emptyFromProxy:!1,_isVolumeFilter:!1,init:function(o){var i=o||{},n=this;if(this._logger=t.getLogger("DS/FolderEditor/xBookDocument"),n.renderTo=o.renderTo?o.renderTo:document.body,i.nodeModelClass=a,this._parent(i),this.options.viewport={graph:null,tree:null},this.onPreExpand(this.xnav_expand.bind(this)),this.forceSyncModel4TreeListView=function(){},S.subscribe({event:"expand_content_branch"},(e=>{if(e.length>0)if(this.searchRootById(e[0]))this.insertBranches([e],{onComplete:()=>{let t=e[e.length-1],o=this.getNodesById(t);o&&1===o.length&&o[0].select(!0)}});else{let e=widget.getBool("filtered-content")?g.msg_warning_notProductRootInFilteredContext:{message:g.msg_warning_notProductRoot};u.displayNotification({...e,className:"warning"})}})),S.subscribe({event:"updateContentNodes"},(e=>{if(e.items){let i=[];for(var t in e.items){let n=e.items[t],r=this.getNodesById(t);if(r.length>0){let e=r[0];if(n.badge&&b.setBadges(e,n.badge),n.attributes)for(var o in n.attributes)e[o]=n.attributes[o];if(n.options){let t={grid:n.options.grid,resourceid:n.options.resourceid,label:n.options.label};e.updateOptions(t)}let s=null;n.grid?s={grid:n.grid}:n.relationOrder&&(s={grid:{relationOrder:n.relationOrder},relationOrder:n.relationOrder}),s&&(n.gridValue&&(s.gridValue=n.gridValue),e.updateOptions(s)),i.push(t)}}}})),S.subscribe({event:"unselect_content"},(()=>{this.unselectAll()})),!e.is(i.remove_broadcast)||!0===i.remove_broadcast){p.subscribe("DS/ENO/select",(function(t,o){if(o.originWidgetId!==widget.id&&!0!==t.searchDone){if(1==t.focusOn&&t.sharedID&&t.sharedID!==r.getSharedId())return;var i=t.paths;n._selected_paths=e.clone(i);!function(){n._selected_paths.length?n._selectOccurence("",!0,!0):o.appid===p.getMetadataAppId()&&(n._doNotBroadcastSelect=!0,n._emptyFromProxy=!0,n.unselectAll(),n._directSelection=!1);for(var e=[],t=0;t<n._selected_paths.length;t++){n.getNodeByOccurencePath(n._selected_paths[t])&&e.push(n._selected_paths[t])}e.length===i.length&&e.length>0&&e.forEach((function(e){var t=e.length;if(t>2){var o=n.getNodesById(e[t-3]);o&&o.length>0&&!0}})),n._selected_paths=e}()}}));var s=I.debounce((async function(){if(n._directSelection=!0,n._selected_paths=[],!n._doNotBroadcastSelect){if(!0!==n.searchProgress){let e=await n._buildSelectData();w.publish("DS/ENO/select",{...e,metadata:!0}),w.publish("DS/PADUtils/PADCommandProxy/select",{...e,metadata:!0})}n.broadcastSelect(n.getXSO().get())}n._doNotBroadcastSelect=!1}),300);this.getXSO().onPostAdd((function(){s(),n._focusOn=!1})),this.getXSO().onPostRemove?this.getXSO().onPostRemove(s):this.getXSO().onRemove(s),this.getXSO().onEmpty((function(){!1===n._emptyFromProxy?n._doNotBroadcastSelect=!1:n._emptyFromProxy=!1,s()})),this.getXSO().onPreEmpty((function(){!1===n._emptyFromProxy&&(n._doNotBroadcastSelect=!0)}))}},addTagsForChildren:function(){var e=new Set,t=new Set;this.getRoots(!0).forEach((o=>{o.getAllDescendants().forEach((t=>{t.isRelationsObjectNode||e.add(t.getID())})),(o.isVisible()||o.isFiltered()&&!o.isFilteredByTags())&&t.add(o.getID())})),e.size>0&&_.addObjectsTags([...e]).then((e=>{null!==e&&this.filterFromIds([...e,...t])})).catch((()=>console.log("Error during retrieve tags")))},reapplyAppFiltering:function(){this.getAllDescendants().forEach((e=>{e.isFilteredByTags()&&e.filterOut(e.filterCTX.FTags)}))},updateLinksFromStatus:function(e){let t=f.getCountToLoadOnGrid(),o=this.getRoots(!0),i=!0;for(let n=o.length-1;n>=0;n--){let r=o[n],s=!!t&&n>t,l=r.getAttributeValue("links");i=i&&!!l,(l||s||e)&&(e||!s&&!i?r.filterIn(r.filterCTX.FScroll):r.filterOut(r.filterCTX.FScroll))}},filterFromIds:function(e){this.withTransactionUpdate((()=>{var t=new Set(e);this.getAllDescendants().forEach((e=>{t&&t.has(e.getID())?e.filterIn("FTags",{includeParents:!0}):e.filterOut("FTags")})),this.getRoots().forEach((function(e){let t=e.getVisibleChildren()?e.getVisibleChildren().length:0;(e.getChildren()?e.getChildren().length:0)>t&&"collapsed"!==e.getState()&&(e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded")}))}))},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach((function(o){for(var i=0;i<t.length;i++){var n=o.getNodeByPath(t[i],void 0,void 0,!0);n&&e.push(n)}})):e=this.getXSO().get();return e},_getLastViewpoint:function(e){e(null)},broadcastSelect:async function(e){if(e=e||this.getSelectedNodes(),!0===this._broadcastSelect&&!0===this.options.authorize_setStructure)if(E.setObject_on_compass({nodes_2_open:e}),!1===n.getSetting("settypes"))r.setStructure_4_open_in_cv5({nodes_2_open:e,selected_paths:this._selected_paths});else if(C.setTypesForOFW(this),!await C.expandIsRequired(e)&&e&&e.length>0){var t={objectId:e[0].getID(),envId:r.getPlatformId(),contextId:i.getCredential(),serviceId:e[0].getAttributeValue("serviceId")};o.publish("setObject",t)}},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:async function(){if(!0!==this.searchProgress){let e=await this._buildSelectData();w.publish("DS/ENO/select",{...e,metadata:!0}),w.publish("DS/PADUtils/PADCommandProxy/select",{...e,metadata:!0})}this.broadcastSelect(),this._doNotBroadcastSelect=!1},_findInCtx:function(e){this.searchProgress=!0,this.prepareUpdate(),this.prepareBroadcastSelect(),this._selection=[],this.getXSO().empty(),this._flatNodes=[];let t=e.highLightNodes;var o=[];v.addComponentsToLoad("contentView",{content:g.Content_Loading}),e.nodes&&!e.findFlatInBookmark&&widget.getValue("allow-products-expand")&&o.push(A(this,e,0)),e.findFlatInBookmark&&o.push(function(e,t){return new Promise((function(o){if(t.query)e._flatNodes=e.getRoots();else for(var i=e.getRoots(),n=0;n<i.length;n++){var r=i[n];if(r.id===t.rscIdToSearch){e._flatNodes.push(r);break}}o()}))}(this,e)),Promise.all(o).then((()=>{this.pushUpdate(),this.pushBroadcastSelect(),this.searchProgress=!1,this._doNotBroadcastSelect=!0,t(this.getRoots(),this._selection,this._flatNodes),v.removeComponentToLoad("contentView","content")})).catch((e=>{console.log(e),t(this.getRoots(),[],[]),v.removeComponentToLoad("contentView","content"),console.log("Find in Context finished with error"),this.searchProgress=!1}))},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},xnav_expand:function(e){let t=new D(((o,i)=>{let r=S.subscribe({event:"bookmark-product-expand-cancel-event"},(function(){t.cancel(),k(e.target),delete l._expandAllPending,N(!0),i()}));var s=e.data,l=s.nodeModel,a=!!s.expandAll&&s.expandAll,c=s.numberOfLevelsToExpand?s.numberOfLevelsToExpand.toString():n.getSetting("expand_iter");if(void 0!==l.options.fakeNodesTable||"TRUE"!==l.getAttributeValue("expandable"))return void l.preExpandDone();a&&(l._expandAllPending=!0,N(!1)),this.invalidateViewPort(),a&&(c="-1");var p=parseInt(c),h=n.getSetting("activateFUN085903")&&(-1===p||p>1),f=this;if("partiallyExpanded"===e.target.options.padstate&&(l.childComputed=!1),l.childComputed){var v=l.getDepth();if(function(e,t,o){function i(e){if(e.childComputed&&e.hasChildren()){var t=e.getChildren();if(1===t.length)return"ds6w:Document"===t[0].options.grid.globaltype}}var n=function(e,t,o){var r=!0;if((-1===t||o<t)&&(r=!(-1===t||t>o),e.childComputed))if(e.hasChildren()){for(var s=e.getChildren(),l=!0,a=0;a<s.length&&!0===l;a++){var d=s[a];if(!(d.childComputed&&h&&i(d))&&(d.childComputed&&"noExpandState"!==d._expandState&&(d.getDepth()<t||-1===t)&&d.setState({state:"expanded"}),void 0===(l=n(d,t,o+1))))throw new Error("Undefined no_expand_needed flag")}r=l}else r=!0;return r};return n(e,t,o)}(l,a?p:v+p,v))return e.target.preExpandDone({preventExpandAll:!0}),f._selectOccurence(),delete l._expandAllPending,void N(!0)}var _=l;l.isRoot()||(_=l.getRoot());let C={};C[_.getID()]={paths:[l.getOccurencePath()]},widget.getPreference("allow-products-expand").value?m.expandProductsForDisplay(C,{db:"authoring"==y.getCurrentModeType(),level:c}).then((i=>{t.isCancelled()||f.withTransactionUpdate((()=>{var t=!1;try{if(x(i),i.results&&0!==i.results.length){var n=l,r=parseInt(c);-1!==r&&(r+=0);let e={};e[(n=_).getID()]=n,d.process.expand({treedocument:f,root_nodes:e,response:i,mode:"default",expand_level:r,selectMatches:!1,realExpandedNodes:[l]}),S.publish({event:"reapply_content_sort"}),t=!0}else u.displayNotification({message:g.generic_service_failure,className:"error"});o()}catch(e){console.log(e),u.displayNotification({message:g.generic_service_failure,className:"error"})}finally{var s;t&&(l.childComputed=!0,f._selectOccurence()),f.addTagsForChildren(),delete l._expandAllPending,N(!0),l.hasChildren(!0)||(s="noChildrenExpanded",l.options.children=null),e.target.preExpandDone({preventExpandAll:!0,state:s})}}))})).catch((t=>{console.log(t),k(e.target),delete l._expandAllPending,N(!0),u.displayNotification({message:g.generic_service_failure,className:"error"}),i()})).finally((()=>{S.unsubscribe(r)})):(e.target.preExpandDone({}),S.unsubscribe(r),o())}))},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},getNodesById:function(e){var t=[];return this.getRoots().forEach((function(o){var i=o.getNodesById(e);t=t.concat(i)})),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),o=0;o<t.length;o++){var i=t[o].getNodeByPath(e,void 0,void 0,!0);if(i)return i}},getRoots:function(e){let t=this._parent();if(!Boolean(e)){let e=[];t.forEach((t=>{t.isVisible()&&e.push(t)})),t=e}return t},removeRoot:function(t,o,i){var n=this;if(n.invalidateViewPort(),n.getRoots().indexOf(t)>=0&&n._parent(t),!e.is(o,"boolean")||!o){var r=this.getRoots().length;this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:t.getID(),remainingRoots:r}});var s=null;this.getRoots().length>0&&(s=this.getRoots()[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:s,nb_root:r}})}},searchRootById:function(e){for(var t,o=this.getRoots(!0),i=0;i<o.length;i++)if(o[i].options.resourceid===e){t=o[i];break}return t},insertBranches:function(e,t){var o;(o=d.process.insert_temporary_branches({treedocument:this,branches:e,node_state:t.node_state,forceCollapsed:t.forceCollapsed,novalidation:t.novalidation})).ids_to_fetch.length>0||o.relationids.length>0?this.validateBranches_with_Expand(e,t):t.onComplete&&t.onComplete.call(null)},getNodesByIDPath:function(e){function t(e,o,i,n){if(e.getID()===o[i])if(i===o.length-1)n.push(e);else{var r=e.getChildren();r&&r.length>0&&(i+=1,r.forEach((function(e){t(e,o,i,n)})))}}var o=[];return this.getRoots().forEach((function(i){t(i,e,0,o)})),o},deleteNodes:function(e){var t=this;t.withTransactionUpdate((function(){e.forEach((function(e){e.isRoot()&&t.removeRoot(e)}))}))},_selectOccurence:function(e,t,o){var i=this.getRoots(),n=this._selected_paths;if(n.length>0){var r=!1;this._doNotBroadcastSelect=!0,this.prepareUpdate();var s=[];i.forEach((function(e){for(var t=0;t<n.length;t++){var o=e.getNodeByPath(n[t]);if(o&&(r=!0,s.push(o),!o.isVisible())){for(var i=o.getParent();!i.isVisible();)i=i.getParent();i&&-1===s.indexOf(i)&&s.push(i)}}}));var l=!1;if(!0!==t||!0===r)for(var a=this.getSelectedNodes(),d=0;d<a.length;d++){var c=a[d];s.indexOf(c)<0&&(c.unselect(),l=!0)}s.forEach((function(e){e.isSelected()||(e.select(),l=!0)})),l||(this._doNotBroadcastSelect=!1),!0===o&&l&&(this._directSelection=!1),this.pushUpdate()}},_buildSelectData:function(){var e=[];this._selected_paths;e=this.getXSO().get();var t,o={paths:[],tenant:r.getPlatformId()};o.attributes={},o.version="1.1";let i=!1;if(t=function(e){var t=e.getID();o.source=o.source||e.source,o.indexModeParameter=void 0!==o.indexModeParameter?o.indexModeParameter:e.indexModeParameter,o.sourceName=o.sourceName?o.sourceName:e.sourceName;let n=e.getAttributeValue("i3dx");i=i||!!n;let r=n||t;this.attributes.hasOwnProperty(r)||(this.attributes[r]={type:e.options.type,label:e.options.label,i3dx:e.getAttributeValue("i3dx"),serviceId:e.getAttributeValue("serviceId"),source:e.source})}.bind(o),o.paths=e.map((function(e){return e.getOccurencePath(t)})),i){let t=o.pathsI3dx=[];e.forEach((e=>{let o=e.getAttributeValue("i3dx");o&&t.push([o])}))}return this._currentApp=r.getSharedId(),o.sharedID=this._currentApp,o.focusOn=!1,o},applyActiveView:function(e){this.options.active_view=e},validateBranches_with_Expand:function(t,o){let i=this;function n(){for(var n=0;n<t.length;n++)for(var r=0;r<t[n].length;r+=2){var s=t[n][r],l=i.getNodesById(s);e.is(l,"array")&&l.forEach((function(e){if(!0===e.options.waiting4validation)if(!0===e.isRoot())i.removeRoot(e);else{var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])}}))}u.displayNotification({message:g.cannot_insert_branch,className:"error"}),o.onFailure&&o.onFailure()}let r={},s={};this.getRoots().forEach((e=>{s[e.getID()]=e}));let l={};t.forEach((e=>{let t=e[0],o=r[t];if(!o){let e=s[t];l[t]=e,o={paths:[]},r[t]=o}o.paths.push(e)})),m.expandProductsForDisplay(r,{db:"authoring"==y.getCurrentModeType(),level:0}).then((e=>{try{x(e),d.process.expand({treedocument:this,root_nodes:l,response:e,mode:"validate_branch",expand_level:0,realExpandedNodes:Object.values(l)}),o.onComplete&&o.onComplete()}catch(e){console.log(e),n()}finally{i.addTagsForChildren()}})).catch((e=>{console.log(e),n()}))},multiselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},fillAdditionalColumnsValues:async function(t,{additionalColumnsToFill:o,allAdditionalColumns:i,columns:n}){var r=this;return new D((async()=>{if(o&&o.length){var s=await r.getVisibleAdditionalColumns();let g=[...o];if(i!==o){let e=new Set;o.forEach((t=>e.add(t.getName()))),o.forEach((t=>{if(t.getDependentModuleNames){t.getDependentModuleNames().forEach((t=>{let o=i.find((e=>e.getName()===t));o&&!e.has(o)&&(g.push(o),e.push(o.getName()))}))}}))}if(s.length){for(var l={},a=0;a<t.length;a++)T(t[a],l,{additionalColumnsModules:g,columns:n});var d=[];let o={};for(var c=0;c<s.length;c++){var u=s[c],p=u.module.getName();if(l[p]){var h=new D((async function(t){let i=o[p];i&&await Promise.all(i),u.module.updateAttributes(l[p],(function(o){var i=e.is(o,"string")?JSON.parse(o):o;t(i)}),r)}));if(d.push(h),u.module.getDependentModuleNames){u.module.getDependentModuleNames().forEach((e=>{let t=o[e];t||(t=o[e]=[]),t.push(h)}))}}}if(d.length){let e=await D.all(d);r.withTransactionUpdate((function(){t.forEach((t=>{var o=t.getID(),i={grid:{}},n=!1;e.forEach((e=>{if(e&&e.pids){var t=e.pids[o];if(t){n=!0;var r=t._root;if(r){for(var s in r)i[s]=r[s];delete t._root}for(var s in t)i.grid[s]=t[s]}}})),n&&(t.getType()&&(i.grid.type=t.getType()),t.updateOptions(i))}))}))}}}}))}})})),define("DS/FolderEditor/plugins/product/PrdPlugin",["DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor.json","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/views/FolderMode","DS/FolderEditor/models/_xBookCVParser","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/utils/ServerDataAccess"],((e,t,o,i,n,r,s,l,a,d)=>{let c=[],u=["VPMReference","CATIA Embedded Component","CATPart","CATProduct","CATProcess","CATDrawing","CATAnalysis","CATShape"],p=["VPMReferenceExtPos","AxisSystemReference","ShellAxisSystemReference"],h=u.map((e=>"/"+e+"/"));function g(e){for(var t=e.getRoots(),o=0;o<t.length;o++){var i=t[o];f(i),i.processDescendants({processNode:function(e){f(this)}})}}function f(e){!1===e.options.isNotManagedByPS&&(e.hasChildren()||(e.setState({state:"collapsed"}),e.childComputed=!1))}function m(e,t){e=e||"Exception thrown during the process of the refresh answer "+(t?t.toString():""),c.push({msg:e,eventID:"error"})}function v(){return!0===widget.getBool("allow-products-expand")}return{onRefreshContentView:function(e,d){!async function(e){var t=e.treeDocument;let d=null,u={cancel:()=>{d&&d.cancel()}};var p=function(t){i.removeComponentToLoad("global","expandProductsLoaderRefresh"),t&&0!==t.length||(t=[{msg:o.refresh_ok}]),t.forEach((t=>{e.cb&&e.cb(t)})),c=[]},h=(e=e||{}).roots_PS_toRefresh||e.treeDocument.getRoots()||e.treeDocument.roots;if(h.length>0){i.addComponentsToLoad("global",{expandProductsLoaderRefresh:o.folderLoader_expanding_products},{withCancel:!0,withPercent:!0,cancelObject:u});var f=[];let _={},S={},C=1;if(null!=h&&h.forEach((function(e){e.getAllDescendants().forEach((e=>{e.isExpanded()&&e.getChildren()&&0!==e.getChildren().length||(C=Math.max(C,e.getDepth()))}));for(var t=[],o=[e];o.length;){var i=o.pop();if(null!=i){var n=i.getOccurencePath();t.push(n),o=o.concat(i.getChildren())}}f.push(t)})),0===f.length)p();else{let e=0,u=h.length;for(let c=0;c<u;c++){let p=h[c],y=p.getID();_[y]=p,S[y]={paths:[[y]]};var v="authoring"==r.getCurrentModeType();f.length>0&&(d=new a((function(e,o){n.expandProductsForDisplay(S,{db:"authoring"==r.getCurrentModeType(),level:C}).then((o=>{void 0!==o&&(s.process.expand({treedocument:t,root_nodes:_,starting_from_root:!0,response:o,mode:"refresh",needNewStructure:v,expand_level:C,security_counts_HTML:null}),v&&g(t),l.publish({event:"reapply_content_sort"}),t.invalidateViewPort(),t.addTagsForChildren()),e()})).catch((e=>{o(e)}))})).catch((e=>{m(o.generic_service_failure,e)})).finally((()=>{e+=1;let t=e/u*100;i.updateComponentPercent("global","expandProductsLoaderRefresh",`${t}%`)})),await d)}p(c)}e.treeDocument.withTransactionUpdate((async function(){for(var e=UWA.clone(h,!1);e.length;){var t=e.pop();null!=t&&(t.isSelected()&&t.unselect(),e=e.concat(t.getChildren()))}}))}}({treeDocument:e,roots_PS_toRefresh:d,cb:function(i){"error"===i.eventID&&t.displayNotification({...o.refreshError,className:"error"}),l.publish({event:"refreshStructureDone"}),e._logger.log("Refresh PS : "+i.msg)}})},getTypesToLoad:function(e){return p.forEach((t=>{e.add(t)})),p},prepareDataFromDB:function(e,t){if(d.isKindOfsSync(e.type,p))t.grid.expandable="FALSE";else{let o=d.isKindOfsSync(e.type,u)&&v();t.grid.expandable=o?"TRUE":"FALSE",o&&(t.children=[],t.isNotManagedByPS=!1)}},prepareDataFromIndex:function(t,o){if("read"==e.getContentMode())if(d.isKindOfsSync(o.type,p))o.grid.expandable="FALSE";else{let e=null;o.taxonomies&&o.taxonomies.every((t=>(t.startsWith("types/")&&(e=t),!e))),e||(e="types/"+o.type),e+="/",h.every((t=>{let i=e.indexOf(t)>0;return i&&(o.grid.expandable="TRUE",v()&&(o.children=[]),o.isNotManagedByPS=!1),!i}))}}}})),define("DS/FolderEditor/FolderXNavComponent",["DS/FolderEditor/infra/xBookComponent"],(function(e){"use strict";return e.extend({name:"pad_component",init:function(e){var t,o,i=(t=e,(o={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/FolderEditor/FolderTreeDocument",TreeListView:"DS/FolderEditor/views/FolderTreeListView",TileGridView:"DS/FolderEditor/views/FolderTileView",ThumbnailGridView:"DS/FolderEditor/views/FolderThumbnailView"},layout:{}}).layout=UWA.clone(t.layout_opts),delete(o=UWA.extend(o,t,!0)).layout_opts,o);this._parent(i),this.setFolderCommunicationChannel()},render:function(){return this},getPADTileGridView:function(){return this.options.views.tileview},getPADThumbnailGridView:function(){return this.options.views.thumbnailview},addRootNodes:function(e){if(!UWA.is(e,"array"))throw new Error("nodes parameter must be an array");var t=[],o=this.options.model;o&&o.withTransactionUpdate((function(){o.addRoot(e);for(var i=0;i<e.length;i++){let o=e[i];t.push(o.getID())}o.getRoots().length;UWA.is(o.detachedRoots,"array")&&o.detachedRoots.length,o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:o.getRoots().length,added_node:e[o.getRoots().length-1]}})}))},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"datagridview"},_dispatchReady:function(){!0===this.options.isReady.model&&!0!==this.options.isReady.PADmodel&&(this.options.isReady.PADmodel=!0),!0===this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady"),this.dispatchEvent("onActionBarReadyToBuild"),this._dispatchReady_NotDone=!1)}})})),define("DS/FolderEditor/controllers/FavoritesMode",["DS/FolderEditor/controllers/CommonMode","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FavoritesUtil","DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r){var s=t.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png"),l=t.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png"),a=t.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark108x144.png"),d=t.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit108x144.png");return e.extend({defaultOptions:{filteringByService:!1},init:function(e){this._parent(e)},convertData:function(e){var t=e.type,i=n.getTreeTypeNls(t);i=i||t;var r=e;e.hasOwnProperty("toRemove")&&!e.toRemove||(r={id:e.id,type:t,displayType:i,label:e.label,name:e.name,favoriteTitle:e.name,description:"",created:"",modified:"",owner:"",responsible:"",organizationResponsible:"",project:"",revision:"",status:"",policy:"",icon:e.inherit?l:s,largeicon:e.inherit?d:a});var c=o.convertToExaleadDataFormat(r);return c.resourceid=e.id,c.nodeAttrs={},c.nodeAttrs.isFavorite=!0,c.favoriteTitle=r.favoriteTitle,c.nodeAttrs.isPersonal=e.isPersonal,c.nodeAttrs.toRemove=e.toRemove,c},loadContents:function(e){this._parent();var t=this;return new Promise((function(o,n){t._contentHandleRequest=i.getFavorites({section:e.section,view:"CONTENT"}).then((e=>{o({contents:e})})).catch(n)}))},getModeType:function(){return"favorites"}})})),define("DS/FolderEditor/utils/FolderEditorDataConversion",["DS/FolderEditor/Folder_CSO"],(function(e){return{getObjectIdsFromSearchRes:function(t){var o={};return t&&t.forEach((function(t){if(!t||!t.attributes||t.attributes.length<=0);else{let n={};for(var i=0;i<t.attributes.length;++i){let e=t.attributes[i];n[e.name]=e.value}n.id=n.physicalid,o[n.physicalid]=e.getDefaultModelFromProperties(n)}})),o},getParChildrenMapFromNavRes:function(e){var t={};return!e||!e.result||e.result.length<=0||e.result.forEach((function(e){if(e&&e.input_object){var o=e.input_object.physicalid,i=o;e.outputs&&e.outputs.WORKSPACE&&e.outputs.WORKSPACE.length>0&&(i=e.outputs.WORKSPACE[0].physicalid),t[i]?t[i].push(o):t[i]=[o]}else;})),t}}})),define("DS/FolderEditor/controllers/ReadMode",["DS/FolderEditor/controllers/CommonContentMode","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/utils/FolderListContent_Read","DS/FolderEditor/tagger/TaggerContentProxy"],(function(e,t,o,i,n,r,s,l){return e.extend({supportClientSort:!1,init:function(e){this._parent(e);var t=this;this._indexInfo=null,this._currentFldId=null,this._isPageRefreshed=!1,this._initialFilter=null,this._nbReturnedObjects=0,this._scrollingWasReset=!1,i.onSearchChange((function(){t.resetInfoIndex()}))},enable:function(){l.setUpdateMode(!1)},disable:function(){l.setUpdateMode(!0)},convertData:function(e){return t.convertToExaleadDataFormat(e)},manageError:function(e){return(e="string"==typeof e?JSON.parse(e):e).error?e.error.errorMessage:null},smartFilteringAvailable:function(){return!1},loadContents:function(e){return this.loadIndexContents(e)},filteringByService:function(){return r.isRootSection(o.getCurrentBookmarkId())||!widget.getValue("filtered-content")},withInfiniteScrolling:function(){return!widget.getValue("filtered-content")},onSetPathTags:function(e){this.unColorizeChildren(e)},getNbRemainingObjects:function(){return this._indexInfo?this._indexInfo.nhits-this._nbReturnedObjects:null},onFilterFilteringEvent:function(){},unColorizeChildren:function(e){e.options.model.withTransactionUpdate((function(){e.options.model.getRoots().forEach((function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach((function(e){delete e.options.color,e.updateOptions(t)}))}))}))},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},setInfoIndex:function(e){let t=this._indexInfo&&this._nbReturnedObjects?this._nbReturnedObjects:0;this._indexInfo=e||null,this._indexInfo&&(this._nbReturnedObjects=t+this._indexInfo.nresults)},getInfoIndex:function(){return this._indexInfo},wasScrollingReset:function(){return this._scrollingWasReset},resetInfoIndex:function(e){this.cancelFacetsLoading(),this._isPageRefreshed=!0,this._indexInfo=null,this._nbReturnedObjects=0,this._scrollingWasReset=e&&e.resetScrolling},getModeType:function(){return"read"}})})),define("DS/FolderEditor/views/customize_views/_FolderDGVUtils",["i18n!DS/FolderEditor/assets/nls/FolderEditor.json","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/FolderEditor/utils/SettingsHandler","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPClassifyMaturityUtils","DS/FolderEditor/views/FolderMode","DS/WidgetServices/WidgetServices","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/FolderEditor/utils/FolderEditorUtil"],(function(e,t,o,i,n,r,s,l,a,d,c,u){"use strict";function p(e){}function h(e){return e.nodeModel?"Workspace"===e.nodeModel.getAttributeValue("type")||"Workspace Vault"===e.nodeModel.getAttributeValue("type")||"Document"===e.nodeModel.getAttributeValue("type")||"wwwLink"===e.nodeModel.getAttributeValue("type")||void 0!==e.nodeModel.options.checkout||1==widget.readOnly||i.isExternalObject(e.nodeModel):-1===e.rowID}p.prototype.completeColumns=async function(e){let t=e.map((e=>this.buildColumnFromSetting(e))),o={};return o.columns=t,o},p.prototype.buildColumnFromSetting=function(t){var o=Object.assign({editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}}},t);if(!UWA.is(o.dataIndex)){if(!UWA.is(o.ds6w))throw new Error("Wrong column definition for ["+JSON.stringify(t)+"]");o.dataIndex=o.ds6w}switch(o.kind){case"string":o.typeRepresentation="string";break;case"timestamp":case"dateTime":o.typeRepresentation=o.classif||o.dataIndex.includes("XP_")?"date":"datetime",o.semantics={allowMultipleValuesFlag:!0},o.getCellValueForExport=function(e){let t=e.cellModel;Array.isArray(t)||(t=[t]);let o=[];return t.forEach((e=>{let t=new Date(e);"Invalid Date"!=t?o.push(t.toLocaleString()):o.push(e)})),o.join(" | ")};break;case"boolean":o.typeRepresentation="boolean";break;case"image":o.typeRepresentation="image";break;case"icon":o.typeRepresentation="icon";break;case"functionIcon":o.typeRepresentation="functionIcon";break;default:o.typeRepresentation||(o.typeRepresentation="string")}switch(o.dataIndex){case"ds6wg:revision":o.getCellValue=function(e){if(e&&e.nodeModel&&e.nodeModel.options.grid){let t=e.nodeModel.options.grid;return t["ds6wg:revision"]&&"3DSpace"===t.serviceId?{label:t["ds6wg:revision"],func:function(e){!function(e){require(["DS/FolderEditor/ActionBar/FolderCommandManager"],(t=>{t.launchCommand("HistoryHdr",e.context.nodeModel)}))}(e)}}:t["ds6wg:revision"]?{label:t["ds6wg:revision"]}:""}},o.getCellValueForExport=function(e){return"object"==typeof e.cellModel?e.cellModel.label:e.cellModel};break;case"ds6w:cadMaster":o.typeRepresentation="image",o.alignment="center",o.getCellValue=function(e){var t;if(!0!==e.isHeader&&e&&e.nodeModel&&e.nodeModel.options.grid)return e.nodeModel.options.grid["ds6w:cadMaster"]?t=g.get(e.nodeModel.options.grid["ds6w:cadMaster"]):"VPMReference"===e.nodeModel.options.grid.type&&(t=g.get("3DEXPERIENCE")),{iconPath:t,iconSize:{height:"22px"}}};break;case"thumbnail":o.ds6w=void 0,o.typeRepresentation="image",o.text=e.column_Thumbnail,o.sortableFlag=!1,o.getCellTooltip=()=>({});break;case"ds6w:status":o.typeRepresentation="tag",o.getCellClassName=function(e){if(e.nodeModel){let o=e.nodeModel.getInternalValue("ds6w:status");var t;if(Array.isArray(o)&&1===o.length&&(o=o[0]),o){if(!1===o.contains(".")){let t=e.nodeModel.getInternalValue("ds6w:policy");t&&(o=t+"."+o)}t=r.getAndCreateMaturityClass(o,"wux-controls-label")}return t}};break;case"ds6w:responsible":o.typeRepresentation="user",o.getCellValue=function(e){var t,o,i=e.nodeModel.getAttributeValue("ds6w:responsibleUid")||e.nodeModel.getAttributeValue("owner"),n=e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0;return i&&(t=function(e,t){var o,i;l.get3DSwymUrlAsync({onComplete:function(e){null!=e&&(i=e)}}),null==i||i.contains("odtUrl")||(o=i+"/api/user/getpicture/login/"+e);return o}(i)),Array.isArray(n)&&1===n.length&&(n=n[0]),null!=t?o={icon:{iconPath:"url("+t+")",className:"dgv-user-thumbnail"},label:n}:n&&(o={icon:undefined,label:n}),o},o.getCellValueForExport=function(e){return e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0};break;case"ds6w:reserved":o.typeRepresentation="functionIcon",o.getCellSemantics=function(e){let t=null;return e.isHeader||(t=function(e){let t=e.nodeModel.computeLockStatus();const o=h(e);let i=o?"":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open dgvpad_unlock";t.locked&&(i=t.locked_by_me?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key dgvpad_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock dgvpad_lock_other");return{icon:{iconClasses:i},label:t.reserveBy,disabled:o}}(e)),t},o.alignment="center",o.getCellValueForExport=function(t){let o=t.cellModel;if(-1!==t.rowID){const i=t.nodeModel.getInternalValue("ds6w:reserved");if(o=e.tooltip_unreserved,i){"true"===i.toLowerCase()&&(o=e.tooltip_reserved)}}return o},o.getCellTooltip=t=>{const o=t.nodeModel?t.nodeModel.getAttributeValue("ds6w:reservedBy"):null,i=h(t),n=!!t.nodeModel&&"Document"===t.nodeModel.getAttributeValue("type");let r={};if(!!t.nodeModel&&("Workspace"===t.nodeModel.getAttributeValue("type")||"Workspace Vault"===t.nodeModel.getAttributeValue("type"))||i&&!n)r={};else if(o&&n){r={shortHelp:`${e.get("lockStatusTooltip_locked").message} ${o}`}}else if(o){const t=e.get("lockStatusTooltip_locked");r={shortHelp:`${t.message} ${o}\n${t.subtitle}`}}else if(!o&&n)r={};else{const t=e.get("lockStatusTooltip_unlocked");r={shortHelp:`${t.message}\n${t.subtitle}`}}return r};break;case"tree":o.typeRepresentation="url",o.getCellEditableState=function(e){return 1!=widget.launchWithReadMode&&(e&&e.nodeModel&&i.isTreeType(e.nodeModel.getType()))},o.editionPolicy="DelayedEditionOnClick",o.setCellValue=function(t,o){if(t.nodeModel)if(t.nodeModel&&"TRUE"===t.nodeModel._options.grid.isLinkedFolder)require(["DS/IPClassifyUtil/IPClassifyAlert"],(function(t){t.displayNotification({message:e.get("msg_error_Rename_Shortcut"),className:"error"})}));else{require("DS/FolderEditor/commands/FolderCommands")._cellToRename={cellInfos:t,context:"CONTENT"};let e="object"==typeof o&&null!==o?o.label:o;!function(e,t,o){e.getTreeDocument().withTransactionUpdate((function(){if("tree"===t){var i={};i.label=o,i.display=o,i.oldLabel=e.options.label,e.updateOptions(i)}}))}(t.nodeModel,"tree",e)}},o.getCellSemantics=function(e){let t={};if(e.nodeModel){let o=e.nodeModel.options.grid.Link;o&&!o.startsWith("http")&&(t.hyperlinkTarget="_top")}return t},o.getCellValue=function(e){if(e.nodeModel){var t=e.nodeModel.options.grid.Link;return{label:e.nodeModel.getLabel(),url:t}}},o.getCellValueForExport=function(e){return e.nodeModel?e.nodeModel.getLabel():e.cellModel};break;default:o.multiValue&&(o.getCellSemantics=function(e){return{allowMultipleValuesFlag:!0}}),!0===o.classif&&(o.isAdditionalColumn=!0,o.getCellValue=function(t){if(!t.nodeModel)return;let i=t.nodeModel.getAttributeValue(o.dataIndex);if(!i)return;const n=i.length>1&&"object"==typeof i;return i===e.get("multipleClassificationValue")||n||t.cellModel===e.get("multipleClassificationValue")?{label:e.get("multipleClassificationValue"),func:function(){}}:i},o.getCellTypeRepresentation=function(t){if(!t.nodeModel)return;const i=t.nodeModel.getAttributeValue(o.dataIndex);if(!i)return o.typeRepresentation||"string";const n=i.length>1&&"object"==typeof i;return i===e.get("multipleClassificationValue")||n||t.cellModel===e.get("multipleClassificationValue")?"url":o.multiline?"editor":o.typeRepresentation||"string"})}return o};const g=new Map,f=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CADENCEALLEGRO","3DEXPERIENCE"];for(var m=0;m<f.length;m++)g.set(f[m],n.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+f[m]+".png"));return p})),define("DS/FolderEditor/models/FolderInfo",["UWA/Controls/Abstract","UWA/Class/Options","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/service/FolderEditorWebService"],(function(e,t,o,i){"use strict";var n=e.extend(t,{_id:null,_type:null,_label:null,init:function(e){this._parent(e),this._id=e.id,this._type=e.type,this._label=e.label},getID:function(){return this._id},getType:function(){return this._type},getLabel:function(){return this._label},getChildrenInfos:function(e){var t,r=[];(t=o.getVisibleTreeNode(this._id))?(t.getChildren().forEach((function(e){r.push(new n({id:e.getID(),type:e.getType(),label:e.getLabel()}))})),e.onComplete(r)):i.folders({pid:this._id}).then((t=>{(t=JSON.parse(t)).folders.forEach((function(e){r.push(new n({id:e.id,type:e.type,label:e.label}))})),e.onComplete(r)})).catch((t=>{console.warn("WebService folders Err : "+t),e.onFailure(t)}))}});return n})),define("DS/FolderEditor/views/additionalColumns/BookmarkLocationColumn",["UWA/Core","UWA/Class","DS/FolderEditor/utils/GridUtils","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/BookmarkLocationUtil","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/WidgetServices/WidgetServices"],(function(e,t,o,i,n,r,s,l){"use strict";var a=t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){var t={dataIndex:"bookmarkLocation",text:i.column_BookmarkLocation,width:100,minWidth:80,maxWidth:200,isHidden:!1,sortableFlag:!1,alignment:"left",typeRepresentation:"string",getCellClassName:function(e){let t="bk-ellipsys-span-column";return l.addNewStyle(t,".bk-ellipsys-span-column:hover{text-decoration: underline;}\n.bk-ellipsys-span-column{cursor:pointer;color: #23527c;width: 100%;display: inline-block;vertical-align: middle;padding-left: 7px}"),t},customisation:{dataIndex:"bookmarkLocation",exportable:{lock:!0,value:!1},layout:{removable:!1}}};a._columnDataIndex=["bookmarkLocation"],a._columnDef={bookmarkLocation:t},e()}((function(){t(!0)}))},getName:function(){return"bookmarkLocation"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var o=!1;return void 0!==e.bookmarkLocation&&""!==e.bookmarkLocation||(o=!0),o},getOnCellClickCB:function(e,t){return e===this.getName()&&function(e){n.openBookmark(e.nodeModel)}},getCellReusableContent:function(e){return{id:this.getName(),buildContent:function(){return n.getHtmlElemFromPath("",e)}}},_getWidthToDisplayLocation:function(e,{grid:t}){let i=0;if(t){var n=o.getFontDetails(t),s=n.fontSize,l=n.fontMargin,a=n.fontSytle;i=Math.ceil(r.computeStringWidth(e,s,a,!1,!1)),i=l+i+l}return i},updateAttributesOnResize:function(e,t,{grid:i}){let r=i;if(r){var l=o.getColumnWidth(i,this.getName());for(let o=0;o<e.length;++o){var a=r.layout.getCellIDFromCoordinates({rowID:e[o]._getRowID(),columnID:t});let d=r._getViewAt(a)._getReusableContent();if(d&&d.childNodes&&d.childNodes.length>0){let e=this._getWidthToDisplayLocation(d.childNodes[0].innerText,{grid:i});d.childNodes[0].innerText=n.getResizedText(l,e,d.getAttribute("titlex"),d.childNodes[0].innerText),d.tooltipInfos=new s({longHelp:d.getAttribute("titlex")})}}}},onCellRequest:function(e,{grid:t}){let i=t;if(i){if(e&&e.cellModel){var r=i.reuseCellContent("bookmarkLocation");if(r.setData(e.cellModel),r.childNodes&&r.childNodes.length>0){var l=o.getColumnWidth(t,this.getName());let i=this._getWidthToDisplayLocation(r.childNodes[0].innerText,{grid:t});return r.childNodes[0].innerText=n.getResizedText(l,i,r.getAttribute("titlex"),r.childNodes[0].innerText),r.tooltipInfos=new s({longHelp:r.getAttribute("titlex")}),e.cellView._setReusableContent(r),!0}}}},updateAttributes:async function(t,o){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(o,"function"))throw new Error("A callback function should be defined");let i=await n.updateNodesWithPath(t.nodes);i=JSON.stringify(i),o(i)},getAdditionalColumnsUXDGV:function(t){for(var o=[],i=0;i<t.length;i++)o.push(t[i].dataIndex);for(var n=0;n<this._columnDataIndex.length;n++){var r=this._columnDataIndex[n],s=e.clone(this._columnDef[r]),l=o.indexOf(r);-1===l?t.push(s):t[l]=e.extend(t[l],s,!0)}},getCellClassName:function(e,t){if(t==this._columnDataIndex[0]){let e="bk-ellipsys-span-column",t=".bk-ellipsys-span-column:hover{text-decoration: underline;}\n.bk-ellipsys-span-column{cursor:pointer;color: #23527c;width: 100%;display: inline-block;vertical-align: middle;padding-left: 7px}";return l.addNewStyle(e,t),e}}});return a})),define("DS/FolderEditor/commands/tools/DocumentCommandsMgr",["DS/IPClassifyUtil/PlatformAPIWrapper","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/Folder_CSO","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/CredentialsView","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/views/FolderMode","DS/DocumentCommands/DocumentCommandsV2","DS/DocumentCommands/Constants","DS/DocumentManagement/DocumentManagement","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Utilities/Utils","DS/FolderEditor/service/FolderEditorWebService","i18n!DS/FolderEditor/assets/nls/FolderEditor"],((e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f)=>{let m=[],v=[c.UPDATE,c.UPDATE_AND_UNLOCK,c.OFFICE_WEB_EDITION,c.EDIT,c.LOCK_AND_DOWNLOAD,c.UNDO_EDIT,c.UNLOCK];var _=null,S={},C=null;S={};var y=function(e,o,i){return new Promise((async(s,l)=>{C=r.getCredential();let a=await g.get3DSpaceUrl();null!=e._documentMetadata&&1!=i?(t.publish({event:"document_data_loaded",data:e._documentMetadata}),o?b().then(s):s()):u.getDocuments(e.map((e=>e.getID())),{tenant:n.getTenantID(),securityContext:C,tenantUrl:a,onComplete:function(i){i.success&&Array.isArray(i.data)&&(e.length>0&&(e[0]._documentMetadata=i.data),t.publish({event:"document_data_loaded",data:i.data}),o?b().then(s):s())}})}))},b=function(){return _.getWebUXContextMenuItemsForCurrentSelection(m,!0)};function E(e,n){let r=i.getSelectedContent();r.length>0&&n.documentId===r[0].getID()&&t.publish({event:"check_command_availability",data:{nodes:r,nodeModified:!0}}),o.isSearchActive()?a.switchtoAuthoringMode(!0):a.switchtoAuthoringMode();let l=n.file?n.file.relateddata.lockerInfo:n.updatedFile.relateddata.lockerInfo,d=null;l.forEach((e=>{e.dataelements&&(d=e.dataelements)})),function(e,o){let i=null,n=null;"_UnCheckedOutRemoveFlag"===e.action?(i={bottomRight:null},n={_ischeckout:"FALSE"}):"_CheckedOutAddFlag"===e.action&&(i={bottomRight:s.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png")},n={_ischeckout:"TRUE"});if(n){let r={attributes:n,grid:{},gridValue:{}};!1!==o&&(r.badge=i);let s=e.data,l={};s.forEach((e=>{e.locker?(r.grid["ds6w:reservedBy"]=e.locker.firstname+" "+e.locker.lastname,r.grid["ds6w:reserved"]="TRUE",r.gridValue["ds6w:reserved"]="TRUE"):(r.grid["ds6w:reservedBy"]="",r.grid["ds6w:reserved"]="FALSE",r.gridValue["ds6w:reserved"]="FALSE"),l[e.id]=r})),t.publish({event:"updateContentNodes",data:{items:l}})}}({action:e,data:[{id:n.documentId,locker:d}]},!0)}e.subscribe("docm-file-updated-to-document",(function(e){E("_UnCheckedOutRemoveFlag",e)})),e.subscribe("docm-file-edited-in-document",(function(e){E("_CheckedOutAddFlag",e)})),e.subscribe("docm-file-undoedited-in-document",(function(e){E("_UnCheckedOutRemoveFlag",e)}));let D=null;return{initialize(){var e=this;return t.subscribe({event:"docv2-show-notification"},(function(e){var t={title:e.title,subtitle:e.subtitle,message:e.message,className:e.level};l.displayNotification(t)})),t.subscribe({event:"check_command_availability"},(function(e){var o=e.nodes;t.publish({event:"document_data_loaded",data:[]}),1==o.length&&null!=o[0].options.checkout?y(o,!1,e.nodeModified):t.publish({event:"document_data_loaded",data:[]})})),m=[],new Promise(((o,i)=>{p.getPlatformServices({platformId:n.getTenantID(),onComplete:function(e){C=r.getCredential(),S={fetchSecurityContext:function(){return C},getSelectedNodes:function(){return S.selectedDocuments?S.selectedDocuments:[]},getDocumentFromNodeModel:function(e){return e},platformUrls:e,events:t.getModelEvents()},D=S,new d(S),_=new d(S),v.forEach((e=>{m.push(_.commands[e])})),o()},onFailure:function(e){console.log(e),o()}}),e.docToolbarConnection()}))},async launchDocumentCmd(e,t){let o=!1,i=_.commands[e];return i?(!t||S.selectedDocuments&&0!==S.selectedDocuments.length&&S.selectedDocuments[0].id===t.getID()||await y([t],!1),i.execute(D),o=!0):l.displayNotification({...f.docCmd_unavailable}),o},docToolbarConnection(){var e=h.debounce((function(){b().then((function(e){e.length>0?(e.forEach((e=>{e.id=e.recId,e.tooltip=e.rawItem.dataElements.tooltip})),t.publish({event:"toolbar_update_command",data:{commandID:"DocumentCommands",data:{grid:{data:{menu:e}},visibleFlag:!0}}})):t.publish({event:"toolbar_update_command",data:{commandID:"DocumentCommands",data:{grid:{data:{menu:[]}},visibleFlag:!1}}})})).catch((function(e){console.log(e)}))}),10);t.subscribe({event:"document_data_loaded"},(function(t){S.selectedDocuments=t,e()}))},getContextualMenu(){t.publish({event:"document_data_loaded",data:[]});return new Promise(((e,t)=>{y(i.getSelectedContent(),true).then(e)}))}}})),define("DS/FolderEditor/ActionBar/FolderCommandManager",["UWA/Class","DS/TreeModel/TreeNodeModel","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/utils/FolderEditorControl","DS/LifecycleServices/LifecycleServicesSettings","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/service/FolderServices","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderSearch","DS/FolderUpload/FolderUpload","DS/FolderEditor/utils/FolderEditorUtil","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUtil/IPSettingsMgr","i18n!DS/FolderEditor/assets/nls/FolderEditor","text!DS/FolderEditor/assets/FolderProbesCommandMapping.json","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/utils/ServerDataAccess","DS/FolderEditor/plugins/PluginsManager","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/models/xTreeNodeModel","DS/FolderEditor/service/FolderPreferenceService","i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences","DS/FolderEditor/commands/tools/DocumentCommandsMgr","DS/IPClassifyUtil/IPContext"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F,T,x){"use strict";var P=JSON.parse(C);E.addProbesNlsMapping(P);let A={Workspace:!0,"Workspace Vault":!0,Document:!0,"CONTROLLED DOCUMENTS":!0},k=new Set,N=[];o.isCatiaV5Environment()?N=["VPMReference","Drawing","XCADNonPSBaseRepReference","3DShape"]:o.isSolidworksEnvironment()&&(N=["XCADModelRepReference","VPMReference","Drawing"]);let M={};N.forEach((e=>M[e]=!0));var U={SubscribeHdr:{safeForSession:!0,TREE:!1,CONTENT:!0},UnSubscribeHdr:{safeForSession:!0,TREE:!1,CONTENT:!0},EditSubscribeHdr:{safeForSession:!0,TREE:!1,CONTENT:!0},MySubscriptionsHdr:!0,PushSubscribeHdr:{TREE:!1,CONTENT:!0},ViewSubscribeHdr:{TREE:{Sections:!1},CONTENT:!0},BookmarkLocation:{search:!0,multisel:!1,CONTENT:1},OpenInCADHdr:{dashboard:!1,CONTENT:{types:M}},openInV5:{webInWin:!1,setting:"activateOpenWith18xFD01",CONTENT:{TreeElements:!1}},openWith:{CATIAV6:!1,multisel:!1,CONTENT:1},RenameCmd:{safeForSession:!0,multisel:!1,ctxFavorite:!0,TREE:{Sections:!1,PersonalSection:!1},CONTENT:{views:["datagridview"],check:e=>!!y.isTreeType(e.getType())}},ActionBar_FindInCtxCmd:{views:["datagridview"],search:!1,TREE:{ctxMenu:!1,FavSection:!1,RootSection:!1},CONTENT:{check:e=>"VPMReference"==e.options.type&&!!e.getChildren()}},AddExistingContent:{safeForSession:!0,white_click:!0,search:!1,check:()=>!widget.getView||"sidepanel"!==widget.getView().type,TREE:{ctxMenu:!1,FavSection:!1,RootSection:!1}},AddExternalLink:{safeForSession:!0,white_click:!0,search:!1,TREE:{ctxMenu:!1,FavSection:!1,RootSection:!1,PersonalSection:!1}},OpenExternalLink:{multisel:!1,service:{www:1},CONTENT:{service:{www:1}}},AddFile:{safeForSession:!0,white_click:!0,search:!1,TREE:{ctxMenu:!1,FavSection:!1,RootSection:!1}},RemoveShortcut:{safeForSession:!0,CONTENT:{linkedFolder:!0,check:function(e){return"TRUE"===e._options.grid.isLinkedFolder}}},RemoveContent:{safeForSession:!0,multiselSearch:!1,CONTENT:{service:!0,TreeElements:!1}},PreviewFile:{multisel:!1,CONTENT:{check:function(e){return void 0!==e.options.checkout}}},DocumentCommands:{safeForSession:!0,multisel:!1,CONTENT:{check:function(e){return void 0!==e.options.checkout}}},SelectChildren:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},SelectParent:{TREE:!1,CONTENT:{check:function(e){return e.getDepth()>0}}},SelectAll:!0,SelectInversion:{TREE:!1,setting:"allow-products-expand",CONTENT:1},SelectSiblings:{TREE:!1,CONTENT:1},SelectLeaves:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},DownloadFile:{TREE:{Sections:!1,custo:!0},CONTENT:{check:function(e){return e.options.isDownloadable}}},Copy:{safeForSession:!0,TREE:{FavSection:!1,Sections:!1},CONTENT:{noservice:{__Unknown__:0}}},Cut:{safeForSession:!0,search:!1,TREE:{SubElements:!0},CONTENT:{noservice:{__Unknown__:0},Root:!1,childProduct:!1}},Paste:{safeForSession:!0,search:!1,white_click:!0,clipboard:!0,TREE:{FavSection:!1},CONTENT:{TreeElements:!0,rootInClipboard:!1}},ActionBar_Attributes:{safeForSession:!1,TREE:{Sections:!1},CONTENT:{noservice:{__Unknown__:0}}},ActionBar_AccessRightCmd:{safeForSession:!1,TREE:{Sections:!1},CONTENT:{service:{"3DSpace":1},linkedFolder:!0}},UnifiedExportCommand:{TREE:{Sections:!1},CONTENT:!0},CompareHdr:{CATIAV6:!1,CONTENT:!0},ActionBar_TransferOwnership:{TREE:{Sections:!1},CONTENT:{}},MaturityHdr:{TREE:{Sections:!1},CONTENT:{}},ActionBar_ChangeOwner:{TREE:{Sections:!1},CONTENT:{}},ActionBar_ReserveCmd:{TREE:!1,CONTENT:{TreeElements:!1,check:function(e){return"boolean"!=typeof e.options.isDownloadable||!e.options.isDownloadable}}},ActionBar_UnreserveCmd:{TREE:!1,CONTENT:{TreeElements:!1,check:function(e){return"boolean"!=typeof e.options.isDownloadable||!e.options.isDownloadable}}},DeleteHdr:{TREE:{Sections:!1,check:e=>!0!==e.isFavorite},CONTENT:{check:e=>!0!==e.isFavorite}},datagridview:!0,tileview:{search:!1},thumbnailview:{search:!1},ExpandAll:{TREE:{treeNode:!0,FavSection:!1,Favorites:!1,RootSection:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},ExpandN:{TREE:{treeNode:!0,FavSection:!1,Favorites:!1,RootSection:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},CollapseAll:{TREE:{treeNode:!0,Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()||!0===widget.getValue("allow-products-expand")&&"TRUE"===e.getAttributeValue("expandable")}}},Print:{search:!1,ios:!1,views:["datagridview"]},PrintOptions:{search:!1,ios:!1},ExportCSV:{ios:!1},ExportCSVOptions:{search:!1,ios:!1},WhereUsed:!0,DuplicateHdr:{TREE:!1,CONTENT:{TreeElements:!1}},RevisionHdr:{TREE:!1,CONTENT:{TreeElements:!1}},NewBranchHdr:{TREE:!1,CONTENT:{TreeElements:!1}},ReviseFromHdr:{TREE:!1,multisel:!1,CONTENT:{TreeElements:!1}},HistoryHdr:{TREE:!1,multisel:!1,CONTENT:{service:{"3DSpace":1},TreeElements:!1}},SetThePartNumber:{TREE:!1,licenses:["XEN","PAU","InternalDS","XSR"]},UPSAuthReplaceByRevision:{safeForSession:!0,search:!1,multisel:!1,CONTENT:{TreeElements:!1,check:function(e){return e.getDepth()<1}}},UPSReplaceByLatestRevision:{safeForSession:!0,search:!1,CONTENT:{TreeElements:!1,check:function(e){return e.getDepth()<1}}},ActionBar_ShareBookmarkLink:{multisel:!1,TREE:{Sections:!1},CONTENT:{linkedFolder:!0,search:!1,childProduct:!1,noservice:{__Unknown__:0}}},RelationIPExplorer:{TREE:{Sections:!1},CONTENT:{service:{"3DSpace":1},linkedFolder:!0},CATIAV6:!1},ColumnVisibility:{views:["datagridview"]},CreateRouteHdr:{TREE:{Sections:!1},CONTENT:!0}};async function O(e){if(e)for(let t in e)if("types"===t){let o=e[t],i=Object.keys(o),r=null;try{r=await b.getSubTypes(i)}catch(e){console.log(e),n.displayNotification({...S.msg_error_rest,className:"error"})}r&&i.forEach((e=>{let t=o[e];r[e].forEach((e=>{o[e]=t}))}));break}}let R=e.extend({...f});return r.createSingleton(class extends R{noSizeToFit=["bookmarkLocation"];constructor(){super({iconType:y.getIconType()})}getSingletonInstance(){return this}initialize(){!async function(){let[e,t]=await Promise.all([l.getAvailableRoles(),b.getSubTypes("VPMReference",!0)]);k=e;let o={};t.forEach((e=>o[e]=!0)),U.SetThePartNumber.CONTENT={types:o}}();let e=null;E.updateCmdsRules(U);for(let e in U){let t=U[e];O(t),O(t.TREE),O(t.CONTENT)}O({types:A}),this.getModelEvents().subscribe({event:"launchCmdOnNode"},(({commandID:e,node:t})=>{this.launchContextualCommand(e,[t])})),this.getModelEvents().subscribe({event:"updateBMESelection"},(()=>{e&&(e.cancel(),e=null),e=new s(((e,t)=>{c.getCurrentBookmarkInfo().then(e).catch(t)})),e.then((e=>{0===u.getSelectedNodes().length?this.enableAllCommands(!1):this.updateCommands(void 0,e)}))})),i.onCommandStart((e=>{var t=U[e.getId()];t&&!0===t.author&&this.getModelEvents().publish({event:"switch_to_author"})}),x.get().toString());var t=new Promise((e=>{new Promise(((e,t)=>{let o=y.getToolbarCmds();"string"==typeof o?require([o],(t=>{e(JSON.parse(t))})):require([o.file],(i=>{i[o.method]().then(e).catch(t)}))})).then(e)}));let o=T.initialize();return new Promise((e=>{Promise.all([t,o]).then((t=>{let o=t[0];if(o)for(var i in o.headers){var n=o.headers[i],r=U[i];n.ID=i,r&&"CATAfrHeaderCheck"===n.Behavior&&(r.type="check")}if(o=o||{},!1===widget.multiselection){["SelectAll","SelectChildren","SelectInversion","SelectParent","SelectSiblings","SelectLeaves"].forEach((e=>{delete o.headers[e]}))}if(!0===_.isWebInWin()){Object.keys(o.headers).forEach((e=>{delete o.headers[e].accelerator}))}e(o)}))}))}getAdditionalCtxCommands(e,t,o){var i=!1;let n=null,r=null;var s=!!o.cellInfos&&o.cellInfos.rowID<0;if(null==e||s)s&&g.isRelationsColumnVariableActivated()&&!t&&o.context&&(n=new Promise(((e,t)=>{require(["DS/FolderEditor/views/additionalColumns/RelationColumns"],(t=>{t.getAdditionalCtxMenu({view:"datagridview",ctxParams:o,treeDocument:o.context.treeDocument,callback:function(t,o){e(o)}})}))})));else{if(!t&&e&&1==e.length){let t=e[0];var l=o&&o.collectionView?o.collectionView.getColumnOrGroup("ApprovalStatus"):void 0;if(l&&l.visibleFlag){var a=t.options?t.options.grid.approvalStatusModel:void 0;a&&a.model&&a.model.route.length>0&&(i=!0)}i&&(n=new Promise(((e,o)=>{require(["DS/RouteWebAppUX/scripts/RouteWebAppApprovalStatusUX"],(i=>{var n=t.options.grid.approvalStatusModel;i.getColumnApprovalStatusMenu(n).then(e).catch(o)}))})))}1==e.length&&null!=e[0].options&&null!=e[0].options.checkout&&(r=new Promise(((e,t)=>{T.getContextualMenu().then((t=>{t&&(t.ctxHeader="DocumentCommands",e(t))})).catch(t)})))}return[n,r]}getKeyForProbes(){return y.getSettingParameter("keyProbes")}launchCommand(e,t,o,i){let n=e;P&&P[e]&&(n=P[e]);let s=this.getKeyForProbes();"ContextualMenu"===i?r.sendTrackerPageEvent(s+"_contextual",n):r.sendTrackerPageEvent(s+"_iconBar",n),super.launchCommand.apply(this,arguments)}getHeaderCtxMenu(e){var t=super.getHeaderCtxMenu.apply(this,arguments),o=e.cellInfos;const i=o.columnID,n=o.manager.columns[i],r=!(n&&n.customisation&&n.customisation.layout)||!1!==n.customisation.layout.removableFromView;return t.push({ID:"clearSort",title:S.CMDClearSort,type:"PushItem",icon:"clear",state:o.manager&&o.manager.sortModel&&o.manager.sortModel.length>0&&(o.manager.sortModel.length>1||"defaultSort"!==o.manager.sortModel[0].dataIndex)?"enabled":"disabled",action:{callback:function(){var e;(e=o).manager.prepareUpdateView(),e.manager.sortModel=[{dataIndex:"defaultSort",sort:"asc"}],e.manager.layout.saveColumnSortModelInPreferences(),e.manager.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)}}}),r&&t.push({ID:"hideColumn",title:S.CMDHideColumn,type:"PushItem",icon:"eye-off",action:{callback(){var t;t=o.manager.layout.getColumnIdentifiers(e.cellInfos.columnID).dataIndex,v.publish({event:"update_column_visibility",data:{dataIndex:t,visible:!1}})}}}),y.getSettingParameter("customViews")&&t.push({type:"PushItem",title:F.commandMenu.root,submenu:async()=>new Promise((e=>{e(I.getMenuItems())}))}),t}areCommandsAvailable(e,t,o){return this._manageSwitchOfCommands(e,t,!0,o)}_manageSwitchOfCommands(e,t,i,n){var r=!1,s=i&&!!t&&0===t.length;e&&!s?r=e.isFavorite:t&&t.length>0&&(r=t[0].isFavorite);var a=!1,c=!1,u=!1,h=!1,f=!1,m=!1;let v=!1;var S=d.IsEmpty(),C=!1;S||d.getSelectedNodes().every((e=>!(C=C||y.isRootElement(e.getType(),e.section))));var b=!1,I=!1,F=!1,T=!1,x=!1,P=!1;let N={},M=null;e&&(M=e.section,F=y.isFavoriteSection(e.getType()),T=y.isRootSection(e.getType()),b=!r&&y.isRootElement(e.getType(),M),I=!r&&y.isSubElement(e.getType(),M),x=e.section===e.getID(),P=e instanceof w,E.updateCmdsVariables(!0,e,N));var O=!1,R=g.isRelationsColumnsActive();let L=new Set,B=new Set;t&&t.forEach((function(e){e.getType()&&B.add(e.getType()),a=a||y.isRootElement(e.getType()),c=c||y.isSubElement(e.getType()),O=O||!0===e._busy,u=u||0!==e.getParents().length,h=h||R&&!0===e.isRelationsObjectNode,f=f||R&&!0===e.isRelationsObjectGroupingNode,m=m||"TRUE"===e.getAttributeValue("isLinkedFolder"),v=v||!!e.getAttributeValue("links");let t=e.getAttributeValue("serviceId");t=t||"3DSpace",L.add(t),E.updateCmdsVariables(!1,e,N)}));let V=v?1:2,W=1===L.size&&L.has("3DSpace");var j=!0;if((F||O||(T||!e)&&t&&0===t.length)&&(j=!1),i||this.enableAllCommands(j),O)return;var H={},X=Object.keys(U);n&&(X=n);let q=D.hasCATIASession();return X.forEach((n=>{var d=U[n];if(d){let M=null;if(q){let e=this.getCommand(n);d.safeForSession||!1!==d.safeForSession&&e&&!0===e.options._readOnly||(M=A)}var g=!!t&&t.length>0,v=!!e&&!g,y=!0,D=!t||t.length<=1;if("object"==typeof d){if(y&&d.licenses&&(y=d.licenses.some((e=>k.has(e)))),y&&!W&&d.service&&L.forEach((e=>{y=y&&!!d.service[e]})),y&&R&&f&&(y=!1),(y&&!1===d.TREE&&v||!1===d.CONTENT&&g)&&(y=!1),y&&s&&!0!==d.white_click&&(y=!1),y&&void 0!==d.clipboard&&(y=!S),y&&void 0!==d.multisel&&(y=D),y&&void 0!==d.search&&(y=d.search===p.isSearchActive()),y&&0==d.multiselSearch&&(y=!(!D&&p.isSearchActive())),y&&void 0!==d.custo&&(y=l.isCustomizedEnv()),y&&void 0!==d.setting&&(y=!0===_.getSetting(d.setting)),y&&d.check&&(y=d.check({oneIsRoot:a,oneIsSubElement:c,treeIsRoot:b,treeIsSubElement:I})),y&&d.views&&(y=d.views.indexOf(l.getContentActiveView())>=0),y&&i&&r&&!0!==d.ctxFavorite&&(y=!1),y&&!1===d.dashboard&&(y=o.isWebInWinEnvironment()),y&&!1===d.webInWin&&(y=!o.isWebInWinEnvironment()),y&&!1===d.ios&&(y=!UWA.Utils.Client.Platform.ios),y&&!1===d.CATIAV6&&(y=!_.isWebInWin()),v=null,(y=y&&E.applyCmdsVariables(0,d,N).indexOf(!1)<0)&&d.TREE&&(v=!(!e||g&&void 0!==d.CONTENT)))if(!0===d.TREE)v=!0;else{if(v&&d.TREE.custo&&(v=l.isCustomizedEnv()),v&&d.TREE.treeNode&&(v=P),s||v&&!r&&i&&!1===d.TREE.ctxMenu&&(v=!1),!1!==v&&(!0===d.TREE.Root?v=b:!1===d.TREE.Root&&(v=!b)),!1!==v&&(!0===d.TREE.SubElements?v=I:!1===d.TREE.SubElements&&(v=!I)),!1!==v&&(!0===d.TREE.TreeElements?v=I||b:!1===d.TREE.TreeElements&&(v=!I&&!b)),!1!==v&&(!0===d.TREE.Sections?v=x:!1===d.TREE.Sections&&(v=!x)),!1!==v&&(!0===d.TREE.RootSection?v=T:!1===d.TREE.RootSection&&(v=!T)),!1!==v&&(!0===d.TREE.FavSection?v=F:!1===d.TREE.FavSection&&(v=!F)),!1!==v&&(!0===d.TREE.Favorites?v=r:!1===d.TREE.Favorites&&(v=!r)),v&&d.TREE.types){v=!!d.TREE.types[e.getType()]}if(v&&M){v=!!M[e.getType()]}if(v&&d.TREE.notypes){let t=d.TREE.notypes[e.getType()];v=v&&void 0===t}!1!==(v=v&&E.applyCmdsVariables(1,d,N).indexOf(!1)<0)&&d.TREE.check&&(v=d.TREE.check(e))}if(g=null,y&&d.CONTENT){let e=(!R||!h)&&V>=2&&W&&!m;if(g=!!t&&t.length>0)if(1===d.CONTENT||!0===d.CONTENT&&e)g=!0;else{g&&d.CONTENT.custo&&(g=l.isCustomizedEnv()),g&&m&&(g=!0===d.CONTENT.linkedFolder);let e=!1;if(g){let t=d.CONTENT.service,o=!1;!t&&d.CONTENT.noservice&&(t=d.CONTENT.noservice,o=!0),t&&(e=!0,o||!0!==t?L.forEach((e=>{g&&(g=o?0!==t[e]:t[e]>0&&t[e]<=V)})):g=!0)}g&&!e&&(!W||V<2)&&(g=!1),!1!==g&&(!0===d.CONTENT.Root?g=a:!1===d.CONTENT.Root&&(g=!a)),!1!==g&&(!0===d.CONTENT.SubElements?g=c:!1===d.CONTENT.SubElements&&(g=!c)),!1!==g&&(!0===d.CONTENT.TreeElements?g=c||a:!1===d.CONTENT.TreeElements&&!0!==d.linkedFolder&&(g=!c&&!a)),!1!==g&&(!0===d.CONTENT.FavContent?g=t[0].isFavorite:!1===d.CONTENT.FavContent&&(g=!t[0].isFavorite)),!1!==g&&!1===d.CONTENT.rootInClipboard&&(g=!C),!1!==g&&void 0!==d.CONTENT.search&&(g=d.CONTENT.search===p.isSearchActive()),g&&d.CONTENT.views&&(g=d.CONTENT.views.indexOf(l.getContentActiveView())>=0),!1!==g&&!1===d.CONTENT.childProduct&&(y=g=!u),g&&(d.CONTENT.types||d.CONTENT.notypes||M)&&B.forEach((e=>{if(g){if(d.CONTENT.types){let t=!!d.CONTENT.types&&d.CONTENT.types[e];g=!!t}if(M&&g){let t=!!M&&M[e];g=!!t}if(d.CONTENT.notypes&&g){let t=!!d.CONTENT.notypes&&d.CONTENT.notypes[e];g=g&&!t}}})),g=g&&E.applyCmdsVariables(2,d,N).indexOf(!1)<0;let o=d.CONTENT.check;if(!1!==g&&o){var w=!0;t.every((function(e){return w=w&&o(e)})),g=w}}}y=y&&(!0===g||!0===v||null===g&&null===v)}H[n]=y,i||this._switchCommand(n,y,d.type)}})),H}enableAllCommands(e){var t=f.getCommandByContext();for(var o in t){var i=f.getCommandByContext(o);UWA.is(i)&&i.enable&&(e?this._switchCommand(o,!0):"ListSnapshotsHdr"!==o&&this._switchCommand(o,!1))}}getModelEvents(){return v.getModelEvents()}_getCurrentFolder(e){return this._asyncUpdatePromise&&this._asyncUpdatePromise.cancel(),this._asyncUpdatePromise=new s(((t,o)=>{e?t(e):c.getCurrentBookmarkInfo().then(t).catch(o)})),this._asyncUpdatePromise}async updateCommands(e,t){t=await this._getCurrentFolder(t);let o=u.getSelectedContent();o=o||(e?[e]:[]),super.updateCommands(t,o)}})})),define("DS/FolderEditor/views/FolderPlaceHolder",["UWA/Controls/Abstract","DS/Controls/Button","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderSearch","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/ActionBar/FolderCommandManager"],(function(e,t,o,i,n,r,s,l){"use strict";return e.extend({init:function(e){this._parent(e),this._buttonComponents=null,this.text={},this.buildSkeleton(),r.subscribe({event:"command_availability_updated"},(async e=>{if(0===e.nodes.length&&e.treeNode){this.elements.commonCommand.empty(),(await l.getPlaceholderCommands()).forEach((e=>{let o=e.command.getId(),i=l.getTooltip(o),n=l.getIconObjectCommand(o,{iconType:"font"});n&&(n={...n,fontIconSize:"0.5x"}),function(e,o){let i=new t(e);return i.addEventListener("buttonclick",o),i}({label:i.title,emphasize:e.emphasize?e.emphasize:"secondary",icon:n},(()=>{l.launchCommand(o)})).inject(this.elements.commonCommand)})),this.elements.commonCommand.show()}else this.elements.commonCommand.hide()}))},hide:function(){this.elements.innerContainer.hide()},show:function(){this.elements.innerContainer.show()},getInnerPlaceholder:function(){return this.elements.innerContainer},resetInnerPlaceholder(){this.elements.innerContainer.inject(this.elements.container)},buildSkeleton:function(){this.elements.container=UWA.createElement("div",{class:"placeholder_wrapper"}),this.elements.innerContainer=UWA.createElement("div",{class:"content-placeholder"}).inject(this.elements.container),this.elements.icon=UWA.createElement("div",{class:"content-placeholder-icon"}).inject(this.elements.innerContainer),this.elements.description=UWA.createElement("div",{class:"content-placeholder-description"}).inject(this.elements.innerContainer),this.elements.commonCommand=UWA.createElement("div",{class:"content-placeholder-common-command"}).inject(this.elements.innerContainer),o.onBookmarkOpening((()=>{this._updateMessage(),this.elements.commonCommand.hide()})),n.onSearchChange((()=>{this._updateMessage(),this.elements.commonCommand.hide()})),this._updateMessage()},_updateMessage:function(){let e=null;if(n.isSearchActive())e=i.get("placeholder_msg_search");else{let t=s.getSection(o.getCurrentBookmarkId());e=t&&!0===t.favorite?i.get("placeholder_msg_favorite"):t?i.replace(i.get("placeholder_msg_section"),{typeStruct:s.getSectionRootNls(t.name)}):i.replace(i.get("placeholder_msg_folder"),{typeStruct:o.getCurrentEltTypeNls()})}this.elements.description.innerText=e}})})),define("DS/FolderEditor/commands/FolderCommands",["UWA/Core","UWA/Utils","DS/IPClassifyUtil/IPClassifyAlert","DS/TreeModel/TreeNodeModel","DS/IPClassifyUXUtil/private/CredentialsManager","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUXUtil/IPClassifyConfirmationWthCheckBx","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/popup/BookmarkConfirmationWthCheckBx","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/UIKIT/Mask","DS/FolderEditor/utils/FolderEditorControl","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/views/FolderLoader","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/models/xBookNodeModel","DS/WidgetServices/WidgetServices","DS/UIKIT/Native/Dropdown","DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/BookmarkLocationUtil","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/popup/BookmarkLocationPopup","DS/FolderEditor/views/FolderRevisionReportPanel","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/ProgressPaneExecution","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/FolderEditor/popup/BookmarkExternalURLPopup","DS/FolderEditor/service/BkOperationsUtils","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/IPClassifyUtil/IPSettingsMgr","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/plugins/PluginsManager","DS/Menu/ContextualMenu","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUXUtil/IPConfirmationDialog","DS/FolderEditor/models/xTreeNodeModel","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/FolderEditor/utils/ExpandProductHandler"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F,T,x,P,A,k,N,M,U,O,R,L,B,V,W,j,H,X,q,z){"use strict";let G=!1,J=null;function Q({nodes:e,sourceNode:t,targetNode:o}){let n=[];o.getID()===t.getID()&&n.push("withCopy");for(var r=0;r<e.length;r++){var s=e[r].getID(),l=h.getVisibleTreeNode(s);l&&o instanceof i&&l.isAscendantOf(o)&&n.push("withCopy")}return o.getID()===o.getSection()&&n.push("withCopy"),n}function K(e,t){return new Promise(((e,i)=>{u.AddShortcut(t),t.callbacks={onComplete:function(i){e();let n=i.invalidFolder?Object.keys(i.invalidFolder).length:0;if("SUCCESS"==i.status){P.switchtoAuthoringMode(),O.publish({event:"refresh_content"});let e=t.targetID.length>1&&c.msg_AddShortcutsSuccess?c.msg_AddShortcutsSuccess:c.msg_AddShortcutSuccess;o.displayNotification({...e,message:n>0?e.message+" "+c.replace(c.msg_info_addShortcut_alreadyPresent,{shortcutAlreadyPresent:n}):e.message,className:"success"})}else o.displayNotification({message:c.replace(c.msg_info_addShortcut_alreadyPresent,{shortcutAlreadyPresent:n}),className:"success"})},onFailure:function(t,i,n){e();var r=t;t&&i&&i.error?ee("PasteCmd AddShortcut",i.error,t):t&&t.message&&t.message.contains("NetworkError")&&t.message.contains("500")?o.displayNotification({title:c.msg_AddShortcutFail.title,subtitle:c.msg_AddShortcutFail.subtitle,message:c.msg_AddShortcutFail.message,className:"error"}):ee("PasteCmd",c.msg_error_AddShortcut,r)}}}))}function $(e){return!!B.isRootSection(e.getType())&&(o.displayNotification({subtitle:c.msg_error_Addinfolder,className:"error"}),!0)}function Y(e,t){let o=B.getTreeTypeNls(t[0].getType()),i=e.sectionElement?B.getSectionRootNls(e.getRoot().getType()):B.getSectionSubNls(e.getRoot().getType());return c.replace(c.confirmation_info,{From:o,To:i})}function Z(e){let t=[],o=[];e.forEach(((e,t)=>{if(t>0&&e){let t={};e.forEach((e=>{t[e.id]=e})),o.push(t)}}));let i=e[0];return i&&i.forEach((e=>{let i=null,n=e.items?[]:null;if(o.every((t=>(i=t[e.id],i&&n&&(i.items?n.push(i.items):n=null),i))),i){if(n){let t=Z(n);e.items=t}t.push(e)}})),t}function ee(e,t,i){if(UWA.is(t,"string")){var n=t;let r={};i&&(i.advice||i.error)?(console.error(e,i.error),r={title:n,subtitle:i.advice,message:i.error,className:"error"}):(console.error(e,i),r={className:"error"},r.message=n,!UWA.is(i)||i instanceof Error||(r.title=n,r.message=i)),o.displayNotification(r)}else if(UWA.is(t,"object"))o.displayNotification({...t,className:"error"});else{console.error(e,i);let t={className:"error"};n.title?t={...t,...n}:(t.message=n,!UWA.is(i)||i instanceof Error||(t.title=n,t.message=i)),o.displayNotification(t)}}function te(e,t){return new Promise(((o,i)=>{u.MoveFolder({IDs:e,targetfolder:t.targetNode,callbacks:{onComplete:function(t){o({status:"success",folderMoved:e.length})},onFailure:function(e){o({status:"failure",error:e.serverErr?e.serverErr:e})}}})}))}function oe(e,t){return new Promise(((i,n)=>{u.CopyFolder({IDs:e,targetfolder:t.targetNode,withContent:t.withContent,prefix:t.prefix,suffix:t.suffix,credential:t.credential,callbacks:{onComplete:function(t){i({status:"success",folderCopied:e.length})},onFailure:function({err:e,serverErr:n}){let r=n?B.parseMe(n):null,s=r&&"object"==typeof r?r:{error:r},l={err:e,serverErr:s||n},a="string"==typeof l.serverErr?l.serverErr:l.serverErr.error;if(!a&&e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500"))o.displayNotification({...c.msg_error_objectNoLongerAccessible,className:"error"});else{let o=a||c.replace(c.msg_error_CopyFolder,{typeStruct:B.getTreeTypeNls(t.typeFirstFolder)});ee("PasteCmd",e&&("timeout"===e.type||e.timeout)?c.msg_error_authorTimeout:o,e)}i({status:"failure",error:l})}}})}))}var ie=null,ne={_endProgressBarListener:function(){O.subscribeOnce({event:"onCompleteRefreshNodes"},(()=>{this._offProgressBar()}))},_offProgressBar:function(){if(0===S._counter)return null;S.off()},_startProgressBar:function(e){1===S._counter&&S.off(),S.on(e)},_nbItemsNotNull:function(e){var t,o=e.length,i=0;for(t=0;t<o;++t)e&&i++;return i},_activeCuttingNodes:!1,_setStateCuttingNodes:function(e){var t=0,o=e.length;if(this._activeCuttingNodes&&this._setStaUncuttingNodes(),0===o)return null;for(t=0;t<o;++t)e[t].updateOptions({isBeingCut:!0});this._activeCuttingNodes=!0},_setStaUncuttingNodes:function(){var e,t,o,i=0;if(this._activeCuttingNodes){if(0===(t=(e=m.getSelectedNodes()).length))return null;for(i=0;i<t;++i)(o=e[i]).options.isBeingCut&&o.updateOptions({isBeingCut:!1});this._activeCuttingNodes=!1}},escapCmd:function(){this._activeCuttingNodes&&(this._setStaUncuttingNodes(),m.ClearClipboard()),O.publish({event:"escape_action"})},RenameCmd:function(e,t,o){o=o||"tree";let i=t.layout.getColumnIndex(o),n=void 0!==e.rowID?e.rowID:e.nodeModel.getRowID(),r=t.layout.getCellIDFromCoordinates({rowID:n,columnID:i});t.setCellInEdition(r)},CopyCmd:function(e){let t=e.getSelectedNodes();var o=d.getSelectedBookmark();this._setStaUncuttingNodes(),m.addInFolderClipboard(t,o,"COPY")},CutCmd:function(e){let t=e.getSelectedNodes();var o=d.getSelectedBookmark();this._setStateCuttingNodes(t),m.addInFolderClipboard(t,o,"CUT")},PasteCmd:async function(e){let t=await u.getCurrentBookmarkInfo(),o=m.getTreeNode(),i=m.getSelectedNodes(),n=m.getMode();var r=e&&B.isTreeType(e.getType())?e:null;r||(r=t);let s=this.performCopyPaste({mode:n,nodes:i,sourceNode:o,targetNode:r});return"COPY"!==n&&s.then((()=>{m.ClearClipboard()})),s},performCopyPaste:async function({mode:e,nodes:t,sourceNode:n,targetNode:r}){if(t){if(this._setStaUncuttingNodes(),B.isTreeType(r.getType()))for(var s=0;s<t.length;s++)if(B.isTreeType(t[s].getType())&&!1===_.checkMoveOrCopyAcrossSharedAndPersonal(t[s],r,"COPY"==e))return void this._offProgressBar();var l=[],p=[],g=[],f=[];if(Array.isArray(t)||(t=[t]),t.length>0&&t.forEach((function(e){l.push(e.getID()),B.isSubElement(e.getType(),e.section)||B.isRootElement(e.getType(),e.section)?(p.push(e.getID()),g.push(e)):f.push(e)})),r)try{let s;if(e&&e.showMove){let e=g.length>0?g[0].getType():"",o=1===g.length?c.replace(c.PasteCmdTitle,{source:g[0].getLabel()}):c.replace(c.PasteCmdMultiTitle,{typeStruct:B.getOOTBTypeNls(e,!0)}),i=u.isSourceAndTargetTypeSame(g,r)?null:Y(r,g),l=Q({nodes:t,sourceNode:n,targetNode:r}),d=a.launch(e,{title:o,headerMessage:null,infoTitle:i,fields:null,noFields:null,userChoices:l&&l.length>0?l:["withCopy","withShortcut","withMove"]});s=await d}else e&&(void 0===e.showMove||e.showMove)||(e="COPY");await V.canBePasted(r.getType(),{mode:e,source:n,target:r,listOfContent:f,listOfTreeElements:g});let l="";if(g.length>0){let e=g[0];l=e.getType()}if("CUT"==e||s&&!0===s.isMove){if(p.length>0){"CUT"==e&&function({nodes:e,sourceNode:t,targetNode:o}){if(o.getID()===t.getID())throw{...B.buildNls(c,"msg_error_MoveInSamefolder",{typeStruct:B.getSectionSubNls(o.section,!1)})};if(o.getID()===t.getID())throw{...B.buildNls(c,"msg_error_MoveInSamefolder",{typeStruct:B.getSectionSubNls(o.section,!1)}),className:"error"};for(var n=0;n<e.length;n++){var r=e[n].getID(),s=h.getVisibleTreeNode(r);if(s&&o instanceof i&&s.isAscendantOf(o))throw{title:c.replace(c.msg_error_MoveFolder,{typeStruct:B.getSectionSubNls(o.section,!1),bookmarkName:o.getLabel()}),message:c.replace(c.msg_error_MoveFolder_parent,{typeStruct:B.getTreeTypeNls(o,!1),typeNode:B.getSectionSubNls(o.section,!1)})}}}({nodes:t,sourceNode:n,targetNode:r});let s=p.length;for(var m=[];p.length>0;){let e=p.splice(0,1);m.push(e)}let a=c.replace(c.progressPanel_moveFolder,{objectsAdded:s,typeStruct:B.getTreeTypeNls(l),targetfolder:r.options.label}),u={};u.targetNode=r;let f,_=await A.launchPanel(a,m,te,u),S=0;if(_.forEach((e=>{e&&!e.error?S+=e.folderMoved:f||(f=e.error)})),0!=S)if(o.displayNotification({message:c.replace(c.msg_info_foldermoved,{number:S,typeStruct:B.getTreeTypeNls(u.targetNode),typeNode:B.getTreeTypeNls(l),foldername:u.targetNode.getLabel()}),className:"success"}),O.publish({event:"remove_tree_nodes",data:{nodes:g}}),null!==r&&O.publish({event:"update_tree_new_node",data:{node:r}}),w.updateCommands(),r.getID()===d.getCurrentBookmarkId())O.publish({event:"refresh_content",data:{folderInfo:r}});else if(n.getID()===d.getCurrentBookmarkId())O.publish({event:"remove_content_nodes",data:t.map((e=>e.getID()))});else{1===t.length&&t[0].getID()===d.getCurrentBookmarkId()&&d.dispatchBookmarkNodeSelection(r)}else{var v=f;f&&f.message&&f.message.contains("NetworkError")&&f.message.contains("500")?o.displayNotification({...c.msg_error_objectNoLongerAccessible,className:"error"}):(f&&f.targetfolder&&B.isRootSection(f.targetfolder.getType())&&(v=c.replace(c.msg_error_CutPasteToRoot,{typeStruct:B.getTreeTypeNls(l,!1)})),ee("PasteCmd",c.replace(c.msg_error_MoveFolder,{typeStruct:B.getTreeTypeNls(l,!1)}),v))}}f.length>0&&($(r)||await U.processMoveOperation(f,n,r))}else if("COPY"==e||s&&(s.isCopy||s.isShortcut)){if(p.length>0){let e=Q({nodes:t,sourceNode:n,targetNode:r}),i=async function(t){if(!s){let o=Promise.resolve({nocheck:!0});if(t&&void 0!==t.data){let i=g.length>0?g[0].getType():"",n=1===g.length?c.replace(c.PasteCmdTitle,{source:g[0].getLabel()}):c.replace(c.PasteCmdMultiTitle,{typeStruct:B.getOOTBTypeNls(i,!0)}),s=u.isSourceAndTargetTypeSame(g,r)?null:Y(r,g),l=!!r.sectionElement&&B.isHardSection(r.sectionElement.name),d=t.data.noFields?t.data.noFields:null;l&&(d=d||[],d.push("dupOrShortcut")),o=a.launch(i,{title:n,headerMessage:"string"==typeof t.data.msg?t.data.msg:null,infoTitle:s,fields:t.data.fields,noFields:d,userChoices:e&&e.length>0?e:["withCopy","withShortcut"]})}s=await o}let i=s&&!0===s.nocheck;if(!i&&s.isShortcut){var n=[],h={};h.id=r.id,h.targetID=p,n.push(h.id);let e=c.replace(c.msg_creating_AddShortcut,{objectsAdded:h.targetID,targetfolder:r.getLabel()});await A.launchPanel(e,n,K,h)}else{var f={credential:s.credential};f.withContent=s.keepItems,i||(f.prefix=s.prefix,f.suffix=s.suffix);let e=p.length;for(var m=[];p.length>0;){let e=p.splice(0,1);m.push(e)}let t=c.replace(c.progressPanel_copyFolder,{objectsAdded:e,typeStruct:B.getTreeTypeNls(l),targetfolder:r.getLabel()});f.targetNode=r,f.typeFirstFolder=l;let n=await A.launchPanel(t,m,oe,f,{monoThread:!0}),a=0;if(n.forEach((e=>{e&&!e.error&&(a+=e.folderCopied)})),0!=a){let e=B.isSection(f.targetNode.getID())?c.replace(c.msg_info_rootCreated,{number:a,typeNode:B.getSectionRootNls(f.targetNode.section)}):c.replace(c.msg_info_foldercopied,{number:a,typeStruct:B.getTreeTypeNls(f.targetNode),typeNode:B.getTreeTypeNls(l),foldername:f.targetNode.getLabel()});o.displayNotification({message:e,className:"success"}),r.getID()===d.getCurrentBookmarkId()&&O.publish({event:"refresh_content",data:{folderInfo:r}}),null!==r&&O.publish({event:"update_tree_new_node",data:{node:r.getID()}})}}};await new Promise(((e,t)=>{u.CheckCopyFolder({IDs:p,typeForCopy:l,callbacks:{onComplete:async function(o){try{o&&parseInt(o)>200?await i({data:{msg:c.confirmation_copyMassive_message}}):await i({data:o}),e()}catch(e){t(e)}},onFailure:t}})}))}f.length>0&&($(r)||await U.processAddOperation(f,r))}}catch(e){this._offProgressBar();let t=null;("string"==typeof e.message||e.title)&&(t=e,e.title||(t=B.parseMe(e.message))),t||(t=c.msg_error_js),t="string"==typeof t?{message:t}:t,console.log(e),o.displayNotification({...t,className:"error"})}else this._offProgressBar(),o.displayNotification({message:c.msg_warning_nocurrentfolder,className:"warning"})}},expandQuery:function(e,t){return new Promise((i=>{u.expandProducts({IDs:e,callbacks:{onComplete:function(e){e.forEach((function(e){t.push(e)})),o.displayNotification({message:c.msg_info_objetexpanded,className:"success"}),i()},onFailure:function(e){i(),ee("RemoveContentCmd",c.msg_info_objetexpandedError,e)}}})}))},checkObjectType:function(e){for(var t=!0,o=0;o<e.length;o++)if(null==e[0].getChildren()){t=!1;break}return t},RemoveContentCmd:async function(e,t){var i=!1;if(F.isSearchActive())this.RemoveContentSearchWithinCmd();else{var n=this,r=await u.getCurrentBookmarkInfo();if(r){var s=UWA.createElement("div",{text:c.replace(c.confirmation_remove_message,{label:r.getLabel()})}),l=d.getSelectedNodes(),a=new k({type:"checkbox"});a.addChild(new N({type:"checkbox",label:c.removeStructuralObject,value:0,checkFlag:!1})),!0===this.checkObjectType(l)&&a.inject(s),a.addEventListener("buttonclick",(function(e){!0!==widget.getPreference("allow-products-expand").value?(o.displayNotification({title:c.msg_info_notEnabledExpand.title,subtitle:c.msg_info_notEnabledExpand.subtitle,className:"warning"}),e.dsModel.checkFlag=!1):i=e.dsModel.checkFlag}));let e=l,t=l.length>1||0===l.length?c.replace(c.confirmation_remove_titleX,{nb:l.length}):c.replace(c.confirmation_remove_title,{label:l[0].getLabel()});H.confirmDialog({classname:"confirmationRemoveMessage",immersiveFrame:widget.immersiveFrame,title:t,messageHTML:s,buttonLabels:{Yes:c.button_remove,No:c.confirmation_cancel}}).then((()=>{if(!0===i){let t=[];e=[],l.forEach((function(o){o.getAttributeValue("links")?e.push(o):t.push(o.getID())})),A.execute({title:c.replace(c.progressPanel_expand,{objectsexpanded:l.length,targetfolder:r.getLabel()}),datas:t,query:t=>n.expandQuery(t,e)}).then((()=>{P.switchtoAuthoringMode(),U.processRemoveOperation(e,r)}))}else P.switchtoAuthoringMode(),U.processRemoveOperation(e,r)})).catch((e=>{e&&console.log(e)}))}else o.displayNotification({message:c.msg_warning_nocurrentfolder,className:"warning"})}},RemoveContentSearchWithinCmd:async function(){var e=this,t=d.getSelectedContent()[0];if(null!=t){let s=t.getAttributeValue("_paths");if(!s){let e=await I.updateNodesWithPath([t]);e&&e.pids&&(s=e.pids[t.getID()]._paths)}if(s&&0!=s.length)if(s.length<=20){var i=t.getLabel(),n={title:c.replace(c.OpenLocationRemoveTitle,{label:i}),message:c.OpenLocationRemoveMessage,radio:!1,okButtonLabel:c.button_remove,onOkClick:()=>{var i=q.getCommandByContext("RemoveContent");i.disable(),e.locationPopop.dialog.hide();var n=t.getID();let r=[];s.forEach((e=>{if(t.getAttributeValue("links")){let o=e.linkInfo,i=d.getDefaultModelFromProperties(t);i.links=[o],r.push(U.processRemoveOperation([i],o.owner,!0))}else{let t=e.info;if(t.length>0){let e=t[t.length-1];r.push(U.processRemoveOperation([n],e.resourceid,!0))}}}));let l={};for(var a=0;a<s.length;a++){let e=s[a],t=e.info[e.info.length-1].resourceid;l[t]=a}let u=t.options.label;Promise.all(r).then((t=>{let i=!1;var n=[];let r=0;if(t.forEach((e=>{if(i=i||!e,e&&e.length>0){let t=e[0],o=t.bookmarkId;i=i||t.error;let s=l[o];if(void 0!==s){let e="success";t.error?e=t.networkErr?"serverError":"noChangeAllowed":0===t.numberOfContentRemoved&&(r+=t.numberOfContentNotRemoved,e="noRelationFound"),n[s]=e}}})),i)e.locationPopop.dialog.show(),e.locationPopop.dialog.buttons.Ok.visibleFlag=!1,e.locationPopop.dialog.buttons.Cancel.label=c.button_close,e.locationPopop.pushNotif(n);else{let i=d.getCurrentEltTypeNls(),n=r>0?" "+c.replace(c.msg_info_notConnectToBk,{number:r,typeStruct:i}):"";o.displayNotification({message:c.replace(c.msg_info_objectremovedfromfolders,{objectname:u,typeStruct:i,number:t.length-r})+n,className:"success"}),e.locationPopop.dialog.close()}})).finally((()=>{i.enable()}))}},r=new T(s,I.getHtmlElemFromPath.bind(I),n);e.locationPopop=r}else{let e=d.getCurrentEltTypeNls();o.displayNotification({...B.buildNls(c,"msg_warning_removeContentFromSearch",{typeStruct:e}),className:"error"})}else console.log("RemoveContentSearchWithinCmd"),o.displayNotification({...c.msg_warning_contentnotavailable,className:"warning"})}else o.displayNotification({message:c.msg_warning_nocontent,className:"warning"})},RemoveShortcutCmd:async function(e,t){var i=this,n=await u.getCurrentBookmarkInfo();n?H.confirmDialog({classname:"removeShortcut",immersiveFrame:widget.immersiveFrame,title:c.confirmation_removeshortcut_title,message:c.confirmation_removeshortcut_message}).then((()=>{var e=d.getSelectedNodes();if(e.length>0){i._startProgressBar(c.Remove_content_loading);var t=q.getCommandByContext("RemoveShortcut");t.disable();var r=[];e.forEach((function(e){UWA.is(e.id)&&-1===r.indexOf(e.id)&&r.push(e.id)})),P.switchtoAuthoringMode(),u.RemoveContent({IDs:r,source:n,isLinkedFolder:!0,callbacks:{onComplete:function(){if(r.length>10)O.publish({event:"refresh_content",data:{folderInfo:n,keepExpandStatus:!0}});else for(var e=0;e<r.length;e++){var t=r[e];O.publish({event:"remove_content_nodes",data:{nodeIds:[t],shortcut:!0}})}i._offProgressBar(),o.displayNotification({message:c.replace(c.msg_info_objetremoved,{number:r.length,typeStruct:B.getTreeTypeNls(n.getType()),foldername:n.getLabel()}),className:"success"})},onFailure:function(e,o){i._offProgressBar(),t.enable(),ee("RemoveContentCmd",c.replace(c.msg_error_Removefromfolder,{typeStruct:B.getTreeTypeNls(n.getType(),!1)}),o)}}})}else o.displayNotification({message:c.msg_warning_nocontent,className:"warning"})})).catch((e=>{e&&console.log(e)})):o.displayNotification({message:c.msg_warning_nocurrentfolder,className:"warning"})},ExpandAllCmd:function(e,t){if("TREE"===t&&e)e.expand({expandLevel:"All"});else{var i=null;i=d.getSelectedBookmark();var n=d.getSelectedNodes();let e=n.length,t=new z;1===e?t.callExpand(n[0]):e>1?t.expandPromise(n):null===i?o.displayNotification({message:c.msg_warning_nocurrentfolder,className:"warning"}):i.expandAll()}},CollapseAllCmd:function(e,t){var i=[],n=d.getSelectedBookmark();if("TREE"===t&&e?i.push(e):i=d.getSelectedNodes(),i.length){let e=i[0].getTreeDocument();e&&e.withTransactionUpdate((()=>{let e=_.isRelationsColumnsActive();i.forEach((function(t){t.childComputed=!1,t.options.children=e?t.options.children.filter((e=>e.isRelationsObjectGroupingNode)):[],t.setHasAsyncChildren(!0),t.collapseAll()}))}))}else null===n?o.displayNotification({message:c.msg_warning_noselection,className:"warning"}):n.collapseAll()},AccessRightCmd:function(e){w.launchCommand("ActionBar_AccessRightCmd",e)},uploadFileCmd:async function(e,t){var i=t?t.getID():d.getCurrentBookmarkId();let n=require("DS/IPClassifyUXUtil/IPClassifyLoaderGlobal"),r=!1;n.addComponentsToLoad("global",{checkingAccess:c.CheckingAccess_Loading});try{if(i){let e=await C.checkConnectionAccess({bookmarkId:i});r=e&&e.hasAccess}}catch(e){l.manageException(e)}if(n.removeComponentToLoad("global","checkingAccess"),!r)return;let s=u.getCurrentBookmarkInfo(),a=C.get3DSpaceUrl(),p=function(...e){return new Promise((t=>{require(e,(function(){t([...arguments])}))}))}("DS/DocumentCreateNew/CreateNew","DS/IPClassifyUtil/IPServicesMgr"),[h,g,f]=await Promise.all([s,a,p]);const[m,v]=f;var S=t?t.getLabel():h.getLabel(),b=new m({tenantUrl:g,securityContext:j.getCredential(),tenant:v.getPlatformId(),immersiveFrame:widget.immersiveFrame,containerToOverlay:widget.body,onUploadStart:function(){P.switchtoAuthoringMode()},onCancel:function(){},onError:function(e){o.displayNotification({title:e.title,message:e.message,className:"error"})},onDocumentUpload:async function(e){try{for(let r=0;r<e.documents.length;r++){let s=e.documents[r],l=await U.addContent([s.id],i,{title:s.dataelements.title,fetchAttributes:!0});if(l.objectsAdded&&(o.displayNotification({message:c.replace(c.get("msg_info_objetadded"),{filename:s.dataelements.title,foldername:S}),className:"success"}),i===d.getCurrentBookmarkId()&&l.attributes)){var t=_.convertToExaleadDataFormat(l.attributes);t.grid["ds6w:isLastRevision"]=!0;var n=new y(t);O.publish({event:"add_content_roots",data:{nodes:[n]}})}}}catch(e){l.manageException(e)}}});e?b.create(e):b.selectFilesAndCreate()},DownloadFileCmd:function(){var e=d.getSelectedNodes(),t=_.isTouchDevice();if(0===e.length)o.displayNotification({message:c.msg_warning_nocontent,className:"warning"});else{e[0].getType();var i=e[0].options.type;if(!t&&h.isCustomizedEnv())1===e.length?"Document"!==i&&"CATAnalysisResults"!==i&&"CATIA Design Table"!==i&&"CATIA CGR"!==i&&"CATAnalysisComputations"!==i&&require(["DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/FolderEditor/utils/FolderEditorControl"],(function(e){e.getCommandByContext("BulkDownload").begin()})):require(["DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/FolderEditor/utils/FolderEditorControl"],(function(e){e.getCommandByContext("BulkDownload").begin()}));else u.downloadFiles(undefined)}},FolderUploadCmd:async function(){var e={},t=await u.getCurrentBookmarkInfo();t&&(e.id=t.getID(),e.lable=t.getLabel(),u.FolderUpload(e))},addExternalLink:async function(){const e=await u.getCurrentBookmarkInfo();if(!e)return;const t={id:e.getID(),onOkClick:async e=>{let i={id:t.id,urlTitle:e.dataURLTitle};i.url=/^[A-Za-z]+:/.test(e.dataURL)?e.dataURL:`https://${e.dataURL}`;try{let e=await u.addExternalLink(i),t={title:c.msg_AddLinkSuccess.title,message:"",className:"success"},n=[];0!==e.objectsAdded&&(P.switchtoAuthoringMode(),O.publish({event:"refresh_content"}),n.push(c.msg_AddLinkSuccess.message)),e.objectsAlreadyPresent>0&&n.push(c.replace(c.msg_AddLinkPresent,{nbLinks:e.objectsAlreadyPresent})),t.message=n.join(" "),o.displayNotification(t)}catch(e){let t=e&&e.serverErr&&e.serverErr.error?e.serverErr.error:c.msg_AddLinkFail.message;ee("addLink",c.msg_AddLinkFail.title,t)}}};new M(t)},openExternalLink:function(){let e=d.getSelectedContent();window.open(e[0].options.grid.Link)},GetContextualMenu:async function(e,t,o){return new Promise((async(i,n)=>{var r,s=!!e.white_Click&&e.white_Click,l=o?d.getSelectedContent():[];r=!0===s?await u.getCurrentBookmarkInfo():l&&l.length>0&&"TREE"!=t?l:e.nodeModel,s&&l.length>0&&l.forEach((function(e){e.unselect()})),r&&!Array.isArray(r)&&(r=[r]),o||(o={cellInfos:e,data:{event:{pageX:0,pageY:0}}}),o.overrideAppLaunch=!0,o.ipCmdContext=r&&r.length>0&&r[0].isFavorite?"favorite":"",w.getContextualMenu(r,"TREE"===t,o).then(i).catch(n)}))},_addCtxItem:function(e,t,o){if("DS/ResultWebInWin/ResultWebInWinAction"==t.sourcejs){let i=t.image,n=o&&o[i]?o[i]:"",r={type:"PushItem",title:t.title,icon:n,action:{callback:()=>{var e=d.getSelectedNodes().map((e=>e.getID()));D.publish("onActionContextualMenu",{header:t.id,ids:e})}}},s=[];t.items&&(t.items.forEach((e=>{this._addCtxItem(s,e)})),r.submenu=s),e.push(r)}},showWebInWinCtxMenu:function(e,t){var o=t;if(o&&o.actions){let e=[];if(o.actions.length>0){Z(o.actions.map((e=>e.action))).forEach((o=>{this._addCtxItem(e,o,t.images)}));let i=[];o.actions.forEach(((e,t)=>{if(t>0&&e.actions){let t={};e.actions.forEach((e=>{t[e.id]=e})),i.push(t)}}));let n=o.actions[0];n.actions&&n.actions.forEach((o=>{let n=!0;i.every((e=>(n=e[o.id],n))),n&&this._addCtxItem(e,o,t.images)}))}this._initDropDown(e)}},_initDropDown:function(e){if(!ie)return;G=!0;let t=W.addEventListener(ie,{callback:function(){return e}});W.buildAndDisplayContextualMenu(ie,{clientX:J.x,clientY:J.y}),W.removeEventListener(ie,t),G=!1},getCtxMenu:function(e){var t=this;return e.data&&(J={x:e.data.event.pageX,y:e.data.event.pageY}),G?Promise.resolve([]):new Promise((async function(i,n){var r,s=null,l=null;ie=e.infos?e.infos.target:void 0,s=e.graphview?(l=e.graphview).node:e.treeview?(l=e.treeview).nodeModel?l.nodeModel:l.cellModel:(l=e.cellInfos)?l.nodeModel?l.nodeModel:l.cellModel:null;var a=L.isWebInWin(),u=!0===widget.getValue("standalone"),p=b.isSolidworksEnvironment();if(a&&null!==s&&"object"==typeof s&&(!p&&!u)){let e=d.getSelectedContent();return e.length>=10?o.displayNotification({...c.msg_warning_ctxExceed,className:"warning"}):(D.publish("Create_ContextMenu",{ids:s?e.map((e=>e.getID())):[]}),s&&!1===s.isSelected()&&s.select(!0)),void i(r)}null==l&&(l={});var h=l.rowID<0;if(l.cellView||e.graphview&&s||(l.white_Click=!0),s&&!0===s._busy)i(r);else{var g=null;l.white_Click||1==h?g=l:s&&(!1===s.isSelected()&&s.select(!0),!0===s.isSelected()&&(g=e.graphview?s:l)),g?t.GetContextualMenu(g,"CONTENT",e).then(i).catch(n):i([])}}))},previewFileCmd:async function(e){require(["DS/FolderEditor/commands/tools/DocumentCommandsMgr"],(t=>{t.launchDocumentCmd("Preview",e&&e.length>0?e[0]:null).then((e=>{e&&O.publish({event:"previewFile"})}))}))},activateFolderEditorItem:function(e){let t=e.id,o=e.getType();if(t&&B.isTreeType(o)){let t=null;if(!e.isFavorite){t=e.options.grid.ParentBk;let o=d.getCurrentBookmarkId();"TRUE"!==e.options.grid.isLinkedFolder&&!t&&o&&(t=o)}t&&(e._parentBk=t),e.isFavorite=!1,d.dispatchBookmarkNodeSelection(e)}else!0===w.areCommandsAvailable(null,[e],["PreviewFile"]).PreviewFile&&this.previewFileCmd([e]),console.log("Selected (Double Clicked) object is not folder")},_createLink:async function(e,t){var i=null,n=null,r=null,s=null,l="",a=null;let p=await u.getCurrentBookmarkInfo();if(e)a="function"==typeof e.getType?e.getType():null,n=e.getID(),r=e.getLabel();else{const e=d.getSelectedNodes();1==e.length&&(a="function"==typeof e[0].getType?e[0].getType():null,B.isTreeType(a,p.section)?(n=e[0].getID(),r=e[0].getLabel()):(l=e[0].getID(),n=p.getID(),r=p.getLabel(),s=e[0].getLabel()))}null!=n&&b.getSourceUrlAsync({platformId:b.getTenantID(),source:"3DDashboard",onComplete:function(e){var t=(e.endsWith("/")?"":"/")+"#app:"+widget.getValue("x3dAppId")+"/content:X3DContentId=",d={data:{items:[{objectId:n,contentId:l,envId:widget.getValue("x3dPlatformId")}]}};i=e+t+encodeURIComponent(JSON.stringify(d)),_.copyTexttoCLipboard(s||r,i).then((()=>{s&&o.displayNotification({message:c.replace(c.msg_success_copyLink_content,{filename:s,typeStruct:B.getTreeTypeNls(p.getType()),foldername:r}),className:"success"}),B.isTreeType(a)&&o.displayNotification({message:c.replace(c.msg_success_copyLink_folder,{typeStruct:B.getTreeTypeNls(a),foldername:r}),className:"success"})})).catch((e=>{console.log("%c"+e,"color: orange"),o.displayNotification({...c.msg_error_copylink,className:"error"})}))}})}};return ne})),define("DS/FolderEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUtil/IPContext"],(function(e,t,o,i,n,r){"use strict";return t.extend({labelTopBar:e.i18n("Expand All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=i.getSelectedContent();let t=this.options.context.getSelectedNodes()[0];if(e.length>0&&t.getID()==e[0].getID()){var n=e[0];o.ExpandAllCmd(n,"CONTENT")}else t&&o.ExpandAllCmd(t,"TREE")},endExecute:function(){}})})),define("DS/FolderEditor/commands/CtxCommands",["DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/BookmarkLocationUtil","DS/FolderEditor/models/xTreeNodeModel","DS/IPClassifyUtil/IPContext","DS/IPClassifyUXUtil/CredentialsView"],(function(e,t,o,i,n,r,s){"use strict";return e.extend({execute:function(){var e=r.get().ctxInfo;switch(this.options.ID){case"RenameCmd":case"RenameCmd_BrowsingStructure":case"RenameCmd_BrowsingNode":!function(e){let t=null,i=null;e?(t=e.options.cellInfos,i=e.options.isTree):(t={nodeModel:r.get().getSelectedNodes().at(0)},i=t.nodeModel instanceof n);o.publish({event:"rename_label",data:{isTree:i,cellInfos:t}})}(e);break;case"BookmarkLocation":!function(e){var t=e.nodes;t.length>0&&i.openBookmark(t[0])}(e);break;case"openInV5":!function(e){var t=e.nodes;require(["DS/FolderEditor/plugins/product/PrdUtils","DS/IPClassifyUtil/IPServicesMgr","DS/i3DXCompassServices/i3DXCompassPubSub"],(function(e,o,i){if(1!==t.length||!t[0].isRoot()||UWA.is(t[0].options.config_filter)||UWA.is(t[0].options.sequence_filter))e.buildDataForSetTypes(t,(function(e){var t=JSON.stringify(e),n={appId:"ENOUC5C_AP",widgetId:o.getWidgetId(),fileName:"-file",fileContent:t};i.publish("launchApp",n)}),!0);else{var n={objectId:t[0].getID(),envId:o.getPlatformId(),serviceId:"3DSpace",contextId:s.getCredential()};i.publish("setObject",n);var r={appId:"ENOUC5C_AP",widgetId:o.getWidgetId()};i.publish("launchApp",r)}}))}(e);break;case"PreviewFile":t.previewFileCmd(e.nodes)}}})})),define("DS/FolderEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPContext"],(function(e,t,o,i,n){"use strict";return t.extend({labelTopBar:e.i18n("Collase All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=i.getSelectedContent();let t=this.options.context.getSelectedNodes()[0];if(e.length>0&&t.getID()==e[0].getID()){var n=e[0];o.CollapseAllCmd(n,"CONTENT")}else t&&o.CollapseAllCmd(t,"TREE")},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_CopyCmd",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],(function(e,t,o,i){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){i.CopyCmd(this.options.context)},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_ImportCSVBookmarkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/views/FolderMode"],(function(e,t,o,i){"use strict";var n=t.extend({labelTopBar:e.i18n("Import CVS Bookmark Structure"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel"],(function(e){}))},beginExecute:function(){},execute:function(){require(["DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel","DS/FolderEditor/views/FolderMode"],(function(e,t){t.switchtoAuthoringMode(),new e}))},endExecute:function(){}});return n})),define("DS/FolderEditor/commands/ActionBar_ShareBookmarkLink",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],(function(e,t,o,i){"use strict";return t.extend({labelTopBar:e.i18n("Share Bookmark Link"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){i._createLink()},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_RemoveShortCutCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],(function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Remove Shortcut"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.RemoveShortcutCmd(),this.end()},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_CutCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],(function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.CutCmd(this.options.context)},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_PasteCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPContext","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/SettingsHandler"],(function(e,t,o,i,n){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=void 0,t=this.options.context.getSelectedNodes();1===t.length&&n.isTreeType(t[0].getType())&&(e=t[0]),i.PasteCmd(e)},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_UPSReplaceByLatestRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderServices","DS/WidgetServices/WidgetServices","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/views/FolderLoader","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/views/FolderRevisionReportPanel","DS/FolderEditor/views/FolderMode"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p){"use strict";var h=[];function g(t,o,i){console.log(i);let n="object"==typeof o?o:{message:o};!e.is(i)||i instanceof Error||(n.message+="<br>"+i),s.displayNotification({...n,className:"error"})}function f(){if(0===d._counter)return null;d.off()}return t.extend({labelTopBar:e.i18n("Replace By Latest Revision"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e={},t=[],o=r.getSelectedNodes(),n=o.length;o&&o.length<101?(o.forEach((function(e){var o={id:e.id};t.push(o)})),e={lastVersionRequests:t},i.getlastversion({objectsToTreat:e,callbacks:this._treatLatestRevision(n,o)})):s.displayNotification({message:l.msg_warning_replaceByLatestRevision_NotMorethan100Objects,className:"warning"}),this.end()},endExecute:function(){h=[]},_treatLatestRevision:function(e,t){var o=this;return{onComplete:function(n){var a=[],c=[],u=JSON.parse(n);u.lastVersionRequests.length>0&&u.lastVersionRequests.forEach((function(e){if(e.islast){var o=t.find((function(t){return t.id===e.id}));if(o){var i={};i[o.options.label+" "+o.options.grid["ds6wg:revision"]]="isLatestRevision",h.push(i)}}else a.push(e.id),c.push(e.candidates[0])}));var p,g=a.length;if(g>0){var f=a.length,m={numberOfSelectedObjects:e,objectsWithValidRevisions:f,idsToTreat:g};p=l.Replace_revision_loading,1===d._counter&&d.off(),d.on(p),i.replaceContent({IDsRemoved:a,IDsAdded:c,callbacks:o._treatReplacedContent(m)})}else s.displayNotification({message:l.replace(l.msg_warning_replaceByLatestRevision_sameObject,{typeStruct:r.getCurrentEltTypeNls()}),className:"warning"})},onFailure:function(e){g(0,l.msg_error_ReplaceBylatestRevision,e)}}},_treatReplacedContent:function(e){var t=this;return{onComplete:function(o){var i=JSON.parse(o);if("success"===i.status){var n={numberOfSelectedObjects:e.numberOfSelectedObjects,noObjectsReplaced:i.noObjectsReplaced,noObjectsExplicitlyRemoved:i.noObjectsExplicitlyRemoved,noObjLatestRevisionAlreadyPresent:e.numberOfSelectedObjects-e.objectsWithValidRevisions};s.displayNotification({message:l.msg_info_replaceByLatestRevision,className:"success"}),f(),t._updateTheNodes(i,n)}},onFailure:function(e){f(),g(0,l.msg_error_ReplaceBylatestRevision,e)}}},_updateTheNodes:function(e,t){var o=require("DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt"),n=require("DS/FolderEditor/utils/FolderEditorUtil");p.switchtoAuthoringMode();var r=this.options.context.getPADTreeDocument(),s=[],a=[],d=[],c=[];var g=new Promise((function(t){"replacablecontent"in e?r.withTransactionUpdate((function(){Object.keys(e.replacablecontent).forEach((function(t){r.getNodesById(t).forEach((function(i){if(0===i.getDepth()){i.collapse(),i.childComputed=!1,i.removeChildren();var r=e.replacablecontent[t];if(i.options){var l={};l[i.options.label+" "+i.options.grid["ds6wg:revision"]]=r.label+" "+r.revision,s.push(l)}var a=n.convertToExaleadDataFormat(r),d=n.convertToArray(a);i.updateAttributes(d,o.getAvailableColumns()),i.setAttribute("id",r.id),i.id=r.id,i.options.label=r.label,i.options.resourceid=r.id,i.options.type=r.type;i.updateOptions({grid:{"ds6w:isLastRevision":!0}}),i.select()}}))})),t()})):t()})),f=new Promise((function(t){"nodesToBeRemoved"in e?e.nodesToBeRemoved.length>0&&r.withTransactionUpdate((function(){e.nodesToBeRemoved.forEach((function(e){r.getNodesById(e).forEach((function(e){if(0===e.getDepth()&&(e.collapse(),r.removeRoot(e,!0,!1),e.options)){var t={};t[e.options.label+" "+e.options.grid["ds6wg:revision"]]="ToBeRemoved",s.push(t)}}))})),t()})):t()}));Promise.all([g,f]).then((async function(){let e=await i.getCurrentBookmarkInfo();(function(e){e.forEach((function(e){Object.keys(e).forEach((function(t){"ToBeRemoved"===e[t]?a.push(l.replace(l.revisionReport.explicitlyRemoved,{prd1:t})):"isLatestRevision"===e[t]?d.push(l.replace(l.revisionReport.isLatestRevison,{prd1:t})):a.push(l.replace(l.revisionReport.successfullyReplaced,{prd1:t,prd2:e[t]}))}))})),c.push(l.replace(l.revisionReport.msgObjectSelected,{object:t.numberOfSelectedObjects})),t.noObjLatestRevisionAlreadyPresent>0&&c.push(l.replace(l.revisionReport.msgObjectAlreadyLatestRevision,{object:t.noObjLatestRevisionAlreadyPresent})),t.noObjectsReplaced>0&&c.push(l.replace(l.revisionReport.msgSuccessfullyReplaced,{object:t.noObjectsReplaced})),t.noObjectsExplicitlyRemoved>0&&c.push(l.replace(l.revisionReport.msgObjectExplicitlyRemoved,{object:t.noObjectsExplicitlyRemoved}))})(s=s.concat(h)),new u({title:l.revisionReport.reportTitle+" - "+e.getLabel(),success:a,warning:d,information:c})}))}})})),define("DS/FolderEditor/commands/ActionBar_OpenExternalLinkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],(function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Open Link"),isInsert:!0,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.openExternalLink(),this.end()},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_AddExternalLinkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],(function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Add External Link"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.addExternalLink(),this.end()},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_UPSAuthReplaceByRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/CredentialsView"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g){"use strict";return t.extend({labelTopBar:e.i18n("Replace By Revision"),isInsert:!0,_selectedNodes:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e=null;if(1==(e=null===this._selectedNodes?a.getSelectedNodes():this._selectedNodes).length){var t=this.validPhysicalIDtobeReplaced=e[0].getID();this._launchVersionExplorer(t),this.end()}},endExecute:function(){this._selectedNodes=null},_launchVersionExplorer:function(t){var o=this,a=this._panelElement=document.getElementById("bookmarkEditor-dialog-versionexplorer");a||(a=this._panelElement=e.createElement("div",{id:"bookmarkEditor-dialog-versionexplorer",class:"revisionUpdate-dialog-versionexplorer"}).inject(widget.body)),this._myVersionExplorer=new i({versionGraphContainer:null,selectionMode:r.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:widget}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},a,!0),n.loadUserSettingsPromise({displayMode:r.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:o.validPhysicalIDtobeReplaced,tenantId:l.getTenant()?l.getTenant().value:"",securityContext:g.getCredential(),onComplete:function(){},dataModelType:r.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this._onVersionExplorerModalOK.bind(this,t),!1),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",this._onVersionExplorerModalCancel.bind(this,t),!1),this._dlgVersionExplorer=s._dlg,s._dlg&&s._dlg.rightButtons&&s._dlg.rightButtons.addEventListener("click",this._onVersionExplorerModalCancel.bind(this,t)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._dlgVersionExplorer.setTitle(u.dialog_replaceByLatestRevision),this._myVersionExplorer.subscribeEvent("select",(function(e){o._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1})),this._myVersionExplorer.subscribeEvent("unselect",(function(e){o._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0}))},_destroyPanel:function(){this._myVersionExplorer.unsubscribeAll()},_onVersionExplorerModalCancel:function(e){this._destroyPanel()},_onVersionExplorerModalOK:function(t){var o=this,i=this._myVersionExplorer.getSelectedNodes().shift().getAttributeValue("id");if(i!==o.validPhysicalIDtobeReplaced){var n=[],r=[];n.push(o.validPhysicalIDtobeReplaced),r.push(i),d.replaceContent({IDsRemoved:n,IDsAdded:r,callbacks:{onComplete:function(e){var t=JSON.parse(e);if("success"===t.status){o._updateTheNodes(t);var i=t.noObjectsExplicitlyRemoved;i>0?c.displayNotification({message:u.replace(u.msg_info_replaceByLatestRevision_removed,{number:i}),className:"primary"}):c.displayNotification({message:u.msg_info_replaceByRevision,className:"success"})}},onFailure:function(t){!function(t,o,i){if(e.is(o,"string")){var n=o;!e.is(i)||i instanceof Error||(n+="<br>"+i),c.displayNotification({message:n,className:"error"})}else e.is(o,"object")&&c.displayNotification({...o,className:"error"})}(0,u.msg_error_ReplaceBylatestRevision,t)}}})}else c.displayNotification({...u.msg_warning_replaceByRevision_sameObject,className:"warning"});this._destroyPanel()},_updateTheNodes:function(t){var o=require("DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt"),i=require("DS/FolderEditor/utils/FolderEditorUtil"),n=require("UWA/Promise");h.switchtoAuthoringMode();let r=this.options.context.getPADTreeDocument();"replacablecontent"in t&&r.withTransactionUpdate((function(){Object.keys(t.replacablecontent).forEach((function(s){r.getNodesById(s).forEach((function(r){if(r.getDepth()<1){r.collapse(),r.childComputed=!1,r.removeChildren();var l=t.replacablecontent[s],a=i.convertToExaleadDataFormat(l),d=i.convertToArray(a);r.updateAttributes(d,o.getAvailableColumns()),r.setAttribute("id",l.id),r.id=l.id,r.options.label=l.label,r.options.resourceid=l.id,r.options.type=l.type,new n((function(t){require(["DS/FolderEditor/service/FolderServices"],(function(o){var i={lastVersionRequests:[{id:l.id}]};o.getlastversion({objectsToTreat:i,callbacks:{onComplete:function(e){var o=JSON.parse(e).lastVersionRequests[0].islast;void 0!==o&&t(o)},onFailure:function(t){e.log("Replace content Service has failed")}}})}))})).then((function(e){var t={grid:{"ds6w:isLastRevision":e}};r.updateOptions(t),r.select()}))}}))}))})),"nodesToBeRemoved"in t&&t.nodesToBeRemoved.length>0&&r.withTransactionUpdate((function(){t.nodesToBeRemoved.forEach((function(e){r.getNodesById(e).forEach((function(e){e.getDepth()<1&&(e.collapse(),r.removeRoot(e,!0,!1))}))}))}))},_getVersionExploreforODT:function(){return this._myVersionExplorer?this._myVersionExplorer:null},setNode:function(e){this._selectedNodes=[e]}})})),define("DS/FolderEditor/commands/ActionBar_DownloadFileCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],(function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Download "),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.DownloadFileCmd()},endExecute:function(){}})})),define("DS/FolderEditor/commands/ActionBar_FolderUploadCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],(function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Folder Upload"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.FolderUploadCmd(),this.end()},endExecute:function(){}})})),define("DS/FolderEditor/service/FolderDnDServices",["DS/Controls/Toggle","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUXUtil/IPConfirmationDialog","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/UIKIT/Mask","DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUtil/IPServicesMgr","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderSearch","DS/WidgetServices/WidgetServices","DS/FolderUpload/FolderUpload","DS/IPClassifyUtil/PlatformAPIWrapper","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/service/BkOperationsUtils","DS/TreeModel/TreeNodeModel","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/plugins/PluginsManager","DS/FolderEditor/utils/FavoritesUtil","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/CredentialsView","DS/FolderEditor/popup/BookmarkConfirmationWthCheckBx"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I){"use strict";var F=!1,T="";return{setStartDrag:function(e){F=!0===e},isDragging:function(){return F},setDragFrom:function(e){T=e},getDragFrom:function(e){return T},shouldAcceptDrag:e=>!p.isRelationsColumnsActive()||!function(e){let t=!1,o=e?e.draggedNodes:r.getSelectedContent();if(o&&o.length>0)for(let e=0;e<o.length;++e)if(!0===o[e].isRelationsObjectGroupingNode){t=!0;break}return t}(e),retrieveDroppedDataFromDropEvent:function(e){for(var t,o=null,i=UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",n="",r=["text/searchitems","text/plain","Text","Files"],s=0;s<r.length&&""===n;s++){var l=e.dataTransfer.types[i](r[s]);(UWA.is(l,"number")&&l>=0||UWA.is(l,"boolean")&&!0===l)&&(n=r[s])}if(""===n)throw new Error("Unknown type in DnD");if("Files"!==n&&((t=e.dataTransfer.getData(n))&&(o=JSON.parse(t)),!o||!o.data||!o.data.items))throw new Error("Wrong DnD protocol used");return o},hasFilesInEvent:function(e){var t=e.dataTransfer?e.dataTransfer:e.detail?e.detail:null;if(t){if(t.items||!t.types||!t.types[0]||"application/x-moz-file"!==t.types[0]&&"Files"!==t.types[0]){var o=e.dataTransfer.types[UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains"]("Files");return!!(UWA.is(o,"number")&&o>=0||UWA.is(o,"boolean")&&!0===o)}return!0}return!1},isExternalDroppedDataOnFolderEditor:function(e){var t=!0;return e&&e.widget_id&&e.widget_id==this.getWidgetId()&&(t=!1),t},isExternalDroppedDataFromSameSource:function(e){var t=!1;return e&&e.source&&e.source==widget.getValue("x3dAppId")&&(t=!0),t},getSortedDroppedDataByType:function(e,t,o){var i=[],n=[],s=[],l=[];if(!!(e&&e.data&&e.data.items&&Array.isArray(e.data.items)))for(var a=0;a<e.data.items.length;a++){var d=e.data.items[a],c=d.objectId;if((p=d.objectType_Internal)||(p=d.objectType),Array.isArray(p))for(var u=p.length,p=u>0?p[u-1]:void 0,h=0;h<u;++h)if(y.isTreeType(p[h])){p=p[h];break}var g=d.displayName;g||(g=p),g||(g=c);var f=d.parentFolderId,m=d.envId,v=d.serviceId;let t=d.links,o=d.i3dx,S=d.uri,C=d._linkedFolder;var _={id:c,type:p,name:g,label:g,sourceFolder_id:f,serviceId:v,tenantId:m,i3dx:o,uri:S,links:t};_["ds6w:type"]=d.displayType,b.fillForDrop(_,d),_=r.getDefaultModelFromProperties(_),C?l.push(_):y.isRootElement(p)?i.push(_):y.isSubElement(p)?n.push(_):s.push(_)}t.droppedRootFolder_itemList=i,t.droppedFolder_itemList=n,t.droppedContent_itemList=s,t.droppedLinkedFolder_itemList=l},getWidgetId:function(){return self.widget.id},getDragDataForSelectedNodesInCurrentFolderContent:function(e){var t=r.getCurrentBookmarkId(),o=d.getAvailableCurrentBookmarkPath();let i=o&&o[t];for(var n=[],s=Array.isArray(i)?i.length:0,l=0;l<s;l++){var a=i[l];if(!y.isTreeType(a.type))break;n.push({resourceid:a.id,type:a.type})}var u=[];return(e&&e.draggedNodes?e.draggedNodes:r.getSelectedContent()).forEach((function(e){if(e){var o=e.options.type;let s=e.getAttributeValue("serviceId");var i={envId:c.getPlatformId(),serviceId:s||"3DSpace",contextId:w.getCredential()?w.getCredential():void 0,objectId:e.getID(),objectType:o,i3dx:e.getAttributeValue("i3dx"),uri:e.getAttributeValue("uri"),links:e.getAttributeValue("links"),displayName:e.getLabel(),displayType:e.options.grid["ds6w:type"],parentFolderId:e.isRoot()&&"search"!==d.getContentMode()?t:"",folderId:t};if(!y.isTreeType(o)){var r=e.getOccurencePathWithType?e.getOccurencePathWithType():void 0;e.isRelationsObjectNode?i.path=[r[r.length-1]]:i.path=r}y.isTreeType(o)&&e.isFavorite||(i.folderPath=n,i._linkedFolder="TRUE"===e.getAttributeValue("isLinkedFolder")),b.fillContentDrag(e,i),u.push(i)}})),{protocol:"3DXContent",version:"2.1",source:widget.getValue("x3dAppId"),widget_id:this.getWidgetId(),data:{noMove:"search"===d.getContentMode(),items:u}}},preAddContentInFolder:async function(e,t,o,i,n,{areLinkedFolders:r,confirmAction:s}){if(o.length<1)return void console.log("  Error in FolderDnDServices.addContentInFolder, listObj list is empty");let l=!1;if(e&&y.isTreeType(e.getType())&&o){let a=!!n.detachAllItemsFrom;if(s.isMove){if(i){l=!0;let i=await S.processMoveOperation(o,t,e,{checkSourceRelation:a,areLinkedFolders:r});if(a&&i.itemsNotInSourceFolder&&i.itemsNotInSourceFolder.length>0){let t=new Map;o.forEach((e=>{t.set(e.id,e)}));let n=[];i.itemsNotInSourceFolder.forEach((e=>n.push(t.get(e)))),await S.processAddOperation(n,e,!0,{areLinkedFolders:r})}}}else s.isBookmark&&await S.processAddOperation(o,e,!0,{areLinkedFolders:r})}else console.log("  Error in FolderDnDServices.addContentInFolder, dropTarget_FolderNodeModel is not a Folder");return{moveDone:l}},addFoldersInFolder:async function(e,t,o,i){let n=d.getVisibleTreeNode(t);return n=n||r.getDefaultModelFromId(t),u.performCopyPaste({mode:{showMove:i},nodes:o,sourceNode:n,targetNode:e})},processDroppedDataOnFolderEditorNode:async function(e,o){var i=this;let n=void 0!==y.getSettingParameter("pasteWithMove")&&y.getSettingParameter("pasteWithMove");function a(e){if(Array.isArray(e)&&e.length>0)for(var t=c.getPlatformId(),o=e.length-1;o>=0;o--){var i=e[o];if(i&&i.tenantId!==t)return!1}return!0}if(o&&e){let c=o.data.items.some((e=>!e.parentFolderId)),b=!!o.data.noMove,D=null,w=await l.getCurrentBookmarkInfo();c&&(D=w.getLabel(),o.detachAllItemsFrom=b?"":w.getID()),n=n&&!b;var d=i.isExternalDroppedDataOnFolderEditor(o);d&&(n=n&&this.isExternalDroppedDataFromSameSource(o));var u={};i.getSortedDroppedDataByType(o,u,e);let{droppedRootFolder_itemList:F,droppedFolder_itemList:T,droppedContent_itemList:x,droppedLinkedFolder_itemList:P}=u,A=[...x,...P];if(!a(F)||!a(T)||!a(x))return void t.displayNotification({message:s.msg_warning_dndnotsupported_from_different_tenant,className:"warning"});if(!function(t){if(Array.isArray(t)&&t.length>0)for(var o=t.length-1;o>=0;o--){var i=t[o];if(!i||y.isExternalObject(i)&&(!y.isExternalObjectSupported(e.section||r.getCurrentBookmarkSection())||!i.i3dx&&"www"!==i.serviceId))return!1}return!0}(A)){let e="";return A.length>0&&(e=A[0].getAttributeValue("ds6w:type"),e=e||A[0].type),void t.displayNotification({title:s.replace(s.msg_warning_dndnotsupported_from_different_source.title,{objectType:e}),subtitle:s.msg_warning_dndnotsupported_from_different_source.subtitle,className:"warning"})}let k=y.getSection(e.getType()),N=k?!!k.roots:null;if(y.isTreeType(e.getType())||N){let t=[...F,...T];var h=[];if(Array.isArray(t)&&t.length>0)for(;t.length>0&&t[0];){var f=t[0],v=f.sourceFolder_id;let o=[];for(var _=t.length-1;_>=0;_--){var S=t[_];S?S.sourceFolder_id===v&&(o.push(S),t.splice(_,1)):t.splice(_,1)}if(!d&&!p.checkMoveOrCopyAcrossSharedAndPersonal({isPersonal:f.isPersonal},e,n))return;h.push(i.addFoldersInFolder(e,v,o,n))}if(Array.isArray(A)&&A.length>0){let t=[{list:x,mapSourceBk:{},mapItems:new Map},{list:P,mapSourceBk:{},mapItems:new Map}],l=null,a=0;const u=(C=e)?"function"==typeof C.getID?C.getID():C.id:null;let p=!1;t.forEach((e=>{e.list&&(a+=e.list.length,e.list.forEach((t=>{if(l=l||t,!e.mapItems.has(t.id)){let i=t.sourceFolder_id;i=i||o.detachAllItemsFrom;let n=e.mapSourceBk[i];if(!n){let t=null;d?t=r.getDefaultModelFromId(i):w&&w.getID()===i&&(t=w),p=p||i!==u,n=e.mapSourceBk[i]={sourceNode:t,content:[]}}n.content.push(t),e.mapItems.set(t.id,t)}})))}));let g=l?l.getType():"",f=1===a?s.replace(s.PasteCmdTitle,{source:l.getLabel()}):s.replace(s.PasteCmdMultiTitle,{typeStruct:y.getOOTBTypeNls(g,!0)}),m={},v=[];if(v.push("withBookmark"),n&&p&&v.push("withMove"),1===v.length)-1!==v.indexOf("withMove")?m.isMove=!0:-1!==v.indexOf("withBookmark")&&(m.isBookmark=!0);else{let t=I.launch(g,{title:f,withMove:!0,withBookmark:!0,fields:null,noFields:null,userChoices:v,detailsMessage:{move:c?s.replace(s.details_for_alone_objects,{source:D,target:e.label}):""}});m=await t}t.forEach(((t,r)=>{if(t.mapItems&&t.mapItems.size>0){let s=t.mapSourceBk;for(let t in s){let l=s[t].content;h.push(i.preAddContentInFolder(e,s[t].sourceNode,l,n,o,{areLinkedFolders:1===r,confirmAction:m}))}}}))}Promise.allSettled(h).then((function(e){var t=!1;let i=!1;for(var n=0;n<e.length;n++)"fulfilled"==e[n].status?(t=!0,i=i||e[n].value&&e[n].value.moveDone):console.log(e[n].reason);if(t&&i){var r=o.widget_id+g.getTenantID()+widget.getValue("x3dAppId");m.publish(r)}}))}else y.getSection(e.getType())&&!0===y.getSection(e.getType()).favorite?([F,T].forEach(((t,o)=>{if(Array.isArray(t)&&t.length>0){var i=[];t.forEach((function(e){var t=!1;"SHARED"===e.folderClassification&&(t=!0);var o={id:e.id,name:e.name,type:e.type,isPersonal:e.isPersonal,inherit:t};i.push(o)})),i&&i.length>0&&E.addFavorite(i,e.getType())}})),Array.isArray(A)&&A.length>0&&t.displayNotification({message:s.msg_warning_dndnotsupported,className:"warning"})):console.warn("  FolderDnDServices processDroppedDataOnFolderEditorNode dropTarget_Info type is not in Folder family")}else console.warn("  FolderDnDServices processDroppedDataOnFolderEditorNode invalid argument(s)");var C},performDropOnFolderEditorNode:async function(e,o){var i=this;if(!e)return void console.log("  Error in FolderDnDServices.performDropOnFolderEditorNode, dropTarget_NodeModel is undefined");let n=null,l=null;try{n=i.retrieveDroppedDataFromDropEvent(o)}catch(e){l=e}try{if(!await b.dropLeftView(e.getType(),e,o,{dataDropped:n})){if(l)throw l;let t=!1,o=!0;if(n&&(o=n.data.items.every((t=>y.isTreeType(t.objectType,e.section))),n.data&&n.data.items&&!o&&(t=0===n.data.items.filter((t=>t.parentFolderId!==e.getID())).length)),!t){let t=e.sectionElement&&!0===e.sectionElement.favorite;n&&e&&(self.widget&&"bookmark"===this.getDragFrom()&&r.getCurrentBookmarkId()!==e.getID()&&!t?(i.processDroppedDataOnFolderEditorNode(e,n),i.setDragFrom("")):i.processDroppedDataOnFolderEditorNode(e,n))}}}catch(e){n=null,console.log(e),t.displayNotification({message:s.msg_warning_dndnotsupported,className:"warning"})}}}})),define("DS/FolderEditor/FolderTreeDocument",["DS/Logger/Logger","DS/FolderEditor/xBookDocument","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/tagger/TaggerContentProxy","DS/IPClassifyUXUtil/ProgressPaneExecution","DS/IPClassifyUtil/PlatformAPIWrapper","DS/LifecycleServices/LifecycleServicesSettings","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/plugins/PluginsManager","DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/Folder_Clipboard","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUXUtil/utils/DictionaryAccess"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C){"use strict";var y=t.extend({name:"FolderTreeDocument",_doNotAddFolder:!1,init:function(t){t.shouldAcceptDrag=this.shouldAcceptDrag.bind(this),t.shouldAcceptDrop=this.shouldAcceptDrop.bind(this),t.allowUnsafeHTMLContent=!1,t.insert=this.insert.bind(this),t.authorize_setStructure=!0,t.shouldBeEditable=s.shouldBeEditable,this._parent(t),this.onNodeModelUpdate(s.onNodeModelUpdate);var o=this;this.subscribe({event:"filter"},(({data:e})=>{let t=!0;if(e.filter){let o=e.filter.filterOptions,i=e.filter.filterModel;o&&!1===e.filter.filterOptions.refreshOnFilter&&(t=!!i,delete e.filter.filterOptions.refreshOnFilter)}if(this.withTransactionUpdate((()=>{this.reapplyAppFiltering()})),e.propertyId&&t){let t=this.getFilterManager().filterModel;a.setTableFilter(t),v.publish({event:"grid_filter_updated",data:{data:e}})}})),v.subscribe({event:"refresh_content_nodes"},this.refreshNodeById.bind(this)),v.subscribe({event:"refresh_nodes"},this.refreshNodeById.bind(this)),c.subscribe("XEN/PUBLIC_EVENT/ENGINEERING_ITEM/PART_NUMBER_UPDATED",(function(e){let t=[];"success"===e.status&&e.references.length>0&&(e.references.forEach((function(e){t.push(e.physicalid)})),o.refreshNodeById({modified:t}))})),this._logger=e.getLogger(y),this._logger.log("init");o=this;this.selection_broadcast_fn=h.debounce((function(){v.publish({event:"update_selection_count",data:{count:o.getSelectedNodes().length}})}),100),this.getXSO().onChange(o.selection_broadcast_fn),this.getXSO().onEmpty((function(){o._doNotAddFolder=!1,o.selection_broadcast_fn()})),this.getXSO().onPreEmpty((function(){o._doNotAddFolder=!0}))},_buildSelectData:async function(){var e=this._parent();if(e){var t=await r.getCurrentBookmarkInfo();if(Array.isArray(e.paths)&&e.paths.length>=1){if(t&&g.isTreeType(t.getType())){for(var o=await r.getCurrentBookmarkPath(t.getSection()),i=[],n=Array.isArray(o)?o.length:0,s=0;s<n;s++)i.push({resourceid:o[s].id,type:o[s].type});e.folderPath=i}}else if(t&&g.isTreeType(t.getType())){o=await r.getCurrentBookmarkPath(t.getSection());var l=[];for(n=Array.isArray(o)?o.length:0,s=0;s<n-1;s++)l.push({resourceid:o[s].id,type:o[s].type});var a={};if(n>=1){let e=o[n-1];e.id&&(a[e.id]={type:e.type,label:e.label})}e.paths=[[t.getID()]],e.attributes=a,e.folderPath=l}}return e},prepareBroadcastSelect:function(){this._doNotAddFolder=!0,this._parent()},pushBroadcastSelect:function(){this._doNotAddFolder=!1,this.selection_broadcast_fn(),this._parent()},shouldAcceptDrag:function(e){var t=[];if((t=this.getSelectedNodes()).length>0&&"Busy"==t[0].getType())return!1;return!0},shouldAcceptDrop:function(e){return!(e&&e.parentTreeNodeModel&&e.draggedTreeNodeModel)||f.actionAuthorized({action:"dropLV",type:e.parentTreeNodeModel.getType()})},insert:function(e,t,o){if(e&&t){var n=i.getDragDataForSelectedNodesInCurrentFolderContent();i.processDroppedDataOnFolderEditorNode(t,n)}return!1},deleteNodes:function(e){var t,o=e.length,i=!1;for(t=0;t<o;++t){if("noExpandState"!==e[t]._expandState&&!0===widget.getBool("filtered-content")){i=!0;break}}if(i){var n=this.getSelectedNodes().map((e=>e.getID()));v.publish({event:"refresh_content",data:{objectIds:n,keepExpandStatus:!0}})}else this._parent(e)},refreshNodeById:function(e){var t=e.modified;let o=new Set,i={};if(t.forEach((e=>{let t=e.attributes,n=e.physicalid?e.physicalid:e,r=this.getAllDescendants().find((e=>e.getID()===n));if(r){if(r&&g.isExternalObject(r))return;t?i[n]=t:o.add(n)}})),o.size>100){let e=this.getSelectedNodes().map((e=>e.getID()));return void v.publish({event:"refresh_content",data:{objectIds:e,keepExpandStatus:!0}})}let r=new Set,l=Promise.resolve();o.size>0&&(l=d.execute({title:S.replace(S.RefreshingNodes),datas:[...o],query:e=>{let t=n.getContentProperties({pid:e});return t.catch((t=>{r.add(e)})),t}})),l.then((e=>{this.withTransactionUpdate((()=>{try{let t=[],o={};e&&e.forEach((e=>{e&&UWA.is(e,"string")&&(e=JSON.parse(e),o[e.id]=e)})),this.getAllDescendants().forEach((e=>{let n=o[e.getID()];if(n){var l=s.convertToExaleadDataFormat(n);if(g.isTreeType(e.getType())){if(e._resetting=!0,e.options.oldLabel=l.label,e.options.publishOnConnect!==n.publishOnConnect){var a="TRUE"===n.publishOnConnect?p.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"):"";e.setBadges({bottomRight:a})}}else{var d=null;e._ischeckout="TRUE"===n.Documentlocked||"[TRUE]"===n.Documentlocked?"TRUE":"FALSE"}delete l.children,e.clearInternalValues(),e.updateOptions(l),t.push(e),"TRUE"===e._ischeckout&&(d=p.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png"),s.setBadge(e,"bottomRight",d))}else if(r.has(e.getID()))e.remove();else if(i[e.getID()]){let o=i[e.getID()],n={grid:{}},r=!1;o.forEach((t=>{n.grid[t.name]=t.value,e.options.gridValue[t.name]&&(r=!0,delete e.options.gridValue[t.name])})),e.updateOptions(n),r&&t.push(e)}})),t.forEach((e=>{C.updateNLS(e)}))}catch(e){console.log(e)}}))}))}});return y})),define("DS/FolderEditor/utils/FolderEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/SettingsHandler","DS/Logger/Logger"],(function(e,t,o,i,n,r,s,l,a,d,c){var u=function(){var e=document.activeElement;return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)};launchCommandForKey=function(e,t){var o=l.getCommand(t),i=null;return o&&o.isEnabled()?u()?i="Info : '"+e+"' key pressed in INPUT field, no command launched":o.begin():i="Info : '"+e+"' key pressed, but command '"+t+"' is disabled",i};class p{constructor(){this.name="FolderEditorKeyboardListener",this._additionalShortcuts={},this._logger=c.getLogger(p)}startObservingKeyboard(){e.Element.addEvent.call(document,"keydown",this._onKeyDown.bind(this))}addShortcut(e,t){this._additionalShortcuts[e]=t}_onKeyDown(e){var t=o.whichKey(e);if("ctrl+a"!=t||e.target.className.indexOf("FolderTreeListView")>=0){var i=this.launchKeyAction(t);i&&!0===i.stopPropagation&&o.stop(e)}}launchKeyAction(e){var t=this,o={stopPropagation:!1};let i=function(e,i,n){var r=launchCommandForKey(e,i);o.stopPropagation=!1!==n,r&&(t._logger.log(r),o.stopPropagation=!1)};switch(e){case"ctrl+a":i(e,"SelectAll");break;case"del":i(e,"DeleteHdr");break;case"ctrl+c":i(e,"Copy",!1);break;case"ctrl+x":i(e,"Cut");break;case"ctrl+v":i(e,"Paste");break;case"alt+return":i(e,"ActionBar_Attributes");break;case"f2":if(u())this._logger.log("Info : '"+e+"' key pressed in INPUT field, no command launched");else{var r=a.getSelectedNodes(),l=a.getSelectedBookmark();if((Array.isArray(r)?r.length:0)>=1){var c=r[0];if(c&&d.isTreeType(c.getType())){let e=l.getID()==c.getID();n.publish({event:"editLabel"+(e?"Tree":"Content"),data:{node:e?l:c}})}else this._logger.log("Info : '"+e+"' key pressed but selected element is not a Folder, no command launched")}else this._logger.log("Info : '"+e+"' key pressed when no element selected, no command launched")}break;case"esc":s.escapCmd();break;default:let t=this._additionalShortcuts[e];t&&(o=t())}return o}}return i.createSingleton(p)})),define("DS/FolderEditor/FolderIdCardCont",["UWA/Core","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/IPClassifyUXUtil/ActionBar/IPToolbar","UWA/Class/Options","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/service/FolderServices","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/commands/FolderCommands","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/Folder_CSO","DS/FolderEditor/models/FolderInfo","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorUtil","DS/Tweakers/GeneratedToolbar","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/SettingsHandler","DS/IPClassifyUXUtil/utils/CancellablePromise"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C){"use strict";function y(e,t){"left"===t?this.updateLeftPanelIcon(e):"right"===t&&this.updateRightPanelIcon(e)}function b(){var e=widget.getValue("useIndexAccleration")?isNaN(widget.getValue("autoSwitch"))?"LockDBMode":"DBMode":"LockDBMode";return{icon:this.getCommandManager().getIconObjectCommand(e)}}function E(){return{icon:this.getCommandManager().getIconObjectCommand("indexMode")}}function D(){let e=E.call(this),t=b.call(this);r.getCurrentModeType();let o={tooltip:r.getGeneratedTooltip(),label:u.indexMode.Label},i={...o,cmd:"DBMode",icon:e.icon,value:!0};return Object.defineProperty(i,"icon",{get:()=>b.call(this).icon}),{id:"indexMode",disabled:!widget.getValue("useIndexAccleration"),dataElements:{typeRepresentation:"customBoolean",value:"read"!==r.getCurrentModeType(),possibleValues:[{...o,cmd:"indexMode",icon:e.icon,value:!1},i],onNodeUpdate:function(e,{data:t}){void 0!==t&&require(["DS/FolderEditor/views/FolderMode"],(e=>{e.switchModeButtonUI({toActivate:t})}))},visibleFlag:!(1==widget.launchWithReadMode&&!widget.showDBCmd)}}}var w=i.extend(n,{name:"enoFolderIdCard_Container",_currentPathNodes:null,_dropPartIDs:null,_counter:0,getCommandManager:function(){return d},createPathInfo:e=>new g({id:e.id,mxid:e.mxid,type:e.type,label:e.label}),isTreeViewVisible:function(){return S.isTreeViewVisible()},getEntryForCommand:function(e){var t=null;return"IndexMode"===e&&(t=D.call(this)),t},init:function(e){l.setIdCardCont(this);var o=this,i=m.getLeftPanelStatus(),n=m.getRightPanelStatus();widget.addEvent("ontoolbarReady",(()=>{var t=m.getDefaultView(),o=d.getCommand(t);o&&o.options.icon&&e.modelEvents.publish({event:"toolbar_update_command",data:{commandID:"display",data:{grid:{data:t}}}})})),e.leftOpened=i&&i.leftPanelState,e.rightOpened=n&&n.rightPanelState,e.modelEvents=_.getModelEvents(),e.searchInCurrentTab=!0,this._parent(e),this._buildSkeleton();let r=e.modelEvents.subscribe({event:"searchValueSet"},f.changeSearch.bind(f));this.addSubscriptionToken(r),r=e.modelEvents.subscribe({event:"triptych-panel-hidden"},y.bind(this,!1)),this.addSubscriptionToken(r),r=e.modelEvents.subscribe({event:"triptych-panel-visible"},y.bind(this,!0)),this.addSubscriptionToken(r),r=e.modelEvents.subscribe({event:"update_index_icon"},(({mode:e})=>{let t="authoring"===e;_.publish({event:"toolbar_switch_state",data:{commandID:"indexMode",state:t,refreshToolbar:!0}}),_.publish({event:"toolbar_update_command",data:{commandID:"indexMode",data:{disabled:!widget.getValue("useIndexAccleration")}}})})),this.addSubscriptionToken(r),r=h.onBookmarkOpening((()=>{o.setCurrentLocation()})),this.addSubscriptionToken(r),s.onFolderRename(this.setCurrentLocation.bind(this)),this.dispatchEvent.call(this,"onReady"),t.addShortcut("ctrl+f",(async()=>{await this.isSearchAvailable()&&this.switchSearch(!0)}))},getPredicateMapping:function(){let e=null,t=o.getView();return t&&(e={},t.MP_SELECTED_COLS.forEach((t=>{let i=o.getColumn(t.dataIndex||t.ds6w);(t.ds6w||t.dataIndex)&&i.text&&!1!==i.visibleFlag&&(e[i.text.toLowerCase()]=t.ds6w||t.dataIndex)}))),e},inject:function(){this._parent.apply(this,arguments),this.setCurrentLocation()},setCurrentLocation:async function(){let e=this._parent,t=null,o=await a.getCurrentBookmarkInfo();t=S.isSection(h.getCurrentBookmarkId())?[{id:o.getID(),mxid:"",type:o.getType(),label:o.getLabel()}]:await a.getCurrentBookmarkPath(o.getSection()),t&&(_.publish({event:"update_toolbar_warning",data:{message:S.isSubElement(t[0].type)?u.replace(u.warn_tb_unavailableRoot,{typeStruct:S.getTreeTypeNls(t[0].type)}):"",type:"path",key:"rootUnavailable"}}),e.call(this,{objectPath:t}))},isSearchAvailable:function(e){return new C((async t=>{let o=e||await a.getCurrentBookmarkInfo(),i=!1;o&&S.isSearchSupported(o.section)&&!S.isFavoriteSection(o.getType())&&(i=!0),t(i)}))},render:function(){return this},_buildSkeleton:function(){this.topRightSideDiv=document.getElementsByClassName("FolderEditor_top_right_side_div"),s.subscribeEvents(),this.topRightSideDiv[0].addEventListener("dragover",this._onDragOver.bind(this),!0),this.topRightSideDiv[0].addEventListener("drop",this._onDrop.bind(this),!0),this.topRightSideDiv[0].addEventListener("dragenter",this._onDragEnter.bind(this),!0),this.topRightSideDiv[0].addEventListener("dragleave",this._onDragLeave.bind(this),!0),this.topRightSideDiv[0].addEventListener("contextmenu",this._rightClick.bind(this))},_rightClick:function(e){var t=e?e.target:null;return(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()),!1},_onDragOver:function(e,t,o,i){return e.preventDefault&&e.preventDefault(),!1},_onDragEnter:function(e,t,o,i){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var n=e.target?e.target:e.detail.target;return this._updateBorderDnD(n,!0),!0},_onDragLeave:function(e,t,o,i){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this._updateBorderDnD(e.target,!1),!0},_onDrop:function(e,t,o,i){var n,r=!1;return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this._updateBorderDnD(e.target,!1),f.isSearchActive()||(n=this._getSerializedData(e))&&(r=this._performDropAction(n)),r},_updateBorderDnD:function(e,t){var o=this.elements.titleIdCard_container;e&&(t?(this._counter=this._counter+1,o.addClassName("dropallowed_elem")):(this._counter=this._counter-1,0===this._counter&&o.removeClassName("dropallowed_elem")))},_performDropAction:function(e){var t,o,i=null;return(i=1===(t=e.data.items.length)?(o=e.data.items[t-1]).path?this._expandDroppedPath(o):this._expandDroppedItem(o):{isDropped:!1,msg:t>1?u.msg_warning_MultipleSelection:u.msg_warning_dndnotsupported}).isDropped||p.displayNotification({message:i.msg,className:"error"}),i.isDropped},_expandDroppedItem:function(e){var t,o,i,n=!1,r=null;(t=e.objectId,i=e.displayName||"",o=this._getObjectDroppedType(e),t&&o)?(n=!0,t!==h.getCurrentBookmarkId()&&h.dispatchBookmarkPropsSelection({id:t,type:o,label:i})):(n=!1,r=u.msg_warning_notProductRoot);return{isDropped:n,msg:r}},_getObjectDroppedType:function(e){var t,o,i,n=null;if(t=e.objectType_Internal||e.objectType,Array.isArray(t)&&t.length>0){for(o=t.length,i=0;i<o;++i)if(S.isTreeType(t[i])){n=t[i];break}}else S.isTreeType(t)&&(n=t);return n},_expandDroppedPath:function(e){var t,o,i,n,r,s=!1,l=null,a=0,d=!1;let c=null;if(this._dropPartIDs=[],(t=e.path)&&t.length>0){if(i=t.length,r=this._getLastIndexOfFolder(t),n=h.getCurrentBookmarkId(),o=this._getObjectDroppedType(e),-1===r&&!n&&!o)return{isDropped:!1,msg:u.msg_warning_nocurrentfolder};r>=0?(c={id:t[r].resourceid,type:t[r].type,displayName:t[r].displayName||""},r+1<i&&(a="Vaulted Objects"===t[r+1].type?r+2:r+1,this._setProductsIDsPath(a,t)),d=n!==c.id):(c=o?{id:e.objectId,type:o,displayName:e.displayName||""}:{id:n},d=n!==c.id,this._setProductsIDsPath(a,t)),s=!0,d?this._expandNodeOfPath(c):this._dropPartIDs.length>0&&_.publish({event:"expand_content_branch",data:this._dropPartIDs})}else s=!1,l=u.msg_warning_dndnotsupported;return{isDropped:s,msg:l}},_getLastIndexOfFolder:function(e){var t,o=-1,i=e.length;for(t=0;t<i;++t)S.isTreeType(e[t].type)&&(o=t);return o},_setProductsIDsPath:function(e,t){var o,i=t.length;for(o=e=e>-1?e:0;o<i;++o)this._dropPartIDs.push(t[o].resourceid)},_getSerializedData:function(e){var t,o,i,n,r,s="";for(o=e.dataTransfer?e.dataTransfer:e.detail?e.detail:null,i=UWA.is(o.types.indexOf,"function")?"indexOf":"contains",n=["text/searchitems","text/plain","Text"],t=0;t<n.length&&""===s;t++){var l=o.types[i](n[t]);(UWA.is(l,"number")&&l>=0||UWA.is(l,"boolean")&&!0===l)&&(s=n[t])}return""!==s&&(r=o.getData(s)),r&&r.length?JSON.parse(r):null},_expandNodeOfPath:function(e){e&&h.dispatchBookmarkPropsSelection({id:e.id,type:e.type,label:e.displayName})}});return w})),define("DS/FolderEditor/views/FolderGlobalActiveBookmark",["UWA/Core","UWA/Class","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderEditorControl","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/Controls/TooltipModel","DS/FolderEditor/models/xBookNodeModel","DS/Menu/ContextualMenu","DS/FolderEditor/commands/FolderCommands","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/IPClassifyAlert","DS/Logger/Logger","DS/FolderEditor/utils/FolderCommunication","DS/IPClassifyUtil/PlatformAPIWrapper","DS/FolderEditorOpenness/FolderEditorOpenness","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/WAFData/WAFData","DS/FolderEditor/service/FolderEditorWebService","DS/WidgetServices/WidgetServices","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/ActionBar/FolderCommandManager"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b){"use strict";var E={iconName:"pin",fontIconSize:"1x"},D={iconName:"pin-off",fontIconSize:"1x"},w=t.singleton({name:"ActiveFolder",ICON_ACTIVE:E,ICON_ACTIVE_DISABLED:D,ACTIVE_FOLDER_PREFERENCE:"ActiveFolder_FolderID",DEFAULT_VALUE:"!",_logger:null,_isInitialized:!1,_container:null,_cellElement:null,_nameElement:null,_activeFolder:{id:null,label:"",node:null,sc:""},_disabledActiveFolder:{id:null,label:"",node:null,sc:""},_tooltipDisplayButton:null,_tooltipTextSwitch:"",_labelSwitch:null,init:function(e){var t=this;t._logger=p.getLogger(w),t._logger.log("init"),t._parent(e),t.activeFolderCallBack();let o=n.getTreeCont(),i=this.retrieveActiveFolderFromPreference();return Promise.all([o,i]).then((([e])=>{t._buildSkeleton(e),t._isInitialized=!0})).catch((function(e){console.log(e)})),y.subscribe({event:"activeBkFailure"},(e=>{let t=this.getActiveBookmark();t&&t.id===e.id&&this._unsetAfterError()})),t},initialize:function(){},_buildSkeleton:function(t){var o=this,i=t.getCommonToolSection().getElement("#buttonSection");this._container=new e.createElement("div",{id:"active_folder_container"}).inject(i),this._cellElement=e.createElement("div",{id:"active_folder_cell",class:"wux-tweakers"}).inject(this._container,"top"),this._activeBookmarkIcon=e.createElement("div",{id:"active_folder_icon",class:"wux-ui-3ds wux-ui-3ds-bkmrk-folder-pin"}).inject(o._cellElement,"bottom"),this._nameElement=e.createElement("div",{id:"active_folder_label",class:"wux-tweakers wux-tweakers-string wux-tweakers-string-label",events:{click:function(){o.centerTreeToActiveFolder(null!==o._disabledActiveFolder.id?o._disabledActiveFolder.id:o._activeFolder.id)}}}).inject(o._cellElement,"bottom"),this._nameElement.tooltipInfos=this._tooltipDisplayButton=new s({shortHelp:r.tooltip_noDefaultLocation,initialDelay:0,mouseRelativePosition:!1}),this._dropDownMenu=e.createElement("div",{id:"active_folder_down_button",class:"fonticon fonticon-down-open",events:{click:function(){var e=new Event("contextmenu");e.pageX=(this.getBoundingClientRect().left+this.getBoundingClientRect().right)/2,e.pageY=(this.getBoundingClientRect().top+this.getBoundingClientRect().bottom)/2,this.dispatchEvent(e)}}}).inject(o._cellElement,"bottom");var n=null!==this._disabledActiveFolder.id?this._disabledActiveFolder.label:this._activeFolder.label;this._updateUI(n),this._buildContextualMenu()},_getNodeModel:function(){var e=null!==this._disabledActiveFolder.id?this._disabledActiveFolder:this._activeFolder,t=new l({resourceid:e.id,label:e.label,type:"Workspace Vault"});return t.isPersonal=e.isPersonal,t.getType=()=>"Workspace Vault",t},_buildContextualMenu:function(){var e=this;a.addEventListener(this._dropDownMenu,{callback:()=>{var t=[],o={type:"PushItem",title:r.CMDUnsetGlobalActiveFolder,icon:b.getIconObjectCommand("ActionBar_ActiveBookmarkCmd"),action:{callback:async()=>{m.addComponentsToLoad("global",{unsetActiveFolder:r.UnsetActiveBookmark_Loading});let t=e._activeFolder.id;var o=await i.getCurrentBookmarkInfo();t===o.getID()?b.launchCommand("ActiveFolder",o,null,"ContextualMenu"):this.activeFolderCommand(this._getNodeModel())}}},n={type:"PushItem",title:r.CMDShowInBookmarks,icon:b.getIconObjectCommand("BookmarkLocation"),action:{callback:function(){var t=null!==e._disabledActiveFolder.id?e._disabledActiveFolder.id:e._activeFolder.id;e.centerTreeToActiveFolder(t)}}},s={type:"PushItem",title:r.CMDAccessRightCmd,icon:b.getIconObjectCommand("ActionBar_AccessRightCmd"),action:{callback:function(){var t=e._getNodeModel();d.AccessRightCmd(t)}}},l={type:"PushItem",title:r.CMDShareBookmarkLink,icon:b.getIconObjectCommand("ActionBar_ShareBookmarkLink"),action:{callback:function(){var t=e._getNodeModel();d._createLink(t)}}},a=null!==e._disabledActiveFolder.id?"play":"pause",c={type:"PushItem",title:e._labelSwitch,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-"+a},tooltip:e._tooltipTextSwitch,action:{callback:function(){e.switchActiveFolderState()}}};let u=b.areCommandsAvailable(this._getNodeModel(),null,["ActionBar_AccessRightCmd"]);return t.push(o),t.push(n),u.ActionBar_AccessRightCmd&&t.push(s),t.push(l),S.isReplayedODT()&&t.push(c),t}})},_updateUI:function(e){null!=this._container&&(this._nameElement.setHTML("<p id='active_folder_label_text'>"+e+"</p>"),this._tooltipDisplayButton.shortHelp=r.replace(r.tooltip_defaultLocation,{folderLabel:e}),null==this._disabledActiveFolder.id?(this._tooltipTextSwitch=r.replace(r.tooltip_disableDefaultLocation,{folderLabel:e}),this._labelSwitch=r.CMDDisableGlobalActiveBookmark,this._nameElement.setStyle("color","#368ec4"),this._activeBookmarkIcon.setStyle("color","#368ec4"),this._updateTreeIcons(this._activeFolder.id,E)):(this._tooltipTextSwitch=r.replace(r.tooltip_enableDefaultLocation,{folderLabel:e}),this._labelSwitch=r.CMDEnableGlobalActiveBookmark,this._nameElement.setStyle("color","#b4b6ba"),this._activeBookmarkIcon.setStyle("color","#b4b6ba"),this._updateTreeIcons(this._activeFolder.id,null),this._updateTreeIcons(this._disabledActiveFolder.id,D)))},_updateTreeIcons:function(e,t){var o=n.getVisibleTreeNode(e,null);null!==o&&o.setBadges({topRight:t}),y.publish({event:"updateActiveBookmark",data:{removeIt:null===t}})},centerTreeToActiveFolder:function(e){C.dispatchBookmarkIdSelection(e,{force:!0,events:{treeFailure:"activeBkFailure",treeGiveUp:"activeBkFailure"}})},switchActiveFolderState:function(){var e=this;null!==this._disabledActiveFolder.id?(m.addComponentsToLoad("global",{enableActiveFolder:r.EnableActiveBookmark_Loading}),this._checkFolderStatus(this._disabledActiveFolder.id).then((function(){return e.setActiveFolder(e._disabledActiveFolder)})).then((function(){m.removeComponentToLoad("global","enableActiveFolder"),u.displayNotification({message:r.replace(r.msg_info_enable_successfully,{folderLabel:e._activeFolder.label}),className:"success"})})).catch((function(t){e._unsetAfterError(),m.removeComponentToLoad("global","enableActiveFolder")}))):(m.addComponentsToLoad("global",{disableActiveFolder:r.DisableActiveBookmark_Loading}),this._disabledActiveFolder=this._activeFolder,this._checkFolderStatus(this._activeFolder.id).then((function(){return e.unsetActiveFolder()})).then((function(){return e.services.setUserPreferences(e.ACTIVE_FOLDER_PREFERENCE,e.DEFAULT_VALUE+e._disabledActiveFolder.id)})).then((function(){m.removeComponentToLoad("global","disableActiveFolder"),u.displayNotification({message:r.replace(r.msg_info_disable_successfully,{folderLabel:e._disabledActiveFolder.label}),className:"success"})}),(function(t){e._unsetAfterError(),m.removeComponentToLoad("global","disableActiveFolder")})))},activeFolderCommand:function(e){var t=this,o=t._activeFolder,i=t._disabledActiveFolder,n={id:e.getID(),label:e.getLabel(),isPersonal:e.isPersonal,node:e},s=o.id!==n.id,l=!(i.id===n.id)&&s;l?m.addComponentsToLoad("global",{setActiveFolder:r.SetActiveBookmark_Loading}):m.addComponentsToLoad("global",{unsetActiveFolder:r.UnsetActiveBookmark_Loading}),this.unsetActiveFolder().then((function(){if(!l)return m.removeComponentToLoad("global","unsetActiveFolder"),u.displayNotification({message:r.replace(r.msg_info_inactive_successfully,{folderLabel:n.label}),className:"success"}),!1;t.setActiveFolder(n).then((function(e){m.removeComponentToLoad("global","setActiveFolder"),u.displayNotification({message:r.replace(r.msg_info_active_successfully,{folderLabel:t._activeFolder.label}),className:"success"})})).catch((function(e){console.log("Error: "+e)}))})).catch((function(e){console.log("Error: "+e)}))},setActiveFolder:function(e){var t=this;return t.services.setUserPreferences(t.ACTIVE_FOLDER_PREFERENCE,e.id).then((function(o){return t._activeFolder=e,null!=t._disabledActiveFolder.id&&(t._updateTreeIcons(t._disabledActiveFolder.id,null),t._disabledActiveFolder={id:null,label:"",node:null,sc:""}),n.setActiveFolder(t._activeFolder.id,t._activeFolder.label,t._activeFolder.sc,null),t._updateUI(t._activeFolder.label),null!=t._container&&t._container.show(),t._setCustomSecurityContext(),g.publish("FolderEditor.ActiveFolder",{id:t._activeFolder.id!==t.DEFAULT_VALUE?t._activeFolder.id:null,label:t._activeFolder.label,sc:t._activeFolder.sc}),o})).catch((function(e){console.log("Error: "+e)}))},getActiveBookmark:function(){var e=this._activeFolder.id!=this.DEFAULT_VALUE&&null!=this._activeFolder.id,t=null!=this._disabledActiveFolder.id;return e?this._activeFolder:t?this._disabledActiveFolder:null},unsetActiveFolder:function(){var e=this;return e.services.setUserPreferences(e.ACTIVE_FOLDER_PREFERENCE,e.DEFAULT_VALUE).then((function(t){let o=e._activeFolder.id!=e.DEFAULT_VALUE&&null!=e._activeFolder.id,i=e.getActiveBookmark();return null!=i&&e._updateTreeIcons(i.id,null),e._activeFolder={id:e.DEFAULT_VALUE,label:"",node:null,sc:""},o||(e._disabledActiveFolder={id:null,label:"",node:null,sc:""}),n.setActiveFolder(e.DEFAULT_VALUE,"","",e._disabledActiveFolder.id),o&&e._updateUI(e._disabledActiveFolder.label),null==e._disabledActiveFolder.id&&null!=e._container&&e._container.hide(),g.publish("FolderEditor.ActiveFolder",{id:null,label:"",sc:""}),t})).catch((function(e){console.log("Error: "+e)}))},_unsetAfterError:function(e){this._disabledActiveFolder={id:null,label:"",node:null,sc:""},this.unsetActiveFolder().then((function(){0!=e&&u.displayNotification({...r.msg_error_rest_GetActiveFolder,className:"warning"})})).catch((function(e){console.log("Error: "+e)}))},retrieveActiveFolderFromPreference:function(){var e=this;return e._getUserPreference().then((function(t){return t===e.DEFAULT_VALUE&&t.length===e.DEFAULT_VALUE.length?Promise.reject():(t.indexOf(e.DEFAULT_VALUE)>=0&&(t=t.slice(1,t.length),e._disabledActiveFolder={id:t,label:"",node:null,sc:""}),e._checkFolderStatus(t))})).then((function(t){return null!==e._disabledActiveFolder.id?(e._disabledActiveFolder.label=t.label,e._disabledActiveFolder.isPersonal=t.isPersonal,n.setActiveFolder(e.DEFAULT_VALUE,e._disabledActiveFolder.label,"",e._disabledActiveFolder.id),Promise.resolve(t)):(e._activeFolder=t,e._setCustomSecurityContext(),n.setActiveFolder(e._activeFolder.id,e._activeFolder.label,e._activeFolder.sc,e._disabledActiveFolder.id),h.publish("FolderEditor.ActiveFolder",Object.assign({},t,{node:""})),Promise.resolve(t))})).catch((function(t){e._unsetAfterError(!1)}))},_getUserPreference:function(){return this.services.getUserPreferences(this.ACTIVE_FOLDER_PREFERENCE).then((function(e){return e.value})).catch((e=>(u.displayNotification({...e,className:"error"}),this.DEFAULT_VALUE)))},_checkFolderStatus:function(e){var t=this;return new Promise((function(o,i){null!==e&&""!==e&&e!==t.DEFAULT_VALUE?t.services.getProperties({folderid:e,onComplete:function(e){void 0===e.id?i():o({isPersonal:"Personal"===e.folderClassification,id:e.id,label:e.label})},onFailure:function(e){i()}}):i()}))},_setCustomSecurityContext:function(){var e=this;if(f.useComputedSecurityContext()){var t=[],o=widget.getPreference("pad_security_ctx");if(o){var i=o.options;Array.isArray(i)?i.forEach((function(e){e.value&&t.push(e.value)})):e._logger.warn("The widget has no options for pad_security_ctx preference")}else e._logger.warn("The widget has no pad_security_ctx preference");var n="";if(t.length>0)try{n=f.computeSecurityContext(e._activeFolder.id,t)}catch(t){e._logger.warn("FolderEditorOpenness throws exception",t)}e._activeFolder.sc=n}else e._activeFolder.sc=""},activeFolderCallBack:function(e){var t=this;g.subscribe("FolderEditor.ActiveFolderCallBack",(function(e){null!==e?u.displayNotification({message:r.replace(r.msg_info_defaultLocation,{folderLabel:e.label}),className:"info"}):g.publish("FolderEditor.ActiveFolder",{id:t._activeFolder.id!==t.DEFAULT_VALUE?t._activeFolder.id:null,label:t._activeFolder.label,sc:t._activeFolder.sc})})),g.subscribe("FolderEditor.ActiveFolderCheck",(function(e){var o=t._activeFolder.id===t.DEFAULT_VALUE;t._checkFolderStatus(t._activeFolder.id).then((function(){}),(function(){null!==t._disabledActiveFolder.id?t._checkFolderStatus(t._disabledActiveFolder.id).then((function(){}),(function(){t._unsetAfterError()})):o||t._unsetAfterError()}))}))},services:{getUserPreferences:function(e){return new Promise((function(t,i){o.getUserPreferences({name:e}).then((o=>{t({keyname:e,value:o,message:null})})).catch((()=>{i({keyname:e,value:null,...r.msg_error_rest})}))}))},setUserPreferences:function(e,t){return new Promise(((i,n)=>{o.saveUserPreferences({name:e,value:t}).then((()=>{i({keyname:e,value:t,message:null})})).catch((e=>{this._logger.warn("WebService setPreference Err : "+(e&&e.err?e.err:e)),n()}))}))},getProperties:async function(e){var t=await _.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+e.folderid+"/properties",o={method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:widget.getPreference("pad_security_ctx").value},proxy:"passport",timeout:12e4};o.onComplete=e.onComplete,o.onFailure=e.onFailure,v.authenticatedRequest(t,o)}}});return w})),define("DS/FolderEditor/commands/ActionBar_ActiveFolderCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/Folder_CSO","DS/Utilities/Utils","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/views/FolderGlobalActiveBookmark","DS/FolderEditor/service/FolderServices"],(function(e,t,o,i,n,r,s){return t.extend({labelTopBar:"test",isInsert:!0,datas:{},_hasCommandBeenClicked:!0,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),r.initialize();let t=i.debounce(this._onChangeCurrentFolder.bind(this),100);o.onChange(t),this.onStateChange((async function(){if(this._hasCommandBeenClicked){var e=await s.getCurrentBookmarkInfo();r.activeFolderCommand(e)}this._hasCommandBeenClicked=!0}))},_onChangeCurrentFolder:function(){this._hasCommandBeenClicked=!1;var e,t,i=o.getCurrentBookmarkId(),r=(e=i,(t=n.getActiveFolder()).id===e||t.disabledId===e);this.setState(r,!1)}})})),define("DS/FolderEditor/views/customize_views/CommonRespView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/commands/FolderCommands","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/Utilities/DateUtils"],(function(e,t,o,i,n,r,s,l,a,d){"use strict";let c=["ds6w:label","favoriteTitle","ds6w:type","ds6wg:revision","ds6w:status","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"].map((e=>({ds6w:e})));function u(e){let t=[];return c.forEach((({ds6w:o,text:i})=>{if(e.isFavorite||"favoriteTitle"!==o){let n=e.getAttributeValue("ds6w:label"===o?"label":o);if(void 0!==n){"ds6w:modified"===o&&(n=d.formatDateToString(new Date(n),{timePrecision:"min"}));let e=l.ViewTooltip[o];t.push((e||i)+": "+n)}}})),t.join("\n")}return e.extend(o,i,{defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),async function(){c[0].text||(c=await n.getColumnsCompleted(c))}(),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1,selectionBehavior:{canMultiSelect:this.options.multiselection}},!0);t.onDelayedModelDataRequest=this.options.context.updateAttributesDelayed.bind(this.options.context);var o=this.options.grid=this.createView(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy((function(e){a.getCommandByContext("Copy").begin()})),o.onCellsPaste((function(e){a.getCommandByContext("Paste").begin()})),o.onCellsCut((function(e){a.getCommandByContext("Cut").begin()})),o.onDeleteKeyPressed((e=>{a.getCommandByContext("Remove Content").begin()})),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest((function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")})),o.onInfiniteScroll((function(e){r.publish({event:"processContentScroll",data:{options:e,grid:o}})})),o.getCustomTooltip=u,UWA.is(this.options.grid.onCellDoubleClick,"function")&&this.options.grid.onCellDoubleClick((function(e){var t=e.nodeModel;s.activateFolderEditorItem(t)}))},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.elements.container.parentElement===this.getOption("renderTo")&&this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})}})})),define("DS/FolderEditor/views/FolderThumbnailView",["DS/FolderEditor/views/customize_views/CommonRespView","DS/CollectionView/ResponsiveThumbnailsCollectionView"],(function(e,t){"use strict";return e.extend({name:"xBookResponsiveThumbnailView",createView:function(e){return new t(e)}})})),define("DS/FolderEditor/views/FolderTileView",["DS/FolderEditor/views/customize_views/CommonRespView","DS/CollectionView/ResponsiveTilesCollectionView"],(function(e,t){"use strict";return e.extend({name:"xBookResponsiveTileView",createView:function(e){return new t(e)}})})),define("DS/FolderEditor/utils/FolderExpandUtil_Read",["UWA/Utils","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorControl","DS/WebappsUtils/WebappsUtils","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/tagger/TaggerTreeProxy"],(function(e,t,o,i,n,r,s,l,a){var d=n.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png"),c=n.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");let u={};return{listFolder:function(e){var o=this,i=e.pid,n=null==e.level?"UI":"All"==e.level?-1:e.level,r=e.isRoot,l=e.onComplete,d=[],c=a.getFilterTags();"UI"==n?(e.Read=!0,e.nextStart=e.scrollObject?e.scrollObject.getNextStart():0,c&&(e.refine="",Object.keys(c).length>0&&(e.refine=c)),e.onComplete=function(t){var o=JSON.parse(t);if(r&&o.infos&&e.scrollObject){var i=o.infos;e.scrollObject.setInfoIndex(i),e.scrollObject.setNextStart(i.nresults+e.nextStart)}if(o.folders&&l(JSON.stringify(o)),o.error){var n=o.error.message;e.onFailure(n),s.displayNotification({message:n,className:"error"})}},t.folderTree(e)):(r?d.push(new Promise((function(t,i){var n=a.getFilterTags(),r={section:e.section,sortModel:e.sortModel,next_start:e.next_start};n&&(r.filters=n),o._getRootBookmarks(r).then((function(e){t(e)})).catch((function(e){i(e)}))}))):d.push(Promise.resolve()),Promise.all(d).then((function(t){let s={section:e.section};if(r){false;var{rootsMap:a,indexInfo:d}=t[0];if(1!==n)s.level=n,o._expandRoot({...s,indexInfo:d},a,l);else{var c=o.dataConversionToJson(a);c={folders:c},l(JSON.stringify(c),d)}}else s.level=n,s.node=e.node,o._expandSubFolder(s,i,l)})).catch((function(e){if(e){console.log(e);let t={};UWA.is(e,"object")?t={...e,className:"error"}:UWA.is(e,"string")&&(t={message:e,className:"error"}),s.displayNotification(t)}l(JSON.stringify({folders:[]}))})))},_expandSubFolder:function(e,t,o){var i=[];i.push(t),e.multi_root_physicalid=i,e.fromBookmark=!0,this._getExpandedBookmarks(e).then((function(e){let t=e;e.error||(t={folders:t.results}),o(t)}))},_expandRoot:function(e,t,o){let i=e.indexInfo;(e.level=-1==e.level?e.level:e.level-1,0!==t.size)?this._expandAllonRoot(e,t).then((function(e){let n=e;if(!e.error){let o=e.roots,i={};for(var r of(o.forEach((e=>{i[e.id]=!0})),t.keys()))i[r]||e.results.push(t.get(r));n={folders:e.results}}o(n,i)})):o({folders:[]},i)},_expandAllonRoot:function(e,t){var o=this;e={level:e.level,section:e.section,isExpandDoneOnRoot:!0};let i=[];for(var n of t.keys())i.push(n);return e.multi_root_physicalid=i,new Promise((function(t,i){o._getExpandedBookmarks(e).then(t).catch(i)}))},_getRootBookmarks:function(e){var o=this;return new Promise((function(i,n){var s=e;s||(s={}),t.getRoots(s).then((e=>{var t=e,r=t.infos,s=t.results;if(s&&s.length>0){var l=o._createMapWithSearchResult(s);i({rootsMap:l,indexInfo:r})}else n()})).catch((()=>{n(r.replace(r.errorMessageBookmarkRoot,{typeStruct:l.getSectionRootNls(e.section)}))}))}))},_getExpandedBookmarks:function(e){var o=this;return new Promise((function(i,n){t.expandFolder({level:e.level,section:e.section,multi_root_physicalid:e.multi_root_physicalid,"q.query":e["q.query"],onComplete:function(t){var n=o._createMapWithExpandResult(t,e);i(n)},onFailure:function(e){console.log(e),i({error:e,results:[],roots:[]})}})}))},_createMapWithSearchResult:function(e){var t=this.getMappingforProperties_Search(),o=new Map;return e.forEach((function(e){var i=e.attributes,n={},r=null;i.forEach((function(e){if(t.has(e.name)){var o=t.get(e.name);n[o]=e.value,"id"==o&&(r=e.value),"folderClassification"==o&&("shared"==e.value.toLowerCase()?(n.icon=d,n[o]="Shared"):(n.icon=c,n[o]="Bookmark"))}})),n.hasOwnProperty("folderClassification")||(n.icon=c,n.folderClassification="Bookmark"),n.level=1,o.set(r,n)})),o},_addChildrenInList:function(e,t){t.forEach((t=>{e.push(t),t._children&&(this._addChildrenInList(e,t._children),delete t._children)}))},convertV2Object:function(e,t){var o=this.getMappingforProperties_Expand();let i={};for(let t in e){let n=o.get(t);n&&(i[n]=e[t])}let n=i.folderClassification;return n&&"shared"===n.toLowerCase()?(i.icon=d,i.folderClassification="Shared"):(i.icon=c,i.folderClassification="Bookmark"),i._children=new Set,t&&this.addV2RelOnNodeData(i,t),i},addV2RelOnNodeData:function(e,t){e.RelId=t.resourceid,e.TreeOrder=t["bks.TreeOrder"]&&Array.isArray(t["bks.TreeOrder"])?t["bks.TreeOrder"][0]:t["bks.TreeOrder"]},_createMapWithExpandResult:function(e,t){var o=e.results;let i={},n=new Set,s=t.fromBookmark?0:1,a=t.fromBookmark?2:0,d=0;o.forEach((e=>{if(e.hasOwnProperty("Path")){let t=null;for(let o=0;o<e.Path.length;o+=2){let r=e.Path[o],l=i[r];l&&!l.level&&(l.level=o/2+s,t&&t._children.add(l)),t=l,o===a&&n.add(l)}}else if(e.hasOwnProperty("Path")||e.hasOwnProperty("bks.TreeOrder")){if(e.hasOwnProperty("bks.TreeOrder")){let t=i[e.to];t&&this.addV2RelOnNodeData(t,e)}}else{d++;let t=this.convertV2Object(e);i[e.resourceid]=t}}));let c,u=[];return d>5e3?c=l.buildNls(r,"treeExpandTooLarge",{typeStruct:l.getTreeTypeNls(t.node,!1),subType:l.getSectionSubNls(t.node.section,!1)}):this._addChildrenInList(u,n),{error:c,results:u,roots:n}},getMappingforProperties_Search:function(){return u.search=u.search?u.search:new Map([["physicalid","id"],["ds6w:when/ds6w:created","created"],["ds6w:when/ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:what/ds6w:type","type"],["ds6w:what/ds6w:policy","policy"],["ds6w:who/ds6w:responsible/ds6w:organizationResponsible","organizationResponsible"],["ds6w:who/ds6w:responsible","responsible"],["ds6w:responsibleUid","owner"],["ds6w:what/ds6w:status","status"],["ds6w:where/ds6w:context/ds6w:project","project"],["icon_2ddefaultthb.subtype","folderClassification"],["mxid","mxid"],["ds6wg:revision","revision"]]),u.search},getMappingforProperties_Expand:function(){return u.expand=u.expand?u.expand:new Map([["resourceid","id"],["ds6w:created","created"],["ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:type","type"],["ds6w:policy","policy"],["ds6w:organizationResponsible","organizationResponsible"],["ds6w:responsible","responsible"],["ds6w:responsibleUid","owner"],["ds6w:status","status"],["ds6w:project","project"],["icon_2ddefaultthb.subtype","folderClassification"],["mxid","mxid"],["ds6wg:revision","revision"]]),u.expand},dataConversionToJson:function(e){var t=[];for(let o of e.values()){Array.isArray(o)?o.forEach((function(e){t.push(e)})):t.push(o)}return t}}})),define("DS/FolderEditor/controllers/AuthoringMode",["DS/FolderEditor/controllers/CommonContentMode","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/SettingsHandler","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r,s,l){return e.extend({init:function(e){this._parent(e)},convertData:function(e){return r.convertToExaleadDataFormat(e)},smartFilteringAvailable:function(){return!0},allContentLoadedWithoutFilterTable:function(){return!0},loadContents:function(e){this._parent();var r=this;let a=e.smartFiltering&&this.smartFilteringAvailable();return e.smartFiltering&&(e.smartFiltering.fetchAllAttr=!1),a?this.loadIndexContents(e):new Promise(((a,d)=>{let c=null,u=null;r._contentHandleRequest=new o(((o,a)=>{c=s.isRootSection(e.type)?t.roots(e):t.content(e),u=n.loadLinks([e.pid],{brokenLinks:!0,section:e.section}),Promise.all([c,u]).then((t=>{if(r._contentHandleRequest&&!r._contentHandleRequest.isCancelled()){e.resetScrolling||this.loadFacet(e);let r=t[0],d=t[1];if(i.getCurrentBookmarkId()===e.pid){var n=r.content;if(void 0!==(n=n||r.folders)){r.contents=n;let e=r.contents;d&&d.contents&&(e=[...r.contents,...d.contents]),r.contents=e,o(r)}else a({message:l.replace(l.msg_error_contentnotavailable.title,{typeStruct:s.getTreeTypeNls(e.type)}),className:"error"})}}})).catch(a)})),r._contentHandleRequest.addLinkedQuery(c),r._contentHandleRequest.addLinkedQuery(u),r._contentHandleRequest.then(a).catch(d)}))},getModeType:function(){return"authoring"}})})),define("DS/FolderEditor/views/customize_views/FolderDGVParametrization",["UWA/Class","UWA/Promise","DS/Utilities/Utils","DS/Core/PointerEvents","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/xBookCustoStorageOptim","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/FolderEditor/service/FolderServices","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/service/FolderPreferenceService","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorControl","DS/IPClassifyUtil/IPClassifyUtility","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b){"use strict";const E=["dataIndex","ds6w","pinned","visibleFlag","width"],D={pinned:"unpinned",visibleFlag:!0},w={dataIndex:"ds6w",ds6w:"dataIndex"},I={pinned:{unpinned:""}},F=new Set(["defaultSort"]);function T(e){let t,o=e.UUID_RELATED_VIEW||e.MP_UUID,i=l.getViewByID(o);return t=i&&function(e,t){let o=new Set,i=[];e.forEach((e=>{F.has(e.dataIndex)||e.notInPreference||(o.add(e.dataIndex),i.push(e))}));let n=t.filter((e=>o.has(e.dataIndex)||!e.isAdditionalColumn||e.visibleFlag)).filter((e=>!e.notInPreference)),r=i.length===n.length;return r&&(r=i.every(((e,t)=>{let o=l.getColumn(e.dataIndex||e.ds6w),i=n[t],r="ContextualMenuColumn"===e.dataIndex;return E.every((n=>{if(["defaultSort","favoriteTitle","bookmarkLocation"].includes(e.dataIndex))return!0;let s=void 0!==e[n]?e[n]:D[n]||e[w[n]],l=void 0!==i[n]?i[n]:D[n]||i[w[n]],a=I[n];a&&(s=void 0!==a[s]?a[s]:s,l=void 0!==a[l]?a[l]:l);let d=r&&"width"===n||s===l||o&&o[n]===l;return d||console.log("mismatch field "+n+" at  "+t),d}))}))),r}(i.MP_SELECTED_COLS,e.MP_SELECTED_COLS)?"_defaultView"===e.MP_UUID?e.MP_VERSION:0:e.MP_VERSION?e.MP_VERSION+1:1,e.MP_VERSION=t,l.setLocalView(e),t}function x(e,t){let o=null;if(t.cellModel){let i=this.getColumnOrGroup(t.columnID),n=i?i.dataIndex:null;e.some((e=>{if(e.provideDisplayTooltip){-1!==e.getManagedColumnNames().indexOf(n)&&(o=e.provideDisplayTooltip({...t,dataIndex:n}),null!==o&&"object"!=typeof o&&(o={shortHelp:o,updateModel:!1}))}return!!o}))}return o}function P(e,t,o,i,n){var r=u.isTreeType(o.getType()),s=u.isTreeType(i.getType());let l=!1,a=!1,d=o.hasOwnProperty("isRelationsObjectGroupingNode")&&o.isRelationsObjectGroupingNode,c=i.hasOwnProperty("isRelationsObjectGroupingNode")&&i.isRelationsObjectGroupingNode;if(r&&!s)return-1*this.reverseFactor;if(!r&&s)return 1*this.reverseFactor;if(d&&!c)return-1*this.reverseFactor;if(!d&&c)return 1*this.reverseFactor;var p=0;if("defaultSort"===n){if(!r||!s||u.getSettingParameter("useDefaultRelationOrder")){var h=o.options.relationOrder?o.options.relationOrder:0,g=i.options.relationOrder?i.options.relationOrder:0;p=h-g}if(r&&s&&0!=p){if(l="TRUE"==o.options.grid.isLinkedFolder,a="TRUE"==i.options.grid.isLinkedFolder,!l&&a)return-1;if(l&&!a)return 1;l||a||(e=h,t=g,p=0)}else{let n=function(e,t){let o,i;return o=e.getAttributeValue("label"),i=t.getAttributeValue("label"),o==i&&(o=e.getInternalValue("ds6w:created"),i=t.getInternalValue("ds6w:created")),{value1:o,value2:i}}(o,i);e=n.value1,t=n.value2}}return o&&o.getInternalValue&&o.getInternalValue(n)&&(e=o.getInternalValue(n)),i&&i.getInternalValue&&i.getInternalValue(n)&&(t=i.getInternalValue(n)),0==p?y.compareLabels(e,t):p}return e.extend({buildDGVColumns:async function(e){let o=this,i=await l.getColumnsCompleted(e),{columns:n}=await this.completeColumns(i);if(this.options.displayThumbnails=!1,this.options.additionalColumnsModules){var r=[];let e=UWA.clone(n);for(var s=0;s<this.options.additionalColumnsModules.length;s++)UWA.is(this.options.additionalColumnsModules[s].getAdditionalColumnsUXDGV,"function")&&(this.options.additionalColumnsModules[s].getAdditionalColumnsUXDGV(n),r=r.concat(this.options.additionalColumnsModules[s].getManagedColumnNames()));for(let t=0;t<n.length;t++)e[t]&&e[t].dataIndex===n[t].dataIndex&&(n[t].visibleFlag=e[t].visibleFlag);var d=function(e){for(var t={},o=0;o<e.length;o++){var i=e[o];t[i.dataIndex]=void 0!==i.visibleFlag&&!i.visibleFlag}return t}(n);if(r.length){!function(e,t,o){for(var i=0;i<e.length;i++){var n=e[i];-1!==t.indexOf(n.dataIndex)&&(n.isAdditionalColumn=!0),void 0!==o[n.dataIndex]&&(n.visibleFlag=!o[n.dataIndex])}}(n,r,d),function(e){for(var t=0;t<e.length;t++){var o=e[t],i=o.customisation;i&&i.layout&&o.visibleFlag!==!i.layout.hidden&&(i.layout.hidden=!o.visibleFlag)}}(n);let e={};n.forEach((t=>e[t.dataIndex||t.ds6w]=t)),r.forEach((t=>{let o=e[t];if(o){let e={};e[t]=o,l.addAttributesParams(e)}}))}}return n.push({dataIndex:"defaultSort",visibleFlag:!1,customisation:{exportable:{lock:!0,value:!1},layout:{removable:!1}}}),n.forEach((e=>{var i;"tree"===e.dataIndex&&(e.getCellKPIColor=v.getCellKPIColor.bind(v)),o.options.context&&o.options.context.getCurrentMode()&&(i=o.options.context.getCurrentMode().getModeType()),"favoriteTitle"===e.dataIndex&&"favoriteTitle"!==i&&(e.visibleFlag=!1),"bookmarkLocation"===e.dataIndex&&"search"!==i&&(e.visibleFlag=!1),"thumbnail"===e.dataIndex&&e.visibleFlag&&(o.options.displayThumbnails=!0),e.filterOptions={getCustomFilterSetValues:async function(){async function i(){let t=o.options.context,i=o.options.dgv.treeDocument,n=e.dataIndex||e.ds6w,r=function(e,t){let o=e.getFilterManager().getFilters(),i=null;if(o&&o[t]){let e=o[t].filterOptions;e&&e.filterTags&&(i=e.filterTags.map((e=>{let t=[];return e.sources.forEach((o=>{let i=h.getServiceFromSource(o);i&&t.push(i+"::"+e.object)})),t})).flat(1))}return i}(i,n);if(!r){let o=!0,s=u.isTreeSection(S.getCurrentBookmarkId());(e.isAdditionalColumn||s)&&(o=await t.continueInfiniteScrolling({finalizeScrolling:!0,continueScrolling:s})),o&&e.isAdditionalColumn&&await t.handleUpdateColumnsInChunks({columns:[n],rejectOnCancel:!0});let l=t.getCurrentMode(),a=new Set;if(r=i.getAllDescendants().map((e=>(a.add(e.getID()),e.options.getAttributeValueForFiltering.call(e,n)))),!s&&!l.allContentLoadedWithoutFilterTable()&&e.ds6w){let t=S.getCurrentBookmarkId(),o=S.getCurrentBookmarkSection(),i=await g.listContent_ExpandLevel_1({pid:t,noSizeLimit:!0,predicates:[e.ds6w],relPredicates:[],section:o,synthesis:!1,noContent:!1,onlyContent:!0});i.results&&(i.results.shift(),i.results.forEach((t=>{a.has(t.resourceid)||t.from||t.Path||r.push(p.computeValueForFiltering({service:"3DSpace",internalValue:t[e.ds6w],propertyId:e.ds6w}))})))}}return r}return new t((t=>{e._promiseFilterSet=e._promiseFilterSet||i(),e._promiseFilterSet.then(t).catch((e=>{console.log(e),t([])})).finally((()=>{e._promiseFilterSet=null}))}))},mapPossibleValues:async function(t){let i=t;if(!1!==e.hasNLS){let n=o.options.dgv.treeDocument;if(i=function(e,t,o){let i=e.getFilterManager().getFilters(),n=null;if(i&&i[t]){let e=i[t].filterOptions;if(e&&e.filterTags){let t={};e.filterTags.forEach((e=>{e.sources.forEach((o=>{let i=h.getServiceFromSource(o);i&&(t[i+"::"+e.object]=e.dispValue)}))})),n=o.map((e=>t[e]))}}return n}(n,e.dataIndex||e.ds6w,t),!i){let o=[],n=e.ds6w,r=[];t.forEach((e=>{let t=e.indexOf("::"),i=t<0?"3DSpace":e.substr(0,t),s=t<0?e:e.substr(t+2),l=s;s&&(l={service:i,value:s,key:n},o.push(l)),r.push(l)}));let s=(await a.getPredicatesNlsValues(o))[n];i=t,s&&(i=[],r.forEach((e=>{let t=e.value&&s[e.value]?s[e.value]:"string"==typeof e?e:e.value;i.push(t)})))}}return i}},e.compareFunction=P,e.onCellRequest=function(e){if(!e.isHeader){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut");var t=this.getColumnOrGroup(e.columnID);let i=o.options.dgv.layout.getDisplayedColumnsIndexes();if(i&&i.indexOf(e.columnID)>=0)for(let i=0;i<o.options.additionalColumnsModules.length;++i){let n=o.options.additionalColumnsModules[i];if(n._columnDataIndex&&n._columnDataIndex[0]===t.dataIndex&&n.onCellRequest&&n.onCellRequest(e,{grid:o.options.dgv}))return}t&&"boolean"===t.typeRepresentation&&(e.cellModel="string"==typeof e.cellModel?"TRUE"===e.cellModel:e.cellModel)}if(e.nodeModel){var i=e.nodeModel.options.icons;i&&i.length>0&&"string"==typeof i[0]&&(e.nodeModel.options.icons=[{iconPath:"url("+i[0]+")"}])}this.defaultOnCellRequest(e)}})),n},buildDGVOpts:async function(e){var t=this;e=e||{};let o=l.getView(),i={},n=await this.buildDGVColumns(o.MP_SELECTED_COLS);i.columns=n;var r=UWA.clone(u.getConfigSetting("dgvOptions")),s=r&&r.dgv?r.dgv:{};if(i=UWA.extend(s,i),i.rowDragEnabledFlag=!1,i.selectionBehavior.toggle=!1,i.infiniteScrolling=!0,i.onContextualEvent=t._onContextualEvent.bind(t),i.onDelayedModelDataRequest=t.options.context.updateAttributesDelayed.bind(t.options.context),i.getCellTooltip=t._getCellTooltip.bind(t),t.options.callbacks)for(var a=Object.keys(t.options.callbacks),d=0;d<a.length;d++)i[a[d]]=t.options.callbacks[a[d]];return i},addColumnCB:function(e){var o=this;this.options.dgv.prepareUpdateView();var i=[];e.forEach((function(e){e&&e.convertInfos&&e.convertInfos.dimension&&(e.kind="string"),i.push(new t((function(t){l.addAvailableColumn(e.dataIndex,e).then((function(e){var i=o.buildColumnFromSetting(e);i&&(i.compareFunction=P,o.options.dgv.addColumnOrGroup(i),"thumbnail"===i.dataIndex&&(o.options.displayThumbnails=!0,o.options.dgvLayout.cellHeight=80)),t()}))})))})),t.all(i).then(function(){this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}.bind(this))},removeColumnCB:function(e){var t=this;this.options.dgv.prepareUpdateView(),e.forEach((function(e){var o=UWA.is(e,"string")?JSON.parse(e):e,i=t.options.dgv.getColumnOrGroup(o.dataIndex);i&&void 0!==i.dataIndex&&(t.options.dgv.removeColumnOrGroup(o.dataIndex),"thumbnail"===o.dataIndex&&(t.options.displayThumbnails=!1,t.options.dgvLayout.cellHeight=38,t.options.dgvLayout.columnHeaderHeight=38,"compact"===t.options.viewMode&&(t.options.dgvLayout.cellHeight=26,t.options.dgvLayout.columnHeaderHeight=26)),l.removeAvailableColumn(o.dataIndex))})),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},changeTitleCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(this.options.dgv.prepareUpdateView(),o.text=t,o.customisation.titleModified=!0,this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0))},changeDBAttributeCB:function(e){if(e&&0!=e.length){var t=this;this.options.dgv.prepareUpdateView(),e.forEach((function(e){var o=t.options.dgv.getColumnOrGroup(e.dataIndex);o&&void 0!==o.dataIndex&&(o.attrDBName=e.attrDBName)})),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}},changeVisibilityCB:function(e,t){(this.options.dgvLayout.setColumnVisibleFlag(e,t,{isUserInteraction:!0}),"favoriteTitle"===e||"bookmarkLocation"===e)&&(this.options.dgv.getColumnOrGroup(e).forceHidden=!t);"thumbnail"===e&&(this.options.displayThumbnails=!0,this.options.dgvLayout.cellHeight=80,t||(this.options.displayThumbnails=!1,"comfortable"===this.options.viewMode?(this.options.dgvLayout.cellHeight=38,this.options.dgvLayout.columnHeaderHeight=38):"compact"===this.options.viewMode&&(this.options.dgvLayout.cellHeight=26,this.options.dgvLayout.columnHeaderHeight=26)))},changePinCB:function(e,t){this.options.dgvLayout.setColumnPinned(e,t,{isUserInteraction:!0})},moveColumnCB:function(e){if(e.move2perform){let t=e.move2perform.fromIndex?e.move2perform.fromIndex:e.move2perform.fromID,o=e.move2perform.toIndex?e.move2perform.toIndex:e.move2perform.toID;this.options.dgvLayout.moveColumn(t,o,{isUserInteraction:!0})}},changeDgvLayout:function(e){void 0!==typeof e.rowsHeader&&(this.options.dgvLayout.rowsHeader=e.rowsHeader)},changeExportCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(o.customisation.exportable={lock:!1,value:t})},compactMode:function(e){this.options.displayThumbnails?this.options.dgvLayout.cellHeight=80:"comfortable"===e.viewMode?(this.options.dgvLayout||(this.options.dgvLayout={}),this.options.dgvLayout.cellHeight=38,this.options.dgvLayout.columnHeaderHeight=38,this.options.viewMode="comfortable"):"compact"===e.viewMode&&(this.options.dgvLayout||(this.options.dgvLayout={}),this.options.dgvLayout.cellHeight=26,this.options.dgvLayout.columnHeaderHeight=26,this.options.viewMode="compact")},checkLocalviewIteration:function(){T(l.getLocalView())},saveCustoView:o.debounce((function(){this._prepareOptsToStore({onComplete:function(e){const t=UWA.clone(l.getView());t.MP_SELECTED_COLS=e.columnsOptimized;let o=T(t);l.setCurrentView("localView"),r.publish({event:"onCustoViewChange",data:{...e,MP_VERSION:o}})}})}),100),reset:function(e){return new t(function(t){var o=this;delete o.options.view_customization,this.buildDGVOpts({reset:!0}).then((function(i){var n=u.getConfigSetting?u.getConfigSetting("dgvOptions"):{};o.options.dgv.prepareUpdateView(),n.dgvLayout&&(o.options.dgvLayout.cellHeight=n.dgvLayout.cellHeight,o.options.dgvLayout.columnHeaderHeight=n.dgvLayout.cellHeight,o.options.dgvLayout.rowsHeader=n.dgvLayout.rowsHeader),o.ctxColOpts&&(o.changePinCB(o.ctxColOpts.dataIndex,"right"),i.columns.push(o.ctxColOpts),o.ctxColOpts.visibleFlag=!0),o.options.dgvLayout.deleteDataGridViewPreferences(),o.options.dgv.columns=i.columns,o.options.viewMode=n.viewMode,r.publish({event:"update_view_mode",data:{viewMode:o.options.viewMode}}),o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0),o.options.dgvLayout.applyColumns(),o.saveCustoView(e),t()}))}.bind(this))},_onContextualEvent:function(e){return e&&null==e.context&&(e.context={treeDocument:this.options.dgv.treeDocument}),new t((function(t){c.getCtxMenu(e).then((function(e){t(e)}))}))},_getCellTooltip:function(e){let t=null;if(this.options.additionalColumnsModules&&(t=x.call(this.options.dgv,this.options.additionalColumnsModules,e)),!t){let o=this.options.dgv.layout.getColumnGetCellTooltip(e.columnID);o&&(t=o(e))}return t||(t=this.options.dgv.getCellDefaultTooltip(e)),t},isDisabledForLock:function(e){return e.nodeModel?"Workspace"===e.nodeModel.getAttributeValue("type")||"Workspace Vault"===e.nodeModel.getAttributeValue("type")||"Document"===e.nodeModel.getAttributeValue("type")||"wwwLink"===e.nodeModel.getAttributeValue("type")||void 0!==e.nodeModel.options.checkout||1==widget.readOnly||u.isExternalObject(e.nodeModel):-1===e.rowID},eventHandlerOnGridView:function(e){var o=this;return new t((function(t){e.addEventListener("click",(function(e,t){if(void 0!==t&&-1!==t.rowID){var i=e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID);if(!o.options.clickEvent[i]||e.shiftKey||e.ctrlKey){if(o.options.additionalColumnsModules&&!0===e.dsModel.layout.getColumnOptionValue(t.columnID,"isAdditionalColumn"))for(var n=0;n<o.options.additionalColumnsModules.length;n++){if(o.options.additionalColumnsModules[n].getOnCellClickCB){var r=o.options.additionalColumnsModules[n].getOnCellClickCB(i,e);if(r){r(t);break}}}}else{if(o.options.dgv.getNodesXSO().get().length>1)o.options.clickEvent[i](t),e.stopPropagation();else{if("ds6w:reserved"===i&&o.isDisabledForLock(t))return;o.options.clickEvent[i](t)}}}})),e.addEventListener("userPreferencesChange",(function(e){o.saveCustoView(!0)})),e.addEventListener("columnWidthChange",(function(e){if(e&&e.dsModel&&e.dsModel.layout&&o.options&&o.options.dgv&&o.options.dgv.layout&&o.options.dgv.model){let t=e.dsModel.layout.getDataIndexFromColumnIndex(e.options.columnID),i=o.options.dgv.layout.getDisplayedColumnsIndexes();if(i&&i.indexOf(e.options.columnID)>=0)for(let i=0;i<o.options.additionalColumnsModules.length;++i){let n=o.options.additionalColumnsModules[i];if(n._columnDataIndex&&n._columnDataIndex[0]===t&&n.updateAttributesOnResize){let t=o.options.dgv.layout.getMinMaxVisibleRowIDs(),i=t.minRowID,r=t.maxRowID,s=[];s=r>=0?o.options.dgv.model.slice(i,r+1):o.options.dgv.model.slice(i,r),s.length>0&&n.updateAttributesOnResize(s,e.options.columnID,{grid:o.options.dgv});break}}}})),e.addEventListener(i.POINTERHIT,(function(e,t){if(2===e.multipleHitCount&&t&&-1!==t.rowID){var o=t.nodeModel;if(o)if(o.isFavorite&&o.toRemove){var i=function(e){e&&require(["DS/FolderEditor/utils/FavoritesUtil"],(function(e){e.removeFavorites({id:o.options.resourceid,name:o.options.favoriteTitle},S.getCurrentBookmarkSection())}))};require(["DS/FolderEditor/popup/RemoveFromFavoritesPopup"],(function(e){new e({callback:i,favorite:o})}))}else c.activateFolderEditorItem(o);require(["DS/IPClassifyUtil/IPClassifyCommunication","DS/IPClassifyUtil/IPSettingsMgr"],(function(e,t){if(t.isWebInWin()){var i={id:o.getID(),label:o.getLabel(),type:o.options.type,cadMaster:o.options.grid["ds6w:cadMaster"],kind:o.options.grid["ds6w:kind"],contentStructure:o.options.grid["ds6w:contentStructure"]};e.publish("doubleClickonContentInBookmark",i)}}))}})),t(e)}))},_prepareOptsToStore:function(e){var t=this,i=o.debounce((function(e){for(var o=t.options.dgvLayout.getOrderedColumnsIndexes(),i=[],n=[],r={},l=0;l<o.length;l++){var a=t.options.dgv.getColumnOrGroup(o[l]);let e=null;"defaultSort"===a.dataIndex?n.push(a):"ContextualMenuColumn"!==a.dataIndex?(e=a,a.customisation&&!0===a.customisation.titleModified&&(r[a.dataIndex]=!0)):t.ctxColOpts&&(t.ctxColOpts.visibleFlag=a.visibleFlag,t.ctxColOpts.pinned=a.pinned,e=t.ctxColOpts),e&&i.push(e)}var d={viewMode:t.options.viewMode,defaultCellHeight:t.options.dgvLayout.cellHeight,defaultcolumnHeaderHeight:t.options.dgvLayout.columnHeaderHeight,rowsHeader:t.options.dgvLayout.rowsHeader,columns:i,sortModel:t.options.dgv.sortModel},c=s.convertCusto4Preference(d,r,"datagridview");n.forEach((e=>i.push(e))),t.options.dgv.columns=i,e.onComplete(c)}),500);i(e)}})})),define("DS/FolderEditor/views/FolderDataGridView",["UWA/Core","UWA/Promise","UWA/Class","UWA/Class/Options","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/views/customize_views/FolderDGVParametrization","DS/FolderEditor/service/FolderPreferenceService","DS/FolderEditor/views/customize_views/_FolderDGVUtils","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/FolderEditorUtil","DS/CollectionView/commands/CollectionViewCommands","DS/Controls/Button","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/views/additionalColumns/BookmarkLocationColumn","DS/FolderEditor/views/FolderMode","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/DimensionUtils","DS/ClassificationUtil/ClassificationUtil","DS/FolderEditor/utils/SettingsHandler","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F,T,x){"use strict";var P=null;function A(e,{forSearch:t}){let o=C.getView();if(o){let i={};o.MP_SELECTED_COLS.forEach((e=>{let o=C.getColumn(e.dataIndex||e.ds6w),n=o&&(o.dataIndex||o.ds6w);if(n&&!o.noFilter&&(!o.isAdditionalColumn||o.filterId&&!t)){let e=o.isAdditionalColumn?null:t?"stringStdexp":"string";switch(o.kind){case"dateTime":e="dateWithCondition";break;case"real":case"number":case"integer":e=t?"numberWithCondition":"number"}let r=o.filterId?o.filterId:e;t&&"set"===r||(i["tree"!==n?n:"label"]={filterId:r,filterOptions:{keepChildren:!0}})}})),e.setFilterModel(i)}}return o.extend(i,l,d,{name:"FolderTreeListView",defaultOptions:{renderTo:null,context:null,modelEvents:null,subscribeTokens:[],dgv:null,dgvLayout:null,viewMode:"",clickEvent:{"ds6w:reserved":function(e){this.returnCommand(e,"ds6w:reserved")},"ds6w:status":function(e){this.returnCommand(e,"ds6w:status")},"ds6w:responsible":function(e){this.returnCommand(e,"ds6w:responsible")},returnCommand:function(e,t){if(e.nodeModel){let o=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),o=250),setTimeout((()=>{var o;if("ds6w:reserved"==t){let t=e.nodeModel.getInternalValue("ds6w:reserved");o="ActionBar_ReserveCmd",!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(o="ActionBar_UnreserveCmd")}else"ds6w:status"==t?o="MaturityHdr":"ds6w:responsible"==t&&(o="ActionBar_TransferOwnership");var i=T.getCommandByContext(o);i&&i.isEnabled()?i.begin():_.displayNotification({...x.unsupported_command_error,className:"error"})}),o)}}},doubleClickEvent:{}},init:function(e){this._parent(e),this.setOptions(e),this._promiseInitView=a.initializePreferences(),S.subscribe({event:"rename_label"},(({isTree:e,cellInfos:t})=>{if(!e){let e="tree";if(t.nodeModel.isFavorite){var o=this.options.dgv.layout.getColumnIndex("tree");t.columnID!==o&&(e="favoriteTitle")}p.RenameCmd(t,this.options.dgv,e)}})),S.subscribe({event:"updateColumnVisibility"},(e=>{let t=e.columnName,o=e.visibility;var i=this.options.dgv.getColumnOrGroup(t);i&&(i.visibleFlag=o,"bookmarkLocation"!==t&&"favoriteTitle"!==t||(i.customisation.layout.removableFromView=o,i.forceHidden&&(i.visibleFlag=!1)))})),S.subscribe({event:"update_view_mode"},(e=>{this.compactMode(e)}))},initialize:async function(){var o=this;await this._promiseInitView,this.checkLocalviewIteration(),await new t((i=>{var l=e.clone(F.getConfigSetting("dgvOptions"));o.options.viewMode=C.getViewMode()?C.getViewMode():l.viewMode;var a=u.getPlaceholder(),d=o.buildDGVOpts();t.all([a,d]).then((t=>{var a=t[1],d=t[0],u=!1!==o.options.context.options.settings.view_settings.sortPersistence;u||(a.sortModel=[{dataIndex:"defaultSort",sort:"asc"}]);var p=e.extend({_identifier:"DataGridView-"+o.name+"-"+widget.id},a);if("undefined"!==l.dgvLayout){var g=e.clone(l.dgvLayout);void 0!==a.defaultCellHeight&&(g.cellHeight=a.defaultCellHeight,a.defaultCellHeight<80&&(g.columnHeaderHeight=a.defaultCellHeight),delete a.defaultCellHeight),!window.__karma__&&navigator.webdriver&&(a.rowsHeader=!0),C.getRowsHeader()?g.rowsHeader=C.getRowsHeader():void 0!==a.rowsHeader&&(g.rowsHeader=a.rowsHeader),a.columns.forEach((function(e){e.minWidth=50})),p.layout=o.options.dgvLayout=new r(g),p.layout.useLastColumnWidthAutoFlag=!0}p.placeholder=d.getContent();var m=null;let v=null;p.columns.forEach((function(e,t){"ContextualMenuColumn"===e.dataIndex&&(m=t,v=e)})),v&&p.columns.splice(m,1),p.editOnKeyPressFlag=!1,p.showContextualMenuColumnFlag=!0,p.useAsyncPreExpand=!0,p.rowSelection=o.options.multiselection?"multiple":"single",p.selectionBehavior.unselectAllOnEscapeKey=!0,o.options.viewMode=o.options.viewMode?o.options.viewMode:"comfortable",S.publish({event:"update_view_mode",data:{viewMode:o.options.viewMode}});var y=o.options.dgv=new n(p);if(o.options.additionalColumnsModules)for(var w=0;w<o.options.additionalColumnsModules.length;w++){if(o.options.additionalColumnsModules[w]&&"function"==typeof o.options.additionalColumnsModules[w].__updateHeaderNLS){const e=o.options.additionalColumnsModules[w];I.classificationAttributesPromise({apiVersion:"R2019x"}).then((t=>{e.__updateHeaderNLS(y,t)}))}if(o.options.additionalColumnsModules[w].getTypeRepresentations){var F=o.options.additionalColumnsModules[w].getTypeRepresentations();y.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(F))}}if(y.selectNextCellOnEnterFlag=!1,y.setUseClipboardFlag(!1),y.onEndResizeOrOnReadyModelRequest((function(e){e.RowMaxNumber>=c.getNumberResults()&&e.RowMaxNumber>=y.getModelLength()&&(e.reachBottom=!0,S.publish({event:"processContentScroll",data:{options:e,grid:y}})),y.EndResizeOrOnReadyModelRequestDone()})),o.ctxColOpts=y.getColumnOrGroup("ContextualMenuColumn"),o.ctxColOpts){if(o.options.dgv.prepareUpdateView(),v){o.ctxColOpts.visibleFlag=v.visibleFlag,o.ctxColOpts.pinned=v.pinned;let e=y.columns[m],t=e&&e.pinned?e.pinned:"unpinned",i=o.ctxColOpts.pinned?o.ctxColOpts.pinned:"unpinned";e&&i===t&&o.options.dgvLayout.moveColumn("ContextualMenuColumn",e.dataIndex)}o.ctxColOpts.customisation={exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!0}},o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0)}var T=f.getContentSortmodel();a.sortModel=!u||a.sortModel?a.sortModel:T,a.sortModel&&(o.options.dgv.prepareUpdateView(),o.options.dgv.sortModel=a.sortModel,o.options.dgv.layout.saveColumnSortModelInPreferences(),o.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)),y.onCopy=h.launchKeyAction.bind(h,"ctrl+c"),y.onCut=h.launchKeyAction.bind(h,"ctrl+x"),y.onPaste=h.launchKeyAction.bind(h,"ctrl+v");["esc","del","ctrl+f","alt+return","f2"].forEach((function(e){y._keymapManager.registerKeymap(e,void 0)})),y.addEventListener("sortModelChange",(function(){if(y.sortModel&&y.sortModel.length>1&&"defaultSort"==y.sortModel[0].dataIndex){let e=[...y.sortModel];return e.shift(),void(y.sortModel=e)}0==y.sortModel.length&&(y.sortModel=[{sort:"asc",dataIndex:"defaultSort"}]);let e=o.options.context;if(!e.refreshViewIfNeeded()&&(c.isSearchActive()||"read"==E.getCurrentModeType())){let t=e.getCurrentMode();t.isInfiniteScrollingEnded()||(t.resetInfoIndex(),e.loadContentAndSelect())}})),y.onInfiniteScroll((function(e){S.publish({event:"processContentScroll",data:{options:e,grid:y}})})),o.eventHandlerOnGridView(y).then((function(){y.getContent().addClassName(o.name),o.options.renderTo&&!0===o.options.isActiveView&&y.inject(o.options.renderTo),i()})),S.getModelEvents().subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},(function(t){switch(t.what){case"addRemoveColumns":t.removedColumns&&t.removedColumns.length>0&&o.removeColumn(t.removedColumns),t.addedColumns&&t.addedColumns.length>0&&o.addColumn(e.clone(f.filterDBOnlyAttrs(t.addedColumns)));break;case"reset":o.resetColumn()}})),S.getModelEvents().subscribe({event:"nodeColorUpdated"},(function(){y.invalidateLayout({updateCellContent:!0,updateCellLayout:!0})})),y.registerReusableCellContent(b.getCellReusableContent(y)),S.subscribe({event:"reapply_content_sort"},(e=>{let t=(e=e||{}).sortModel,o=e.nodeToScroll,i=y.sortModel,n=!!t;if(t||i&&0!==i.length||(n=!0,t=[{sort:"asc",dataIndex:"tree"}]),n?y.sortModel=t:y.reapplySortModel(),o){var r=y.layout.getCellsFromNodeModel(o)[0];y.scrollToCellAt({cellID:r})}})),S.subscribe({event:"update_column_visibility"},(({dataIndex:e,visible:t})=>{this.changeVisibilityCB(e,t)})),S.subscribe({event:"escape_action"},(e=>{this.escape()})),S.subscribe({event:"saveViewInWidget"},(()=>{this.saveCustoView(!0)})),S.subscribe({event:"clear_filter_table"},(()=>{let e=this._currentModel&&this._currentModel.getFilterManager();if(e)for(let t in e.getFilters()){let o=e.getFilters()[t];o.filterOptions.refreshOnFilter=!1,o.reset()}})),S.subscribe({event:"set_search_table_filter"},(({enable:e})=>{A(this._currentModel,{forSearch:e})})),S.subscribe({event:"update_filter_with_tags"},(()=>{let e=s.getAllTags(),t=e?e.facets:null;!function(e,t){if(t){let o={},i=C.getView();i&&i.MP_SELECTED_COLS.forEach((e=>{let t=C.getColumn(e.dataIndex||e.ds6w);t&&"set"===t.filterId&&(o[e.ds6w||e.dataIndex]=e)}));let n={};t.forEach((e=>{let t=e.sixw;if(t){let i=t.lastIndexOf("/"),r=i<0?t:t.substring(i+1),s=n[r];!s&&o[r]&&(s=n[r]=[]),s&&s.push(e)}}));let r=e.getFilterManager();for(let e in n){let t=o[e],i=t.dataIndex||t.ds6w;r.setPropertyFilterModel("tree"!==i?i:"label",{filterId:"set",filterOptions:{filterTags:n[e],keepChildren:!0,refreshOnFilter:!1}})}}}(this._currentModel,t)})),S.subscribe({event:"switch_view"},(async({viewId:e})=>{if(C.isViewExist(e)){C.setCurrentView(e);let t=C.getView(),o=await this.buildDGVColumns(t.MP_SELECTED_COLS);y.columns=o,S.publish({event:"column_updated"}),A(this._currentModel,{}),c.setPredicates(C.getAvailableColumnsOpts()),S.publish({event:"update_view_mode",data:{viewMode:C.getViewMode()}}),"FolderSection_favorite"===D.getCurrentBookmarkId()?S.publish({event:"updateColumnVisibility",data:{visibility:!0,columnName:"favoriteTitle"}}):c.isSearchActive()&&S.publish({event:"updateColumnVisibility",data:{visibility:!0,columnName:"bookmarkLocation"}}),S.publish({event:"saveViewInWidget"})}else _.displayNotification({...x.switchViewImpossible,className:"success"})}))}))}))},displaySaveViewNotification:function(){window._saveCurrentView=function(){S.publish({event:"saveViewInWidget"})};let t=e.createElement("a",{styles:{cursor:"pointer"},text:x.requestSaveView.link,onmouseup:"window._saveCurrentView()"});_.displayNotification({...x.requestSaveView,messageHtml:t,className:"info"})},escape:function(){this.options.dgv.commands.escape.bind(this.options.dgv)()},getManager:function(){return this.options.dgv},addColumn:function(e){e.length>0&&(P=null,c.addPredicates(e),y.notifyCurrentFolderColumnChange())},removeColumn:function(e){c.removePredicates(e)},resetColumn:function(){c.setPredicates(C.getAvailableColumnsOpts()),y.notifyCurrentFolderColumnChange()},setModel:function(e){this.options.dgv.getContent().inject(this.options.renderTo),this.options.isActiveView=!0,this._currentModel=e,this.options.dgv.treeDocument=e;let t=e.getFilterManager().getFilters();t&&0!==Object.keys(t).length||A(this._currentModel,{})},unsetModel:function(){this.options.isActiveView&&(this.options.dgv.getContent().parentElement===this.options.renderTo&&this.options.renderTo.removeChild(this.options.dgv.getContent()),this.options.isActiveView=!1,this.options.dgv.treeDocument=null)},isColumnHidden:function(e){return!this.options.dgv.layout.getColumnVisibleState(e)},showColumn:function(e){this.changeVisibilityCB(e,!0)},hideColumn:function(e){this.changeVisibilityCB(e,!1)},changeColumnTitle:function(e,t){this.changeTitleCB(e,t)},getRowHeight:function(){var e=0,t=this.options.dgv;return t&&t.layout&&t.layout.getRowHeight&&(e=t.layout.getRowHeight()),e},scrollToVisibleNode:function(e){var t=this.options.dgv,o=t.layout.getColumnIndex("tree"),i=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:i})},getColumnsUnitNls:function(){let e=P;if(!e){e={};var t=this.options.dgv;let i=null;if(t&&t.layout&&t.layout.getLeafColumns){let n=t.layout.getLeafColumns();for(var o=0;o<n.length;++o){let t=null;n[o].convertInfos&&(t=n[o].convertInfos.nls),n[o].convertInfos&&n[o].convertInfos.manipulationUnit&&n[o].convertInfos.manipulationUnit!==n[o].convertInfos.unit&&(i=n[o].convertInfos.manipulationNls,t=null),e[n[o].dataIndex]={unit:t,convertUnit:i||t}}}}return e},enrichSearchValue:function(e){var o=this.options.dgv;if(!e||!o||!o.layout||"function"!=typeof o.layout.getLeafColumns)return t.resolve(e);for(var i,n=o.layout.getLeafColumns(),r=/(\[[^\]]+\]|[^\s:]+):(\d+(\.\d+)?)/g,s=[];null!==(i=r.exec(e));)s.push({full:i[0],key:i[1],val:i[2]});if(0===s.length)return t.resolve(e);var l=s.map((function(e){return new t((function(t){for(var o="["===e.key.charAt(0)&&"]"===e.key.charAt(e.key.length-1)?e.key.slice(1,-1):e.key,i=e.key,r=null,s=0;s<n.length;s++){var l=n[s];if(-1!==[l.text,l.ds6w].indexOf(o)){i="["+l.dataIndex+"]";var a=l.convertInfos;a&&a.manipulationUnit&&a.manipulationUnit!==a.unit&&(r={Data:[{Dimension:a.dimension,UnitFrom:a.manipulationUnit,UnitTo:a.unit,Values:e.val}]});break}}r?w.convertToPreferdUnits(r).then((function(o){var n=o&&o[0]&&o[0].ConvertedValues||e.val;t({original:e.full,replaced:i+":"+n})})):t({original:e.full,replaced:i+":"+e.val})}))}));return t.all(l).then((function(t){for(var o=e,i=0;i<t.length;i++)o=o.replace(t[i].original,t[i].replaced);return o}))}})})),define("DS/FolderEditor/controllers/SearchMode",["DS/FolderEditor/controllers/CommonMode","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/tagger/TaggerIPProxy","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/FolderEditor/utils/FolderEditorDataConversion","DS/FolderEditor/utils/SettingsHandler","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/IPClassifyUXUtil/ProgressPaneExecution","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyAlert"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C){return e.extend({supportClientSort:!1,_cancelIt:function(){this._taggerHandleRequest&&(this._taggerHandleRequest.cancel(),this._taggerHandleRequest=null),this._contentHandleRequest&&(this._contentHandleRequest.cancel(),this._contentHandleRequest=null)},init:function(e){this._parent(e),this.tempSearchData=new Map,this.objectsToSendForLoad=[],c.onSearchChange((async e=>{this.objectsToSendForLoad=[],this.tempSearchData.clear(),c.setInitialSearchData(),!c.isSearchActive()&&e||this._cancelIt();let o=this.options.contentView;o&&(e||o._currentMode===this)&&(e&&e.trim().length<3?C.displayNotification({message:S.replace(S.SearchEnterMoreThan,{minNumber:3}),className:"warning"}):(t.publish({event:"clear_filter_table"}),o.switchMode(c.isSearchActive()?"search":null,!0))),n.updateCommands()}))},enable:function(){h.setUpdateMode(!1),t.publish({event:"switch_search"}),t.publish({event:"set_search_table_filter",data:{enable:!0}}),t.publish({event:"updateColumnVisibility",data:{visibility:!0,columnName:"bookmarkLocation"}}),t.publish({event:"clear_filter_table"});var e=this.options.contentView.getActiveView();c.setPreviousView(e),t.publish({event:"toolbar_update_command",data:{commandID:"display",data:{disabled:!0,grid:{data:"datagridview"}}}})},disable:function(){h.setUpdateMode(!0),this._parent(),t.getModelEvents().publish({event:"search_cleared"}),t.publish({event:"set_search_table_filter",data:{enable:!1}}),this._cancelIt(),t.publish({event:"updateColumnVisibility",data:{visibility:!1,columnName:"bookmarkLocation"}});var e=c.getPreviousView();if(e){t.publish({event:"toolbar_update_command",data:{commandID:"display",data:{disabled:!1,grid:{data:e}}}});var o=n.getCommand(e);o&&o.begin(),c.setPreviousView(null)}},withInfiniteScrolling:function(){return!0},convertData:function(e){let t=i.convertToExaleadDataFormat(e);return t.isSearchWithinData=!0,t},manageError:function(e){if(c.isSearchActive()&&e&&"object"==typeof e&&e.error&&e.error.errorCode)return e.error.errorMessage},wasScrollingReset:function(){return c.wasScrollingReset()},resetInfoIndexForRoot:function(){h.clearTags(),this.objectsToSendForLoad=[],this.tempSearchData.clear(),c.setInitialSearchData()},resetInfoIndex:function(e){c.searchingInRoot&&this.resetInfoIndexForRoot(),c.resetInfoIndex(e)},loadContents:function(e){this._parent();var t=this,o=c.getSearchValue().trim();e.searchQuery=o;let i=!1,n=this.options.contentView;if(n){let r=n.getPADTreeListView();if(r)return i=!0,new Promise((function(i,n){r.enrichSearchValue(o).then((function(o){e.searchQuery=o,t._loadContents(e).then((function(e){i(e)}),(function(e){n(e)})).catch(n)})).catch(n)}))}if(!i)return t._loadContents(e)},getInfoIndex:function(){return c.getInfoIndex()},sortDataToLoadOnGrid:(e,t)=>{let o,i;for(let t of e)if("ds6w:label"==t.name){o=t.value;break}for(let e of t)if("ds6w:label"==e.name){i=e.value;break}return o>i?1:-1},setTempSearchData:function(e){let t,o=[];return e.forEach((e=>{if(e.attributes){for(let i of e.attributes)if("resourceid"==i.name){t=i.value,0!=this.tempSearchData.size&&this.tempSearchData.get(t)||(this.tempSearchData.set(t,t),o.push(e));break}}else t=e.id,0!=this.tempSearchData.size&&this.tempSearchData.get(t)||(this.tempSearchData.set(t,t),o.push(e))})),o},batchWiseSearchQuery:function(e,t,i,n,s){let l,u,p,g,f,v=this;return new o((function(_,y){if(Array.isArray(e)&&(t.pid=e),g=!c.getInfoIndex(),t.searchingInRoot){if(f=0==c.batchInfoIndex.size,p=c.getBatchInfoIndex(i),p||(t.isFirstSearch=!0,g=!0),p){if(!(c.getNextStartNum(p)>0))return void _({contents:[],inProgress:!0,sorted:!1,searchingInRoot:t.searchingInRoot});t.next_start=p.next_start,t.isFirstSearch=!1}}else l=!t.resetScrolling&&!c.getInfoIndex();let b;l||t.searchingInRoot&&!p?(e="string"==typeof e?[e]:e,b=d.loadLinks(e,{section:t.section,expandAll:!0,searchQuery:t.searchQuery,filters:h.getFilterTags()})):b=Promise.resolve();let E=a.searchInFolder({...t,with_synthesis:t.searchingInRoot});o.all([E,b]).addLinkTo(this).then((async e=>{let o=e[0],l=e.length>1?e[1]:null;if(!l||!l.infos){let e=v.options.contentView.getPADTreeListView().getManager(),t=e.treeDocument?e.treeDocument.getRoots().filter((e=>!e.isFiltered()&&e.getAttributeValue("links"))).length:0;l={infos:{nhits:t,nmatches:t}}}l&&l.infos&&(o.infos.linkInfo=l.infos);var a=o.infos,d=c.isSearchInProgress();t.searchQuery&&t.searchingInRoot?c.setBatchInfoIndex(i,a,t.isFirstSearch):c.setInfoIndex(a);var p=r.getCurrentBookmarkId();if(p===t.pid||m.isRootSection(p)){const e=o.results?o.results:[];let i=l&&l.contents&&l.contents.length>0;i&&e.push(...l.contents);let r=await n,a={};r&&(a[r.getID()]=r),c.setRootBookmarks(s||a),u=t.searchingInRoot?v.setTempSearchData(e):e;var h={facets:o.facets,contents:u,inProgress:d,sorted:!i,searchingInRoot:t.searchingInRoot};_(h)}})).catch((e=>{let t;if(console.log(e),"string"==typeof e.serverErr)t=e.serverErr;else if("string"==typeof e.serverErr.error)t=e.serverErr.error;else if(e.serverErr.error.errorCode)switch(e.serverErr.error.errorCode){case"FS_INVALID_QUERY__NO_QUERY":t=S.replace(S.SearchEnterMoreThan,{minNumber:3});break;case"FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__EMPTY_QUOTE":t=S.SearchEmptyQuotes}t=t?{message:t}:S.searchDefaultError,C.displayNotification({...t,className:"warning"}),y()}))}))},allContentLoadedWithoutFilterTable:function(){return this._allContentLoaded},_loadContents:function(e){e.filters=h.getFilterTags();let t=h.getTableFilter();e.tableFilter=t,this.cancelQuery();var i=Promise.resolve();let n=null,r=null,s=this.options.contentView.getPADTreeListView(),a=s?s.getManager().sortModel:null;a&&a.length>0&&(n=a[0].dataIndex,"tree"===n?n="ds6w:label":"defaultSort"===n&&(n="ds6w:modified"),r=a[0].sort,e.order_field=n,e.order_by=r),m.isRootSection(e.pid)&&(i=new Promise(((t,o)=>{l.allBookmarks({section:e.section,select_predicate:["physicalid","label","type"],filters:g.getFilterTags()}).then((e=>{t(f.getObjectIdsFromSearchRes(e.results))})).catch(o)})));let u=!c.getInfoIndex(),C=new o(((o,n)=>{i.then((i=>{let r=Promise.resolve();i||(r=d.getBookmarkInfo(e.pid)),i?e.pid=ids=Object.keys(i):ids=[e.pid];let s=0;const l=[];if("object"==typeof e.pid&&m.isRootSection(e.type)){for(;e.pid.length>0;)l.push(e.pid.splice(0,100));e.searchingInRoot=!0,c.searchingInRoot=!0}else l.push(e.pid);0==l.length&&l.push(e),v.removeComponentToLoad("contentView","content"),this._contentHandleRequest=_.execute({title:S.replace(S.searchLoading,{typeStruct:m.getTreeTypeNls(e.type,!1)}),isSearchquery:!0,datas:l,query:t=>this.batchWiseSearchQuery(t,e,++s,r,i),loaderInfo:{scope:"global",withPercent:!0,nls:{SearchLoader:S.searching}}}).then((e=>{let i,n=[],r=null,s=null,l={facets:null};i=e[0]?e[0].searchingInRoot:null,e.forEach((e=>{e&&(l.facets?p.IPConcatFacets(l,e,{withoutTranslation:!0}):l.facets=e.facets,n.push(...e.contents),r=e.inProgress,s=e.sorted)})),u&&(this._firstPageWithoutTableFilter=!t||(()=>{for(let e in t){if(t[e].filterModel)return!1}return!0})()),i&&(c.setSearchCallResult(n,u),c.setInfoIndex(c.getCountForBreadCrumb(n)),c.setCountToLoadOnGrid(),c.setScrollEndStatus()),this._firstPageWithoutTableFilter&&(this._allContentLoaded=this.isInfiniteScrollingEnded());var a={facets:l.facets,contents:n,inProgress:r,sorted:s};o(a)})).catch(n),!u||e.resetScrolling||e.searchingInRoot||this.loadFacet(e)})).catch(n)}));return u&&(this._currentFirstContentPromise=C),C},loadFacets:async function(e){this._taggerHandleRequest=e.searchingInRoot&&this._currentFirstContentPromise?this._currentFirstContentPromise:a.searchInFolder({pid:e.pid,section:e.section,type:e.type,searchQuery:e.searchQuery,synthesis:!0,filters:e.filters});let t=await this._taggerHandleRequest;return await this._currentFirstContentPromise,{...t,updateTableFilter:!0}},onSetPathTags:function(e){this.unColorizeChildren(e)},getNbRemainingObjects:function(e){return c.getNumberHits()-e.getRoots(!0).filter((e=>!e.links&&(e.isVisible()||!0===e.isFilteredForScroll()))).length},onFilterFilteringEvent:function(){},onInfiniteScrollAsync:function(){var e=c.getNumberLastResult();c.getSearchValue()&&e>0&&this.options.contentView.loadContentAndSelect()},unColorizeChildren:function(e){e.options.model.withTransactionUpdate((function(){e.options.model.getRoots().forEach((function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach((function(e){delete e.options.color,e.updateOptions(t)}))}))}))},getNumberLastResult:function(){return c.getNumberLastResult()},getModeType:function(){return"search"}})})),define("DS/FolderEditor/FolderComponent",["UWA/Core","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/FolderXNavComponent","DS/FolderEditor/models/xBookNodeModel","DS/TreeModel/TreeNodeModel","DS/FolderEditor/views/FolderGlobalActiveBookmark","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderServices","DS/FolderEditor/commands/FolderCommands","DS/IPClassifyUtil/IPSettingsMgr","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/BkAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","i18n!DS/SNResultUX/assets/nls/SNResultUX","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderSearch","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/UIInfra/UIInfra","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","DS/FolderEditor/controllers/AuthoringMode","DS/FolderEditor/controllers/SearchMode","DS/FolderEditor/controllers/FavoritesMode","DS/FolderEditor/controllers/ReadMode","DS/PADServices/utils/PlatformURL","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyCommunication","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/FolderEditor/views/FolderMode","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/Utilities/Utils","DS/FolderEditor/plugins/PluginsManager","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/FolderEditor/plugins/product/PrdPlugin"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F,T,x,P,A,k,N,M,U,O,R,L,B,V,W,j,H){function X(){let e=null;return this.getPADTreeListView()&&(e=this.getPADTreeListView().options.dgv.sortModel),e}function q(){let e=null,t=X.call(this);return t&&t.length>0&&(e={sort:t[0].sort,dataIndex:"tree"===t[0].dataIndex||"defaultSort"===t[0].dataIndex?"ds6w:label":t[0].dataIndex}),e}var z=function(){var e=h.getCurrentBookmarkId(),t=void 0,o=void 0;if(e){var i=h.getX3DContentId();if(i)e===h.getX3DBookmarkId()&&(t=[i],o={copylink:!0,cmdToLaunch:h.getX3DCmdToLaunch()},h.clearX3DContentItem())}return{selection:t,options:o}};function G(e,t,o){a.setBadge(e,t,o)}let J=null,Q={x3dAppId:"FolderEditor",amd_custo:{TreeDocument:"DS/FolderEditor/FolderTreeDocument",DataGridView:"DS/FolderEditor/views/FolderDataGridView",TileGridView:"DS/FolderEditor/views/FolderTileView",ThumbnailGridView:"DS/FolderEditor/views/FolderThumbnailView"},layout:{keyboard_inputs:!1,root_panel:!1,action_bar:!1,statusInfo:!1,slidder:!1,title_update:!1,drop_invite:"none",triptychOpts:{borderLeft:!0,withtransition:!D.isReplayedODT(),left:{resizable:!0},right:{withClose:!0}}},insert_replace:!0};var K=i.extend({name:"FolderComponent",defaultOptions:Q,_contentDiv:null,_subscribe:function(e,t){let o=w.subscribe(e,t);this._subscriptionTokens.push(o)},init:function(e,o){this._latestAttributesListOnCall=null,J={authoring:new F({contentView:this}),search:new T({contentView:this}),favorites:new x({contentView:this}),read:new P({contentView:this})};var i=this;this._contentDiv=e.renderTo,M.addComponentsToLoad("contentView",{loadingView:m.LoadingView_Loading});var n=U.getCurrentModeType();this.setCurrentMode(n),this._handlerThumbnails=null,this._treeCont=o,this.setOptions(e),this._parent(this.options);let r=a.getDefaultView();Object.defineProperty(this.options,"active_view",{get:()=>r,set:e=>{r=e}}),this.elements||(this.elements={}),this._logger=t.getLogger(K),require(["DS/FolderEditor/views/FolderStatusInfos"],(function(e){i.elements.padstatus=new e({renderTo:i._contentDiv,events:{onShow:function(){i.elements.padstatus.setStatus(e.buildStatus({tree_content:{nbObjectsInTree:i.getObjectsInTree(),nbObjectsSelected:i.options.model.getSelectedNodes().length}}))}}})})),_.getPlaceholder().then((function(e){i._placeHolder=e}));let s=UWA.createElement("div",{class:"containerTools"});this.addEvent("onReady",(()=>{C.onFolderRename((function(e){i._sortingNodesContent(e)})),C.onModAttr((function(e){var t=i.getPADTreeListView();if(t){var o=t.getManager().sortModel;if(null==o[0]||"defaultSort"==o[0].dataIndex){var n=i.getPADTreeDocument().getNodesById(e.data[0].id)[0];n&&i._sortingNodesContent(n,"TreeOrder")}}}));let e=h.onBookmarkOpening((e=>{w.publish({event:"clear_filter_table"}),this.setCurrentMode(),O.clearTags(),this.getSpecficMode("read").resetInfoIndex(),this.switchMode(null,!0,e&&e.options)}));this._subscriptionTokens.push(e),this._subscribe({event:"refresh_content"},this.refreshView.bind(this)),this._subscribe({event:"remove_favorite"},(({favoriteFoldersToRemove:e})=>{let t=e,o=[];(Array.isArray(t)?t:[t]).forEach((e=>{e.id&&o.push(e.id)})),this.refreshOnDelete(o)})),this._subscribe({event:"remove_nodes"},this.refreshOnDelete.bind(this)),this._subscribe({event:"remove_content_nodes"},this.refreshOnDelete.bind(this)),this._subscribe({event:"switchContentMode"},(({mode:e,silentSwitch:t})=>{this.setCurrentMode(e,t)})),this._subscribe({event:"resetReadIndex"},(()=>{this.getSpecficMode("read").resetInfoIndex()})),this._subscribe({event:"IPClassifyColumnCusto/Views/showInWidgetBody"},(function(e){e.html?(s.empty(),e.html.inject(s),s.inject(widget.body)):!0===e.restore&&s.remove()})),this._subscribe({event:"updateActiveBookmark"},(({removeIt:e})=>{this.updateActiveBookmarkNode(null,e)})),this._subscribe({event:"filterUpdatedTree"},(()=>{if(!this.refreshViewIfNeeded()&&_.isContentViewAvailable()){var e=h.getCurrentBookmarkId();if(V.isRootSection(e)){this.getSpecficMode("read").resetInfoIndex(),this.switchMode(null,!0)}}})),this._subscribe({event:"applyExclusiveFilter"},(e=>{this.getSpecficMode("read").resetInfoIndex(),O.setLocalFilter(e),this.switchMode("read",!0)})),this._subscribe({event:"editLabelContent"},(({node:e})=>{this._switchFolderTreeNodeLabelToWriteView(e)})),this._subscribe({event:"processContentScroll"},(({options:e,grid:t})=>{this._processForInfiniteScroll(e,t)})),this._subscribe({event:"column_updated"},(()=>{let e=!1;if(this._latestAttributesListOnCall){let t=I.getAvailableColumns(),o=new Set;this._latestAttributesListOnCall.forEach((e=>{o.add(e)})),e=t.every((e=>o.has(e)))}e||w.publish({event:"refresh_content"})})),this._subscribe({event:"grid_filter_updated"},(({data:e})=>{let t=e.propertyId;this.options.additionalColumnsModules.find((e=>t===e.getName()))||this._currentMode.allContentLoadedWithoutFilterTable()||w.publish({event:"refresh_content",data:{keepExpandStatus:!0,resetScrolling:!0}})})),this._subscribe({event:"filterUpdatedContent"},(e=>{if(!this.refreshViewIfNeeded()){var t=e.matchingIds,o=t;o&&this.getPADTreeDocument().filterFromIds(t);var i=this.getSpecficMode("search"),n="search";let r=!1;y.isSearchActive()?J.search?J.search.resetInfoIndex():y.resetInfoIndex():(n="read",i=null,"read"===this.getCurrentModeType()&&(r=o&&!!e.hasFilter,i=this.getSpecficMode("read")));let s=this.getCurrentMode();r=r||s.smartFilteringAvailable(),this._keepPreviousNodes=r?h.getCurrentBookmarkId():null,i&&i.filteringByService()?(i.resetInfoIndex(),this.switchMode(n,!1,{keepExpandStatus:!0})):!0!==e.noSmartFiltering&&s.smartFilteringAvailable()&&s.filteringByService()?this.switchMode(void 0,!1):(this._keepPreviousNodes=null,O.reloadObjects())}})),this._subscribe({event:"activate_tree_filter"},(e=>{e?UWA.extendElement(this.elements.padshell._leftPanel).addClassName("FolderEditor_LeftView_Select"):UWA.extendElement(this.elements.padshell._leftPanel).removeClassName("FolderEditor_LeftView_Select")})),this._subscribe({event:"add_content_roots"},(({nodes:e})=>{this.getPADTreeDocument().withTransactionUpdate((()=>{e.forEach((e=>{this.getPADTreeDocument().addRoot(e),j.updateNLS(e)}))}))})),this._subscribe({event:"select_content_from_openwith"},(()=>{let e=z(),t=e.selection;if(t&&t.length>0){let o=this.getPADTreeDocument().getRoots().filter((e=>t.indexOf(e.getID())>=0));this.selectNodes(o,e.options)}}))})),e.layout&&e.layout.view_customization&&Array.isArray(e.layout.view_customization.selectedExtensions)&&Array.isArray(e.layout.view_customization.selectedTypes)&&I.updateSelectedParams({selectedExtensions:e.layout.view_customization.selectedExtensions,selectedTypes:e.layout.view_customization.selectedTypes})},selectNodes:function(e,{cmdToLaunch:t}={}){if(this.getPADTreeDocument().unselectAll(),e.length>0&&(e.forEach((function(e){e.select()})),t)){let o=t;"preview"===t&&(o="PreviewFile"),w.publish({event:"launchCmdOnNode",data:{node:e[0],commandID:o}})}},refreshViewIfNeeded:function(){let e=this._waitingMode&&J[this._waitingMode]!==this._currentMode;return e&&w.publish({event:"refresh_content",data:{keepExpandStatus:!0}}),e},createRootListSlidder2:function(){return this._treeCont?this._treeCont.elements.container:null},refreshOnDelete:function(e){let t=e,o=!1;e.nodeIds&&(t=e.nodeIds,o=!!e.shortcut),t.length>0&&this.removeSomeNodesInContent(t,{shortcut:o})},refreshView:function(e){(e=e||{}).continueScrolling||e.reachBottom||e.resetScrolling||this.setCurrentMode(),e.keepExpandStatus=!e.continueScrolling,e.resetScrolling=e.resetScrolling||e.finalizeScrolling&&!e.continueScrolling,e.resetScrolling||e.continueScrolling||O.clearTags();let t=this.getPADTreeListView();var o=t?t.getManager():null;if(o&&(this._componentScrollerPosition=o.getScrollerPosition()),!e.continueScrolling){let t=this.getCurrentMode();t&&t.resetInfoIndex&&t.resetInfoIndex({resetScrolling:e.resetScrolling})}return e.resetScrolling&&this.options.model.withTransactionUpdate((()=>{this.options.model.getAllDescendants().forEach((e=>{!0===e.getAttributeValue("_scrollingContent")&&e.filterOut(e.filterCTX.FScroll)}))})),this.loadContentAndSelect(e&&e.folderInfo,e&&(e.objectId||e.objectIds),e)},switchMode:function(e,t,o){if(e&&J[e]);else if("FolderSection_favorite"==h.getCurrentBookmarkId())e="favorites";else{e=widget.getValue("useIndexAccleration")?U.getCurrentModeType():"authoring";const t=X.call(this),o=t&&t.findIndex((e=>"favoriteTitle"===e.dataIndex));t&&-1!==o&&t.splice(o,1)}w.publish({event:"updateColumnVisibility",data:{visibility:"favorites"==e,columnName:"favoriteTitle"}}),J[e]!==this._currentMode&&(this.setCurrentMode(e),t=!0),"read"!=e&&"authoring"!=e||U.getCurrentModeType()!==e&&(U.setCurrentModeType(e),U.updateIconAndSettings()),t&&O.clearTags();var i=z(),n=i.selection;null==n||0===n.length?this.loadContentAndSelect(void 0,void 0,o):(h.clearX3DContentItem(),o=o||{},this.loadContentAndSelect(void 0,n,{...o,...i.options}))},getObjectsInTree:function(){let e=0;return this._currentMode.getNbRemainingObjects&&(e=this._currentMode.getNbRemainingObjects(this.getPADTreeDocument())),e+=this.options.model.getAllDescendants().filter((e=>e.isVisible()||!0===e.isFilteredForScroll())).length,e},_updatePlaceholder:function(){this.getPADTreeDocument()&&0===this.getPADTreeDocument().getRoots().length?this._addPlaceHolder():this._placeHolder&&this._placeHolder.hide()},_OnPADComponentReady:function(){var e=this;this.addEvent("onToggleView",a.setDefaultView),require(["DS/FolderEditor/views/FolderLeftSidePanelView","DS/FolderEditor/views/FolderRightSidePanelView"],(function(t,o){e.folderLeftPanel=new t,e.folderRightPanel=new o({platformUrls:A.getTenantInfo(D.getTenantID())})})),a.getLeftPanelStatus().leftPanelState&&V.isTreeViewVisible()&&this.elements.padshell.togglePanel("left"),this.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},(()=>{this._updatePlaceholder()})),this.getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoot"},(()=>{this._updatePlaceholder()})),this.addEvent("onToggleView",(()=>{0===this.getObjectsInTree()&&this._addPlaceHolder(),this._filterRelatedNodes()}));var t=widget.getValue("customLeftWidth");if(token=this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},(function(e){"left"===e&&D.clearJSStylesheet("treeContResize")})),this._subscriptionTokens.push(token),null!=t&&(token=this.elements.padshell._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:t}}),this._subscriptionTokens.push(token)),token=this.elements.padshell._modelEvents.subscribe({event:"triptych-resized"},(function(e){"left"===e.side&&widget.setValue("customLeftWidth",e.width)})),this._subscriptionTokens.push(token),this.elements.padshell._leftPanelContent.addEventListener("click",(function(e){if((k.isWidgetMaximized()||widget._isFocus)&&e&&e.target&&("buttonSection"===e.target.id||e.target.className.indexOf("treeToolsMask")>=0)){let e=p.getSetting("activateTreeFilter");w.publish({event:"activate_tree_filter",data:!e}),C.notifyTaggerStatusChange()}})),_.setContent(this),y.setPredicates(I.getAvailableColumnsOpts()),C.onCurrentFolderColumnChange((function(){y.isSearchInProgress()&&y.resetInfoIndex(),e.getSpecficMode("read").resetInfoIndex(),e.loadContentAndSelect(null,null)})),h.getCurrentBookmarkId()){var o=z(),i=o.selection;this.loadContentAndSelect(void 0,i,o.options)}require("DS/FolderEditor/views/FolderMode").updateIconAndSettings(),M.removeComponentToLoad("contentView","loadingView")},_filterRelatedNodes:function(){var e=this.getPADTreeDocument();let t="datagridview"===this.getActiveView();e&&e.withTransactionUpdate((()=>{e.getAllDescendants().forEach((e=>{e.isRelationsObjectNode&&e.isVisible()!==t&&!e.isFiltered()&&(t?e.filterIn(e.filterCTX.RNode):e.filterOut(e.filterCTX.RNode))}))}))},setFolderCommunicationChannel:function(){},onDragStartCell:function(e,t){if(t.draggedNodes=t.draggedNodes?t.draggedNodes:this.options.model.getSelectedNodes(),!d.shouldAcceptDrag(t)&&!function(e,t){let o=!1;return t.draggedNodes.every((e=>(o=e.undraggable,!o))),o||!1===o||void 0===o||g.displayNotification(o),o}(0,t))return e.preventDefault(),void e.stopPropagation();S.SetAsExternalDrop(!1);var o=d.getDragDataForSelectedNodesInCurrentFolderContent(t),i=JSON.stringify(o);try{e.dataTransfer.setData("text/searchitems",i)}catch(e){}if(e.dataTransfer.setData("Text",i),o.data.items.length>1&&E.createGhostDnD(e,{number:o.data.items.length}),e.dataTransfer.effectAllowed="all",d.setStartDrag(!0),d.setDragFrom("bookmark"),p.isWebInWin()){var n=o.data.items,r=[];n.forEach((function(e){r.push(e.objectId)})),N.publish("setDragData",{ids:r})}e.stopPropagation()},onDragEndCell:function(){d.setStartDrag(!1)},onDragEnterCell:function(e,t){var o=t.nodeModel,i=o&&o.options?o.options.type:void 0;return!!B.isDropAuthorized({type:i,silent:!0},o,e)||(this.onDragEnterBlank(e,t),!1)},onDragLeaveCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none");var o=t.nodeModel,i=o&&o.options?o.options.type:void 0;return B.isDropAuthorized({type:i,silent:!0},o,e)?"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||void t.manager._hideDndFeedbacks():(this.onDragLeaveBlank(e,t),!1)},onDragOverCell:function(e,t){e.preventDefault();var o=t.nodeModel,i=o&&o.options?o.options.type:void 0;return B.isDropAuthorized({type:i,silent:!0},o,e)?(t&&(t.dropPosition="middle"),"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||void t.manager.onDragOverCellDefault(e,t)):(this.onDragOverBlank(e,t),!1)},onDropCell:function(e,t){if(1==widget.launchWithReadMode)return void g.displayNotification({message:m.msg_warning_DndNotSupported,className:"warning"});S.SetAsExternalDrop(!1);var o=t.nodeModel,i=o&&o.options?o.options.type:void 0;B.isDropAuthorized({type:i,silent:!0},o,e)?(d.performDropOnFolderEditorNode(o,e),e.preventDefault()):this.onDropBlank(e,t),d.setDragFrom(""),"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||t.manager.onDropCellDefault(e,t)},onDragEnterBlank:async function(e,t){var o=this.getActiveView(),i=this.getOption("views")[o];return i&&i.options&&i.options.onDragEnterBlankDefault&&i.options.onDragEnterBlankDefault(e,t),!0},onDragLeaveBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none");var o=this.getActiveView(),i=this.getOption("views")[o];return i&&i.options&&i.options.onDragLeaveBlankDefault&&i.options.onDragLeaveBlankDefault(e,t),!0},onDragOverBlank:function(e,t){e.preventDefault();let o=h.getSelectedBookmark(),i=!!o&&B.isDropAuthorized({type:o.getType(),silent:!0},o,e);i||(e.dataTransfer.dropEffect="none");var n=this.getActiveView(),r=this.getOption("views")[n];return r&&r.options&&r.options.onDragOverBlankDefault&&r.options.onDragOverBlankDefault(e,t),i},onDropBlank:async function(e){if(1!=widget.launchWithReadMode){S.SetAsExternalDrop(!1);var t=await c.getCurrentBookmarkInfo();d.performDropOnFolderEditorNode(t,e),e.preventDefault(),d.setDragFrom("")}else g.displayNotification({message:m.msg_warning_DndNotSupported,className:"warning"})},onDropColumnHeader:function(){return d.setDragFrom(""),!0},getOnContextualEvent:function(){return{this:this,callback:function(e){return new Promise((function(t){u.getCtxMenu(e).then((function(e){t(e)})).catch((e=>console.log(e)))}))}}},doDnDDragStart:function(e,t,o){return this.onDragStartCell(this._createSimulatedEvent(e)),!0},doDnDDrop:function(e,t,o,i){var n={nodeModel:t};this.onDropCell(this._createSimulatedEvent(e),n)},_createSimulatedEvent:function(e){function t(){}return{dataTransfer:e,preventDefault:t,stopPropagation:t}},getActiveView:function(){return this._parent()},removeNodesInContent:function(){var e=this.getPADTreeDocument();e&&e.withTransactionUpdate((function(){e.unselectAll(),e.empty()}))},_loadContent:async function(e,t,i){var r=this,s="All";widget.hasPreference("show-sub-folders")&&!1===widget.getBool("show-sub-folders")&&(s="");var l="";!0===widget.getBool("filtered-content")&&(l="Yes");var d=!1;!0===widget.getBool("allow-products-expand")&&(d="Yes"),M.addComponentsToLoad("contentView",{content:m.Content_Loading});var c=e.getID?e.getID():"",u=e.getType?e.getType():"";let f=this._keepPreviousNodes===h.getCurrentBookmarkId(),v=V.getDefaultTypeSection(u);this._latestAttributesListOnCall=I.getAvailableColumns();var _=this._currentMode.loadContent({sortModel:q.call(this),pid:c,section:v||e.section,type:u,content:s,resetScrolling:i&&i.resetScrolling,finalizeScrolling:i&&i.finalizeScrolling,filterChildren:l,noSizeLimit:!!t,smartFiltering:f?{fetchAllAttr:this.getPADTreeDocument().getRoots(!0).length>=W.MAX_NUMBER_EXPAND}:void 0});let S=Promise.all([_]);success=!1;try{var C=(await S)[0];!function(e,t){e.withTransactionUpdate((()=>{try{t()}catch(e){throw console.log(e),e}}))}(r.getPADTreeDocument(),(function(){var s=C.contents;let l=r.getPADTreeDocument();if(i&&!0===i.resetScrolling&&l.getChildren().forEach((e=>{e.isVisible()||e.isFiltered()||e.filterIO(e.filterCTX.FScroll,!1)})),0===C.contents.length&&r._addPlaceHolder(),void 0!==s){var c=[];if(i&&i.keepExpandStatus&&d){var u=r.getPADTreeDocument().getRoots(),f=0,v=u.length;for(f=0;f<v;f++){var _=u[f];if(u[f].isExpanded()){if(!0===_._isProcessedForRelationsColumns&&(delete _._isProcessedForRelationsColumns,!a.isRelationsColumnsActive()&&null!=_.getChildren()[0])){var S=_.getChildren()[0];if(S.hasOwnProperty("isRelationsObjectGroupingNode")&&(doesNodeContainsRelObjGrpNode=S.isRelationsObjectGroupingNode,doesNodeContainsRelObjGrpNode))continue}c.push(_)}}}var b=[],E="read"==U.getCurrentModeType()&&1==r.getCurrentMode()._isPageRefreshed,D={},I=[],F=new Map;let k=!0===r.getCurrentMode().wasScrollingReset(),N=r._keepPreviousNodes===h.getCurrentBookmarkId()||k;if(!0!==C.inProgress||E||k){if(N||i&&i.keepExpandStatus&&O.isFilterActives()&&J.search!==r.getCurrentMode()&&(J.read!==r.getCurrentMode()||widget.getBool("filtered-content"))){let e=C.smartFiltering&&C.filters&&0===Object.keys(C.filters).length;e&&(s=[]),r.getPADTreeDocument().getRoots(!0).forEach((t=>{if(e)t.filterIn(t.filterCTX.FTags);else if(k&&t.filterIO(t.filterCTX.FScroll,!1),C.smartFiltering){let e=!!t.getVisibleChildren()&&t.getVisibleChildren().length>0;t.filterIO(t.filterCTX.FTags,!e)}N&&I.push(t),F.set(t.getID(),t),D[t.getID()]=t}))}r._keepPreviousNodes=null,r.removeNodesInContent(),E&&(r.getCurrentMode()._isPageRefreshed=!1)}var T=[];if(C.smartFiltering&&C.synthesis&&C.synthesis.infos){O.getObjectsToRemoveFromFiltering(C.synthesis.infos).forEach((e=>{let t=D[e];t&&t.filterIO(t.filterCTX.FTags,!1)}))}s.forEach((function(i){if(i.from&&i.to)return void B.updateNodesFromRelations(F,i);if(C.smartFiltering||k){let e=i.resourceid;!e&&i.attributes&&i.attributes.every((t=>{let o="resourceid"===t.name;return o&&(e=t.value),!o}));let t=D[e];if(t&&t.filterIO(t.filterCTX.FTags,!1),t||C.smartFiltering&&!C.smartFiltering.fetchAllAttr)return}var s=r._currentMode.convertData(i);let l=N&&D[s.resourceid];if(l)return l.filterIO(l.filterCTX.FTags,!1),void(null===l.options.children&&s.children&&(l.options.children=s.children,l.getState().startsWith("noChildren")&&"TRUE"===s.grid.expandable&&(l.childComputed=!1,l.setAttribute("expandable",s.grid.expandable),l.setState({state:"collapsed"}))));var a=null;if(c.forEach((function(e){(e.id||e.getID())===s.resourceid&&(a=e)})),null==a){s.grid&&(s.grid.bi_color="rgba(0, 0, 0, 0)");var d=s.icons&&s.icons.length>0?s.icons[0]:"";!s.grid.service||"www"!==s.grid.service&&"__Unknown__"!==s.grid.service?"string"==typeof d&&(s.icons=[{iconPath:"url("+d+")"}]):s.grid.source=s.grid.service;var u=new n(s);if(u.links=i.links?i.links:null,s.nodeAttrs)for(var p in s.nodeAttrs)u[p]=s.nodeAttrs[p];if(u.options.grid.thumbnail=s.thumbnail?s.thumbnail:"",u.id=s.resourceid,u._ischeckout="read"==r.getCurrentModeType()?s.Documentlocked:i.Documentlocked,"TRUE"===u._ischeckout)G(u,"bottomRight",o.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png"));if(u.options.oldLabel=s.label,u.isFavorite&&u.toRemove){u.setBadges({bottomRight:{iconName:"attention",className:"dgv-badge-remove"}})}B.completeNode(u,s,e),r.updateActiveBookmarkNode(u),u._manageNLS=!0,(UWA.is(t,"array")?t.indexOf(s.resourceid)>=0:s.resourceid===t)&&T.push(u),I.push(u),F.set(u.id,u)}else{I.push(a),F.set(a.getID(),a);var h=!1;if(Array.isArray(a.getChildren())&&a.getChildren().length>0){var g=a.getChildren()[0];g.hasOwnProperty("isRelationsObjectGroupingNode")&&(h=g.isRelationsObjectGroupingNode)}h||b.push(a);var f=a.id||a.getID();(UWA.is(t,"array")?t.indexOf(f)>=0:f===t)&&T.push(a)}})),I&&!0!==C.sorted&&I.sort(r._ascendingSortingRootNodeByTitle.bind(r,!y.isSearchActive()));var x=p.getSetting("settypes");!C.modelerName&&x||p.setSetting("settypes",!C.modelerName||"UPS"===C.modelerName);var P="datagridview"===r.getActiveView()&&null!==r.getPADTreeListView();P&&r._listenEndUIRefreshEvent(I),r.addRootNodes(I),P||r._endRefreshView(),y.isSearchActive()||"read"===r.getCurrentModeType()&&"read"!=r.getCurrentModeType()||w.publish({event:"reapply_content_sort"}),i&&i.keepExpandStatus&&c.length>0&&H.onRefreshContentView(l,b),T.length>0&&r.selectNodes(T,i),null!=i&&i.copylink&&0==T.length&&g.displayNotification({...m.msg_warning_contentnotavailable,className:"warning"});var A=[];I.forEach((e=>{A.push(e.id||e.getID())})),O.addObjectsTags(A,r._currentMode.areFacetsCalled()),!r._currentMode.wasScrollingReset()&&Object.keys(D).length>0&&r.getPADTreeDocument().addTagsForChildren(),C.smartFiltering||r._currentMode.filteringByService()&&r.getCurrentMode()!==J.authoring||O.applyFilterIfAny(!1),r._currentMode.withInfiniteScrolling&&r._currentMode.withInfiniteScrolling()&&r.options.model.updateLinksFromStatus(r._currentMode.isInfiniteScrollingEnded())}r._endLoadAndSelect(),r._endContentSelect()})),success=!0}catch(t){this._manageException(e,t)}return success},updateActiveBookmarkNode:function(e,t){if(_.isCustomizedEnv()||_.isActiveBookmarkActivated()){var o=_.getActiveFolder(),i=o.id,n=o.disabledId;if(!e){var r=this.getPADTreeDocument().getNodesById(n||i);r.length>0&&(e=r[0])}e&&(i===e.id?G(e,"topRight",t?null:s.ICON_ACTIVE):n===e.id&&G(e,"topRight",t?null:s.ICON_ACTIVE_DISABLED))}},_manageException:function(e,t){var o=this;if(o._logger.log("WebService content, Err : "+(t&&t.stack?t.stack:"unknown")),o._endContentSelect(),o.removeNodesInContent(),t){let o=!1;if(t.err&&t.err.message&&t.err.message.indexOf("NetworkError")<0&&((t=t.err).className=t.className?t.className:"error"),!t.message){var i,n,r,s=t.err,l=t.serverErr,a="error";if(s&&"timeout"===s.type)n=m.msg_error_timeout.title,r=m.msg_error_timeout.subtitle,message=m.msg_error_timeout.message;else if(this._currentMode.manageError&&l&&(i=this._currentMode.manageError(l),a="warning"),!i&&e){if(e.getRoot()&&!0===e.getRoot().sectionElement.favorite){let t=V.buildNls(m,"msg_error_contentnotavailableInFavorite",{typeStruct:e.getType()});n=t.title,r=t.subtitle,message=t.message}else f.displayNotFoundBk(e.getID(),e.getLabel(),e.getType()),o=!0;a="error"}t={title:n,subtitle:r,className:a},i&&(t.message=i),s&&console.log(s)}o||g.displayNotification(t)}o._endLoadAndSelect()},_switchNameToEdit:function(e){try{if("datagridview"===this.getActiveView()){var t=this.getPADTreeListView().getManager(),o=t.layout.getColumnIndex("tree");if(e.isFavorite){let e=t.getActiveCellID();if(e){t.getCellInfosAt(e).columnID!==o&&(o=t.layout.getColumnIndex("favoriteTitle"))}else o=t.layout.getColumnIndex("favoriteTitle")}var i=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:i});var n=t.getCellInfosAt(i);u._cellToRename={cellInfos:n,context:"CONTENT"},t.setCellInEdition(i)}}catch(e){}},_defaultEnableNameEdit:function(e){setTimeout(function(){this._switchNameToEdit(e)}.bind(this),1e3)},_manageSortForMultiColumns:function(){let e=this.getPADTreeListView();if(e){let o=e.getManager().sortModel;if(y.isSearchActive()&&o&&o.length>1){let t=[];return t.push(o[0]),e.getManager().sortModel=t,!0}var t=a.getContentSortmodel();!y.isSearchActive()&&o.length!==t.length&&o.length>1&&(e.getManager().sortModel=t)}return!1},loadContentAndSelect:async function(e,t,o){if(k.setPCSEntry(widget.id+"_FolderContentLoad",!0),this._manageSortForMultiColumns())return;this._handlerThumbnails&&this._handlerThumbnails.cancel(),this._handlerThumbnails=null;var i,n;e||(e=await c.getCurrentBookmarkInfo()),e&&(e.getType&&(i=e.getType()),e.getID&&(n=e.getID()));let r=V.getSection(i);var s=!1;if(r&&r.favorite?this._currentMode!==J.favorites&&(this.switchMode("favorites"),s=!0):this._currentMode===J.favorites&&(this.switchMode(),s=!0),!s){r&&r.roots?O.addTagsFromProxy(R):O.deleteTagsFromProxy(R);var l=y.isSearchActive();V.isTreeType(i)&&n||r&&(!l||r.roots)?(o&&o.idToHighlight&&((t=t||[]).push(o.idToHighlight),o=void 0),await this._loadContent(e,t,o)):(l&&y.clearSearch(),this.removeNodesInContent(),this._endLoadAndSelect())}},_endLoadAndSelect:function(){M.removeComponentToLoad("contentView","content"),widget.dispatchEvent("onLoadReady");var e=this.getPADTreeListView(),t=e?e.getManager():null;t&&(y.isSearchActive()||"read"===this.getCurrentModeType()||(this._componentScrollerPosition?t.setScrollerPosition(this._componentScrollerPosition):t.setScrollerPosition({x:0,y:0},!0)),this._componentScrollerPosition=null)},_endContentSelect:function(){var e=this.getPADTreeListView(),t=e?e.getManager():null;t&&t.infiniteScrollProcessDone(),k.setPCSEntry(widget.id+"_FolderContentLoad",!1),k.sendPCSTracketPageEvent("FolderWidget_Performance","FolderContentLoad",widget.id+"_FolderContentLoad")},_listenEndUIRefreshEvent:function(e){var t=this,o=this.getPADTreeListView();new Promise((function(i,n){if("datagridview"!==t.getActiveView()||0===e.length)i();else{var r=function(){t.removeEvent("onToggleView",r),i()};t.addEvent("onToggleView",r),o&&o.getManager().onPostUpdateViewOnce((function(){if(t._currentMode.supportClientSort&&this.sortModel&&this.sortModel.length>0){var e=this.sortModel[0];e&&(this.sortModel=[{sort:e.sort,dataIndex:e.dataIndex}])}r()}))}})).then((function(){t._endRefreshView()}))},_endRefreshView:function(){w.publish({event:"onCompleteRefreshNodes"})},removeSomeNodesInContent:function(e,{shortcut:t}={}){var o=this.getPADTreeDocument();let i=[],n=new Set(e);o.getAllDescendants().forEach((function(e){var o=e.id||e.getID();!n.has(o)||t&&"TRUE"!==e.getAttributeValue("isLinkedFolder")||i.push(e)})),o.deleteNodes(i),0===o.getRoots().length&&this._addPlaceHolder()},addDummyRootNodes:function(e){for(var t=[],i=0;i<e.length;i++){var r,s=e[i];if(s instanceof n){s.options.display=s.options.label,G(r=s,"topRight",o.getWebappsAssetUrl("FolderEditor","icons/spinnerBadge.gif"))}else{(r=new n({})).setState({state:"noChildren"}),r.childComputed=!0,r.options.children=null,r.options.label=s.label,r.options.oldLabel=s.label,r.options.display=s.label,r.options.resourceid=s.tempId,r.options.id=s.tempId,r.id=s.tempId,r.options.tempId=s.tempId;var l=o.getWebappsAssetUrl("FolderEditor","icons/spinnerBadge.gif");r.options.icons=[{iconPath:"url("+l+")"}]}if(r._busy=!0,s instanceof n){r.updateAttributes([],I.getAvailableColumns())}else t.push(r)}this.addRootNodes(t)},_switchFolderTreeNodeLabelToWriteView:function(e){var t=!1;return e instanceof n&&V.isTreeType(e.getType())&&this.getPADTreeDocument()&&e.getTreeDocument()===this.getPADTreeDocument()&&(this._switchNameToEdit(e),t=!0),t},_sortingNodesContent:function(e,t){let o=null;t&&"TreeOrder"==t&&(o=[{sort:"asc",dataIndex:"defaultSort"}]),w.publish({event:"reapply_content_sort",data:{sortModel:o,nodeToScroll:e}})},_ascendingSortingRootNodeByTitle:function(e,t,o){var i=!!e&&V.isTreeType(t.getType()),n=!!e&&V.isTreeType(o.getType());return i&&!n?-1:!i&&n?1:k.compareLabels(t.options.label,o.options.label)},_addPlaceHolder:function(){var e=this,t=e.getActiveView();if("datagridview"!==t){if("tileview"===t){var o=(i=e.getPADTileGridView().options.grid.elements.scroller)?i.getContent():null;o&&e._placeHolder.getInnerPlaceholder().inject(o)}if("thumbnailview"===t){var i,n=(i=e.getPADThumbnailGridView().options.grid.elements.scroller)?i.getContent():null;n&&e._placeHolder.getInnerPlaceholder().inject(n)}}else e._placeHolder.resetInnerPlaceholder();e._placeHolder.show()},getGridViewRowHeight:function(){let e=a.densityHeight.compact,t=this.getPADTreeListView();return t&&(e=t.getRowHeight()),e},getContentHeight:function(){let e=0;if(document){let t=document.getElementsByClassName("xbook_viewmain");if(t&&t.length>0){let o=t[0].getElementsByClassName("wux-layouts-left-scroller-container");if(o&&o.length>0&&(e=o[0].clientHeight),!e){let o=t[0].getElementsByClassName("wux-layouts-body");o&&o.length>0&&(e=o[0].clientHeight)}}}return e},getCurrentMode:function(){return this._currentMode},setCurrentMode:function(e,t){if(t)this._waitingMode=e;else{let t=e||this._waitingMode;this._waitingMode=null,t&&(J[t]!==this._currentMode&&O.clearTags(),this._currentMode&&this._currentMode.disable&&this._currentMode.disable(),this._currentMode=J[t],this._currentMode&&this._currentMode.enable&&this._currentMode.enable())}},getCurrentModeType:function(){return this._currentMode.getModeType()},getSpecficMode:function(e){return J[e]},continueInfiniteScrolling:async function(e){let{reachBottom:t,finalizeScrolling:o,continueScrolling:i}=e,n=!0;(t||o||i)&&(this.getCurrentMode().isInfiniteScrollingEnded()||(await this.refreshView({finalizeScrolling:o,reachBottom:t,continueScrolling:i}),n=!0));return n},_processForInfiniteScroll:function(e,t){this.continueInfiniteScrolling({...e,continueScrolling:e.reachBottom}),t.infiniteScrollProcessDone()}});return K})),define("DS/FolderEditor/FolderTreeMechanism",["UWA/Controls/Abstract","UWA/Class/Events","DS/FolderEditor/views/FolderMode"],(function(e,t,o){function i(e){return new Promise((t=>{setTimeout(t,e)}))}return e.extend(t,{_folderTree:null,_isAsynchronousExpansion:!1,_currentRootNodes:[],limit:5,_expandedFolder:"",_processes:[],_partiallyExpandedFolder:[],init:function(e){this._parent(e),this.treeNodeModel=e.treeNodeModel,this._folderTree=e.folderTree},start:async function(){"read"===(this.options.treeNodeModel.isRoot()?this._folderTree.getCurrentTreeRootMode():this._folderTree.getCurrentTreeMode())?await this.executeExpansionForScroll_Index(this.options):await this._initializeMechanism(this._folderTree,this.treeNodeModel)},executeExpansionForScroll_Index:async function(e){this._isAsynchronousExpansion=!0,this._neutralizePath(),0==this._folderTree._indexModeforReadData.getNextStart()?await this._initializeMechanism(this.folderTree,this.treeNodeModel):(this._processes=["loadRoots","ExpandRootsandChildrenAsynchronously"],await this.processExpansion(this.treeNodeModel,!0,e.explicitMethodToBeExecuted))},_initializeMechanism:async function(e,t){this._isAsynchronousExpansion=!0,await this.preProcessInitialization(t),await this.processExpansion(t,!1)},preProcessInitialization:function(e){var t=this;return this._processes=["loadRoots","ExpandRootsandChildrenAsynchronously"],new Promise((function(o){var i=t._folderTree._folderStructurePreference.getSelection(),n="root,"+e.section+",";t.selectedpath=i&&i.split(",").length>2?[i.replace(n,"").split(",")]:[],o()}))},getRoots:function(e){return 0==Object.entries(e).length?null:e.root?e.root[this.treeNodeModel.section]||e.root["_X_"+this.treeNodeModel.section]||e.root["_P_"+this.treeNodeModel.section]:e._P_root?e._P_root[this.treeNodeModel.section]||e._P_root["_X_"+this.treeNodeModel.section]||e._P_root["_P_"+this.treeNodeModel.section]:void 0},_getPartialExpandRoot:function(){let e=this._folderTree._folderStructurePreference._getStoredFolderTreeStructure(),t=e._P_root||e.root,o=[];if(!(!t||!t["_P_"+this.treeNodeModel.section]))for(let e in t["_P_"+this.treeNodeModel.section]){let t=e.replace(/^_(X|P)_/,"");o.push(["root",t])}return o},constructPaths:function(e){var t=this,o="root,"+this.treeNodeModel.section+",",i=this._folderTree._folderStructurePreference._getStoredFolderTreeStructure();let n=!(!i._P_root||!i._P_root["_P_"+this.treeNodeModel.section]);this.pathsTobeLoadedAsynchronouly=[];var r=this.getRoots(i);if(r)for(const i of Object.entries(r)){let r=!(s=i[0]).startsWith("_");var s=r?s:s.replace(/^_(X|P)_/,"");if(e.indexOf(s)>-1){var l=[],a=o+s;t._folderTree._folderStructurePreference.getExpandedChildren(a,(function(e){l=e})),r&&l.unshift(s);var d=[];t._folderTree._folderStructurePreference.getExpandedChildren(a,(function(e){n&&e.forEach((e=>{e.unshift("root")})),d=e}),!0,!0),t.pathsTobeLoadedAsynchronouly.push([l,d,s])}}},processExpansion:async function(e,t,o){var n=this;this._neutralizePath();var r=this.currentProcess=this._processes.length>1?this._processes.shift():this._processes[0];if("loadRoots"==r){await i(),"expanding"===e.getState()&&e.preExpandDone();let n=this._getPartialExpandRoot();this._updateLoadingOnNode(e),e.expand({_expandChildren:!1,updateView:!0,expandEvent:this._expansionEvent.bind(this),currentRootNodes:[],expandedFolder:[],partiallyExpandedFolder:n,isAsynchronousExpansion:!0,recordScrollForIndex:!0,doNotRemoveNodes:t,explicitMethodToBeExecuted:o})}else"ExpandRootsandChildrenAsynchronously"==r&&(await i(),"expanding"===e.getState()&&e.preExpandDone(),this.createBatch(),this._currentRootNodes.length>0&&(this._currentRootNodes.forEach((e=>{e=n._folderTree._getNodesById(e);this._updateLoadingOnNode(e[0])})),e.expand({updateView:!0,expandEvent:this._expansionEvent.bind(this),currentRootNodes:n._currentRootNodes,expandedFolder:n._expandedFolder,partiallyExpandedFolder:n._partiallyExpandedFolder,isAsynchronousExpansion:!0,doNotRemoveNodes:t})))},_neutralizePath:function(){this._currentRootNodes=[],this._expandedFolder=[],this._partiallyExpandedFolder=[]},getLimit:function(){return this.limit},createBatch:function(){for(var e=this,t=0,o=this.getLimit();t<o;){if(0==this.pathsTobeLoadedAsynchronouly.length){this._isAsynchronousExpansion=!1;break}var i=this.pathsTobeLoadedAsynchronouly.shift(),n=i[2];this._folderTree._getNodesById(n)&&this._folderTree._getNodesById(n).length>0&&(t+=1,this._currentRootNodes.push(n),i[0].length>0&&(0==this._expandedFolder.length?this._expandedFolder=i[0].toString():this._expandedFolder=e._expandedFolder+","+i[0].toString()),i[1].length>0&&i[1].forEach((t=>{e._partiallyExpandedFolder.push(t)})))}},_updateLoadingOnNode:function(e){var t=this._folderTree._folders_TreeView.layout,o=t.getCellsFromNodeModel(e);if(o){var i=t.collectionView._getViewAt(o[0]);i&&i.__applyExpanderState("expanding")}},_expansionEvent:function(e,t){var o=this,i=this.treeNodeModel;e&&e.forEach((function(e){(e=o._folderTree._getNodesById(e))&&e[0].setState({state:"expanded"})})),"loadRoots"==this.currentProcess&&this.constructPaths(t),o._isAsynchronousExpansion&&this.processExpansion(i,!0)}})})),define("DS/FolderEditor/views/TreeOrderCmdImpl",["UWA/Core","UWA/Class","UWA/Class/Options","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/utils/FolderEditorEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/WidgetServices/UIInfra/UIInfra","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/FolderEditor/utils/SettingsHandler"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m){"use strict";var v,_=null,S=[];let C,y;var b;let E;var D=t.extend(o,{name:"folder-tree-order-",_dialog:null,init:function(e){this._parent(e),a.subscribe({event:"TreeOrderUpdatedInPanel"},(function(e){if(e.flag&&e.relIdsArray&&e.relIdsArray.length>0)S.push(...e.relIdsArray);else{let t=e.getPreviousNode(),o=e.getNextNode();S.push(t?t.options.grid.relId:"null"),S.push(e.options.grid.relId),S.push(o?o.options.grid.relId:"null")}}))},displayNotification:function(e){i.displayNotification({message:e,className:"error"})},reorderTree:async function(e){var t=this;S=[];let o=[];if("FolderSection_AllFolders"==(b=await s.getCurrentBookmarkInfo()).id||"FolderSection_favorite"==b.id||b.isFavorite)this.displayNotification(c.msg_info_reorder_NonRootbks);else{var i=require("DS/FolderEditor/views/FolderMode");"read"==i.getCurrentModeType()&&i.switchtoAuthoringMode();let r=n.getIconObjectCommand("defaultSort");e._updateSortIcon(r),e._folders_SortElmt._toggleButton("TreeOrder"),y=b.getID(),l.folderTree({expandList:[],isRoot:"",pid:y,section:b.section,sort:e._folders_SortElmt,onComplete:function(e){(e=JSON.parse(e)).folders.length<2?t.displayNotification(c.msg_info_reorder_emptyBks):(e.folders.forEach((e=>{o.push({label:e.label,relId:e.RelId,TreeOrder:e.TreeOrder,icon:e.icon,owner:e.responsible,created:e.created,modified:e.modified})})),o.sort(((e,t)=>parseFloat(e.TreeOrder)-parseFloat(t.TreeOrder))),C=o,t._createPanel(o))},onFailure:function(e){console.log("error while fetching children: "+e)}})}},_disableButtons(){let e=this._dialog.buttons;e.Ok.disabled=!0,e.Reset.disabled=!0},_enableButtons(e){e.Ok.disabled=!1,e.Reset.disabled=!1},_insertInView(e){e._isMoved=!0,this._dialog.buttons.Ok.disabled&&this._enableButtons(this._dialog.buttons)},_treeOrderUpdatedEvent(e,t){this._dialog.buttons.Ok.disabled&&this._enableButtons(this._dialog.buttons),t?a.publish({event:"TreeOrderUpdatedInPanel",data:{relIdsArray:e,flag:!0}}):a.publish({event:"TreeOrderUpdatedInPanel",data:e})},_createPanel:function(t){var o=this;require(["DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel"],((i,n,r)=>{o.immersiveFrame=widget.immersiveFrame;var s=e.createElement("div",{class:"folder-tree-order-reorder-dialog-body",styles:{width:"100%",height:"100%",padding:0}});o._dialog=new i({immersiveFrame:o.immersiveFrame,title:c.tree_ordering_panel_title+b.getLabel(),className:"folder-tree-order-reorder_dialog",content:s,resizableFlag:!0,modalFlag:!0,allowMaximizeFlag:!0,maximizeButtonFlag:!0,movableFlag:!0,width:700,minWidth:500,minHeight:300,height:500,position:{},touchMode:!0,buttons:{Ok:new n({label:c.tree_ordering_Reorder_btn,disabled:!0,onClick:this._reorderDone.bind(this)}),Reset:new n({label:c.tree_ordering_reset_btn,disabled:!0,onClick:o._onReset.bind(o)}),Cancel:new n({label:c.tree_ordering_cancel_btn,onClick:function(e){e.dsModel.dialog.close()}})}}),o._dialog.addEventListener("close",o._onClosePanel.bind(o),!1),o._dialog.elements.container.classList.add("folder-tree-order-tree_reorder_Dialog"),o._dialog.elements.container.addEventListener("click",(function(e){return e.preventDefault(),e.stopPropagation(),!1}));var l=new e.Element("div",{class:"folder-tree-order-reorder_tree_mainContainer"}).inject(s);v=new e.Element("div",{class:"folder-tree-order-reorder-manual-listview-container",styles:{width:"calc(100% - 50px)",height:"100%",position:"relative",display:"inline-block"}}).inject(l);var a=new e.Element("div",{class:"folder-tree-order-reorder-manual-updown-container",styles:{display:"flex","flex-direction":"column","justify-content":"center","vertical-align":"top"}}).inject(l);o.reorderToTop=new n({displayStyle:"icon",icon:{iconName:"move-to-top",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,type:"radio"}).inject(a),o.reorderUp=new n({displayStyle:"icon",icon:{iconName:"up",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,type:"radio"}).inject(a),o.reorderDown=new n({displayStyle:"icon",icon:{iconName:"down",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,type:"radio"}).inject(a),o.reorderToBottom=new n({displayStyle:"icon",icon:{iconName:"move-to-bottom",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,type:"radio"}).inject(a),o.reorderToTop.addEventListener("buttonclick",o._onReorderToTop.bind(o)),o.reorderUp.addEventListener("buttonclick",o._onReorderUp.bind(o)),o.reorderDown.addEventListener("buttonclick",o._onReorderDown.bind(o)),o.reorderToBottom.addEventListener("buttonclick",o._onReorderTobottom.bind(o)),o.reorderToTop.tooltipInfos=new r({shortHelp:c.tree_ordering_movetop_btn}),o.reorderUp.tooltipInfos=new r({shortHelp:c.tree_ordering_moveup_btn}),o.reorderDown.tooltipInfos=new r({shortHelp:c.tree_ordering_movedown_btn}),o.reorderToBottom.tooltipInfos=new r({shortHelp:c.tree_ordering_movebottom_btn}),o._createTreeOrderList(t)}))},_createTreeOrderList:function(t){let o=this;_=null,E=null,o.arrowEnableFlag=void 0;o.model=new p({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition&&e.draggedTreeNodeModel.getParent()===e.dropNode.getParent()}}),o.model.prepareUpdate();for(var i=0;i<t.length;i++){var n=t[i],r=new h({label:n.label,grid:n});o.model.addChild(r)}o.model.expandAll(),o.model.pushUpdate();let s=e.clone(m.getConfigSetting("dgvOptions")),l=s&&s.dgv?s.dgv:{};var a=e.extend({_identifier:"DataGridView-reorderListView-"+widget.id},l);a.treeDocument=o.model,a.columns=[{dataIndex:"tree",text:c.alpha_sorting,autoRowHeightFlag:!0,allowUnsafeHTMLContent:!1,editableFlag:!1,typeRepresentation:"url",getCellValue:function(e){let t=e.nodeModel.options.grid;return{label:t.label,icon:t.icon}}},{dataIndex:"owner",text:c.ViewTooltip["ds6w:responsible"],autoRowHeightFlag:!0,allowUnsafeHTMLContent:!1,editableFlag:!1},{dataIndex:"created",text:c.date_sorting,autoRowHeightFlag:!0,allowUnsafeHTMLContent:!1,editableFlag:!1,typeRepresentation:"datetime"},{dataIndex:"modified",text:c.ViewTooltip["ds6w:modified"],autoRowHeightFlag:!0,allowUnsafeHTMLContent:!1,editableFlag:!1,typeRepresentation:"datetime"}],a.layout=new f({cellHeight:30,columnHeaderHeight:38}),a.rowSelection="single",a.selectionBehavior={canInteractiveMultiselectWithCheckboxClick:!1,canMultiSelect:!1,enableFeedbackForActiveCell:!1,enableShiftSelection:!1,toggle:!1,unselectAllOnEmptyArea:!0},a.rowHeaderActivated=!0,a.cellDragEnabledFlag=!0,a.showSelectionCheckBoxesFlag=!1,a.onContextualEvent=()=>[],o._treeView=new g(a),o._treeView.inject(v),o._treeView.onDropRowHeader=o.onDropEventCall.bind(o),o._treeView.onDropCell=o.onDropEventCall.bind(o),o._treeView.addEventListener("click",(function(e,t){let i=t.nodeModel;_||(E=_=i,o._enableManualSortButtons(o.reorderDown,o.reorderToBottom,o.reorderToTop,o.reorderUp)),_&&_!=i&&(E=_,_=i,E._isMoved&&(o._treeOrderUpdatedEvent(E),E._isMoved=!1))}))},onDropEventCall:function(e,t){let o,i,n;if(e.preventDefault(),t.nodeModel&&(o=t.nodeModel),t.droppedNodes[0]&&(i=t.droppedNodes[0]),t.dropPosition&&(n=t.dropPosition),o&&i&&n){let e,t;switch(n){case"top":e=o.getPreviousNode(),t=o;break;case"bottom":e=o,t=o.getNextNode()}let r=[];r.push(e?e.options.grid.relId:"null"),r.push(i?i.options.grid.relId:"null"),r.push(t?t.options.grid.relId:"null"),this._treeOrderUpdatedEvent(r,!0)}return!0},_enableManualSortButtons:function(e,t,o,i){e.disabled=!1,t.disabled=!1,o.disabled=!1,i.disabled=!1},_disableManualSortButtons:function(e,t,o,i){e.disabled=!0,t.disabled=!0,o.disabled=!0,i.disabled=!0},_onReorderUp:function(){let t=this,o=t.model.getSelectedNodes()[0];if(e.is(o)){let e=o._rowID;if(e>0){let i=o.getPreviousNode();t.model.prepareUpdate(),o.getParent().insertBefore(o,i),t.model.pushUpdate(),o.select(),o._rowID!=e&&(t._insertInView(o),t._treeView.ensureNodeModelVisible(o))}}},_onReorderDown:function(){let t=this,o=t.model.getSelectedNodes()[0],i=t.model.getRoots().length;if(e.is(o)){let e=o._rowID;if(e<i-1){let i=o.getNextNode();t.model.prepareUpdate(),i.getParent().insertBefore(i,o),t.model.pushUpdate(),o.select(),o._rowID!=e&&(t._insertInView(o),t._treeView.ensureNodeModelVisible(o))}}},_onReorderToTop:function(){let t=this,o=t.model.getRoots()[0],i=t.model.getSelectedNodes()[0];if(e.is(i)){let e=i._rowID;e>0&&(t.model.prepareUpdate(),i.getParent().insertBefore(i,o),t.model.pushUpdate(),i.select(),i._rowID!=e&&(t._insertInView(i),t._treeView.ensureNodeModelVisible(i)))}},_onReorderTobottom:function(){let t=this,o=t.model.getSelectedNodes()[0],i=t.model.getRoots().length;if(e.is(o)){let e=o._rowID;e<i-1&&(t.model.prepareUpdate(),o.getParent().addChild(o),t.model.pushUpdate(),o.select(),o._rowID!=e&&(t._insertInView(o),t._treeView.ensureNodeModelVisible(o)))}},_reorderDone:function(){_&&_._isMoved&&(this._treeOrderUpdatedEvent(_),_._isMoved=!1),l.getTreeOrder({parentId:y,IDs:S}).then((e=>{if("failure"==e.status)i.displayNotification({message:e.error,className:"error"});else if(e.folders&&e.folders.length>=2){let t={};e.folders.forEach((e=>{t[e.id]={relationOrder:e.TreeOrder}})),a.publish({event:"updateContentNodes",data:{items:t,sort:!0}}),d.notifyFolderAttrChange(e,b),i.displayNotification({message:c.reorderSuccess,className:"success"})}this._onClosePanel()})).catch((e=>{i.displayNotification({message:e,className:"error"}),console.log(e)}))},_onReset:function(){this._disableButtons(),_=null,S=[],E=null,this._disableManualSortButtons(this.reorderDown,this.reorderToBottom,this.reorderToTop,this.reorderUp),this._dialog.content.getChildren()[0].getChildren()[0].innerHTML="",this._createTreeOrderList(C)},_onClosePanel:function(){this._dialog.destroy(),this._dialog=null}});return D})),define("DS/FolderEditor/FolderTreeCont",["UWA/Core","UWA/Utils","DS/Utilities/Utils","UWA/Controls/Abstract","DS/Controls/TooltipModel","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/Logger/Logger","DS/Tree/Tree","DS/TreeModel/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/views/FolderGlobalActiveBookmark","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/models/xTreeNodeModel","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderServices","DS/FolderEditor/commands/FolderCommands","DS/IPClassifyUtil/PlatformAPIWrapper","DS/FolderEditor/Folder_Clipboard","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPServicesMgr","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/ActionBar/IPToolbar","DS/FolderEditor/utils/FolderEditorControl","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/views/FolderOrderCmd","DS/FolderEditor/utils/FavoritesUtil","DS/LifecycleServices/LifecycleServicesSettings","DS/FolderEditor/tagger/TaggerTreeProxy","DS/DataGridView/DataGridView","DS/Core/PointerEvents","DS/DataGridView/DataGridViewLayout","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/IPClassifyLoaderGlobal","DS/Menu/Menu","DS/IPClassifyFindInContext/FindInTree","i18n!DS/IPClassifyFindInContext/assets/nls/FindInTree","DS/FolderEditor/utils/FolderExpandUtil_Read","DS/FolderEditor/views/FolderMode","text!DS/FolderEditor/assets/FolderEditorConf.json","DS/FolderEditor/dataProvider/FolderFindInDataProvider","DS/IPClassifyUtil/IPClassifyCommunication","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/FolderEditor/FolderTreeMechanism","DS/Tweakers/GeneratedToolbar","DS/FolderEditor/views/TreeOrderCmdImpl","DS/FolderEditor/utils/BkAlert","DS/FolderEditor/utils/SettingsHandler","DS/FolderEditor/plugins/PluginsManager","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/IPClassifyUXUtil/CredentialsView"],(function(e,t,o,i,n,r,s,l,a,d,c,u,p,h,g,f,m,v,_,S,C,y,b,E,D,w,I,F,T,x,P,A,k,N,M,U,O,R,L,B,V,W,j,H,X,q,z,G,J,Q,K,$,Y,Z,ee,te,oe,ie,ne,re){"use strict";let se=y.Filter_tagger,le=!1;function ae(e,t){le=!0;let o=he(t);P.updateToggleCommand("Filter",e,o),le=!1}function de(e){return e._modelEvents}function ce(e){let t=F.getSetting("treeFilter");return t?JSON.parse(t):e}function ue(e){return e?"selected":"unselected"}function pe(e){let t=ce({});for(let o in e)e[o]?t[o]=e[o]:delete t[o];return function(e){F.setWidgetSetting("treeFilter",JSON.stringify(e))}(t),t}function he(e){let t=Object.keys(e).length;return t>1||1===t&&(!e.taggerFilter||Object.keys(R.getTaggerTags()).length>0)}function ge(e,t,o){let i=ce({}),n=null,r=n=i[e],s=i;if(void 0===o||n!==o){r=!i[e];let o={};o[e]=r,s=pe(o),H.updateModel([{title:t,state:r?"selected":"unselected"}])}return this.leftToolbar&&ae(this.leftToolbar,s),r}function fe(e){!0===e?R.enableTaggerTags():R.disableTaggerTags()}function me(e){let t=ge.call(this,"taggerFilter",se,e);return fe(t),t}function ve(e){let t=ce({});if(!_.compareJsonValue(t,e.status)){e.status=t;let o={};if(t.ownerFilter){let e=T.getUserName();o["ds6w:who/ds6w:responsible"]=[{disptext:e,object:e,type:"string",field:["implicit"]}]}R.setApplicationFilter(o),R.applyFilterIfAny(!0)}}function _e(e){let t=0;return e&&Object.values(e).forEach((e=>{t+=_e(e)+1})),t}function Se(e){return e.icon?[e.icon]:[]}function Ce({label:e,icon:t,id:o,mxid:i,type:n,created:r,owner:s,RelId:l,TreeOrder:a,publishOnConnect:d,folderClassification:c}){let u={useAsyncPreExpand:!0};return u.label=e,u.icons=Se({icon:t}),u.children=[],u.id=o,u.mxid=i,u.type=n,u.created=r,u.owner=s,u.relId=l,u.relationOrder=a,UWA.is(d)&&(u.publishOnConnect=d),u.folderClassification=c,u}let ye=o.debounce((function(e){e&&e.root&&e.root.e&&(e={});var t=_e(e);if(!(!1!==widget.getValue("expandSaveLimitation")&&t>this.options.limitExpand)){let t=JSON.stringify(e);t=_.jsonZip(t),widget.setValue(oe.getPrefPrefix().toLowerCase()+"TreeStructure",t)}}),300);var be=i.extend(r,s,{name:"FolderTree_Cont",time_to_expand_node:1500,_folders_TreeDocument:null,_folders_TreeView:null,_logger:null,_folders_SortElmt:null,_currentDragEnterFolder:null,_timerDragEnter:null,propIDCard:"not initialized!",defaultOptions:{limitExpand:100},_subscribe:function(e,t){let o=x.subscribe(e,t);this._subscriptionTokens.push(o)},getCurrentTreeRootMode:function(){return this._currentMode},getCurrentTreeMode:function(){return this._waitingMode?this._waitingMode:this._currentMode},_setCurrentMode:function(e,{silentSwitch:t}){this._waitingMode=t?e:null,t||(this._currentMode=e)},_applyWaitingMode:function(){this._waitingMode&&this._setCurrentMode(this._waitingMode,{})},init:function(e){var t=this;this._parent(e),this._subscriptionTokens=[],this._folderStructurePreference.options=this.options,this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"});var o=widget.getValue("useIndexAccleration")?G.getCurrentModeType():"authoring";this._setCurrentMode(o,{}),G.setCurrentModeType(o),this._donNotApplyFilterForRead=!1;let i=g.waitForCommandsIcons();T.app_initialization((async function(){await i,t._buildUI()})),this._subscribe({event:"refresh_tree"},this.refreshView.bind(this)),this._subscribe({event:"switchTreeMode"},(({mode:e,silentSwitch:t})=>{this._setCurrentMode(e,{silentSwitch:t})})),this._subscribe({event:"update_tree_new_node"},(({node:e})=>{this.updateTreeWithNewFolder(e)})),this._subscribe({event:"remove_nodes"},this.refreshOnDelete.bind(this)),this._subscribe({event:"remove_tree_nodes"},this.removeNodesFromTree.bind(this)),this._subscribe({event:"refresh_nodes"},this._refreshOnModified.bind(this)),this._subscribe({event:"select_breadcrumb_object"},(({id:e,type:t,name:o})=>{let i=m.getDefaultModelFromId(e);i.type=t,i.name=o,m.dispatchBookmarkNodeSelection(i)})),this._subscribe({event:"rename_favorite"},this.onFavoriteRenamed.bind(this)),this._subscribe({event:"taggerUpdatedTree"},(({filter:e})=>{me.call(this,e&&Object.keys(e).length>0)})),this._subscribe({event:"filterUpdatedTree"},(e=>{let t="read"===this.getCurrentTreeRootMode();if(this._indexModeforReadData.resetInfoIndex(),this._applyFilter(t||e.hasFilter?e.matchingIds:null),t||void 0===e.matchingIds){let e=!0;for(let t in this._rootNodes)if(e=!oe.getSection(t).roots||!this._rootNodes[t].isExpanded(),!e)break;e&&(R.clearTags(),R.refresh(!1)),this.refreshView()}else R.reloadObjects()})),this._subscribe({event:"editLabelTree"},(({node:e})=>{this._switchFolderTreeNodeLabelToWriteView(e)})),this._subscribe({event:"activate_tree_filter"},(e=>{e?UWA.extendElement(this._commonToolSection).addClassName("folder-common-tool-Section_Select"):UWA.extendElement(this._commonToolSection).removeClassName("folder-common-tool-Section_Select")})),this._subscribe({event:"remove_favorite"},(({favoriteFoldersToRemove:e,section:t})=>{let o=null;var i=this._rootNodes[t].getChildren();let n=[];var r,s=Array.isArray(i)?i.length:0,l=[];e.forEach((e=>{l.push(e.id)}));for(var a=0;a<s;a++){var d=i[a];if(-1!==l.indexOf(d.id)){d.isSelected()&&(o=d),d.hide(),n.push(d)}}o&&m.dispatchBookmarkNodeSelection(this._rootNodes[t]),n.forEach((e=>{this._rootNodes[t].removeChild(e)})),!1===(r=this._rootNodes[t]).hasChildren()&&r.withTransactionUpdate((function(){r.removeChildren(),r.setState({state:"collapsed"})}))}))},_waitBookmarkPathReady:function(e){let t=e.shift();"root"===t&&(t=e.shift());let o=this._getNodesById(t),i=l.resolve();if(o&&o.length>0){let t=o[0],n=l.resolve();"expanding"===t.getState()&&(n=new l((e=>{let o=t.onPostExpand((()=>{t.removeEventListener(o),e(t)}))}))),i=new l((t=>{n.then((o=>{this._waitBookmarkPathReady(e).then((e=>{t(e||o)}))}))}))}return i},_openBookmark:async function(e){let t=await E.getCurrentBookmarkInfo(),o=t.getType();this._updateTreeOrderVisibility(o);let i=this._getSelectedBookmark(),n=!i||i.getID()!==t.getID();if(n){let o={};t._parentBk&&(o[t.getID()]=t._parentBk),this.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[t.getID()],type:t.getType(),name:t.getLabel()},parents:o,partiallyExpandPath:!0,onComplete:function(e){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(){console.log(" expandTreeAndSelectFolder:onGiveUp"),e&&e.options&&e.options.events&&e.options.events.treeGiveUp&&x.publish({event:e.options.events.treeGiveUp,data:{id:t.getID()}})},onFailure:function(o){console.log(o),e&&e.options&&e.options.events&&e.options.events.treeFailure?x.publish({event:e.options.events.treeFailure,data:{id:t.getID()}}):te.displayNotFoundBk(t.getID(),t.getLabel(),t.getType())}}),this._scrollOnPostUpdateView(t.getID())}if(n||!0===t.userSelectFromTree){if(t&&t.getID()&&oe.isTreeType(t.getType())){for(var r=this.getExistingBookmarkPath(),s=[],l=Array.isArray(r)?r.length:0,a=0;a<l-1;a++)s.push({resourceid:r[a].id,type:r[a].type});var d={};if(l>=1){var c=l-1;r[c].id&&(d[r[c].id]={type:r[c].type,label:r[c].label})}var u=[];oe.isSection(t.getType())||(t.options||(t.options={type:t.getType(),grid:{}}),u=[t]),k.setObject_on_compass({nodes_2_open:u}),w.publish("DS/ENO/select",{paths:[[t.getID()]],attributes:d,folderPath:s,doNotSetOnCompass:!0,metadata:!0}),w.publish("DS/PADUtils/PADCommandProxy/select",{paths:[[t.getID()]],attributes:d,folderPath:s,doNotSetOnCompass:!0,metadata:!0}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],(function(e){if(F.isWebInWin()){var o={id:t.getID(),label:t.getLabel(),type:t.getType()};e.publish("selectedBookmarkInTree",o)}}))}else oe.isSection(t.getType())&&(w.publish("DS/ENO/select",{paths:[],attributes:{},folderPath:[],doNotSetOnCompass:!0,metadata:!0}),w.publish("DS/PADUtils/PADCommandProxy/select",{paths:[],attributes:{},folderPath:[],doNotSetOnCompass:!0,metadata:!0}),k.setObject_on_compass({nodes_2_open:[]}));S.dipatchSecurityContextAndFolder(),delete t.userSelectFromTree}},_buildUI:function(){this._rootServiceHandler=null,this._logger=a.getLogger(be);var e=this;C.onFolderRename((function(t){var o=t.getID(),i=t.getLabel();e.updateNodeLabel(o,i)})),C.onModAttr((function(t){e.updateNodeAttr(t)})),k.subscribe("FolderEditor.RequestCurrentFolder",(function(){S.dipatchSecurityContextAndFolder()})),e._buildSkeleton(),e._folders_SortElmt=new M({treeCont:this}),e._folders_TreeOrderElmt=new ee;let t=x.getModelEvents();e._folders_FindInTree=new X({dataProvider:new Q({grid:this._folders_TreeView,component:this}),modelEvents:t,createButton:!1}),e._commonToolSection=UWA.createElement("div",{class:"folder-common-tool-Section",id:"folder-common-tool-Section"}),this._commonToolSection.inject(this.elements.container,0),W.isTouchDevice()&&e._commonToolSection.setAttributeNode(document.createAttribute("touch-mode"));let o=this._getSortingIcon();var i=o.alphaIcon,r=o.dateIcon,s=o.toolbarIcon;let d=g.getIconObjectCommand("defaultSort"),c=this._folders_SortElmt.isTreeSort()?d:s;var h=new n;h.loadFromHelpRscFile(oe.getHelpLocation(),"findInTree");let f=null;!0===oe.getSettingParameter("treeOrdering")&&(f=new n,f.loadFromHelpRscFile("FolderEditor/help","tree-reorder"));let v=new n;v.loadFromHelpRscFile(oe.getHelpLocation(),"tree-filter");let _=new n;_.loadFromHelpRscFile(oe.getHelpLocation(),"alphaSortingContainer");let b=ce(),E={status:b||{}},w=he(E.status),I={icon:g.getIconObjectCommand("Filter"),tooltip:v,label:y.fonticon_filter},F={id:"Filter",dataElements:{domId:"fd_Tree_Filter",typeRepresentation:"customBoolean",value:w,possibleValues:[{...I,value:!0},{...I,value:!1}],onNodeUpdate:(e,{data:t})=>{if(void 0!==t&&!le){let e=E.status=ce({}),t=this.leftToolbar.getContent().getElement("#fd_Tree_Filter").getBoundingClientRect(),o=[],i={type:"CheckItem",title:y.Filter_owner,state:ue(e.ownerFilter),action:{callback:()=>{le=!0,ge.call(this,"ownerFilter",i.title),ve(E),le=!1}}};o.push(i);let n=R.getTaggerTags();n&&Object.keys(n).length>0&&o.push({type:"CheckItem",title:se,state:ue(e.taggerFilter),action:{callback:()=>{me.call(this),ve(E)}}}),H.show(o,{position:{x:t.x,y:t.y+t.height}}),ae(this.leftToolbar,e)}},position:"far",category:"1",priority:2}},T={icon:g.getIconObjectCommand("findInTree"),label:y.find_in_left_tree_btn,tooltip:h},A=[F,{id:"findInTree",dataElements:{typeRepresentation:"customBoolean",value:!1,possibleValues:[{...T,value:!0},{...T,value:!1}],onNodeUpdate:function(t,{data:o}){void 0!==o&&e._folders_FindInTree.clickEvent()},position:"far",category:"1",priority:2}}];f&&A.push({id:"tree-reorder",dataElements:{typeRepresentation:"functionIcon",label:y.tree_ordering_Reorder_btn,tooltip:f,icon:g.getIconObjectCommand("TreeOrder"),value:function(){e._launchReorderPanel()},priority:2,position:"far",category:"1",visibleFlag:!0}});let N=[{id:"alphaSort",type:"PushItem",title:y.alpha_sorting,icon:i,action:{callback:function(){e._folders_SortElmt.toggleButton(),e._updateSortingIcon()}}},{id:"dateSort",type:"PushItem",title:y.date_sorting,icon:r,action:{callback:function(){e._folders_SortElmt.toggleButtonDate(),e._updateSortingIcon()}}}];f&&N.push({id:"treeSort",type:"PushItem",title:y.tree_sorting,icon:g.getIconObjectCommand("clearSort"),action:{callback:function(){e._folders_SortElmt._toggleButton("TreeOrder"),e._updateSortingIcon(d)}}}),A.push({id:"alphaSortingContainer",domId:"treeOrderButton",dataElements:{priority:2,tooltipInfos:_,icon:c,position:"far",category:"1",label:y.fonticon_sort,typeRepresentation:"functionMenuIcon",value:{menu:N}}}),A.push({id:"wrong",dataElements:{typeRepresentation:"functionIcon",label:y.button_close,icon:g.getIconObjectCommand("closeCmd"),value:function(){x.publish({event:"triptych-hide-panel",data:"left"})},priority:3,position:"far",category:"1"}});var U={entries:A},O=Z.prototype.createTreeDocument(U);e.leftToolbar=new Z({overflowManagement:"dropdown",direction:"horizontal",items:O}),e.leftToolbar.elements.maskContainer.addClassName("treeToolsMask"),e.leftToolbar,!b&&R.getTaggerTags()&&Object.keys(R.getTaggerTags().length>0)?me.call(this,!0):b&&(fe(!0===b.taggerFilter),ve(b));let L=UWA.createElement("div",{id:"buttonSection"});L.inject(e._commonToolSection);let B=UWA.createElement("div",{id:"rightButtons"});e.leftToolbar.inject(B),B.inject(L),e._folders_FindInTree.getUI().inject(e._commonToolSection),this._subscribe({event:"findInTree UI updated"},(e=>{e.component===this._folders_FindInTree&&this.elements.container.setAttribute("findInTree",e.visible),P.updateToggleCommand("findInTree",this.leftToolbar,e.visible)})),this._subscribe({event:"findInTree button UI updated"},(e=>{e.component===this._folders_FindInTree&&this.leftToolbar.updateNodeModel("findInTree",{visibleFlag:e.visible})})),this._subscribe({event:"escape_action"},(()=>{this.escape()})),this._subscribe({event:"update_view_mode"},(e=>{this.modeChange(e)})),this._subscribe({event:"favorite_added"},(({favoritesToAdd:e,section:t})=>{e.forEach((e=>{let o={useAsyncPreExpand:!1};o.label=e.name,o.bookmarkLabel=e.name,o.isPersonal=e.isPersonal,o.children=null,o.id=e.id,o.mxid=e.mxid,e.inherit&&(o.inherit=1);let i=this._getIcons(e);o.icons=i,o.type=e.type,o.isFavorite=!0,ie.prepareTreeData(e,o),this._createTreeNodeModel(o,this._rootNodes[t]).setState({state:"noChildren"})}))})),this._subscribe({event:"rename_label"},(({isTree:e,cellInfos:t})=>{e&&D.RenameCmd(t,this._folders_TreeView)}));var V=this._folders_TreeView?this._folders_TreeView.getTreeDocument():void 0;this._folders_TreeDocument=V,V&&(V.options.shouldBeEditable=S.shouldBeEditable,V.onNodeModelUpdate(S.onNodeModelUpdate),V.options.shouldAcceptDrag=this._shouldAcceptDrag.bind(this),V.options.shouldAcceptDrop=this._shouldAcceptDrop.bind(this),V.onPreExpand(this._onPreExpandTreeNode.bind(this)),V.getXSO().onChange((function(){let e=V.getXSO().get();if(e.length>0){let t=e.length>0?e[0]:null;t&&(t.userSelectFromTree=!0),m.dispatchBookmarkNodeSelection(t)}x.publish({event:"tree_cso_updated"})}))),this._rootNodes={},j.removeComponentToLoad("global","widget");let q=oe.getSections(),z=[];q.forEach(((t,o)=>{let i=t.name,n={};if(n[i+"Tree"]=y[i+"Tree_Loading"],j.addComponentsToLoad("treeView",n),t.type)z.push(new l((n=>{p.folderTree({pid:"",section:i,isRoot:!0,sort:e._folders_SortElmt,onComplete:function(r){if((r=JSON.parse(r)).folders&&r.folders.length>0){let n=r.folders[0];var s={useAsyncPreExpand:!0};s.id=n.id,s.label=n.label,s.icons=[n.icon],s.children=[],s.type=n.type;let l=e._rootNodes[i]=e._createTreeNodeModel(s,e._folders_TreeDocument,void 0,o);l.section=i,l.sectionElement=t,l.sectionIndex=o,e._folderStructurePreference.isExpanded(l.pathId,(e=>{e||j.removeComponentToLoad("treeView",i+"Tree")}))}else j.removeComponentToLoad("treeView",i+"Tree");n()},onFailure:function(){j.removeComponentToLoad("treeView",i+"Tree"),console.log("Error getting Personal Bookmark"),n()}})})));else{let n={useAsyncPreExpand:!0};t.icon&&(n.icons=[u.getWebappsAssetUrl(t.icon.module,t.icon.path)]),n.label=y["name_Section_"+i],n.children=[],n.id=i,n.type=i;let r=e._rootNodes[i]=e._createTreeNodeModel(n,e._folders_TreeDocument,void 0,o);r.section=i,r.sectionElement=t,r.sectionIndex=o,e._folderStructurePreference.isExpanded(r.pathId,(e=>{e||j.removeComponentToLoad("treeView",i+"Tree")}))}})),l.all(z).then((()=>{let t=m.onBookmarkOpening(e._openBookmark.bind(e));e._subscriptionTokens.push(t),e.dispatchEvent.call(e,"onReady"),e._openBookmark()}))},_applyFilter:function(e){this._folders_TreeDocument.withTransactionUpdate((()=>{this._folders_TreeDocument.getRoots().forEach((t=>{oe.isRootSection(t.getID())&&t.getChildren().forEach((t=>{!e||e.indexOf(t.getID())>=0?t.show():t.hide()}))}))}))},_updateSortIcon:function(e){this.leftToolbar.updateNodeModel("alphaSortingContainer",{icon:e})},_launchReorderPanel:function(){this._folders_TreeOrderElmt.reorderTree(this)},_updateTreeOrderVisibility(e){let t=!0;t="FolderSection_favorite"!=e&&"FolderSection_AllFolders"!=e,this.leftToolbar.updateNodeModel("tree-reorder",{visibleFlag:t})},_updateSortingIcon:function(e){let t=this._getSortingIcon(),o=e||t.toolbarIcon;this.leftToolbar.updateNodeModel("dateSort",{icon:t.dateIcon}),this.leftToolbar.updateNodeModel("alphaSortingContainer",{icon:o}),this.leftToolbar.updateNodeModel("alphaSort",{icon:t.alphaIcon})},_getSortingIcon:function(){let e,t,o,i="desc"==this._folders_SortElmt.sortOrder,n="date"==this._folders_SortElmt.sortMode,r=g.getIconObjectCommand("dateSort"),s=g.getIconObjectCommand("alphaSort"),l=g.getIconObjectCommand("dateSortReverse"),a=g.getIconObjectCommand("alphaSortReverse");return e=n?i?l:r:i?a:s,t=i?s:a,o=i?r:l,{toolbarIcon:e,alphaIcon:t,dateIcon:o}},_getIcons:function(e){return e.icon?[e.icon]:[]},_refreshNodes:function(e){for(var t=0;t<e.length;t++)this.updateNodeLabel(e[t])},_getAllRoots:function(){let e=[];for(let t in this._rootNodes){let o=this._rootNodes[t];o.sectionElement.roots&&o.getChildren().forEach((t=>e.push(t)))}return e},_getSelectedBookmark:function(){let e=this.treeDocument.getSelectedNodes();return e.length>0?e[0]:null},_refreshOnModified:function({modified:e}){e&&this._refreshNodes(e)},render:function(){return this},destroy:function(){this._logger.log("destroy"),this._subscriptionTokens.forEach((e=>{x.unsubscribe(e)})),this._subscriptionTokens=[],this._folderStructurePreference._storedStructure=null,this._folderStructurePreference._currentSelection=null,this._parent()},_onContextualEvent:function(e){var t=this;let o=this._getSelectedBookmark();if(e&&e.cellInfos&&e.cellInfos.nodeModel&&(!o||e.cellInfos.nodeModel.getID()!==o.getID())&&e.cellInfos.nodeModel.select(!0),e&&e.cellInfos)return new l((function(o){t.__onContextualMenuReady(e).then((function(e){o(e)}))}))},_buildSkeleton:function(){var e=this;this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"});let t=UWA.createElement("div",{class:"FolderEditor_treeView_loader"}).inject(this.elements.container);j.setContainer("treeView",t),this.getOption("css_view_class")&&this.elements.container.addClassName(this.getOption("css_view_class")),this.elements.folderTreeView_container=UWA.createElement("div",{class:this.getClassNames()+"_treeview_container"}).inject(this.elements.container);var o=UWA.clone(oe.getConfigSetting("dgvOptions")),i=o&&o.dgv?o.dgv:{};i.selectionBehavior.toggle=W.isTouchDevice(),i.selectionBehavior.unselectAllOnEmptyArea=!1,i.infiniteScrolling=!0,i.onContextualEvent=e._onContextualEvent.bind(e),i.rowSelection="single",i.showRowBorderFlag=!1,i.columns=[{dataIndex:"tree",sortableFlag:!1,typeRepresentation:"string",getCellEditableState:function(e){return 1!=widget.launchWithReadMode&&(e&&e.nodeModel&&oe.isTreeType(e.nodeModel.getType())&&!e.nodeModel.isRoot())},editionPolicy:"DelayedEditionOnClick",setCellValue:function(e,t){if(e.nodeModel){var o=e.nodeModel;require("DS/FolderEditor/commands/FolderCommands")._cellToRename={cellInfos:e,context:"TREE"},o.getTreeDocument().withTransactionUpdate((function(){var e={};e.label=t,e.display=t,e.oldLabel=o.options.label,o.updateOptions(e)}))}},compareFunction:function(t,o,i,n,r){return e._folders_SortElmt.mySortFunction(i,n)},onCellRequest:function(e){e.isHeader||(e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("folder-state-is-being-cut"):e.cellView.getContent().removeClassName("folder-state-is-being-cut")),this.defaultOnCellRequest(e)}}];var n=UWA.extend({_identifier:"DataGridView-"+e.name+"-"+widget.id},i),r=UWA.clone(o.dgvLayout);n.layout=new V(r),n.layout.useLastColumnWidthAutoFlag=!0,n.layout.columnsHeader=!1;var s=this.treeDocument=new c({nodeModelClass:f,useAsyncPreExpand:!0});s.useAsyncPreExpand=s.options.useAsyncPreExpand,m.registerTreeDocument("TREE",s),n.treeDocument=s,n.rowReorderEnabledFlag=!0,n.editOnKeyPressFlag=!1,n.rowDragEnabledFlag=!0;var l=new L(n).inject(this.elements.folderTreeView_container);this._folders_TreeView=l;["esc","del","ctrl+f","alt+return","f2","ctrl+x","ctrl+v"].forEach((function(e){l._keymapManager.registerKeymap(e,void 0)})),l.setUseClipboardFlag(!1),l.onCopy=N.launchKeyAction.bind(N,"ctrl+c"),l.onCut=N.launchKeyAction.bind(N,"ctrl+x"),l.onPaste=N.launchKeyAction.bind(N,"ctrl+v"),l.showAlternateBackgroundFlag=!1,l.treeNodeCellOptions.depthIncrement=14,l.treeNodeCellOptions.buildLinks=!0,l.treeNodeCellOptions.expanderStyle="triangle",l.selectNextCellOnEnterFlag=!1,l.onEndResizeOrOnReadyModelRequest((function(t){t.RowMaxNumber>=25&&t.RowMaxNumber>=l.getModelLength()&&(t.reachBottom=!0,e._processForInfiniteScroll(t,l)),l.EndResizeOrOnReadyModelRequestDone()})),l.onDragStartCell=this._onDragStartCell.bind(this),l.onDragEndCell=this._onDragEndCell.bind(this),l.onDragLeaveCell=this._onDragLeaveCell.bind(this),l.onDragOverCell=this._onDragOverCell.bind(this),l.onDropCell=this._onDropCell.bind(this),l.onDragEnterBlank=this._onDragEnterBlank.bind(this),l.onDragOverBlank=this._onDragOverBlank.bind(this),l.onDropBlank=this._onDropBlank.bind(this),l.onDragLeaveBlank=this._onDragLeaveBlank.bind(this),l.addEventListener(B.POINTERDOWN,(function(t,o){2===t.multipleHitCount&&o&&-1!==o.rowID&&e._switchExpandStatus(o)})),l.onInfiniteScroll((function(t){e._processForInfiniteScroll(t,l)})),l._getScroller()&&l._getScroller().onScrollEnd((function(){S.setTreeViewScrollerPosition(l.getScrollerPosition())})),x.subscribe({event:"reapply_tree_sort"},(({sortModel:e})=>{l.sortModel=e,l.reapplySortModel()}))},_processForInfiniteScroll:function(e,t){var o=this;if(e.reachBottom){var i=!1;if("read"==this.getCurrentTreeRootMode()){var n=this._indexModeforReadData.getInfoIndex(),r=this._indexModeforReadData.getNextStart(),s=n?n.nhits:null;isNaN(s)||(i=r<s)}i&&!this._indexModeforReadData.isInfiniteScrollingInProcess()&&(this._indexModeforReadData.setInfiniteScrollingStatus(!0),this._populateRootBookmark((function(){o._indexModeforReadData.setInfiniteScrollingStatus(!1)}),!0))}t.infiniteScrollProcessDone()},_populateRootBookmark:function(e,t){t="boolean"==typeof t&&t,oe.getSections().forEach((t=>{if(t.roots){let o={};o[t.name+"Tree"]=y[t.name+"Tree_Loading"],j.addComponentsToLoad("treeView",o);let i=null;this._folders_TreeDocument.getRoots().every((e=>(e.getType()===t.name&&(i=e),!i))),this.folderTreeMechanism=new Y({treeNodeModel:i,folderTree:this,explicitMethodToBeExecuted:e}),this.folderTreeMechanism.start()}}))},escape:function(){this._folders_TreeView.commands.escape.bind(this._folders_TreeView)()},_switchExpandStatus:function(e){!0===e.nodeModel._isExpanded?e.nodeModel.collapse():e.nodeModel.expand()},_populateFavoriteSection:function(e){var t=this;U.getFavorites({section:e.section}).then((o=>{t._rootNodes[e.section].removeChildren();var i={useAsyncPreExpand:!1};o.forEach((function(o){if(!0!==o.toRemove){i.label=o.name,i.bookmarkLabel=o.label,i.isPersonal=o.isPersonal;var n=Se(o);i.icons=n,i.children=null,i.id=o.id,i.mxid=o.mxid,i.type=o.type,i.isFavorite=!0,ie.prepareTreeData(o,i),t._createTreeNodeModel(i,t._rootNodes[e.section]).setState({state:"noChildren"})}})),e&&e.onComplete&&e.onComplete()})).catch((e=>{t._logger.warn("FolderTreeCont : unable to initialize list of Favorite Folders",e.err)}))},_refreshFavoriteSection:function(e){var t=this;t._rootNodes[e.section]?t._populateFavoriteSection(e):(t._logger.log("FolderTreeCont : FolderSection_favorite node does not yet exist"),e&&e.onFailure&&e.onFailure(new Error("FolderSection_favorite node does not yet exist")))},_cancelRootServiceHandler:function(){this._rootServiceHandler&&this._rootServiceHandler.cancel(),this._rootServiceHandler=null},_preExpandDone:function(e,t){e.preExpandDone(),0===e._options.children.length?e.setState({state:"noChildrenExpanded"}):"expanded"===e.getState()&&(0===e.getChildren().length?e.setState({state:"noChildrenExpanded"}):e.setState({state:"expanded"}));var o=this;let i=e;t&&!1===t._expandChildren||o._folderStructurePreference.isExpanded(i.pathId,(function(e,n){var r=function(e,t){i instanceof c?e[t]({updateView:!0}):i.isExpanded()&&("expand"===t&&(e.isExpanded()&&!e._virtualNodes||"expanding"===e.getState())||e[t]({onlyUI:!0}))};n&&i.setState({state:"partiallyExpanded"}),i.getChildren().forEach((function(i,n){"All"==t.expandLevel?e&&r(i,"expand"):o._folderStructurePreference.isExpanded(i.pathId,(function(e){e&&r(i,"expand")}))}))}))},_onPreExpandTreeNode:function(e){setTimeout(this.__onPreExpandTreeNode.bind(this,e))},__onPreExpandTreeNode:function(e){var t=e.data.nodeModel;let o=this._folderStructurePreference,i=o._collapsedBookmarkTreeMap.get(t.getID());var n=this._folderStructurePreference._getStoredFolderTreeStructure();if(i){var r=t.pathId.split(","),s=n;r.forEach((function(e,t){s&&t<r.length-1&&(s=s[e]||s[o._partialExpandPrefix+e])})),s&&(s[t.getID()]=i),o._collapsedBookmarkTreeMap.delete(t.getID())}if(e.data.onlyUI)return t._virtualNodes&&(Object.values(t._virtualNodes).forEach((e=>{this._addChild(t,e)})),this._folders_SortElmt.sortingChildrenNodes(t),delete t._virtualNodes),e.data.persistedData=h,void this._preExpandDone(t,e.data);var l=e.data.isAsynchronousExpansion,a=e.data.expandLevel;let d=t.sectionElement&&!!t.sectionElement.roots;if(d&&!0!==e.data.doNotRemoveNodes&&(t.removeChildren(),t.setState({state:"expanding"}),this._indexModeforReadData.resetInfoIndex()),d&&!0!==l&&null==a)return this.folderTreeMechanism=new Y({treeNodeModel:t,folderTree:this}),void this.folderTreeMechanism.start();d&&!0!==e.data.doNotRemoveNodes&&(R.clearTags(),R.refresh(!1));var c=this,u=e.data.expandedFolder,h=e.data.partiallyExpandedFolder;if(void 0===u&&(c._folderStructurePreference.getExpandedChildren(e.parent.pathId,(function(e){u=e})),c._folderStructurePreference.getExpandedChildren(e.parent.pathId,(function(e){h=e}),!0,e.data&&!0===e.data.updateView)),!0!==oe.getSection(t.section).favorite){d&&(this._applyWaitingMode(),this._cancelRootServiceHandler(),!0!==e.data.doNotRemoveNodes&&(t.removeChildren(),this._indexModeforReadData.resetInfoIndex()));var g=t.getNodeDepth();let o=t.getID()===t.section,i=o?this.getCurrentTreeRootMode():this.getCurrentTreeMode();var f={pid:o?"":t.id,next_start:this._indexModeforReadData.getNextStart(),sortModel:this._folders_TreeView.sortModel,level:e.data.expandLevel,expandList:u,partialExpandList:h,section:t.section,node:t,isRoot:o,explicitRoots:e.data.isAsynchronousExpansion?e.data.currentRootNodes:[],scrollObject:e.data.recordScrollForIndex?c._indexModeforReadData:null,onComplete:function(n,r){if(r){c._indexModeforReadData.setInfoIndex(r);let e=c._indexModeforReadData.getNextStart()+r.nresults;c._indexModeforReadData.setNextStart(e)}if((n="string"==typeof n?JSON.parse(n):n).error)return v.displayNotification({...n.error,className:"error"}),t.loadHasFailed=!0,c._preExpandDone(t,e.data),t.collapse(),void j.removeComponentToLoad("treeView",t.section+"Tree");!0!==e.data.doNotRemoveNodes&&t.removeChildren();var s=n.folders,l={0:t},a=[],d=[].concat.apply([],h);var u=t.getID()===t.section?"root":t.getID();d.indexOf(u)>=0&&a.push(t);let p=[],f=null;for(var m=0;m<s.length;m++){var _=s[m];if(!0===_.toRemove)continue;let t=Ce(_);var S=_&&_.level?parseInt(_.level):1;if(null==f&&(f=S),1===S&&o&&p.push(t.id),c._getNodesById(t.id).length>0)l[S]=c._getNodesById(t.id)[0];else{let e=f!==S;ie.prepareTreeData(_,t),l[S]=c._createTreeNodeModel(t,l[S-1],e)}e.data.expandLevel}if(p.length>0&&"read"!==i&&(R.addObjectsTags(p,!0),R.applyFilterIfAny()),t.loadHasFailed=!1,c._preExpandDone(t,e.data),e.data.expandLevel&&s.length>0){var C={onlyUI:!0,initialLevel:g,expandLevel:e.data.expandLevel,clearLast:e.data.clearLast};"All"===e.data.expandLevel?(C.expandAll=!0,t.expandNLevels(C)):(C.numberOfLevelsToExpand=e.data.expandLevel,t.expandNLevels(C))}a.forEach((function(e){e.setState({state:"partiallyExpanded"})})),c._folders_SortElmt.sortingNodesUnsensitiveCase(),t.options.children=null===t.options.children?[]:t.options.children,e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),e.data.expandEvent&&e.data.expandEvent(e.data.explicitRoots,p),j.removeComponentToLoad("treeView",t.section+"Tree")},onFailure:function(o){e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),t.loadHasFailed=!0,c._preExpandDone(t,e.data),c._logger.log("WebService folders Err : "+o),j.removeComponentToLoad("treeView",t.section+"Tree")}};"read"==i?z.listFolder({...f,indexScroll:c._indexModeforReadData,sort:c._folders_SortElmt}):(p.folderTree({...f,sort:c._folders_SortElmt}),o&&c._indexModeforReadData.resetInfoIndex())}else c._refreshFavoriteSection({section:t.section,onComplete:function(){c._preExpandDone(t,e.data),j.removeComponentToLoad("treeView",t.section+"Tree")}})},_onDragStartCell:function(e,t){I.SetAsExternalDrop(!1);var o,i=t.nodeModel,n=i.getID();o=i.getType();var r=null,s=i.getParent();s&&!s.isRoot()&&oe.isTreeType(s.getType())&&(r=s.getID());var l=void 0;if(!i.isFavorite){for(l=[];s&&!s.isRoot();){var a=s.getType();oe.isTreeType(a)?(l.push({resourceid:s.getID(),type:a}),s=s.getParent()):s=null}l.reverse()}var d={envId:T.getPlatformId(),serviceId:i.getAttributeValue("serviceId"),contextId:re.getCredential()?re.getCredential():void 0,objectId:n,objectType:o,displayName:i.getLabel(),folderId:r,parentFolderId:r};l&&(d.folderPath=l),ie.fillTreeDrag(i,d);var c={protocol:"3DXContent",version:"1.1",source:widget.getValue("x3dAppId"),widget_id:b.getWidgetId(),data:{items:[d]}};try{e.dataTransfer.setData("text/searchitems",JSON.stringify(c))}catch(e){}return e.dataTransfer.setData("Text",JSON.stringify(c)),e.dataTransfer.effectAllowed="all",b.setStartDrag(!0),b.setDragFrom("bookmark"),e.stopPropagation(),!!t.nodeModel.isFavorite},_onDragEndCell:function(e,t){if(b.setStartDrag(!1),b.setDragFrom(""),"middle"!==this._dndDropPosition&&t&&t.nodeModel.isFavorite&&t.draggedNodes.length>0&&t.draggedNodes[0].getID()!==t.nodeModel.getID()){let e=t.nodeModel.section;var o=[];this._rootNodes[e].getAllDescendants().forEach((function(e){o.push(e.id)})),U.getFavorites({section:e}).then((t=>{var i=t.slice(),n=[];function r(e){for(var t=0;t<i.length;t++)i[t].id===e&&i.splice(t,1)}for(var s=0;s<o.length;s++)t.forEach((function(e,t){e.id===o[s]&&(n.push(e),r(e.id))}));n=n.concat(i),U.saveFavorites({favoriteFolders:n,section:e}).then((()=>{console.log("Re-arrange of favorite node is successful")})),v.displayNotification({message:y.get("msg_success_favoriteReordered"),className:"success"})})).catch((e=>{console.log(e.err)}))}},_onDragLeaveCell:function(e,t){var o=this;return o._timerDragEnter&&(clearTimeout(o._timerDragEnter),o._timerDragEnter=null),o._currentDragEnterFolder=null,!0},_onDragOverCell:function(e,t){var o=this;if(e.preventDefault(),1==widget.launchWithReadMode)return;var i=t.nodeModel;let n=!0;return e&&e.dataTransfer&&(n=ie.isDropAuthorized({type:i.getType(),silent:!0},i,e),n&&"FolderSection_Trash"!==i.getType()||(e.dataTransfer.dropEffect="none")),t&&(!t.nodeModel.isFavorite||t.draggedNodes&&!t.draggedNodes[0].isFavorite)&&(t.dropPosition="middle"),this._dndDropPosition=t.dropPosition,o._currentDragEnterFolder&&o._timerDragEnter&&o._currentDragEnterFolder!==t.nodeModel.getID()&&(clearTimeout(o._timerDragEnter),o._timerDragEnter=null),o._currentDragEnterFolder===t.nodeModel.getID()||t.nodeModel.isExpanded()||"expanding"===t.nodeModel.getState()||(o._timerDragEnter=setTimeout((function(){t.nodeModel.expand()}),o.time_to_expand_node)),o._currentDragEnterFolder=t.nodeModel.getID(),n},_onDropCell:function(e,t){e.preventDefault();let o=t.nodeModel;if(!0===o.isFavorite&&t.droppedNodes&&1===t.droppedNodes.length&&t.droppedNodes[0].isFavorite)return!0;if(1!=widget.launchWithReadMode){if(!t.cellModel||!t.dropPosition)return!0;var i=this;I.SetAsExternalDrop(!0),i._timerDragEnter&&(clearTimeout(i._timerDragEnter),i._timerDragEnter=null),i._currentDragEnterFolder=null,b.performDropOnFolderEditorNode(o,e),b.setDragFrom("")}else v.displayNotification({message:y.msg_warning_DndNotSupported,className:"warning"})},_onDragEnterBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none")},_onDragLeaveBlank:function(e,t){this._timerDragEnter&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterFolder=null},_onDragOverBlank:function(e,t){},_onDropBlank:function(e,t){b.setDragFrom("")},_shouldAcceptDrag:function(e){var t=this._getSelectedBookmark();return t&&oe.isTreeType(t.getType())},_shouldAcceptDrop:function(e){return e&&e.dropNode.isFavorite&&("middle"!==e.dropPosition||!e.draggedTreeNodeModel.isFavorite)},onFavoriteRenamed:function(e){var t=e.favoriteTitle;this._rootNodes[e.section].getChildren().forEach((o=>{o.id===e.id&&(o.prepareUpdate(),o.setLabel(t),o.pushUpdate())}))},removeFavorite:function(e,t){e=Array.isArray(e)?e:[e];let o=U.removeFavorites(e,t);return o.catch((e=>{this._logger.warn(e)})),o},updateTreeWithNewFolder:function(e,t){var o=this,i=void 0;if("string"==typeof e)i=o._getVisibleNodeById(e,null);else{for(let t in this._rootNodes){(!oe.getSection(t).favorite&&e instanceof f&&this._rootNodes[t].isAscendantOf(e)||this._rootNodes[t]===e)&&(i=e.isVisible()?e:null)}void 0===i&&(i=o._getVisibleNodeById(e.id,null))}if(i){let e=i.getID()===i.section;p.folderTree({isRoot:e,pid:e?"root":i.id,section:i.section,sort:o._folders_SortElmt,onComplete:function(e){e=JSON.parse(e),o.refreshTreeWithServerData(e.folders,i,{clearChildren:!0,newFolderId:t})},onFailure:function(e){o._logger.log("WebService folders Err : "+e)}})}},refreshTreeWithServerData:function(e,t,{clearChildren:o,newFolderId:i}){var n=S.generateJSON(e);if(o){var r,s,l=t.getChildren().slice(0),a=0;for(UWA.is(l)&&(a=l.length),r=0;r<a;++r)n[(s=l[r]).id]||this.removeFromTree(s),delete n[s.id]}let d=null;if(t.sectionElement&&t.sectionElement.roots)d=t.sectionElement.roots[0];else{let e=oe.getSection(t.section);e.sub&&e.sub.types&&(d=e.sub.types[0])}for(var c in n){var u={useAsyncPreExpand:!0},p=Se(s=n[c]);if(u.label=s.label,u.relationOrder=s.TreeOrder,u.relId=s.relId,u.icons=p,u.children=[],u.id=c,u.mxid=s.mxid,u.type=s.type?s.type:d,u.created=s.created,i&&i===c){let e={};e[i]={modified:new Date(u.created).getTime()/1e3},R.addObjectsToRemoveFromFiltering(e)}ie.prepareTreeData(s,u),this._createTreeNodeModel(u,t)}this._folders_SortElmt.sortingNodesUnsensitiveCase(),R.applyFilterIfAny()},removeNodesFromTree:function({nodes:e}){this._folders_TreeDocument.withTransactionUpdate((()=>{e.forEach((e=>{this.removeFromTree(e)}))}))},removeFromTree:function(e){if(e){var t,o;if(!(e instanceof f&&e.getParent())){e=this._getVisibleNodeById(e.id)}if(e){let i=!1;for(let n in this._rootNodes)if(!oe.getSection(n).favorite&&this._rootNodes[n].isAscendantOf(e)){i=!0,e.isVisible()&&(t=e,o=e.getParent());break}i||(t=this._getVisibleNodeById(e.id,null),o=t?t.getParent():null)}o&&t&&(!0===o.hasChildren()&&o.removeChild(t),!1===o.hasChildren()&&(o.withTransactionUpdate((function(){o.setState({state:"collapsed"})})),o.options.children=[])),e&&e.isFavorite&&this.removeFavorite({id:e.getID()},e.section)}},updateNodeLabel:function(e,t){var o=this,i=[],n=UWA.is(e,"string")?e:e.physicalid?e.physicalid:null;i=n?this._getNodesById(n):[e];var r=function(e){m.getCurrentBookmarkId();i.forEach((function(t){if(t.getLabel()!==e){t._lastUpdateTime=Date.now();var o=UWA.extend(t.options,{label:e,oldLabel:e},!0);t.withTransactionUpdate((function(){t.updateOptions(o)}))}}))};if(i.length>0)if(t)r(t),this._folders_SortElmt.sortingChildrenNodes(i[0].getParent());else if(UWA.is(i[0].getID,"function")){var s=i[0].getID();p.getFolderProperties({pid:s}).then((e=>{if(Object.keys(e).length>0){var t=e.label;r(t),ie.updateTreeNode(i[0],e),o._folders_SortElmt&&o._folders_SortElmt.sortingChildrenNodes(i[0].getParent())}else console.error(`${i[0].getID()} is not accessible, so it is removed from the tree.`),i[0].remove()})).catch((()=>{console.error("Unable to update Tree Label, Error in getting folder Properties")}))}},updateNodeAttr:function(e){var t=this;let o=t._getNodesById(e.parentNode.id)[0];var i,n=[];1==e.data.length?(i=e.getId(),n=this._getNodesById(i)):n=e.data,new l(((e,i)=>{n&&n.length>0&&o.options.children&&o.options.children.length>0?(o.withTransactionUpdate((function(){n.forEach((function(e){let i=e.TreeOrder;if(e=t._getNodesById(e.id,o)[0]){e._lastUpdateTime=Date.now();var n={relationOrder:i};e.updateOptions(n)}}))})),e()):e()})).then((()=>{this._folders_SortElmt._toggleButton("TreeOrder")}))},_updateFilterIconOnToolbox:function(){this.leftToolbar.updateNodeModel("Filter",{visibleFlag:!0})},_getExistingPathOfBookmark:function(e,t){let o=this._getVisibleNodeById(e,t),i=null;if(o){let e=o.getParents();e.unshift(o),i=[],e.forEach((e=>{oe.isSection(e.getType())||i.unshift({id:e.getID(),mxid:e.options.mxid,type:e.getType(),label:e.getLabel()})}))}return i},getSelectedBookmarkPath:function(){let e=null,t=null;return t||(t=m.getCurrentBookmarkId(),e=m.getCurrentBookmarkSection()),t?this.getExistingBookmarkPath(t,e):[]},getExistingBookmarkPath:function(e,t){e=e||m.getCurrentBookmarkId(!0);let o=this.findExistingBookmarkLocation([e],{},t),i=o.expands,n=i.length>0?i[0]:null;if(!n&&o.visibleNodes.length>0){let i=this._getExistingPathOfBookmark(o.visibleNodes[0].getID(),t);i&&(n={},n[e]=i)}return n},findExistingBookmarkLocation:function(e,t,o){var i=[];let n=[],r=[];for(var s=0;s<e.length;s++){let l=!1,a=e[s],d=this._getVisibleNodeById(a,o);if(d)l=!0,r.push(d);else if(t&&t.parents){let e=t.parents[a],n=this._getExistingPathOfBookmark(e,o);if(n){l=!0,n.push({id:a,type:t.folderToFindAndSelect.type});let e={};e[a]=n,i.push(e)}}l||n.push(a)}return{expands:i,visibleNodes:r,notFound:n}},expandTreeAndSelectFolder:function(e){if(e.folderToFindAndSelect=e.folderToFindAndSelect?e.folderToFindAndSelect:{},!1!==e.withLoader){let r=e.onComplete,s=e.onGiveUp,a=e.onFailure;function d(e,...t){j.removeComponentToLoad("treeView","expandAndSelect"),e&&e(...t)}j.addComponentsToLoad("treeView",{expandAndSelect:y.replace(y.ExpandAndSelect_Loading,{typeStruct:oe.getTreeTypeNls(e.folderToFindAndSelect.type)})}),e.onComplete=d.bind(this,r),e.onGiveUp=d.bind(this,s),e.onFailure=d.bind(this,a)}let t=null;t=e.folderToFindAndSelect.type?oe.getDefaultSection(e.folderToFindAndSelect.type):this.getSelectionSection();var o=this,i=e.folderToFindAndSelect.ids,n=!0;if(e.findInTree&&n&&(this.findInTree=!0,e.findInTreeLoader.setMessage(q.loader.formulatingPaths),e.findInTreeLoader.loader&&e.findInTreeLoader.loader.addEventListener(B.POINTERHIT,(function(t){if(n=!1,e.onComplete){var o={folderToFindAndSelect:e.folderToFindAndSelect};e.onComplete(o)}}))),i&&n){let c={notFound:[],visibleNodes:[],expands:[]},u=[],p=[];i.forEach((e=>{let t=this._rootNodes[e];t?p.push(t):u.push(e)})),(i=u).length>0&&(c=this.findExistingBookmarkLocation(i,e)),p.length>0&&p.forEach((e=>c.visibleNodes.push(e)));let h=[];c.expands.forEach((e=>h.push(l.resolve(e))));let g=c.notFound;c.visibleNodes.length>0&&(e.doNotSelectInTree||m.getCurrentBookmarkId()===c.visibleNodes[0].getID()&&(o._scrollToVisibleNode(c.visibleNodes[0]),c.visibleNodes[0].select(!0))),g.length>0&&n&&h.push(new l((i=>{E.getBookmarksPath(t,g).then((e=>{n&&i(e)})).catch((t=>{o._logger.warn("Unable to retrieve FolderPath using WebService"),e.onFailure&&(t||!1!==e.withLoader)&&e.onFailure(t)}))}))),e.selectedFolderIdAtInitialState=m.getCurrentBookmarkId(),l.allSettled(h).then((async t=>{if(t.length>0){let o={};t.forEach((e=>{if("fullfilled"===e.state)for(var t in e.value)o[t]=e.value[t];else e.reason&&console.log(e.reason)}));let r=!0;if(Object.keys(o).length>0){let e=Object.keys(o)[0],t=o[e],i=t.length>0&&t[0].type,n=this.getSelectionSection(i,{defaultIfFavorite:!0}),s=this._rootNodes[n],l=s.pathId,a=!s.sectionElement.type,d=l,c=o[e],u=c[0];r=oe.isRootElement(u.type,n),r&&(c.forEach(((e,t)=>{(a||0!==t)&&(d=d+","+e.id)})),this._folderStructurePreference.add(d,void 0,{exceptLast:!0},!0),await this._waitBookmarkPathReady(d.split(",")))}r?this._expandFolder(0,o,e,n):(i.length>0&&this._folders_TreeDocument.unselectAll(),e.onComplete&&e.onComplete())}else if(e.onComplete){var o={folderToFindAndSelect:e.folderToFindAndSelect};e.onComplete(o)}}))}else o._logger.log("expandTreeAndSelectFolder error : folderToFindAndSelect is undefined"),e.onFailure&&e.onFailure("Tree exploration stopped, folderToFindAndSelect is undefined")},expandStructureWithPath:function(e,{paths:t,objectsMapping:o,allPhysicalIds:i}){e=Array.isArray(e)?e:[e],this._folders_TreeDocument.withTransactionUpdate((()=>{let e={};t.forEach((t=>{let n=-1;for(let e=t.length-1;e>=0&&(i.has(t[e])&&(n=e),!(n>0));e-=2);if(n>=0){let i=e[t[0]],r=i||this._getNodesById(t[0])[0];if(r&&t.length>1){e[t[0]]=r;let s=[];for(let e=2;e<=n;e+=2)s.push(t[e]);this._folderStructurePreference.add(r.pathId+","+s.join(","),void 0,{exceptLast:!0},!0);for(let i=2;i<=n;i+=2){let s=t[i],l=e[s];if(l){r=l;continue}let a=t[i-1],d=o[a],c=o[s],u=this._getNodesById(s,r)[0];if(!u&&r){let e=z.convertV2Object(c,d),t=Ce(e);ie.prepareTreeData(e,t),r=this._createTreeNodeModel(t,r),n!==i&&r.expand({onlyUI:!0})}else r=u,"collapsed"===r.getState()&&n!==i&&r.expand({onlyUI:!0});e[s]=r}i||"collapsed"!==e[t[0]].getState()||e[t[0]].expand({onlyUI:!0})}}})),this._folders_SortElmt.sortingNodesUnsensitiveCase()}))},_expandParent:function(e,t,o,i,n){var r=t+","+o;n.doNotSelectInTree?(this._folderStructurePreference.scrollAfterSelect(""),this._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId=r):this._folderStructurePreference.scrollAfterSelect(o);let s=l.resolve();return"expanding"!==e.getState()&&i&&(s=new l((function(t,o){try{if(!1!==n.withLoader){let t={};t[e.section+"Tree"]=y[e.section+"Tree_Loading"],j.addComponentsToLoad("treeView",t)}e.expand({updateView:!0,postExpandResolvePromise:function(){j.removeComponentToLoad("treeView",e.section+"Tree"),t()}})}catch(t){j.removeComponentToLoad("treeView",e.section+"Tree"),console.log(t),o()}}))),s},getSelectionSection:function(e,{defaultIfFavorite:t}={}){let o=this._getSelectedBookmark(),i=null,n=!1;if(o){i=o.getRoot().section;let r=oe.getSection(i);!e||r&&t&&r.favorite||(n=oe.isTreeType(e,i))}return!n&&e&&(i=oe.getDefaultSection(e)),i},_expandFolder:function(e,t,o,i){let n=Object.keys(t),r=[];var s=t[n[e]];if(o.findInTree){var a=e/n.length*100;o.findInTreeLoader.updateLoader(a.toString())}if(!s&&t.error&&(this._logger.warn("Unable to retrieve FolderPath using WebService"),o.onFailure))return o.onFailure(t.error);if(!function(e){var t=!1;if(m.getCurrentBookmarkId()!==e.selectedFolderIdAtInitialState&&(t=!0,e.onGiveUp)){var o={folderToFindAndSelect:e.folderToFindAndSelect};e.onGiveUp(o)}return t}(o)){let t=this._rootNodes[s.length>0&&s[0].section];if(!t){let e=s.length>0&&s[0].type,o=this.getSelectionSection(e,{defaultIfFavorite:!0});t=this._rootNodes[o]}if(t){for(var d=null,c=null,u=t,p=u.pathId,h=0;h<s.length;h++){var g=s[h],f=g.id;if(oe.isRootElement(g.type,t.section)&&(c=f),f){if(!d){var v=this._getVisibleNodeById(f,u);v&&v.isVisible()?(u=v,p=v.pathId):d=u}if(d){var _=p;u=null,p=p+","+f;let e={};o.partiallyExpandPath&&(_=p,e.exceptLast=!0),this._folderStructurePreference.add(_,null,e,o.partiallyExpandPath)}}else this._logger.log("unexpected undefined parentObjectId")}c&&d?r.push(this._expandParent(d,_,n[e],i,o)):console.log("No parent found")}else this._logger.log("  No FolderSection_AllFolders to start expandTreeAndSelectFolder"),o.onFailure&&o.onFailure(y.msg_error_TreeExpandCancelledNotReady)}e!==Object.keys(t).length-1&&i?(e+=1,l.allSettled(r).then((()=>{this._expandFolder(e,t,o,i)}))):l.allSettled(r).then((function(){if(o.onComplete&&i){var e={folderToFindAndSelect:o.folderToFindAndSelect};o.onComplete(e)}}))},_getNodesById:function(e,t){var o=[],i=[],n=this;t?o=[t]:n._folders_TreeDocument.getRoots().forEach((function(e){e&&"FolderSection_favorite"!==e.getType()&&o.push(e)}));return o.forEach((function(t){t.getID()==e&&i.push(t);var o=t.getChildren();UWA.is(o,"array")&&o.forEach((function(t){n._getNodesById(e,t).forEach((function(e){i.push(e)}))}))})),i},__getVisibleNodeById:function(e,t){var o=t||this._rootNodes[oe.getDefaultSection()],i=null;if(o&&o.isVisible())if(o.getID()===e)i=o;else if(o.isExpanded()){var n=o.getChildren();if(Array.isArray(n)&&n.length>=1)for(var r=0;r<n.length;r++){var s=n[r];if(s){if(s.id==e){i=s;break}var l=this.__getVisibleNodeById(e,s);if(l&&l.isVisible()){i=l;break}}}}return i},_getVisibleNodeById:function(e,t){var o=null;if("string"==typeof t&&(t=this._rootNodes[t]),t)o=this.__getVisibleNodeById(e,t);else for(let t in this._rootNodes)if(oe.isTreeSection(t)){let i=this._rootNodes[t];if(null!==(o=this.__getVisibleNodeById(e,i)))break}return o},_folderStructurePreference:{_prefixes:["_X_","_P_"],_partialExpandPrefix:"_P_",_removeCollapsed:!0,_collapsedBookmarkTreeMap:new Map,_getID:function(e,t){if(e[t])return e[t];for(var o=0;o<this._prefixes.length;++o){var i=e[this._prefixes[o]+t];if(i)return i}return null},_getPreferenceID:function(e,t){var o=this;if(e[t])return t;for(var i=0;i<o._prefixes.length;++i)if(e[o._prefixes[i]+t])return o._prefixes[i]+t;return t},_scrollToNode:function(){return"scrollToNode - "+T.getPlatformId()},_getPreferenceTree:function(e){return e||(e={}),e},_getStoredFolderTreeStructure:function(){let e=this._storedStructure;if(!e){e=widget.getValue(oe.getPrefPrefix().toLowerCase()+"TreeStructure");try{e=e?JSON.parse(_.jsonUnzip(e)):{}}catch(t){e={}}e=this._getPreferenceTree(e),this._storedStructure=e}return e},add:function(e,t,o,i){var n=this;function r(e,t){for(var o=0;o<n._prefixes.length;++o)if(e[n._prefixes[o]+t])return e[t]=e[n._prefixes[o]+t],void delete e[n._prefixes[o]+t]}if(!o||!0!==o.isFailure){var s=this._getStoredFolderTreeStructure();let d=o&&!0===o.exceptLast;var l=e.split(","),a=s;l.forEach((function(e,o){a[e]||a[n._partialExpandPrefix+e]?!1===t&&(r(a,e),o==l.length-1&&(a[e]={})):!d||o<l.length-1?i&&(!d||o<l.length-1)?a["_X_"+e]?(a[n._partialExpandPrefix+e]=a["_X_"+e],delete a["_X_"+e]):a[n._partialExpandPrefix+e]={}:!function(e,t){for(var o=0;o<n._prefixes.length;++o)if(e[n._prefixes[o]+t])return!0;return!1}(a,e)?a[e]={}:r(a,e):a["_X_"+e]={},o!=l.length-1||i||r(a,e),a=a[e]?a[e]:a[n._partialExpandPrefix+e]})),n.saveFolderStruture(s)}},remove:function(e,t){var o=this,i=this._getStoredFolderTreeStructure(),n=e.split(","),r=i,s=!1;n.forEach((function(e,i){r&&(i<n.length-1?(i==n.length-2&&r[o._partialExpandPrefix+e]&&(s=!0),r=o._getID(r,e)):(!t&&(r[e]&&Object.keys(r[e]).length>0||r[o._partialExpandPrefix+e]&&Object.keys(r[o._partialExpandPrefix+e]).length>0||s)&&(s?r["_X_"+e]=r[e]?r[e]:r[o._partialExpandPrefix+e]:(o._collapsedBookmarkTreeMap.set(e,r[e]),delete r[e])),t&&r["_X_"+e]?delete r["_X_"+e]:r[e]?delete r[e]:delete r[o._partialExpandPrefix+e]))})),o.saveFolderStruture(i)},isExpanded:function(e,t){var o=this,i=this._getStoredFolderTreeStructure(),n=e.split(","),r=!1,s=!1,l=i;n.forEach((function(e,t){l&&t<n.length-1?l=o._getID(l,e):l&&(s=void 0!==l["_P_"+e],r=void 0!==l[e]||s)})),t.call(window,r,s)},recursive:function(e,t,o,i){var n=this;function r(e){return e.replace(n._partialExpandPrefix,"")}var s=null,l=e?Object.keys(e).length:0,a=0===o.length?[]:o[o.length-1];function d(e,t){var i=!!s?s:a;l>1&&!t&&(s=i.slice()),i=t?[]:i,o.indexOf(i)<0&&o.push(i),i.push(e)}for(var c in e){var u=-1!==c.indexOf(n._partialExpandPrefix),p=-1!==c.indexOf("_X_");if(e[c])if(i){var h=-1!==t.indexOf(n._partialExpandPrefix);p?h&&d(c.replace("_X_","")):(u?d(r(c),!h):h&&d(c),this.recursive(e[c],c,o,i))}else p||(u||o.push(r(c)),this.recursive(e[c],c,o,i))}},getExpandedChildren:function(e,t,o,i){var n=this,r=this._getStoredFolderTreeStructure(),s=e.split(","),l=[],a=r;s.forEach((function(e,t){if(a&&t<s.length-1)a=n._getID(a,e);else if(a){var r=n._getID(a,e),d=n._getPreferenceID(a,e),c=-1!==d.indexOf(n._partialExpandPrefix);if(o&&c&&i){var u=d.replace(n._partialExpandPrefix,"");u=oe.isRootSection(u)?"root":u,l.push([u])}n.recursive(r,d,l,o)}})),t.call(window,l)},saveFolderStruture:function(e){ye.call(this,e)},isSelected:function(e){return m.getCurrentBookmarkId()===e.getID()&&oe.getSection(e.section)&&!oe.getSection(e.section).favorite},isSelectValuated:function(){return!!m.getCurrentBookmarkId()},getSelection:function(){return m.getStoredSelection()},scrollAfterSelect:function(e){widget.setValue(this._scrollToNode(),e)},doScrollAfterSelect:function(e){return widget.getValue(this._scrollToNode())===e}},_indexModeforReadData:{_indexInfo:null,_nextStart:0,_infinteScrollinginProcess:!1,isInfiniteScrollingInProcess:function(){return this._infinteScrollinginProcess},setInfiniteScrollingStatus:function(e){this._infinteScrollinginProcess=e},getInfoIndex:function(){return this._indexInfo},getNextStart:function(){return this._nextStart},setNextStart:function(e){this._nextStart=e},resetInfoIndex:function(){this._indexInfo=null,this._nextStart=0,this._infinteScrollinginProcess=!1},setInfoIndex:function(e){this._indexInfo=e||null}},_scrollOnPostUpdateView:function(e){var t=this,o=this._folders_TreeView?this._folders_TreeView:null;o&&o.onPostUpdateViewOnce((function(){if(t._folderStructurePreference.doScrollAfterSelect(e)){let o=t._getVisibleNodeById(e);t._scrollToVisibleNode(o),t._folderStructurePreference.scrollAfterSelect("")}}))},_doScrolltotheSavedPosition:function(){var e=this._folders_TreeView;if(e._getScroller()){var t=S.getTreeViewScrollerPosition();void 0!==t.x&&null!==t.x&&void 0!==t.y&&null!==t.y&&e.setScrollerPosition(t)}},_createTreeNodeModel:function(e,t,o,i){var n=this,r=t instanceof c,s=e.publishOnConnect;delete e.publishOnConnect,e.grid||(e.grid={});var l=new f(e);if(l.getAttributeValue=e=>l.options[e]||l[e],l.id=e.id,l.type=e.type,l.owner=e.owner,l.section=l.section?l.section:t.section,e.isFavorite&&(l.isFavorite=!0,l.bookmarkLabel=e.bookmarkLabel,l.getLabel=function(){var e=this.bookmarkLabel;return e&&""!==e||(e=this.Label),e}),e.created&&(l.created=e.created),l._instanceType="FolderEditor/TreeNodeModel",l._loadingcounter=0,l.getID=function(){var e=this.id;return e&&""!==e||(e=this.type),e},l.getType=function(){return this.type},l.options.oldLabel=e.label,l.pathId=(r?"root":t.pathId)+","+l.getID(),"TRUE"===s){var a=u.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png");l.setBadges({bottomRight:a})}if(ie.completeTreeNode(l,e,t),A.isActiveBookmarkActivated()){var d=A.getActiveFolder(),p=d.id,g=d.disabledId;p===l.id&&!0!==e.isFavorite?l.setBadges({topRight:h.ICON_ACTIVE}):g===l.id&&!0!==e.isFavorite&&l.setBadges({topRight:h.ICON_ACTIVE_DISABLED})}return l.onPostExpand((function(e){if(C.notifyTreeUpdate(),!e||!e.data||!0!==e.data.updateView&&!e.data.onlyUI||e.data.expandLevel){var t=!1;!1!==e.data.clearLast&&e.data.nodeModel.getNodeDepth()-e.data.initialLevel==e.data.expandLevel-1||(t=!0),n._folderStructurePreference.add(this.pathId,t,{isFailure:!0===this.loadHasFailed})}else e.data.postExpandResolvePromise&&e.data.postExpandResolvePromise()})),l.addEventListener("preCollapseAll",(function(){n.deactivatePostCollapse=!0})),l.addEventListener("postCollapseAll",(function(){n.deactivatePostCollapse=!1,n._folderStructurePreference.remove(this.pathId,!0)})),l.onPostCollapse((function(e){!0===n.deactivatePostCollapse||e.data.updateView||n._folderStructurePreference.remove(this.pathId),C.notifyTreeUpdate()})),de(l).subscribe({event:"removeChild"},(function(e){if(l.isExpanded()&&l.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&n._folderStructurePreference.remove(t.pathId)}})),de(l).subscribe({event:"addChild"},(function(e){if(l.isExpanded()&&l.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&t._isExpanded&&n._folderStructurePreference.add(t.pathId)}})),o?(t._virtualNodes||(t._virtualNodes={}),t._virtualNodes[l.getID()]=l):this._addChild(t,l,i),l},_addChild:function(e,t,o){let i=this;if(e instanceof c)e.addRoot(t,o),this._folderStructurePreference.isExpanded(t.pathId,(function(e){e&&t.expand({updateView:!0})}));else{let n="partiallyExpanded"===e.getState();n&&i._folderStructurePreference.add(t.pathId,void 0,{exceptLast:!0},!0),e.addChild(t,o),n&&e.setState({state:"partiallyExpanded"})}if(i._folderStructurePreference.isSelected(t)){for(var n=t;null!=n&&!n.isVisible();)n=n.getParent();n===t?t.select():de(t.getParent()).subscribeOnce({event:"postExpand"},(function(){t.getTreeDocument()&&t.getTreeDocument().getXSO().empty(),t.select()}))}else t.pathId===i._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId&&(this.findInTree||(m.dispatchBookmarkNodeSelection(t),i._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId=void 0));return t},__onContextualMenuReady:function(e){return new l((function(t){var o=e.cellInfos;if(o.cellModel){var i=!1;if(o.nodeModel)if(!1===o.nodeModel._isSelected&&(o.nodeModel._isSelected=!0,m.dispatchBookmarkNodeSelection(o.nodeModel)),!0===o.nodeModel._isSelected)(o.nodeModel?o.nodeModel:o.cellModel)&&(i=!0);i?D.GetContextualMenu(o,"TREE",e).then((function(e){e&&t(e)})):t([])}else t([])}))},getSectionNode:function(e){for(var t=null,o=this._folders_TreeDocument.getRoots(),i=0;i<o.length;i++)if(o[i].getType()==e){t=o[i];break}return t},refreshOnDelete:function(e){let t=this._getSelectedBookmark();for(var o=!1,i=0;i<e.length;i++){var n=e[i];for(let e in this._rootNodes){let t=!0===this._rootNodes[e].sectionElement.favorite&&U.isFolderAmongFavoriteFolders({id:n},e);t&&this.removeFavorite({id:n,name:t.getLabel()},e)}if(t&&n===t.getID()){o=!0;break}if(t&&t.isExpanded()&&t.hasChildren())for(var r=t.getChildren(),s=0;s<r.length;s++){var l=r[s];l.id===n&&this.removeFromTree(l)}}if(!0===o){var a=t.getParent();a&&(this.removeFromTree(t),m.dispatchBookmarkNodeSelection(a))}w.publish("FolderEditor.ActiveFolderCheck",{})},refreshOnNew:function({expandCurrent:e,objectId:t}){let o=this._getSelectedBookmark();if(o){let n=o.isFavorite?this._getVisibleNodeById(o.getID()):o;var i="partiallyExpanded"===n.getState();null!==n&&n.isExpanded()&&!i?this.updateTreeWithNewFolder(n,t):!0===o.isFavorite||o.isExpanded()&&!i||!0!==e||o.expand()}},refreshView:function(e){e&&!0===e.creation?this.refreshOnNew(e):this.refreshAll()},refreshAll:function(){if(!this._folderStructurePreference.isSelectValuated()){let e=this._getSelectedBookmark();e&&e.unselect(),m.dispatchBookmarkNodeSelection(this._rootNodes[e.section])}for(let e in this._rootNodes)if(this._rootNodes[e].isExpanded()){let t={};t[e+"Tree"]=y[e+"Tree_Loading"],j.addComponentsToLoad("treeView",t),this._rootNodes[e].collapse({updateView:!0}),this._rootNodes[e].expand({updateView:!0})}},_switchFolderTreeNodeLabelToWriteView:function(e){try{var t=!1;if(e instanceof f&&oe.isTreeType(e.getType())&&e.getTreeDocument()===this._folders_TreeDocument&&this._folders_TreeView){var o=this._folders_TreeView;if(o){var i=o.layout.getColumnIndex("tree"),n=o.layout.getCellsFromNodeModel(e)[i];o.setCellInEdition(n),t=!0}}return t}catch(e){}},getFindInTreeIcon:function(){return this._folders_FindInTree.elements.container},_scrollToVisibleNode:function(e){var t=this._folders_TreeView,o=t.layout.getColumnIndex("tree"),i=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:i})},modeChange:function(e){if(!1!==widget.getValue("compactModeForLeftSidebar")){var t=this._folders_TreeView.layout.cellHeight,o=t;if("comfortable"===e.viewMode)o=38,this._folders_FindInTree.elements.container.setStyle("height",38),this.elements.container.setAttribute("Compact",!1),this._commonToolSection.setAttribute("Compact",!1);else{if("compact"!==e.viewMode)return;o=26,this._folders_FindInTree.elements.container.setStyle("height",23),this.elements.container.setAttribute("Compact",!0),this._commonToolSection.setAttribute("Compact",!0)}var i=o!==t;this._folders_TreeView.layout.cellHeight=o,i&&this._folders_TreeView.updateView(!0)}},getCommonToolSection(){return this._commonToolSection},getGridViewRowHeight:function(){let e=S.densityHeight.compact,t=this._folders_TreeView.layout;return t&&(e=t.getRowHeight()),e}});return be}));