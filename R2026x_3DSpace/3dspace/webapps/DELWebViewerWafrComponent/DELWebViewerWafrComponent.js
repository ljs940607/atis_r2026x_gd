define("DS/DELWebViewerWafrComponent/DELWeb3DViewerComponent",["UWA/Core","DS/DELWebOERCommonUtils/DELWebBaseComponent","DS/DELWebViewerControllerV2/Controller","DS/DELWebViewerComponent/MappingKeys","DS/DELWebViewerLogger/Logger","DS/PADUtils/PADSettingsMgt","DS/DELWebViewerUtils/DELWebViewerSettingsMgt","i18n!DS/DELWebViewerWafrComponent/assets/nls/NLS"],(function(e,t,i,r,n,s,o,a){"use strict";const h={MfgItemsViewer:0,ProcessViewer:1,WorkInstructionViewer:2};return class extends t{constructor(e={}){if(super(e),this.configModule=e.appConfigPath||"DS/DELWebViewerWafrComponent/assets/json/ViewerConfig.json",this.enopadViewerIdentifier=e.enopadViewerIdentifier,!this.configModule||!this.enopadViewerIdentifier)throw new Error("Invalid input, appConfigPath and enopadViewerIdentifier is mandatory, please check the input params")}async initialize(t={}){let n,g=this,l=this.getComponentFromIdentifier(this.enopadViewerIdentifier),d=await new Promise((e=>{require([`text!${g.configModule}`],(function(t){e(JSON.parse(t))}))}))||{};if(!d.delviewer&&!t.delviewer)throw new Error("Component configuration is not valid, please check the format of the json or input options");d.delviewer=e.extend(d.delviewer||{},t.delviewer,!0),n=e.merge(d.delviewer,{mappingKeys:r,viewerType:h.MfgItemsViewer,loggerSeverity:"LOG",performanceLogging:!1,dynamicBuildUp:!0,NodeInfraBuildUp:!0,forceLoad:!0,startUpView:{setViewpoint:!0,enable:!0},executionContext:g.getExecutionContext(),statusBar:{commands:["LastIndexingTime"]}}),await super.initialize(),s.setSetting("enopad3dviewer_graphDefinitionForExpand",this.getGraphForExpand()),o.setDELViewerSettings(n),g.vwrCtrl=new i(n,h,{nls:a},l);let p=g.getEventHnd();for(let t in p.events)if(Object.prototype.hasOwnProperty.call(p.events,t)){let i=p.events[t];p.subscribe(i,function(t,i){t&&(e.is(i,"array")?i.forEach((e=>{var i={};Object.assign(i,e,{path:e.paths}),delete i.paths,this.publish({event:t,data:{data:i}})})):this.publish({event:t,data:{data:i}}))}.bind(g,i))}await new Promise(((e,t)=>{try{let t=g.getEventHnd().subscribe(g.getEventHnd().events.onReady,(function(i){g.getEventHnd().unSubscribe(t),e(i)}))}catch(e){g.logger.error(e),t(`Unable to initialize DELWeb3DViewerComponent due to ${JSON.stringify(e)}`)}}))}getGraphForExpand(){return{descending_condition:null,descending_condition_relation:{uql:"((flattenedtaxonomies:reltypes/DELFmiFunctionInstance) AND (expand3d:true)) OR \n                           ((flattenedtaxonomies:types/DELFmiProcessImplementCnx) AND (expand3d:true)) OR \n                           ((flattenedtaxonomies:types/DELFmiProcessOutputPrereqMaterializationCnx) AND (expand3d:true)) OR \n                           ((flattenedtaxonomies:reltypes/VPMInstance) OR (flattenedtaxonomies:reltypes/VPMRepInstance))"},descending_condition_object:null}}getEventHnd(){return this.vwrCtrl.getEventHnd()}getViewerTypesEnum(){return h}getViewerBehavior(){return this.vwrCtrl.getViewerBehavior()}async destroy(){this.vwrCtrl&&(this.vwrCtrl.destroy(),this.vwrCtrl=null),await super.destroy()}async clean(){await this.getViewerBehavior().empty(),await super.clean()}getFilterProxy(){return this.getComponentFromIdentifier(this.enopadViewerIdentifier).getBIController().getBIProxy()}getNGFUXID(){return this.getComponentFromIdentifier(this.enopadViewerIdentifier).getNGFUXID()}getDELViewerFilterProxy(){return this.vwrCtrl.getFilterBIProxy()}getDELViewerNGFUXID(){return this.vwrCtrl.getNGFUXID()}getRoots(){return this.getComponentFromIdentifier(this.enopadViewerIdentifier).getRoots()}getRirPathFromSubPath(e={}){let t=e.path,i=this.getExecutionContext().getComponent("Viewer").getController(),r={...e,path:[]};return Array.isArray(t)&&t.forEach((e=>{let t=i.getIdPathesLeadingToReference(e.at(-1));if(t){let i=[];t.forEach((t=>{if(t&&t.ids&&t.ids.length>0){t.ids.toString().includes(e.toString())&&i.push(t.ids)}})),r.path=[...r.path,...i]}})),r}prepareHighlightParams(e){let t=e;return e.matchAnyPath&&(t=this.getRirPathFromSubPath(e)),t}highlight(e){let t=this.getViewerBehavior(),i=this.prepareHighlightParams(e);t.highlightNode(i)}unhighlight(e){let t=this.getViewerBehavior(),i=this.prepareHighlightParams(e);t.unHighlightNode(i)}getExposedComponent(){return this.publicAPI=super.getExposedComponent(),this.publicAPI.getEventHnd=this.getEventHnd.bind(this),this.publicAPI.getViewerBehavior=this.getViewerBehavior.bind(this),this.publicAPI.getViewerTypesEnum=this.getViewerTypesEnum.bind(this),this.publicAPI.getFilterProxy=this.getFilterProxy.bind(this),this.publicAPI.getNGFUXID=this.getNGFUXID.bind(this),this.publicAPI.getRirPathFromSubPath=this.getRirPathFromSubPath.bind(this),this.publicAPI.highlight=this.highlight.bind(this),this.publicAPI.unhighlight=this.unhighlight.bind(this),this.publicAPI.getDELViewerFilterProxy=this.getDELViewerFilterProxy.bind(this),this.publicAPI.getDELViewerNGFUXID=this.getDELViewerNGFUXID.bind(this),this.publicAPI.getRoots=this.getRoots.bind(this),this.publicAPI}}}));