define("DS/CfgAuthoringContextUX/scripts/CfgCACustomTileView",["DS/W3DXComponents/Views/Item/TileView","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX"],(function(e,t){"use strict";return e.extend({name:"CACustomAuthListTile",template:function(){return'                            <div class="'+this.getClassNames("-check")+' {{#unless withMultisel}}hidden{{/unless}}"></div>                              <div class="'+this.getClassNames("-sub-container")+'" draggable="true">                                  <div class="'+this.getClassNames("-header")+'">                                      <div>{{#if image}}<img  src="{{#unless lazyLoading}}{{image}}{{/unless}}" {{getImgAttrs imgAttrs}} class="'+this.getClassNames("-image")+'" draggable="false"/>{{/if}}</div>\t\t\t\t\t\t\t\t\t                    {{#if holdStatus}}<div class="state" title="{{{holdValue}}}[{{{currentDisplay}}}]">{{{holdValue}}}</div>{{/if}}\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{#unless holdStatus}}<div class="state" title="{{{currentDisplay}}}">{{{currentDisplay}}}</div>{{/unless}}\t\t\t\t\t\t\t\t              </div>                                <div class="'+this.getClassNames("-body")+'">                                    {{#if icon}}<img src="{{icon}}" class="'+this.getClassNames("-icon")+'" draggable="false"/>{{/if}}\t                                <div class="'+this.getClassNames("-title")+'" title="{{{title}}}">{{{title}}}</div>\t                                <div class="'+this.getClassNames("-subtitle")+'" title="{{{subtitle}}}">{{{subtitle}}}</div>\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-content")+'">\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-CAowner")+'" title="{{{ownerDisplayName}}}">{{{ownerField}}}&nbsp;{{{ownerDisplayName}}}</div>\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-Role")+'" title="{{{contextUserRole}}}">{{{roleField}}}&nbsp;{{{contextUserRole}}}</div>\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-DueDate")+'">{{{dueDateField}}}&nbsp;{{{due}}}</div>\t\t\t\t\t\t\t\t\t</div>                                    <ps-progress  class="'+this.getClassNames("-progress")+'"></ps-progress>                                </div>                            </div>                                    '}})})),define("DS/CfgAuthoringContextUX/scripts/CfgCAAuthCtxTileView",["DS/W3DXComponents/Views/Item/TileView","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX"],(function(e,t){"use strict";return e.extend({name:"CACustomAuthCtxTile",template:function(){return'                           <div class="'+this.getClassNames("-check")+' {{#unless withMultisel}}hidden{{/unless}}">                                            <div class="toggle toggle-primary">                                                <input type="checkbox" name="radios" value="" id="checkbox-{{cid}}">                                                <label class="control-label" for="checkbox-{{cid}}"></label>                                            </div>                                        </div>                                        <div class="'+this.getClassNames("-sub-container")+'" draggable="true">                                            <div class="'+this.getClassNames("-header")+'">                                                {{#if image}}<img src="{{#unless lazyLoading}}{{image}}{{/unless}}" {{getImgAttrs imgAttrs}} class="'+this.getClassNames("-image")+'" draggable="false"/>{{/if}}                                            </div>                                            <div class="'+this.getClassNames("-body")+'">                                                {{#if icon}}<img src="{{icon}}" class="'+this.getClassNames("-icon")+'" draggable="false"/>{{/if}}\t                                                <div class="'+this.getClassNames("-title")+'" title="{{{title}}}">{{{title}}}</div>                                                <div class="'+this.getClassNames("-subtitle")+'" title="{{{subtitle}}}">{{{subtitle}}}</div>                                                <div class="'+this.getClassNames("-content")+'"title="{{{content}}}">{{{content}}}</div>                                            <div class="'+this.getClassNames("-content")+'"title="{{{severity}}}">{{{severity}}}</div>                                            <progress max="100" value="10" class="'+this.getClassNames("-progress")+'"></progress>                                            </div>                                            <div class="'+this.getClassNames("-actions")+'">                                                <div class="actions-inline-container">                                                    <div class="action-container single-action hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x"></span></div>                                                    </div>                                                    <div class="action-container actions-inline-dotted hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x fonticon-down-open"></span></div>                                                    </div>                                                </div>                                            </div>                                        </div>                                    '},domEvents:function(){return{"click .tile-title":function(){this.dispatchEvent("onClickTitle")}}}})})),define("DS/CfgAuthoringContextUX/scripts/CfgSessionDialog",["i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","DS/CfgBaseUX/scripts/CfgContainerView","DS/PlatformAPI/PlatformAPI","DS/CfgBaseUX/scripts/CfgController"],(function(e,t,i,n){"use strict";var o={collectionNew:null,CfgDialogIns:null,create:function(s,a="",r){n.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",require(["DS/CfgBaseUX/scripts/CfgDialog","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/CfgBaseUX/scripts/CfgUtility","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgController"],(function(n,l,d,c,u,g,h){o.OKhandlar=function(t){var n=l.getGlobalSessiondata();void 0!==window.__karma__&&(n=enoviaServerAuthoringWidget.odtEditMode?{"Evolution Expression":'<CfgEffectivityExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgEffectivityExpression.xsd"><Expression><Context HolderType="Model" HolderName="SONY"><Date><Interval><From Value = "2018-04-13"/></Interval></Date></Context></Expression></CfgEffectivityExpression>',"Dictionary Contexts":"[EA33B156971D0000420BD75AEF620400]",ACId:"EA33B156CB2A00008921D75AC3D50800"}:{"Evolution Expression":"","Dictionary Contexts":"[]"}),""!=n["Evolution Expression"]?(h.init(),enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")||"OnPremise",u.populate3DSpaceURL().then((function(t){u.populateSecurityContext().then((function(t){c.getAuthoringIDforEvolution(n).then((function(e){const t=[],s=[];for(const e of l.collection._models)0==u.isEmptyEvolutionExpressionForModel(e)&&(t.push(e),"Model"!=e.get("selectedDataType")?s.push(e.get("expression").modelId):s.push(e.id));const r={ACId:e.ACId,evolutionExpression:n["Evolution Expression"],dictionaryContext:s,displayExpression:e.XSLTExpr,collection:t};i.publish("sessionEff",Object.assign(r,{PACID:a})),o.CfgDialogIns.closeDialog()}),(function(t){console.log("Create fail"),console.log(t),t&&"1"===t.errorID?u.showwarning(e.CFG_SET_FROZEN_EVOLUTION_FAILED,"error"):u.showwarning(e.CFG_WORK_UNDER_EVOLUTION_FAILED,"error")}))}),(function(e){return console.log("populateSecurityContext Failed"),Promise.reject(e)}))}),(function(e){return console.log("populate3DSpaceURL Failed"),Promise.reject(e)}))):(i.publish("removeAuthCtxSessionEvent"+a),o.CfgDialogIns.closeDialog())},o.CANhandlar=function(){o.CfgDialogIns.closeDialog(),s.style.pointerEvents="auto"};var C={tenant:enoviaServerFilterWidget.tenant,environment:"Dashboard",parent:null,parentElement:null,objectid:null,mode:"SessionEffectivity",iXml:"",modelList:null,width:800,height:500,minHeight:310,minWidth:310,Access:{SetSessionEffectvity:"true"},dialogue:{header:e.CFG_Edit_Session_Header,buttonArray:null,target:widget.body,object:null,postCloseHandler:function(){s.style.pointerEvents="auto"}}},v={isHeader:!1,isFooter:!0,firstButtonText:e.CFG_SE_ACTION_OK,secondButtonText:e.CFG_SE_ACTION_Cancel,headerText:e.CFG_Edit_Session_Header,onButtonClickCB:function(e){"firstButton"==e.buttonId?o.OKhandlar():o.CANhandlar()}};C.dialogue.modelViewContainer=new t(v).render(),C.dialogue.modelViewContainer.getContent().addClassName("CfgContainerView-EditEvolution-CustomTile"),C.mode="EditEvolution",o.CfgDialogIns=new n(C),C.mode="SessionEffectivity",C.dialogue.modelViewContainer.inject(o.CfgDialogIns.container),C.parent=o.CfgDialogIns.container,C.parentElement=o.CfgDialogIns.container,C.dialogue.object=o.CfgDialogIns,C.selectionContextInfo=r,o.CfgDialogIns.render(),l.create(C).then((()=>{l.prefillWithAttachesContext(r)})).catch((e=>{console.error("Error: ",e)}))}))}};return o})),define("DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility",["DS/DataDragAndDrop/DataDragAndDrop","DS/WAFData/WAFData","DS/i3DXCompassServices/i3DXCompassServices","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","DS/UIKIT/Alert"],(function(e,t,i,n,o,s,a,r){"use strict";return{getCAdetails:function(e){return new Promise((function(t,i){var o="/resources/modeler/change/changeaction/pid:"+e+"?attributes=1&context=1&people=1&applicability=1&editability=1";n.makeWSCall(o,"GET","enovia","application/json","",(function(e){t(e)}),(function(e,t){i(t||e)}),!0)}))},getCAdetailsForAuthoring:function(e){return new Promise((function(t,i){var o="/resources/modeler/change/changeaction/pid:"+e+"?attributes=1&editability=1";n.makeWSCall(o,"GET","enovia","application/json","",(function(e){t(e)}),i,!0)}))},getCAWorkUnderList:function(){return new Promise((function(e,t){n.makeWSCall("/resources/modeler/change/changeactions?workunder=1","GET","enovia","application/json","",(function(t){e(t)}),t,!0)}))},getAuthoringIDforEvolution:function(e){return new Promise((function(t,i){var o=JSON.stringify(e);n.makeWSCall("/resources/authoringcontext/service","POST","enovia","application/json",o,(function(e){t(e)}),((e,t)=>i(t||e)),!0)}))},getEvolutionStateFromXMLExpression:function(e){const t={mv:"None",mp:"None",unit:"None",date:"None"};if(0!=e){const i=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Expression")[0];let n="",o=!1;try{n=i.getElementsByTagName("TreeSeries")}catch(e){o=!0}o&&(n=i.childNodes[0]);const s=i.getElementsByTagName("Series"),a=i.getElementsByTagName("Date");if(n.length>0)for(const e of n){if("ProductState"==e.attributes.Type.value){let i=!1,n=!1;for(const t of e.childNodes)"Single"==t.tagName&&(i=!0),"Tree"==t.tagName&&(n=!0);t.mv=1==i?1==n?"Both":"Single":1==n?"Range":"None"}if("ManufPlan"==e.attributes.Type.value){let i=!1,n=!1;for(const t of e.childNodes)"Single"==t.tagName&&(i=!0),"Tree"==t.tagName&&(n=!0);t.mp=1==i?1==n?"Both":"Single":1==n?"Range":"None"}}if(s.length>0)for(const e of s)if("Unit"==e.attributes.Type.value){let i=!1,n=!1;for(const t of e.childNodes)"Single"==t.tagName&&(i=!0),"Interval"==t.tagName&&(n=!0);t.unit=1==i?1==n?"Both":"Single":1==n?"Range":"None"}if(a.length>0)for(const e of a){let i=!1,n=!1;for(const t of e.childNodes)if(console.log(t),1==t.childNodes.length)n=!0;else{t.childNodes[0].attributes.Value.value.split("T")[0]==t.childNodes[1].attributes.Value.value.split("T")[0]?i=!0:n=!0}t.date=1==i?1==n?"Both":"Single":1==n?"Range":"None"}console.log(t)}return t},sendTrackerAPIAuthoringContext:function(e){let t=this.getEvolutionStateFromXMLExpression(!1);Object.prototype.hasOwnProperty.call(e.authoring,"evolution")&&Object.prototype.hasOwnProperty.call(e.authoring.evolution,"xml")&&(t=this.getEvolutionStateFromXMLExpression(e.authoring.evolution.xml)),o.createEventBuilder({category:o.Category.USAGE,action:o.Events.CLICK,tenant:e.tenant}).setLabel(o.Labels.WORK_UNDER_AUTHORING_CONTEXT).setAppId(e.widget.id||"NO_APP_ID").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_WIDGET,e.widget.name||"ODT Environment").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_MEDIA,o.getDeviceUsedForOperation()).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_TYPE,e.authoring.type||"Empty").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_CHANGE_APPLICABILITY,"Change"==e.authoring.type&&"TRUE"==e.authoring.change.applicability?"TRUE":"FALSE").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_EVOLUTION_MV,t.mv).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_EVOLUTION_MP,t.mp).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_EVOLUTION_UNIT,t.unit).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_EVOLUTION_DATE,t.date).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_SET,e.authoring.settingBy||"Authoring").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_USAGE,e.authoring.usage||"Set").addPersonalValue(a.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_NO_OF_MODEL,e.authoring.evolution.noModel||0).send()},setMagicProbesDataForAuthoringContext:function(e){let t="defaultAppID",i="ODT Environment";widget&&widget.data&&widget.data.appId&&(t=widget.data.appId),widget&&widget.options&&widget.options.title&&(i=widget.options.title);let s={AppId:t,AppName:i,CommandName:o.Labels.WORK_UNDER_AUTHORING_CONTEXT,CommandOperation:e,ConfigMode:o.ConfigMode.CONTEXTUAL,ApplicationMode:o.ApplicationMode.DASHBOARD};n.sendConfgurationCommandsClickEventForMagicProbes(s)},showMessage:function(e){this.removeClassFromDom("wp-authAlert");new r({className:"wp-authAlert",autoHide:!0,visible:!0,hideDelay:2e3}).inject(e.element,"top").add({className:e.type||"primary",message:e.message})},getWorkUnderEmptyObject:function(){return{version:"1.0",AuthoringContextHeader:null,change:{id:"",name:"",context:[],title:"",description:"",severity:""},evolution:{id:"",displayExpression:""},configurationRevision:null}},cleanDraggableEvent:function(t){e.clean(t,"drag"),void 0!==t._evts&&(t._evts.drg=null),t.evts=null},makeDraggable:function(t,i){const n={protocol:"3DXContent",version:"1.0",source:widget.data.appId||"",widgetId:widget.id||"",data:{items:[]}};"change"===enoviaServerAuthoringWidget.saveMode?n.data.items.push({envId:widget.getValue("x3dPlatformId")||"OnPremise",serviceId:enoviaServerAuthoringWidget.serviceName||"3DSpace",contextId:enoviaServerAuthoringWidget.getSecurityContext()||"",objectId:i.id||"",objectType:"Change Action"}):"session"===enoviaServerAuthoringWidget.saveMode&&n.data.items.push({envId:widget.getValue("x3dPlatformId")||"OnPremise",serviceId:enoviaServerAuthoringWidget.serviceName||"3DSpace",contextId:enoviaServerAuthoringWidget.getSecurityContext()||"",objectId:i.id||"",objectType:"Authoring Context",objectData:{evolutionExpression:i._attributes.evolExpression||"",dictionaryContext:i._attributes.dictionaryContext||"",displayExpression:i._attributes.content||"",title:i._attributes.title||"",desc:i._attributes.desc||"",image:i._attributes.image||"",selectedDataType:i._attributes.selectedDataType||"",isxRevisionEffectivity:i._attributes.isxRevisionEffectivity||!1}}),e.draggable(t,{data:JSON.stringify(n)})},readAuthroingContext:function(){return new Promise((function(e,t){n.makeWSCall("/resources/authoringcontext/service/pid:dummyid","GET","enovia","application/json","",(function(t){e(t)}),t,!0)}))},deleteAuthroingContext:function(){return new Promise((function(e,t){n.makeWSCall("/resources/authoringcontext/service/pid:dummyid","DELETE","enovia","application/json","",(function(t){e(t)}),t,!0)}))},getObjectFromEvolutionContextIds:(e,t,i,o)=>(null!=t&&null!=t||(t=!1),null!=i&&null!=i||(i="Change Action"),null!=o&&null!=o||(o=["In Work","Complete"]),new Promise((function(t,i){var o={with_indexing_date:!0,with_nls:!0,label:"cfgRevisionCALabel",locale:"en",select_predicate:["ds6w:identifier","ds6w:label","ds6wg:marketing_Name","ds6w:description","ds6w:type","current","owner","ds6w:responsible","ds6w:created","ds6w:lastModifiedBy"],select_file:["icon","thumbnail_2d"],query:'(flattenedtaxonomies:"types/Model") AND ((([ds6w:label]: ("'+e+'")) OR ([name]:("'+e+'"))))',nresults:1e3,start:0,source:[],tenant:enoviaServerFilterWidget.tenant};o=JSON.stringify(o);n.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",o,(function(e){t(e)}),(function(e){i(e)}),!1,{isfederated:!0})}))),removeClassFromDom:function(e){for(var t=document.querySelectorAll("."+e),i=0;i<t.length;i++)t[i].remove()},isChangeLicencesValid:(e,t,i)=>e||t||i,isConfigurationLicencesValid:(e,t)=>e||t}})),define("DS/CfgAuthoringContextUX/scripts/CfgSessionAuthTileView",["DS/W3DXComponents/Views/Item/TileView","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX"],(function(e,t){"use strict";return e.extend({name:"CASessionAuthCtxTile",template:function(){return'</div>\t\t\t\t <div class="'+this.getClassNames("-sub-container")+'" draggable="true"><div class="'+this.getClassNames("-body")+'"><div class="'+this.getClassNames("-title")+'" title="{{{title}}}">{{{title}}}</div>                                                <div class="'+this.getClassNames("-subtitle")+'" title="{{{subtitle}}}">{{{subtitle}}}</div>                                                <div class="'+this.getClassNames("-content")+'"title="{{{content}}}">{{{content}}}</div></div>                                            <div class="'+this.getClassNames("-actions")+'">                                                <div class="actions-inline-container">                                                    <div class="action-container single-action hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x"></span></div>                                                    </div>                                                    <div class="action-container actions-inline-dotted hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x fonticon-down-open"></span></div>                                                    </div>                                                </div>                                            </div>                                        </div>                                    '}})})),define("DS/CfgAuthoringContextUX/scripts/CfgCAListDialog",["UWA/Drivers/Alone","DS/UIKIT/Modal","DS/UIKIT/Input","DS/UIKIT/Input/Button","UWA/Class/View","DS/W3DXComponents/Views/Layout/GridScrollView","DS/CfgAuthoringContextUX/scripts/CfgCACustomTileView","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","DS/UIKIT/Alert","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/Item/ActionsInlineView","DS/UIKIT/Input/Text","DS/UIKIT/Iconbar","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgData","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/ENOFloatingPanel/ENOFloatingPanel","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgController","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS"],(function(e,t,i,n,o,s,a,r,l,d,c,u,g,h,C,v,p,m,f,A,D,y,w,b){"use strict";var S={collectionNew:null,caIcon:"/snresources/images/icons/large/I_ECM_CA108x144.png",create:function(e,t){var i=this;this.MainContainer=new UWA.Element("div",{id:"caListDiv",styles:{width:"100%",height:"100%",display:"table"}}),this.headerwrapperDiv=new UWA.Element("div",{id:"headerwrapperDiv",styles:{display:"table-row"}}),this.CAHeader=new UWA.Element("div",{id:"CAHeaderDiv",styles:{width:"100%",display:"inline-flex",flexDirection:"row-reverse"}}),this.inlineActionDiv=new UWA.Element("div",{id:"inlineActionDiv",styles:{}}),this.CAListBodyDiv=new UWA.Element("div",{id:"CAListBodyDiv",styles:{width:"100%",height:"100%",display:"table-row"}}),this.CASubActiondivText=new UWA.Element("div",{id:"CASubActiondiv",html:l.CFG_Heading_SortBY+':<font color="#78befa">'+l.CFG_Heading_Date+"</font>",styles:{fontSize:"1.3em"}}),this.CASearchDiv=new UWA.Element("div",{id:"CASearchDiv",styles:{width:"50%",height:"10%",display:"none"}});new C({renderTo:this.CAHeader,items:[{fonticon:"down-bold",text:l.CFG_ToolTip_Ascending_Descending,handler:function(e){S.sortCAListByDate()}},{className:"divider"},{fonticon:"search",text:l.CFG_tooltip_Search,handler:function(e){S.searchCA()}}]});this.CAHeader.appendChild(this.CASubActiondivText),this.headerwrapperDiv.appendChild(this.CAHeader),this.MainContainer.appendChild(this.headerwrapperDiv),this.CAsearchBX1=new h({id:"CAsearchBX1",attributes:{placeholder:l.CFG_CA_Searchby_NameTitle,events:{keyup:this.searchBoxKeyUpHandler}}}).inject(this.CASearchDiv),this.CAsearchBX1.elements.input.setStyles({width:"55%",padding:"6px",margin:"0px"}),this.MainContainer.appendChild(this.CASearchDiv),this.MainContainer.appendChild(this.CAListBodyDiv),this.getModel(e),v.mask(this.MainContainer),w.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",y.populate3DSpaceURL().then((function(e){y.populateSecurityContext().then((function(e){i.getWorkUnderCAList().then((e=>{var t=new UWA.Class.Collection(e),n=[];(n=t.sortBy("due")).reverse(),t.reset(n),i.collectionNew=t,S.createView(t),v.unmask(S.MainContainer)}))}),(function(e){return Promise.reject(e)}))}),(function(e){return Promise.reject(e)}))},createNative:async function(e){this.options=e,this.createNativeHeaderAndSearchBox();let t=await this.getWorkUnderCAListForNative();0!==t.length&&this.getWorkUnderCAListSuccessCB(t)},createNativeHeaderAndSearchBox:function(){this.CAListHeader=new UWA.Element("div",{id:"ca-list-header-div",styles:{width:"100%",display:"inline-flex",flexDirection:"row-reverse"}}),this.CASubActiondivText=new UWA.Element("div",{id:"ca-sub-action-div",html:`${l.CFG_Heading_SortBY} :<font color="#78befa"> ${l.CFG_Heading_Date} </font>`,styles:{fontSize:"1.3em",justifySelf:"center",alignSelf:"center"}});new C({renderTo:this.CAListHeader,items:[{fonticon:"down-bold",text:l.CFG_ToolTip_Ascending_Descending,handler:function(e){S.sortCAListByDate()}},{className:"divider"},{fonticon:"search",text:l.CFG_tooltip_Search,handler:function(e){var t=document.querySelector("#ca-search-div");"flex"==t.getStyle("display")?t.setStyle("display","none"):t.setStyle("display","flex")}}]});this.CAListHeader.appendChild(this.CASubActiondivText),this.options.renderTo.appendChild(this.CAListHeader),this.CASearchDiv=new UWA.Element("div",{id:"ca-search-div",styles:{width:"100%",height:"40px",display:"none",justifyContent:"flex-end"}}),this.CAsearchBX1=new h({id:"CAsearchBX1",attributes:{placeholder:l.CFG_CA_Searchby_NameTitle,events:{keyup:this.searchBoxKeyUpHandler}}}).inject(this.CASearchDiv),this.CAsearchBX1.elements.input.setStyles({width:"30%","min-width":"175px",padding:"6px","margin-right":"5px"}),this.options.renderTo.appendChild(this.CASearchDiv)},getWorkUnderCAListSuccessCB:function(e){let t=new UWA.Class.Collection(e);t.reset(t.sortBy("due").reverse()),this.collectionNew=t,this.selectedCAItem,0!==t.length&&this.createNativeView(t,this.options),this.sendCAListViewRenderedNotificationToWIW()},sendCAListViewRenderedNotificationToWIW:function(){let e={eventName:"cfgShowCAList",operation:"InitCompleted",operationVersion:"1.0",content:JSON.stringify({})};y.sendNotificationWebInWin(e)},searchBoxKeyUpHandler:function(e){let t=e.target.value;!0!==S.isForbiddenChar(t)&&(S.enteredText=t,S.filterSearch())},getWorkUnderCAList:function(){return new Promise(((e,t)=>{r.getCAWorkUnderList().then((t=>{this.contextArray=[];let{owner:i,contributor:n,reviewer:o,follower:s}=t.details;[i,n,o,s].forEach((e=>this.getCAObjects(e))),e(this.contextArray)}))}))},getWorkUnderCAListForNative:async function(){let e=await r.getCAWorkUnderList();this.contextArray=[];let{owner:t,contributor:i,reviewer:n,follower:o}=e.details;[t,i,n,o].forEach((e=>this.getCAObjects(e)));try{let e=this.contextArray.map((e=>e.id));if(0!==e.length){let t=await y.getObjectsBySearchService(e,!1,"Change Action",["In Work"]);t.results&&this.contextArray.forEach((e=>{let i=t.results.find((t=>{let i=t.attributes.find((e=>"resourceid"===e.name));if(i&&i.value===e.id)return t}));if(i){let t=i.attributes.find((e=>"preview_url"===e.name));t&&t.value&&(e.image=t.value)}}))}}catch(e){y.showwarning(b.CfgSearchKO,"error")}finally{return this.contextArray}},getCAObjects:function(e){e.forEach((e=>{let{id:t,name:i,owner:n}=e;t=t.split(":")[1];let{Severity:o,Synopsis:s,EstimatedCompletionDate:a}=e.attributes;o=this.getCASeverity(o),a=this.getCAEstimatedCompletionDate(a);let r=this.getCAIndividualObj(s,t,i,n,o,a);this.contextArray.push(r)}))},getCASeverity:function(e){let t;switch(e){case"Low":t=l.CFGLabelLow;break;case"Medium":t=l.CFGLabelMedium;break;case"High":t=l.CFGLabelHigh}return t},getCAEstimatedCompletionDate:function(e){return e?new UWA.Date(e).strftime("%Y-%m-%d"):""},getCAIndividualObj:function(e,t,i,n,o,s){return{title:y.escapeSpecialCharacters(e),id:t,subtitle:i,ownerField:l.CFG_Heading_Owner+":",ownerDisplayName:n,roleField:l.CFG_Heading_Severity+":",contextUserRole:o,dueDateField:l.CFG_Heading_DueDate+":",due:s,image:enoviaServerFilterWidget.computeUrl(this.caIcon),currentDisplay:l.CFG_CA_State_InWork}},getSelectedCAItemForNative:function(){return this.selectedCAItem},createNativeView:function(e,t){this.caListView=new s({collection:e,useInfiniteScroll:!1,scrollDuration:1,itemView:a,withMultisel:!1,events:{onItemViewClick:e=>{p.caListActionEvents.publish({event:"enableOkButtonInCAListContainerView"}),this.selectedCAItem={changeId:e.currentItemView.model._attributes.id,title:e.currentItemView.model._attributes.title,name:e.currentItemView.model._attributes.subtitle}},onItemViewCheck:function(e,t){console.log("item view check done")}}}),this.caListView.render().inject(t.renderTo)},createView:function(e){var t=this;this.caListView=new s({collection:e,useInfiniteScroll:!1,scrollDuration:1,itemView:a,withMultisel:!1,events:{onItemViewClick:function(e){t.dialog.footerButton.Ok.disabled=!1,console.log("Selection done")},onItemViewCheck:function(e,t){console.log("item view check done")}}}),this.caListView.render().inject(this.CAListBodyDiv),t.caListView=this.caListView,this.dialog.footerButton.Ok.disabled=!0},getModel:function(e){var t,i=this;t=[{label:"OK",labelValue:l.CFG_Button_OK,className:"primary btn btn-primary okBtn",handler:function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(t){if(null!=i.caListView.options.view.currentItemView){var n=i.caListView.options.view.currentItemView.model._attributes.id,o=i.caListView.options.view.currentItemView.model._attributes.title,s=t.get();s.change.id=n,s.change.name=o;t.update(s,(function(){t.publish(t.myAuthkey,s)})),i.dialog.closeDialog(),e.style.pointerEvents="auto"}else if(i.caListView.options.view.collection.length>0){var a=t.renderDiv;r.removeClassFromDom("wp-authAlert"),new d({className:"wp-authAlert",visible:!0,autoHide:!0,hideDelay:2e3}).inject(a,"top").add({className:"error",message:l.CFG_NO_SELECTION})}else i.dialog.closeDialog(),e.style.pointerEvents="auto"}))}},{label:"Cancel",labelValue:l.CFG_Button_CANCEL,handler:function(){i.dialog.closeDialog(),e.style.pointerEvents="auto"}}];i.dialog=new D({className:"cfgAuthENOFloatingPanelComponent",title:l.CFG_Select_CA_Header,body:this.MainContainer,overlay:!0,mode:"caListDialog",closable:!0,resizable:!0,height:600,width:340,minHeight:200,minWidth:340,styles:{position:"fixed"},dialogue:{header:l.CFG_Select_CA_Header,buttonArray:t,target:widget.body,postCrossHandler:function(){e.style.pointerEvents="auto",i.dialog.closeDialog()}}}).inject(widget.body),i.dialog.render(),null!=document.getElementsByClassName("cfgAuthENOFloatingPanelComponent")[0]&&(e.style.pointerEvents="none")},sortCAListByDate:function(){var e=document.getElementsByClassName("fonticon fonticon-down-bold"),t=!0;if(0==e.length){t=!1;e=document.getElementsByClassName("fonticon fonticon-up-bold")}if(this.caListView.collection.length>0){var i=[];(i=this.caListView.collection.toArray()).reverse(),this.caListView.collection.reset(i),this.changeSortIcon(e,t)}},changeSortIcon:function(e,t){e.length>0&&(e[0].className=t?"fonticon fonticon-up-bold":"fonticon fonticon-down-bold")},isForbiddenChar:function(e){for(var t=!1,i='"#$@%*,?\\<>[]|:/',n=0;n<i.length;n++){var o=i[n];if(-1!=e.indexOf(o)){t=!0;break}}return!0===t&&(i=i.split("").join(" ")),t},searchCA:function(){var e=document.querySelector("#CASearchDiv");"table-row"==e.getStyle("display")?e.setStyle("display","none"):e.setStyle("display","table-row")},filterSearch:function(e){var t;this.caListView.destroy(),t=this.collectionNew.filter(this.filterNameBased);var i=new UWA.Class.Collection(t);"Native"===window.enoviaServerFilterWidget.mode||"powerBy"===window.enoviaServerFilterWidget.mode?this.createNativeView(i,this.options):this.createView(i)},filterNameBased:function(e){var t=!1,i=e._attributes.subtitle,n=e._attributes.title,o=S.enteredText;if(o&&o.length){i&&(i=i.toLowerCase()),n&&(n=n.toLowerCase()),o=o.toLowerCase();var s=i.indexOf(o);s<0&&(s=n.indexOf(o)),t=s>=0}if(void 0!==o&&0!==o.length||(t=!0),1==t)return e}};return S})),define("DS/CfgAuthoringContextUX/scripts/CfgAuthContextChangeTileView",["UWA/Class/Model","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","DS/CfgAuthoringContextUX/scripts/CfgCAAuthCtxTileView"],(function(e,t,i,n,o,s){"use strict";return t.extend({idAttribute:"id",appDiv:null,editAllowed:null,authViewMode:null,setup:function(e){this.listenTo(this.model,"onChange",this.render),this.appDiv=e.appDiv,this.editAllowed=e.editAllowed,this.authViewMode=e.authViewMode},render:function(){var e=this,t=o.CFG_CA_HEADER,a=!1;if("change"==e.authViewMode&&(a=!0),this.container&&this.container.setContent(""),UWA.is(this.model.id)&&this.container){this.container.appendChild(UWA.createElement("div",{class:"caHeader",id:"caHeaderDiv1",html:t}));var r=new s({model:e.model,contextualActions:e.contextMenuAuth(),events:{onClickTitle:function(e){var t={eventName:"cfgAuthoringContext",operation:"openCA",operationVersion:"1.0",content:{id:this.model.id}};n.sendNotificationWebInWin(t)}}});r.container.setStyles({width:"255px",minWidth:"255px",right:"5px",overflow:"hidden",whiteSpace:"nowrap"}),r.render().inject(this.container),1!=this.editAllowed&&"undefined"!=this.editAllowed&&null!=this.editAllowed||this.container.appendChild(UWA.createElement("div",{id:"AuthCAtoggle",class:"caAuthDiv1",styles:{display:"flex",float:"right"},html:new i({type:"switch",id:"autoggle",checked:a,label:"",events:{onClick:function(){var t={eventName:"cfgAuthoringContext",operation:this.isChecked()?"activate_Authoring":"deActivate_Authoring",operationVersion:"1.0",content:{id:e.model.id}};n.sendNotificationWebInWin(t)}}})}));var l={eventName:"cfgAuthoringContext",operation:"SetAuthContextSuccess",operationVersion:"1.0",content:{id:this.model.id}};n.sendNotificationWebInWin(l)}return this.container},contextMenuAuth:function(){var e=[];return 1!=this.editAllowed&&"undefined"!=this.editAllowed&&null!=this.editAllowed||e.push({id:"delete",text:o.CFG_ToolTip_Remove,fonticon:"trash",handler:function(e){var t={eventName:"cfgAuthoringContext",operation:"removeCA",operationVersion:"1.0",content:{id:e.model.id}};n.sendNotificationWebInWin(t)}}),e}})})),define("DS/CfgAuthoringContextUX/scripts/CfgAuthContextChangeView",["UWA/Class/View","css!DS/UIKIT/UIKIT.css","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/WebappsUtils/WebappsUtils","DS/W3DXComponents/Views/Item/TileView","UWA/Class/Model","DS/CfgAuthoringContextUX/scripts/CfgAuthContextChangeTileView","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS"],(function(e,t,i,n,o,s,a,r,l,d){"use strict";return e.extend({renderDiv:null,model:null,isLicenseValid:void 0,isLicenseCFGValid:void 0,isLicenseCHGValid:void 0,isLicenseIDSValid:void 0,caIcon:"/snresources/images/icons/large/I_ECM_CA108x144.png",init:function(e){this.options=e;var t=this;l.rolesAvailable((function(e){t.isLicenseCFGValid=e.isCFGRoleAvail,t.isLicenseCHGValid=e.isCHGRoleAvail,1==t.isLicenseCFGValid||1==t.isLicenseCHGValid?t.isLicenseValid=!0:t.isLicenseValid=!1})),this.work_under={CA_Auth_Name:"",Auth_Details:{version:"1.0",AuthoringContextHeader:null,change:{id:"",name:"",context:[],title:"",description:"",severity:""}},Message_WARN:{isLicenseValid:!1,Message:d.WorkUnderDisabledCFGLicense},Message_SUCCESS:{validKey:"",isLicenseValid:!0}},this.model=new a},setContext:function(e,t){var i=e.ChangeAction.id,o=this;o.caOptions=e,o.renderDiv=o.options.parent,n.getCAdetailsForAuthoring(i).then((function(e){for(var t="",n="",s=e.changeaction.attributes,a=0;a<s.length;a++)"current"==s[a].name?s[a].value:"attribute_Severity"==s[a].name?t=s[a].value:"attribute_Synopsis"==s[a].name?n=s[a].value:"interface[Change On Hold]"==s[a].name&&s[a].value;if("allowed"==e.changeaction.editability.work_under){var r=n,c=e.changeaction.description,u=e.changeaction.name,g=e.changeaction.context,h=o.caOptions.authoringMode;t=t;o.model.set("id",i),o.model.set("image",enoviaServerFilterWidget.computeUrl(o.caIcon)),o.model.set("context",g),o.model.set("title",r),o.model.set("content",c),o.model.set("synopsis",u),o.model.set("severity",t),o.model.set("subtitle",u),o.work_under.CA_Auth_Name=o.model.get("title"),o.model.set("status",h),o.showCATileView()}else l.showwarning(d.CFG_DROP_CA_ACTION_STATE_CHECK,"error"),o.sendCAIncorrectStateNotificationToWIW()}),(function(e){return l.showwarning(d.getCAFailed,"error"),console.log("Get CA Deatils Failed"),Promise.reject(e)}))},sendCAIncorrectStateNotificationToWIW:function(){let e={eventName:"cfgAuthoringContext",operation:"SetAuthContextFailure",operationVersion:"1.0",content:JSON.stringify({id:this.caOptions.ChangeAction.id,msg:d.CFG_CHANGE_ACTION_INCORRECT_STATE})};l.sendNotificationWebInWin(e)},showCATileView:function(){var e=this;new r({model:e.model,appDiv:e.renderDiv,editAllowed:e.editAllowed,authViewMode:e.caOptions.authoringMode}).render().inject(e.options.parent)}})})),define("DS/CfgAuthoringContextUX/scripts/CfgWorkUnderView",["DS/Controls/TooltipModel","UWA/Class/Model","UWA/Class/View","DS/W3DXComponents/Views/Item/TileView","DS/UIKIT/Input/Button","DS/Controls/Button","DS/Controls/Editor","DS/UIKIT/Input/Toggle","DS/Controls/Toggle","DS/WebappsUtils/WebappsUtils","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","DS/CfgAuthoringContextUX/scripts/CfgCAListDialog","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/CfgAuthoringContextUX/scripts/CfgCAAuthCtxTileView","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgSessionDialog","DS/CfgAuthoringContextUX/scripts/CfgSessionAuthTileView","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/Controls/ResponsiveTileView","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgUXEnvVariables","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS"],(function(e,t,i,n,o,s,a,r,l,d,c,u,g,h,C,v,p,m,f,A,D,y,w,b,S){"use strict";var _=i.extend({idAttribute:"id",appDiv:null,access:null,accessCFG:null,accessCHG:null,accessIDS:null,editAllowed:null,showEvolution:null,showChange:null,allowChangeConfguired:null,myAuthKey:null,cfgsessionVar:null,CfgDialogIns:null,authViewMode:null,selectionData:null,setup:function(e){this.appDiv=e.appDiv,this.access=e.access,this.accessCFG=e.accessCFG,this.accessCHG=e.accessCHG,this.accessCSV=e.accessCSV,this.accessIDS=e.accessIDS,this.myAuthKey=e.myAuthKey,this.editAllowed=e.editAllowed,this.showEvolution=e.showEvolution,this.showChange=e.showChange,this.allowChangeConfguired=e.allowChangeConfguired,this.authViewMode=e.authViewMode,this.selectionData=e.selectionData,this.cfgUXEnvVariablesJS=b.getCfgUXEnvVariables(),window.addEventListener("onResize",(function(){document.querySelector(".popover")&&document.querySelector(".popover").hide()}))},render:async function(){var e=this;""!=e.model._attributes.id&&null!=e.model._attributes.id||(enoviaServerAuthoringWidget.saveMode=null);var t=c.CFG_CA_HEADER,i=document.querySelector("#workUnderDiv"),n="-",o=[],s=[];if(t="change"===enoviaServerAuthoringWidget.saveMode?c.CFG_CA_HEADER:c.CFG_Session_Header,i&&i.setContent(""),"change"===enoviaServerAuthoringWidget.saveMode||"session"===enoviaServerAuthoringWidget.saveMode){if(i){var a;if(e.createHeader(t,i),"change"===enoviaServerAuthoringWidget.saveMode){if(o.push("evolution-effectivity"),s.push(c.CFG_ToolTip_Applicability),1!=e.editAllowed&&"undefined"!=e.editAllowed&&null!=e.editAllowed||(o.push("trash"),s.push(c.CFG_ToolTip_Remove)),"Low"===e.model._attributes.severity?(o.unshift("level-low"),s.unshift(c.CFGLabelLow)):"Medium"===e.model._attributes.severity?(o.unshift("level-medium"),s.unshift(c.CFGLabelMedium)):(o.unshift("level-high"),s.unshift(c.CFGLabelHigh)),""!=e.model._attributes.dueDate&&null!=e.model._attributes.dueDate&&null!=e.model._attributes.dueDate){n=new UWA.Date(e.model._attributes.dueDate).strftime("%Y-%m-%d")}"In Work"==e.model._attributes.maturityState&&c.CFG_CA_State_InWork;var r=c.CFG_ResponsiveTileTooltip_Title+" : "+e.model._attributes.title+"\n"+c.CFG_ResponsiveTileTooltip_Name+": "+e.model._attributes.subtitle+"\n"+c.CFG_ResponsiveTileTooltip_Owner+" : "+e.model._attributes.originator+"\n"+c.CFG_ResponsiveTileTooltip_Maturity+" : "+e.model._attributes.maturityState+"\n"+c.CFG_ResponsiveTileTooltip_DueDate+" : "+n;a=e.createTileView(e.model._attributes.image,e.model._attributes.image,r,e.model._attributes.title,e.model._attributes.subtitle+" | "+e.model._attributes.originator,e.model._attributes.maturityState+" | "+n,o,s),g.cleanDraggableEvent(i),g.makeDraggable(i,e.model),i.appendChild(a.getContent())}if("session"===enoviaServerAuthoringWidget.saveMode){1!=e.editAllowed&&"undefined"!=e.editAllowed&&null!=e.editAllowed||(o.push("pencil"),s.push(c.CFG_ACTION_EDIT),o.push("trash"),s.push(c.CFG_ToolTip_Remove));const t=e.model._attributes.evolExpression;let n,a,r="";try{e.model._attributes.isxRevisionEffectivity||(r=e.getDescriptionFromXML(t))}catch(e){console.error("Convert XML to JSON failed.")}r&&(n=r.displayNames.join(", "),a=r.marketingNames.join(", "));const l=e.model._attributes.content;let d="";if(null==e.model._attributes.image)d=enoviaServerFilterWidget.computeUrl("/snresources/images/icons/large/I_PLCModel108x144.png");else if(e.model._attributes.isxRevisionEffectivity){let t=enoviaServerFilterWidget.baseURL;e.model._attributes.image&&-1==e.model._attributes.image.indexOf(t)&&(e.model._attributes.image=t+e.model._attributes.image)}const u=e.createTileView(e.model._attributes.image||d,e.model._attributes.image||d,l,n||e.model.get("title"),a||e.model.get("desc"),e.model._attributes.content,o,s,"session");g.cleanDraggableEvent(i),g.makeDraggable(i,e.model),i.appendChild(u.getContent())}1!=this.editAllowed&&"undefined"!=this.editAllowed&&null!=this.editAllowed||e.createToggle(i)}}else this.createInnerView(i)},createCAListdialog:function(){var e=new UWA.Class.Collection;u.create(workUnderDiv,e)},getInfoFromXml:function(e,t){let i="";return"HolderName"==t&&(i=e.substr(e.lastIndexOf(t))),"DisplayName"==t&&(i=e.substr(e.indexOf(t))),i=i.split('"'),i[1]},getDescriptionFromXML:function(e){const t=(new DOMParser).parseFromString(e,"text/xml"),i=[],n=[],o=t.getElementsByTagName("Description")[0].getElementsByTagName("Context"),s=t.getElementsByTagName("Expression")[0].getElementsByTagName("Context");let a=0,r=0;for(const e of s)a++,i.push(e.attributes.HolderName.value);for(const e of o)++r<=a&&n.push(e.attributes.DisplayName.value);return{displayNames:n,marketingNames:i}},createToggle:function(t){const i=this,n=new l({type:"switch",domId:"autoggle",checkFlag:enoviaServerAuthoringWidget.status});n.addEventListener("buttonclick",(function(){i.toggleEvent(n)})),n.tooltipInfos=new e({shortHelp:c.WorkUnder_Toggle_Tooltips,mouseRelativePosition:!0}),t.appendChild(UWA.createElement("div",{id:"toggle",html:n}))},toggleEvent:function(e){var t=this;e.checkFlag?(enoviaServerAuthoringWidget.status=!0,"change"===enoviaServerAuthoringWidget.saveMode?C.publish("toggleActiveCA"+t.myAuthKey):C.publish("toggleActiveSE"+t.myAuthKey)):(enoviaServerAuthoringWidget.status=!1,"change"===enoviaServerAuthoringWidget.saveMode?C.publish("toggleDeActiveCA"+t.myAuthKey):C.publish("toggleDeActiveSE"+t.myAuthKey))},createButton:function(e,t,i,n){const o=this;if(o.editAllowed){const a=new s({label:e,domId:n});a.getContent().addEventListener("buttonclick",(function(){"change"==t?o.buttonCAEvent():"session"==t&&o.buttonSessionEvent()})),a.inject(i)}},buttonEvent:function(){document.querySelector(".popover")&&document.querySelector(".popover").hide()},buttonCAEvent:function(){var e=this;(e.accessCHG||e.accessCSV||e.accessIDS)&&(e.buttonEvent(),"undefined"==typeof dscef?e.launchSearchForCA():e.createCAListdialog())},launchSearchForCA:function(){let e=this.initialiseSearchForCA();this.activateSearchForCA(e)},initialiseSearchForCA:function(){let e=S.CfgLabelSelectChangeAction;return new w(!1,e)},activateSearchForCA:function(e){let t=enoviaServerFilterWidget.myRole,i=C.getUser().login,n=`[ds6w:status]:"Change Action.In Work" AND [ds6w:onHold]:"FALSE" AND ( owner:${i} OR [ECM_CA_ASSIGNEE]:${i} OR [ECM_CA_ASSIGNEE_THROUGH_GROUP]=${i} )`;e.activate(S.CfgLabelSelectChangeAction,"Change Action",t,(e=>{e.length>0&&this.searchCallback(e)}),"",[],n)},searchCallback:function(e){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(t){const i=g.getWorkUnderEmptyObject();i.change.id=e[0]._attributes.id,i.change.image=e[0]._attributes.preview_url,i.change.name=e[0]._attributes["ds6w:label"],t.publish(t.myAuthkey,i)}))},buttonSessionEvent:async function(){var e=this;try{await e.getPAndOAccessInfo(),(e.accessCFG||e.accessIDS)&&e.createSessiondialog(this.appDiv,e.myAuthKey)}catch(e){e.includes("Insufficient access rights")&&A.showwarning(S.CfgMessageAccessRightsError,"error")}},buttonApplicabilityEvent:function(){this.render()},createTileView:function(e,t,i,n,o,s,a,r,l){const d=this,c=new y({picture:e,icon:t,customTooltip:A.escapeSpecialCharacters(i),title:A.escapeSpecialCharacters(n),multipleTitleLineNumber:!1,subtitle:o,description:A.escapeSpecialCharacters(s),statusbarIcons:a,statusbarIconsTooltips:r,contextualMenu:[],onStatusbarIconPointerDown:function(e){if(e.options&&e.options.iconIndex>=0&&e.options.iconIndex<c.statusbarIcons.length){const t=[],i=[];for(let e=0;e<c.statusbarIcons.length;e++)t.push(c.statusbarIcons[e]),i.push(c.statusbarIconsTooltips[e]);"trash"===t[e.options.iconIndex]&&("session"===l?d.trashEventHandler(!0):d.trashEventHandler()),"pencil"===t[e.options.iconIndex]&&d.pencilEventHandler(),"evolution-effectivity"===t[e.options.iconIndex]&&d.showApplicabilityDialog(d.model.get("applicability")),c.setProperties({statusbarIcons:t,statusbarIconsTooltips:i})}}});return c},trashEventHandler:function(e=!1){this.cleanAuthDetails(e)},pencilEventHandler:function(){const e=this;require(["DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgController"],(function(t,i,n,o,s,a,r){_.OKhandlar=async function(){r.init(),enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",await a.populate3DSpaceURL(),await a.populateSecurityContext();var t=n.getGlobalSessiondata();if(""!=t["Evolution Expression"]){const i=function(i){const o=[],s=[];for(const e of n.collection._models)0==a.isEmptyEvolutionExpressionForModel(e)&&(o.push(e),"Model"!=e.get("selectedDataType")?s.push(e.get("expression").modelId):s.push(e.id));const r={ACId:i.ACId,evolutionExpression:t["Evolution Expression"],dictionaryContext:s,displayExpression:i.XSLTExpr,fromEdit:!0,collection:o};C.publish("sessionEff",Object.assign(r,{PACID:e.myAuthKey})),_.CfgDialogIns.closeDialog()};try{i(await s.getAuthoringIDforEvolution(t))}catch(e){console.log(e),e&&"1"===e.errorID?a.showwarning(c.CFG_SET_FROZEN_EVOLUTION_FAILED,"error"):a.showwarning(c.CFG_WORK_UNDER_EVOLUTION_FAILED,"error")}}else{(function(){C.publish("removeAuthCtxSessionEvent"+e.myAuthKey),_.CfgDialogIns.closeDialog()})(await s.deleteAuthroingContext())}},_.CANhandlar=function(){_.CfgDialogIns.closeDialog()};var l=e.model._attributes.evolExpression,d=e.model._attributes.dictionaryContext,u={tenant:enoviaServerFilterWidget.tenant,environment:"Dashboard",parent:null,parentElement:null,objectid:null,mode:"SessionEffectivity",selectedDataType:e.model._attributes.selectedDataType,isxRevisionEffectivity:e.model._attributes.isxRevisionEffectivity,iXml:l,modelList:d,Access:{SetSessionEffectvity:"true"},width:800,height:500,minHeight:310,minWidth:310,dialogue:{header:c.CFG_Edit_Session_Header,buttonArray:null,target:widget.body,object:null,postCloseHandler:function(){workUnderDiv.style.pointerEvents="auto"}}};u.modelName=e.model._attributes.desc,1==e.model._attributes.isxRevisionEffectivity&&null!=e.model._attributes.xRevReferencePId&&(u.modelList=[e.model._attributes.xRevReferencePId]);var g={isHeader:!1,isFooter:!0,firstButtonText:c.CFG_SE_ACTION_OK,secondButtonText:c.CFG_SE_ACTION_Cancel,headerText:c.CFG_Edit_Session_Header,onButtonClickCB:function(e){"firstButton"==e.buttonId?_.OKhandlar():_.CANhandlar()}};u.dialogue.modelViewContainer=new i(g).render(),u.mode="EditEvolution",_.CfgDialogIns=new t(u),u.mode="SessionEffectivity",u.dialogue.modelViewContainer.inject(_.CfgDialogIns.container),u.parent=_.CfgDialogIns.container,u.parentElement=_.CfgDialogIns.container,u.dialogue.object=_.CfgDialogIns,_.CfgDialogIns.render(),n.create(u)}))},createHeader:function(e,t){t.appendChild(UWA.createElement("div",{class:"caHeader",id:"caHeaderDiv1",html:e}))},createSessiondialog:async function(e,t){var i=this,n=null,o=widget.id;i.selectionData&&i.selectionData.appId&&o===i.selectionData.appId&&(n=await this.retrieveContextFromID(i.selectionData.id)),v.create(e,t,n)},retrieveContextFromID:function(e){if(!e)return null;const t={referenceIds:[e]};try{return A.getMultipleConfigurationContextInfo(t)}catch(e){return console.error("Error",e),null}},cleanAuthDetails:function(e){var t=this,i=document.querySelector("#workUnderDiv");g.cleanDraggableEvent(i),t.model._attributes.id="",enoviaServerAuthoringWidget.saveMode=null,enoviaServerAuthoringWidget.status=!0,t.createInnerView(i);enoviaServerAuthoringWidget.tenant;e?C.publish("removeAuthCtxSessionEvent"+t.myAuthKey):C.publish("removeAuthCtxEvent"+t.myAuthKey)},showApplicabilityDialog:async function(e){var t=this,i=document.querySelector("#workUnderDiv");i.innerHTML="";var n=UWA.createElement("div",{id:"applicabilityHeader"}),o=document.createElement("a");o.setAttribute("class","back_button");var s=document.createElement("i");s.setAttribute("class","wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-back "),o.appendChild(s),n.appendChild(o),t.createHeader(c.CFG_ToolTip_Applicability,n),i.appendChild(n);var r="";r=""==e||null==e||null==e?c.CFG_No_Applicability:await A.getDisplayExpressionUsingXSLT(e);var l=new a({value:r,domId:"applicability_editor"});i.appendChild(UWA.createElement("div",{id:"applicability",html:l})),document.getElementById("applicability_editor").children[0].disabled=!0,o.addEventListener("click",(function(e){e.stopPropagation(),t.buttonApplicabilityEvent()}))},createInnerView:function(e){const t=this;var i=UWA.createElement("div",{id:"cabodyDiv1"}),n=UWA.createElement("div",{id:"changeActionDiv"}),o=UWA.createElement("div",{id:"evolActionDiv"}),s=UWA.createElement("div",{id:"cabodyDiv3",html:"-----------"+c.CFG_Seperator+"----------"});enoviaServerAuthoringWidget.tenant;!(this.options.accessCHG||this.options.accessIDS||this.options.accessCSV)||1!=this.showChange&&"undefined"!=this.showChange&&null!=this.showChange||(t.createButton(c.CFG_CA_HEADER,"change",n,"caAction1"),i.appendChild(n)),1!=this.showEvolution&&"undefined"!=this.showEvolution&&null!=this.showEvolution||1!=this.showChange&&"undefined"!=this.showChange&&null!=this.showChange||this.options.accessCFG&&(this.options.accessCHG||this.options.accessCSV)&&i.appendChild(s),!this.options.accessCFG&&!this.options.accessIDS||1!=this.showEvolution&&"undefined"!=this.showEvolution&&null!=this.showEvolution||(t.createButton(c.CFG_Evolution_HEADER,"session",o,"caSessionBtn1"),i.appendChild(o)),null!=e&&(e.empty(!0),t.editAllowed?e.appendChild(i):e.appendChild(UWA.createElement("div",{class:"authoring-context-readonly-container",html:c.CFG_WORK_UNDER_READ_ONLY_EMPTY})))},getPAndOAccessInfo:async function(){enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",await A.populate3DSpaceURL(),await A.populateSecurityContext();let e=await A.getPAndOAccess(["WorkUnderEvolution","WorkUnderEvolutionConfiguredAdd","WorkUnderEvolutionConfiguredDelete","WorkUnderEvolutionConfiguredMove","WorkUnderEvolutionConfiguredReplace","WorkUnderEvolutionConfiguredCutOrPaste","WorkUnderEvolutionConfiguredCopyOrPaste"]);if(e&&"Granted"!==e.WorkUnderEvolution)throw"Insufficient access rights"}});return _})),define("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext",["DS/Windows/ImmersiveFrame","DS/Windows/Dialog","UWA/Class","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/Controls/TooltipModel","DS/DataDragAndDrop/DataDragAndDrop","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/WebappsUtils/WebappsUtils","UWA/Class/Model","DS/CfgAuthoringContextUX/scripts/CfgWorkUnderView","DS/CfgAuthoringContextUX/scripts/CfgCAListDialog","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXMLServices","DS/Controls/Toggle","DS/CfgAuthoringContextUX/scripts/CfgSessionDialog","UWA/Controls/Drag","DS/CfgBaseUX/scripts/CfgDialog","DS/Utilities/TouchUtils"],(function(e,t,i,n,o,s,a,r,l,d,c,u,g,h,C,v,p,m,f,A,D,y,w,b){"use strict";return i.singleton(n,{renderDiv:null,model:null,authoringContextType:null,isLicenseValid:void 0,isLicenseCFGValid:void 0,isLicenseCHGValid:void 0,isLicenseIDSValid:void 0,isWorkUnderWarningToShow:!0,myAuthkey:null,isTenantChanged:!1,fromRefresh:!1,authViewModeCtx:void 0,caIcon:"/snresources/images/icons/large/I_ECM_CA108x144.png",modelIcon:"/snresources/images/icons/large/I_PLCModel108x144.png",isOriginalXUse:!1,isOriginalYUse:!1,workUnderPopup:null,immersiveFramePopOver:null,workUnderDiv:null,originalX:null,originalY:null,lastX:null,lastY:null,isVisible:!0,oldCoord:null,cfgUXEnvVariables:JSON.parse(v),init:function(){var e=this;m.rolesAvailable((function(t){e.isLicenseCFGValid=t.isCFGRoleAvail,e.isLicenseCHGValid=t.isCHGRoleAvail,e.isLicenseCSVValid=t.isCSVRoleAvail,1==e.isLicenseCFGValid||1==e.isLicenseCHGValid||1==e.isLicenseCSVValid?e.isLicenseValid=!0:e.isLicenseValid=!1})),this.work_under={CA_Auth_Name:"",iXML:"",dictionaryList:"",Auth_Details:{version:"1.0",AuthoringContextHeader:null,change:{id:"",name:"",context:[],title:"",description:"",severity:""},evolution:{id:"",displayExpression:""},configurationRevision:null},Message_WARN:{isLicenseValid:!1,Message:r.WorkUnderDisabledCFGLicense},Message_SUCCESS:{validKey:"",isLicenseValid:!0}},this.model=new g},initialize:function(e,t,i,n,s){this.renderDiv=e;var a="",r=o.getApplicationConfiguration("app.urls.myapps"),l=window.UWA.Data.proxies.passport?"passport":"ajax";a=a.substring(0,a.indexOf("/webapps"));r||(r=a);var d,u=(new Date).getTimezoneOffset();null==t||""==t?d=(new Date).getTime()+"/AuthKey":d=t+"/AuthKey";this.myAuthkey=d;window.enoviaServerAuthoringWidget={sRealURL:a,serviceName:"3DSpace",baseURL:"",InterCom:UWA.Utils.InterCom,compassSocket:null,prefIntercomServer:null,compassSocketName:"",prefSocketName:"",storageUrl:r,timezone:u,wsCallTimeout:3e4,mySecurityContext:"",proxy:l,myRole:"",contextUser:"",isNative:!1,fromIDCard:!1,referentialsSearchType:"",contextSearchType:"",proposedSearchType:"",datamodel:"new",project_space:"",mode:"Dashboard",saveMode:"",odtEditMode:!1,status:!0,get3DSpaceURL:function(){return this.baseURL},computeUrl:function(e){return this.get3DSpaceURL()+e},getSecurityContext:function(){return this.mySecurityContext},getRole:function(){return this.myRole},collabspace:"",tenant:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",tenantnls:""},window.enoviaServerFilterWidget||p.init(null,"","3DDashboard"),window.enoviaServerFilterWidget.mode="3DDashboard",this.displayBubble=i,null!=s?(this.editAllowed=null==s.isEditable||s.isEditable,this.showEvolution=null==s.isEvolution||s.isEvolution,this.showChange=null==s.isChange||s.isChange,this.allowChangeConfguired=null==s.isChangeConfguired||s.isChangeConfguired,this.isMovable=null!=s.isMovable&&s.isMovable,this.resetDefault=null!=s.resetDefault&&s.resetDefault):(this.editAllowed=!0,this.showEvolution=!0,this.showChange=!0,this.allowChangeConfguired=!0,this.isMovable=!1,this.resetDefault=!1),this.bubblePosition="position-",this.bubblePosition+=null==n||""==n?"bottom-right":n;var g=this;this.injectAuthoringContext(e);const h=this.renderDiv.querySelector("#BubbleContainer");widget.addEvent("onResize",(function(){if(null!=h&&null!=g.workUnderPopup&&(g.closePopoverDialog(),g.createPopOverDialog()),g.isMovable&&g.resetDefault&&null!=h){var e=h.getBoundingClientRect(),t=h.parentElement.getBoundingClientRect();if(""!=h.style.top||""!=h.style.bottom||""!=h.style.right||""!=h.style.left){g.isOriginalXUse&&(this.originalX=null),g.isOriginalYUse&&(this.originalY=null),(e.x-t.x>t.width&&null==this.originalX||e.y>t.height&&null==this.originalY)&&(this.originalX=e.x-t.x,this.originalY=e.y,g.isOriginalXUse=!1,g.isOriginalYUse=!1);var i=g.setPositionOnResize(this.originalX,this.originalY);null==i.x&&null==i.y&&(g.isOriginalXUse=!0,g.isOriginalYUse=!0),null!=i.lastX&&i.lastX>0&&(g.lastX=i.lastX),null!=i.lastY&&i.lastY>0&&(g.lastY=i.lastY)}}})),this.isMovable&&(this.dragControl=new y.Move({container:this.renderDiv,delegate:"#BubbleContainer > *",centerHandles:!0,handles:function(e){return g.closePopoverDialog(!1),e.target.getClosest("#BubbleContainer")}})),this.createDialogContainer(!0),this.initBubbleClickHandler(),this.makeDroppable(h,d),"hide"==g.displayBubble&&(h.style.visibility="hidden"),o.subscribe(d,(function(e){g.update(e),g.closePopoverDialog(!1),c.setMagicProbesDataForAuthoringContext("Work_Under_Change_Action_Set")})),g.selectionDataByAppId=g.selectionDataByAppId||{},o.subscribe("DS/PADUtils/PADCommandProxy/select",(function(e){let t=e&&e.metadata?e.metadata.originWidgetId:null,i=[];if(e&&e.data&&e.data.paths&&(i=e.data.paths),1!==i.length)return void(t&&delete g.selectionDataByAppId[t]);let n=i[0],o=n[n.length-1];t&&(g.selectionDataByAppId[t]={id:o,appId:t})})),o.subscribe("removeAuthCtxEvent"+this.myAuthkey,(function(){g.cleanAuthDetails(),g.editAllowed?g.closePopoverDialog(!0):g.closePopoverDialog(!1),c.setMagicProbesDataForAuthoringContext("Work_Under_Change_Action_removeAuthCtx")})),o.subscribe("removeCAFromAuthCtxEvent",(function(e){null!=e&&g.work_under.Auth_Details.change.id==e.ChangeAction.id&&g.cleanAuthDetails()})),o.subscribe("toggleDeActiveCA"+this.myAuthkey,(function(){g.authoringContextType="disable",g.deactivateBubble(),c.setMagicProbesDataForAuthoringContext("Work_Under_Change_Action_toggleDeActive")})),o.subscribe("toggleActiveCA"+this.myAuthkey,(function(){g.authoringContextType="change",g.activateBubble(),c.setMagicProbesDataForAuthoringContext("Work_Under_Change_Action_toggleActive")})),o.subscribe("sessionEff",(async function(e){Object.prototype.hasOwnProperty.call(e,"PACID")&&g.myAuthkey==e.PACID?await g.setEffectivity(Object.assign(e,{previousAuthoringSettingBy:e.authoringSettingBy,authoringSettingBy:"Authoring"})):"session"!==g.authoringContextType&&"sessionDisable"!==g.authoringContextType||await g.setEffectivity(Object.assign(e,{authoringSettingBy:"Subscribe"})),g.closePopoverDialog(!1),g.createPopOverDialog(!0),g.closePopoverDialog(!1),c.setMagicProbesDataForAuthoringContext("Work_Under_Evolution_Effectivity_Set")})),o.subscribe("removeAuthCtxSessionEvent"+this.myAuthkey,(function(){g.cleanAuthDetails(),g.closePopoverDialog(!1),g.editAllowed&&(g.createPopOverDialog(!0),null==g.workUnderPopup&&g.closePopoverDialog(!1)),c.setMagicProbesDataForAuthoringContext("Work_Under_Evolution_Effectivity_removeAuthCtxSession")})),o.subscribe("toggleDeActiveSE"+this.myAuthkey,(function(){g.authoringContextType="sessionDisable",g.deactivateBubble(),c.setMagicProbesDataForAuthoringContext("Work_Under_Evolution_Effectivity_toggleDeActive")})),o.subscribe("toggleActiveSE"+this.myAuthkey,(function(){g.authoringContextType="session",g.activateBubble(),c.setMagicProbesDataForAuthoringContext("Work_Under_Evolution_Effectivity_toggleActive")}));var C="";return widget&&(C=widget.id),o.subscribe("NGFilter.SetConfigurationRevision_"+C,(function(e){g.setConfigurationRevisionDetails(e),console.log(e)})),o.subscribe("NGFilter.RemoveConfigurationRevision_"+C,(function(e){g.clearConfigurationRevisionDetails(),console.log(e)})),o.subscribe("applicability:update:notification",(function(e){if("string"==typeof e&&e.length>0&&(e=JSON.parse(e)),e&&e.content){const t=e.content.id;g.isVisible&&"change"==enoviaServerAuthoringWidget.saveMode&&t==g.model.get("id")&&c.getCAdetails(t).then((function(e){g.model.set("applicability",e.changeaction.applicability.expressionXML)}))}})),widget.addEvent("onRefresh",(function(){if(enoviaServerFilterWidget.tenant==widget.getValue("x3dPlatformId")||""==enoviaServerFilterWidget.tenant?g.isTenantChanged=!1:g.isTenantChanged=!0,g.fromRefresh=!0,g.isVisible)if(enoviaServerFilterWidget.saveMode,g.closePopoverDialog(),"change"==enoviaServerAuthoringWidget.saveMode){const e=g.getChangeFromAuthoring();e.fromEdit=!0,g.update(e),c.setMagicProbesDataForAuthoringContext("Work_Under_Change_Action_Refresh")}else"session"==enoviaServerAuthoringWidget.saveMode&&(g.updateSessionEff(g.getEvolutionFromAuthoringContext({fromEdit:!0,refreshTriggered:!0})),c.setMagicProbesDataForAuthoringContext("Work_Under_Evolution_Effectivity_Refresh"));g.originalX=null,g.originalY=null,g.isOriginalXUse=!1,g.isOriginalYUse=!1,g.lastX=null,g.lastY=null,g.fromRefresh=!1})),d},initialize2:function(e,t,i,n,o,s){this.renderDiv=e;var a=this;if(a.isLicenseValid){var r=a.initialize(e,t,i,n,s);return a.work_under.Message_SUCCESS.validKey=r,a.work_under.Message_SUCCESS.isAuthoringContextVisible=a.isLicenseCHGValid||a.isLicenseCFGValid,void o(a.work_under.Message_SUCCESS)}if(!1===a.isLicenseValid)o(a.work_under.Message_WARN);else{m.rolesAvailable((function(r){if(a.isLicenseCFGValid=r.isCFGRoleAvail,a.isLicenseCHGValid=r.isCHGRoleAvail,a.isLicenseCSVValid=r.isCSVRoleAvail,1==a.isLicenseCFGValid||1==a.isLicenseCHGValid||1==a.isLicenseCSVValid){a.isLicenseValid=!0;var l=a.initialize(e,t,i,n,s);return a.work_under.Message_SUCCESS.validKey=l,a.work_under.Message_SUCCESS.isAuthoringContextVisible=a.isLicenseCHGValid||a.isLicenseCFGValid,void o(a.work_under.Message_SUCCESS)}a.isLicenseValid=!1,o(a.work_under.Message_WARN)}))}},closePopoverDialog:function(e){var t=this;null!=t.workUnderPopup&&(t.workUnderPopup.destroy(),t.workUnderPopup=null,UWA.is(t.immersiveFramePopOver.destroy,"function")&&(t.immersiveFramePopOver.destroy(),t.immersiveFramePopOver=void 0),1==e&&(enoviaServerAuthoringWidget.saveMode=null,t.createPopOverDialog(!0)))},initBubbleClickHandler:function(){const t=this,i=this.renderDiv.querySelector("#BubbleContainer");t.immersiveFramePopOver=new e,t.immersiveFramePopOver.addEventListener("removeWindow",(function(){})),i.addEventListener("click",(function(){null==t.workUnderPopup?(t.editAllowed||null!=t.authoringContextType)&&t.createPopOverDialog():t.closePopoverDialog(!1)})),t.renderDiv.addEventListener("click",(function(e){null!=t.workUnderPopup&&e.target!=t.renderDiv.querySelector("#iconAuthImg")&&e.target!=t.renderDiv.querySelector("#BubbleContainer")&&t.closePopoverDialog(!1)}))},createPopOverDialog:function(i=!1){const n=this,o=n.renderDiv.querySelector("#BubbleContainer");n.immersiveFramePopOver||(n.immersiveFramePopOver=new e);var s=widget?widget.body:n.renderDiv;n.immersiveFramePopOver.inject(s),n.immersiveFramePopOver.addEventListener("click",(function(e){null!=n.workUnderPopup&&(e.target!=n.immersiveFramePopOver.elements.container.querySelector(".wux-windows-modalDialog")&&e.target!=n.immersiveFramePopOver.elements.container.querySelector(".wux-windows-immersive-frame-freeZone")&&e.target!=n.renderDiv.querySelector("#BubbleContainer")||n.closePopoverDialog(!1))}));let a=o.getBoundingClientRect();const l=o.parentElement.getBoundingClientRect();0===a.x&&0===a.y&&0===a.width&&0===a.height?this.oldCoord&&(a=this.oldCoord):this.oldCoord=a;let d=90,c=-140;i||"change"!==enoviaServerAuthoringWidget.saveMode&&"session"!==enoviaServerAuthoringWidget.saveMode||(c-=70,d+=70);let u=c;l.x+l.width-a.x<300&&(u=d);var g=a.x-(l.x+u);window.navigator.userAgent.search("Firefox")>-1&&"session"==enoviaServerAuthoringWidget.saveMode&&(a.y-=55,g-=100),n.workUnderPopup=new t({domId:"work-under-z-index",title:r.CFG_WorkUnder_HEADER,content:n.workUnderDiv,resizableFlag:!1,immersiveFrame:n.immersiveFramePopOver,position:{at:"top left",offsetX:g,offsetY:a.y+20},modalFlag:!1,movableFlag:!1});const C=enoviaServerFilterWidget.saveMode;"change"===C?n.authViewModeCtx="change":"session"===C&&(n.authViewModeCtx="session");var v=widget.id,p=null;n.selectionDataByAppId&&n.selectionDataByAppId[v]&&(p=n.selectionDataByAppId[v]),new h({model:n.model,appDiv:n.renderDiv,access:n.isLicenseValid,accessCFG:n.isLicenseCFGValid,accessCHG:n.isLicenseCHGValid,accessIDS:n.isLicenseIDSValid,accessCSV:n.isLicenseCSVValid,editAllowed:n.editAllowed,showEvolution:n.showEvolution,showChange:n.showChange,allowChangeConfguired:n.allowChangeConfguired,myAuthKey:n.myAuthkey,authViewMode:n.authViewModeCtx,selectionData:p}).render(),n.workUnderPopup.addEventListener("close",(function(e){n.closePopoverDialog(!1)}))},createDialogContainer:function(e){var t="cfgAuthContextPopOverClass";e&&(t+=" newPopOver"),this.workUnderDiv=new UWA.createElement("div",{id:"workUnderDiv",class:t,html:""})},injectAuthoringContext:function(e){var t=this,i=new UWA.createElement("div",{class:this.bubblePosition,styles:{"user-select":"none"},events:{click:function(e){},mouseover:function(){let e;switch(t.authoringContextType){case"change":case"disable":e=t.model.get("title");break;case"session":case"sessionDisable":e=t.model.get("content");break;default:e=r.CFG_NO_WORK_UNDER}i.tooltipInfos=new s({shortHelp:e,mouseRelativePosition:!1,position:"bottom",arrowBoxFlag:!0})}}});i.setAttributes({id:"BubbleContainer"});var n=UWA.createElement("img",{src:u.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxEmpty.png"),events:{}});n.setAttributes({id:"iconAuthImg"}),n.inject(i),this.renderDiv.appendChild(i)},makeDroppable:function(e,t){var i=this;a.droppable(e,{drop:function(e){if(UWA.is(e)&&""!=e){const t=JSON.parse(e);if(Object.prototype.hasOwnProperty.call(t,"data"))if("Authoring Context"===t.data.items[0].objectType)if((1==i.showEvolution||null==i.showEvolution)&&c.isConfigurationLicencesValid(i.isLicenseCFGValid,i.isLicenseIDSValid)&&i.editAllowed){i.cleanAuthDetails();const e={ACId:t.data.items[0].objectId,evolutionExpression:t.data.items[0].objectData.evolutionExpression,dictionaryContext:t.data.items[0].objectData.dictionaryContext,displayExpression:t.data.items[0].objectData.displayExpression,collection:[],authoringSettingBy:"Drop"};t.data.items[0].objectData.isxRevisionEffectivity&&e.collection.push({selectedDataType:t.data.items[0].objectData.selectedDataType,marketingName:t.data.items[0].objectData.title,name:t.data.items[0].objectData.desc,image:t.data.items[0].objectData.image}),o.publish("sessionEff",Object.assign(e,{PACID:i.myAuthkey})),i.closePopoverDialog(!1)}else c.showMessage({element:i.renderDiv,type:"error",message:r.CFG_WORK_UNDER_WITH_EVOLUTION_CANNOT_USE});else if((1==i.showChange||null==i.showChange)&&c.isChangeLicencesValid(i.isLicenseCHGValid,i.isLicenseCSVValid,i.isLicenseIDSValid)&&i.editAllowed){i.cleanAuthDetails();const e=c.getWorkUnderEmptyObject();e.change.id=t.data.items[0].objectId,e.change.name=t.data.items[0].displayName,i.publish(i.myAuthkey,Object.assign(e,{authoringSettingBy:"Drop"})),i.closePopoverDialog(!1)}else c.showMessage({element:i.renderDiv,type:"error",message:r.CFG_WORK_UNDER_WITH_CA_CANNOT_USE});else c.showMessage({element:i.renderDiv,type:"error",message:r.CFG_AUTH_CTX_DROP_FAILURE})}else c.showMessage({element:i.renderDiv,type:"error",message:r.CFG_AUTH_CTX_DROP_FAILURE})},enter:function(){arguments[1].preventDefault(),arguments[1].stopPropagation()},over:function(){arguments[1].preventDefault(),arguments[1].stopPropagation()},leave:function(){arguments[1].preventDefault(),arguments[1].stopPropagation()}})},get2:function(e){var t=this;if(t.isLicenseValid){var i=t.get();e(i)}else if(0==t.isLicenseValid)e(t.work_under.Message_WARN);else{m.rolesAvailable((function(i){if(t.isLicenseCFGValid=i.isCFGRoleAvail,t.isLicenseCHGValid=i.isCHGRoleAvail,1!=t.isLicenseCFGValid&&1!=t.isLicenseCHGValid&&1!=t.isLicenseCSVValid)t.isLicenseValid,e(t.work_under.Message_WARN);else{t.isLicenseValid=!0;var n=t.get();e(n)}}))}},get:function(e){var t=this;return null!=t.authoringContextType&&enoviaServerAuthoringWidget.status?("change"===enoviaServerAuthoringWidget.saveMode?t.getChangeFromAuthoring(e):t.getEvolutionFromAuthoringContext(e),t.getComplementaryInformation()):t.getWorkUnderAuthDetailsEmtpy(),null!=t.model.get("configurationRevision")?t.work_under.Auth_Details.configurationRevision=t.model.get("configurationRevision"):t.work_under.Auth_Details.configurationRevision=null,t.work_under.Auth_Details},getWorkUnderAuthDetailsEmtpy:function(){var e=this;e.work_under.Auth_Details.version="1.0",e.work_under.Auth_Details.change.id="",e.work_under.Auth_Details.change.name="",e.work_under.Auth_Details.change.context=[],e.work_under.Auth_Details.change.title="",e.work_under.Auth_Details.change.description="",e.work_under.Auth_Details.change.severity="",e.work_under.Auth_Details.evolution.id="",e.work_under.Auth_Details.evolution.displayExpression="",e.work_under.Auth_Details.evolution.expression="",e.work_under.CA_Auth_Name="",e.work_under.Auth_Details.AuthoringContextHeader=null,"disable"!=e.authoringContextType&&"sessionDisable"!=e.authoringContextType||("change"===enoviaServerAuthoringWidget.saveMode?e.work_under.CA_Auth_Name=e.model.get("title"):"session"===enoviaServerAuthoringWidget.saveMode&&(e.work_under.CA_Auth_Name=e.model.get("content")))},getChangeFromAuthoring:function(e){const t=this;t.work_under.Auth_Details.change.id=t.model.get("id");var i=null;""!=t.model.get("id")&&(i={"DS-Change-Authoring-Context":"pid:"+t.model.get("id")}),t.work_under.Auth_Details.AuthoringContextHeader=i,t.work_under.Auth_Details.change.description=t.model.get("content"),t.work_under.CA_Auth_Name=t.model.get("title"),t.getComplementaryInformation();try{null!=typeof e&&void 0!==e||c.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Change",settingBy:1==t.fromRefresh?"Refresh":"Authoring",usage:"Get",change:{applicability:""==t.model._attributes.applicability?"FALSE":"TRUE"},evolution:{xml:!1,noModel:0}}})}catch(e){console.error(e)}return t.work_under.Auth_Details},getEvolutionFromAuthoringContext:function(e){const t=this;t.work_under.Auth_Details.evolution.id=t.model.get("id"),t.work_under.Auth_Details.evolution.displayExpression=t.model.get("content"),t.work_under.iXML=t.model.get("evolExpression"),t.work_under.Auth_Details.evolution.expression=t.model.get("evolExpression"),t.work_under.dictionaryList=t.model.get("dictionaryContext"),e&&e.refreshTriggered&&(t.work_under.Auth_Details.refreshTriggered=e.refreshTriggered),t.model.get("isxRevisionEffectivity")&&(t.work_under.Auth_Details.evolution.xRevReferencePId=t.model.get("dictionaryContext")&&t.model.get("dictionaryContext").length>0?t.model.get("dictionaryContext")[0]:t.model.get("id"),t.work_under.Auth_Details.evolution.xRevisionGraphTitle=t.model.get("desc"));var i=null;""!=t.model.get("id")&&(i={"DS-Configuration-Authoring-Context":"pid:"+t.model.get("id")}),t.work_under.Auth_Details.AuthoringContextHeader=i,t.work_under.CA_Auth_Name=t.model.get("content"),t.getComplementaryInformation();try{null==typeof e||void 0===e?c.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Evolution",settingBy:1==t.fromRefresh?"Refresh":"Authoring",usage:"Get",change:{applicability:"FALSE"},evolution:{xml:t.model.get("evolExpression"),noModel:t.model.get("dictionaryContext").length||1}}}):Object.prototype.hasOwnProperty.call(e,"fromEdit")||c.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Evolution",settingBy:1==t.fromRefresh?"Refresh":"Authoring",usage:"Get",change:{applicability:"FALSE"},evolution:{xml:t.model.get("evolExpression"),noModel:t.model.get("dictionaryContext").length||1}}})}catch(e){console.error(e)}return t.work_under.Auth_Details},getComplementaryInformation:function(){const e=this;return e.work_under.Auth_Details.version="1.0",e.work_under.Auth_Details.change.name=e.model.get("synopsis"),e.work_under.Auth_Details.change.context=e.model.get("context"),e.work_under.Auth_Details.change.title=e.model.get("title"),e.work_under.Auth_Details.change.severity=e.model.get("severity"),e.work_under.Auth_Details},set2:function(e,t){(Object.prototype.hasOwnProperty.call(e,"change")||Object.prototype.hasOwnProperty.call(e,"evolution"))&&(Object.prototype.hasOwnProperty.call(e.change,"id")||Object.prototype.hasOwnProperty.call(e.evolution,"id"))&&(""==e.change.id&&""==e.evolution.id||this.set(e,(function(e){})))},set:function(e,t){var i=this,n=e.change.id;e.change.name,e.change.title,e.change.description,e.change.severity;let s=e.change.image;var a="",l=e.AuthoringContextHeader;if(Object.assign(e,{previousAuthoringSettingBy:e.authoringSettingBy}),null!=e.configurationRevision?i.model.set("configurationRevision",e.configurationRevision):i.model.set("configurationRevision",null),null!=l&&"DS-Configuration-Authoring-Context"in l&&(a="Evolution"),"Evolution"==a)i.setEffectivity(Object.assign(e,{authoringSettingBy:"Authoring"}),t);else{p.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise";var d=i.fromRefresh;""!=n&&void 0!==n&&m.populate3DSpaceURL().then((function(a){m.populateSecurityContext().then((function(a){c.getCAdetails(n).then((function(a){m.getObjectInfo(n).then((function(e){s||(s=e.data[0].dataelements.image),i.model.set("image",s||enoviaServerFilterWidget.computeUrl(i.caIcon))})),i.fromRefresh=!1;for(var l="",u="",g="",h="",C="",v="",p="",f="",A=a.changeaction.attributes,D=0;D<A.length;D++)"currentNLS"==A[D].name&&(l=A[D].value),"current"==A[D].name?u=A[D].value:"attribute_Severity"==A[D].name?g=A[D].value:"attribute_Synopsis"==A[D].name?h=A[D].value:"interface[Change On Hold]"==A[D].name?C=A[D].value:"attribute_Originator"==A[D].name?p=A[D].value:"attribute_Change.CompletionDateDue"==A[D].name&&(f=A[D].value);if(null!=a.changeaction.editability&&"allowed"==a.changeaction.editability.work_under&&(v="TRUE"),"In Work"==u&&"FALSE"==C&&"TRUE"==v&&0==i.isTenantChanged){var y=h,w=a.changeaction.description,b=a.changeaction.name,S=a.changeaction.context;g=g;try{c.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Change",settingBy:1==d?"Refresh":e.authoringSettingBy||"Authoring",usage:"Set",change:{applicability:a.changeaction.applicability.expressionXML?"TRUE":"FALSE"},evolution:{xml:!1,noModel:0}}})}catch(e){console.error(e)}if(i.model.set("id",n),i.model.set("context",S),i.model.set("title",y),i.model.set("content",w),i.model.set("synopsis",b),i.model.set("severity",g),i.model.set("subtitle",b),i.model.set("originator",p),i.model.set("maturityState",l),i.model.set("dueDate",f),i.model.set("applicability",a.changeaction.applicability.expressionXML),m.populateDisplayExpressionXSLT(),i.work_under.CA_Auth_Name=i.model.get("title"),d||(i.authoringContextType="change",i.activateBubble(),enoviaServerAuthoringWidget.status=!0),enoviaServerAuthoringWidget.saveMode="change",null!=t){var _=i.get();t(_)}i.allowChangeConfguired?"Drop"==e.previousAuthoringSettingBy&&c.showMessage({element:i.renderDiv,type:"primary",message:r.CFG_AUTH_CTX_DROP_SUCCESS}):0!=a.changeaction.applicability.display.length&&(i.desactivateBubbleStyle(),m.showwarning(r.CA_Applicability_Block,"error"))}else i.desactivateBubbleStyle(),1==i.isTenantChanged?i.isTenantChanged=!1:d?m.showwarning(r.CFG_REFRESH_CA_STATE_CHECK,"warning"):m.showwarning(r.CFG_DROP_CA_ACTION_STATE_CHECK,"error"),o.publish("removeAuthCtxEvent"+i.myAuthkey)}),(function(e){return i.desactivateBubbleStyle(),e&&7==e.errorID&&m.showwarning(r.CFG_DROP_CA_ACTION,"error"),o.publish("removeAuthCtxEvent"+i.myAuthkey),Promise.reject(e)}))}),(function(e){return Promise.reject(e)}))}),(function(e){return Promise.reject(e)}))}},setFromDrop:function(e,t){console.groupCollapsed("Set Change objects from drop"),console.log("Pass information from 3DSpace/resources/modeler/change/changeaction WS response"),console.log(JSON.stringify(e,null,2)),console.groupEnd(),!1===UWA.is(e)||e.length>1||0==e.length?m.showwarning(r.CFG_Single_Change_Action,"error"):!0!==this.isWorkUnderWarningToShow?this.setAfterDropValidation(e,t):this.showWorkUnderWarningMesssage(e,t)},setAfterDropValidation:function(e,t){if(UWA.is(e)){for(var i=e[0].changeaction,n=i.id.replace("pid:",""),o="",s=0;s<i.attributes.length;s++){var a=i.attributes[s];"attribute_Synopsis"==a.name&&(o=a.value)}var r=this.get();r.AuthoringContextHeader=null,r.change.id=n,r.change.name=o,enoviaServerAuthoringWidget.status=!0,this.authoringContextType="change",this.fromRefresh=!1;var l=this;this.update(r,(function(){l.publish(l.myAuthkey,r)}))}this.dispatchEvent("onAuthoringCtxVisible",{showAuthoringContext:!0})},showWorkUnderWarningMesssage:function(e,t){for(var i=this,n=e[0].changeaction,o="",a=0;a<n.attributes.length;a++){var d=n.attributes[a];"attribute_Synopsis"==d.name&&(o=d.value)}var c=function(){C.closeDialog(),i.setAfterDropValidation(e,t)}.bind(i),u=function(){C.closeDialog()}.bind(i),g=this.renderDiv;widget&&(g=widget.body);var h={minWidth:1,minHeight:1,touchMode:b.getTouchMode(),isResizable:!1,dialogue:{header:r.CFG_DnD_PopOver,buttonArray:[{label:"Yes",labelValue:l.CFG_EFFECTIVITY_YES,handler:c,className:"primary"},{label:"No",labelValue:l.CFG_EFFECTIVITY_NO,handler:u,className:"default"}],target:g,object:null,postCrossHandler:u}},C=new w(h);C.render();var v=new UWA.Element("div",{html:r.CFG_DropWarning+" "+o+" ?<br><br>",styles:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}});v.tooltipInfos=new s({shortHelp:r.CFG_DropWarning+" "+o,mouseRelativePosition:!0,position:"bottom",arrowBoxFlag:!1});var p=new A({label:r.CFG_Checkbox_Warning});p.addEventListener("change",(function(e){1==e.dsModel.checkFlag?i.isWorkUnderWarningToShow=!1:i.isWorkUnderWarningToShow=!0})),v.inject(C.container),p.inject(C.container)},saveAsSessionEvolution:function(e){var t=this;""!=e["Evolution Expression"]?(widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",m.populate3DSpaceURL().then((function(i){m.populateSecurityContext().then((function(i){c.getAuthoringIDforEvolution(e).then((function(i){var n=t.get();n.evolution.id=i.ACId,n.evolution.displayExpression=i.XSLTExpr,e.xRevReferenceInfo&&(n.evolution.xRevReferencePId=e.xRevReferenceInfo.xRevReferencePId,n.evolution.xRevisionGraphTitle=e.xRevReferenceInfo.xRevisionGraphTitle),o.publish("sessionEff",Object.assign(n,{PACID:t.myAuthkey}))}),(function(e){console.log(e),e&&"1"===e.errorID?m.showwarning(r.CFG_SET_FROZEN_EVOLUTION_FAILED,"error"):m.showwarning(r.CFG_WORK_UNDER_EVOLUTION_FAILED,"error")}))}),(function(e){return console.log("populateSecurityContext Failed"),Promise.reject(e)}))}),(function(e){return console.log("populate3DSpaceURL Failed"),Promise.reject(e)}))):o.publish("removeAuthCtxSessionEvent"+t.myAuthkey)},setEffectivity:async function(e,t){const i=this;if(""!=e.ACId&&null!=e.ACId)e.collection&&e.collection.length>0&&"Model"!=e.collection[0].selectedDataType||""!=f.getxRevXMLFromGlobalXML(e.evolutionExpression)?async function(t,n){i.model.set("evolExpression",t.evolutionExpression),i.model.set("id",t.ACId),e.refreshTriggered&&1==e.refreshTriggered||i.model.set("dictionaryContext",t.dictionaryContext),i.model.set("content",e.displayExpression),i.model.set("isxRevisionEffectivity",!0),t.collection&&t.collection.length>0&&i.model.set("selectedDataType",t.collection[0].selectedDataType),Object.prototype.hasOwnProperty.call(t,"collection")&&1==t.collection.length&&(i.model.set("title",t.collection[0].marketingName),i.model.set("desc",t.collection[0].name),i.model.set("image",t.collection[0].image)),i.work_under.CA_Auth_Name=i.model.get("content"),("disable"!==i.authoringContextType&&"sessionDisable"!==i.authoringContextType&&!i.fromRefresh&&!e.fromEdit||null!=e.authoringSettingBy&&"Authoring"==e.authoringSettingBy)&&(i.authoringContextType="session",i.activateBubble()),enoviaServerAuthoringWidget.saveMode="session",null!=n&&n(i.get())}(e,t):async function(t,n){i.model.set("evolExpression",t.evolutionExpression),i.model.set("id",t.ACId),i.model.set("dictionaryContext",t.dictionaryContext),i.model.set("content",e.displayExpression),i.model.set("isxRevisionEffectivity",!1),i.model.set("selectedDataType","Model");let o=enoviaServerFilterWidget.computeUrl(i.modelIcon);const s=i.getInfoFromXml(t.evolutionExpression,"HolderName");try{p.init(),enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")||"OnPremise",await m.populate3DSpaceURL(),await m.populateSecurityContext();const e=await c.getObjectFromEvolutionContextIds([s],"","model","");e&&i.model.set("image",i.getAttributeFromEvolutionObject(e.results[0].attributes,"preview_url"))}catch(e){i.model.set("image",o)}null!=i.model._attributes.image&&"undefined"!=i.model._attributes.image||i.model.set("image",o),Object.prototype.hasOwnProperty.call(t,"collection")&&(1==t.collection.length?(i.model.set("title",t.collection[0].marketingName),i.model.set("desc",t.collection[0].name)):(i.model.set("title",t.collection.map((e=>e.marketingName)).join(", ")),i.model.set("desc",t.collection.map((e=>e.name||" ")).join(", ")),i.model.set("image",o))),i.work_under.CA_Auth_Name=i.model.get("content"),("disable"!==i.authoringContextType&&"sessionDisable"!==i.authoringContextType&&!i.fromRefresh&&!e.fromEdit||null!=e.authoringSettingBy&&"Authoring"==e.authoringSettingBy)&&(i.authoringContextType="session",i.activateBubble(),"Drop"==e.previousAuthoringSettingBy&&c.showMessage({element:i.renderDiv,type:"primary",message:r.CFG_AUTH_CTX_DROP_SUCCESS})),enoviaServerAuthoringWidget.saveMode="session",null!=n&&n(i.get());try{let n=1;void 0!==t.collection&&(n=t.collection.length),c.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Evolution",settingBy:1==i.fromRefresh?"Refresh":e.authoringSettingBy||"Authoring",usage:"Set",change:{applicability:"FALSE"},evolution:{xml:t.evolutionExpression,noModel:n||1}}})}catch(e){console.error(e)}i.fromRefresh&&(i.fromRefresh=!1)}(e,t);else if(null!=e.evolution&&""!=e.evolution.id){var n=e.evolution.id,s=e.evolution.displayExpression;if(i.model.set("content",s),e.evolution.xRevReferencePId){let t="/snresources/images/icons/large/I_ENOVIA_Baseline.png",n=enoviaServerFilterWidget.computeUrl(t);i.model.set("image",n),i.model.set("xRevReferencePId",e.evolution.xRevReferencePId),i.model.set("desc",e.evolution.xRevisionGraphTitle),i.model.set("selectedDataType","xRevision"),i.model.set("isxRevisionEffectivity",!0)}else i.model.set("xRevReferencePId",null),i.model.set("selectedDataType","Model"),i.model.set("isxRevisionEffectivity",!1);p.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",m.populate3DSpaceURL().then((function(){m.populateSecurityContext().then((function(){c.readAuthroingContext().then((function(o){var s=o["Evolution Expression"],a=o["Dictionary Contexts"];if(i.model.set("id",n),i.model.set("context",""),e.evolution.xRevReferencePId){let e=o["Dictionary Cache"];if(e&&e.length>0){let t=f.getHoldeInformation(e);i.model.set("title",t.HolderDisplayName),i.model.set("desc",t.HolderName)}}else i.model.set("title","");if(i.model.set("synopsis",""),i.model.set("severity",""),i.model.set("subtitle",""),i.model.set("evolExpression",s),i.model.set("dictionaryContext",a),i.work_under.CA_Auth_Name=i.model.get("content"),i.renderDiv.querySelector("#iconAuthImg").src=u.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxSE.png"),i.authoringContextType="session",enoviaServerAuthoringWidget.saveMode="session",enoviaServerAuthoringWidget.status=!0,null!=t){var r=i.get();t(r)}}),(function(e){return console.log("create fail"),Promise.reject(e)}))}),(function(e){return console.log("populateSecurityContext Failed"),Promise.reject(e)}))}),(function(e){return console.log("populate3DSpaceURL Failed"),Promise.reject(e)}))}else i.model.id=null,i.model._attributes.content="",i.model._attributes.id="",i.model._attributes.evolExpression="",i.model._attributes.dictionaryContext="",o.publish("removeAuthCtxSessionEvent"+i.myAuthkey)},getInfoFromXml:function(e,t){var i=e.substr(e.lastIndexOf(t));return(i=i.split('"'))[1]},getAttributeFromEvolutionObject:function(e,t){let i=null;return e.forEach((function(e){if(e.name==t)return i=e.value,!0})),i},publish:function(e,t){o.publish(e,t)},update:function(e,t){this.set(e,t)},updateSessionEff:async function(e){const t=this;if(null!=e.evolution.id&&""!=e.evolution.id){const i=function(e){t.setEffectivity({ACId:e.ACId,evolutionExpression:e["Evolution Expression"],dictionaryContext:e["Dictionary Contexts"],displayExpression:t.model.get("content"),refreshTriggered:t.model.get("refreshTriggered")})};t.model.set("content",e.evolution.displayExpression),t.model.set("refreshTriggered",!1),e.refreshTriggered&&t.model.set("refreshTriggered",e.refreshTriggered),p.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",await m.populate3DSpaceURL(),await m.populateSecurityContext(),i(await c.readAuthroingContext())}else t.model.id=null,t.model._attributes.content="",t.model._attributes.id="",t.model._attributes.evolExpression="",t.model._attributes.dictionaryContext="",o.publish("removeAuthCtxSessionEvent"+t.myAuthkey);t.fromRefresh=!1},getAllowedType:function(){return["Change Action"]},hide:function(){this.isVisible=!1;var e=this.renderDiv.querySelector("#BubbleContainer");void 0!==e&&null!=e&&(e.style.visibility="hidden")},show:function(){this.isVisible=!0;var e=this.renderDiv.querySelector("#BubbleContainer");void 0!==e&&null!=e&&(e.style.visibility="visible")},setPosition:function(e){var t=this.renderDiv.querySelector("#BubbleContainer");void 0!==t&&null!=t&&(t.classList.remove("position-bottom-right"),t.classList.remove("position-bottom-left"),t.classList.remove("position-top-left"),t.classList.remove("position-top-right"),t.classList.add("position-"+e),this.closePopoverDialog(!1))},setPositionOnResize:function(e,t){var i=this,n=this.renderDiv.querySelector("#BubbleContainer");if(void 0!==n&&null!=n){var o=n.getBoundingClientRect(),s=n.parentElement.getBoundingClientRect(),a=0,r=0,l=50,d=o.x-s.x;return null!=e&&null!=t&&(null!=i.lastX&&null!=i.lastY&&(i.lastX==d&&i.lastY==o.y||(e=d,t=o.y)),d<s.width?e<s.width?e>s.width-l?a=e-l:(a=e,e=null):a=o.y>s.height?d>s.width-l?d-l:d:s.width-l:a=s.width-l,o.y<s.height?t<s.height?t>s.height-l?r=t-l:(r=t,t=null):r=d>s.widht?o.y>s.height-l?o.y-l:o.y:s.height-l:r=s.height-l,n.style="left: "+a+"px; top:"+r+"px;"),{x:e,y:t,lastX:a,lastY:r}}},deactivateToggle:function(){const e=document.getElementById("autoggle");e&&e.removeAttribute("checked"),enoviaServerAuthoringWidget.status=!1},activateToggle:function(){const e=document.getElementById("autoggle");e&&e.setAttribute("checked",""),enoviaServerAuthoringWidget.status=!0},deactivateBubble:function(){this.desactivateBubbleStyle(),this.deactivateToggle()},activateBubble:function(){this.activateBubbleStyle(),this.activateToggle()},desactivateBubbleStyle:function(){this.renderDiv.querySelector("#iconAuthImg").src=u.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxEmpty.png"),this.renderDiv.querySelector("#BubbleContainer").setStyle("borderColor","#d3d3d3")},activateBubbleStyle:function(){var e=this,t=u.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxEmpty.png");"change"==e.authoringContextType?t=u.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxCA.png"):"session"==e.authoringContextType&&(t=u.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxSE.png")),e.renderDiv.querySelector("#iconAuthImg").src=t,e.renderDiv.querySelector("#BubbleContainer").setStyle("borderColor","#78befa")},clearConfigurationRevisionDetails:function(){this.model.set("configurationRevision",null)},setConfigurationRevisionDetails:function(e){this.model.set("configurationRevision",e)},getConfigurationRevisionDetails:function(){var e=this;return null!=e.model.get("configurationRevision")?e.work_under.Auth_Details.configurationRevision=e.model.get("configurationRevision"):e.work_under.Auth_Details.configurationRevision=null,e.work_under.Auth_Details},cleanAuthDetails:async function(){const e=this;e.desactivateBubbleStyle(),e.authoringContextType=null,e.model._attributes.id="",e.model.id=null;const t=document.querySelector("#workUnderDiv");t&&(c.cleanDraggableEvent(t),t.classList.contains("sessionAuthoringCtx")&&t.classList.remove("sessionAuthoringCtx")),e.closePopoverDialog(!0)}})}));