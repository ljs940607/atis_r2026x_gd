define("DS/DELPPWModelParsers/ConnectionParser",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELPPWLoggerModel/LoggerUtils"],(function(e,t,n,s){"use strict";return t.singleton({name:"ConnectionParser",collectionUtils:null,init:function(e){if(e=e||{},this._parent(e),!e.collectionUtils)throw new Error("collectionUtils options not defined");this.collectionUtils=e.collectionUtils},parse:function(t,n,i,o){var r=this,a=o||{},c=!e.is(a.silentMode,"boolean")||a.silentMode,l=!e.is(a.mergeMode,"boolean")||a.mergeMode,u=!e.is(a.parseMode,"boolean")||a.parseMode,d={},f={},p={},g={},P=e.is(i),b=e.is(n),y=b&&Array.isArray(n.stackedReferences),I=function(t){return!(s=t,i=!y,y&&(i=n.stackedReferences.some((function(e){return s===e.attributesValue.PID}))),i||e.is(r.collectionUtils.getReferenceFromCollection(t)));var s,i};return function(){var o,a,y,R,h,m,A=null;if(!e.is(t))return p;for(A in t)Object.prototype.hasOwnProperty.call(t,A)&&(A.contains("from.")?(o=A.substring(A.indexOf("from.")+5),d[o]=t[A]):A.contains("to.")?(o=A.substring(A.indexOf("to.")+3),f[o]=t[A]):A.contains("usagePoints.attributesValue")?g=t[A]:A.contains("usagePoint")?h=t[A]:A.contains("attributesValue")?p=t.attributesValue:p[A]=t[A]);return p.from=e.is(d.PID)?d.PID:e.is(d.attributesValue)?d.attributesValue.PID:null,p.to=e.is(f.PID)?f.PID:e.is(f.attributesValue)?f.attributesValue.PID:null,e.is(h)&&h.length>0&&(p.usagePoint=h),e.is(p.type)||(a=p.PID,e.is(a,"string")?(y=a.split("|"),Array.isArray(y)?0<y.length?(R=y[0],p.type=R):s.debug(r.name,"ERROR: no | to split on in pid "+a):s.debug(r.name,"ERROR: Could not split "+a+" on |")):s.debug(r.name,"ERROR: No PID Attribute")),(m=function(t){var s=e.is(t.attributesValue)?t.attributesValue:null;if(s){if("DELAsmProcessCanUseCnx"===s.type||"SecondaryCandidateResourceLink"===s.type)return;s.isInstanceOf?(b&&Array.isArray(n.stackedInstances)?n.stackedInstances.push(t):r.collectionUtils.addInst(t,{silent:c,merge:l,parse:u}),P&&I(s.isInstanceOf)&&i.push(s.isInstanceOf)):(b&&Array.isArray(n.stackedReferences)?n.stackedReferences.unshift(t):r.collectionUtils.addRef(t,{silent:c,merge:l,parse:u}),P&&I(s.PID)&&i.push(s.PID))}})(d),m(f),Object.keys(g).forEach((e=>m(g[e]))),b&&Array.isArray(n.stackedConnections)?n.stackedConnections.push(p):r.collectionUtils.addConn(p,{silent:c,merge:l,parse:u}),p}()},parseAuthoringResponse:function(t,n){var s,i=this,o=e.is(n)&&e.is(n.data)&&e.is(n.data,"string")&&n.data.length>0?JSON.parse(n.data):null,r={stackedConnections:[]};return t=t||{},(t=e.merge(t,{instancesAndReferences:[],connections:[]})).instancesAndReferences.forEach((function(t){var n,s,o=t.attributesValue;Object.prototype.hasOwnProperty.call(o,"isInstanceOf")?(n=i.collectionUtils.getInstanceFromCollection(o.PID),e.is(n)&&n.set(o)):(s=i.collectionUtils.getReferenceFromCollection(o.PID),e.is(s)&&s.set(o))})),t.connections.forEach((function(t){var n=i.parse(t,r);e.is(o)&&o.type.contains(n.type)?s=n:i.collectionUtils.addConn(n)})),s}})}));