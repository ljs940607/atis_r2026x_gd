define("DS/ENONextGenFilterUX/views/StrDropView",["UWA/Core","UWA/Class/View"],(function(e,t){"use strict";return t.extend({name:"Str-drop",_zonesCounter:{add:0,replace:0},className:function(){return this.getClassNames("-container")},setup:function(){this._addContentDiv=e.createElement("div",{class:"drop-zone add-content",html:{tag:"div",html:[{tag:"span",class:"fonticon fonticon-popup"},{tag:"p",html:"dropAddContent"}]}}),this._addContentDiv.addEventListener("drop",this._onDrop.bind(this)),this.container.addEventListener("dragover",this._onDragOver),this.container.setContent(this._addContentDiv)},show:function(e,t){console.log("RCIII show de StrDropView"),"none"===this.container.getStyle("display")&&(this.container.setStyle("width",e+"px"),"extract"===sessionStorage.getItem("ENOStr_currentDrag")||!0===t?this._addContentDiv.addClassName("full"):this._addContentDiv.removeClassName("full")),this.container.show()},hide:function(){console.log("RCIII hide de StrDropView"),this.container.hide(),this._zonesCounter.add=0,this._zonesCounter.replace=0,this.dispatchEvent("ENOStr_hide",[])},updateHeight:function(e){console.log("RCIII updateheight de StrDropView"),this._addContentDiv.setStyle("height",e+"px")},_onDragOver:function(e){console.log("RCIII dragOver de StrDropView"),e.stopPropagation(),e.preventDefault()},_onDrop:function(e){e.stopPropagation(),e.preventDefault(),this.hide();for(var t,i,n,o="function"==typeof e.dataTransfer.types.indexOf?"indexOf":"contains",s="",r=["text/searchitems","text/plain","Text"],a=e.currentTarget.hasClassName("add-content")?"add":"replace",l=0;l<r.length&&""===s;l++)("number"==typeof(n=e.dataTransfer.types[o](r[l]))&&n>=0||"boolean"==typeof n&&!0===n)&&(s=r[l]);(i=e.dataTransfer.getData(s)).length&&(a=(t=JSON.parse(i)).action?t.action:a),this.dispatchEvent("ENOStr_drop",[a,t]),sessionStorage.removeItem("ENOStr_currentDrag")}})})),define("DS/ENONextGenFilterUX/utils/FilterUIService",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Promise","UWA/Date","DS/WAFData/WAFData","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/ENOFilterBIUX/NGFServices","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/PlatformAPI/PlatformAPI","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","text!DS/ENONextGenFilterUX/assets/ENOStrRefinementUX_require.json","DS/Utilities/TouchUtils","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/MePreferencesClientAPI/MePreferencesClientAPI"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h,p,_,m,f,g){"use strict";return t.singleton(i,{TOUCH_MODE:!0,MAX_DEEP_ATTRIBUTE_GROUP:4,MAX_FILTER_SPECIFICATION:4,MAX_CAR_FOR_CONFIG:100,MAX_DEEP_VOLUME_GROUP:2,ATTRIBUTE_NOT_VALUATED:"NotValuated",MAX_MRU_VALUE:5,MAX_SELECTION_PATH:l.MAX_SELECTION_PATH,MAX_CHAR_DESCRIPTION:256,HIERARCHICAL_ATTR_SEP:"/",NOT_ALLOWED:{},FILTER_RELATED_TO_ROOT:"toRoot",FILTER_RELATED_TO_ALL_REVISIONS:"toAllRevisions",FILTER_RELATED_TO_ANY_ROOT:"toAnyRoot",FILTER_ANY_OBJECT:"anyObject",init:function(){let e=["<",">","/","@","|","%"];this.NOT_ALLOWED={forTitle:e.concat(['"',"#","$","*",",","?","\\","[","]",":","'",";"]),forDescription:[...e],forAttributeValue:[...e].concat(['"',"[","]"])},this.NOT_ALLOWED.forDescription.splice(2,1),this.NOT_ALLOWED.forAttributeValue.splice(2,4),this._vocabURL=null,this._nlsNames=[],this._notificationsManager=r,a.setNotificationManager(this._notificationsManager),a.setStackingPolicy(5),this._easyAttributeDisplay=l.isActivated("easyAttribute"),this._myPreferences={},this._leftPanelMaximized=0},updateTouchMode:function(e){this.TOUCH_MODE=e,m.setTouchMode(e),localStorage.setItem("NGF_DisplayDensity",e)},isEasyAttributeDisplayMode:function(){return this._easyAttributeDisplay},setEasyAttributeDisplayMode:function(e){this._easyAttributeDisplay=e?1:0},getPlatformServices:function(e){var t=this;return h.getOption("fromWebInWin")?new n((function(e){e()})):new n((function(i,n){h.getPlatformServices(e).then((function(){t.setOption("str_platformServices",h.getOption("str_platformServices")),i()}),(function(e){console.debug(" => FilterUIService / Get Platform Services failed!"),console.debug(" Error = "+e),n()}))}))},getPlatformServiceUrl:function(e,t){var i=this._getPlatformUrlAccordingToTenant(e);return i?i[t||"3DSpace"]:i},_getPlatformUrlAccordingToTenant:function(e){for(var t,i=e||l.getTenant(),n=this.getOption("str_platformServices"),o=0;o<n.length;o++)if(i===n[o].platformId){t=n[o];break}return t},_getURL:function(e,t){if(Array.isArray(this.getOption("str_platformServices")))return this.getPlatformServiceUrl(void 0,e)+t;throw new Error("Platform services not initialize yet")},getExpandUrl:function(e){return this._getURL(e,"/cvservlet/expand")},getFetchUrl:function(e){return this._getURL(e,this.getFetchWebSrv())},getFetchWebSrv:function(){let e=h.getURLParams();return e=e.length?"?"+e:e,"/cvservlet/fetch/v2"+e},getMultiExpandUrl:function(e){return this._getURL(e,"/cvservlet/multiexpand")},getGoodVersionsIdsdUrl:function(e){return this._getURL(e,this.getGoodVersionsIdsWebSrv())},getGoodVersionsIdsWebSrv:function(){return"/resources/FilterInternal/ExplicitMgt/getGoodVersionsIds"},getCRSFTokenUrl:function(e){return this._getURL(e,"/resources/v1/application/E6WFoundation/CSRF")},getConfigFilterValidationUrl:function(e){return this._getURL(e,"/resources/modeler/configuration/expressionServices/filterValidation")},getPnOUrl:function(e){return this._getURL(e,"/resources/modeler/pno/person/")},getMaturityNextStatesUrl:function(e){return this._getURL(e,"/resources/v1/modeler/dslc/maturity/getNextStates")},getMaturityChangeStateUrl:function(e){return this._getURL(e,"/resources/v1/modeler/dslc/maturity/changeState")},getMaturityStatesAttributesUrl:function(e){return this._getURL(e,"/resources/lifecycle/maturity/getStatesAttributes")},getVersioningUrl:function(e){return this._getURL(e,"/resources/v1/modeler/dslc/version/create")},getOwnershipUrl:function(e){return this._getURL(e,"/resources/v1/modeler/dslc/ownership/transfer")},getVocabularyClassesUrl:function(e){return this._getURL(e,"/resources/6WVocab/access/VocabularyClasses?name=ds6wg")},displayNotification:function(e){e.sticky=e.sticky||!1,this._notificationsManager.addNotif(e)},getPlatformId:function(){return this._getPlatformUrlAccordingToTenant().platformId},isFilterCmdHeaderActivated:function(){return l.isDebugActive("extendedCmds")},isDelayedSynthesisActive:function(){return p.getOption("delayedSynthesis")||0},checkAndGetListOfAttributesFromSelectedFilter:function(e){var t=[],i=[],o=l.getFilterUIComponents(e),s=o.length;let r={};for(var a=1;a<s;a++){o[a].toFeedUI.forEach((e=>{if("attribute"===e.criteriaType){let t=e.type;if(this.FILTER_ANY_OBJECT!==t){r[t]||(r[t]=[]);let i=e.extension;"null"!==i&&void 0!==i||(e.extension="",e.nlsExtension=""),i&&r[t].push(i)}}else if("Sequence"===e.criteriaType){if("attribute"===e.sequenceType)e.allAttributes.forEach((e=>{let t=e.type;if(this.FILTER_ANY_OBJECT!==t){r[e.type]||(r[e.type]=[]);let t=e.extension;"null"!==t&&void 0!==t||(e.extension="",e.nlsExtension=""),t&&r[type].push(t)}}))}}))}var d=function(e,t){return new n((function(i,n){var o=l.getTenant(),s=h.getLanguage().toLowerCase();u.getExtensionsForClass(e,{tenantId:o,lang:s,apiVersion:"R2019x",onComplete:function(r){if(r&&r.extensions&&r.extensions.length){if(r.extensions.find((function(e){var i=e.curi;return i=i.substring(i.indexOf(":")+1),t===i}))){var a="ds6wg:"+t;u.getPropertiesForClass(a,{tenantId:o,lang:s,apiVersion:"R2019x",onComplete:function(e){var n=e.length?e[0].properties:[];i({type:t,attributes:n})},onFailure:function(e){n({type:t,error:e})}})}}else n({type:t,error:"Extension not found for "+e})},onFailure:function(e){n({type:t,error:e})}})}))},c=function(e){var t=this;return new n((function(i,n){var o="ds6wg:"+e;u.getPropertiesForClass(o,{tenantId:l.getTenant(),lang:h.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(o){var s=[];o?(o.forEach((e=>{s=s.concat(e.properties)})),i({type:e,attributes:s})):t.FILTER_ANY_OBJECT===e?i({type:e,attributes:[]}):n({type:e,error:"Type Not Found"})},onFailure:function(t){n({type:e,error:t})}})}))};for(const e in r)i.push(c(e)),r[e].forEach((t=>{i.push(d(e,t))}));return n.allSettled(i).then((function(e){return e.forEach((e=>{"fulfilled"===e.state||"fullfilled"===e.state?t[e.value.type]=e.value.attributes:(console.log("Retrieve attributes for "+e.reason.type+"failed, reason = "+e.reason.error),t[e.reason.type]=[])})),t}))},isSafeTitle:function(e){return this._isSafe(this.NOT_ALLOWED.forTitle,e)},isSafeDescription:function(e){return this._isSafe(this.NOT_ALLOWED.forDescription,e)},_isSafe:function(e,t){var i=!0;if("string"==typeof t){let n="[\\"+e.join("\\")+"]";i=!t.match(n)}return i},getAttributeButtonStyle:function(e){return{touchMode:this.TOUCH_MODE,displayStyle:"normal",showLabelFlag:!1,icon:this.getIconByName(e)}},getAttributeValidateButtonStyle:function(){var e=this.getAttributeButtonStyle("check");return e.displayStyle="normal",e},getExpandSynthesisInfos:function(e,t){var i=1===p.getOption("ProgressiveSynthesisOn")?1:0;return l.isProgressiveExpandActive()&&i?this._getProgressiveExpandSynthesis(e,t):this._getMultiExpandSynthesis(e,t)},refreshExpandSynthesisInfos:function(e,t){var i=this,o=1===p.getOption("ProgressiveSynthesisOn")?1:0;return l.isProgressiveExpandActive()&&o?new n((function(n,o){i._getProgressiveExpandSynthesis(e,{},t.CVQueryV2).then((function(e){e&&0===e.length&&i.displayNotification({level:"info",message:d.get("ExpandSynthesisWithEmptyResult")}),n(e)}),(function(e){o(e)}))})):new n((function(n,o){i._getMultiExpandSynthesis(e,{},t.CVQuery).then((function(e){e&&0===e.length&&i.displayNotification({level:"info",message:d.get("ExpandSynthesisWithEmptyResult")}),n(e)}),(function(e){o(e)}))}))},_getMultiExpandSynthesis:function(t,i,o){var r=this.getMultiExpandUrl(t.pfServiceId);return new n((function(n,a){var d=i||{no_type_filter_bo:["PLMPort","PLMConnection"]},u="NGF_SynthesisV1-"+c.getUser().externalId+"-ENOREFS_AP-"+Date.now(),_={};if(_.label=u,_.synthesis_mode="flat",_.max_count_path="1",o)e.merge(_,o);else{var m={expand_iter:"-1"};m.root_physicalid=t.rootID,e.merge(m,d),_.union={},_.union.expand=[],_.union.expand.push(m)}var f=Date.now(),g="Expand_synthesis_duration",v=function(e,i){var n=Array.isArray(e)?e:[e],o=Array.isArray(i)?i:[i],s={};n.forEach((function(e,t){s[e]=o[t]})),l.setPerformanceTracker(t.widgetId,"NGF-Progressive_Expand_Synthesis","NGFilter_UX",s,1)},b=p.getOption("timeoutExpandSynthesis")||12e4;s.authenticatedRequest(r,{label:u,headers:h.getRESTHeaders(t.securityContext),method:"POST",data:JSON.stringify(_),type:"json",proxy:"passport",timeout:b,onComplete:function(e){var t=e.facets||[];if(0===t.length)if(e.error){var i=e.error.errors;console.log(" ==> Expand synthesis failed : "+u),i.forEach((function(e){console.log("     . "+e)})),v(g,-1),a()}else v(g,Date.now()-f),n([]);else h.getNlsInfosForFacets(t).then((function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i];if(o.sixw){var s=o.sixw.split("/"),r=s.length-1;t[s[r]]||(t[s[r]]=[]),t[s[r]].push({value:o.object,nlsvalue:o.dispValue})}}var a=[];for(var l in t)t.hasOwnProperty(l)&&a.push({property:l,values:t[l].sort((function(e,t){return e&&t?e.nlsvalue<=t.nlsvalue?-1:1:0}))});v(g,Date.now()-f),n(a)}))},onFailure:function(e){console.log(" ==> Expand synthesis failed : "+u),console.log("     . "+e),v(g,-1),a()}})}))},_getProgressiveExpandSynthesis:function(e,t,i){var r=l.getProgressiveExpandUrl(l.getTenant(),e.pfServiceId),a={},d="NGF_ProgressiveExpand_Synthesis",u=e.rootID,_=p.getOption("ProgressiveExpandLimitMaxPath");if(_&&-1!==_&&(a.parameters={},a.parameters.limit_max_path=_),a.label="NGF_Synthesis-"+c.getUser().externalId+"-ENOREFS_AP-"+Date.now(),a.root={physical_id:u},a.filter={},a.filter.and_not={},i?a.filter.and_not.left=i.filter:t&&t.filter?a.filter.and_not.left=t.filter:a.filter.and_not.left={all:1},t)a.filter=a.filter.and_not.left;else{a.filter.and_not.right=JSON.parse('{"sequence_filter":{"sequence":[{"uql": "((flattenedtaxonomies:\\"types/PLMPort\\") OR (flattenedtaxonomies:\\"types/PLMConnection\\"))"}]}}')}var m=[],f=p.getOption("ProgressiveSynthesisDepth")||-1;-1!==f&&m.push({truncate:{max_distance_from_prefix:f,prefix_filter:{prefix_path:[{physical_id_path:Array.isArray(u)?u:[u]}]}}}),i&&i.aggregation_processors&&i.aggregation_processors.forEach((e=>{m.push(e)}));var g={synthesis:{name:d,mode:"flat",group_by_facet:1,synthesis_only:1}};1===l.isRootExcludedFromSynthesis()&&(g.synthesis.exclude_root_from_count=!0),m.push(g),a.aggregation_processors=m;var v=l.buildV2GraphProperty(t);v&&(a.graph=v);var b=h.getProgressiveQueryTemplate();b.batch.expands=[a],h.isShattered()&&b.batch.expands.forEach((e=>{e.shatteredExpand=!0})),b.outputs={synthesis:[d]};var C=1===l.arePredicatesExcludedFromSynthesis()?"exclude_predicates":"facet_name";return b.outputs[C]=l.getPredicatesFacetValue(),new n((function(t,i){var n=Date.now(),a=["Expand_synthesis_duration","Expand_synthesis_count","Expand_synthesis_rootTitle","Expand_synthesis_rootId"],d=function(t,i){var n=Array.isArray(t)?t:[t],o=Array.isArray(i)?i:[i],s={};n.forEach((function(e,t){s[e]=o[t]})),l.setPerformanceTracker(e.widgetId,"NGF-Progressive_Expand_Synthesis","NGFilter_UX",s,1)},c="ProgressiveExpandSynthesis_"+o.strftime(new o,"%Y-%m-%d-%H:%M:%S"),u=p.getOption("timeoutExpandSynthesis")||12e4;s.authenticatedRequest(r,{label:c,headers:h.getRESTHeaders(e.securityContext),method:"POST",data:JSON.stringify(b),type:"json",proxy:"passport",timeout:u,onComplete:function(o){if(o.errors)console.log(" ==> Expand synthesis failed : "+c),o.errors.forEach((function(e){console.log("     . "+e.code+": "+e.reason)})),d(a,[-1,0,0,e.rootTitle,e.rootID]),i();else{var s=o.results.find((function(e){return!!e.synthesis})),r=s?s.synthesis.facets:[],l=s?s.synthesis.value:0;0===(r=r||[]).length?(d(a,[Date.now()-n,0,e.rootTitle,e.rootID]),t([])):h.getNlsInfosForFacets(r).then((function(i){for(var o=function(e){var t={};e.forEach((e=>{var i=e.nlsvalue;t[i]?t[i].values.push(e.value):(t[i]={},t[i].values=[e.value])}));var i=[];return Object.keys(t).forEach((function(e){i.push({nlsvalue:e,value:1===t[e].values.length?t[e].values[0]:t[e].values,isAggregate:1===t[e].values.length?0:1})})),i},s={},r=0;r<i.length;r++){var c=i[r];if(c.sixw){var u=c.sixw.split("/"),h=u.length-1;s[u[h]]||(s[u[h]]=[]),s[u[h]].push({value:c.object,nlsvalue:c.dispValue})}}var p=[];for(var _ in s)s.hasOwnProperty(_)&&p.push({property:_,values:o(s[_]).sort((function(e,t){return e&&t?e.nlsvalue<=t.nlsvalue?-1:1:0}))});d(a,[Date.now()-n,l,e.rootTitle,e.rootID]),t(p)}))}},onFailure:function(t){console.log(" ==> Expand synthesis / Failure : "+c),console.log("   . "+t),d(a,[-1,0,0,e.rootTitle,e.rootID]),i()}})}))},getTypesOfSynthesis:function(e){var t=[];if(e)for(var i=0;i<e.length;i++)if("ds6w:type"===e[i].property)for(var n=0;n<e[i].values.length;n++)t.push({name:e[i].values[n].value,nlsName:e[i].values[n].nlsvalue,uri:e[i].property});return t},upgradeAndCompleteQuery:function(e){return l.upgradeAndCompleteQuery(e)},resetSelectedVolumeOf3D:function(e,t,i){if(e&&t){var n={NGFUXId:e,appId:e,widgetId:t,filteredRoot:i};c.publish("NGFilter_Volume",n)}},isModelActivated:function(e){return!(!e||"1"!==e.get("isActivated"))},isCustomizedAttribute:function(e){var t=e.automatic||e.Automatic;return!(!t||"Yes"!==t)},getRootFilterContainer:function(t){var i=document.getElementById("NGF_"+t)||document.getElementsByClassName("f-globalFilter-container")[0];return i&&!i.getElement&&e.extendElement(i),i},getGlobalEditContainer:function(e){var t,i=this.getRootFilterContainer(e);return i&&(t=i.getElement("#globalEditContainer_"+e)||i.getElement(".globalEdit-container")),t},showFilterContainer:function(t,i){var n=this.getRootFilterContainer(t);if(n){var o=n.getElement(".globalEdit-container"),s=n.getElement(".filter-Commands"),r=n.getElement(".globalFilterView-container"),a=n.getElement(".ActiveCriteriaView-container"),l=n.getElement(".global-header-idcard");o&&s&&r&&(i?(e.extendElement(o).hide(),e.extendElement(s).show(),e.extendElement(r).show(),a&&e.extendElement(a).show(),l&&e.extendElement(l).show()):(e.extendElement(o).show(),e.extendElement(s).hide(),e.extendElement(r).hide(),a&&e.extendElement(a).hide(),l&&e.extendElement(l).hide()))}},executeFetchLogicalID:function(e,t){return this.executeFetch(e,["icon","thumbnail_2d","thumbnail_3d"],["logicalid","type","coretype","ds6w:label","flattenedtaxonomies","ds6wg:revision"],t)},executeFetch:function(e,t,i,o){var r=this;return new n((function(n,o){var a={headers:h.getRESTHeaders(),method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_ExecuteFetch",physicalid:e,select_file:t||[],select_predicate:i||["logicalid","type","coretype","ds6w:label","flattenedtaxonomies"]}),onComplete:function(e){n(e)},onFailure:function(e){o(e)},shatteredFetch:h.isShattered()};s.authenticatedRequest(r.getFetchUrl(),a)}))},isTimeInDateActivated:function(){if(void 0===this._displayTimeInDateAttribute){var e=p.getOption("TimeInDateAttribute");this._displayTimeInDateAttribute=!(e||!l.isActivated("timeInDate"))||e}return this._displayTimeInDateAttribute},isSearchEditorActive:function(){return 0<(p.getOption("SearchEditorOn")||0)},isSearchEditorForAllActive:function(){var e=1<=p.getOption("SearchEditorForAll")?1:0;return this.isSearchEditorActive()&&e?1:0},isAsynchronousValidation:function(){if(void 0===this._isAsynchronousValidation){var e=p.getOption("AsynchronousValidation");this._isAsynchronousValidation=1===e?1:0}return this._isAsynchronousValidation},setReferenceTime:function(e){this._referenceTime=e||0},getReferenceTime:function(){return this._referenceTime||0},_setInternalReferenceTime:function(e){this._currentReferenceTime=e||0},_getInternalReferenceTime:function(){return void 0===this._currentReferenceTime?Date.now():this._currentReferenceTime},displayInternalTimeTrace:function(e,t){if(l.isDebugActive("elapsedTime")){var i=Date.now();console.log("=====> "+t+" / elapsed time (ms) = "+(i-this.getReferenceTime())+" ... "+(i-this._getInternalReferenceTime())),e&&this._setInternalReferenceTime(i)}},displayInternalDurationTrace:function(e,t){l.isDebugActive("elapsedTime")&&console.log("=====> "+e+" / elapsed time (ms) = "+t)},computeAttributesFromSynthesis:function(e){return new n((function(t,i){var n=[],o=[];e&&e.forEach((function(e){o.push(e.property)}));var s=p.getOption("PredicatesForEasyAttribute",["dsw:label"]);1===l.arePredicatesExcludedFromSynthesis()&&(s=s.concat(p.getOption("PredicatesForEasyAttributeOptions",[]))),o=o.concat(s),o=[...new Set(o)],u.getResourcesInfo(o.toString(),{tenantId:l.getTenant(),lang:h.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(i){n=[],i.forEach((function(e){n.push(e)})),e&&e.length?e.forEach((function(e){var t=n.findIndex((function(t){var i=t.curi||t.uri;return e.property===i})),i=-1!==t?n[t]:void 0;if(i){let t=[];e.values.forEach((e=>{t.push(e.value)})),i.rangeValues={editable:!0,literalInfo:t}}})):n.forEach((function(e){e.rangeValues&&(e.rangeValues=void 0)})),t(n)},onFailure:function(e){i(e)}})}))},checkCompatibiltyFilterRules:function(t,i,o,s,r){var a=this;return new n((function(n,d){var c=e.clone(o),u=c.rootPhysicalId;i===u?n({filterSpec:c,result:{error:0}}):a.executeFetch([i],void 0,void 0,r).then((function(e){a.executeFetch([u],void 0,void 0,r).then((function(o){var h={};h.results=(e.results||[]).concat(o.results||[]);var p="",m="";h.results.forEach((e=>{var t=e.attributes,n=t.find((function(e){return"resourceid"===e.name&&i===e.value}));n&&(n=t.find((function(e){return"type"===e.name})),p=n.value),(n=t.find((function(e){return"resourceid"===e.name&&u===e.value})))&&(n=t.find((function(e){return"type"===e.name})),m=n.value)}));var f=[];l.getFilterUIComponents(c).forEach(((e,t)=>{0<t&&e.toFeedUI.forEach((e=>{"config"===e.criteriaType&&f.push(e)}))}));var g=p===m,v=f.length;if(v){var b=JSON.parse(_).conf;require([b],(function(e){var o={rootid:i,tenant:l.getTenant(),url3DSpace:a.getPlatformServiceUrl(void 0,r),securitycontext:t};e.areConfigurationFiltersCompatible(o,f,(function(e){var t=Array.isArray(e)?1:0,o=t?1:0,r=t?e:[],l=Array(v).fill(o);r.forEach((e=>{l[e]=0}));var u={defined:f,compatibility:l};a._updateFilterWithCompatibilityRules(i,c,g,u,s).then((function(e){n({filterSpec:c,result:e})}),(function(){d()}))}))}))}else{a._updateFilterWithCompatibilityRules(i,c,g,{},s).then((function(e){n({filterSpec:c,result:e})}),(function(){d()}))}}))}))}))},_updateFilterWithCompatibilityRules:function(t,i,o,s,r){var a=this;return new n((function(n,c){for(var u=l.getFilterUIComponents(i),h=[],p=0,_=u.length-1;_>=1;_--){for(var m=u[_].toFeedUI,f=_-1,g=s.compatibility?s.compatibility[f]:0,v=m.length-1;v>=0;v--){var b=m[v],C=b.criteriaType;if(p++,"attribute"===C&&o);else if("Sequence"===C&&o)b.sequenceType;else if("config"===C&&g);else if("volume"===C&&o){if(a._removeVolumeProximity(b)){0===b.allVolumes.length&&m.splice(v,1);var y=d.get(C)+"("+d.get("proximity")+")";h.push(y)}var F=function(e,t){(t.allVolumes||[]).forEach((t=>{if(t.allVolumes)F(e,t);else{let i=t.parameters,n=i.root_path_physicalid||[],o=[];n.forEach((t=>{o.push([e])})),i.root_path_physicalid=o}}))};F(t,b)}else if("tag"===C);else{m.splice(v,1);y=d.get(C);h.push(y)}}0===m.length&&u.splice(_,1)}var I=p===h.length,A={};if(A.error=h.length?I?2:1:0,0<A.error&&(A.notApplied=h),r&&A.error){var S=I?d.get("FilterCanNotBeAppplied")+"<br>":"";S+="<span>"+d.get("ListOfCriteriaIgnored")+"</span>",h.forEach((t=>{S+="<br><span>"+e.String.format(d.get("CriterionNotSupported"),d.get(t))+"</span>"})),a.displayNotification({level:I?"error":"warning",message:S}),n(A)}else n(A)}))},_removeVolumeProximity:function(e){for(var t=!1,i=e.allVolumes||[],n=i.length-1;n>=0;n--){var o=i[n];o.allVolumes?(t=this._removeVolumeProximity(o),0===o.allVolumes.length&&i.splice(n,1)):"proximity"===o.parameters.type&&(t=!0,i.splice(n,1))}return t},getRootTitle:function(e,t){var i=e;if(!e.endsWith(t)){var n=l.getDisplaySeparator();i+=t?n+t:""}return i},getIconByName:function(e){return{iconName:e,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}},displayAttrNotFoundNotif:function(e){var t=this;if(e.length){var i=function(e){var i="<span>"+d.get("ListOfAttributeIgnored")+"</span>";e.forEach((e=>{i+="<br><span> - "+(e.label?e.label:e)+"</span>"})),t.displayNotification({level:"warning",message:i})};u.getResourcesInfo(e.toString(),{tenantId:l.getTenant(),lang:h.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(e){i(e)},onFailure:function(t){console.log(t),i(e)}})}},getAliasesFromFetched:function(e,t){var i=[];return e.forEach((e=>{t.results.forEach((t=>{var n=t.attributes,o=n.find((t=>"resourceid"===t.name&&e===t.value));if(o){var s=n.find((e=>"ds6wg:revision"===e.name));(o=n.find((e=>"ds6w:label"===e.name)))&&i.push((o.dispValue||o.value)+(s?" - "+s.value:""))}}))})),i},openFilterPanel:function(e){c.publish("Frame3DXInfra.Open",{identifier:e})},getLengthUnitPreference:function(){return new n((function(e){let t={unit:"Millimeter",symbol:"mm",decimal:3};g.readPreferences([{Repository:"cke",PreferenceNames:["Length","LengthCalcDisplay"]}]).then((i=>{let n;if(i.repositories&&i.repositories.length){let e=i.repositories[0].preferences;if(e){let i,o,s;e.forEach((e=>{if("Length"==e.name){let t=f[e.name];if(t){let n=e.value?t[e.value]:void 0;n&&(i=n.name,o=n.symbol)}!i&&!o&&console.log(" ==> Invalid Length Unit preference / Unit = "+e.name+", Value = "+e.value)}else"LengthCalcDisplay"==e.name&&(s=e.value)})),n={unit:i||t.unit,symbol:o||t.symbol,decimal:s||t.decimal}}}!n&&console.log(" ==> Length Unit preference / Preference not found then set default value"),e(n||t)}),(function(i){console.log(" ==> Retrieve Length Unit preference failed (set default value), err = "+i),e(t)}))}))},setLengthUnit:function(e){this._myPreferences.lengthUnit=e},getLengthUnit:function(){return this._myPreferences.lengthUnit},isMigrateToAutoComplete:function(){return void 0===this._migrateToAutoComplete&&(this._migrateToAutoComplete=!!l.isActivated("UIToAutoComplete")),this._migrateToAutoComplete},getMenuPosition:function(e){return{x:e.left,y:e.bottom}},isLabelCriterionDisplayed:function(){return 0},setLeftPanelMaximized:function(e){this._leftPanelMaximized=e},isLeftPanelMaximized:function(){return this._leftPanelMaximized},_getPathDisplayPreference:function(){let e=l.isActivated("PathDisplayMode");return new n((function(t){g.readPreferences([{Repository:"AdvFilterUXRepository",PreferenceNames:["FilterSelectionMode"]}]).then((i=>{let n;if(i.repositories&&i.repositories.length){let e=i.repositories[0].preferences||[];e&&e.forEach((e=>{"FilterSelectionMode"==e.name&&(n="LastInstAndRefOfPath"===e.value?1:0)}))}void 0===n&&console.log(" Path Display preference / Preference not found, set default value"),t({pathDisplayMode:void 0!==n?n:e})}),(function(i){console.log(" Retrieve Path Display preference failed (set default value), err = "+i),t({pathDisplayMode:e})}))}))},getPathDisplayMode:function(){return this._myPreferences.pathDisplayMode},initPreferences:function(){var e=this;if(this._myPreferences.lengthUnit||0!==Object.keys(this._myPreferences).length)return new n((function(e){e()}));{let t=[];return t.push(e.getLengthUnitPreference()),t.push(e._getPathDisplayPreference()),n.allSettled(t).then((t=>{t.forEach((t=>{t.value.unit&&(e._myPreferences.lengthUnit=t.value),void 0!==t.value.pathDisplayMode&&(e._myPreferences.pathDisplayMode=t.value.pathDisplayMode)}))}))}},getInterfacesUrl:function(e){},getPredicatesUrl:function(e){},cancelValidationAsynchronous:function(){this._isAsynchronousValidation=0}})})),define("DS/ENONextGenFilterUX/views/PLMNewAdvancedFilterCmd",["UWA/Core","DS/ENOFilterBIUX/NGFServices","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/UIKIT/Mask","DS/ENONextGenFilterUX/utils/FilterUIService","UWA/Core"],(function(e,t,i,n,o,s){"use strict";var r=require("DS/ENONewWidget/command/NewContentCommandBase");return r.extend({defaults:{type:"ENOStrRefinementSpecification"},_newType:"ENOStrRefinementSpecification",_commandName:"PLMNewFilter",init:function(e){this._options=e,e.ID=this._commandName,e.className="DS/ENONextGenFilterUX/views/PLMNewAdvancedFilterCmd",this.addEventsForCommand(),this._parent(e)},getType:function(){return"ENOStrRefinementSpecification"},getCommandLabel(){return"PLMNewFilter"===this.options.ID},execute:function(){this.launchCreationDialog()},launchCreationDialog:function(){let e=this.getCreateOptions({});e.showCreateAnother=!1,e.leadingappspecific={ENOStrSpecDesc:this._options.ENOStrSpecDesc,physicalId:this._options.physicalId,serviceId:this._options.service},this.launchCreateNew(e)},getOptions:function(e){let t=this;return{options:{typeName:"ENOStrRefinementSpecification",preferedType:t.options.preferedType,attributes:{Title:t._options.title}},context:{service:t.options.service,serviceBaseUrl:t.options.serviceBaseUrl,tenant:t.options.tenant,header:t.getHeaders(t.options.securityContext),getENONewContext:function(){return{}}},events:t.options.callbacks,viewType:"tabView",labelTopBar:t.options.saveAs?i.get("PLMNew_SaveAs"):i.get("PLMNew_Save"),facets:[{name:"filterFacet",facetoptions:{}},{name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}}],notification:!1}},getHeaders:function(e){return{SecurityContext:e}},addEventsForCommand(){var e=this;require(["DS/ENONewWidget/ENONew/Events"],(function(t){t.addEvent("onCreationDialogAction",(function(t){if(t&&"ready"===t.action){let t=o.getRootFilterContainer(e._options.UXId),r=s.String.format(i.get("LoaderForPLMnew"));n.unmask(t,r)}}))}))}})})),define("DS/ENONextGenFilterUX/views/NGFDebugCommands",["UWA/Class","UWA/Class/View","UWA/Core","UWA/Date","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENOFilterBIUX/FBIServices","DS/Menu/Menu","DS/Controls/Button","DS/Controls/Toggle"],(function(e,t,i,n,o,s,r,a,l,d,c,u){"use strict";return t.extend({domEvents:{},setup:function(){this._widgetId=this.options.widgetId||this.options.widget,this._UXId=this.options.UXId,this.rootID=this.options.rootID,this.rootAlias=this.options.rootAlias||"?",this._NGFUXId=this.options.NGFUXId,this._debugContextualMenu=[{type:"PushItem",recId:"ExtraCommands-CopyFromAnyFilterOnRoots-item",title:"Copy from Any Filter on several Roots",icon:r.getIconByName("list-filter"),action:{this:this,callback:this._onDebugCopyFromAnyFilterOnRoots}},{type:"PushItem",recId:"ExtraCommands-SetConfigFilter-item",title:"Set Config Filter",icon:r.getIconByName("configuration"),action:{this:this,callback:this._onDebugSetConfigFilter}},{type:"PushItem",title:"Change",icon:r.getIconByName("exchange-cog"),submenu:[{type:"PushItem",recId:"ExtraCommands-UpdateTenant-item",title:"Tenant",icon:r.getIconByName("update"),action:{this:this,callback:this._onDebugUpdateTenant}},{type:"PushItem",recId:"ExtraCommands-SetDefaultSecurityContext-item",title:"Default Security-Context",icon:r.getIconByName("lock-open"),action:{this:this,callback:this._onDebugSetDefaultSecurityContext}},{type:"PushItem",recId:"ExtraCommands-SetShatteredSupplemental-item",title:"Shattered vs Supplemental",icon:r.getIconByName("graph-egraph-down"),action:{this:this,callback:this._onDebugSupplementalShatteredChange}}]},{type:"PushItem",title:"Link / Unlink",icon:r.getIconByName("link"),submenu:[{type:"PushItem",recId:"ExtraCommands-Link-item",title:"Link",icon:r.getIconByName("link-add"),action:{this:this,callback:this._onDebugLinkUnlink,context:{type:"Link"}}},{type:"PushItem",recId:"ExtraCommands-Unlink-item",title:"Unlink",icon:r.getIconByName("link-delete"),action:{this:this,callback:this._onDebugLinkUnlink,context:{type:"Unlink"}}}]},{type:"PushItem",title:"Public Specification",icon:r.getIconByName("filter"),submenu:[{type:"PushItem",recId:"ExtraCommands-CreateFilter-item",title:"Set Specification",icon:r.getIconByName("import"),action:{this:this,callback:this._onDebugSetPublicFilterSpec,context:{type:"PFS"}}},{type:"PushItem",recId:"ExtraCommands-CreateFilter-item",title:"Set Specification CAA",icon:r.getIconByName("import"),action:{this:this,callback:this._onDebugSetPublicFilterSpec,context:{type:"PFS-CAA"}}},{type:"PushItem",recId:"ExtraCommands-GetPublicSepec-item",title:"Get Volatile Specification",icon:r.getIconByName("export"),action:{this:this,callback:this._onDebugGetPublicFilterSpecFromVolatile}},{type:"PushItem",recId:"ExtraCommands-GetPublicSepec-item",title:"Get Saved Specification",icon:r.getIconByName("export"),action:{this:this,callback:this._onDebugGetPublicFilterSpecFromFilterId}}]}],this.globalViewFilter=this.options.globalViewFilter;let e=this.options.elmCmds;if(e){var t=this;e.addEventListener("click",(function(e){e.stopPropagation();var i=e.target.getBoundingClientRect();d.show(t._debugContextualMenu,{position:r.getMenuPosition(i)})}))}},_onDebugSetConfigFilter:function(){var e=this;this._welcomeView&&this._welcomeView.hide(),r.showFilterContainer(this._UXId,!1);var t=r.getGlobalEditContainer(this._UXId),n=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Apply Filter",checkFlag:!1}),o=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Display Filter Panel",checkFlag:!0}),a=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Force Update",checkFlag:!1}),l=new c({touchMode:r.TOUCH_MODE,label:"OK"}),d=new c({touchMode:r.TOUCH_MODE,label:"Cancel"}),h=i.createElement("div",{id:"xDiv"});h.inject(t),h.style.marginTop="38px",h.style.border="thin dashed #368ec4",h.style.borderRadius="5px",h.style.padding="10px",n.inject(h),o.inject(h),a.inject(h);var p=i.createElement("div",{id:"xDivCmd"});p.inject(h),p.style.marginTop="38px",p.style.display="inline-block",l.inject(p),d.inject(p),l.addEventListener("buttonclick",(function(i){var l={specification:{type:"NGFilter_ConfigDefined",data:{prodConf:e.rootID}},rootID:e.rootID,rootAlias:e.rootAlias,applyFilter:n.checkFlag?1:0,displayFilter:o.checkFlag?1:0,forceUpdate:a.checkFlag?1:0,NGFUXId:e._NGFUXId,widgetId:e._widgetId};s.publish("NGFilter_Debug",{type:"NGFilter_Dbg_SetConfigSpecfication",data:l}),t.removeChild(h),r.showFilterContainer(e._UXId,!0)})),d.addEventListener("buttonclick",(function(i){t.removeChild(h),r.showFilterContainer(e._UXId,!0)}))},_onDebugCopyFromAnyFilterOnRoots:function(){var e=this,t='flattenedtaxonomies:"types/ENOStrRefinementSpecification"';this.globalViewFilter.in_apps_search({precond:t,title:a.get("SearchFilters"),callback:function(i){var n=i;t='flattenedtaxonomies:"types/VPMReference"',setTimeout((function(){e.globalViewFilter.in_apps_search({multiSel:!0,precond:t,title:a.get("SearchFilters"),callback:function(t){var i={};i.eventName="NGFilter_CopyFromAnyFilterOnRoots_"+e._UXId,t=Array.isArray(t)?t:[t],s.publish("NGFilter_Debug",{type:"NGFilter_Dbg_SetCopyFromAnyFilterOnRoots",data:{appId:e._NGFUXId,widgetId:e._widgetId,filterID:n.id,rootIDs:t,options:i,NGFUXId:e._NGFUXId}})},cancel:function(){}})}),1500)},cancel:function(){}})},_onDebugUpdateTenant:function(){s.publish("NGFilter_Debug",{type:"NGFilter_Dbg_UpdateTenant",data:{NGFUXId:this._NGFUXId,widgetId:this._widgetId,tenant:"xxx"}})},_onDebugSetDefaultSecurityContext:function(){s.publish("NGFilter_Debug",{type:"NGFilter_Dbg_SetDefaultSecurityContext",data:{NGFUXId:this._NGFUXId,widgetId:this._widgetId,sc:"VPLMProjectLeader.MyCompany.3DS Private Collab Space"}})},_onDebugLinkUnlink:function(e){var t=this,n="Link"===e.context.type?"NGFilter_Link":"NGFilter_Unlink";this._welcomeView&&this._welcomeView.hide(),r.showFilterContainer(this._UXId,!1);var o=r.getGlobalEditContainer(this._UXId),a=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Apply Filter",checkFlag:!1}),l=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Display Filter Panel",checkFlag:!0}),d=new c({touchMode:r.TOUCH_MODE,label:"OK"}),h=new c({touchMode:r.TOUCH_MODE,label:"Cancel"}),p=i.createElement("div",{id:"xDiv"});p.inject(o),p.style.marginTop="38px",p.style.border="thin dashed #368ec4",p.style.borderRadius="5px",p.style.padding="10px",a.inject(p),l.inject(p);var _=i.createElement("div",{id:"xDivCmd"});_.inject(p),_.style.marginTop="38px",_.style.display="inline-block",d.inject(_),h.inject(_),d.addEventListener("buttonclick",(function(e){"NGFilter_Link"===n?(t._savedVolumeUsed=t.options.volumeUsed,t._savedContextUsed=t.options.contextUsed,t._savedAttributeUsed=t.options.attributeUsed,t._savedQueryFormat=t.options.queryFormat):(t.options.volumeUsed=t._savedVolumeUsed,t.options.contextUsed=t._savedContextUsed,t.options.attributeUsed=t._savedAttributeUsed,t.options.queryFormat=t._savedQueryFormat,delete t._savedVolumeUsed,delete t._savedContextUsed,delete t._savedAttributeUsed,delete t._savedQueryFormat);var i={NGFUXId:t._NGFUXId,widgetId:t._widgetId,rootID:t.rootID,rootAlias:t.rootAlias,specification:{type:n,data:{NGFUXId:t._NGFUXId,widgetId:t._widgetId,rootID:t.options.rootID,rootAlias:t.options.rootAlias,volumeUsed:t.options.volumeUsed,contextUsed:t.options.contextUsed,attributeUsed:t.options.attributeUsed,queryFormat:t.options.queryFormat}},applyFilter:a.checkFlag?1:0,displayFilter:l.checkFlag?1:0,eventName:n};o.removeChild(p),r.showFilterContainer(t._UXId,!0),s.publish("NGFilter_Debug",{type:"NGFilter_Dbg_LinkUnlink",data:i})})),h.addEventListener("buttonclick",(function(e){o.removeChild(p),r.showFilterContainer(t._UXId,!0)}))},_onDebugSetPublicFilterSpec:function(e){var t=this;if(this.globalViewFilter._isThereCriteriaDefined()&&!this.globalViewFilter._tagsOnly)r.displayNotification({level:"error",message:a.get("FilteringInProgress")});else{this._welcomeView&&this._welcomeView.hide(),r.showFilterContainer(this._UXId,!1);var o=r.getGlobalEditContainer(this._UXId),l=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Apply Filter",checkFlag:!1}),d=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Display Filter Panel",checkFlag:!0}),c=i.createElement("input",{id:"fileInput",type:"file"}),h=i.createElement("div",{id:"xDiv"});h.inject(o),h.style.marginTop="38px",h.style.border="thin dashed #368ec4",h.style.borderRadius="5px",h.style.padding="10px",c.inject(h),l.inject(h),d.inject(h);const p=document.querySelector("#fileInput"),_=new FileReader;p.addEventListener("change",(i=>{var c=n.strftime(new n,"%H:%M:%S");const u=p.files[0];u?(_.addEventListener("error",(e=>{var i=" ==> Error occurred reading file: "+e.message,n=" ==> File : "+e.filename+"(l:"+e.lineno+", c:"+e.colno+")";console.error(i+"\n"+n),alert(i+"\n"+n),o.removeChild(h),r.showFilterContainer(t._UXId,!0)})),_.addEventListener("load",(()=>{console.log(" ==> File: "+u.name+" read successfully"),console.log(" ==> File Content = "+_.result);this.globalViewFilter.in_apps_search({precond:'flattenedtaxonomies:"types/VPMReference"',title:a.get("SearchReferences"),callback:function(i){var n,a;n=JSON.parse(_.result),a={NGFUXId:t._NGFUXId,widgetId:t._widgetId,specification:"PFS-CAA"!==e.context.type?n:{title:"publicFilter (CAA)",description:"Description Public Filter ("+c+")",referencedObject:{source:"3DSpace",type:"VPMReference",identifier:i.id,relativePath:"resource/v1/modeler/dseng/dseng:EngItem/"+i.id},filter:n},rootId:i.id,applyFilter:l.checkFlag?1:0,displayFilter:d.checkFlag?1:0,eventName:"NGF_SetPublicFilterSpecfication"},o.removeChild(h),r.showFilterContainer(t._UXId,!0),s.publish("NGFilter_Debug",{type:"NGFilter_Dbg_SetPublicFilterSpecfication",data:a})},cancel:function(){o.removeChild(h),r.showFilterContainer(t._UXId,!0)}})})),_.readAsText(u)):(o.removeChild(h),r.showFilterContainer(t._UXId,!0))}))}},_onDebugGetPublicFilterSpecFromVolatile:function(){for(let t=0;t<1;t++){var e={rootId:this.rootID,NGFUXId:this._NGFUXId,widgetId:this._widgetId,eventName:"NGFilter_GetPublicFilterSpecFromVolatile_"+t};s.publish("NGFilter_Debug",{type:"NGFilter_Dbg_GetPublicFilterSpecFromVolatile",data:e})}},_onDebugGetPublicFilterSpecFromFilterId:function(){this.globalViewFilter.in_apps_search({precond:'flattenedtaxonomies:"types/ENOStrRefinementSpecification"',title:a.get("SearchFilters"),callback:function(e){for(let i=0;i<1;i++){var t={NGFUXId:this._NGFUXId,widgetId:this._widgetId,filterId:e.id,eventName:"NGFilter_GetPublicFilterSpecFromFilterId_"+i};s.publish("NGFilter_Debug",{type:"NGFilter_Dbg_GetPublicFilterSpecFromFilterId",data:t})}},cancel:function(){}})},_onDebugSupplementalShatteredChange:function(){var e=this;this._welcomeView&&this._welcomeView.hide(),r.showFilterContainer(this._UXId,!1);let t=l.isShattered(),n=l.isSupplemental();var o=r.getGlobalEditContainer(this._UXId),a=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Shattered",checkFlag:t}),d=new u({touchMode:r.TOUCH_MODE,type:"switch",label:"Supplemental",checkFlag:n}),h=i.createElement("div",{id:"xDiv"});h.inject(o),h.style.marginTop="38px",h.style.border="thin dashed #368ec4",h.style.borderRadius="5px",h.style.padding="10px",a.inject(h),d.inject(h);var p=new c({touchMode:r.TOUCH_MODE,label:"OK"}),_=new c({touchMode:r.TOUCH_MODE,label:"Cancel"}),m=i.createElement("div",{id:"xDivCmd"});m.inject(h),m.style.marginTop="38px",m.style.display="inline-block",p.inject(m),_.inject(m),a.addEventListener("buttonclick",(function(e){d.checkFlag&&(d.checkFlag=!1)})),d.addEventListener("buttonclick",(function(e){a.checkFlag&&(a.checkFlag=!1)})),p.addEventListener("buttonclick",(function(i){let l,c;a.checkFlag?(l="NGFilter_Dbg_ShatteredChange",c=a.checkFlag):d.checkFlag?(l="NGFilter_Dbg_SupplementalChange",c=d.checkFlag):t?(l="NGFilter_Dbg_ShatteredChange",c=a.checkFlag):n&&(l="NGFilter_Dbg_SupplementalChange",c=d.checkFlag),s.publish("NGFilter_Debug",{type:l,data:{state:c,NGFUXId:e._NGFUXId,widgetId:e._widgetId}}),o.removeChild(h),r.showFilterContainer(e._UXId,!0)})),_.addEventListener("buttonclick",(function(t){o.removeChild(h),r.showFilterContainer(e._UXId,!0)}))}})})),define("DS/ENONextGenFilterUX/views/CriteriaAbstractView",["UWA/Core","UWA/Class/View","UWA/Promise","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Menu/Menu"],(function(e,t,i,n,o,s){"use strict";return t.extend({isCriterionValidate:function(){return 0===o.isAsynchronousValidation()||new i((function(e){e(!0)}))},viewFromMdl:function(e){},isThereCriteria:function(){return!1},setEditable:function(e){this._isEditable=e},_getCallbackToEditCriterion:function(){},isCriterionValid:function(){return!0},_getDOMElementToUpdateOnActivateChange:function(){return[]},updateModelFromRepair:function(e){return{modelUpdated:!1,attributes:void 0}},buildViewFromRepairModel:function(e){},updateOnLeftPanelWidthChange:function(e){},tagName:"li",setup:function(e){this._childGroupId=e.childGroupId,this._UXId=e.UXId,this._NGFUXId=e.NGFUXId,this._widgetId=e.widgetId,this._viewId="activeSubgroup_"+this._childGroupId,this.container.setAttribute("id",this._viewId),this._isEditable=e.isEditable,this._pfServiceId=e.pfServiceId||"3DSpace",this.listenTo(this.model,"onChange:isActivated",this._onActivateChange.bind(this))},isViewEdited:function(){return"edit"===this.model.get("state")},_getId:function(){return this._viewId},_checkBeforeEdit:function(){if(this._isEditable){if(this.model.get("isParentActivated")){var t=this._getCallbackToEditCriterion();t&&this.dispatchEvent("NGF_Criterion_ValidateEdited",{callback:t})}}else{this.getElement('[class*="-read"]').addClassName("filter-not-editable");var i=e.String.format(n.get("FilterIsNotEditableInContext"),n.get(this.model.get("criteriaType")));o.displayNotification({level:"info",message:i})}},_createCriterionCtxMenuWUX:function(e){if(!e||this._critContextualMenu)return;let t=this.getElements(".criterionDropDown");var i={type:"PushItem",recId:"delete-item-DDCtx",title:n.get("deleteCriteria"),icon:o.getIconByName("trash"),action:{this:this,callback:this.destroy}};this._abstractActivateItem={type:"PushItem",recId:"activate-item-DDCtx",title:n.get("activatedCriteria"),icon:o.getIconByName("eye"),action:{this:this,callback:this._switchCriterionState}},this._abstractDeactivateItem={type:"PushItem",recId:"activate-item-DDCtx",title:n.get("deactivatedCriteria"),icon:o.getIconByName("eye-off"),action:{this:this,callback:this._switchCriterionState}},this._abstractCtxMenuRead=[{type:"PushItem",recId:"edit-item-DDCtx",title:n.get("editCriteria"),icon:o.getIconByName("pencil"),action:{this:this,callback:this._checkBeforeEdit}},this._abstractDeactivateItem,i],this._abstractCtxMenuEdit=[{type:"PushItem",recId:"cancel-item-DDCtx",title:n.get("cancelEditCriteria"),icon:o.getIconByName("undo"),action:{this:this,callback:this._cancelEditCriteria}},i],this._critContextualMenu=this._abstractCtxMenuRead;var r=this;t[0].addEventListener("click",(function(e){if(r.model.get("isParentActivated")){e.stopPropagation();var t=e.target.getBoundingClientRect();s.show(r._critContextualMenu,{position:o.getMenuPosition(t)})}})),t[1].addEventListener("click",(function(e){if(r.model.get("isParentActivated")){e.stopPropagation();var t=e.target.getBoundingClientRect();s.show(r._critContextualMenu,{position:o.getMenuPosition(t)})}}))},_switchCriterionState:function(){var e=o.isModelActivated(this.model)?"0":"1";this.model.set("isActivated",e)},_onActivateChange:function(e,t){var i=o.isModelActivated(this.model);if(this._critContextualMenu){var n=this._critContextualMenu.findIndex((e=>"activate-item-DDCtx"===e.recId));-1!==n&&(this._critContextualMenu[n]=i?this._abstractDeactivateItem:this._abstractActivateItem)}for(var s=this._getDOMElementToUpdateOnActivateChange(),r=s.length,a=0;a<r;a++)s[a]&&(i?s[a].removeClassName("f-criterion-deactivated"):s[a].addClassName("f-criterion-deactivated"));this.dispatchEvent("NGF_Criterion_Activated",{})},_hideFilterContainer:function(){o.showFilterContainer(this._UXId,!1)},_showFilterContainer:function(){o.showFilterContainer(this._UXId,!0)},_setContextualMenu:function(e){this._critContextualMenu&&("read"===e?(this._critContextualMenu=this._abstractCtxMenuRead,this._critContextualMenu[1]=o.isModelActivated(this.model)?this._abstractDeactivateItem:this._abstractActivateItem):"edit"===e&&(this._critContextualMenu=this._abstractCtxMenuEdit))},_onEditAttribute:function(){this.model.get("isParentActivated")&&o.isModelActivated(this.model)&&this._checkBeforeEdit()}})})),define("DS/ENONextGenFilterUX/utils/FilterPersistencyServices",["UWA/Class","UWA/Core","UWA/Class/Options","UWA/Promise","UWA/Date","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/NGFServices","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENOFilterBIUX/FBIServices"],(function(e,t,i,n,o,s,r,a,l,d,c){"use strict";var u=e.singleton(i,{init:function(){},namesRetrievedFiltersOnRoot:[],getCreateFilterUrl:function(){var e;return Array.isArray(a.getOption("str_platformServices"))&&(e=a.getPlatformServiceUrl()+"/resources/FilterBIAPI/Filter/createFilter"),e},getUpdateFilterUrl:function(){var e;return Array.isArray(a.getOption("str_platformServices"))&&(e=a.getPlatformServiceUrl()+"/resources/FilterBIAPI/Filter/updateFilter"),e},getDefaultFilterNameUrl:function(e){var t;return Array.isArray(a.getOption("str_platformServices"))&&(t=a.getPlatformServiceUrl()+"/resources/FilterBIAPI/Filter/getDefaultName"),t},saveFilter:function(e,t,i,o,r,a,l,d){var u=this,h={filterName:t,filterDescription:i,rootPhysicalId:r,filterUIComponents:l,filterTitle:o,rootServiceId:d};return new n((function(t,i){s.authenticatedRequest(u.getCreateFilterUrl(),{headers:c.getRESTHeaders(e),method:"POST",data:JSON.stringify(h),type:"json",proxy:"passport",onComplete:function(e){t(e)},onFailure:function(e){t(e)}})}))},updateFilter:function(e,t,i,o,r,a,l){var d=this,u={filterName:t,filterDescription:i,filterUIComponents:a,filterTitle:o,filterId:l};return new n((function(t,i){s.authenticatedRequest(d.getUpdateFilterUrl(),{headers:c.getRESTHeaders(e),method:"POST",data:JSON.stringify(u),type:"json",proxy:"passport",onComplete:function(e){t(e)},onFailure:function(e){t(e)}})}))},getDefaultFilterName:function(e,t){var i=this;return new n((function(n,o){s.authenticatedRequest(i.getDefaultFilterNameUrl()+"?filterName="+encodeURIComponent(e),{headers:c.getRESTHeaders(t),method:"GET",type:"json",proxy:"passport",onComplete:function(e){n(e.defaultName)},onFailure:function(e){o(e)}})}))},keepToFeedConfig:function(e){var t={};return t.criteriaType=e.get("criteriaType"),t.displayExpression=e.get("displayExpression"),t.expression=e.get("expression"),e.has("config_filter_id")?t.config_filter_id=e.get("config_filter_id"):t.config_filter=e.get("config_filter"),a.isModelActivated(e)||(t.isActivated=e.get("isActivated")),t},keepToFeedAttr:function(e,t){var i={};i.criteriaType=e.get("criteriaType"),i.type=e.get("type"),!1===e.get("Keep")&&(i.Keep=e.get("Keep")),a.isModelActivated(e)||(i.isActivated=e.get("isActivated")),""!==e.get("extension")&&(i.extension=e.get("extension"));var n=e.get("allAttributes");if(n&&n.length){var o=this._keepToFeedAttr(n[0],t);i.allAttributes=[],i.allAttributes.push(o)}return i},_keepToFeedAttr:function(e,t){for(var i=e.get("allAttributes")||[],n=i.length,o=[],s=0;s<n;s++){var r,a=i[s];a.get("allAttributes")?r=this._keepToFeedAttr(a,t):a.get("attribute")?(r={type:a.get("attribute").type,uri:a.get("attribute").uri,attrOp:a.get("attrOp")},a.get("attrValue")?r.attrValue=a.get("attrValue"):a.get("attrValue_1")&&(r.attrValue_1=a.get("attrValue_1"),r.attrValue_2=a.get("attrValue_2"))):t&&t.keepEmpty&&(r={}),r&&o.push(r)}return{combination:e.get("combination"),allAttributes:o}},keepToFeedContext:function(e,t){var i={},n=e.get("addedNodesList")&&e.get("addedNodesList").length,o=e.get("excludedNodesList")&&e.get("excludedNodesList").length;return n||o?(i.criteriaType=e.get("criteriaType"),a.isModelActivated(e)||(i.isActivated=e.get("isActivated")),n&&(!1===e.get("AddNodeActivated")&&(i.AddNodeActivated=e.get("AddNodeActivated")),i.addedNodesList=e.get("addedNodesList")),o&&(!1===e.get("ExcludeNodeActivated")&&(i.ExcludeNodeActivated=e.get("ExcludeNodeActivated")),i.excludedNodesList=e.get("excludedNodesList"))):t&&t.keepEmpty&&(i.criteriaType=e.get("criteriaType"),i.AddNodeActivated=e.get("AddNodeActivated"),i.addedNodesList=e.get("addedNodesList"),i.ExcludeNodeActivated=e.get("ExcludeNodeActivated"),i.excludedNodesList=e.get("excludedNodesList")),i},keepToFeedTag:function(e){var t={},i=e.get("tagData")||void 0;if(i){var n=i.allfilters?Object.keys(i.allfilters):[],o=i.localfilters?Object.keys(i.localfilters):[],s=n.length,r=o.length;(s||r)&&(t.criteriaType=e.get("criteriaType"),s&&(t.allfilters={},t.allfilters=i.allfilters),r&&(t.localfilters={},t.localfilters=i.localfilters))}return t},keepToFeedVolume:function(e){var t={};t.criteriaType=e.get("criteriaType"),a.isModelActivated(e)||(t.isActivated=e.get("isActivated"));var i=e.get("allVolumes");if(i&&i.length){var n=this._keepToFeedVolume(i[0]);t.allVolumes=[],t.allVolumes.push(n)}return t},_keepToFeedVolume:function(e){for(var i=d.get("defaultVolumeName"),n=e.get("allVolumes")||[],o=n.length,s=[],r=0;r<o;r++){var l,c=n[r];if(c.get("allVolumes"))l=this._keepToFeedVolume(c);else{let e=(l={parameters:t.clone(c.get("parameters"))}).parameters;if(e){let t=e.type;"box"===t?(e.corner_min=e.corner_min.map(Number),e.corner_max=e.corner_max.map(Number),e.transformation_matrix&&(e.transformation_matrix=e.transformation_matrix.map(Number))):"sphere"===t?(e.center=e.center.map(Number),e.radius=parseFloat(e.radius)):"proximity"!==t&&"space"!==t||(e.distance=parseFloat(e.distance)),delete l.parameters.root_path_alias}a.isModelActivated(c)||(l.isActivated=c.get("isActivated"));var u=c.get("displayName");-1!==u.startsWith(i+" ")&&(l.displayName=u)}s.push(l)}return{combination:e.get("combination"),allVolumes:s}},keepToFeedSequence:function(e,t){var i={};return"attribute"===e.get("sequenceType")&&(i=this._keepToFeedAttrSeq(e,t)),i},_keepToFeedAttrSeq:function(e,t){var i=[],n=e.get("subGroupCollection")._models;n&&n.forEach((function(e){var n=u.keepToFeedAttr(e,t);i.push(n)}));var o={};return o.criteriaType=e.get("criteriaType"),o.sequenceType=e.get("sequenceType"),o.allAttributes=i,o},retrieveAllFilters:function(e){var t={relations:["advancedfilter_root_from"],attributes_for_detailview:["physicalid"],countmanagement:!1,debug:!1,ids:e,trueREST:!0,displayTime:!1};return new n((function(e,i){s.authenticatedRequest(l.getGetEcoSystemUrl(l.getTenant()),{headers:c.getRESTHeaders(),method:"POST",data:JSON.stringify(t),type:"json",proxy:"passport",onComplete:function(t){var i=[];t.New.Objects&&t.New.Objects.forEach(((e,t)=>{"ENOStrRefinementSpecification"===e.type&&i.push({filterId:e.id,name:e["ds6w:identifier"],filterTitle:e.name})})),e(i)},onFailure:function(e){i(e)}})}))}});return u})),define("DS/ENONextGenFilterUX/utils/EditToReadManager",["UWA/Core","UWA/Class","UWA/Class/Options","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENONextGenFilterUX/utils/FilterUIService","UWA/Date","DS/ENOFilterBIUX/NGFServices","DS/Utilities/DateUtils"],(function(e,t,i,n,o,s,r,a){"use strict";return t.singleton(i,{init:function(){},toStringAttribute:function(e){var t,i,o=this.getAttributeValues(e),s="";if(o.inSequence||(s=!0===o.Keep?"Keep":"Remove"),!o.nlsType)return e.set("state","edit"),{level:"error",message:n.get("attrNotCompleted"),sticky:!1};t=o.nlsType,o.nlsExtension&&(i=o.nlsExtension);var r=e.get("allAttributes")[0],a=this._buildAttributeString(r),l=n.get(s.toLowerCase())+" "+n.get(t);i&&(l+=" ("+n.get("extension")+" : "+i+") ");var d=[];d.push(l);var c=a.length;if(0<c){if(1<c||1===c&&Array.isArray(a[0]))if(0===this._isSingleGroupOfAttribute(r)){var u=" "+("all"===r.get("combination")?n.get("AllCombination"):n.get("AnyCombination"));u+=" "+n.get("FollowingCombination"),l+=" "+n.get("with")+" "+u}else{u=a[0].shift();var h=[];a[0].forEach((function(e){h.push(e)}));for(var p=1;p<a.length;p++)h.push(a[p]);c=(a=h).length,l+=" "+u}else l+=" "+n.get("with")+" :";if(d[0]=l,1!==c||Array.isArray(a[0])){var _=d.concat(a);d=_}else d.push(" "+a[0])}return d},toStringContext:function(t){var i=t.get("addedNodesList"),o=t.get("excludedNodesList"),s=i.length,r=o.length,a="";if(s||r){let e='<span class="f-criterion-deactivated">',i="</span>";var l=1===s?"ContextReadViewSingleAdd":"ContextReadViewMultiAdd",d=s+" "+n.get(l);d=t.get("AddNodeActivated")?d:e+d+i;var c=1===r?"ContextReadViewSingleExclude":"ContextReadViewMultiExclude",u=r+" "+n.get(c);u=t.get("ExcludeNodeActivated")?u:e+u+i,s>0&&r>0?a+=d+", "+u:s>0?a+=d:r>0&&(a+=u)}e.createElement("span",{}).addClassName("fonticon fonticon-dropbox");var h=[];return h.push(a),h},_isSingleGroupOfAttribute:function(e){var t=0,i=this.getAttributeValues(e).allAttributes||[];return 1===i.length&&this.getAttributeValues(i[0]).allAttributes&&(t=1),t},configToString:function(e){return e.get("displayExpression")},volumeToString:function(e){var t=e.get("allVolumes")[0],i=this._volumeAsString(t),o=[],s=i.length;if(0<s){var r="";if(1<s||1===s&&Array.isArray(i[0]))if(r=n.get("with"),0===this._isSingleGroupOfVolume(t)){var a=" "+("all"===t.get("combination")?n.get("AllCombination"):n.get("AnyCombination"));r+=a+=" "+n.get("FollowingCombination")}else{s=i[0].length;a=i[0].shift();var l=[];i[0].forEach((function(e){l.push(e)}));for(var d=1;d<i.length;d++)l.push(i[d]);i=l,r=a}if(o[0]=r,1!==s||Array.isArray(i[0])){var c=o.concat(i);o=c}else o[0]=i[0]}return o},_volumeAsString:function(e){for(var t=[],i=e.get("allVolumes")||[],o=0;o<i.length;o++){var s=i[o];if(s.get("allVolumes")){var r=n.get("with")+" ";r+="all"===s.get("combination")?n.get("AllCombination"):n.get("AnyCombination"),r+=" "+n.get("FollowingCombination");var a=this._volumeAsString(s);a.unshift(r),t.push(a)}else{var l=s.get("displayName");l&&l.length&&t.push(l)}}return t},_isSingleGroupOfVolume:function(e){var t=0,i=e.get("allVolumes")||[];return 1===i.length&&i[0].get("allVolumes")&&(t=1),t},groupToString:function(e){var t=e.get("subGroupCollection"),i=[];return t.forEach((function(e,t){i.push(e.criterionToHTML())})),i.join("")},_buildAttributeString:function(e){for(var t=[],i=this.getAttributeValues(e),o=i.allAttributes||[],s=0;s<o.length;s++){var r=o[s];if(void 0===(i=this.getAttributeValues(r)).allAttributes){var a=this._buildSingleAttribute(r);a.length&&t.push(a)}else{var l=n.get("with")+" ";l+="all"===i.combination?n.get("AllCombination"):n.get("AnyCombination"),l+=" "+n.get("FollowingCombination");var d=this._buildAttributeString(r);d.unshift(l),t.push(d)}}return t},getAttributeValues:function(e){var t={};return void 0!==e&&(t={Keep:e.get("Keep"),type:e.get("type"),nlsType:e.get("nlsType"),extension:e.get("extension"),nlsExtension:e.get("nlsExtension"),inSequence:e.get("inSequence")},void 0===e.get("combination")?(t.attribute=e.get("attribute"),t.nlsAttribute=e.get("nlsAttribute"),t.attrOp=e.get("attrOp"),t.nlsAttrOp=e.get("nlsAttrOp"),t.attrValue=e.get("attrValue"),t.attrValue_1=e.get("attrValue_1"),t.attrValue_2=e.get("attrValue_2")):(t.combination=e.get("combination"),t.allAttributes=e.get("allAttributes"))),t},setAttributeValues:function(e,t){void 0!==e&&void 0!==t&&(e.set("Keep",t.Keep),e.set("type",t.type),e.set("nlsType",t.nlsType),e.set("extension",t.extension),e.set("nlsExtension",t.nlsExtension),e.set("inSequence",t.inSequence),void 0===t.combination?(e.set("attribute",t.attribute),e.set("nlsAttribute",t.nlsAttribute),e.set("attrOp",t.attrOp),e.set("nlsAttrOp",t.nlsAttrOp),e.set("attrValue",t.attrValue),e.set("attrValue_1",t.attrValue_1),e.set("attrValue_2",t.attrValue_2)):(e.set("combination",t.combination),e.set("allAttributes",t.allAttributes)))},_buildSingleAttribute:function(e){var t="",i=this.getAttributeValues(e),o=i.attribute?i.attribute.type:void 0,s=i.nlsAttribute||"",r=i.attrOp||"",a="";if(void 0!==i.attrValue){a=i.attrValue;var l=i.attribute.rangeValues;a=l?this._buildAttributeValue(o,a,l,r,", "):"boolean"===o?"true"===a?n.get("true"):n.get("false"):this._buildAttributeValue(o,a,l,r,", "),"string"===o&&(a=a.replaceAll?a.replaceAll("<","&lt;"):a.split("<").join("&lt;"))}if(r&&"between"===r&&void 0!==i.attrValue_1){var d=[i.attrValue_1,i.attrValue_2],c=" "+n.get("AND").toLowerCase()+" ";a=this._buildAttributeValue(o,d,i.attribute.rangeValues,r,c)}return void 0!==s&&s.length&&(t=s+" "+n.get(r),-1===["isEmpty","isNotEmpty"].indexOf(r)&&(t+=a?" "+a:"<span class=f-criterion-value-not-set> "+n.get("NoValueEntered")+"</span>")),t},_buildAttributeValue:function(e,t,i,r,l){var d=Array.isArray(t)?t:[t],c=d.length,u=[];if(i)for(var h=i.literalInfo?i.literalInfo:i,p=h.length,_=0;_<c;_++){for(var m=0,f=0;f<p;f++){var g=h[f],v="integer"===e||"real"===e?String(d[_]):d[_];if(g.isAggregate&&Array.isArray(v)?g.value.sort().toString()===v.sort().toString()?1:0:g.value===v?1:0){if("dateTime"===e||"timestamp"===e){let e=new Date(g.value);u.push("on"===r?a.formatDateToString(e):a.formatDateToString(e,{timePrecision:"sec"}))}else{var b=g.nlsValue||g.nlsvalue;u.push(b||g.value)}m=1;break}}if(o.isSearchEditorActive()&&!m)if("dateTime"===e||"timestamp"===e){let e=new Date(d[_]);u.push("on"===r?a.formatDateToString(e):a.formatDateToString(e,{timePrecision:"sec"}))}else u.push(d[_])}if(0===u.length)for(_=0;_<c;_++){var C=d[_];if("dateTime"===e||"timestamp"===e){var y=new s(s.parse(C));C=o.isTimeInDateActivated()&&"on"===r?a.formatDateToString(y):a.formatDateToString(y,{timePrecision:"sec"})}u.push(C)}var F=u.join(l);return 1<u.length&&"between"!==r&&(F=n.get("AnyOf")+"  "+F),F}})})),define("DS/ENONextGenFilterUX/utils/CVManager",["UWA/Core","UWA/Class","UWA/Class/Options","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","UWA/Date"],(function(e,t,i,n,o,s){"use strict";return t.singleton(i,{init:function(){},buildCVQueryForContext:function(e,t){var i;if("root_path_physicalid"==t){if(i=!1,e.get("AddNodeActivated")){var n=e.get("addedNodesList");if(a=n.length){for(var o="[",s=0;s<a;s++)o+='["'+n[s].toString().split(",").join('","')+'"],';i=o=o.slice(0,-1)+"]"}}}else{i="";var r=[];if(e.get("ExcludeNodeActivated")){var a=(r=e.get("excludedNodesList")).length,l="[";for(s=0;s<a;s++)l+='["'+r[s].toString().split(",").join('","')+'"],';l=l.endsWith(",")?l.slice(0,-1):l,l+="]",r.length>0&&(i='"find_path_filter":[{"option": ["remove"],"path_physicalid":'+l+"}]")}}return i},buildCVQueryForAttribute:function(e,t){var i="";i=e.get("Keep")?!1===t||"false"===t?"seq_cut":"seq_keep":"seq_remove";var n=e.get("type"),o="";e.get("extension")&&(o=e.get("extension"));var s="",r=e.get("allAttributes");r&&r.length&&(s=(s=this._buildAttributeQuery(r[0])).length?s:"#all");var a="";return s.length&&(a='{"option":["'+i+'"],"definition":[{"type_filter_bo":["'+n+'"],"type_filter_rel":["'+n+'"],"q.query":"'+s,o.length&&(a+=" AND [ds6w:kind]:"+o),a+='"}]}'),a},buildCVQueryForConfig:function(e){var t="";return e&&(t='"config_filter":"'+e+'"'),t},buildCVQueryForGroup:function(e,t){var i="",o=e.get("subGroupCollection")._models;if("attribute"===e.get("sequenceType")){var s=o&&o.length?o[0]:void 0;if(s){var r='{"option":["'+(s.get("Keep")?"false"===t?"seq_cut":"seq_keep":"seq_remove")+'"],"definition":[',a=this,l="";o.forEach((function(e){if(n.isModelActivated(e)){var t=e.get("type"),i=e.get("extension")||"",o="",s=e.get("allAttributes");s&&s.length&&(o=(o=a._buildAttributeQuery(s[0])).length?o:"#all"),o.length&&(l+='{"type_filter_bo":["'+t+'"],"type_filter_rel":["'+t+'"],"q.query":"'+o,i.length&&(l+=" AND [ds6w:kind]:"+i),l+='"},')}})),l.length&&(i=r+(l=l.slice(0,-1))+"]}")}}return i},buildCVQueryForVolume:function(e){var t="",i="",n=e.get("allVolumes");return n&&n.length&&(i=this._buildVolumeQuery(n[0])),i.length&&(t='"volume_filter":{'+i+"}"),t},buildCVQueryForTags:function(e){var t=[],i=e.get("tagData")||{allfilters:e.get("allfilters")||void 0};if(Object.keys(i.allfilters).length||Object.keys(i.localfilters).length)for(var n in i.allfilters)if(i.allfilters.hasOwnProperty(n)){var o={option:["seq_keep"],definition:[]},s="",r=Object.keys(i.allfilters[n]).length,a=0;for(var l in i.allfilters[n]){var d;if(i.allfilters[n].hasOwnProperty(l))-1!==n.lastIndexOf("/")&&(d=n.substring(n.lastIndexOf("/")+1)),s+="["+d+"]:"+(Array.isArray(i.allfilters[n][l].object)?i.allfilters[n][l].object.join("/"):i.allfilters[n][l].object),s+=++a<r?" OR ":""}o.definition.push({"q.query":s}),t.push(o)}return t},_buildVolumeQuery:function(e){var t="",i="",o="",s=e.get("combination");s&&(t='"'+("all"===s?"and":"or")+'":[',i="{",o="}");for(var r,a=e.get("allVolumes")||[],l=a.length,d=0;d<l;d++){var c=(h=a[d]).get("parameters");if(c&&void 0!==c.maybe3d&&n.isModelActivated(h)){r=c.maybe3d;break}}var u=0;for(d=0;d<l;d++){var h=a[d];if(n.isModelActivated(h))u++,t+=h.get("allVolumes")?i+this._buildVolumeQuery(h,r)+o:i+this._buildSingleVolumeQuery(h,r)+o,t+=","}return u?(t=t.slice(0,t.length-1),s&&(t+="]")):t="",t},_buildSingleVolumeQuery:function(e,t){var i="",n=e.get("parameters");if(n){var o="";switch(n.type){case"box":o='"box":{',o+='"corner_min":["'+n.corner_min.toString().split(",").join('","')+'"],',o+='"corner_max":["'+n.corner_max.toString().split(",").join('","')+'"],',o+='"transformation_matrix":["'+n.transformation_matrix.toString().split(",").join('","')+'"],';break;case"sphere":o='"sphere":{',o+='"center":["'+n.center.toString().split(",").join('","')+'"],',o+='"radius":"'+n.radius+'",';break;case"proximity":var s=n.root_path_physicalid[0];o='"assemblyshape":{',o+='"root_path_physicalid":[["'+(s=Array.isArray(s)?s:[s]).toString().split(",").join('","')+'"]],',o+='"distance":"'+n.distance+'",';break;case"space":s=n.root_path_physicalid[0];s=Array.isArray(s)?s:[s];var r=n.distance?n.distance:"0.000";o='"assemblyshape":{',o+='"root_path_physicalid":[["'+s.toString().split(",").join('","')+'"]],',o+='"distance":"'+r+'",'}if(""!==o){if(o+='"intersection_mode":"'+n.intersection_mode+'"',void 0!==t)o+=",",o+='"maybe3d":"'+(1===t?"true":"false")+'"';o+="}"}i=o}return i},_buildAttributeQuery:function(e){for(var t=e.get("allAttributes")||[],i=t.length,n="all"===e.get("combination")?" AND ":" OR ",o=i?"":"#all",s=0;s<i;s++){var r,a=t[s];void 0===a.get("allAttributes")?(r=this._buildSingleAttribute(a)).length&&(o+=r):(r=this._buildAttributeQuery(a)).length&&(o+=" ("+r+")"),r.length&&(o+=n)}return o=o.endsWith(n)?o.slice(0,-n.length):o},_buildSingleAttribute:function(e){var t="",i=!0;if(void 0===e.get("attrValue")&&void 0===e.get("attrValue_1")&&void 0===e.get("attrValue_2")&&(i=!1),i)switch(e.get("attribute")?e.get("attribute").type:e.get("type")){case"string":t+=this._buildStringAttr(e);break;case"boolean":t+=this._buildBooleanAttr(e);break;case"number":case"integer":case"real":t+=this._buildNumericalAttr(e);break;case"dateTime":case"timestamp":t+=this._buildDateAttr(e)}return t},_buildDateAttr:function(e){var t="",i=e.get("attribute")?e.get("attribute").uri:e.get("uri"),o=e.get("attrOp"),s=[];if("between"!==o){var r=e.get("attrValue")||n.ATTRIBUTE_NOT_VALUATED;s=Array.isArray(r)?r:[r]}else{var a=e.get("attrValue_1")||n.ATTRIBUTE_NOT_VALUATED,l=e.get("attrValue_2")||n.ATTRIBUTE_NOT_VALUATED;s.push(a),s.push(l)}for(var d="",c=s.length,u=0;u<c;u++){var h='\\"'+s[u]+'\\"';switch(d=" OR ",o){case"on":t+="["+i+"] = "+h;break;case"after":t+="["+i+"] >= "+h;break;case"strictlyAfter":t+="["+i+"] > "+h;break;case"before":t+="["+i+"] <= "+h;break;case"strictlyBefore":t+="["+i+"] < "+h;break;case"between":0===u?(t+="["+i+"] >= "+h,d=" AND "):t+="["+i+"] <= "+h}t+=d}return t.length&&(t="("+(t=t.endsWith(d)?t.slice(0,-d.length):t)+")"),t},_buildNumericalAttr:function(e){var t="",i=e.get("attribute")?e.get("attribute").uri:e.get("uri"),o=e.get("attrOp"),s=[];if("between"!==o){var r=e.get("attrValue")||n.ATTRIBUTE_NOT_VALUATED;s=Array.isArray(r)?r:[r]}else{var a=e.get("attrValue_1")||n.ATTRIBUTE_NOT_VALUATED,l=e.get("attrValue_2")||n.ATTRIBUTE_NOT_VALUATED;s.push(a),s.push(l)}for(var d="",c=s.length,u=0;u<c;u++){var h=s[u];switch(d=" OR ",o){case"equals":t+="["+i+"] = "+h;break;case"notEqual":t+="["+i+"] != "+h;break;case"lowerThan":t+="["+i+"] <= "+h;break;case"greaterThan":t+="["+i+"] >= "+h;break;case"strictlyLowerThan":t+="["+i+"] < "+h;break;case"strictlyGreaterThan":t+="["+i+"] > "+h;break;case"between":0===u?(t+="["+i+"] >= "+h,d=" AND "):t+="["+i+"] <= "+h}t+=d}return t.length&&(t="("+(t=t.endsWith(d)?t.slice(0,-d.length):t)+")"),t},_buildBooleanAttr:function(e){return"("+("["+(e.get("attribute")?e.get("attribute").uri:e.get("uri"))+"]:"+(e.get("attrValue")||n.ATTRIBUTE_NOT_VALUATED))+")"},_buildStringAttr:function(e){for(var t="",i=e.get("attribute")?e.get("attribute").uri:e.get("uri"),o=e.get("attrOp"),s=e.get("attrValue")||n.ATTRIBUTE_NOT_VALUATED,r=Array.isArray(s)?s:[s],a=" OR ",l=r.length,d=0;d<l;d++){var c=r[d];switch(o){case"equals":t+="["+i+']:\\"'+c+'\\"';break;case"notEqual":t+="(NOT ["+i+"]:("+c+"))";break;case"contains":t+="["+i+"]:*"+c+"*";break;case"notContains":t+="(NOT ["+i+"]:(*"+c+"*))";break;case"startsWith":t+="["+i+"]:"+c+"*";break;case"endsWith":t+="["+i+"]:*"+c}t+=a}return t.length&&(t="("+(t=t.endsWith(a)?t.slice(0,-4):t)+")"),t}})})),define("DS/ENONextGenFilterUX/models/CriterionModel",["UWA/Core","UWA/Class/Model","DS/ENONextGenFilterUX/utils/CVManager","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/ENONextGenFilterUX/utils/FilterPersistencyServices"],(function(e,t,i,n,o){"use strict";return t.extend({defaults:{name:"elementaryCriteria-model",isActivated:"1",isParentActivated:1},setup:function(){},toCVQuery:function(e){var t,n=this.get("criteriaType");return"attribute"===n?t=i.buildCVQueryForAttribute(this,e):"config"===n?t=i.buildCVQueryForConfig(this.get("config_filter")):"context"===n?t=i.buildCVQueryForContext(this,e):"tag"===n?t=i.buildCVQueryForTags(this):"volume"===n?t=i.buildCVQueryForVolume(this,e):console.log(" !! CriterionModel.toCVQuery : non supported case - "+n),t},criterionToString:function(){var e,t=this.get("criteriaType");return"attribute"===t?e=n.toStringAttribute(this):"config"===t?e=n.configToString(this):"context"===t?e=n.toStringContext(this):"volume"===t?e=n.volumeToString(this):console.log(" !! CriterionModel.criterionToString : non supported case - "+t),e},criterionToHTML:function(){var e="",t=this.get("criteriaType");if("attribute"===t){var i=this.criterionToString(this),o=this.get("isActivated"),s="0"===o?"f-criterion-deactivated":"";e+="1"===o?"<li>"+i[0]+'<ul class="attrRead-multi-attr"><div>':'<li><span class="'+s+'">'+i[0]+'</span><ul class="attrRead-multi-attr '+s+'"><div>',1<i.length&&(i.shift(),e+=this._getAttributeHTML(i)),e+="</div></ul></li>"}else"config"===t?e=n.configToString(this):"context"===t?e=n.toStringContext(this):"volume"===t?e=n.volumeToString(this):console.log(" !! CriterionModel.criterionToString : non supported case - "+t);return e},keepComponentsToFeedUI:function(e,t){var i={},n=this.get("criteriaType");return"attribute"===n?i=o.keepToFeedAttr(this,t):"config"===n?i=o.keepToFeedConfig(this):"context"===n?i=o.keepToFeedContext(this,t):"volume"===n?i=o.keepToFeedVolume(this):"tag"===n?i=o.keepToFeedTag(this):console.log(" !! CriterionModel.keepToFeed : non supported case - "+n),i},_getAttributeHTML:function(e){for(var t="",i=0;i<e.length;i++)if(Array.isArray(e[i])){var n=e[i];t+="<li>"+n[0],t+="<ul>",n.shift(),t+=this._getAttributeHTML(n),t+="</ul></li>"}else t+="<li>"+e[i]+"</li>";return t}})})),define("DS/ENONextGenFilterUX/models/GroupModel",["UWA/Class/Model","DS/ENONextGenFilterUX/utils/CVManager","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/ENONextGenFilterUX/utils/FilterPersistencyServices","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX"],(function(e,t,i,n,o){"use strict";return e.extend({defaults:{state:"edit",isActivated:"1",isParentActivated:1,_name:o.get("defaultGroupName"),_rootId:"",_number:0},setup:function(e){},toCVQuery:function(e){var i="";return"Sequence"===this.get("criteriaType")&&(i=t.buildCVQueryForGroup(this,e)),i},groupToString:function(){return i.groupToString(this)},keepComponentsToFeedUI:function(e,t){var i={};return"Sequence"===this.get("criteriaType")&&(i=n.keepToFeedSequence(this,t)),i},setActivated:function(e){this.set("isActivated",e)},isActivated:function(){return this.get("isActivated")},setFilterSpecificationName:function(e){this.set("_name",e)},getFilterSpecificationName:function(){return this.get("_name")},setFilterSpecificationRoot:function(e){this.set("_rootId",e)},getFilterSpecificationRoot:function(){return this.get("_rootId")},setFilterSpecificationIndex:function(e){this.set("_number",e)},getFilterSpecificationIndex:function(){return this.get("_number")},getFilterSpecificationLabel:function(){var e=this.getFilterSpecificationName(),t=this.getFilterSpecificationIndex();return t&&(e=UWA.String.format(o.get("defaultGroupNameWithValue"),e,t)),e}})})),define("DS/ENONextGenFilterUX/collections/FilterUIGroupCollection",["UWA/Core","UWA/Class/Collection","DS/ENONextGenFilterUX/models/CriterionModel","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX"],(function(e,t,i,n){"use strict";return t.extend({model:i,comparator:void 0,setup:function(e,t){this.add(e)}})})),define("DS/ENONextGenFilterUX/models/GlobalFilterModel",["UWA/Class/Model","DS/ENONextGenFilterUX/utils/CVManager"],(function(e,t){"use strict";return e.extend({name:"globalFilter-model",defaults:{state:"edit",combinationOfSpecification:"union",minusIndex:void 0},setup:function(){}})})),define("DS/ENONextGenFilterUX/collections/FilterUIGlobalFilterCollection",["UWA/Core","UWA/Class/Collection","UWA/Promise","UWA/Date","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/NGFServices","DS/WAFData/WAFData","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENONextGenFilterUX/utils/FilterPersistencyServices","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/ExpandV2FormatServices","DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterUX/models/GroupModel"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h){"use strict";return t.extend({model:h,comparator:void 0,setup:function(e,t){this.add(e),this._widgetId=t.widgetId||null,this._gfvModel=t.model},removeGroupCollection:function(e){this.remove(e,{silent:!0})},getGroupCollectionCount:function(e){return this.size()},getGroupCollectionIndex:function(e){var t=-1;return this.forEach((i=>{if(-1!==i.getFilterSpecificationName().indexOf(e)){var n=i.getFilterSpecificationIndex();t=t<n?n:t}})),-1!==t&&t++,t},getActiveGroupCollection:function(e){var t=[];return this.forEach((e=>{"1"===e.isActivated()&&t.push(e)})),t},buildCVQuery:function(e,t,n,o,r){var a=this;return new i((function(i,l){var d=a.keepComponentsToFeedUI(t,n,o);a.buildCVQueryFromFilterSpec(e,t,n,d,r).then((function(e){if(!s.isProgressiveExpandActive()){var n=c.fromNGFV1ToV2(t,e.CVQuery);e.CVQueryV2=n}var o=JSON.stringify(e);i(o)}),(function(e){l("")}))}))},buildCVQueryFromFilterSpec:function(e,t,n,a,l){return new i((function(i,n){var c=Date.now(),u=l&&l.queryFormat?l.queryFormat:s.getQueryFormat();s.isActivated("QueryV2FromModel")&&(l.queryV2FromModel=s.isActivated("QueryV2FromModel")),s.isActivated("MultiRoot")&&(l.multiRoot=s.isActivated("MultiRoot")),r.authenticatedRequest(s.getGetFilterQueryUrl(),{headers:d.getRESTHeaders(e),method:"POST",type:"json",proxy:"passport",data:JSON.stringify({rootID:t,specification:a,options:l}),onComplete:function(e){o.displayInternalDurationTrace("buildCVQueryFromFilterSpec.onComplete("+u+")",Date.now()-c),s.isDebugActive("ngf")&&console.log(" CV queries = "+JSON.stringify(e)),i(e)},onFailure:function(e){console.log("=====> Build CVQuery from FilterSpecification failed, error  = "+e),n(e)}})}))},keepComponentsToFeedUI:function(e,t,i,n){var o=[];o.push({toFeedUI:{combinationOfSpecification:this._gfvModel.get("combinationOfSpecification"),minusIndex:this._gfvModel.get("minusIndex"),keepChildren:t,specVersion:s.getCurrentSpecificationVersion()}});var r=[],l=a.get("defaultGroupName");this.forEach((e=>{if(e){r.push(e.getFilterSpecificationRoot());let d=e.get("groupCollection");var s=[];d.toArray().forEach((e=>{var o={};if(i?"tag"===e.get("criteriaType")&&(o=e.keepComponentsToFeedUI(t)):o=e.keepComponentsToFeedUI(t,n),Object.keys(o).length)for(var r=Array.isArray(o)?o:[o],a=0;a<r.length;a++)s.push(r[a])}));var a={toFeedUI:s};"0"===e.isActivated()&&(a.isActivated="0"),-1===e.getFilterSpecificationName().indexOf(l)&&(a.filterSpecificationName=e.getFilterSpecificationName()),o.push(a)}}));var d=[...new Set(r)];return(1===d.length&&e!=r[0]||1<d.length)&&(o[0].toFeedUI.rootIds=r),o},_buildCVQuerySync:function(e,t){var i=[],n=0,r=this._gfvModel.get("combinationOfSpecification")||"union",a=0,l=!0,d=this.size();"minus"===r&&"0"===this._gfvModel.get("minusIndex")&&(a=d-1,l=!1);for(var c=!1;0<=a&&!c;){var u=a,h="",p=[],_=[],m=[],f=[],g=[];if("1"===this.at(u).isActivated()){let o=this.at(u).get("groupCollection"),s=o.size();for(var v=0;v<s;v++){var b=o.at(v);if("1"===b.get("isActivated")){var C=b.get("criteriaType");"attribute"===C?p.push(b.toCVQuery(t)):"config"===C?_.push(b.toCVQuery()):"Sequence"===C||"subGroup"===C?p.push(b.toCVQuery(t)):"context"===C?(m.push(b.toCVQuery()),m.push(b.toCVQuery("root_path_physicalid"))):"tag"===C&&b.toCVQuery()?f=b.toCVQuery():"volume"===C&&g.push(b.toCVQuery())}}var y=m.length,F=m[y-1];h+='{"root_path_physicalid":',h+=F&&!1!==F?F:'[["'+e+'"]]',(p.length||f.length)&&(h+=',"sequence_filter": ['+p.toString()+"]"),_.length&&(h+=","+_[_.length-1]),y&&m[y-2]&&(h+=","+m[y-2]);var I=g.length;if(n=n||I,I&&g[0].length&&(h+=","+g[0]),h+="}",f.length){for(var A=JSON.parse(h),S=0;S<f.length;S++)A.sequence_filter.push(f[S]);h=JSON.stringify(A)}i.push(h)}l?a++:a--;c=d===a||-1===a}var E=n?"expand3d":"expand",N="{";N+='"specVersion":"'+s.getCurrentSpecificationVersion()+'"',N+=', "'+r+'":{"'+E+'":['+i.toString()+"]}",N+="}";var w={};w.CVQuery=N;var x=o.upgradeAndCompleteQuery(w);return N=JSON.stringify(x),console.log("CVQuery = "+N),N}})})),define("DS/ENONextGenFilterUX/views/CriteriaConfigurationView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","UWA/Promise","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars4","text!DS/ENONextGenFilterUX/templates/configurationViewTemplate.html","text!DS/ENONextGenFilterUX/assets/ENOStrRefinementUX_require.json","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Controls/Button","DS/Controls/TooltipModel"],(function(e,t,i,n,o,s,r,a,l,d,c,u){"use strict";return e.extend({className:"configurationCriterion",tagName:"li",domEvents:{"click .configCriterion-read .confRead":"_onEditAttribute","click .configCriterion-read .confReadIcon":"_onEditAttribute"},setup:function(e){this._parent(e),this._configFactory=void 0,this._rootID=e.rootId,this._template=r.compile(a),this._hasConf=!1,this._initWithConfig=e.initWithConfig||!1,this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this))},render:function(){return this.container.setContent(this._template({stateClass:this.model.get("state"),titleClass:o.get("titleConfigurationUX"),titleConfigurationReadUX:o.get("titleConfigurationReadUX"),iconHeader:s.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_ConfigurationFilter.png")})),this._createHeaderCtxMenu(),this},onStateChange:function(e,t){var i=this,n=this.getElement(".f-configuration-container");n.setAttribute("class","f-configuration-container "+t);let s=n.getElement(".configCriterion-read .criterionDropDown"),r=n.getElement(".configCriterion-edit .criterionDropDown");if("read"===t){s&&s.addClassName("focused"),r&&r.removeClassName("focused");var a=this.model.criterionToString()||"",l=a,u=d.MAX_CAR_FOR_CONFIG;if(u<l.length){var h=this.getElement(".confRead#value").hide();h=this.getElement(".confRead#long-value").show();let e=function(e){let t=i.model.criterionToString(),n=t;e.checkFlag?(e.label="("+o.get("ShowLess")+")",n+="  "):(e.label="("+o.get("ShowMore")+")",n=n.substr(0,u)+" ... "),i._displayConfigValue(h,n,t)};if(!this._extensionText){this._extensionText=new c({touchMode:d.TOUCH_MODE,displayStyle:"lite",label:o.get("ShowLess"),id:"ShowMoreOrLess_"+this._childGroupId,checkFlag:!1}),this._extensionText.inject(h,"after"),this._extensionText.getContent().addClassName("filter-anchor-style");i=this;this._extensionText.addEventListener("buttonclick",(function(e){e.dsModel.checkFlag=!e.dsModel.checkFlag})),this._extensionText.addEventListener("change",(function(t){e(t.dsModel)}))}e(this._extensionText),this._extensionText.show()}else{h=this.getElement(".confRead#long-value").hide();h=this.getElement(".confRead#value").show(),this._extensionText&&this._extensionText.hide(),this._displayConfigValue(h,l,a)}this._setContextualMenu("read")}else s&&s.removeClassName("focused"),r&&r.addClassName("focused"),this._savedBeforeEdit=this.model.keepComponentsToFeedUI(!0),this.dispatchEvent("NGF_Criterion_SwitchedToEdit",{type:this.model.get("criteriaType"),state:1}),this._initWithConfig||this._launchCfgFactory(),this._setContextualMenu("edit")},_displayConfigValue:function(e,t,i){e.setContent([{tag:"span",html:t}]),e.tooltipInfos?e.tooltipInfos.shortHelp=i.unescapeHTML():e.tooltipInfos=new u({shortHelp:i.unescapeHTML(),mouseRelativePosition:!0})},_getDOMElementToUpdateOnActivateChange:function(){var e=[];let t=this.getElement("#"+this._getId()+" .configCriterion-read");return e.push(t.getElement("#readHeader")),e.push(t.getElement("img")),e},destroy:function(){this._hasConf=!1,this.dispatchEvent("NGF_RemoveCriterion",{idxView:this.cid,criteriaType:this.model.get("criteriaType"),hasConf:this._hasConf,edited:"edit"===this.model.get("state")?1:0}),this.stopListening(),this.model=null,this._parent(),this.container=null},_getCallbackToEditCriterion:function(){return this.editConfiguration.bind(this)},editConfiguration:function(){this.model.set("state","edit")},launchCfgFactoryWithConfig:function(e){var t=this;t._initWithConfig=!1;let i=d.getGlobalEditContainer(this._UXId);return i&&i.empty(),new n((function(n,o){var s=JSON.parse(l).conf;require([s],(function(o){t._configFactory=o;var s=d.getPlatformId(),r={rootId:t._rootID,callback:function(e){t._onConfigFilterCB(e),n()}.bind(t),expression:t._hasConf?t.model.get("expression"):{},config_filter_id:t.model.has("config_filter_id")?t.model.get("config_filter_id"):"",tenant:s,platformUrl:d.getPlatformServiceUrl(s,t._pfServiceId),renderTo:t.getElement(".configCriterion-edit"),renderToApp:i,hideFilter:t._hideFilterContainer.bind(t),showFilter:t._showFilterContainer.bind(t),displayCompactMode:d.TOUCH_MODE?0:1,configData:e,securityContext:t.options.securityContext};t._configFactory.begin(r),n()}))}))},_launchCfgFactory:function(){var e=this;let t=d.getGlobalEditContainer(this._UXId);t&&t.empty();var i=JSON.parse(l).conf,n=d.getPlatformId(),o={rootId:e._rootID,callback:e._onConfigFilterCB.bind(e),expression:e._hasConf?e.model.get("expression"):{},config_filter_id:e.model.has("config_filter_id")?e.model.get("config_filter_id"):"",tenant:n,platformUrl:d.getPlatformServiceUrl(n,e._pfServiceId),renderTo:e.getElement(".configCriterion-edit"),renderToApp:t,hideFilter:e._hideFilterContainer.bind(e),showFilter:e._showFilterContainer.bind(e),displayCompactMode:d.TOUCH_MODE?0:1,securityContext:e.options.securityContext};require([i],(function(t){e._configFactory=t,e._configFactory.begin(o)}))},_onConfigFilterCB:function(e){if(0===e.length){var t={criteriaType:this.model.get("criteriaType"),action:"remove"};this.dispatchEvent("NGF_Criterion_Config",t)}else{var i=e[0][this._rootID],n=this.model;n.set("displayExpression",i.displayExpression),n.set("expression",i.expression),i.config_filter_id?(n.set("config_filter_id",i.config_filter_id),n.unset("config_filter")):(n.set("config_filter",i.compiledBinary),n.unset("config_filter_id"));this._hasConf=!0;t={criteriaType:n.get("criteriaType"),cfgType:n.get("config_filter_id")?"configId":"binary",action:"update",hasConf:this._hasConf};this.dispatchEvent("NGF_Criterion_Config",t),d.isModelActivated(n)||!0!==this._isCriterionModified()||this._switchCriterionState(),this.dispatchEvent("NGF_Criterion_Validation",{criteriaType:n.get("criteriaType")}),"none"!==d.getGlobalEditContainer(this._UXId).getStyle("display")&&d.showFilterContainer(!0)}},_isCriterionModified:function(){var e=!1;if(this.model){let t=this.model.keepComponentsToFeedUI(!0).displayExpression;e=this._savedBeforeEdit.displayExpression!==t}return e},isCriterionValidate:function(){if(0===d.isAsynchronousValidation())return t=this._configFactory&&this._configFactory.validateConfigurationFilter?"edit"!==this.model.get("state")||this._configFactory.validateConfigurationFilter():"read"===this.model.get("state");var e=this;if(this._configFactory&&this._configFactory.validateConfigurationFilter)return"edit"===this.model.get("state")?new n((t=>{e._configFactory.validateConfigurationFilter().then((function(i){e._savedBeforeEdit=i?void 0:e._savedBeforeEdit,t(i)}))})):new n((t=>{e._savedBeforeEdit=void 0,t(!0)}));var t="read"===this.model.get("state");return this._savedBeforeEdit=t?void 0:this._savedBeforeEdit,new n((function(e){e(t)}))},viewFromMdl:function(e){this.model.set("displayExpression",e.displayExpression),this.model.set("filterName",e.filterName),this.model.set("expression",e.expression),e.config_filter_id?(this.model.set("config_filter_id",e.config_filter_id),this._hasConf=!(!e.config_filter_id||0===Object.keys(e.config_filter_id))):(this.model.set("config_filter",e.config_filter),this._hasConf=!(!e.config_filter||!e.config_filter.length)),"0"===e.isActivated&&this._switchCriterionState()},isThereCriteria:function(){return this._hasConf},_createHeaderCtxMenu:function(){this._createCriterionCtxMenuWUX(this.getElement(".criterionDropDown")),this._setContextualMenu("edit")},_cancelEditCriteria:function(){if(!this._hasConf){var e=this.model;e.unset("displayExpression"),e.unset("filterName"),e.unset("expression"),e.unset("config_filter"),e.unset("config_filter_id")}this._launchCfgFactory()},getProdConfId:function(){let e=this.model.get("config_filter_id");return e?e.physical_id:void 0},checkConfigFilter:function(e){var t,i=this.model.get("config_filter_id");return i?!(t=-1!==e.indexOf(i.physical_id))&&this.destroy():t=!0,t}})})),define("DS/ENONextGenFilterUX/views/FilterRepairView",["UWA/Core","DS/ENOFilterExplicitWebInWin/views/filterRepairUI","UWA/Promise","UWA/Class/View","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings"],(function(e,t,i,n,o,s,r,a,l,d){"use strict";return n.extend({setup:function(e){this._parent(e);let t=d.getOption("RepairFilterV2")?1:0;this._repairBasedOnExpand=a.isActivated("RepairFilterV2")?t:0},render:function(){var e=this;if(this._displayFilterPanel(!1),this._isBrokenPathsObject){let t=document.querySelector(".filter-Filter-Area");this._filterUIObj.render().inject(t.getElement(".globalEdit-container")),this.listenTo(this._filterUIObj,"NGF_RepairFilter",(function(t){e._repairFilter(t),e._subscribe0&&e._subscribe0.unsubscribe("Frame3DXInfra.onPanelClose"),e.stopListening()})),this.listenTo(this._filterUIObj,"NGF_CancelRepairFilter",(function(t){this._subscribe0.unsubscribe("Frame3DXInfra.onPanelClose"),"CancelRepair"==t.listOfList&&e._displayFilterPanel(!0),e.dispatchEvent("NGF_CancelRepairFilter",t),e.stopListening()})),this._subscribe0=s.subscribe("Frame3DXInfra.onPanelClose",(function(t){e._displayFilterPanel(!0),e.dispatchEvent("NGF_CancelRepairFilter",t),e._subscribe0.unsubscribe("Frame3DXInfra.onPanelClose")}))}return this},logWebServiceOptions:function(e){this._optionsWebservice=e},logPathsInFiltersInfo:function(e){this._toFeedUI=e},_logConfigs:function(e){var t=[];let i=0;return e.forEach((e=>{i+=e?1:0})),i&&this._specificationToRepair.forEach((i=>{let n=e[i];n?n.config_filter?t.push(n.config_filter):n.config_filter_id?t.push(JSON.stringify({config_filter_id:n.config_filter_id})):t.push(void 0):t.push(void 0)})),t.length?t:void 0},logFilterInfos:function(e){this._filterInfos=e},fetchRepairedPathsFromWebService:function(e){var n=this;return this._isBrokenPathsObject="object"==typeof e,e.filterName=n._filterInfos.title,e.combinationSpec=n._filterInfos.combinationSpec,e.configuration=n._logConfigs(n._configPerSpec),delete n._filterInfos,this._filterUIObj=new t({brokenPaths:e,url:this._optionsWebservice.url,ctx:this._optionsWebservice.ctx,widgetId:this.options.options.widgetId||this.options.options.widget,filteredRoot:this.options.options.rootID}),this._filterUIObj.RepairFilterInWidget(this.options.options.widget),new i((function(e){n._filterUIObj.fetchData().then((function(t){e(t)}))}))},checkForBrokenPathsInFilter:function(e){var t,n=this;return t=e.filterUIComponents?e.filterUIComponents:e.filterData[e.filterNames[0]].filterUIComponents,new i((function(i,o){let s=t.length;n._specificationToRepair=[],n._configPerSpec=[];let r=[];for(var d=1;d<s;d++){n._configPerSpec.push(void 0);let e=[],i=d-1;(t[d].toFeedUI||[]).forEach((t=>{let o=t.criteriaType;"context"===o?(e.push(t),n._specificationToRepair.push(i)):"volume"===o?(t.proximityPath=n._getProximityPath(t),e.push(t),n._specificationToRepair.push(i)):"config"===o&&(n._configPerSpec[i]=t)})),r.push(e.flat())}var c=r.flat();if(0===c.length)i("NoContextFilter");else{let t=Date.now(),o=l.isSupplemental(),s=l.isShattered();n._checkForBrokenPath(c).then((function(l){if(l.validIDs){let b=l.validIDs;var d=[];b.results.forEach((function(e){var t=e.attributes.findIndex((function(e){return"resourceid"===e.name}));-1!==t&&d.push(e.attributes[t].value)}));var u=function(e,t,i){var n=[],r=[],a=[];return e.forEach((e=>{let o=!1,s=-1;if(e.forEach((e=>{let t=d.indexOf(e);-1===t?o=!0:s=t})),o=!!i||o,o){var l;n.push(e),-1!==s&&(l=b.results[s].attributes.find((function(e){return"logicalid"===e.name}))),r.push(l?l.value:"");var c=e[e.length-1],u=t.physical.findIndex((function(e){return-1!==e.lastIndexOf(c)}));-1!==u&&a.push(t.logical[u])}})),{physical:n,logical:o||s?[]:r,logicalDB:o||s?[]:a}};if("PathsOK"===l.status);else{let t=0;for(var h=0;h<c.length;h++){var p={};if(c[h].addedNodesList){var _=u(c[h].addedNodesList,e.pathDB.added,t),m=[];_.physical.forEach((e=>{var t=c[h].addedNodesList.indexOf(e);if(-1!==t){let e=c[h].addedNodesList.splice(t,1);m.push(e)}})),m.length&&(p.allPathsInfo=b,p.brokenAddedNodes=m,p.brokenAddedLabels=[],p.logicalID_OfAddedPaths=_.logical,p.brokenAddedLogicalDB=_.logicalDB)}if(c[h].excludedNodesList){_=u(c[h].excludedNodesList,e.pathDB.excluded,t),m=[];_.physical.forEach((e=>{var t=c[h].excludedNodesList.indexOf(e);-1!==t&&m.push(c[h].excludedNodesList.splice(t,1))})),m.length&&(p.allPathsInfo=b,p.brokenExcludedNodes=m,p.brokenExcludedLabels=[],p.logicalID_OfExcludedPaths=_.logical,p.brokenExcludedLogicalDB=_.logicalDB)}if(c[h].proximityPath){var f=u(c[h].proximityPath,e.pathDB.proximity,t),g=[];f.physical.forEach((e=>{g.push([e])})),p.allPathsInfo=b,p.brokenProximity=g,p.brokenLogicalDB=f.logicalDB}p.allPathsInfo&&(p.fromSpec=n._specificationToRepair[h],c[h].repairFilterInfo=p)}}var v=function(e,o){a.setPerformanceTracker(n._trackerId,"NGF-RepairFilter","NGF_RepairFilter",{CheckBroken_duration:Date.now()-t},1);let s=e.findIndex((e=>!!e.repairFilterInfo));i(-1!==s?{newPaths:e,specificationToRepair:o}:"PathsOK")};1===n._repairBasedOnExpand?n._checkBrokenPathByConfig(r,n._configPerSpec).then((t=>{t.length&&t.forEach(((t,i)=>{t.forEach((t=>{var o={};let s=r[i][t];if(s.addedNodesList){var a=u(s.addedNodesList,e.pathDB.added,1),l=[];a.physical.forEach((e=>{var t=s.addedNodesList.indexOf(e);if(-1!==t){let e=s.addedNodesList.splice(t,1);l.push(e)}})),l.length&&(o.allPathsInfo=b,o.brokenAddedNodes=l,o.brokenAddedLabels=[],o.logicalID_OfAddedPaths=a.logical,o.brokenAddedLogicalDB=a.logicalDB)}if(s.excludedNodesList){a=u(s.excludedNodesList,e.pathDB.excluded,1),l=[];a.physical.forEach((e=>{var t=s.excludedNodesList.indexOf(e);-1!==t&&l.push(s.excludedNodesList.splice(t,1))})),l.length&&(o.allPathsInfo=b,o.brokenExcludedNodes=l,o.brokenExcludedLabels=[],o.logicalID_OfExcludedPaths=a.logical,o.brokenExcludedLogicalDB=a.logicalDB)}if(s.proximityPath){var d=u(s.proximityPath,e.pathDB.proximity,1);if(d.physical.length){var c=[];d.physical.forEach((e=>{c.push([e])})),o.allPathsInfo=b,o.brokenProximity=c,o.brokenLogicalDB=d.logicalDB}}if(o.allPathsInfo){let e=s.repairFilterInfo;e&&o.brokenAddedNodes?(e.brokenAddedNodes&&(e.brokenAddedNodes=e.brokenAddedNodes.concat(o.brokenAddedNodes),e.logicalID_OfAddedPaths=e.brokenAddedNodes.concat(o.logicalID_OfAddedPaths),e.brokenAddedLogicalDB=e.brokenAddedNodes.concat(o.brokenAddedLogicalDB)),e.brokenExcludedNodes&&o.brokenExcludedNodes&&(e.brokenExcludedNodes=e.brokenExcludedNodes.concat(o.brokenExcludedNodes),e.logicalID_OfExcludedPaths=e.logicalID_OfExcludedPaths.concat(o.logicalID_OfExcludedPaths),e.brokenExcludedLogicalDB=e.brokenExcludedLogicalDB.concat(o.brokenExcludedLogicalDB)),e.brokenProximity&&o.brokenProximity&&(e.brokenProximity=e.brokenProximity.concat(o.brokenProximity),e.brokenLogicalDB=e.brokenLogicalDB.concat(o.brokenLogicalDB))):(o.fromSpec=n._specificationToRepair[i],s.repairFilterInfo=o)}}))})),v(c,n._specificationToRepair)})):v(c,n._specificationToRepair)}else i(l.status)}))}}))},_checkBrokenPathByConfig:function(e,t){var n=this;let s=function(e,t){let s=[];return new i((i=>{var a=[];if(e.forEach((function(e){e.addedNodesList&&e.addedNodesList.forEach((e=>{a.push(e)})),e.excludedNodesList&&e.excludedNodesList.forEach((e=>{a.push(e)})),e.proximityPath&&e.proximityPath.forEach((e=>{a.push(e)}))})),a.length){let e=[];a.forEach((t=>{let i=t.length,n=[];for(let e=1;e<i;e+=2)n.push({name:"physicalId",value:t[e]});e.push({path:[{attributes:n}]})}));let d=n.options.options;o.authenticatedRequest(r.getConfigFilterValidationUrl(d.pfServiceId),{headers:l.getRESTHeaders(d.securityContext),method:"POST",type:"json",proxy:"passport",data:JSON.stringify({version:"1.0",detailedResults:"no",filter:{format:"bin",value:t},occurrences:{paths:e}}),onComplete:function(e){e.occurrences.paths.forEach(((e,t)=>{"invalid"===e.status&&s.push(t)})),i(s)},onFailure:function(e,t){console.log(" => Chack Config Filter failed, error ("+t.errorID+") = "+t.errorMessage),i([])}})}else i([])}))};var a=[];let d=e.length;return t.forEach(((t,i)=>{let n=e&&d>i?e[i]:[];t&&t.config_filter?a.push(s(n,t.config_filter)):a.push(s([]))})),i.allSettled(a).then((function(e){let t=[];return e.forEach((e=>{t.push(e.value)})),t}))},_checkForBrokenPath:function(e){var t=this;return new i((function(i){var n=[];e.forEach((function(e){e.addedNodesList&&(n=n.concat(e.addedNodesList.flat())),e.excludedNodesList&&(n=n.concat(e.excludedNodesList.flat())),e.proximityPath&&(n=n.concat(e.proximityPath.flat()))})),n.length?(n=[...new Set(n)],r.executeFetchLogicalID(n,t.options.pfServiceId).then((function(e){e.results.length===n.length?i({status:"PathsOK",validIDs:e}):i({status:"PathsKO",validIDs:e})}))):i({status:"PathsOK"})}))},createJSONForRepairWebservice:function(){var e=function(e,t){var i=[];return e.forEach(((e,n)=>{var o=e[0],s=[];o.forEach(((e,i)=>{var o=e,a=!1,d={};if(l.forEach((e=>{var t=e.attributes.findIndex((e=>"resourceid"===e.name));if(o===(-1!==t?e.attributes[t].value:"")){var i=e.attributes,n="",s="",l="",c="",u="",h="",p="";let t="";i.forEach((function(e){var i=e.value;"types/PLMCoreReference"===i?n="PLMCoreReference":"reltypes/PLMCoreInstance"===i?n="PLMCoreInstance":"types/3DShape"===i?n="3DShape":"reltypes/PLMCoreRepInstance"===i?n="PLMCoreRepInstance":"types/PLMCoreRepReference"===i&&(n="PLMCoreRepReference");var o=e.name;"resourceid"===o?l=e.value:"logicalid"===o?s=e.value:"ds6w:label"===o?c=e.value:"type_icon_url"===o?u=e.value:"preview_url"===o?p=e.value:"type"===o?h=e.value:"ds6wg:revision"===o&&(t=e.value)})),d={coretype:n,logicalid:s,name:t?r.getRootTitle(c,t):"",physicalid:l,type_icon_url:u,preview_url:p,trueType:h},a=!0}})),a)s.push(d);else{let e=t&&t[n]&&t[n].length?t[n][i]:void 0;e=e||o,d={coretype:"PLMCoreInstance",logicalid:e,name:"",physicalid:e},s.push(d)}})),i.push(s)})),i};let t=[],i=[];for(var n=0;n<this._toFeedUI.length;n++){var o=this._toFeedUI[n].repairFilterInfo;if(o){var s=[],a=[],l=o.allPathsInfo.results,d=o.brokenAddedNodes;if(d&&d.length>0){var c=o.brokenAddedLogicalDB;s=s.concat(e(d,c))}var u=o.brokenExcludedNodes;if(u&&u.length>0){var h=o.brokenExcludedLogicalDB;s=s.concat(e(u,h))}var p=o.brokenProximity;if(p&&p.length>0&&p[0].length>0){var _=o.brokenLogicalDB;s=s.concat(e(p,_))}a.push({added:d?d.length:-1,excluded:u?u.length:-1,proximity:p?p.length:-1}),t.push({paths:s,dispatch:a}),i=i.concat(s)}}return{pathsPerSpec:t}},_repairFilter:function(e){var t=this;if("CancelRepair"==e.listOfList)t._displayFilterPanel(!0);else if(t._displayFilterPanel(!0),t._removeInvalidPaths(e.listOfList),e.listOfList.length>0){var i=[];e.listOfList.forEach((function(e){i=i.concat(e.flat())})),1===(i=[...new Set(i)]).length&&"null"===i[0]||r.executeFetchLogicalID(i,t.options.pfServiceId).then((function(i){var n=i.results,o=[];o.push(e.listOfList),o.push(n);var s={data:o};t.dispatchEvent("RepairFilter_UpdatetUI",s)}))}else{t.dispatchEvent("RepairFilter_UpdatetUI",{data:[[],[]]})}},_removeInvalidPaths:function(e){for(var t=e.length-1;t>=0;t--){-1==e[t].indexOf("null")&&0!=e[t].length||e.splice(t,1)}},_displayFilterPanel:function(e){var t=this.options.options?this.options.options.UXId:void 0;r.showFilterContainer(t,e)},_getProximityPath:function(e){for(var t=[],i=e.allVolumes||[],n=i.length,o=0;o<n;o++){var s=i[o];if(s.allVolumes){var r=this._getProximityPath(s);t=t.concat(r)}else s&&s.parameters&&"proximity"===s.parameters.type&&t.push(s.parameters.root_path_physicalid[0])}return t}})})),define("DS/ENONextGenFilterUX/utils/FilterCollectionServices",["UWA/Class","UWA/Core","UWA/Class/Options","DS/ENOFilterBIUX/NGFServices","DS/ENONextGenFilterUX/collections/FilterUIGlobalFilterCollection","DS/ENONextGenFilterUX/collections/FilterUIGroupCollection","DS/ENONextGenFilterUX/models/GlobalFilterModel","DS/ENONextGenFilterUX/models/GroupModel","DS/ENONextGenFilterUX/models/CriterionModel","DS/ENOFilterBIUX/FBIServices"],(function(e,t,i,n,o,s,r,a,l,d){"use strict";return e.singleton(i,{init:function(){},buildCVQueryFromModel:function(e){var t=this._buildCVQueryFromModel(e);return e.filterCVQuery===t||n.isDebugActive("ngf")&&(console.log("---------------------------------------  buildCVQueryFromModel  ----------------------------------------"),console.log("filterCVQuery = "+e.filterCVQuery),console.log(" "),console.log("Computed filterCVQuery = "+t),console.log("------------------------------------------------------------------------------------------------------")),e.filterCVQuery=t,t},_buildCVQueryFromModel:function(e){var t=this,i=n.getFilterUIComponents(e),d=i.length,c=new r({state:"init"}),u=new o(null,{model:c}),h=i[0];c.set("combinationOfSpecification",h.toFeedUI.combinationOfSpecification),c.set("minusIndex",h.toFeedUI.minusIndex),c.set("keepChildren",h.toFeedUI.keepChildren||!0),c.set("specVersion",h.toFeedUI.specVersion||n.getCurrentSpecificationVersion());for(var p=1;p<d;p++){var _=i[p],m=new s([],{});let e=new a({groupCollection:m});u.add(e),e.setActivated(_.isActivated||"1");for(var f=_.toFeedUI,g=f.length,v=0;v<g;v++){var b,C=f[v],y=C.criteriaType;if("config"===y||"tag"===y)b=new l,Object.keys(C).forEach((function(e){var t="null"===C[e]?"":C[e];b.set(e,t)})),b.get("isActivated")||b.set("isActivated","1");else if("context"===y){b=new l,Object.keys(C).forEach((function(e){var t="null"===C[e]?"":C[e];b.set(e,t)})),void 0===b.get("addedNodesList")&&b.set("addedNodesList",[]),void 0===b.get("excludedNodesList")&&b.set("excludedNodesList",[]),void 0===b.get("AddNodeActivated")&&b.set("AddNodeActivated",!0),void 0===b.get("ExcludeNodeActivated")&&b.set("ExcludeNodeActivated",!0)}else if("attribute"===y){b=new l,Object.keys(C).forEach((function(e){if("allAttributes"===e){var i=t._buildForComplexAttribute(e,C[e]);b.set(e,i)}else{var n="null"===C[e]?"":C[e];b.set(e,n)}})),b.get("isActivated")||b.set("isActivated","1"),void 0===b.get("Keep")&&b.set("Keep",!0),b.get("extension")||b.set("extension","")}else if("volume"===y){b=new l,Object.keys(C).forEach((function(e){if("allVolumes"===e){var i=t._buildForComplexVolume(e,C[e]);b.set(e,i)}else{var n="null"===C[e]?"":C[e];b.set(e,n)}})),b.get("isActivated")||b.set("isActivated","1")}else if("Sequence"===y){var F=new s([],{});if(b=new a({subGroupCollection:F}),"attribute"===C.sequenceType)Object.keys(C).forEach((function(e){if("allAttributes"===e){var i=t._buildForComplexAttribute(e,C[e]);void 0===i[0].get("Keep")&&i[0].set("Keep",!0),b.get("subGroupCollection").add(i)}else{var n="null"===C[e]?"":C[e];b.set(e,n)}}))}b&&m.add(b)}}var I=c.get("keepChildren"),A=e.rootPhysicalId;return u._buildCVQuerySync(A,I)},_buildForComplexAttribute:function(e,t){for(var i=[],n=t.length,o=0;o<n;o++){var s=t[o],r=new l,a=Object.keys(t[o]),d=this;a.forEach((function(t){if(e===t){var i=d._buildForComplexAttribute(t,s[t]);r.set(t,i)}else{var n="null"===s[t]?"":s[t];r.set(t,n)}})),i.push(r)}return i},_buildForComplexVolume:function(e,t){for(var i=[],n=t.length,o=0;o<n;o++){var s=t[o],r=new l,a=Object.keys(t[o]),d=this;a.forEach((function(t){if(e===t){var i=d._buildForComplexVolume(t,s[t]);r.set(t,i)}else{var n="null"===s[t]?"":s[t];r.set(t,n),r.get("isActivated")||r.set("isActivated","1")}})),i.push(r)}return i}})})),define("DS/ENONextGenFilterUX/utils/AttributeChecker",["UWA/Class","UWA/Core","UWA/Class/Options","DS/Controls/ComboBox","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENOFilterBIUX/FBISettings","DS/ENONextGenFilterUX/utils/FilterUIService"],(function(e,t,i,n,o,s,r){"use strict";var a="equals",l="notEqual",d="contains",c="notContains",u="startsWith",h="endsWith",p="lowerThan",_="greaterThan",m="strictlyLowerThan",f="strictlyGreaterThan",g="between",v="before",b="after",C="strictlyBefore",y="strictlyAfter",F="isEmpty",I="isNotEmpty",A=o.get(a),S=o.get(l),E=o.get(d),N=o.get(c),w=o.get(u),x=o.get(h),T=o.get(p),V=o.get(_),D=o.get(m),O=o.get(f),U=o.get(g),G=(o.get("notBetween"),o.get("on")),M=o.get(v),R=o.get(b),L=o.get(C),P=o.get(y),k=o.get(F),B=o.get(I);return e.singleton(i,{init:function(){},getAttributeOperators:function(e,t){var i;switch(t.type){case"string":i={elementsList:[{labelItem:A,valueItem:a},{labelItem:S,valueItem:l},{labelItem:E,valueItem:d},{labelItem:N,valueItem:c},{labelItem:w,valueItem:u},{labelItem:x,valueItem:h}],selectedIndex:2};break;case"boolean":case"enumeration":i={elementsList:[{labelItem:A,valueItem:a}],selectedIndex:0};break;case"real":case"integer":i={elementsList:[{labelItem:A,valueItem:a},{labelItem:T,valueItem:p},{labelItem:V,valueItem:_},{labelItem:D,valueItem:m},{labelItem:O,valueItem:f},{labelItem:U,valueItem:g}],placeholder:o.get("selectOp"),selectedIndex:0};break;case"dateTime":case"timestamp":i={elementsList:[{labelItem:G,valueItem:"on"},{labelItem:R,valueItem:b},{labelItem:P,valueItem:y},{labelItem:M,valueItem:v},{labelItem:L,valueItem:C},{labelItem:U,valueItem:g}],placeholder:o.get("selectOp"),selectedIndex:0}}return 1===(s.getOption("enableEmptyOperator")||0)&&i.elementsList.push({labelItem:k,valueItem:F},{labelItem:B,valueItem:I}),i.domId="attrOp",i.touchMode=r.TOUCH_MODE,i.enableSearchFlag=!1,new n(i)},getForbiddenCharacter:function(e,t,i){var n=[];if("string"===e)n=r.NOT_ALLOWED.forAttributeValue;return n},checkOperatorAndValue:function(e,t,i,n){var o=!0,s="",r=this.getForbiddenCharacterAsRegExp(e,t,n);if("string"===e){for(var a,l=RegExp(r,"g");null!==(a=l.exec(i));)s+=a[0];o=!s.length}return{isValid:o,forbidden:s}},getForbiddenCharacterAsRegExp:function(e,t,i){var n="\0$",o=this.getForbiddenCharacter(e,t,i);if(o.length){n="[\\"+o.join("\\")+"\\u0000-\\u001F]"}return n}})})),define("DS/ENONextGenFilterUX/views/WelcomePageFilterView",["UWA/Class","UWA/Class/View","UWA/Core","DS/WebappsUtils/WebappsUtils","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Controls/Button","DS/Controls/TooltipModel","text!DS/ENONextGenFilterUX/templates/welcomePageViewTemplate.html","DS/Handlebars/Handlebars4","DS/ENONextGenFilterUX/utils/FilterUIService"],(function(e,t,i,n,o,s,r,a,l,d){"use strict";return t.extend({domEvents:{},setup:function(e){this._template=l.compile(a),this._rootID=e.rootID,this._rootAlias=e.rootAlias,this._rootRevision=e.rootRevision,this.render()},render:function(){this.container.setContent(this._template({filterOnRoot:o.get("OpenFilter"),newFilter:o.get("NewFilter"),newFilterFromExisting:o.get("NewFilterFromExisting")}));var e=this.getElement("#WelcomePageNGF-RetrieveFilter");return this._createOpenFilterUI(e),e=this.getElement("#WelcomePageNGF-NewFilter"),this._createAddCriterionUI(e),e=this.getElement("#WelcomePageNGF-NewFilterFromExisting"),this._createFromExistingUI(e),this},_createAddCriterionUI:function(e){var t=e.getElement(".welcomepage-action-container");this.options.contextUsed&&this._createAddCriterionButton("context",t),this.options.attributeUsed&&this._createAddCriterionButton("attribute",t),this.options.configUsed&&this._createAddCriterionButton("config",t),this.options.volumeUsed&&this._createAddCriterionButton("volume",t)},_createAddCriterionButton:function(e,t){var i,a,l,d;switch(e){case"attribute":i="add_attr_criterion",a=o.get("addAttributeCriterionHmPg"),l=o.get("addAttributeCriterionTooltip"),d=n.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterAddAttribute.png");break;case"config":i="add_config_criterion",a=o.get("addConfigurationCriterionHmPg"),l=o.get("addConfigurationCriterionTooltip"),d=n.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterAddConfiguration.png");break;case"volume":i="add_volume_criterion",a=o.get("addVolumeCriterionHmPg"),l=o.get("addVolumeCriterionTooltip"),d=n.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterAddVolume.png");break;case"context":i="add_context_criterion",a=o.get("addContextCriterionHmPg"),l=o.get("addContextCriterionTooltip"),d=n.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterAddSelection.png")}var c=new s({touchMode:!0,displayStyle:"normal",showLabelFlag:!0,domId:i,label:a,icon:d});c.inject(t),c.getContent().addClassName("welcomepage-button"),c.tooltipInfos=new r({shortHelp:l,mouseRelativePosition:!0});var u=this;return c.addEventListener("click",(function(t){u.dispatchEvent("NGF_WLC_AddCriterion",{type:e})})),c},_createOpenFilterUI:function(e){var t=e.getElement(".welcomepage-action-container");this._createSearchButton(d.FILTER_RELATED_TO_ROOT,t)},_createFromExistingUI:function(e){var t=e.getElement(".welcomepage-action-container");this._createSearchButton(d.FILTER_RELATED_TO_ALL_REVISIONS,t).disabled="3DSpace"!==this.options.pfServiceId,this._createSearchButton("AnyFilter",t)},_createSearchButton:function(e,t){var a,l,c,u,h=d.getRootTitle(this._rootAlias,this._rootRevision);switch(e){case d.FILTER_RELATED_TO_ROOT:a="Search_On_Root",l=i.String.format(o.get("SearchOnRoot"),h),c=i.String.format(o.get("SearchOnRootTooltip"),h),u=n.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterOpenFilter.png");break;case d.FILTER_RELATED_TO_ALL_REVISIONS:a="Search_On_All_Revisions",l=i.String.format(o.get("SearchOnAllRevisions"),h),c=i.String.format(o.get("SearchOnAllRevisionsTooltip"),h),u=n.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterCopyFilter.png");break;case"AnyFilter":a="Search_Any",l=o.get("SearchAny"),c=o.get("SearchAnyTooltip"),u=n.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterCopyFilter.png")}var p=new s({touchMode:!0,displayStyle:"normal",showLabelFlag:!0,domId:a,label:l,value:a,icon:u});p.inject(t),p.getContent().addClassName("welcomepage-button"),p.tooltipInfos=new r({shortHelp:c,mouseRelativePosition:!0});var _=this;return p.addEventListener("buttonclick",(function(e){"Search_On_Root"===e.dsModel.value?_.dispatchEvent("NGF_WLC_RetrieveFilter",{type:d.FILTER_RELATED_TO_ROOT,rootIDs:[_._rootID]}):"Search_On_All_Revisions"===e.dsModel.value?_.dispatchEvent("NGF_WLC_RetrieveFilter",{type:d.FILTER_RELATED_TO_ALL_REVISIONS,rootIDs:[_._rootID]}):"Search_Any"===e.dsModel.value&&_.dispatchEvent("NGF_WLC_RetrieveFilter",{type:d.FILTER_RELATED_TO_ANY_ROOT,query:"[ds6w:type]:ENOStrRefinementSpecification"})})),p}})})),define("DS/ENONextGenFilterUX/views/AttributeView",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Date","DS/Controls/DatePicker","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENONextGenFilterUX/utils/AttributeChecker","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/SpinBox","DS/Controls/Button","DS/Controls/TooltipModel","DS/ENOFilterBIUX/FBISettings","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WUXAutoComplete/AutoComplete","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/ENOFilterBIUX/NGFServices"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h,p,_,m,f,g,v){"use strict";return t.extend({domEvents:{},tagName:"div",className:"attr-edit-inputs-Attribute-Master",setup:function(e){this._widgetId=e.widgetId,this.idAttr=e.idAttr,this.selectedType=e.selectedType,this.selectedExtension=e.selectedExtension,this.attributes=e.xAttributes||[],this._synthesisState=e.synthesisState,this.model.set("attrSetId",e.attrSetId),this._isMultiSelActivated=p.getOption("attribute_MultiSelOnValue",0),this._maxSuggestedValue=p.getOption("attribute_MaxSuggestedValue",100),this._maxSuggestedValue=Number.MAX_VALUE,this._displayTimeInDate=!!s.isTimeInDateActivated(),this._isMigrateToAutoComplete=s.isMigrateToAutoComplete(),this._historicIcon="navigation-history",this._custoIcon="pencil",this._updateMRUMode=0,this._mruPropertyAttributes="attributes",this._mruPropertySearchEditor="searchEditor",this._separatorMRU={labelItem:"",iconItem:{iconName:"list"}},this.displayRemoveButton=e.displayRemoveButton,this._disableAddGroupButton=e.disableAddGroupButton,this._lastSelectedIndex=-1,this._attrDiv=this.getContent(),this._attrDiv.id=this._getId(),this.container.addEvent("click",(function(e){return e.stopPropagation(),!1})),this._isAttrBeingEdited=!1,this._isOperatorBeingEdited=!1,this._hierarchicalItems=[],this._isHierachicalTag=0},render:function(){s.isEasyAttributeDisplayMode()&&this.getContent().setAttribute("filter-easy-attribute",""),this._cmdDiv=e.createElement("div",{class:"attribute-edit-command"}),this._cmdDiv.inject(this._attrDiv);var t=this._cmdDiv;return this.selectedType&&this.attributes&&this._createAttributeUI(),this._addAttributeBtn=this._createAddAttributeButton(t),this.displayAddButtons||this._addAttributeBtn.hide(),this._addAttributeGroupBtn=this._createAddAttributeGroupButton(t),this.displayAddGroupButtons||this._addAttributeGroupBtn.hide(),this._addAttributeGroupBtn.disabled=!!this._disableAddGroupButton,this._addAttributeGroupBtn.active=!this._addAttributeGroupBtn.disabled,this._removeAttributeBtn=this._createRemoveAttributeButton(t),this.displayRemoveButton,this},_getId:function(e){return"attribute_"+(void 0===e?this.idAttr:e)},_cleanAttributes:function(){this.attributeCombo&&(this.attributeCombo.elements.container.remove(),delete this.attributeCombo,this._anyObjectAttrType&&this._anyObjectAttrTypeAnchor.setText(""),this._cleanOperator())},_cleanOperator:function(){this.opCombo&&this.opCombo.elements&&(this.opCombo.elements.container.remove(),delete this.opCombo,this._anyObjectAttrOp&&this._anyObjectAttrOpAnchor.setText(""),this._cleanAttrValuation())},_createAttributeUI:function(){var e=this;e._cleanAttributes(),e.attributeCombo=e._buildAndFeedCombo("attribute",e.attributes,e.idAttr),v.isActivated("easyAttribute")&&!e._anyObjectAttrType&&(e._anyObjectAttrType=e._buildEasyUI("type",e.attributeCombo.label,e.attributeCombo),e._anyObjectAttrTypeAnchor=e._anyObjectAttrType,s.isEasyAttributeDisplayMode()&&!1!==e._isAttrBeingEdited||e._anyObjectAttrType.hide()),this._isMigrateToAutoComplete?e.attributeCombo.addEventListener("change",this._onSelectAttribute.bind(this)):e.attributeCombo.addEventListener("change",this._onSelectAttributeFromCombo.bind(this))},_onSelectAttribute:function(e){var t=this;t._badCharInValue&&(t._badCharInValue.remove(),t._badCharInValue=void 0);var i=e.dsModel.selectedItems;i?[i].forEach((function(i){var n=i.getAttributeValue("label"),o=t.keepAttrInfosFromLabel[n];if(o){if(!t.model.get("attribute")){var r=o.rangeValues?o.rangeValues.literalInfo:void 0,a=r&&r.length?" / enum":"";v.setUsageTracker(t._widgetId,"NGF-Attribute-Type",o.type+a)}t.model.set("attribute",o),t.model.set("nlsAttribute",n),s.isEasyAttributeDisplayMode()&&!1===t._isAttrBeingEdited&&(e.target.hide(),t._anyObjectAttrType&&t._anyObjectAttrTypeAnchor.show()),t._anyObjectAttrType&&t._anyObjectAttrTypeAnchor.setText(n),t.buildAttrOperator(n,o),t.dispatchEvent("NGF_AttributeSelected",{attrSetId:t._attrSetId})}else t._cleanOperator(),t.model.set("attribute",""),t.model.set("nlsAttribute","")})):(t._cleanOperator(),t.model.set("attribute",""),t.model.set("nlsAttribute",""))},_onSelectAttributeFromCombo:function(e){var t=this;if(t._badCharInValue&&(t._badCharInValue.remove(),t._badCharInValue=void 0),1!==t._getMRUMode()){var i=t.attributeCombo.elementsList[e.dsModel.selectedIndex];if(i&&t._separatorMRU.labelItem===i.labelItem&&t._separatorMRU.iconItem.iconName===i.iconItem.iconName)t._setMRUMode(1),t.attributeCombo.selectedIndex=t._lastSelectedIndex,t._setMRUMode(0);else{t._lastSelectedIndex=e.dsModel.selectedIndex;var n=e.dsModel.label,o=t.keepAttrInfosFromLabel[n];if(o){if(!t.model.get("attribute")){var r=o.rangeValues?o.rangeValues.literalInfo:void 0,a=r&&r.length?" / enum":"";v.setUsageTracker(t._widgetId,"NGF-Attribute-Type",o.type+a)}t.model.set("attribute",o),t.model.set("nlsAttribute",n),s.isEasyAttributeDisplayMode()&&!1===t._isAttrBeingEdited&&(e.target.hide(),t._anyObjectAttrType&&t._anyObjectAttrTypeAnchor.show()),t._anyObjectAttrType&&t._anyObjectAttrTypeAnchor.setText(n),t.buildAttrOperator(n,o),t.dispatchEvent("NGF_AttributeSelected",{attrSetId:t._attrSetId})}else t._cleanOperator(),t.model.set("attribute",""),t.model.set("nlsAttribute",""),t.attributeCombo.selectedIndex=-1}}},buildAttrOperator:function(e,t){var i=this,n=t.type,o=t.rangeValues||[];this._cleanOperator(),this.opCombo=a.getAttributeOperators(this.model,t),this.opCombo.inject(this._cmdDiv,"before"),this.opCombo.getContent().addClassName("filter-anyobject-off");var r=this.opCombo.value,l=this.opCombo.label;(this._anyObjectAttrOp?this._anyObjectAttrOpAnchor.setText(l):v.isActivated("easyAttribute")&&(this._anyObjectAttrOp=this._buildEasyUI("operator",l,this.opCombo),this._anyObjectAttrOpAnchor=this._anyObjectAttrOp,s.isEasyAttributeDisplayMode()||this._anyObjectAttrOp.hide()),s.isEasyAttributeDisplayMode())&&(!0===this._isOperatorBeingEdited?this._anyObjectAttrOp:this.opCombo).hide();return r&&(this.model.set("attrOp",r),this.model.set("nlsAttrOp",l),this._buildAttrValue(n,o,r,!0)),this.opCombo.addEventListener("change",(function(e){var t=i.model.get("attrOp"),s=e.dsModel.value,r=e.dsModel.label;i.model.set("attrOp",s),i.model.set("nlsAttrOp",r),i._anyObjectAttrOp&&i._anyObjectAttrOpAnchor.setText(r);var a=!1;("between"!==t&&"between"===s||"between"===t&&"between"!==s)&&(a=!0),i._buildAttrValue(n,o,s,a,undefined)})),this.opCombo},_cleanAttrValuation:function(){var e=this._attrDiv,t=[];this.attrValuation?t=["attrValue"]:this.attrValuation1&&(t=["attrValue_1","attrValue_2"]);var i=this;t.forEach((function(t){var n="#"+t,o=i.getContent().getElement(n);if(o){try{e.removeChild(o)}catch(t){t.message;try{e.removeChild(o)}catch(e){e.message}}i.model.set(t,void 0)}})),this.attrValuation=null,this.attrValuation1=null,this.attrValuation2=null,this._anyObjectAttrValue&&this._anyObjectAttrValueAnchor.setText("")},_buildAttrValue:function(e,t,i,n,o){var a=this;if(-1!==["isEmpty","isNotEmpty"].indexOf(i))this.attrValuation?this.attrValuation.getContent().hide():this.attrValuation1&&(this.attrValuation1.getContent().hide(),this.attrValuation2.getContent().hide()),this._EmptyOperator=!0;else if(this._EmptyOperator&&(this._EmtyOperator=!1,n=!0),void 0===n||n){switch(this._cleanAttrValuation(),e){case"string":if(0===a._isEnumeration(t,o))if(s.isSearchEditorForAllActive()){var l=t;Array.isArray(t)&&(l={editable:!0,literalInfo:t}),this.attrValuation=this._buildEnumComboBox(e,"attrValue",l,o)}else{this.attrValuation=new d({touchMode:s.TOUCH_MODE,placeholder:r.get("placeHolderAttrValue"),domId:"attrValue"}),this.attrValuation.inject(this._cmdDiv,"before"),o&&(this.attrValuation.value=o,this.model.set("attrValue",o));var c=(l=t.literalInfo?t.literalInfo:t)?l.length:0;this._maxSuggestedValue<c&&this.attrValuation.getContent().addClassName("max-suggested-value"),this.attrValuation.addEventListener("change",(function(e){var t=(e.dsModel.value,e.dsModel.value);t=void 0!==t?t:void 0,a.model.set("attrValue",t)})),this.attrValuation.addEventListener("uncommittedChange",(function(t){var i=t.dsModel.valueToCommit;if(void 0!==i){var n=a.opCombo.value;a._checkForbiddenCharacter(e,n,i)}}))}else this.attrValuation=this._buildEnumComboBox(e,"attrValue",t,o);break;case"boolean":this.attrValuation=this._buildEnumComboBox(e,"attrValue",t,o);break;case"integer":case"real":-1!==i.indexOf("between")?(this.attrValuation1=this._buildNumSection(e,"attrValue_1",t,o?o[0]:void 0),this.attrValuation2=this._buildNumSection(e,"attrValue_2",t,o?o[1]:void 0)):this.attrValuation=this._buildNumSection(e,"attrValue",t,o);break;case"dateTime":case"timestamp":this._displayTimeInDate=!s.isTimeInDateActivated()||"on"!==i,"between"===i?(this.attrValuation1=this._buildDateSection("attrValue_1",i,o?o[0]:void 0),this.attrValuation2=this._buildDateSection("attrValue_2",i,o?o[1]:void 0)):this.attrValuation=this._buildDateSection("attrValue",i,o)}this.attrValuation?(this.attrValuation.getContent().addClassName("filter-anyobject-off"),s.isEasyAttributeDisplayMode()&&this.attrValuation.getContent().focus()):this.attrValuation1&&(this.attrValuation1.getContent().addClassName("filter-anyobject-off"),this.attrValuation2.getContent().addClassName("filter-anyobject-off"),s.isEasyAttributeDisplayMode()&&this.attrValuation1.getContent().focus())}else switch(e){case"string":if(0===a._isEnumeration(t,o)){i=a.opCombo.value;var u=a.attrValuation.value;a._checkForbiddenCharacter(e,i,u)}break;case"dateTime":case"timestamp":this._cleanAttrValuation(),this._displayTimeInDate=!s.isTimeInDateActivated()||"on"!==i,"between"===i?(this.attrValuation1=this._buildDateSection("attrValue_1",i,o?o[0]:this._currentDateTime),this.attrValuation2=this._buildDateSection("attrValue_2",i,o?o[1]:this._currentDateTime)):this.attrValuation=this._buildDateSection("attrValue",i,o||this._currentDateTime)}},_isEnumeration:function(e,t){var i=e.literalInfo?e.literalInfo:e,n=i?i.length:0,o=0;return 0===(this._maxSuggestedValue>=n?0:1)&&(o=0===n?t&&Array.isArray(t)?1:o:1),o},_checkForbiddenCharacter:function(t,i,n){for(var o=this,s=a.getForbiddenCharacterAsRegExp(t,i),l=Array.isArray(n)?n:[n||""],d=l.length,c=!1,u=0;u<d;u++)"string"==typeof l[u]&&(c=c||l[u].match(s));if(c){o.attrValuation&&o.attrValuation.getContent().addClassName("attr-edit-inputs-Attribute-Error");var h=a.getForbiddenCharacter(t,i).join(" "),p="<p>"+r.get("BadCharacters")+": "+h+"</p>";o._badCharInValue?(o._badCharInValue.setHTML(p),o._badCharInValue.show()):o._badCharInValue=new e.Element("div",{class:"attr-edit-inputs-Attribute-Error-BadCharacter",html:p}).inject(o.getContent(),"after")}else o.attrValuation&&o.attrValuation.getContent().removeClassName("attr-edit-inputs-Attribute-Error"),o._badCharInValue&&o._badCharInValue.hide();return!!c},_resetTimeOfDate:function(e){var t=new Date(e);return t.setHours(0,0,0,0),t},_buildDateSection:function(e,t,i){var r,a=this;r=i?new n(n.parse(i)):this._resetTimeOfDate(new Date(Date.now()));var l=new o({touchMode:s.TOUCH_MODE,domId:e,timePickerFlag:this._displayTimeInDate,timePickerPrecision:"sec",value:r});function d(t,i){var n;a._currentDateTime=i,n=s.isTimeInDateActivated()&&"on"!==t?(n=a._currentDateTime.toISOString()).substring(0,n.lastIndexOf("."))+"Z":a._currentDateTime.strftime("%F"),a.model.set(e,n)}return l.inject(this._cmdDiv,"before"),d(t,l.value),l.getContent().addEventListener("change",(function(e){d(a.opCombo?a.opCombo.value:"on",e.dsModel.value)})),l},_buildNumSection:function(e,t,i,n){var o;if(0===this._isEnumeration(i,n)){(o=new c({touchMode:s.TOUCH_MODE,domId:t,value:0,stepValue:1,decimals:"integer"===e?0:8,pageStepValue:1})).inject(this._cmdDiv,"before");var r=this;o.addEventListener("change",(function(e){var i=(e.dsModel.value,e.dsModel.value);i=void 0!==i?i:void 0,r.model.set(t,i)})),n&&(o.value=n),this.model.set(t,o.value)}else o=this._buildEnumComboBox(e,t,i,n);return o},_buildAndFeedCombo:function(e,t,i){var n,o=this._buildAttributeDataFrom(t);if(this._isMigrateToAutoComplete){var a=new _({});a.prepareUpdate(),o.items.forEach((e=>{var t=new m({label:e.labelItem,value:e.valueItem,grid:{label:e.labelItem,value:e.valueItem}});e.iconItem&&t.setIcons([e.iconItem.iconName]),a.addChild(t)})),a.pushUpdate();(n=new f({touchMode:s.TOUCH_MODE,domId:"attrType",placeholder:r.get("placeHolderEnterOrSelectAttrValue"),multiSearchMode:!1,elementsTree:a,allowFreeInputFlag:!1,displayCustomNodeInDropDown:!0})).displayLoader=-1===this._synthesisState,n.getContent().addClassName("attributeCriterion-edit-attribute"),n.inject(this._cmdDiv,"before")}else(n=new l({domId:"attrType",touchMode:s.TOUCH_MODE,elementsList:o.items,preselectedIndex:1===o.items.length?0:-1,placeholder:UWA.String.format(r.get("placeHolderSelectEntity"),r.get(e)),autocompleteFlag:!1,generateRegexpString:function(e){return e}})).inject(this._cmdDiv,"before"),n.getContent().addClassName("filter-anyobject-off");return n},_alphabeticSort:function(e,t){var i=0;return void 0!==e&&void 0!==t&&(i=e.labelItem<=t.labelItem?-1:1),i},destroy:function(){this.stopListening(),this.model=null,this._parent(),this.container=null},_buildEnumComboBox:function(e,t,i,n){var o,a=this,d=[],c=!1,u=!1,h=!!s.isSearchEditorActive();"boolean"!==e||void 0!==i&&0!==i.length?(this._isHierachicalTag=0,(T=i.literalInfo?i.literalInfo:i).forEach((t=>{var i;Array.isArray(t.value)&&0===t.isAggregate?(i=t.value.join(s.HIERARCHICAL_ATTR_SEP),this._isHierachicalTag=1):(i=t.value,"integer"!==e&&"real"!==e||(i=Number.isNaN(Number(i))?s.ATTRIBUTE_NOT_VALUATED:Number(i)));var n=t.nlsValue||t.nlsvalue||i,o={valueItem:i,labelItem:Array.isArray(n)?n.join(s.HIERARCHICAL_ATTR_SEP):n};d.push(o)})),c=i.editable||!1,1===this._isMultiSelActivated&&this.opCombo&&"between"!==this.opCombo.value&&(c=!(u=1<d.length)&&c)):(d=[{labelItem:r.get("true"),valueItem:"true"},{labelItem:r.get("false"),valueItem:"false"}],c=!0,h=!1);var p=c?r.get("placeHolderAttrValue"):r.get("placeHolderSelectAttrValue");if(h&&"string"===e||this._isMigrateToAutoComplete&&(u||c)){var g=[],v=this._getMRUProperty(this._mruPropertySearchEditor);if(v&&(v.reverse(),v.forEach((function(e){var t=new m({label:e.label,value:e.value,icons:[{iconName:a._historicIcon}],grid:{label:e.label,value:e.value}});g.push(t)}))),1===a._isHierachicalTag){for(var b=function(e,t,i){for(var n=[],o=0;o<e.children.length;o++){var r=e.children[o].name,l=t+s.HIERARCHICAL_ATTR_SEP+r;A.push(r),S.push(l),n[o]=new m({label:r,value:l,grid:{label:r,value:l}}),i.addChild(n[o]),a._hierarchicalItems.push(l),b(e.children[o],l,n[o])}},C=[],y=0;y<d.length;y++){var F=d[y].valueItem.split(s.HIERARCHICAL_ATTR_SEP);C.push(F)}for(var I=a._arrangeIntoTree(C),A=[],S=[],E=[],N=0;N<I.length;N++){var w=I[N].name;A.push(w),S.push(w),a._hierarchicalItems.push(w),E[N]=new m({label:w,value:w,grid:{label:w,value:w}}),I[N].children.length&&b(I[N],w,E[N]),g.push(E[N])}}else d.forEach((e=>{var t=new m({label:e.labelItem,value:e.valueItem,icons:[],grid:{label:e.labelItem,value:e.valueItem}});g.push(t)}));var x=new _({});x.prepareUpdate(),g.forEach((e=>{1===a._isHierachicalTag?x.addRoot(e):x.addChild(e)})),x.pushUpdate();p=c?r.get("placeHolderEnterOrSelectAttrValue"):p,(o=new f({touchMode:s.TOUCH_MODE,domId:t,placeholder:p,allowFreeInputFlag:!this._isHierachicalTag,multiSearchMode:!0,elementsTree:x,displayCustomNodeInDropDown:!0,getChipInfo:e=>{let t;return a._isHierachicalTag&&(t=e.getAttributeValue("value")),t=void 0!==t?t:o.getDefaultChipInfo(e).label,{label:t}}})).displayLoader=-1===this._synthesisState,1===a._isHierachicalTag&&(o.filterCB=function(e){o.filterItems(e,{filterId:"stringRegexp",filterOptions:{ensureVisible:!0,keepChildren:!0}})}),o.getContent().addClassName("attributeCriterion-edit-attribute-values"),o.inject(this._cmdDiv,"before"),o.addEventListener("change",(function(i){var n=[],o=i.dsModel.elementsTree;if(o){var l=i.dsModel.selectedItems;let t,c=l.length,u=[];for(let e=0;e<c;e++){var d=l[e].getAttributeValue("value");if(d=d||l[e].getAttributeValue("label"),-1!==u.indexOf(d)){t=l[e];break}u.push(d)}if(t)s.displayNotification({level:"info",message:r.get("ValueAlreadySelected")}),t.unselect(),n=u;else{let t=o.getRoots(),i=t.length,s=t.findIndex((function(e){var t=e.getIcons();return!t.length||a._historicIcon!==t[0].iconName}));l.forEach((function(r){var l=r.getAttributeValue("label"),d=r.getAttributeValue("value");let c=d;l=1===a._isHierachicalTag&&void 0!==c?c:l;var u,h=0;if(a._checkForbiddenCharacter(e,a.opCombo.value,d||l))(u=r).setAttribute("value",l);else{if(1!==a._isHierachicalTag){for(var p=-1===s?0:s;p<i;p++)if(t[p].getAttributeValue("label")===l){u=t[p];break}}else for(p=0;p<a._hierarchicalItems.length;p++)if(void 0!==c){if(a._hierarchicalItems[p]===c){u=r,h=1;break}}else if(a._hierarchicalItems[p]===l){u=r;break}if(!u){for(p=0;p<s;p++)if(t[p].getAttributeValue("label")===l){u=t[p];break}if(!u){(u=r).setIcons([{iconName:a._custoIcon}]);let e=u.getLabel(),i=void 0!==c?c:e;u.setAttribute("label",i),u.setAttribute("value",i),1===a._isHierachicalTag?a._hierarchicalItems.push(void 0!==c?e:u.getAttributeValue("value")):o.insertBefore(u,t[s]),delete u.options.customNode}}}var _="";_=1===h&&void 0!==c?c:u.getAttributeValue("value"),n.push(_)}))}}a.model.set(t,n)}))}else(o=new l({domId:t,touchMode:s.TOUCH_MODE,placeholder:p,elementsList:d,enableSearchFlag:c,autocompleteFlag:!1,multiSelFlag:u,_validateOnBlurForTMCAndFilterApp:!0})).inject(this._cmdDiv,"before"),c&&(o.generateRegexpString=function(e){return e}),u&&o.getContent().addClassName("attribute-edit-combo-enum"),o.addEventListener("change",(function(i){var n=(i.dsModel.value,i.dsModel.value);n=void 0!==n?n:void 0;a._checkForbiddenCharacter(e,a.opCombo.value,n);a.model.set(t,n)}));if(n)if(h&&"string"===e){var T=(i=this.model.get("attribute").rangeValues||[]).literalInfo?i.literalInfo:i,V=[];(Array.isArray(n)?n:[n]).forEach((function(e){var t=T.find((function(t){return t.isAggregate&&Array.isArray(e)?e.sort().toString()===t.value.sort().toString():e===t.value}));t?V.push(t.nlsValue||t.nlsvalue):V.push(e)}));var D=o.elementsTree,O=D.getRoots(),U=O.findIndex((function(e){var t=e.getIcons();return!t.length||a._historicIcon!==t[0].iconName}));D.prepareUpdate(),V.forEach((function(e){var t=O.find((function(t,i){return U<i&&t.getAttributeValue("label")===e}));t||(t=O.find((function(t,i){return U>=i&&t.getAttributeValue("label")===e})))||(t=new m({label:e,value:e,icons:[{iconName:a._custoIcon}],grid:{label:e,value:e}}),D.insertBefore(t,O[U])),t.select(!1)})),D.pushUpdate()}else o.value=u?Array.isArray(n)?n:[n]:Array.isArray(n)&&n.length?n[0]:n;return o},_setMRUMode:function(e){this._updateMRUMode=e&&0!==e?1:0},_getMRUMode:function(){return this._updateMRUMode},_updateMRU:function(){var e=this,t=this.selectedType||"",i=e.model.get("nlsAttribute")||"";if(0!==t.length&&0!==i.length){var n=e.model.get("attribute")?e.model.get("attribute").value:"",o={label:i.length?i:n,value:n};this._updateMRUProperty(this._mruPropertyAttributes,o,s.MAX_MRU_VALUE);var r=this.model.get("attribute"),a=this.attrValuation?this.attrValuation.elementsTree:"";if(s.isSearchEditorActive()&&"string"===r.type&&a){var l=r.rangeValues||[],d=l.literalInfo?l.literalInfo:l,c=this.model.get("attrValue")||[];c=Array.isArray(c)?c:[c];var u=[];c.forEach((function(t){var i=d.find((function(i){let n=i.value?i.value:i;return e._isHierachicalTag&&Array.isArray(n)?t.toString()===n.join(s.HIERARCHICAL_ATTR_SEP):t.toString()===n.toString()}));u.push({label:i?i.nlsvalue||i.nlsValue:t,value:t})})),this._updateMRUProperty(this._mruPropertySearchEditor,u,s.MAX_MRU_VALUE)}}},_updateMRUProperty:function(e,t,i){for(var n=Array.isArray(t)?t:[t],o=this._getMRUProperty(e),s=o,r=n?n.length:0,a=0;a<r;a++){var l=o.findIndex((function(e){var t=n[a].value,i=e.value;return t&&i?t.toString()===i.toString():t===i}));if(-1===l){var d={label:n[a].label?n[a].label:n[a].value,value:n[a].value};s.push(d),s.length>i&&s.shift()}else s.push(o[l]),s.splice(l,1)}this._setMRUProperty(e,s)},_getMRUProperty:function(e){var t,i=(JSON.parse(window.localStorage.getItem("NGF_Most-Recent-Used"))||{})[this.selectedType+"_"+(this.selectedExtension?this.selectedExtension:"NoExtension")]||{};if(this._mruPropertyAttributes===e)t=i.attributes||[];else if(this._mruPropertySearchEditor===e){t=(i.searchEditor||{})[this.getAttrParam().name]||[]}return t},_setMRUProperty:function(e,t){var i="NGF_Most-Recent-Used",n=JSON.parse(window.localStorage.getItem(i))||{},o=this.selectedType+"_"+(this.selectedExtension?this.selectedExtension:"NoExtension"),s=n[o]||{};if(this._mruPropertyAttributes===e)s[e]=t;else if(this._mruPropertySearchEditor===e){var r=this.getAttrParam().name;s[e]||(s[e]={});var a=s[e];a[r]||(a[r]={}),a[r]=t}n[o]=s,window.localStorage.setItem(i,JSON.stringify(n))},updateMRUOfAttrCombo:function(){var e=this;if(0!==(this.selectedType||"").length&&this.attributeCombo){if(this._isMigrateToAutoComplete){var t=(v=this.attributeCombo.elementsTree).getRoots();v.prepareUpdate();for(var i=t.findIndex((t=>{var i=t.getIcons();return!i.length||e._historicIcon!==i[0].iconName})),n=i-1;n>=0;n--)v.removeRoot(t[n]);(c=this._getMRUProperty(this._mruPropertyAttributes)).forEach((function(t){var i=new m({label:t.label,value:t.value,icons:[e._historicIcon],grid:{label:t.label,value:t.value}});v.addChild(i,0)})),v.pushUpdate()}else{var o=this.attributeCombo.elementsList.slice(),r=-1!==this.attributeCombo.selectedIndex?o[this.attributeCombo.selectedIndex]:"",a=-1,l=this._separatorMRU.labelItem,d=this._separatorMRU.iconItem.iconName;for(n=0;n<s.MAX_MRU_VALUE+1;n++)if(n<o.length&&l===o[n].labelItem&&d===o[n].iconItem.iconName){a=n;break}var c=this._getMRUProperty(this._mruPropertyAttributes);for(n=0;n<c.length;n++){var u={labelItem:c[n].label,iconItem:{iconName:this._historicIcon}};o.unshift(u)}0<a&&o.splice(c.length,a),this._setMRUMode(1),this.attributeCombo.elementsList=o;var h=-1;for(n=0;n<o.length;n++)if(r.labelItem===o[n].labelItem){h=n;break}this.attributeCombo.selectedIndex=h}var p=this.getAttrParam(),_=this.attrValuation?this.attrValuation.elementsTree:"";if(s.isSearchEditorActive()&&"string"===p.type&&_){var f=this._getMRUProperty(this._mruPropertySearchEditor);if(f){var g=this.model.get("attrValue");g=Array.isArray(g)?g:[g];var v;t=(v=this.attrValuation.elementsTree).getRoots();v.prepareUpdate();i=-1;var b=-1;t.forEach((function(t,n){var o=t.getIcons();i=o.length&&e._historicIcon===o[0].iconName?n:i,b=o.length&&e._custoIcon===o[0].iconName?n:b})),b=i;for(n=Math.max(i,b);n>=0;n--)v.removeRoot(t[n]);this.attrValuation.selectedItems=[],f.forEach((function(t){var i=new m({label:t.label,value:t.value,icons:[{iconName:e._historicIcon}],grid:{label:t.label,value:t.value}});v.addChild(i,0)})),t=v.getRoots(),g.forEach((function(e){var i=t.findIndex((t=>e===t.getAttributeValue("value")));-1!==i&&t[i].select(!1)})),v.pushUpdate()}}}this._setMRUMode(0)},_checkBounds:function(){var e=!0;if(this.model.get("attrValue"));else if(this.model.get("attrValue_1")){var t=this.model.get("attrValue_1")||this.attrValuation1.value,i=this.model.get("attrValue_2")||this.attrValuation2.value;switch(this.model.get("attribute").type){case"string":break;case"integer":case"real":parseFloat(i)<parseFloat(t)&&(e=!1);break;case"dateTime":case"timestamp":new n(i).getTime()<new Date(t).getTime()&&(e=!1)}e||(this.attrValuation1.value=i,this.attrValuation2.value=t,e=!0)}return e},_createAddAttributeButton:function(e){var t=new u(s.getAttributeButtonStyle("plus"));t.inject(e||this._attrDiv),t.tooltipInfos=new h({shortHelp:r.get("AddAttributeTooltip"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attribute-edit-add-btn");var i=this;return t.addEventListener("click",(function(e){i.dispatchEvent("NGF_AddAttribute",{})})),t},_createAddAttributeGroupButton:function(e){var t=new u(s.getAttributeButtonStyle("group-add"));t.inject(e||this._attrDiv),t.tooltipInfos=new h({shortHelp:r.get("AddAttributeGroupTooltip"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attribute-edit-addGroup-btn");var i=this;return t.addEventListener("click",(function(e){i._disableAddGroupButton||i.dispatchEvent("NGF_AddAttributeGroup",{})})),t},_createRemoveAttributeButton:function(e){var t=new u(s.getAttributeButtonStyle("close"));t.inject(e||this._attrDiv),t.tooltipInfos=new h({shortHelp:r.get("RemoveAttribute"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attribute-edit-remove-btn");var i=this;return t.addEventListener("click",(function(e){i._badCharInValue&&(i._badCharInValue.remove(),i._badCharInValue=void 0),i.dispatchEvent("NGF_RemoveAttribute",{attrId:i._getId(),idx:i.idAttr})})),t},attrViewFromMdl:function(e){var t="";if("object"==typeof e){var i=e.attribute?e.attribute.uri:e.uri;if(this.attributeCombo){var n=this.keepAttrInfosFromName[i];this.attributeCombo.value=n||"",t=n?t:i}this.opCombo&&e.attrOp&&(this.opCombo.value=e.attrOp);var o=s.ATTRIBUTE_NOT_VALUATED;if(this.attrValuation&&e.attrValue){let t=[];(Array.isArray(e.attrValue)?e.attrValue:[e.attrValue]).forEach((e=>{if(Array.isArray(e)){let i=[...new Set(e.flat())];t.push(1===i.length?i[0]:e.join(s.HIERARCHICAL_ATTR_SEP))}else t.push(e)})),e.attrValue=[...new Set(t)];var r=e.attrValue;let i=Array.isArray(r)&&1===r.length&&!Array.isArray(r[0])?r[0]:r;this.attrValuation.value=o===i?void 0:i}else this.attrValuation1&&e.attrValue_1||this.attrValuation2&&e.attrValue_2?void 0===this.attrValuation1.value&&void 0===this.attrValuation2.value||(this.attrValuation1&&e.attrValue_1&&o!==e.attrValue_1&&(this.attrValuation1.value=e.attrValue_1),this.attrValuation2&&e.attrValue_2&&o!==e.attrValue_2&&(this.attrValuation2.value=e.attrValue_2)):!this.opCombo||this.opCombo&&"between"!==this.opCombo.value?this.attrValuation&&(this.attrValuation.value=void 0):this.attrValuation1&&(this.attrValuation1.value=void 0,this.attrValuation2.value=void 0)}return t},isAttrValid:function(){for(var e="",t="",i=this.getAttrParam(),n=!1,o=i.values.length,l=r.get("InvalidCharInLabel"),d=0;d<o;d++){var c=Array.isArray(i.values[d])?i.values[d].join(""):i.values[d],u=a.checkOperatorAndValue(i.type,i.op,c,i.synthesisValue);if(!u.isValid){e="InvalidCharInValue",t="' "+u.forbidden+" '  "+l+"  "+i.nlsName+" "+i.nlsOp+" "+i.values[0],n=!0;break}}var h=this._checkBounds();h||("boolean"===i.type?(e="badValueDefinedForBoolean",t=i.nlsName+" "+i.nlsOp+" "+i.values[0]):(e="badValueDefined",t=i.nlsName+" "+i.nlsOp+" "+i.values[0]+" "+i.values[1]));var p={isValid:!n&&h,errorKey:e,errorMsg:t},_=this.getElement("#attrValue")||this.getElement("#attrValue_2");if(p.isValid){if(this._isAttrBeingEdited=!1,this._isOperatorBeingEdited=!1,this._updateMRU(),_&&(_.removeClassName("attr-edit-inputs-Attribute-Error"),this._badCharInValue&&this._badCharInValue.hide()),s.isEasyAttributeDisplayMode()){var m="",f=this.model.get("attribute");if(f){var v=", ",b=this.model.get("attrOp"),C=this.model.get("attrValue");if(b&&"between"===b&&this.attrValuation1&&(C=[this.model.get("attrValue_1"),this.model.get("attrValue_2")],v=" "+r.get("AND").toLowerCase()+" "),C&&(m=g._buildAttributeValue(f.type,C,f.rangeValues,b,v)),this._anyObjectAttrValue);else{var y=this.attrValuation?this.attrValuation:this.attrValuation2;this._anyObjectAttrValue=this._buildEasyUI("value",m,y),this._anyObjectAttrValueAnchor=this._anyObjectAttrValue}this._anyObjectAttrType&&this._anyObjectAttrType.show(),this._anyObjectAttrOp&&this._anyObjectAttrOp.show(),m=""===m?r.get("NoValueEntered"):m,this._anyObjectAttrValueAnchor.setText(m),this._anyObjectAttrValue.hide(),this.attributeCombo.getContent().hide()}this.opCombo&&this.opCombo.getContent().hide()}}else _&&_.addClassName("attr-edit-inputs-Attribute-Error");return p},getAttrParam:function(){var e=[];void 0!==this.model.get("attrValue")?e.push(this.model.get("attrValue")):void 0!==this.model.get("attrValue_1")&&(e.push(this.model.get("attrValue_1")),e.push(this.model.get("attrValue_2")));var t=this.model.get("nlsAttribute")?this.model.get("nlsAttribute"):"",i=this.keepAttrInfosFromLabel[t],n=t.length?i.type:"",o=i&&i.rangeValues?i.rangeValues.editable:void 0;return{type:n,name:this.model.get("attribute")?this.model.get("attribute").value:"",nlsName:t,op:this.model.get("attrOp"),nlsOp:this.model.get("nlsAttrOp"),values:e,synthesisValue:o}},isAttrEmpty:function(){var e=this.model.get("attribute");return void 0===e||""===e},setFocus:function(){!this._isMigrateToAutoComplete&&this.attributeCombo&&this.attributeCombo._getMainElement().focus()},getParams:function(){return{attribute:this.model.get("attribute"),attrOp:this.model.get("attrOp"),attrValue:this.model.get("attrValue"),attrValue1:this.model.get("attrValue_1"),attrValue2:this.model.get("attrValue_2"),attributes:this.attributes,elementsList:this.attributeCombo.elementsList,keepAttrInfosFromLabel:this.keepAttrInfosFromLabel}},setParams:function(e){if(this.attributes=e.attributes,this.keepAttrInfosFromLabel=e.keepAttrInfosFromLabel,this.attributeCombo.elementsList=e.elementsList,void 0===e.attribute)this.attributeCombo.value="";else{for(var t=Object.keys(this.keepAttrInfosFromLabel),i=0;i<t.length;i++)if(e.attribute.label===this.keepAttrInfosFromLabel[t[i]].label){this.attributeCombo.value=t[i];break}this.opCombo&&(this.opCombo.value=e.attrOp),this.attrValuation?(this.attrValuation.value=e.attrValue,this.getElement("#attrValue_1")&&(this.attrEditInputs.removeChild(this.getElement("#attrValue_1")),this.attrEditInputs.removeChild(this.getElement("#attrValue_2")))):void 0!==this.attrValuation1&&(this.attrValuation1.value=e.attrValue1,this.attrValuation2.value=e.attrValue2,this.getElement("#attrValue")&&this.attrEditInputs.removeChild(this.getElement("#attrValue")))}},compareParams:function(e){var t=!1;return t||(e.attribute&&this.model.get("attribute")?this.model.get("attribute").value!==e.attribute.value&&(t=!0):(e.attribute||this.model.get("attribute"))&&(t=!0)),t||(e.attrOp&&this.model.get("attrOp")?this.model.get("attrOp")!==e.attrOp&&(t=!0):(e.attrOp||this.model.get("attrOp"))&&(t=!0)),t||(e.attrValue&&this.model.get("attrValue")?this.model.get("attrValue")!==e.attrValue&&(t=!0):e.attrValue||this.model.get("attrValue")?t=!0:e.attrValue1&&this.model.get("attrValue_1")?this.model.get("attrValue_1")===e.attrValue1&&this.model.get("attrValue_2")===e.attrValue2||(t=!0):(e.attrValue1||this.model.get("attrValue_1"))&&(t=!0)),t},showAddButtons:function(e){e?(this._addAttributeBtn.show(),this._addAttributeGroupBtn.show()):(this._addAttributeBtn.hide(),this._addAttributeGroupBtn.hide())},showRemoveButton:function(e){e?this._removeAttributeBtn.show():this._removeAttributeBtn.hide()},reBuildAttributesInfos:function(e,t){this._synthesisState=t;var i,n,o=this.attributeCombo.value;o&&(i=this.opCombo?this.opCombo.value:i,this.model.get("attrValue")?n=this.model.get("attrValue"):this.model.get("attrValue_1")&&((n=[]).push(this.model.get("attrValue_1")),n.push(this.model.get("attrValue_2"))));var r=this._buildAttributeDataFrom(e);if(this._isMigrateToAutoComplete){var a=this.attributeCombo.elementsTree;a.removeRoots(),a.prepareUpdate(),r.items.forEach((e=>{var t=new m({label:e.labelItem,value:e.valueItem,grid:{label:e.labelItem,value:e.valueItem}});e.iconItem&&t.setIcons([e.iconItem.iconName]),a.addChild(t)})),a.pushUpdate(),1===this._synthesisState&&(this.attributeCombo.displayLoader=!1,this.attrValuation&&(this.attrValuation.displayLoader=!1))}else this.attributeCombo.elementsList=r.items;if(o&&o.length){var l=this.keepAttrInfosFromLabel[o];l?(this.attributeCombo.value=o,this.opCombo.value=i,this._buildAttrValue(l.type,l.rangeValues,i,!0,n)):(this.attributeCombo.value="",s.isEasyAttributeDisplayMode()&&(this._anyObjectAttrType.hide(),this.attributeCombo.show()))}},_buildAttributeDataFrom:function(e){var t=this,i=this._getMRUProperty(this._mruPropertyAttributes);if(s.FILTER_ANY_OBJECT===this.selectedType&&i){let t=((JSON.parse(window.localStorage.getItem("NGF_Most-Recent-Used"))||{})[this.selectedType+"_NoExtension"]||{}).searchEditor||{};i.forEach((i=>{if(!e.find((e=>e.curi===i.value))){let n=t[i.value]||[];n=Array.isArray(n)?n:[n];let o=[];n.forEach((e=>{o.push({nlsvalue:e.label,value:e.value,isAggregate:0})})),e.push({curi:i.value,label:i.label,rangeValues:{editable:!0,literalInfo:o.length?o:void 0}})}}))}var n=this._buildAttributesInfos(e);this.keepAttrInfosFromLabel=n.infosFromLabel||{},this.keepAttrInfosFromName=n.infosFromName||{},this.attributes=e;let o=this.model.get("attribute");if(o){let e=this.keepAttrInfosFromLabel[o.label];e&&(o.rangeValues=e.rangeValues)}var r=[];if(i&&0!==i.length&&(i.reverse(),i.forEach((function(e){var i=t.keepAttrInfosFromName[e.value]||t.keepAttrInfosFromName[e.name];i&&r.push({labelItem:i,iconItem:{iconName:t._historicIcon}})}))),!this._isMigrateToAutoComplete){let e=n.maxItemLength;this._separatorMRU.labelItem="-".repeat(e),r.push(this._separatorMRU)}var a=n.items;return{items:r.concat(a.sort(this._alphabeticSort))}},_buildAttributesInfos:function(e){var t=[],i=0,n={},o={};return e.forEach((function(e){var s;s=e.range&&e.range.dataTypes[0]?e.range.dataTypes[0].split("#")[1]:e.dataTypes?e.dataTypes:e.dataType?e.dataType.split("#")[1]||e.dataType:"string";var r=e.curi||e.uri,a=e.label||e.nlsName||r,l=r,d=1,c=a;if(o[c]){d=0;var u=o[c];if(u&&u.uri!==r){c=u.label+"("+u.uri+")",o[c]={type:u.type,uri:u.uri,label:u.label,value:u.value,rangeValues:u.rangeValues||[]},delete o[a];for(var h=0;h<t.length;h++)if(t[h].labelItem===u.label){t[h].labelItem=c;break}c=a+"("+r+")",d=1}}else o[c]={};1===d&&(o[c]={type:s,uri:r,label:a,value:l,rangeValues:e.rangeValues||[]},n[l]=c,t.push({labelItem:c}),i=Math.max(i,c.length))})),{infosFromLabel:o,infosFromName:n,items:t,maxItemLength:i}},_buildEasyUI:function(t,i,n){var o=this,r=e.createElement("a",{touchMode:s.TOUCH_MODE,class:"innerfiltertypecombo filter-anyobject-on",text:i}),a=r;switch(a.inject(n.getContent(),"after"),t){case"type":r.id="anyObject_attribute",r.addEventListener("click",(function(e){a.hide(),o._isAttrBeingEdited=!0,o._isOperatorBeingEdited=!0,o._anyObjectAttrOp&&o._anyObjectAttrOp.hide(),o._anyObjectAttrValue&&o._anyObjectAttrValue.hide(),o.attributeCombo.show(),o.opCombo.show(),o.attrValuation?o.attrValuation.show():(o.attrValuation1.show(),o.attrValuation2.show())}));break;case"operator":r.id="anyObject_operator",r.addEventListener("click",(function(e){o._isOperatorBeingEdited=!0,a.hide(),o.opCombo.show()}));break;case"value":r.id="anyObject_value",r.addEventListener("click",(function(e){a.hide(),o.attrValuation?o.attrValuation.show():(o.attrValuation1.show(),o.attrValuation2.show())}))}return a},_arrangeIntoTree:function(e){for(var t=function(e,t,i){for(var n=0;n<e.length&&e[n][t]!==i;)n++;return n<e.length&&e[n]},i=[],n=0;n<e.length;n++)for(var o=e[n],s=i,r=0;r<o.length;r++){var a=o[r],l=t(s,"name",a);if(l)s=l.children;else{var d={name:a,children:[]};s.push(d),s=d.children}}return i}})})),define("DS/ENONextGenFilterUX/views/CriteriaTagView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","UWA/Promise","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars4","DS/ENONextGenFilterUX/models/CriterionModel","text!DS/ENONextGenFilterUX/templates/configurationViewTemplate.html","text!DS/ENONextGenFilterUX/assets/ENOStrRefinementUX_require.json","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/FBIServices"],(function(e,t,i,n,o,s,r,a,l,d,c,u){"use strict";return e.extend({className:"tagCriterion",setup:function(e){this._parent(e)},render:function(){return this},isCriterionValidate:function(){return 0===c.isAsynchronousValidation()||new n((function(e){e(!0)}))},viewFromMdl:function(e){var t={};[e.allfilters,e.localfilters].forEach((e=>{if(e)for(var i in e){var n=e[i];if(n.length){var o=i.split("/"),s=o[o.length-1];n.forEach((e=>{t[s]||(t[s]=[]),t[s]=t[s].concat([e.object])}))}}})),Object.keys(t).length&&u.getNlsOfPropertiesValues(t).then((function(t){[e.allfilters,e.localfilters].forEach((e=>{if(e)for(var i in e){var n=e[i];if(n.length){var o=i.split("/"),s=o[o.length-1];n.forEach((e=>{e.disptext=t[s][e.object]}))}}}))}),(function(e){console.log(" ==> Compute tags Nls failed ! Err  = "+e)}))},isThereCriteria:function(){var e=!1,t=this.model.get("tagData");return t&&(Object.keys(t.allfilters).length||Object.keys(t.localfilters).length)&&(e=!0),e}})})),define("DS/ENONextGenFilterUX/views/AttributeCombinationView",["UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Model","DS/ENONextGenFilterUX/views/AttributeView","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/TooltipModel","DS/ENONextGenFilterUX/utils/FilterUIService"],(function(e,t,i,n,o,s,r,a,l,d){"use strict";var c=i.extend({domEvents:{},tagName:"div",className:"attribute-edit-group",setup:function(e){this._widgetId=e.widgetId,this._attrSetId=e.attrSetId||0,this._combinationId=this._attrSetId,this._deepGroup=e.deepGroup||0,this._displayMode=e.displayMode||"light",this._selectedType=e.selectedType,this._selectedSubType=e.selectedExtension,this._attributes=e.attributesUsed,this._initCombination=e.initCombination||0,this._attrEditInputs=e.attrEditInputs,this._synthesisState=e.synthesisState,this._idAttr=0,this._listOfAttributes=[]},render:function(){var t="combinationAttribute_"+this._combinationId;this.container.setAttribute("id",t);var i=this.getContent();this._divCombination=e.createElement("div",{class:"attribute-edit-group-Combination"}),this._divCombination.inject(this._attrEditInputs||i);var n="withAttribute";return this._withLabel=this._createCombinationLabel(n,"with"),this._withLabel.inject(this._divCombination),this._combinationCombo=this._createCombinationCombo(this._initCombination),this._combinationCombo.inject(this._divCombination),this._anyObjectCombination.inject(this._combinationCombo.getContent(),"after"),n="FollowingCombination",this._followingLabel=this._createCombinationLabel(n,"following"),this._followingLabel.inject(this._divCombination),this._removeBtn=this._createRemoveGroupButton(),this._removeBtn.inject(this._divCombination),this._setCombinationDisplayMode(this._displayMode),this.createAttribute(),this},destroy:function(){this.cleanAttributes(),this.stopListening(),this.model=null,this._parent(),this.container=null},_setCombinationDisplayMode:function(e){switch(this._displayMode=e,e){case"none":this._divCombination.hide();break;case"light":this._divCombination.show(),this._withLabel.show(),this._combinationCombo.getContent().addClassName("filter-anyobject-off-display-off"),this._anyObjectCombination.hide(),this._followingLabel.hide(),this._removeBtn.hide();break;case"middle":this._divCombination.show(),this._withLabel.show(),this._combinationCombo.getContent().removeClassName("filter-anyobject-off-display-off"),this._anyObjectCombination.show(),this._followingLabel.show(),this._removeBtn.hide();break;case"full":this._divCombination.show(),this._withLabel.show(),this._combinationCombo.getContent().removeClassName("filter-anyobject-off-display-off"),this._anyObjectCombination.show(),this._followingLabel.show(),this._removeBtn.show()}},createAttribute:function(){this._onAddAttribute()},createAttributeGroup:function(){this._onAddAttributeGroup()},_createCombinationLabel:function(t,i){return e.createElement("label",{class:"innerfiltertypecombo",text:s.get(t),id:"combination-"+i+"_"+this._combinationId})},_createCombinationCombo:function(t){var i=[{labelItem:s.get("AllCombination"),valueItem:"all"},{labelItem:s.get("AnyCombination"),valueItem:"any"}],n=new r({touchMode:d.TOUCH_MODE,elementsList:i,enableSearchFlag:!1,domId:"combination-combo_"+this._combinationId});n.getContent().addClassName("filter-anyobject-off filter-anyobject-off-display-off");var o=this;return n.addEventListener("change",(function(e){var t=e.dsModel.currentValue;o.model.set("combination",t),o._initCombination=e.dsModel.selectedIndex,o._anyObjectCombinationAnchor.setText(s.get("all"===t?"AllCombination":"AnyCombination"))})),this._anyObjectCombination=e.createElement("label",{class:"innerfiltertypecombo filter-anyobject-on"}),this._anyObjectCombinationAnchor=e.createElement("a",{text:n.currentLabel,id:"anyObject_combination"}),this._anyObjectCombinationAnchor.inject(this._anyObjectCombination),this._anyObjectCombinationAnchor.addEventListener("click",(function(e){var t="all"===o.model.get("combination")?"any":"all";o.model.set("combination",t),e.target.setText(s.get("all"===t?"AllCombination":"AnyCombination")),n.currentValue=t})),n.getContent().removeClassName("filter-anyobject-off"),n.hide(),this._anyObjectCombination.removeClassName("filter-anyobject-on"),this._anyObjectCombination.show(),this.model.set("combination",i[t].valueItem),n.selectedIndex=t,n},_createRemoveGroupButton:function(){var e=new a(d.getAttributeButtonStyle("group-delete"));e.tooltipInfos=new l({shortHelp:s.get("RemoveAttributeGroup"),mouseRelativePosition:!0});e.getContent().addClassName("attribute-edit-button-style attribute-edit-group-remove-btn");var t=this;return e.addEventListener("click",(function(e){var i=t.getContent().getAttribute("id");t.dispatchEvent("NGF_Remove_AttributeGroup",{attrId:i})})),e},_createAttribute:function(){var e=this.getContent();0===this._deepGroup&&this._switchDisplayToMultiAttribute("attribute");var t=new n,i=this.model.get("allAttributes")||[];i.push(t),this.model.set("allAttributes",i);var s=new o({model:t,widgetId:this._widgetId,attrSetId:this._attrSetId,idAttr:this._idAttr,selectedType:this._selectedType,selectedExtension:this._selectedSubType,displayRemoveButton:this._attrSetId||this._listOfAttributes.length?1:0,disableAddGroupButton:d.MAX_DEEP_ATTRIBUTE_GROUP===this._deepGroup?1:0,xAttributes:this._attributes,synthesisState:this._synthesisState});this._idAttr+=1,s.render().inject(e),s.setFocus(),this._showAddButtons(!1),this._listOfAttributes.push(s),this._highlightAttributeGroup();var r=this._listOfAttributes.length;if(0!==this._deepGroup){if(2<=r)for(var a=r-2;a>=0;a--)if(!this._isGroup(this._listOfAttributes[a])){this._listOfAttributes[a].showAddButtons(!1);break}this._listOfAttributes[r-1].showAddButtons(!0)}this.listenTo(s,"NGF_AddAttribute",this._onAddAttribute.bind(this)),this.listenTo(s,"NGF_AddAttributeGroup",this._onAddAttributeGroup.bind(this)),this.listenTo(s,"NGF_RemoveAttribute",this._onRemoveAttribute.bind(this)),this.listenTo(s,"NGF_AttributeSelected",this._onSelectedAttribute.bind(this))},_onAddAttribute:function(){this._createAttribute()},_highlightAttributeGroup:function(){var e=window.document.body.getElement(".f-attribute-container.edit");if(e){var t=e.getElement(".attribute-edit-group-selected");t&&t.removeClassName("attribute-edit-group-selected")}0!==this._deepGroup&&this.getContent().addClassName("attribute-edit-group-selected")},_onAddAttributeGroup:function(){var e=this.getContent();0===this._deepGroup&&this._switchDisplayToMultiAttribute("group");var t=new n,i=this.model.get("allAttributes")||[];i.push(t),this.model.set("allAttributes",i),this._attrSetId+=1;var o=new c({model:t,widgetId:this._widgetId,attrSetId:this._attrSetId,selectedType:this._selectedType,selectedExtension:this._selectedSubType,attributesUsed:this._attributes,initCombination:this._initCombination?0:1,displayMode:"full",deepGroup:this._deepGroup+1,synthesisState:this._synthesisState});o.render().inject(e),o._highlightAttributeGroup(),this._showAddButtons(!0),this.listenTo(o,"NGF_Remove_AttributeGroup",this._onRemoveAttribute.bind(this));var s=o._listOfAttributes.length;s&&o._listOfAttributes[s-1].setFocus(),this._listOfAttributes.push(o),0===this._deepGroup&&2===this._listOfAttributes.length&&!this._isGroup(this._listOfAttributes[0])&&this._listOfAttributes[0].isAttrEmpty()&&(this._onRemoveAttribute({attrId:this._listOfAttributes[0].getContent().id}),this._setCombinationDisplayMode("none"))},_showAddButtons:function(e){0===this._deepGroup&&this.dispatchEvent("NGF_DisplayAddActions",{display:e})},_onRemoveAttribute:function(e){for(var t=e.attrId,i=this._listOfAttributes.length-1;i>=0;i--)if(t===this._listOfAttributes[i].container.id){this._removeAttribute(i),1>=this._listOfAttributes.length&&0===this._deepGroup&&this._switchDisplayToSingleAttribute(),0===this._listOfAttributes.length&&(0!==this._deepGroup?this.dispatchEvent("NGF_Remove_AttributeGroup",{attrId:this.getContent().id}):(this._idAttr=0,this._setCombinationDisplayMode("none"),this.createAttribute(),this._switchDisplayToSingleAttribute()));break}var n=this._listOfAttributes.length;if(1<=n){var o=this._listOfAttributes[n-1];this._isGroup(o)||0===this._deepGroup?this._showAddButtons(!1):(o.showAddButtons(!0),this._highlightAttributeGroup())}},_removeAttribute:function(e){for(var t=e||0,i=e+1||this._listOfAttributes.length,n=i-1;n>=t;n--)this._listOfAttributes[n].destroy();this._listOfAttributes.splice(t,i-t);var o=this.model.get("allAttributes");void 0!==o&&o.splice(t,i-t),this.model.set("allAttributes",o)},_onSelectedAttribute:function(e){},_switchDisplayToMultiAttribute:function(e){0===this._listOfAttributes.length?"attribute"===e?this._setCombinationDisplayMode("light"):"group"===e&&(this._divCombination.addClassName("attribute-edit-group"),this.getContent().removeClassName("attribute-edit-group"),this._setCombinationDisplayMode("none"),this.dispatchEvent("NGF_SwitchDisplayContext",{context:1,combination:this._divCombination,view:this})):1!==this._listOfAttributes.length||this._isGroup(this._listOfAttributes[0])?this._setCombinationDisplayMode("middle"):(this._divCombination.addClassName("attribute-edit-group"),this.getContent().removeClassName("attribute-edit-group"),this._listOfAttributes[0].showRemoveButton(!0),this._listOfAttributes[0].showAddButtons(!1),this._setCombinationDisplayMode("middle"),this.dispatchEvent("NGF_SwitchDisplayContext",{context:1,combination:this._divCombination,view:this}))},_switchDisplayToSingleAttribute:function(){if(0===this._listOfAttributes.length)this._divCombination.removeClassName("attribute-edit-group"),this.getContent().addClassName("attribute-edit-group"),this.dispatchEvent("NGF_SwitchDisplayContext",{context:0,view:this});else if(1===this._listOfAttributes.length)if(this._isGroup(this._listOfAttributes[0]))this._setCombinationDisplayMode("none");else{this._divCombination.removeClassName("attribute-edit-group"),this.getContent().addClassName("attribute-edit-group");var e=this._listOfAttributes[0];e.showRemoveButton(!0),e.showAddButtons(!1),this._setCombinationDisplayMode("light"),this.dispatchEvent("NGF_SwitchDisplayContext",{context:0,view:this})}},isAttrValid:function(){for(var e=[],t=this._listOfAttributes.length,i=0;i<t;i++){var n=this._listOfAttributes[i];if(this._isGroup(n))e=n.isAttrValid();else{var o=n.isAttrValid();if(!o.isValid){var s=o.errorKey;void 0===e[s]&&(e[s]=""),e[s]+="<br>   "+o.errorMsg}}}return!d.isEasyAttributeDisplayMode()||"middle"!==this._displayMode&&"full"!==this._displayMode||(this._combinationCombo.getContent().hide(),this._anyObjectCombination.show()),e},_isGroup:function(e){return!!e._listOfAttributes},removeEmptyAttribute:function(){var e=this,t=function(i){for(var n=i._listOfAttributes.length-1;n>=0;n--){var o=i._listOfAttributes[n];e._isGroup(o)?t(o):o.isAttrEmpty()&&i._onRemoveAttribute({attrId:o.getContent().id})}};t(this)},updateMRUOfAttribute:function(){for(var e=this._listOfAttributes.length,t=0;t<e;t++){var i=this._listOfAttributes[t];this._isGroup(i)?i.updateMRUOfAttribute():i.updateMRUOfAttrCombo()}},cleanAttributes:function(){this._divCombination.destroy(),this._removeAttribute()},viewFromMdl:function(e){var t=e.allAttributes,i=[];if(1<t.length||1===t.length&&void 0===t[0].allAttributes){var n={};n.allAttributes=t,n.combination="all",i=this._buildAttributeFromModel(n)}else i=this._buildAttributeFromModel(t[0]);return i},_buildAttributeFromModel:function(e){var t=e.allAttributes;this._combinationCombo.currentValue=e.combination;var i=[];if(void 0!==t)for(var n=t.length,o=0;o<n;o++){if(void 0===t[o].allAttributes){this._listOfAttributes.length<o+1&&this._createAttribute();var s=this._listOfAttributes[o].attrViewFromMdl(t[o]);s&&i.push(s)}else{this._onAddAttributeGroup(),s=this._listOfAttributes[this._listOfAttributes.length-1]._buildAttributeFromModel(t[o]),i=i.concat(s)}}return i},saveBeforeEdit:function(){return this._saveBeforeEdit(this)},_saveBeforeEdit:function(e){for(var t=[],i=e._listOfAttributes.length,n=0;n<i;n++){var o=e._listOfAttributes[n];if(this._isGroup(o)){var s=this.model.get("combination"),r=this._saveBeforeEdit(o);t.push({combination:s,attributes:r})}else t.push({combination:this.model.get("combination"),attributes:o.getParams()})}return t},restoreBeforeEdit:function(e){this._restoreBeforeEdit(this,e)},_restoreBeforeEdit:function(e,t){if(e._removeAttribute(),void 0===t)e.createAttribute();else{for(var i=0;i<t.length;i++)Array.isArray(t[i].attributes)?e._onAddAttributeGroup():e.createAttribute();var n=e._listOfAttributes.length;for(i=0;i<n;i++){var o=e._listOfAttributes[i];this._isGroup(o)?(this.model.set("combination",t[i].combination),this._restoreBeforeEdit(o,t[i].attributes)):(this.model.set("combination",t[i].combination),o.setParams(t[i].attributes))}}},updateAttributes:function(e,t){var i=this;this._synthesisState=t,this._attributes=e;!function(e,t){i._listOfAttributes.forEach((n=>{i._isGroup(n)?n.updateAttributes(e,t):n.reBuildAttributesInfos(e,t)}))}(e,t)},isThereCriteria:function(){return!!this._listOfAttributes.length}});return c})),define("DS/ENONextGenFilterUX/views/AdvFilterIDCard",["UWA/Core","UWA/Class","UWA/Class/View","UWA/Class/Model","UWA/Promise","DS/WAFData/WAFData","DS/CoreEvents/ModelEvents","DS/ENOXIDCard/js/IDCard","DS/i3DXCompassPlatformServices/OpenWith","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/TooltipModel","DS/ControlsEx/IDCard","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/PlatformAPI/PlatformAPI","DS/Menu/Menu","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Mask"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h,p,_,m,f,g,v,b,C,y){"use strict";return t.extend({init:function(e){this._container=e.parent,this._pfServiceId=e.serviceId,this._defaultSC=e.securityContext,this._widgetId=e.widgetId,this._UXId=e.UXId,this._isMaturityContainer=!0,this._isFilterModified=0,this._useLifeCycleCommand=1,this._useLifeCycleCommand&&(this._isOwnerContainer=!0,this._isCollabContainer=!0)},setContext:function(e){this._pfServiceId=e.serviceId||this._pfServiceId,this._defaultSC=e.securityContext||this._defaultSC},displayUnsavedChangesPanel:function(e){var t=this._container.getElement("#ngf-idcard-unsaved-values");t&&(e?(t.show(),this._isFilterModified=1):(t.hide(),this._isFilterModified=0))},isFilterModified:function(e){return this._isFilterModified},remove:function(e){this._subscriptionRefreshEvent&&this._subscriptionRefreshEvent.unsubscribe("DS/PADUtils/PADCommandProxy/refresh");var t=this._container.getElement(".global-header-idcard");if(t){var i=t.getElement("#ngf-idcard-id");i&&i.remove()}},updateIDCard:function(e,t){var i=this;return this._activeFilter=e||this._activeFilter,new o((function(n){i._computeOpenWithAppsList(i._activeFilter).then((o=>{i._openWithApps=o,i._initMaturityStateGraph(e).then((o=>{(i._maturityStateGraph=o,i._IDCardModel&&i._container.getElement("#ngf-idcard-id"))||(i._container.getElements("#ngf-idcard-unsaved-values").forEach((e=>{e.remove()})),i._createIDCardTemplate());i.displayUnsavedChangesPanel(!1),i._updateIDCard(e,t).then((()=>{n()}))}))}))}))},attachResizeSensor:function(){this._IDCardUI&&(this._IDCardUI.attachResizeSensor(),this._IDCardUI.resize())},_createIDCardTemplate:function(){var t=this,i=t._container.getElement(".global-header-idcard");this._toolbarIDCard||(this._toolbarIDCard=e.createElement("div",{id:"filterIDCardToolbar",class:"filter-IC-Toolbar"}),this._toolbarIDCard.inject(i),this._toolbarIDCard.hide());let o=new r;o.addEventListener("ngf-open-actions-menu-event",(function(e){var n=i.getElement(".xapp-id-card-container .fonticon-open-down").getBoundingClientRect();e&&(e.stopPropagation(),n=e.target.getBoundingClientRect()),g.show(t._idCardActionsSubMenu,{position:v.getMenuPosition(n)})})),t._useLifeCycleCommand&&o.addEventListener("ngf-show-version-explorer-event",(function(e){t._launchRevise()})),o.addEventListener("idcard-minified",(function(){})),o.addEventListener("idcard-expanded",(function(){p.setUsageTracker(t._widgetId,"NGF-IDCard","expand")}));let s={name:"?",version:"?",thumbnail:C.getWebappsAssetUrl("ENONextGenFilterUX","icons/I_AdvancedFilter144.png"),withHomeButton:!1,withExpandCollapseButton:!1,withActionsButton:!0,withInformationButton:!1,withToggleMinifiedButton:!0,modelEvents:o,attributes:t._getAttributes(),minified:!0,tooltips:{name:"?",version:b.get("reviseFilterTooltip")},customEvents:{actionsMenuClick:{event:"ngf-open-actions-menu-event"}}};this._useLifeCycleCommand&&(s.customEvents=e.merge(s.customEvents,{versionLabelClick:{event:"ngf-show-version-explorer-event"}})),t._IDCardModel=new n(s),t._IDCardUI=new a({id:"ngf-idcard-id",touchMode:v.TOUCH_MODE,model:t._IDCardModel}),t._IDCardUI.render().inject(i),t._IDCardUI.getContent().addClassName("ngf-idcard"),t._titleSectionIDCard=t._IDCardUI.getElement(".title-section-buttons");var l=e.Element("div",{id:"ngf-idcard-unsaved-values",class:"ngf-idcard-unsaved-changes"}),d=e.createElement("img",{id:"ngf-idcard-unsaved-icon",src:C.getWebappsAssetUrl("ENONextGenFilterUX","icons/20/filterWarning.png")}),c=e.Element("label",{id:"ngf-idcard-unsaved-msg",text:b.get("ChangesNotSaved")});if(d.inject(l),c.inject(l),l.inject(t._IDCardUI.getContent(),"after"),l.hide(),t._useLifeCycleCommand){let e=t._IDCardUI.getElement(".version");e&&e.addClassName("ngf-idcard-revision")}i.addEventListener("dragstart",(function(e){e.target.style.opacity=.5,e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("text/plain",t._getDraggedFilterData())})),i.addEventListener("dragend",(function(e){p.setUsageTracker(t._widgetId,"NGF-IDCard","dragEnd"),e.target.style.opacity="",e.dataTransfer.clearData("text/plain")})),t._subscriptionRefreshEvent=f.subscribe("DS/PADUtils/PADCommandProxy/refresh",(e=>{for(var i=e.data&&e.data.authored?e.data.authored.modified:[],n=i.length,o=0;o<n;o++){var s=i[o];if(t._activeFilter===s||t._activeFilter===s.physicalid){p.getFilterBasics(t._activeFilter,t._defaultSC).then((function(e){let i=e[0][t._activeFilter];if(v.getRootFilterContainer(t._UXId)){let e=t._IDCardModel.get("name");t._updateIDCard(t._activeFilter,i),e!==i.filterTitle&&t._container.dispatchEvent("NGF_UpdateFilterTitle",i.filterTitle),v.openFilterPanel("NGF_IDCard_"+Date.now())}}),(function(e){console.log("=> Edit Properties failed, error ="+e)}));break}}})),t._buildAttributesAsContainer(t._container)},_getAttributes:function(){return[{id:"ngf-attr-idcard-maturity",name:b.get("maturityStateIDCardAttr"),value:this._isMaturityContainer?'<div id="ngf-idcard-maturity"></div>':"?",displayWhenMinified:!0,editable:!1,container:!!this._isMaturityContainer,classname:this._isMaturityContainer?"ngf-idcard-maturity-container":""},{id:"ngf-attr-idcard-owner",name:b.get("ownerIDCardAttr"),value:this._isOwnerContainer?'<div id="ngf-idcard-owner"></div>':"?",editable:!!this._isOwnerContainer,container:!!this._isOwnerContainer},{id:"ngf-attr-idcard-collab-space",name:b.get("collabSpaceIDCardAttr"),value:this._isCollabContainer?'<div id="ngf-idcard-collab"></div>':"?",editable:!!this._isCollabContainer,container:!!this._isCollabContainer}]},_buildAttributesAsContainer:function(t){var i=this;if(i._isMaturityContainer){var n=t.getElements("#ngf-idcard-maturity");if(n.length){var o=n[0],s=n[1];o.addClassName("ngf-idcard-maturity"),s.addClassName("ngf-idcard-maturity"),o.empty(),s.empty();var r=e.Element("label",{id:"ngf-idcard-maturity-state",text:"?",class:"ngf-idcard-maturity-state"});o.appendChild(r),s.appendChild(r.cloneNode(!0)),(d=e.Element("a",{id:"ngf-idcard-maturity-next-state-anchor",text:"?",class:"ngf-idcard-maturity-next-state"})).inject(s);var a=e.Element("span",{id:"ngf-idcard-maturity-submenu",class:"wux-ui-3ds fonticon fonticon-chevron-down ngf-idcard-maturity-submenu","font-family":WUXManagedFontIcons.Font3DSs});if(a.inject(s),d.addEventListener("click",(function(e){var t=e.target.getText(),n=Object.keys(i._maturityStateGraph).find((e=>-1!==t.indexOf(i._maturityStateGraph[e].label)));n&&i._onSetMaturity({context:{url:v.getMaturityChangeStateUrl(),state:i._maturityStateGraph[n].value}})})),a.addEventListener("click",(function(e){var t=e.target.getBoundingClientRect();e&&(e.stopPropagation(),t=e.target.getBoundingClientRect()),g.show(i._maturityItems,{position:v.getMenuPosition(t)})})),i._isOwnerContainer){var l=t.getElement("#ngf-idcard-owner");(d=e.Element("a",{id:"ngf-idcard-owner-value",text:"?"})).inject(l),d.addEventListener("click",(function(e){i._changeOwnerAndCollab(i._activeFilter)}))}if(i._isCollabContainer){var d;l=t.getElement("#ngf-idcard-collab");(d=e.Element("a",{id:"ngf-idcard-collab-value",text:"?"})).inject(l),d.addEventListener("click",(function(e){i._launchMoveTo(i._activeFilter)}))}}}},_computeOpenWithAppsList:function(e){var t=this;return this._openWithApps=[],new o((function(i){t._openWith=new l,t._openWith.set3DXContent({data:{items:[{serviceId:t._pfServiceId,envId:p.getTenant(),objectId:e,objectType:"ENOStrRefinementSpecification"}]}}),t._openWith.retrieveCompatibleApps((function(e){i(e)}))}))},_initMaturityStateGraph:function(){var e=this;return new o((function(t,i){s.authenticatedRequest(v.getMaturityStatesAttributesUrl(),{headers:_.getRESTHeaders(e._defaultSC),method:"POST",data:JSON.stringify({objectids:[e._activeFilter]}),type:"json",proxy:"passport",onComplete:function(e){e.policies.policyName;var i=e.policies.states,n={};i.forEach((e=>{var t=e.stateSysName;n[t]={value:t,label:e.stateUserName||t};var i=e.activeColor,o="white",s="";"Obsolete"===t&&(o=s="#BABABA"),n[t].colors={background:i,font:o,border:s}})),t(n)},onFailure:function(e){console.log(" ==> Get Maturity State Graph failed: "+e),i(e)}})}))},_buildIDCardSubmenu:function(e){var t=this,i=[];if(!0===p.isCEFCtx())i.push({type:"PushItem",domId:"global-header-idcard-openWebInWin",title:"Open",icon:v.getIconByName("open"),action:{this:t,callback:t._launchOpenFilterWebInWin}});else{var n=[];this._openWithApps.forEach((function(e){n.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{this:t,callback:t._onOpenWith,context:{handler:e.handler,name:e.name}}})})),n.length&&i.push({type:"PushItem",domId:"global-header-idcard-openWith",title:b.get("openWithIDCardItem"),icon:v.getIconByName("open-menu-dot"),submenu:n})}this._maturityItems=[];var o=b.get("setMaturityToIDCardItem"),s=e[1];s&&this._maturityItems.push({type:"PushItem",domId:"global-header-idcard-maturity-demote",title:o+this._maturityStateGraph[s].label,icon:C.getWebappsAssetUrl("ENONextGenFilterUX","icons/16/demote_"+s.toLowerCase()+".png")||v.getIconByName("double-chevron-left"),action:{this:t,callback:t._onSetMaturity,context:{url:v.getMaturityChangeStateUrl(),state:s}}});var r=e[0];return r&&this._maturityItems.push({type:"PushItem",domId:"global-header-idcard-maturity-promote",title:o+this._maturityStateGraph[r].label,icon:C.getWebappsAssetUrl("ENONextGenFilterUX","icons/16/promote_"+r.toLowerCase()+".png")||v.getIconByName("double-chevron-right"),action:{this:t,callback:t._onSetMaturity,context:{url:v.getMaturityChangeStateUrl(),state:r}}}),t._useLifeCycleCommand&&this._maturityItems.push({type:"PushItem",domId:"global-header-idcard-maturity-cmd",title:b.get("maturityIDCardItem"),icon:v.getIconByName("collaborative-lifecycle-management"),action:{this:t,callback:t._launchMaturity}}),i=i.concat(this._maturityItems),this._useLifeCycleCommand&&(i.push({type:"PushItem",domId:"global-header-idcard-revisions",title:b.get("revisionIDCardItem"),icon:v.getIconByName("flow-branch-list"),action:{this:t,callback:t._launchRevision}}),i.push({type:"PushItem",domId:"global-header-idcard-revise",title:b.get("reviseIDCardItem"),icon:v.getIconByName("flow-line-add"),action:{this:t,callback:t._launchRevise}}),i.push({type:"PushItem",domId:"global-header-idcard-duplicate",title:b.get("duplicateIDCardItem"),icon:v.getIconByName("duplicate"),action:{this:t,callback:t._launchDuplicate}}),i.push({type:"PushItem",domId:"global-header-idcard-changeOwner",title:b.get("changeOwnerIDCardItem"),icon:v.getIconByName("user-pencil"),action:{this:t,callback:t._changeOwnerAndCollab}}),i.push({type:"PushItem",domId:"global-header-idcard-moveTo",title:b.get("moveToIDCardItem"),icon:v.getIconByName("move-to"),action:{this:t,callback:t._launchMoveTo}}),i.push({type:"PushItem",domId:"global-header-idcard-share",title:b.get("shareIDCardItem"),icon:v.getIconByName("forward"),action:{this:t,callback:t._launchShare}})),i.push({type:"PushItem",domId:"global-header-idcard-informations",title:b.get("informartionIDCardItem"),icon:v.getIconByName("info-open-in-a-new-window"),action:{this:t,callback:t._launchEditProperties}}),i},_onSetMaturity:function(e){var t=this,i=this._container.getElement("#ngf-idcard-id")||t._container.getContent();y.mask(i),t._getCSRFToken().then((n=>{var o=e.context.state,r=e.context.url,a=_.getRESTHeaders(t._defaultSC);a.ENO_CSRF_TOKEN=n,s.authenticatedRequest(r,{headers:a,method:"POST",data:JSON.stringify({data:[{id:t._activeFilter,nextState:o}]}),type:"json",proxy:"passport",onComplete:function(e){s.authenticatedRequest(v.getMaturityNextStatesUrl(),{headers:a,method:"POST",data:JSON.stringify({data:[{id:t._activeFilter}]}),type:"json",proxy:"passport",onComplete:function(e){y.unmask(i),p.setUsageTracker(t._widgetId,"NGF-IDCard","maturity"),t._updateIDCard(t._activeFilter,{maturity:o})},onFailure:function(e){y.unmask(i);var t="";t=e.getMessage?e.getMessage():e.message?e.message:e,console.log(" ==> _onSetMaturity / Get Next Maturity State failed, err = "+t)}})},onFailure:function(e){y.unmask(i);var t="";t=e.getMessage?e.getMessage():e.message?e.message:e,console.log(" ==> _onSetMaturity / Change Maturity failed, err = "+t),v.displayNotification({level:"error",message:b.get("MaturityCannotBeChange")})}})}),(function(e){y.unmask(i);var t="";t=e.getMessage?e.getMessage():e.message?e.message:e,console.log(" ==> _onSetMaturity / Get CRSF token failed, err = "+t)}))},_updateMaturityUI:function(e){var t=this,i=t._getSurroundingMaturityStates(e);t._idCardActionsSubMenu=t._buildIDCardSubmenu(i);var n=t._container.getElement(".global-header-idcard"),o=this._isMaturityContainer?"#ngf-idcard-maturity-state":"#ngf-attr-idcard-maturity",s=n.getElements(o),r=t._maturityStateGraph[e].colors;if(s.forEach((e=>{var t=r.border?"border: 1px solid "+r.border+";":"",i="background-color:"+r.background+";"+t+"color:"+r.font+";";e.setAttribute("style",i)})),this._isMaturityContainer){var a=i[0]||"Obsolete",l=(s=n.getElements("#ngf-idcard-maturity-next-state-anchor"),b.get("setMaturityToIDCardItem")+t._maturityStateGraph[a].label);s.forEach((e=>{e.setText(l)})),void 0===i[0]&&(s&&s[0].hide(),(s=n.getElements("#ngf-idcard-maturity-submenu"))&&s[0].hide())}},_onOpenWith:function(e){e=e.context;p.setUsageTracker(this._widgetId,"NGF-IDCard-OpenWith",e.name),e.handler.call()},_launchEditProperties:function(){var e=this;try{var t="DS/EditPropWidget/constants/EditPropConstants";if(1===p.isDebugActive("EditProp")&&null!==window.widget.id){let i="DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase",n=p.getTenant();require([i,t],function(t,i){var o={getSecurityContext:function(){return{SecurityContext:e._defaultSC,tenant:n}},getSelectedNodes:function(){let t=e._activeFilter;return[{getID:function(){return t},getRelationID:function(){return t},getLabel:function(){return e._IDCardModel.get("name")},getType:function(){return"ENOStrRefinementSpecification"},getDisplayName:function(){return e._IDCardModel.get("name")},object:{revision:e._IDCardModel.get("version")}}]}};(new t).launchProperties(o)}.bind(this))}else{require(["DS/EditPropWidget/EditPropComponent",t,"DS/EditPropWidget/models/EditPropModel"],function(t,i,n){var o=new t({appId:"ENOREFS_AP",typeOfDisplay:i.ALL,selectionType:i.ALL_SELECTION,displayType:i.POPUP,setCloseButton:!0,setEditButton:!0,readOnly:!1,extraNotif:!1,securityContextFromAppPreference:e._defaultSC,events:{onCancel:function(){e._subscriptionRefreshEvent&&e._subscriptionRefreshEvent.unsubscribe("DS/PADUtils/PADCommandProxy/refresh")}}}),s=new n({tenant:p.getTenant(),objectId:e._activeFilter});p.setUsageTracker(e._widgetId,"NGF-IDCard","properties"),o.show([s])}.bind(this))}}catch(e){console.error(e)}},_launchOpenFilterWebInWin:function(){dscef.sendString(JSON.stringify({operation:"launch_OpenFilter",data:this._activeFilter}))},_launchRevise:function(e){var t=this;try{require(["DS/LifecycleCmd/ReviseCmd"],function(e){var i={_selectedItems:[],_isMultiSelectMode:!1,getSelectedNodes:function(){return this._selectedItems},addSelection:function(e,i){this._selectedItems=[{getID:function(){return t._activeFilter},getLabel:function(){return t._IDCardModel.get("name")},getType:function(){return"ENOStrRefinementSpecification"},getDisplayName:function(){return t._IDCardModel.get("name")},object:{revision:t._IDCardModel.get("version")}}]}},n=UWA.extend(t,{});i.addSelection(n),(e=new e({context:i,ID:"RevisionHdr"})).begin()}.bind(this))}catch(e){console.error(e)}},_launchRevision:function(e){var t=this;try{require(["DS/LifecycleCmd/HistoryCmd"],function(e){var i={_selectedItems:[],_isMultiSelectMode:!1,getSelectedNodes:function(){return this._selectedItems},addSelection:function(e,i){this._selectedItems=[{getID:function(){return t._activeFilter},getLabel:function(){return t._IDCardModel.get("name")},getType:function(){return"ENOStrRefinementSpecification"},getDisplayName:function(){return t._IDCardModel.get("name")},object:{revision:t._IDCardModel.get("version")}}]}},n=UWA.extend(t,{});i.addSelection(n),(e=new e({context:i,ID:"RevisionFromHdr"})).begin()}.bind(this))}catch(e){console.error(e)}},_launchMaturity:function(e){var t=this;try{require(["DS/LifecycleCmd/MaturityCmd"],function(e){var i={_selectedItems:[],_isMultiSelectMode:!1,getSelectedNodes:function(){return this._selectedItems},addSelection:function(e,i){this._selectedItems=[{getID:function(){return t._activeFilter},getLabel:function(){return t._IDCardModel.get("name")},getType:function(){return"ENOStrRefinementSpecification"},getDisplayName:function(){return t._IDCardModel.get("name")},object:{revision:t._IDCardModel.get("version")}}]}},n=UWA.extend(t,{});i.addSelection(n),(e=new e({context:i,ID:"MaturityHdr"})).begin()}.bind(this))}catch(e){console.error(e)}},_launchDuplicate:function(e){var t=this;try{require(["DS/LifecycleCmd/DuplicateCmd"],function(e){var i={_selectedItems:[],_isMultiSelectMode:!1,getSelectedNodes:function(){return this._selectedItems},addSelection:function(e,i){this._selectedItems=[{getID:function(){return t._activeFilter},getLabel:function(){return t._IDCardModel.get("name")},getType:function(){return"ENOStrRefinementSpecification"},getDisplayName:function(){return t._IDCardModel.get("name")},object:{revision:t._IDCardModel.get("version")}}]}},n=UWA.extend(t,{});i.addSelection(n),(e=new e({context:i,ID:"DuplicateHdr"})).begin()}.bind(this))}catch(e){console.error(e)}},_getSurroundingMaturityStates:function(e){var t=[void 0,void 0],i=Object.keys(this._maturityStateGraph),n=i.indexOf(e);if("Obsolete"!==e){var o=0<=n-1?i[n-1]:void 0;o&&"Released"!==e&&(t[1]=o);var s=i.length-1>=n+1?i[n+1]:void 0;s&&(t[0]=s)}return t},_reviseFilter:function(){var e=this,t=this._container.getElement("#ngf-idcard-id")||e._container.getContent();return y.mask(t),new o((function(i,n){e._getCSRFToken().then((o=>{var r=v.getVersioningUrl(),a={data:[{source:"3DSpace",identifier:e._activeFilter,type:"ENOStrRefinementSpecification",relativePath:"/resources/v1/modeler/dsadvfilter/dsadvfilter:AdvFilter/"+e._activeFilter}]},l=_.getRESTHeaders(e._defaultSC);l.ENO_CSRF_TOKEN=o,s.authenticatedRequest(r,{headers:l,method:"POST",data:JSON.stringify(a),type:"json",proxy:"passport",onComplete:function(e){y.unmask(t),i(e.results[0].id)},onFailure:function(e){y.unmask(t),console.log(" ==> _reviseFilter / Versioning failed: ("+e.errorReport[0].errorCode+") "+e.errorReport[0].errorMessage),n(e)}})}),(function(e){y.unmask(t),console.log(" ==> _reviseFilter / getCRSFTokenUrl() failed: "+e),n(e)}))}))},_changeOwner:function(e){var t=this,i=this._container.getElement("#ngf-idcard-id")||t._container.getContent();return y.mask(i),new o((function(n,o){var r=t._defaultSC.split("."),a={owner:e,organization:r[1],collabspace:r[2],data:[{id:t._activeFilter}]},l=_.getRESTHeaders(t._defaultSC);l.ENO_CSRF_TOKEN=token,t._getCSRFToken().then((e=>{s.authenticatedRequest(v.getOwnershipUrl(),{headers:l,method:"POST",data:JSON.stringify(a),type:"json",proxy:"passport",onComplete:function(e){y.unmask(i),n()},onFailure:function(e){y.unmask(i),e.errorReport&&e.errorReport.length?console.log(" ==> _changeOwner / Change Owner failed: ("+e.errorReport[0].errorCode+") "+e.errorReport[0].errorMessage):console.log(" ==> _changeOwner / Change Owner failed: "+(e.getMessage?e.getMessage():e)),o(e)}})}),(function(e){y.unmask(i),console.log(" ==> _changeOwner / getCRSFTokenUrl() failed: "+e),o(e)}))}))},_updateIDCard:function(t,i){var n=this;return new o((function(o,s){var r=n._IDCardModel.get("name")||"?",a=n._IDCardModel.get("version")||"?",l=n._IDCardModel.get("attributes"),d="?",c="?",u="?",h=n._getAttributes(),_=function(){var t=n._maturityStateGraph[d]?n._maturityStateGraph[d].label:d;n._isMaturityContainer||(h[0].value=t),n._isOwnerContainer||(h[1].value=c),n._isCollabContainer||(h[2].value=u),n._IDCardModel.set({name:r,version:a,attributes:h,tooltips:{name:r,version:n._IDCardModel.get("tooltips").version}}),n._buildAttributesAsContainer(n._container),n._isMaturityContainer&&n._container.getElements("#ngf-idcard-maturity-state").forEach((e=>{e.setText(t)})),n._isOwnerContainer&&n._container.getElement("#ngf-idcard-owner-value").setText(c),n._isCollabContainer&&n._container.getElement("#ngf-idcard-collab-value").setText(u),p.getFilterBasics(n._activeFilter,n._defaultSC).then((function(e){n._updateMaturityUI(d),n._toolbarIDCard.empty(),n._updateIDCardToolbar(n._toolbarIDCard),n._isLeftPanelMaximized&&n.updateOnLeftPanelWidthChange(n._isLeftPanelMaximized,0),o()}),(function(t){var i="<span>"+e.String.format(b.get("NoFilterAccess"),n._IDCardModel.get("name"))+"</span>",o="<span>"+e.String.format(b.get("SpecificationCopied"),n._IDCardModel.get("name"))+"</span>";v.displayNotification({level:"warning",message:"<span>"+i+"<br>"+o+"</span>"}),n.remove(),n._container.dispatchEvent("NGF_OwnerChangedNewSpecification")}))};i&&Object.keys(i).length?(d=i.filterMaturity||i.maturity,n._isMaturityContainer||(d=l[0].value),r=i.filterTitle||i.title||n._IDCardModel.get("name"),a=i.filterRevision||i.revision||n._IDCardModel.get("version"),u=i.filterProject||i.project||l[2].value,n._isCollabContainer&&(u=i.filterProject||i.project?i.filterProject||i.project||l[2].value:n._container.getElement("#ngf-idcard-collab-value").getText()),c=i.filterOwner||i.owner,i.filterOwner||i.owner?n._getPersonInfo(c).then((function(e){e.firstname&&e.lastname&&(c=e.firstname+" "+e.lastname,_())})):(c=n._isOwnerContainer?n._container.getElement("#ngf-idcard-owner-value").getText():l[1].value,_())):t?p.getFilterBasics(t,n._defaultSC).then((e=>{var i=e[0][t];d=i.maturity,u=i.project,a=i.revision,r=i.filterTitle,c=i.owner,n._getPersonInfo(c).then((function(e){e.firstname&&e.lastname&&(c=e.firstname+" "+e.lastname,_())}))}),(function(e){console.log(" => Refresh Filter IDCard failed / err = "+e)})):_()}))},_getDraggedFilterData:function(){return JSON.stringify({protocol:"3DXContent",version:"1.1",source:"ENOREFS_AP",data:{items:[{envId:p.getTenant(),serviceId:this._pfServiceId,contextId:this._defaultSC,objectId:this._activeFilter,objectType:"ENOStrRefinementSpecification",displayName:this._filterTitle}]}})},_getCSRFToken:function(){var e=this;return new o((function(t,i){s.authenticatedRequest(v.getCRSFTokenUrl(),{headers:_.getRESTHeaders(e._defaultSC),method:"GET",type:"json",proxy:"passport",onComplete:function(e){t(e.csrf.value)},onFailure:function(e){console.log(" ==> _getCSRFToken / getCRSFTokenUrl() failed: "+e),i(e)}})}))},_changeOwnerAndCollab:function(t){var i=this;try{require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_TransferOwnershipCmd"],function(t){var n={_selectedItems:[],_isMultiSelectMode:!1,getSelectedNodes:function(){return this._selectedItems},addSelection:function(e,t){this._selectedItems=[{getID:function(){return i._activeFilter},getLabel:function(){return i._IDCardModel.get("name")},getType:function(){return"ENOStrRefinementSpecification"},getDisplayName:function(){return i._IDCardModel.get("name")},object:{revision:i._IDCardModel.get("version")}}]}},o=UWA.extend(i,{});n.addSelection(o);t=new t({context:n,ID:"ActionBar_TransferOwnershipCmd"});var s=f.subscribe("DS/PADUtils/PADCommandProxy/refresh",(function(t){s&&s.unsubscribe("DS/PADUtils/PADCommandProxy/refresh"),p.getFilterBasics(i._activeFilter).then((function(e){}),(function(t){var n="<span>"+e.String.format(b.get("NoFilterAccess"),i._IDCardModel.get("name"))+"</span>",o="<span>"+e.String.format(b.get("SpecificationCopied"),i._IDCardModel.get("name"))+"</span>";v.displayNotification({level:"warning",message:"<span>"+n+"<br>"+o+"</span>"}),i.remove(),i._container.dispatchEvent("NGF_OwnerChangedNewSpecification")}))}));t.begin()}.bind(this))}catch(e){console.error(e)}},_launchMoveTo:function(t){var i=this;try{require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd"],function(t){var n={_selectedItems:[],_isMultiSelectMode:!1,getSelectedNodes:function(){return this._selectedItems},addSelection:function(e,t){this._selectedItems=[{getID:function(){return i._activeFilter},getLabel:function(){return i._IDCardModel.get("name")},getType:function(){return"ENOStrRefinementSpecification"},getDisplayName:function(){return i._IDCardModel.get("name")},object:{revision:i._IDCardModel.get("version")}}]}},o=UWA.extend(i,{});n.addSelection(o);t=new t({context:n,ID:"ActionBar_ChangeOwnerCmd"});var s=f.subscribe("DS/PADUtils/PADCommandProxy/refresh",(function(t){s&&s.unsubscribe("DS/PADUtils/PADCommandProxy/refresh"),p.getFilterBasics(i._activeFilter).then((function(e){}),(function(t){var n="<span>"+e.String.format(b.get("NoFilterAccess"),i._IDCardModel.get("name"))+"</span>",o="<span>"+e.String.format(b.get("SpecificationCopied"),i._IDCardModel.get("name"))+"</span>";v.displayNotification({level:"warning",message:"<span>"+n+"<br>"+o+"</span>"}),i.remove(),i._container.dispatchEvent("NGF_OwnerChangedNewSpecification")}))}));t.begin()}.bind(this))}catch(e){console.error(e)}},_launchShare:function(e){var t=this;try{require(["DS/ENOCollabSharingCmds/commands/AccessRightCmd/ActionBar_AccessRightCmd"],function(e){var i={_selectedItems:[],_isMultiSelectMode:!1,getSelectedNodes:function(){return this._selectedItems},addSelection:function(e,i){this._selectedItems=[{getID:function(){return t._activeFilter},getLabel:function(){return t._IDCardModel.get("name")},getType:function(){return"ENOStrRefinementSpecification"},getDisplayName:function(){return t._IDCardModel.get("name")},object:{revision:t._IDCardModel.get("version")}}]}},n=UWA.extend(t,{});i.addSelection(n),(e=new e({context:i,ID:"ActionBar_AccessRightCmd"})).begin()}.bind(this))}catch(e){console.error(e)}},_getPersonInfo:function(e){var t=this;return new o((function(i,n){s.authenticatedRequest(v.getPnOUrl()+e,{method:"GET",type:"json",headers:{"DS-API-Version":"1.0",Accept:"application/json","Content-Type":"application/json",securitycontext:t._defaultSC},cache:-1,onComplete:e=>{i(e)},onFailure:e=>{n(e)}})}))},getContainer:function(){return this._container},_updateIDCardToolbar:function(e){var t=this;this._btnRename=new d({domId:"filter-ic-rename",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("rename")}),this._btnRename.tooltipInfos=new u({shortHelp:b.get("renameFilterTooltip"),mouseRelativePosition:!0});const i=new Event("NGF_RenameFilter");let n,o,s,r,a,l;this._btnRename.addEventListener("buttonclick",(()=>{t._container.dispatchEvent(i)})),this._useLifeCycleCommand&&(n=new d({domId:"filter-ic-revisions",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("flow-branch-list")}),n.tooltipInfos=new u({shortHelp:b.get("revisionTooltip"),mouseRelativePosition:!0}),n.addEventListener("buttonclick",this._launchRevision.bind(this)),o=new d({domId:"filter-ic-revise",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("flow-line-add")}),o.tooltipInfos=new u({shortHelp:b.get("reviseTooltip"),mouseRelativePosition:!0}),o.addEventListener("buttonclick",this._launchRevise.bind(this)),s=new d({domId:"filter-ic-duplicate",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("duplicate")}),s.tooltipInfos=new u({shortHelp:b.get("duplicateTooltip"),mouseRelativePosition:!0}),s.addEventListener("buttonclick",this._launchDuplicate.bind(this)),r=new d({domId:"filter-ic-changeOwner",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("user-pencil")}),r.tooltipInfos=new u({shortHelp:b.get("changeOwnerTooltip"),mouseRelativePosition:!0}),r.addEventListener("buttonclick",this._changeOwnerAndCollab.bind(this)),a=new d({domId:"filter-ic-moveTo",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("move-to")}),a.tooltipInfos=new u({shortHelp:b.get("moveToTooltip"),mouseRelativePosition:!0}),a.addEventListener("buttonclick",this._launchMoveTo.bind(this)),l=new d({domId:"filter-ic-share",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("forward")}),l.tooltipInfos=new u({shortHelp:b.get("shareTooltip"),mouseRelativePosition:!0}),l.addEventListener("buttonclick",this._launchShare.bind(this)));let c=new d({domId:"filter-ic-informations",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("info-open-in-a-new-window")});c.tooltipInfos=new u({shortHelp:b.get("informartionTooltip"),mouseRelativePosition:!0}),c.addEventListener("buttonclick",this._launchEditProperties.bind(this));let h=[];this._openWithApps.forEach((function(e){h.push({type:"RadioItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{this:t,callback:t._onOpenWith,context:{handler:e.handler,name:e.name}}})}));let _=new d({domId:"filter-ic-openwith",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("open-menu-dot")});_.disabled=!h.length,_.tooltipInfos=new u({shortHelp:b.get("openWithTooltip"),mouseRelativePosition:!0}),_.addEventListener("buttonclick",(function(e){e.stopPropagation();var t=e.target.getBoundingClientRect();g.show(h,{position:v.getMenuPosition(t)})}));let m=new d({domId:"filter-ic-openWebInWin",touchMode:v.TOUCH_MODE,showLabelFlag:!1,displayStyle:"lite",icon:v.getIconByName("open")});m.tooltipInfos=new u({shortHelp:b.get("openTooltip"),mouseRelativePosition:!0}),m.addEventListener("buttonclick",this._launchOpenFilterWebInWin.bind(this)),this._btnRename.inject(e),!0===p.isCEFCtx()?m.inject(e):_.inject(e),this._useLifeCycleCommand&&(n.inject(e),o.inject(e),s.inject(e),r.inject(e),a.inject(e),l.inject(e)),c.inject(e)},updateOnLeftPanelWidthChange:function(e,t){this._isLeftPanelMaximized=e,this._toolbarIDCard&&(this._toolbarIDCard.empty(),this._updateIDCardToolbar(this._toolbarIDCard)),this._IDCardUI&&(e?this._IDCardUI.expand():this._IDCardUI.minify()),this._toolbarIDCard&&(e?this._toolbarIDCard.show():this._toolbarIDCard.hide()),this._btnRename&&(this._btnRename.disabled=!!t),this._titleSectionIDCard&&(e?this._titleSectionIDCard.hide():this._titleSectionIDCard.show())}})})),define("DS/ENONextGenFilterUX/views/CriteriaAttributeView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Promise","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Handlebars/Handlebars4","text!DS/ENONextGenFilterUX/templates/attributeViewTemplate.html","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WUXAutoComplete/AutoComplete","DS/Controls/ComboBox","DS/Controls/Button","DS/UIKIT/Mask","DS/Controls/Loader","DS/ENONextGenFilterUX/views/AttributeCombinationView","DS/Controls/TooltipModel","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/NGFServices"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h,p,_,m,f,g,v,b,C,y,F){"use strict";return e.extend({domEvents:{"click .attributeCriterion-read .attrRead":"_onEditAttribute","click .attributeCriterion-read .attrRead-multi-attr":"_onEditAttribute"},className:"attributeCriterion",tagName:"li",setup:function(e){this._parent(e),this._isMigrateToAutoComplete=s.isMigrateToAutoComplete(),this._loaderContainer=window.document&&window.document.body?window.document.body.getElement(".f-globalFilter-container"):void 0,this.types=e.types,this._synthesisInfos=e.synthesisInfos,this._synthesisState=e.synthesisState||-1,this.customizeCtxMenu=e.customizeCtxMenu,this.sequenceMode=e.sequenceMode,this.keepValue=!1===e.keepValue||0===e.keepValue?0:1,this._template=r.compile(a),this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this)),this.listenTo(this.model,"onChange:Keep",this.onKeepChange.bind(this)),this.listenTo(this.model,"onChange:type",this.onTypeChange.bind(this)),this.container.addEvent("click",(function(e){return e.stopPropagation(),!1})),this._selectedType="",this._selectedSubType="",this._needToQueryServer=!0,this.isCancelEditCrteriaActivated=!1,this._attributesOfType=[],this._attributesOfExtension=[],e.listAttrFromType&&(this.subTypes=e.fromCriterionMdl.subTypes,this._attributesOfType=e.listAttrFromType,this._needToQueryServer=!1,this._keepRemoveCombo=e.fromCriterionMdl.Keep,this._selectedType=e.fromCriterionMdl.type,this._selectedSubType=e.fromCriterionMdl.extension,e.listAttrFromSubType&&(this._attributesOfExtension=e.listAttrFromSubType),this.attributes=this._attributesOfType.concat(this._attributesOfExtension),this._updateAttributesWithSynthesis(this.attributes,this._synthesisInfos)),this._savedBeforeEdit={},this._isTrackerOnTypeSet=0,this._mruTypeKey="types",this._mruExtensionKey="extensions",s.setEasyAttributeDisplayMode(F.isActivated("easyAttribute"))},render:function(){this.container.setContent(this._template({stateClass:this.model.get("state"),titleClass:l.get("titleAttributeUX"),touchMode:s.TOUCH_MODE,iconHeader:d.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_AttributeFilter.png")})),this.attrEditInputs=this.getElement(".attributeCriterion-edit .attr-edit-inputs"),this.attrEditInputsAttr=this.getElement(".attributeCriterion-edit .attr-edit-inputs-allAttributes"),this.attrEditActions=this.getElement(".attributeCriterion-edit .attr-edit-actions"),this.attrEditInputsAttr.hide(),this._loaderContainer=this._loaderContainer||this.attrEditInputs,this._createHeaderCtxMenu();let e=this.getElement(".attributeCriterion-edit .criterionDropDown");return e&&e.addClassName("focused"),this.addAttributeBtn=this._createAddAttributeButton(this.attrEditActions),this.addAttributeGroupBtn=this._createAddAttributeGroupButton(this.attrEditActions),this._addAttributeSequenceBtn=this._createAddAttrSequenceButton(this.attrEditActions),this._validateButton=this._createValidateButton(),this._setEnableButtons(!1),this.sequenceMode&&this._addAttributeSequenceBtn.hide(),this.createKeepRemoveDropDown(this.keepValue),this.setSequenceMode(this.sequenceMode),this},onTypeChange:function(e,t){this._validateButton&&t&&(this._validateButton.disabled=!1)},_createValidateButton:function(){var e=new m(s.getAttributeValidateButtonStyle());e.inject(this.attrEditActions),e.tooltipInfos=new b({shortHelp:l.get("ValidateCriteriaTooltip"),mouseRelativePosition:!0});e.getContent().addClassName("attribute-edit-button-style attributeCriterion-edit-validate"+(this.sequenceMode?"":" colorized"));var t=this;return e.addEventListener("buttonclick",(function(){0===s.isAsynchronousValidation()?t.isCriterionValidate()&&(t._savedBeforeEdit={},t.dispatchEvent("NGF_Criterion_Validation",{criteriaType:t.model.get("criteriaType")})):t.isCriterionValidate().then((function(e){if(e&&(F.setUsageTracker(t._widgetId,"NGF-Attribute-OnType",t.typeCombo.value),t._isTrackerOnTypeSet=1,t._savedBeforeEdit={},t.dispatchEvent("NGF_Criterion_Validation",{criteriaType:t.model.get("criteriaType")})),t._isMigrateToAutoComplete){var i=t.typeCombo.selectedItems;i&&t._updateMRUProperty(t._mruTypeKey,{label:i.getAttributeValue("label"),value:i.getAttributeValue("value")},s.MAX_MRU_VALUE);var n=t.subTypeCombo.selectedItems;n&&t._updateMRUProperty(t._mruExtensionKey,{label:n.getAttributeValue("label"),value:n.getAttributeValue("value")},s.MAX_MRU_VALUE)}}))})),e},_createAddAttrSequenceButton:function(e){var t=new m(s.getAttributeButtonStyle("list-ordered"));t.inject(e),t.tooltipInfos=new b({shortHelp:l.get("AddAttributeSequenceTooltip"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attributeCriterion-edit-addSequence-btn");var i=this;return t.addEventListener("buttonclick",(function(e){F.setUsageTracker(i._widgetId,"NGF-Attribute","Create_Sequence"),i.dispatchEvent("NGF_SwitchCriterionToSequence",{type:i.model.get("criteriaType"),idxView:i.cid,attributeKeep:i.model.get("Keep")})})),t},isCriterionValid:function(){var e="read"!==this.model.get("state"),t=!e;if(e){var i=this._attrCombinationView.isAttrValid(),n=Object.keys(i);if(t=!n.length)s.isEasyAttributeDisplayMode()?(this._anyObjectObject.show(),this._anyObjectKeep.show(),this._keepRemoveCombo.getContent().hide(),this.typeCombo.getContent().hide(),s.FILTER_ANY_OBJECT!==this._selectedType&&(this._extensionLabel.show(),this._extensionBtn.show(),this.subTypeCombo.getContent().hide())):(this._anyObjectObject&&this._anyObjectObject.hide(),this.typeCombo.getContent().show());else{for(var o="",r=0;r<n.length;r++){var a=n[r];o+=0===r?l.get(a)+i[a]:"<br><br>"+(r+1)+". "+l.get(a)+i[a]}o.length&&(o=1<n.length?"1. "+o:o,s.displayNotification({level:"error",message:o}))}}return t},isCriterionValidate:function(){var e,t=this;if(0===s.isAsynchronousValidation())return(e="read"===this.model.get("state"))||(e=this.isCriterionValid())&&(t._attrCombinationView.removeEmptyAttribute(),s.isModelActivated(t.model)||!0!==t._isCriterionModified()||t._switchCriterionState()),e;if(e="read"===this.model.get("state"))return new o((function(e){e(!0)}));var i=this.isCriterionValid();return new o(i?function(e){t._attrCombinationView.removeEmptyAttribute(),s.isModelActivated(t.model)||!0!==t._isCriterionModified()||t._switchCriterionState(),e(!0)}:function(e){e(!1)})},_getCallbackToEditCriterion:function(){return this.editAttribute.bind(this)},editAttribute:function(){this._savedBeforeEdit=c.getAttributeValues(this.model),this._savedBeforeEdit.types=this.types,this._savedBeforeEdit.subTypes=this.subTypes,this._savedBeforeEdit.attributes=this.attributes,this.subTypeCombo&&(this._savedBeforeEdit.elementsListExtension=this.subTypeCombo.elementsList),this._savedBeforeEdit.typeInfosLabel=this._keepTypeInfosFromLabel,this._savedBeforeEdit.subTypeInfosLabel=this._keepExtensionInfosFromLabel;var e=this._attrCombinationView.saveBeforeEdit();this._savedBeforeEdit.saveAttributes=e,this._savedBeforeEdit.asString=JSON.stringify(this.model.keepComponentsToFeedUI(!0)),this.model.set("state","edit")},_cancelEditCriteria:function(){if(this._isCriterionModified()){if(this.isCancelEditCrteriaActivated=!0,void 0===this._savedBeforeEdit.type){if(F.isActivated("easyAttribute"))this.typeCombo.value="anyObject";else{if(this._isMigrateToAutoComplete){var e=this.subTypeCombo.elementsTree;this.typeCombo.selectedItem=[e.getRoots(0)]}else this.typeCombo.selectedIndex=0;this._extensionBtn.show()}this._keepRemoveCombo.value=!0,this._extensionBtn&&(this.subTypeCombo.value="",this.subTypeCombo.hide()),this._attrCombinationView.restoreBeforeEdit(this._savedBeforeEdit.saveAttributes)}else{this._keepRemoveCombo.value=void 0===this._savedBeforeEdit.Keep||this._savedBeforeEdit.Keep,this.types=this._savedBeforeEdit.types,this._keepTypeInfosFromLabel=this._savedBeforeEdit.typeInfosLabel;for(var t=Object.keys(this._keepTypeInfosFromLabel),i=0;i<t.length;i++)if(this._savedBeforeEdit.type===this._keepTypeInfosFromLabel[t[i]].value){this.typeCombo.value=this._keepTypeInfosFromLabel[t[i]].value;break}if(this.subTypes=this._savedBeforeEdit.subTypes,this._keepExtensionInfosFromLabel=this._savedBeforeEdit.subTypeInfosLabel,this.subTypeCombo.elementsList=this._savedBeforeEdit.elementsListExtension,void 0===this._savedBeforeEdit.extension)this._extensionBtn.show(),this.subTypeCombo.hide(),this.subTypeCombo.value="";else for(t=Object.keys(this._keepExtensionInfosFromLabel),i=0;i<t.length;i++)if(this._savedBeforeEdit.extension===this._keepExtensionInfosFromLabel[t[i]].value){this.subTypeCombo.value=this._keepExtensionInfosFromLabel[t[i]].value;break}this._attrCombinationView.restoreBeforeEdit(this._savedBeforeEdit.saveAttributes),this._savedBeforeEdit&&c.setAttributeValues(this.model,this._savedBeforeEdit)}this.isCancelEditCrteriaActivated=!1}},_createHeaderCtxMenu:function(){this._createCriterionCtxMenuWUX(this.getElement(".criterionDropDown")),this._setContextualMenu("edit")},onKeepChange:function(e){!1===e.get("Keep")?this.dispatchEvent("NGF_AttrKeepToRemoveMode"):this.dispatchEvent("NGF_AttrRemoveToKeepMode")},_onDelayedEditAttribute:function(){},onStateChange:function(e,t){this._isTrackerOnTypeSet||(F.setUsageTracker(this._widgetId,"NGF-Attribute-OnType",this.typeCombo.value),this._isTrackerOnTypeSet=1);var i=this.getElement(".f-attribute-container");i&&i.setAttribute("class","f-attribute-container "+t);let n=i.getElement(".attributeCriterion-read .criterionDropDown"),o=i.getElement(".attributeCriterion-edit .criterionDropDown");this.customizeCtxMenu;if("read"===t){n&&n.addClassName("focused"),o&&o.removeClassName("focused");var s=e.criterionToString(),r=Array.isArray(s)?s:[s],a=r[0],l=r[1];r.shift(),r.shift();var d=this.getElement(".attrRead#prefix");if(d.setContent([{tag:"span",html:a}]),r.length){r=[l].concat(r);var c=this._getAttributeHTML(r);d=this.getElement(".attrRead#value").hide(),(d=this.getElement(".attrRead-multi-attr").show()).setContent([{html:c}])}else d=this.getElement(".attrRead-multi-attr").hide(),(d=this.getElement(".attrRead#value").show()).setContent([{tag:"span",html:l}]);this._setContextualMenu("read")}else{if(n&&n.removeClassName("focused"),o&&o.addClassName("focused"),-1===this._synthesisState)this.dispatchEvent("NGF_ComputeSynthesis",{callback:this._onDelayedEditAttribute.bind(this)});else{this.isThereCriteria()&&!this._attrCombinationView.isThereCriteria()&&this._attrCombinationView.createAttribute();var u=this.getElement("#"+this._getId()+" .criteriaIcon");this.sequenceMode?u.hide():u.show(),this._setContextualMenu("edit"),F.isActivated("easyAttribute"),this._attrCombinationView.updateMRUOfAttribute()}this.dispatchEvent("NGF_Criterion_SwitchedToEdit",{type:this.model.get("criteriaType"),state:1})}},_getAttributeHTML:function(e){for(var t="",i=0;i<e.length;i++)if(Array.isArray(e[i])){var n=e[i];t+="<li>"+n[0],t+='<ul class="attrRead-multi-attr"><div>',n.shift(),t+=this._getAttributeHTML(n),t+="</div></ul></li>"}else t+="<li>"+e[i]+"</li>";return t},createKeepRemoveDropDown:function(e){var i=[{labelItem:l.get("keep"),valueItem:!0},{labelItem:l.get("remove"),valueItem:!1}];this._keepRemoveCombo=new _({touchMode:s.TOUCH_MODE,elementsList:i,placeholder:l.get("keepRemoveLabel"),enableSearchFlag:!1,selectedIndex:e?0:1}),this._keepRemoveCombo.inject(this.attrEditInputs),this._keepRemoveCombo.getContent().addClassName("filter-anyobject-off"),this.model.set("Keep",!!e);var n=this;this._keepRemoveCombo.addEventListener("change",(function(e){n.model.set("Keep",e.dsModel.value),n._anyObjectKeepAnchor&&n._anyObjectKeepAnchor.setText(e.dsModel.label)})),(n=this)._anyObjectKeep=t.createElement("label",{class:"innerfiltertypecombo filter-anyobject-on"}),n._anyObjectKeep.inject(n._keepRemoveCombo.getContent(),"after"),n._anyObjectKeepAnchor=t.createElement("a",{text:l.get(e?"keep":"remove"),id:"anyObject_keep"}),n._anyObjectKeepAnchor.inject(n._anyObjectKeep),n._anyObjectKeepAnchor.addEventListener("click",(function(e){if(!e.target.disabled){var t=!n.model.get("Keep");n.model.set("Keep",t),e.target.setText(l.get(t?"keep":"remove")),n._keepRemoveCombo.value=t}}));var o=!this.sequenceMode;this.setEnableKeepRemove(o),n._keepRemoveCombo.getContent().removeClassName("filter-anyobject-off"),n._keepRemoveCombo.hide(),n._anyObjectKeep.removeClassName("filter-anyobject-on")},buildFilteredTypeUIAsync:function(e,t){var i=this;return new o((function(n){i.buildFilteredTypeUI(e,t),n()}))},buildFilteredTypeUI:function(e,i){if(this.types=e?t.clone(e):void 0,this.types){var n=s.isEasyAttributeDisplayMode(),o=-1;n&&-1===(o=this.types.findIndex((e=>s.FILTER_ANY_OBJECT===e.name)))&&(this.types.push({nlsName:l.get("anyObject"),name:s.FILTER_ANY_OBJECT}),o=this.types.length-1),this.typeCombo=this._buildAndFeedCombo("type",this.types,this._childGroupId),this.typeCombo.addEventListener("change",this._onSelectFilteredType.bind(this)),n&&!this._anyObjectObject&&(this._buildEasyUI(),this._anyObjectObject.show(),this._anyObjectKeep.show(),this._keepRemoveCombo.getContent().hide(),this.typeCombo.getContent().hide());let e=i;if(void 0===e){let t=-1;t=n?o:this.types.findIndex((function(e){return!(!e||"VPMReference"!==e.name)})),t=-1===t?0:t,e=this.types.length?this.types[t].name:""}this.typeCombo.value=this.types.length?e:""}},_onSelectFilteredType:function(e){var t,i=this;if(this._isMigrateToAutoComplete){var n=e.dsModel.selectedItems;t=n?n.getAttributeValue("label"):void 0}else t=e.dsModel.label;var o=e.dsModel.value;if(o){i._keepTypeInfosFromLabel[t]||(i._keepTypeInfosFromLabel[t]={}),i._keepTypeInfosFromLabel[t]={value:o},this._isTrackerOnTypeSet=0;var r=i.model.get("type");if(i._needToQueryServer=!i.isCancelEditCrteriaActivated&&i._selectedType!==o,i._selectedType=o,i.model.set("type",o),i.model.set("nlsType",t),this._anyObjectObject&&this._anyObjectObjectAnchor.setText(t),s.FILTER_ANY_OBJECT===o){s.setEasyAttributeDisplayMode(!0);let e=i.getElements(".filter-anyobject-on");e.forEach((e=>e.show())),e=i.getElements(".filter-anyobject-off"),e.forEach((e=>e.hide()))}else if(s.setEasyAttributeDisplayMode(!1),s.FILTER_ANY_OBJECT===r){let e=i.getElements(".filter-anyobject-on");e.forEach((e=>e.hide())),e=i.getElements(".filter-anyobject-off"),e.forEach((e=>e.show())),e=i.getElements(".filter-anyobject-off-display-off"),e.forEach((e=>e.hide()))}this._cleanSubTypes(),F.isActivated("easyAttribute")&&this._buildExtensionUI(),i._selectAttributes(o),i._setEnableButtons(!0)}else i._cleanTypes(),i._setEnableButtons(!1);i._selectedSubType="",i._attributesOfExtension=[],i.model.set("extension",""),i.model.set("nlsExtension","")},_buildEasyUI:function(){var e=this;e.getElements(".filter-anyobject-on").forEach((e=>e.remove())),e._anyObjectObject=t.createElement("label",{class:"innerfiltertypecombo filter-anyobject-on"}),e._anyObjectObject.inject(e.typeCombo.getContent(),"after"),e._anyObjectObjectAnchor=t.createElement("a",{text:l.get("anyObject"),id:"anyObject_object"}),e._anyObjectObjectAnchor.inject(e._anyObjectObject),e._anyObjectObjectAnchor.addEventListener("click",(function(t){e._anyObjectObject.hide(),e.typeCombo.show()}))},_getAttributesOfType:function(e){return new o((function(t,i){var n=[];n.push("ds6wg:"+e);var o=[];C.getPropertiesForClass(n,{tenantId:F.getTenant(),lang:y.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(e){e.forEach((function(e){var t=e.properties;t.forEach((function(e){e.rangeValues&&(e.rangeValues={literalInfo:e.rangeValues})})),o=o.concat(t)})),t(o)},onFailure:function(e){i(o)}})}))},_setEnableButtons:function(e){var t=!e;this.addAttributeBtn.disabled=t,this.addAttributeGroupBtn.disabled=t,this._addAttributeSequenceBtn.disabled=t,this._validateButton.disabled=t},_buildExtensionUI:function(){var e=this;void 0===this.subTypeCombo?(this._extensionLabel=t.createElement("label",{class:"innerfiltertypecombo",text:l.get("without"),id:"with_extension_"+this._childGroupId}),this._extensionLabel.inject(this.attrEditInputs),this._extensionLabel.addClassName("filter-anyobject-off"),this._extensionBtn=new m({touchMode:s.TOUCH_MODE,displayStyle:"lite",label:l.get("SelectExtension"),domId:"SelectExtension_"+this._childGroupId}),this._extensionBtn.inject(this.attrEditInputs),this._extensionBtn.getContent().addClassName("attributeCriterion-edit-SelectExtension filter-anyobject-off"),s.isEasyAttributeDisplayMode()&&s.FILTER_ANY_OBJECT===this._selectedType&&(this._extensionLabel.hide(),this._extensionBtn.hide()),this._extensionBtn.addEventListener("buttonclick",(function(t){if(t.target.hide(),e.subTypeCombo&&e.subTypeCombo.show("slow"),!e._selectedSubType)if(e._isMigrateToAutoComplete){var i=e.typeCombo.selectedItems.getAttributeValue("label");e._computeExtensionsAndUpdateUI(e._keepTypeInfosFromLabel[i].value)}else e._computeExtensionsAndUpdateUI(e._keepTypeInfosFromLabel[e.typeCombo.label].value)})),this.subTypeCombo=this._buildAndFeedCombo("extension",[],this._childGroupId),this.subTypeCombo.getContent().addClassName("filter-anyobject-off filter-anyobject-off-display-off"),this.subTypeCombo.hide(),this.subTypeCombo.addEventListener("change",(function(t){var i,n="",o="";if(e._isMigrateToAutoComplete){var s=t.dsModel.selectedItems;i=s?s.getAttributeValue("label"):void 0}else i=t.dsModel.label;var r=e._keepExtensionInfosFromLabel[i];if(r&&(o=n=r.value,e._needToQueryServer=!e.isCancelEditCrteriaActivated&&e._selectedSubType!==n),e._selectedSubType=n,e.model.set("extension",n),e.model.set("nlsExtension",""===n?n:i),n?e._extensionBtn.label=i:(e._extensionBtn.label=l.get("SelectExtension"),e._extensionLabel.setText(l.get("without"))),!e.isCancelEditCrteriaActivated)if(e._selectedSubType){var a="ds6wg:"+o;C.getPropertiesForClass(a,{tenantId:F.getTenant(),lang:y.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(t){e._attributesOfExtension=t.length?t[0].properties:[],e.attributes=e._attributesOfType.concat(e._attributesOfExtension),e.updateSynthesis()},onFailure:function(e){}})}else e._attributesOfExtension=[],e.attributes=e._attributesOfType,e.updateSynthesis()}))):this._extensionBtn&&0===s.isEasyAttributeDisplayMode()&&(this._extensionLabel.setText(l.get("without")),this._extensionLabel.show(),this._extensionBtn.label=l.get("SelectExtension"),this._extensionBtn.show(),this.subTypeCombo||(this.subTypeCombo=this._buildAndFeedCombo("extension",[],this._childGroupId)),this.subTypeCombo.hide(),this.subTypeCombo.getContent().addClassName("filter-anyobject-off-display-off"))},_computeExtensionsAndUpdateUI:function(e){if(e)if(!1===this._needToQueryServer&&this.subTypes)F.isActivated("easyAttribute")&&this._updateExtensionUI();else{if(this.subTypeCombo){let e=t.String.format(l.get("LoaderForExtensions"),this.model.get("nlsType"));this._displayLoader("on",e)}var i=this,n=e;C.getExtensionsForClass(n,{tenantId:F.getTenant(),lang:y.getLanguage().toLowerCase(),onComplete:function(e){i.subTypes=[];var t=e.extensions;t&&t.length&&(i.subTypes=i._updateExtensionWithSynthesis(t,i._synthesisInfos)),F.isActivated("easyAttribute")&&i._updateExtensionUI(),1===i.subTypes.length&&i.subTypeCombo&&(i.subTypeCombo.value=i.subTypes[0].label)},onFailure:function(e){i.subTypes=[]}})}},_updateExtensionUI:function(){var e=this.getContent().getElement("#No_Extension_Available");if(e&&e.remove(),0===this.subTypes.length){if(this._extensionBtn.hide(),this.subTypeCombo.hide(),e=this.getContent().getElement("#"+this._extensionBtn.domId)){var i=t.createElement("label",{class:"innerfiltertypecombo",text:l.get("SelectExtension"),id:"No_Extension_Available"});e.parentNode.replaceChild(i,e)}s.displayNotification({level:"info",message:l.get("NoExtensionAvailable")}),this._displayLoader("off")}else(e=this.getContent().getElement("#with_extension_"+this._childGroupId))&&e.setText(l.get("with")),this.subTypeCombo&&(this._buildAndFeedCombo("extension",this.subTypes,this._childGroupId,this.subTypeCombo),this._displayLoader("off")),(e=this.getContent().getElement("#"+this._extensionBtn.domId))&&e.hide()},_cleanTypes:function(){this.typeCombo&&((this._isMigrateToAutoComplete?this.typeCombo.elementsTree:this.typeCombo.elements)&&(this.typeCombo.elements&&(this.typeCombo.value=""),this._cleanSubTypes(),this._attrCombinationView&&this._attrCombinationView.cleanAttributes()))},_cleanSubTypes:function(){this.subTypeCombo&&(this.subTypeCombo.elements&&this.subTypeCombo.elements.container.remove(),delete this.subTypeCombo),this._extensionLabel&&(this._extensionLabel.remove(),delete this._extensionLabel),this._extensionBtn&&(this._extensionBtn.remove(),delete this._extensionBtn)},_displayLoader:function(e,t){"on"===e?f.mask(this._loaderContainer,t):f.unmask(this._loaderContainer)},_selectAttributes:function(e){var t=this;if(e)if(!1===this._needToQueryServer&&this.attributes)this._createAttributeCombinationView();else{this._displayLoader("on");var i=function(e){t._displayLoader("off"),t._attributesOfType=e,t.attributes=t._attributesOfType,t._needToQueryServer=t.isCancelEditCrteriaActivated,t._updateAttributesWithSynthesis(e,t._synthesisInfos),t._createAttributeCombinationView(),t.subTypeCombo.hide(),s.isEasyAttributeDisplayMode()||t._extensionBtn.show(),t.subTypes=void 0},n=function(e){t._displayLoader("off"),t._updateAttributesWithSynthesis(t.attributes,t._synthesisInfos),t._createAttributeCombinationView()};s.FILTER_ANY_OBJECT===e?s.computeAttributesFromSynthesis(this._synthesisInfos).then((function(e){i(e)}),(function(e){n()})):this._getAttributesOfType(e).then((function(e){i(e)}),(function(e){n()}))}},_buildAndFeedCombo:function(e,i,n,o){var r=this,a=[],d=0,c="";switch(e){case"type":this._keepTypeInfosFromLabel={},c=this._mruTypeKey;break;case"extension":this._keepExtensionInfosFromLabel={},c=this._mruExtensionKey,d=1}if(i.forEach((function(t){var i,n;switch(e){case"type":i=t.nlsName,n=t.name,r._keepTypeInfosFromLabel[i]||(r._keepTypeInfosFromLabel[i]={}),r._keepTypeInfosFromLabel[i]={value:n};break;case"extension":i=t.label||t.nlsName,n=(n=t.curi||t.name).substring(n.indexOf(":")+1),r._keepExtensionInfosFromLabel[i]||(r._keepExtensionInfosFromLabel[i]={}),r._keepExtensionInfosFromLabel[i]={value:n}}a.push({valueItem:n,labelItem:i})})),!o){var m,f=t.String.format(l.get("placeHolderSelectEntity"),l.get(e));if(this._isMigrateToAutoComplete){var g,v;if((g=new u({})).prepareUpdate(),this._mruTypeKey===c)0!==(v=this._getMRUProperty(c)).length&&(v.reverse(),v.forEach((function(e){var t=new h({label:e.label,value:e.value,icons:[{iconName:"navigation-history"}],grid:{label:e.label,value:e.value}});g.addChild(t)})));(a=d?a.sort(r._alphabeticSort):a).forEach((e=>{var t=new h({label:e.labelItem,value:e.valueItem,grid:{label:e.labelItem,value:e.valueItem}});g.addChild(t)})),g.pushUpdate(),(m=new p({touchMode:s.TOUCH_MODE,domId:"filtered-"+e,placeholder:f,multiSearchMode:!1,elementsTree:g,allowFreeInputFlag:!1})).displayLoader=-1===this._synthesisState}else m=new _({touchMode:s.TOUCH_MODE,actionOnClickFlag:!0,elementsList:d?a.sort(r._alphabeticSort):a,preselectedIndex:1===a.length?0:-1,placeholder:f,autocompleteFlag:!1,generateRegexpString:function(e){return e}});return m.inject(this.attrEditInputs),m.getContent().addClassName("attributeCriterion-edit-"+e+("type"===e?" filter-anyobject-off":"")),m}this._isMigrateToAutoComplete?((g=o.elementsTree).removeRoots(),g.prepareUpdate(),0!==(v=this._getMRUProperty(c)).length&&(v.reverse(),v.forEach((function(e){var t=new h({label:e.label,value:e.value,icons:[{iconName:"navigation-history"}],grid:{label:e.label,value:e.value}});g.addChild(t)}))),(a=d?a.sort(this._alphabeticSort):a).forEach((e=>{var t=new h({label:e.labelItem,value:e.valueItem,grid:{label:e.labelItem,value:e.valueItem}});g.addChild(t)})),g.pushUpdate()):o.elementsList=d?a.sort(r._alphabeticSort):a},_alphabeticSort:function(e,t){var i=0;return void 0!==e&&void 0!==t&&(i=e.labelItem<=t.labelItem?-1:1),i},_getDOMElementToUpdateOnActivateChange:function(){var e=[];let t=this.getElement("#"+this._getId()+" .attributeCriterion-read");return e.push(t.getElement("#readHeader")),e.push(t.getElement("img")),e},destroy:function(){this._attrCombinationView&&this._attrCombinationView.destroy(),this.dispatchEvent("NGF_RemoveCriterion",{idxView:this.cid,criteriaType:this.model.get("criteriaType"),edited:"edit"===this.model.get("state")?1:0}),this.stopListening(),this.model=null,this._parent(),this.container=null},_isCriterionModified:function(){var e=JSON.stringify(this.model.keepComponentsToFeedUI(!0));return this._savedBeforeEdit.asString!==e},viewFromMdl:function(e){void 0===e.Keep&&(e.Keep=this.model.get("Keep")),e.isActivated||(e.isActivated=this.model.get("isActivated")),e.extension||(e.extension=this.model.get("extension")),void 0!==this._keepRemoveCombo&&(this._keepRemoveCombo.value=e.Keep,this._anyObjectKeepAnchor&&this._anyObjectKeepAnchor.setText(l.get(!1===e.Keep?"remove":"keep"))),this.typeCombo.value=e.type,e.extension&&(this._extensionBtn.hide(),this.subTypeCombo.show(),this._computeExtensionsAndUpdateUI(e.type),this.subTypeCombo.value=e.extension);var t=this._attrCombinationView.viewFromMdl(e);return t.length&&this._attrCombinationView.removeEmptyAttribute(),"0"===e.isActivated&&this._switchCriterionState(),s.isEasyAttributeDisplayMode()?(this._anyObjectObject.show(),this._anyObjectKeep.show(),this._keepRemoveCombo.getContent().hide(),this.typeCombo.getContent().hide(),s.FILTER_ANY_OBJECT!==this._selectedType&&(this._extensionLabel.show(),this._extensionBtn.show(),this.subTypeCombo.getContent().hide())):(this._anyObjectObject&&this._anyObjectObject.hide(),this.typeCombo.getContent().show()),t},_createAttributeCombinationView:function(){this._attrCombinationView&&(this._attrCombinationView.destroy(),(e=this.model.get("allAttributes")||[]).splice(0),this.model.set("allAttributes",e));var e,t=new n;(e=this.model.get("allAttributes")||[]).push(t),this.model.set("allAttributes",e),this._attrCombinationView=new v({model:t,widgetId:this._widgetId,selectedType:void 0!==this.model.get("nlsType")&&void 0!==this._keepTypeInfosFromLabel?this._keepTypeInfosFromLabel[this.model.get("nlsType")].value:"",selectedExtension:this._selectedSubType,attributesUsed:this.attributes,attrEditInputs:this.attrEditInputs,attrEditInputsAttr:this.attrEditInputsAttr,synthesisState:this._synthesisState}),this._attrCombinationView.render().inject(this.attrEditInputs);var i=this._attrCombinationView._listOfAttributes.length;i&&this._attrCombinationView._listOfAttributes[i-1].setFocus(),this.listenTo(this._attrCombinationView,"NGF_SwitchDisplayContext",this._onSwitchDisplayContext.bind(this)),this.listenTo(this._attrCombinationView,"NGF_DisplayAddActions",this._onDisplayAddActions.bind(this))},_onSwitchDisplayContext:function(e){1===e.context?(e.combination.inject(this.attrEditInputs),e.view.inject(this.attrEditInputsAttr),this.attrEditInputsAttr.show()):(e.view.inject(this.attrEditInputs),this.attrEditInputsAttr.hide())},_onDisplayAddActions:function(e){var t=this.attrEditActions.getElement(".attribute-edit-add-btn2"),i=this.attrEditActions.getElement(".attribute-edit-addGroup-btn2");t&&i&&e.display&&(t.show(),i.show())},_createAddAttributeButton:function(e){if(this.addAttributeBtn)return this.addAttributeBtn;var t=new m(s.getAttributeButtonStyle("plus"));t.inject(e||this._Div),t.tooltipInfos=new b({shortHelp:l.get("AddAttributeTooltip"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attribute-edit-add-btn2");var i=this;return t.addEventListener("buttonclick",(function(e){F.setUsageTracker(i._widgetId,"NGF-Attribute","Create_Attribute"),(!s.isEasyAttributeDisplayMode()||i.isCriterionValid())&&(i._cleanSelected(),i._attrCombinationView.createAttribute())})),t},_createAddAttributeGroupButton:function(e){if(this.addAttributeGroupBtn)return this.addAttributeGroupBtn;var t=new m(s.getAttributeButtonStyle("group-add"));t.inject(e||this._Div),t.tooltipInfos=new b({shortHelp:l.get("AddAttributeGroupTooltip"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attribute-edit-addGroup-btn2");var i=this;return t.addEventListener("buttonclick",(function(e){F.setUsageTracker(i._widgetId,"NGF-Attribute","Create_Group"),(!s.isEasyAttributeDisplayMode()||i.isCriterionValid())&&(i._cleanSelected(),i._attrCombinationView.createAttributeGroup())})),t},_cleanSelected:function(){var e=this.getElement(".attribute-edit-group-selected");e&&e.removeClassName("attribute-edit-group-selected")},reDrawCriterion:function(){"read"===this.model.get("state")?(this.model.set("state","edit"),this.model.set("state","read")):(this.model.set("state","read"),this.model.set("state","edit")),this._validateButton&&this._validateButton.getContent().addClassName("attributeCriterion-edit-validate"+(this.sequenceMode?"":" colorized"))},setSequenceMode:function(e){var t;this.sequenceMode=!!e,this.model.set("inSequence",this.sequenceMode),this.sequenceMode?(this._addAttributeSequenceBtn.hide(),t="close"):(this._addAttributeSequenceBtn.show(),t="trash");var i=this._critContextualMenu.length-1;this._critContextualMenu[i].icon.iconName=t;var n=this.getElement(".criteriaIcon img");n&&(this.sequenceMode?n.hide():n.show())},setEnableKeepRemove:function(e){this._keepRemoveCombo&&(this._keepRemoveCombo.disabled=!e),this._anyObjectKeepAnchor&&(this._anyObjectKeepAnchor.disabled=!e,e?this._anyObjectKeepAnchor.removeClassName("attr-keep-remove-disabled"):this._anyObjectKeepAnchor.addClassName("attr-keep-remove-disabled"))},initKeepRemove:function(e){var t="Keep"===e?0:1;this._keepRemoveCombo.selectedIndex=t,this._anyObjectKeepAnchor&&this._anyObjectKeepAnchor.setText(l.get(0===t?"keep":"remove")),this.reDrawCriterion()},switchCriterionToSequence:function(){this.setSequenceMode(!0),this.setEnableKeepRemove(!0),this.reDrawCriterion()},switchSequenceToCriterion:function(){this.setSequenceMode(!1),this.setEnableKeepRemove(!0),this.reDrawCriterion(),this.model.set("state","edit")},updateSynthesis:function(e){if(e){this._synthesisInfos=e.synthesis||this._synthesisInfos;var t=this._synthesisState!==e.state?1:0;this._synthesisState=e.state||this._synthesisState,s.FILTER_ANY_OBJECT===this._selectedType&&(this._attributesOfType=e.attributes||this._attributesOfType,this.attributes=this._attributesOfType),1===t&&this._reBuildFilteredTypeUI()}this._updateAttributesWithSynthesis(this.attributes,this._synthesisInfos),this._attrCombinationView&&this._attrCombinationView.updateAttributes(this.attributes,this._synthesisState)},updateOnceSynthesisComputed:function(){this.typeCombo.displayLoader=!1,this.subTypeCombo&&(this.subTypeCombo.displayLoader=!1)},_reBuildFilteredTypeUI:function(){var e=this,i=s.getTypesOfSynthesis(this._synthesisInfos).concat(F.isActivated("easyAttribute")?{name:s.FILTER_ANY_OBJECT,nlsName:l.get("anyObject")}:[]),n=this._selectedType,o=-1,r=[];if(this._keepTypeInfosFromLabel=[],i.forEach(((t,i)=>{r.push({labelItem:t.nlsName,valueItem:t.name}),e._keepTypeInfosFromLabel[t.nlsName]={value:t.name},o=n===t.name?i:o})),this._isMigrateToAutoComplete){var a=this.typeCombo.elementsTree;a.removeRoots(),a.prepareUpdate();var d=this._getMRUProperty(this._mruTypeKey);0!==d.length&&(d.reverse(),d.forEach((function(e){var t=new h({label:e.label,value:e.value,icons:[{iconName:"navigation-history"}],grid:{label:e.label,value:e.value}});a.addChild(t)}))),r.forEach((e=>{var t=new h({label:e.labelItem,value:e.valueItem,grid:{label:e.labelItem,value:e.valueItem}});a.addChild(t)})),a.pushUpdate(),this.typeCombo.value=-1===o?"":r[o].valueItem}else{var c=new _({touchMode:s.TOUCH_MODE,actionOnClickFlag:!0,elementsList:r,preselectedIndex:o,placeholder:t.String.format(l.get("placeHolderSelectEntity"),l.get("type")),autocompleteFlag:!1,generateRegexpString:function(e){return e}});c.getContent().setAttribute("style",this.typeCombo.getContent().getAttribute("style")),c.getContent().addClassName(this.typeCombo.getContent().getAttribute("class")),this.typeCombo.getContent().parentNode.replaceChild(c.getContent(),this.typeCombo.getContent()),this.typeCombo=c,this.typeCombo.value=-1===o?"":r[o].valueItem,this.typeCombo.addEventListener("change",this._onSelectFilteredType.bind(this))}},_updateAttributesWithSynthesis:function(e,t){t&&e&&e.length&&(t.length?t.forEach((function(t){var i=e.findIndex((function(e){var i=e.curi||e.uri;return t.property===i})),n=-1!==i?e[i]:void 0;n&&(n.rangeValues={editable:!0,literalInfo:t.values})})):e.forEach((function(e){e.rangeValues&&(e.rangeValues=void 0)})))},_updateExtensionWithSynthesis:function(e,t){var i=[];if(e&&e.length)if(t){var n=t.find((function(e){return"ds6w:kind"===e.property}));n&&n.values&&n.values.forEach((function(t){var n=e.find((function(e){var i=e.curi||e.name;return i=i.substring(i.indexOf(":")+1),t.value===i}));n&&i.push(n)})),F.isDebugActive("extension")&&(i.splice(0),i=[...e])}else F.isDebugActive("extension")&&(i.splice(0),i=[...e]);return i},isThereCriteria:function(){return!!this._attrCombinationView},_updateMRUProperty:function(e,t,i){for(var n=Array.isArray(t)?t:[t],o=n?n.length:0,s=this._getMRUProperty(e),r=s,a=0;a<o;a++){var l=s.findIndex((function(e){return e.value===n[a].value}));-1===l?(r.push(n[a]),r.length>i&&r.shift()):(r.push(s[l]),r.splice(l,1))}this._setMRUProperty(e,r)},_getMRUProperty:function(e){var t,i=JSON.parse(window.localStorage.getItem("NGF_Most-Recent-Used"))||{};if(this._mruTypeKey===e)t=i[this._mruTypeKey]||[];else if(this._mruExtensionKey===e){t=(i[this._mruExtensionKey]||{})[this._selectedType]||[]}return t},_setMRUProperty:function(e,t){var i="NGF_Most-Recent-Used",n=JSON.parse(window.localStorage.getItem(i))||{};if(this._mruTypeKey===e)n[e]=t;else if(this._mruExtensionKey===e){var o=n[this._mruExtensionKey]||{};o[this._selectedType]=t,n[e]=o}window.localStorage.setItem(i,JSON.stringify(n))},selectTypes:function(e,t){this.buildFilteredTypeUI(e,t)}})})),define("DS/ENONextGenFilterUX/views/VolumeView",["UWA/Core","UWA/Class/View","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Controls/Button","DS/Controls/LineEditor","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/Menu/Menu","DS/Utilities/Utils"],(function(e,t,i,n,o,s,r,a,l){"use strict";return t.extend({domEvents:{"click .innerVolumeFilterHeader":"_onVolumeSelected","click .innerVolumeFilter":"_onVolumeSelected"},tagName:"div",className:"attr-edit-inputs-Volume-Master",setup:function(t){this._filterSpecId=t.filterSpecId,this._volSetId=t.volSetId||0,this._idVol=t.idVol,this._volumeId="volume_"+this._filterSpecId+"-"+this._volSetId+"-"+this._idVol,this._masterDiv=this.container,this._masterDiv.id=this._volumeId,this._volDiv=e.createElement("div",{class:"attr-edit-inputs-Attribute"}),this._volDiv.inject(this._masterDiv),this.container.addEvent("click",(function(e){return e.stopPropagation(),!1})),this.listenTo(this.model,"onChange:isActivated",this._onActivateChange.bind(this)),this.listenTo(this.model,"onChange:state",this._onStateChange.bind(this)),this.listenTo(this.model,"onChange:displayName",this._onFilterNameChange.bind(this))},render:function(){return this._createVolumeUI(),this},getValues:function(){return{filterSpecId:this._filterSpecId,setId:this._volSetId,id:this.model.get("id"),displayName:this.model.get("displayName"),parameters:this.model.get("parameters")}},_createVolumeUI:function(){this.model.set("id",this._volumeId);var t=n.get("defaultVolumeName");t+="-"+(this._idVol+1),this.model.set("displayName",t),this._volumeUL=e.createElement("ul",{}),this._volumeUL.inject(this._volDiv);let i=e.createElement("div",{});i.setStyle("display","flex"),i.inject(this._volumeUL),this._volumeName=e.createElement("label",{class:"innerVolumeFilterHeader",html:this.model.get("displayName"),id:"name_"+this._volumeId}),this._volumeName.inject(i);let s=e.createElement("div",{class:"volume-edit-command"});s.inject(i),this._createVolumeCriterionCtxMenuWUX(s),this._waitingForDiv=e.createElement("div",{class:"volume-edit-WaitingFor",id:"waitngForDiv_"+this._volumeId}),this._waitingForDiv.inject(this._volumeUL);var r=e.createElement("label",{class:"volume-edit-WaitingFor-Label",html:n.get("WaitingForVolumeSpecifications")+" (",id:"labelVolSpec1_"+this._volumeId});r.inject(this._waitingForDiv);var a=new o({touchMode:!0,displayStyle:"lite",label:n.get("CancelVolumeSpecifications"),id:"cancelVolSpec_"+this._volumeId});a.getContent().addClassName("filter-anchor-style"),a.inject(this._waitingForDiv),(r=e.createElement("label",{class:"volume-edit-WaitingFor-Label",html:")",id:"labelVolSpec2_"+this._volumeId})).inject(this._waitingForDiv);var l=this;a.addEventListener("buttonclick",(function(e){l._cancelEditVolume()})),this._renameEditor=this._createRenameVolumeUI(this._volumeName),this._renameEditor.hide()},_onStateChange:function(e,t){var n=this;if("read"===t){var o=this.model.get("parameters");if(o){var s=o.type;if("proximity"===s||"space"===s)if(o.root_path_alias)this._displayVolumeSpecification(o);else{var r=o.root_path_physicalid[0];i.executeFetch(r,[],["ds6w:label","ds6wg:revision"]).then((function(e){var t=i.getAliasesFromFetched(r,e);o.root_path_alias=t,n._displayVolumeSpecification(o)}))}else this._displayVolumeSpecification(o);i.isModelActivated(this.model)||this._switchCriterionState()}this._waitingForDiv.hide(),this._contextualMenuWUX=[],this._contextualMenuWUX.push(this._ctxMenuRead[0]),this._contextualMenuWUX.push(this._ctxMenuRead[1]),this._contextualMenuWUX.push(i.isModelActivated(this.model)?this._deactivateItem:this._activateItem),this._contextualMenuWUX.push(this._deleteItem)}else{for(var a=this._volumeUL.getElements("li"),l=a.length-1;l>=0;l--)a[l].addClassName("f-group-deactivated");this._waitingForDiv.show(),this._contextualMenuWUX=this._ctxMenuEdit}},redrawVolumeSpecification:function(){var e=this.model.get("parameters");this._displayVolumeSpecification(e)},_displayVolumeSpecification:function(t){for(var o=this._volumeUL.getElements("li"),s=o.length-1;s>=0;s--)o[s].remove(),o[s].removeClassName("f-group-deactivated");if(t){var r=" "+i.getLengthUnit().symbol,a=n.get(t.type)+",  "+n.get(t.intersection_mode),l=e.createElement("li",{class:"innerVolumeFilter",text:a});switch(l.inject(this._waitingForDiv,"before"),t.type){case"box":let i,o;if(t.corner_min=t.corner_min.map(Number),t.corner_max=t.corner_max.map(Number),t.transformation_matrix){let e=[];e.push(t.corner_min),e.push(t.corner_max),t.transformation_matrix=t.transformation_matrix.map(Number);let n=t.transformation_matrix,s=[];e.forEach((e=>{var t=[n[0]*e[0]+n[3]*e[1]+n[6]*e[2]+n[9],n[1]*e[0]+n[4]*e[1]+n[7]*e[2]+n[10],n[2]*e[0]+n[5]*e[1]+n[8]*e[2]+n[11]];s.push(t)})),i=s[0],o=s[1]}else i=t.corner_min,o=t.corner_max;(l=e.createElement("li",{class:"innerVolumeFilter",text:n.get("corner_min")+this._convertValue(i).join(r+", ")+r})).inject(this._waitingForDiv,"before"),(l=e.createElement("li",{class:"innerVolumeFilter",text:n.get("corner_max")+this._convertValue(o).join(r+", ")+r})).inject(this._waitingForDiv,"before");break;case"sphere":t.center=t.center.map(Number),t.radius=parseFloat(t.radius);var d="center",c=t[d];(l=e.createElement("li",{class:"innerVolumeFilter",text:n.get(d)+this._convertValue(c).join(r+", ")+r})).inject(this._waitingForDiv,"before"),(l=e.createElement("li",{class:"innerVolumeFilter",text:n.get("radius")+this._convertValue(t.radius)+r})).inject(this._waitingForDiv,"before");break;case"proximity":t.distance=parseFloat(t.distance);var u=" ...";if(t.root_path_alias){var h=t.root_path_alias.length;u=t.root_path_alias[h-1]||" ..."}(l=e.createElement("li",{class:"innerVolumeFilter volume-li-reference",text:n.get("reference")})).inject(this._waitingForDiv,"before");var p=e.createElement("div",{});e.createElement("label",{class:"innerVolumeFilter volume-li-reference-alias",html:u}).inject(p),p.inject(l),(l=e.createElement("li",{class:"innerVolumeFilter",text:n.get("distance")+this._convertValue(t.distance)+r})).inject(this._waitingForDiv,"before");break;case"space":t.distance=parseFloat(t.distance);u=" ...";if(t.root_path_alias){h=t.root_path_alias.length;u=t.root_path_alias[h-1]||" ..."}(l=e.createElement("li",{class:"innerVolumeFilter volume-li-reference",text:n.get("reference")})).inject(this._waitingForDiv,"before");p=e.createElement("div",{});e.createElement("label",{class:"innerVolumeFilter volume-li-reference-alias",html:u}).inject(p),p.inject(l),t.maybe3d&&(l=e.createElement("li",{class:"innerVolumeFilter",text:n.get("maybe3d")+t.maybe3d})).inject(this._waitingForDiv,"before")}}},_convertValue:function(e){var t,n=i.getLengthUnit().unit,o=i.getLengthUnit().decimal;if(Array.isArray(e))t=[],e.forEach((function(e){var i=r.convert(Number(e),"Length","mm",n);t.push(i.toFixed(o))}));else{var s=r.convert(Number(e),"Length","mm",n);t=s.toFixed(o)}return t},_onVolumeSelected:l.debounce((function(){this.dispatchEvent("NGF_VolumeSelected",{filterSpecId:this._filterSpecId,setId:this._volSetId,id:this.model.get("id"),displayName:this.model.get("displayName"),parameters:this.model.get("parameters")}),this.model.set("state","edit")}),100),isEmpty:function(){return!this.model.get("parameters")},setFocus:function(){},showAddButtons:function(e){},showRemoveButton:function(e){},_createVolumeCriterionCtxMenuWUX:function(t){var o=e.createElement("span",{});o.addClassName("fonticon fonticon-chevron-down volume-ctx-menu"),o.addClassName("attribute-edit-remove-btn"),o.inject(t),this._activateItem={type:"PushItem",recId:"volume-activate-item-DDCtx",title:n.get("activatedCriteria"),icon:i.getIconByName("eye"),action:{this:this,callback:this._switchCriterionState}},this._deactivateItem={type:"PushItem",recId:"volume-activate-item-DDCtx",title:n.get("deactivatedCriteria"),icon:i.getIconByName("eye-off"),action:{this:this,callback:this._switchCriterionState}},this._deleteItem={type:"PushItem",recId:"volume-delete-item-DDCtx",title:n.get("deleteCriteria"),icon:i.getIconByName("close"),action:{this:this,callback:this._removeVolume}},this._ctxMenuRead=[{type:"PushItem",recId:"volume-edit-item-DDCtx",title:n.get("editCriteria"),icon:i.getIconByName("pencil"),action:{this:this,callback:this._onVolumeSelected}},{type:"PushItem",recId:"volume-rename-item-DDCtx",title:n.get("renameVolume"),icon:i.getIconByName("rename"),action:{this:this,callback:this._renameVolume}},this._deactivateItem,this._deleteItem],this._ctxMenuEdit=[{type:"PushItem",recId:"volume-cancel-item-DDCtx",title:n.get("cancelEdit"),icon:i.getIconByName("undo"),action:{this:this,callback:this._cancelEditVolume}},this._deleteItem],this._contextualMenuWUX=this._ctxMenuRead;var s=this;o.addEventListener("click",(function(e){var t=e.target.getBoundingClientRect();a.show(s._contextualMenuWUX,{position:i.getMenuPosition(t)})}))},_renameVolume:function(){this._volumeName.hide(),this._renameEditor.show(),this._renameEditor._giveFocus()},_cancelEditVolume:function(){this.model.set("state","read"),this.model.get("parameters")||this._removeVolume({volId:this._volumeId})},_removeVolume:function(){this.dispatchEvent("NGF_RemoveVolume",{volId:this._volumeId})},_switchCriterionState:function(){var e=i.isModelActivated(this.model)?"0":"1";this.model.set("isActivated",e)},_onActivateChange:function(e,t){i.isModelActivated(this.model);var n=this._contextualMenuWUX.findIndex((e=>"volume-activate-item-DDCtx"===e.recId));-1!==n&&(this._contextualMenuWUX[n]=i.isModelActivated(this.model)?this._deactivateItem:this._activateItem);var o=this.getContent();"1"===t?o.removeClassName("f-criterion-deactivated"):o.addClassName("f-criterion-deactivated")},_onFilterNameChange:function(){this._volumeName&&this._volumeName.setHTML(this.model.get("displayName"))},_createRenameVolumeUI:function(e){var t=new s({touchMode:i.TOUCH_MODE,class:"innerVolumeFilterHeader",placeholder:n.get("placeHolderVolumeName"),domId:"rename_"+this._volumeId});t.value=this.model.get("displayName"),t.inject(e,"after");var o=this;t.addEventListener("focus",(function(e){e.target.value=o.model.get("displayName")}));var r=function(e){e.target.hide(),""!==e.dsModel.value&&o.model.set("displayName",e.dsModel.value),o._volumeName.show()};return t.addEventListener("change",r),t.addEventListener("blur",r),t},volumeViewFromMdl:function(e){this.model.set("displayName",e.displayName),e.parameters&&e.parameters.isRepaired&&(delete e.parameters.isRepaired,this.model.set("state","edit")),this.model.set("parameters",e.parameters),this.model.set("state","read"),"0"===e.isActivated&&this._switchCriterionState()}})})),define("DS/ENONextGenFilterUX/views/CriteriaContextMgmtView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Promise","DS/Logger/Logger","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Handlebars/Handlebars4","text!DS/ENONextGenFilterUX/templates/contextMgmtViewTemplate.html","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/Controls/Button","DS/PlatformAPI/PlatformAPI","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/Controls/Expander","DS/Controls/TooltipModel","DS/Menu/Menu","DS/Utilities/Utils","DS/Controls/Label"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h,p,_,m,f,g,v){"use strict";return e.extend({className:"contextCriterion",tagName:"li",domEvents:{"click .contextCriterion-read .contextRead":"_onEditAttribute"},setup:function(e){this._parent(e),this._rootID=e.rootId,this._template=s.compile(r),this.listenTo(this.model,"onChange:state",this._onStateChange.bind(this)),this.container.addEvent("click",(function(e){return e.stopPropagation(),!1})),this._allAddedNodes=[],this._allExcludedNodes=[],this._allAddedNodesLabels=[],this._allExcludedNodesLabels=[],this._allAddedAliases=[],this._allExcludedAliases=[],this.model.set("addedNodesList",this._allAddedNodes),this.model.set("excludedNodesList",this._allExcludedNodes),this.model.set("addedNodesLabels",this._allAddedNodesLabels),this.model.set("excludedNodesLabels",this._allExcludedNodesLabels),this.model.set("addedAliases",this._allAddedAliases),this.model.set("excludedAliases",this._allExcludedAliases),this.listenTo(this,"updateAddDisplay",this._updateAddDisplay.bind(this)),this.listenTo(this,"updateExcludeDisplay",this._updateExcludeDisplay.bind(this)),this.model.set("AddNodeActivated",!0),this.model.set("ExcludeNodeActivated",!0),this._allSelectedPath=[],this._pathDisplayMode=o.getPathDisplayMode()},render:function(){return this.container.setContent(this._template({stateClass:this.model.get("state"),titleClass:a.get("titleContextUX"),titleContextReadUX:a.get("titleContextReadUX"),iconHeader:l.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_SelectionFilter.png"),maxPath:a.get("MaxPathInfoForSelection")})),this._addedNodesDiv=this.getElement("#nodesAddedList"),this._getPlaceHolder(a.get("SelectNodesToAddOnAppSide")).inject(this._addedNodesDiv),this._excludedNodesDiv=this.getElement("#nodesExcludedList"),this._getPlaceHolder(a.get("SelectNodesToExcludeOnAppSide")).inject(this._excludedNodesDiv),this._maxPathContainer=this.getElement("#MaxPathContainer").hide(),this._createContextFilterUI(),this._createHeaderCtxMenu(),this._editContext(),this},destroy:function(){this._saveBeforeEdit={},this._allSelectedPath=[],this.dispatchEvent("NGF_RemoveCriterion",{idxView:this.cid,criteriaType:this.model.get("criteriaType"),edited:"edit"===this.model.get("state")?1:0}),this._subscribe0&&this._subscribe0.unsubscribe("NGFilter.OccPath"),this._subscribe1&&this._subscribe1.unsubscribe("DS/ENO/select"),this._subscribe2&&this._subscribe2.unsubscribe("DS/PADUtils/PADCommandProxy/select"),this.stopListening(),this.model=null,this._parent(),this.container=null},_getPlaceHolder:function(e){return new UWA.Element("span",{class:"context-chip-cell-container context-chip-cell-placeholder",text:e})},_createHeaderCtxMenu:function(){this._createCriterionCtxMenuWUX(this.getElement(".criterionDropDown")),this._setContextualMenu("edit")},_editContext:function(){this._saveBeforeEdit={},this._saveBeforeEdit.AddNodeActivated=t.clone(this.model.get("AddNodeActivated")),this._saveBeforeEdit.addedNodesList=t.clone(this.model.get("addedNodesList")),this._saveBeforeEdit.addedNodesLabels=t.clone(this.model.get("addedNodesLabels")),this._saveBeforeEdit.ExcludeNodeActivated=t.clone(this.model.get("ExcludeNodeActivated")),this._saveBeforeEdit.excludedNodesList=t.clone(this.model.get("excludedNodesList")),this._saveBeforeEdit.excludedNodesLabels=t.clone(this.model.get("excludedNodesLabels")),this._saveBeforeEdit.addedAliases=t.clone(this.model.get("addedAliases")),this._saveBeforeEdit.excludedAliases=t.clone(this.model.get("excludedAliases")),this._saveBeforeEdit.asString=JSON.stringify(this.model.keepComponentsToFeedUI(!0)),this.model.set("state","edit")},_manageExpandCollapseNodes:function(){var e=this._allAddedNodes.length,t=this._allExcludedNodes.length;0!==e&&0!==t?(this._addExpander.expandedFlag=!!e,this._excludeExpander.expandedFlag=!!t):0===e&&0===t?(this._isAddedExpanded=1,this._isAddedActive=1,this._addExpander.expandedFlag=!0,this._addExpander.body.addClassName("selected-nodes-active")):0!==e?this._addExpander.body.addClassName("selected-nodes-active"):0!==t&&this._excludeExpander.body.addClassName("selected-nodes-active")},_completeSelection:function(e){return new i((t=>{var i=e.revision&&e.revision.length;if(e.label&&e.label.length&&i)t(e);else{var o=e.serviceId[0],s=[];e.path.forEach((e=>{s=s.concat(e)})),s=[...new Set(s)];var r=[];s.forEach((e=>{r.push({rootId:e,serviceId:o})}));var a=p.getOption("displayRoot_AttributesTitle")||["ds6w:label","ds6wg:revision"];-1===a.indexOf("ds6wg:revision")&&a.push("ds6wg:revision"),h.getPredicatesInfosFromIds(r,a,!0).then((function(i){var n=u.getDisplaySeparator(),o=[],s=[];e.path.forEach((e=>{var t=[],r=[];e.forEach((e=>{var o=i.find((t=>e===t.id));if(o){var s=[];a.forEach((e=>{var t=o.predicates.find((function(t){return e===t.name}));t&&s.push(t.dispValue||t.value)})),t.push(s.join(n));var l=o.predicates.find((function(e){return"ds6wg:revision"===e.name}));r.push(l?l.value:"")}})),o.push(t.length?t:""),s.push(r.length?r:"")})),e.label=o,e.revision=s,t(e)}),(function(e){n.error("Advanced Filter: Error to retrieve labels on selected path !")}))}}))},_setSelectionFromEvent:g.debounce((function(e){let i=this,n=!0,s=e.data&&e.data.paths?e.data.paths.length:o.MAX_SELECTION_PATH+1;if(this._isAddedActive?n=o.MAX_SELECTION_PATH<this._allAddedNodes.length+s:this._isExcludedActive&&(n=o.MAX_SELECTION_PATH<this._allExcludedNodes.length+s),n=!1,n)o.displayNotification({level:"warning",title:a.get("SelectionFilterTitle"),message:t.String.format(a.get("SelectionMaxPathReached"),o.MAX_SELECTION_PATH)});else if(e.data.paths&&e.data.paths.length){let t=[];e.data.paths.forEach((e=>{this._checkRootAndPath(e)?1<e.length&&t.push(e):o.displayNotification({level:"info",message:a.get("ObjectNotUnderRoot"),sticky:!1})})),t.length&&i._onPathSelect({serviceId:["3DSpace"],path:t})}}),500),_onOccPathSelect:function(e){this._setSelectionFromEvent({data:{paths:e.path}})},_onPathSelect:function(e){var t=this;this.model&&"edit"===this.model.get("state")&&this._completeSelection(e).then((e=>{if(t._isAddedActive&&t.model.get("AddNodeActivated")){if(t.getElement("#nodesAddedList"))for(var i=1===e.path.length,n=0;n<e.path.length;n++){var o=t._isPathAlreadyAdded(e.path[n],i)||t._isPathAlreadyExcluded(e.path[n],i);if(1<e.path[n].length&&!o){let i=t._formatPath(e.label[n],"short",t._pathDisplayMode);t._allAddedNodes.push(e.path[n]),t._allAddedNodesLabels.push(i),t._allAddedAliases.push(t._formatPath(e.label[n],"long",t._pathDisplayMode)),t._InsertPathInDiv({selectedPath:e.path[n],pathAlias:i,aliases:[e.label[n]],cleanUI:1===t._allAddedNodes.length?1:0})}}}else if(t._isExcludedActive&&t.model.get("ExcludeNodeActivated")){if(t.getElement("#nodesExcludedList"))for(i=1===e.path.length,n=0;n<e.path.length;n++){o=t._isPathAlreadyAdded(e.path[n])||t._isPathAlreadyExcluded(e.path[n],i);if(1<e.path[n].length&&!o){let i=t._formatPath(e.label[n],"short",t._pathDisplayMode);t._allExcludedNodes.push(e.path[n]),t._allExcludedNodesLabels.push(i),t._allExcludedAliases.push(t._formatPath(e.label[n],"long",t._pathDisplayMode)),t._InsertExcludedPathInDiv({selectedPath:e.path[n],pathAlias:i,aliases:[e.label[n]],cleanUI:1===t._allExcludedNodes.length?1:0})}}}}))},_isPathAlreadyAdded:function(e,t){for(var i=!1,n="string"==typeof e?e.split(","):e,s=!1,r=!1,l=0;l<this._allAddedNodes.length;l++){let e=!0;for(var d=0;d<=n.length;d++)if(n[d]&&n[d]!==this._allAddedNodes[l][d]){e=!1;break}if(e&&n.length<this._allAddedNodes[l].length)s=!0;else if(e){r=!0;break}}return r?this._isPathPresent(this._allSelectedPath,n)&&(i=!0,!1!==t&&o.displayNotification({level:"info",message:a.get("AlreadyAdded"),sticky:!1})):s?i=!1:(i=!1,!this._isPathPresent(this._allSelectedPath,n)&&this._allSelectedPath.push(n)),i},_isPathAlreadyExcluded:function(e,t){for(var i=!1,n="string"==typeof e?e.split(","):e,s=0;s<this._allExcludedNodes.length;s++){let e=!0;for(var r=0;r<=n.length;r++)if(this._allExcludedNodes[s][r]&&n[r]!==this._allExcludedNodes[s][r]){e=!1;break}if(e){if(this._isPathPresent(this._allSelectedPath,n)){i=!0,!1!==t&&o.displayNotification({level:"info",message:a.get("AlreadyExcluded"),sticky:!1});break}}else i=!1,!this._isPathPresent(this._allSelectedPath,n)&&this._allSelectedPath.push(n)}return i},_checkRootAndPath:function(e){return this._rootID===e[0]},_formatPath:function(e,t,i){let n="",o=e.length;if("short"===t)n+=0===i?e[o-1]:e[o-2]+" ["+e[o-1]+"]";else if("long"===t)if(n="["+e[0]+"]",0===i)for(let t=1;t<o;t+=2)n+=" \\ "+e[t]+" ["+e[t+1]+"]";else for(let t=1;t<o;t+=2)n+=" \\ "+e[t]+" ["+e[t+1]+"]";return n},_buildPathInfos:function(e){e.length;let t="",i="";return o.isLeftPanelMaximized()?(t=this._formatPath(e,"long",this._pathDisplayMode),i=this._formatPath(e,"long",1)):(t=this._formatPath(e,"short",this._pathDisplayMode),i=this._formatPath(e,"long",1)),{label:t,toolTipMdl:new m({title:this._formatPath(e,"short",this._pathDisplayMode),longHelp:i,mouseRelativePosition:!0})}},updateOnLeftPanelWidthChange:function(e){let t=this.getElement("#nodesAddedList");t=t?t.getElements(".wux-controls-label-content"):[];let i=this.getElement("#nodesExcludedList");i=i?i.getElements(".wux-controls-label-content"):[],e?(t.forEach(((e,t)=>{e.setText(this._allAddedAliases[t]),e.addClassName("rightCrop")})),i.forEach(((e,t)=>{e.setText(this._allExcludedAliases[t]),e.addClassName("rightCrop")}))):(t.forEach(((e,t)=>{e.setText(this._allAddedNodesLabels[t]),e.removeClassName("rightCrop")})),i.forEach(((e,t)=>{e.setText(this._allExcludedNodesLabels[t]),e.removeClassName("rightCrop")})))},_InsertPathInDiv:function(e,t){var i;e.cleanUI&&this._addedNodesDiv.empty(),i="InsertAllPathsAtOnce"===t?{addedNodesLabels:e.addedNodesLabels?e.addedNodesLabels:e.get("addedNodesLabels")||[],addedNodesList:e.addedNodesList?e.addedNodesList:e.get("addedNodesList")||[]}:{addedNodesLabels:[e.pathAlias],addedNodesList:[e.selectedPath]};for(var n=0;n<i.addedNodesLabels.length;n++){var o=new UWA.Element("div",{class:"context-chip-cell-container"}),s=new UWA.Element("span",{class:"context-chip-cell-close fonticon fonticon-close","font-family":"DSFontIcon"});s.onclick=this._removePathFromSelectionList.bind(this);let t=this._buildPathInfos(e.aliases[n]);var r=new v({value:t.label,maxDisplayLength:9999});r.getContent().addClassName("context-chip-cell-label");let a=r.getContent();r.tooltipInfos=t.toolTipMdl,r.inject(o),s.inject(o),o.inject(this._addedNodesDiv),a.setAttribute("occId",i.addedNodesList[n])}this.dispatchEvent("updateAddDisplay")},_removePathFromSelectionList:function(e){if(this.model.get("AddNodeActivated"))for(var t=e.target.parentElement,i=t.getElement(".context-chip-cell-label").getAttribute("occId").split(","),n=0;n<this._allAddedNodes.length;n++){var o=!0;if(i.length===this._allAddedNodes[n].length){for(var s=0;s<i.length&&!0===o;s++)i[s]!=this._allAddedNodes[n][s]&&(o=!1);o&&(this._allAddedNodes.splice(n,1),this._allAddedNodesLabels.splice(n,1),this._allAddedAliases.splice(n,1),t.remove(),this.dispatchEvent("updateAddDisplay"))}}},_updateAddDisplay:function(){var e=this._allAddedNodes.length,t=e<=1?"AddSingleNode":"AddMultiNode";this._addExpander.header=e+" "+a.get(t),0===e&&this._getPlaceHolder(a.get("SelectNodesToAddOnAppSide")).inject(this._addedNodesDiv);var i=this._addExpander.getContent().getElement(".wux-controls-expander-header");o.MAX_SELECTION_PATH<e?i.addClassName("contextCriterion-edit-header-maxPath"):o.MAX_SELECTION_PATH>=e&&i.removeClassName("contextCriterion-edit-header-maxPath"),o.MAX_SELECTION_PATH<e||o.MAX_SELECTION_PATH<this._allExcludedNodes.length?this._maxPathContainer.show():o.MAX_SELECTION_PATH>=e&&o.MAX_SELECTION_PATH>=this._allExcludedNodes.length&&this._maxPathContainer.hide()},_InsertExcludedPathInDiv:function(e,t){var i;e.cleanUI&&this._excludedNodesDiv.empty(),i="InsertAllPathsAtOnce"===t?{excludedNodesLabels:e.excludedNodesLabels?e.excludedNodesLabels:e.get("excludedNodesLabels")||[],excludedNodesList:e.excludedNodesList?e.excludedNodesList:e.get("excludedNodesList")||[]}:{excludedNodesLabels:[e.pathAlias],excludedNodesList:[e.selectedPath]};for(var n=0;n<i.excludedNodesLabels.length;n++){var o=new UWA.Element("div",{class:"context-chip-cell-container"}),s=new UWA.Element("span",{class:"context-chip-cell-close fonticon fonticon-close","font-family":"DSFontIcon"});s.onclick=this._removePathFromExcludedList.bind(this);let t=this._buildPathInfos(e.aliases[n]);var r=new v({value:t.label,maxDisplayLength:9999});r.getContent().addClassName("context-chip-cell-label");let a=r.getContent();r.tooltipInfos=t.toolTipMdl,r.inject(o),s.inject(o),o.inject(this._excludedNodesDiv),a.setAttribute("occId",i.excludedNodesList[n])}this.dispatchEvent("updateExcludeDisplay")},_removePathFromExcludedList:function(e){if(this.model.get("ExcludeNodeActivated"))for(var t=e.target.parentElement,i=t.getElement(".context-chip-cell-label").getAttribute("occId").split(","),n=0;n<this._allExcludedNodes.length;n++){var o=!0;if(i.length===this._allExcludedNodes[n].length){for(var s=0;s<i.length&&!0===o;s++)i[s]!=this._allExcludedNodes[n][s]&&(o=!1);o&&(this._allExcludedNodes.splice(n,1),this._allExcludedNodesLabels.splice(n,1),this._allExcludedAliases.splice(n,1),t.remove(),this.dispatchEvent("updateExcludeDisplay"))}}},_updateExcludeDisplay:function(){var e=this._allExcludedNodes.length,t=e<=1?"ExcludeSingleNode":"ExcludeMultiNode";this._excludeExpander.header=e+" "+a.get(t),0===e&&this._getPlaceHolder(a.get("SelectNodesToExcludeOnAppSide")).inject(this._excludedNodesDiv);var i=this._excludeExpander.getContent().getElement(".wux-controls-expander-header");o.MAX_SELECTION_PATH<e?i.addClassName("contextCriterion-edit-header-maxPath"):o.MAX_SELECTION_PATH>=e&&i.removeClassName("contextCriterion-edit-header-maxPath"),o.MAX_SELECTION_PATH<e||o.MAX_SELECTION_PATH<this._allAddedNodes.length?this._maxPathContainer.show():o.MAX_SELECTION_PATH>=e&&o.MAX_SELECTION_PATH>=this._allAddedNodes.length&&this._maxPathContainer.hide()},_createContextFilterUI:function(){var e=this,i=t.createElement("div",{}),n=new d(o.getAttributeButtonStyle("chevron-down"));n.domId="keepCtxMenu",n.displayStyle="lite",n.inject(i),this._ctxMenuAddWUX=this._createContextualMenuWUX(n.getContent(),"Add");e=this;n.getContent().addEventListener("click",(function(t){t.stopPropagation();var i=t.target.getBoundingClientRect();f.show(e._ctxMenuAddWUX,{position:o.getMenuPosition(i)})}));var s=e._allAddedNodes.length,r=e._allExcludedNodes.length,l=0>=s&&0>=r||0>=s,c=this.getElement(".contextCriterion-edit #nodesAddedList");this._addExpander=new _({domId:"keepExpander",header:a.get("AddNodesTitle"),expandedFlag:l,customHeader:i,style:"filled-separate"}),this._addExpander.inject(c,"before"),this._addExpander.body=c;var h=t.createElement("div",{}),p=new d(o.getAttributeButtonStyle("chevron-down"));p.domId="excludeCtxMenu",p.displayStyle="lite",p.inject(h),this._ctxMenuExcludeWUX=this._createContextualMenuWUX(p.getContent(),"Exclude");e=this;p.getContent().addEventListener("click",(function(t){t.stopPropagation();var i=t.target.getBoundingClientRect();f.show(e._ctxMenuExcludeWUX,{position:o.getMenuPosition(i)})}));var g=this.getElement(".contextCriterion-edit #nodesExcludedList");this._excludeExpander=new _({domId:"excludeExpander",header:a.get("ExcludeNodesTitle"),expandedFlag:l,//!expandState,
customHeader:h,style:"filled-separate"}),this._excludeExpander.inject(g,"before"),this._excludeExpander.body=g,this._addExpander.addEventListener("expand",(function(t){e._isAddedExpanded=1})),this._addExpander.addEventListener("collapse",(function(t){e._isAddedExpanded=0})),c.addEventListener("click",(function(t){e._isAddedActive||(c.addClassName("selected-nodes-active"),g.removeClassName("selected-nodes-active")),e._isAddedActive=1,e._isExcludedActive=0})),this._excludeExpander.addEventListener("expand",(function(t){e._isExcludedExpanded=1})),this._excludeExpander.addEventListener("collapse",(function(t){e._isExcludedExpanded=0})),g.addEventListener("click",(function(t){e._isExcludedActive||(c.removeClassName("selected-nodes-active"),g.addClassName("selected-nodes-active")),e._isExcludedActive=1,e._isAddedActive=0})),this.ConfirmCxtFilterButton=new d(o.getAttributeValidateButtonStyle()),this.ConfirmCxtFilterButton.label=a.get("validateCriterionLabel"),this.ConfirmCxtFilterButton.showLabelFlag=o.isLabelCriterionDisplayed();this.ConfirmCxtFilterButton.getContent().addClassName("attribute-edit-button-style"),this.ConfirmCxtFilterButton.inject(this.getElement("#"+this._getId()+" .buttonToValidate")),this.ConfirmCxtFilterButton.tooltipInfos=new m({shortHelp:a.get("ValidateCriteriaTooltip"),mouseRelativePosition:!0}),this.ConfirmCxtFilterButton.addEventListener("buttonclick",(function(t){var i=e._allAddedNodes.length,n=e._allExcludedNodes.length;if(0!==i&&u.setUsageTracker(e._widgetId,"NGF-Context-Add",{label:"Nb Added",value:e.model.get("AddNodeActivated")?i:-1}),0!==n&&u.setUsageTracker(e._widgetId,"NGF-Context-Exclude",{label:"Nb Excluded",value:e.model.get("ExcludeNodeActivated")?n:-1}),e._isAddedActive||e._isExcludedActive){let t=e.getElement(".selected-nodes-active");t&&t.removeClassName("selected-nodes-active"),e._isAddedActive=0,e._isExcludedActive=0}this._saveBeforeEdit={},e.isThereCriteria()?(o.isModelActivated(e.model)||!0!==e._isCriterionModified()||e._switchCriterionState(),e.dispatchEvent("NGF_Criterion_Validation",{criteriaType:e.model.get("criteriaType")})):e.destroy()}))},_cancelEditCriteria:function(){this._resetAddedNodes(),this._resetExcludedNodes(),this._allAddedNodes=t.clone(this._saveBeforeEdit.addedNodesList),this._allAddedNodesLabels=t.clone(this._saveBeforeEdit.addedNodesLabels),this._allExcludedNodes=t.clone(this._saveBeforeEdit.excludedNodesList),this._allExcludedNodesLabels=t.clone(this._saveBeforeEdit.excludedNodesLabels),this._allAddedAliases=t.clone(this._saveBeforeEdit.addedAliases),this._allExcludedAliases=t.clone(this._saveBeforeEdit.excludedAliases),this.model.set("AddNodeActivated",t.clone(this._saveBeforeEdit.AddNodeActivated)),this.model.set("addedNodesList",this._allAddedNodes),this.model.set("addedNodesLabels",this._allAddedNodesLabels),this.model.set("addedAliases",this._allAddedAliases),this.model.set("ExcludeNodeActivated",t.clone(this._saveBeforeEdit.ExcludeNodeActivated)),this.model.set("excludedNodesList",this._allExcludedNodes),this.model.set("excludedNodesLabels",this._allExcludedNodesLabels),this.model.set("excludedAliases",this._allExcludedAliases),this._InsertPathInDiv(this._saveBeforeEdit,"InsertAllPathsAtOnce"),this._setStateOfAddNodes(!this._saveBeforeEdit.AddNodeActivated),this._updateContextualmenuFromModel("Add"),this._InsertExcludedPathInDiv(this._saveBeforeEdit,"InsertAllPathsAtOnce"),this._setStateOfExcludeNodes(!this._saveBeforeEdit.ExcludeNodeActivated),this._updateContextualmenuFromModel("Exclude"),this._manageExpandCollapseNodes()},_onStateChange:function(e,t){var i=this.model.criterionToString();if("string"==typeof i||Array.isArray(i)){var n=this.getElement(".f-context-container");n.setAttribute("class","f-context-container "+t);let e=n.getElement(".contextCriterion-read .criterionDropDown"),s=n.getElement(".contextCriterion-edit .criterionDropDown");if("read"===t){s&&s.removeClassName("focused"),e&&e.addClassName("focused"),this._subscribe0&&this._subscribe0.unsubscribe("NGFilter.OccPath"),delete this._subscribe0,this._subscribe1&&this._subscribe1.unsubscribe("DS/ENO/select"),this._subscribe2&&this._subscribe2.unsubscribe("DS/PADUtils/PADCommandProxy/select"),delete this._subscribe1,delete this._subscribe2;var o=Array.isArray(i)?i:[i];this.getElement(".contextRead#value").setContent([{tag:"span",html:o[0]}]),this._setContextualMenu("read")}else e&&e.removeClassName("focused"),s&&s.addClassName("focused"),this._subscribe0=c.subscribe("NGFilter.OccPath",this._onOccPathSelect.bind(this)),this._subscribe1=c.subscribe("DS/ENO/select",this._setSelectionFromEvent.bind(this)),this._subscribe2=c.subscribe("DS/PADUtils/PADCommandProxy/select",this._setSelectionFromEvent.bind(this)),this._setContextualMenu("edit"),this._manageExpandCollapseNodes(),this.dispatchEvent("NGF_Criterion_SwitchedToEdit",{type:this.model.get("criteriaType"),state:1})}else"object"==typeof i&&console.log("Criteria Selection Error / Invalid expected type on state change")},viewFromMdl:function(e){var t=this,i=e.get("AddNodeActivated")||!0;this._allAddedNodes=e.get("addedNodesList")||[];var n=e.get("ExcludeNodeActivated")||!0;this._allExcludedNodes=e.get("excludedNodesList")||[],this.model.set("AddNodeActivated",i),this.model.set("addedNodesList",this._allAddedNodes),this.model.set("ExcludeNodeActivated",n),this.model.set("excludedNodesList",this._allExcludedNodes),this._allSelectedPath=[];var s=[];this._allAddedNodes.length&&this._allAddedNodes.forEach((e=>{this._allSelectedPath.push(e),s.push(...e)}));var r=[];this._allExcludedNodes.length&&this._allExcludedNodes.forEach((e=>{this._allSelectedPath.push(e),r.push(...e)}));var a=[...new Set(s.concat(r))];if(a.length){var l=function(e,t){var i=[],n=[];let o=t.results.length;return e.forEach((e=>{let s=[];e.forEach((e=>{for(let a=0;a<o;a++){var i=t.results[a].attributes,n=i.find((t=>"resourceid"===t.name&&e===t.value));if(n){var r=i.find((e=>"ds6wg:revision"===e.name));(n=i.find((e=>"ds6w:label"===e.name)))&&s.push((n.dispValue||n.value)+(r?" - "+r.value:""));break}}})),i.push(s),n.push(s[s.length-1])})),{path:i,last:n}};o.executeFetch(a,[],["ds6w:label","ds6wg:revision"]).then((function(i){e.cleanUI=1;let n=l(t._allAddedNodes,i);e.aliases=n.path,t._allAddedNodesLabels=[],t._allAddedAliases=[];for(const e of n.path)t._allAddedNodesLabels.push(t._formatPath(e,"short",t._pathDisplayMode)),t._allAddedAliases.push(t._formatPath(e,"long",t._pathDisplayMode));t.model.set("addedNodesLabels",t._allAddedNodesLabels),t._InsertPathInDiv(e,"InsertAllPathsAtOnce"),delete e.aliases,n=l(t._allExcludedNodes,i),e.aliases=n.path,t._allExcludedNodesLabels=[],t._allExcludedAliases=[];for(const e of n.path)t._allExcludedNodesLabels.push(t._formatPath(e,"short",t._pathDisplayMode)),t._allExcludedAliases.push(t._formatPath(e,"long",t._pathDisplayMode));t.model.set("excludedNodesLabels",t._allExcludedNodesLabels),t._InsertExcludedPathInDiv(e,"InsertAllPathsAtOnce"),delete e.aliases,delete e.cleanUI,t._setStateOfNodesFromModel(),t._updateContextualmenuFromModel("Add"),t._updateContextualmenuFromModel("Exclude")}))}},_getDOMElementToUpdateOnActivateChange:function(){var e=[];let t=this.getElement("#"+this._getId()+" .contextCriterion-read");return e.push(t.getElement("#readHeader")),e.push(t.getElement("img")),e},_getCallbackToEditCriterion:function(){return this._editContext.bind(this)},isCriterionValidate:function(){if(0===o.isAsynchronousValidation())return!0;var e=this;return new i((function(t){e.isThereCriteria()?o.isModelActivated(e.model)||!0!==e._isCriterionModified()||e._switchCriterionState():e.destroy(),t(!0)}))},_isCriterionModified:function(){var e=JSON.stringify(this.model.keepComponentsToFeedUI(!0));return this._saveBeforeEdit.asString!==e},isThereCriteria:function(){var e=this.model.get("addedNodesList")||[],t=this.model.get("excludedNodesList")||[];return!(!e.length&&!t.length)},_resetAddedNodes:function(){var e=this;e._allAddedNodes.splice(0),e._allAddedNodesLabels.splice(0),e._allAddedAliases.splice(0),e._addExpander.getContent().removeClassName("f-criterion-deactivated"),e.getElement("#nodesAddedList").getElements(".context-chip-cell-container").forEach((function(e){e.remove()})),e.dispatchEvent("updateAddDisplay"),e.model.set("AddNodeActivated",!0),e._updateContextualmenuFromModel("Add")},_resetExcludedNodes:function(){var e=this;e._allExcludedNodes.splice(0),e._allExcludedNodesLabels.splice(0),e._allExcludedAliases.splice(0),e._excludeExpander.getContent().removeClassName("f-criterion-deactivated"),e.getElement("#nodesExcludedList").getElements(".context-chip-cell-container").forEach((function(e){e.remove()})),e.dispatchEvent("updateExcludeDisplay"),e.model.set("ExcludeNodeActivated",!0),e._updateContextualmenuFromModel("Exclude")},_createContextualMenuWUX:function(e,t){var i=function(e){var t,i,n=e.context.action;"Add"===n?(t="AddNodeActivated",i=this._setStateOfAddNodes.bind(this)):(t="ExcludeNodeActivated",i=this._setStateOfExcludeNodes.bind(this));var o=this.model.get(t);i(o),this.model.set(t,!o),this._updateContextualmenuFromModel(n)},n={type:"PushItem",recId:"activate-item-DDCtx",title:a.get("activatedCriteria"),icon:o.getIconByName("eye"),action:{this:this,callback:i,context:{action:t}}},s={type:"PushItem",recId:"activate-item-DDCtx",title:a.get("deactivatedCriteria"),icon:o.getIconByName("eye-off"),action:{this:this,callback:i,context:{action:t}}},r={type:"PushItem",recId:"reset-item-DDCtx",title:a.get("ResetNodes"),icon:o.getIconByName("clear"),action:{this:this,callback:"Add"===t?this._resetAddedNodes:this._resetExcludedNodes}};return"Add"===t?(this._activateAddItem=n,this._deactivateAddItem=s):(this._activateExcludeItem=n,this._deactivateExcludeItem=s),[s,r]},_setStateOfNodesFromModel:function(){var e=this.model.get("AddNodeActivated");this._setStateOfAddNodes(!e),e=this.model.get("ExcludeNodeActivated"),this._setStateOfExcludeNodes(!e)},_setStateOfAddNodes:function(e){[this._addExpander.getContent().getElement(".headerTitle"),this._addExpander.getContent().getElement(".wux-controls-expander-body")].forEach((function(t){e?t.addClassName("f-criterion-deactivated"):t.removeClassName("f-criterion-deactivated")}))},_setStateOfExcludeNodes:function(e){[this._excludeExpander.getContent().getElement(".headerTitle"),this._excludeExpander.getContent().getElement(".wux-controls-expander-body")].forEach((function(t){e?t.addClassName("f-criterion-deactivated"):t.removeClassName("f-criterion-deactivated")}))},_updateContextualmenuFromModel:function(e){if("Add"===e){var t=this.model.get("AddNodeActivated");this._ctxMenuAddWUX[0]=t?this._deactivateAddItem:this._activateAddItem}else if("Exclude"===e){t=this.model.get("ExcludeNodeActivated");this._ctxMenuExcludeWUX[0]=t?this._deactivateExcludeItem:this._activateExcludeItem}},buildViewFromRepairModel:function(e){if(e.get("criteriaType")===this.model.get("criteriaType")){this.model.set("state","edit");var t=this.getContent(),i=t.querySelector("#nodesAddedList");i&&i.empty();var n=t.querySelector("#nodesExcludedList");n&&n.empty(),this.viewFromMdl(e),this.model.set("state","read");var o=this.model.get("addedNodesList")||[],s=this.model.get("excludedNodesList")||[];0===o.length&&0===s.length&&this.destroy()}},updateModelFromRepair:function(e){var t=this;if(e&&Array.isArray(e)&&2>e.length)return{modelUpdated:!1,attributes:void 0};var i=e[0],n=[];e[1].length&&e[1].forEach((function(e){e.attributes.forEach((function(e){"logicalid"===e.name&&n.push(e.value)}))}));var o=this.model.get("repairFilterInfo"),s=function(o,s,r){var a=!1;if(o)for(var l=o.length,d=0;d<l;d++){var c=o[d],u=n.indexOf(c);if(-1===u)a=!0;else{var h=e[1][u].attributes[0].value,p=e[1][u].attributes.findIndex((function(e){return"ds6w:label"===e.name})),_=e[1][u].attributes[p].value;_+=-1===(p=e[1][u].attributes.findIndex((function(e){return"ds6wg:revision"===e.name})))?"":" "+e[1][u].attributes[p].value;for(var m=0;m<i.length;m++)-1!==i[m].indexOf(h)&&!1===t._isPathPresent(s,i[m])&&(s.push(i[m]),r.push(_),a=!0)}}return a},r=[],a=[],l=this.model.get("addedNodesList"),d=this.model.get("addedNodesLabels"),c=s(o?o.logicalID_OfAddedPaths:[],r,a);this.model.set("addedNodesList",l.concat(r)),this.model.set("addedNodesLabels",d.concat(a)),r=[],a=[];var u=this.model.get("excludedNodesList"),h=this.model.get("excludedNodesLabels"),p=s(o?o.logicalID_OfExcludedPaths:[],r,a);this.model.set("excludedNodesList",u.concat(r)),this.model.set("excludedNodesLabels",h.concat(a));var _=c||p;return{modelUpdated:_,attributes:_?this.model:void 0}},_isPathPresent:function(e,t){let i=!1,n=e.length,o=t.length;for(var s=0;s<n&!i;s++){i=!0;let n=e[s],a=Math.min(n.length,o);for(var r=0;r<a;r++)i=n[r]==t[r]&&i}return i}})})),define("DS/ENONextGenFilterUX/views/VolumeCombinationView",["UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Model","DS/ENONextGenFilterUX/views/VolumeView","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/TooltipModel","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENONextGenFilterUX/models/CriterionModel","DS/PlatformAPI/PlatformAPI","DS/ENOFilterBIUX/NGFServices"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h){"use strict";var p=0,_=0,m=i.extend({domEvents:{},tagName:"div",className:"attribute-edit-group",setup:function(e){this._UXId=e.UXId,this._rootId=e.rootId,this._NGFUXId=e.NGFUXId,this._widgetId=e.widgetId,this._filterSpecId=e.filterSpecId,this._volSetId=e.volSetId||0,this._deepGroup=e.deepGroup||0,this._displayMode=e.displayMode||"light",this._sendEvent=e.sendEvent,this._initCombination=e.initCombination||0,this._volEditInputs=e.volEditInputs,this._listOfVolumes=[],this._subscribe0=u.subscribe("NGFilter_VolumeDefined",this._onVolumeDefined.bind(this)),this._subscribe1=u.subscribe("NGFilter_VolumeDefined_Init",this._onVolumeDefinedInit.bind(this)),this._subscribe2=u.subscribe("NGFilter_CancelVolumeDefined",this._onCancelVolumeDefined.bind(this))},render:function(){var t="combinationVolume_"+this._filterSpecId+this._volSetId;this.container.setAttribute("id",t);var i=this.getContent();this._divCombination=e.createElement("div",{class:"attribute-edit-group-Combination"}),this._divCombination.inject(this._volEditInputs||i);var n="withAttribute";return this._withLabel=this._createCombinationLabel(n,"with"),this._withLabel.inject(this._divCombination),this._combinationCombo=this._createCombinationCombo(this._initCombination),this._combinationCombo.inject(this._divCombination),n="FollowingCombination",this._followingLabel=this._createCombinationLabel(n,"following"),this._followingLabel.inject(this._divCombination),this._removeBtn=this._createRemoveGroupButton(),this._removeBtn.inject(this._divCombination),this._setDisplayMode(this._displayMode||"light"),this._createVolume(),this},destroy:function(){this.cleanVolumes(),p=0===this._deepGroup?0:p,_=0,this._subscribe0&&(this._subscribe0.unsubscribe("NGFilter_VolumeDefined"),this._subscribe0=void 0),this._subscribe1&&(this._subscribe1.unsubscribe("NGFilter_VolumeDefined_Init"),this._subscribe1=void 0),this._subscribe2&&(this._subscribe2.unsubscribe("NGFilter_CancelVolumeDefined"),this._subscribe2=void 0),this.stopListening(),this.model=null,this._parent(),this.container=null},_setDisplayMode:function(e){switch(e){case"none":case"light":this._divCombination.hide();break;case"middle":this._divCombination.show(),this._withLabel.show(),this._followingLabel.show(),this._removeBtn.hide();break;case"full":this._divCombination.show(),this._withLabel.show(),this._followingLabel.show()}},_createCombinationLabel:function(t,i){return e.createElement("label",{class:"innerfiltertypecombo",text:s.get(t),id:"combination-"+i+"_"+this._volSetId})},_createCombinationCombo:function(t){var i=[{labelItem:s.get("AllCombination"),valueItem:"all"},{labelItem:s.get("AnyCombination"),valueItem:"any"}],n=new r({touchMode:d.TOUCH_MODE,elementsList:i,enableSearchFlag:!1,domId:"combination-combo_"+this._volSetId}),o=this;return n.addEventListener("change",(function(e){var t=e.dsModel.currentValue;o.model.set("combination",t),o._initCombination=e.dsModel.selectedIndex,o._anyObjectCombinationAnchor.setText(s.get("all"===t?"AllCombination":"AnyCombination"))})),this._anyObjectCombination=e.createElement("label",{class:"innerfiltertypecombo filter-anyobject-on"}),this._anyObjectCombination.inject(this._divCombination),this._anyObjectCombinationAnchor=e.createElement("a",{text:n.currentLabel,id:"anyObject_combination"}),this._anyObjectCombinationAnchor.inject(this._anyObjectCombination),this._anyObjectCombinationAnchor.addEventListener("click",(function(e){var t="all"===o.model.get("combination")?"any":"all";o.model.set("combination",t),e.target.setText(s.get("all"===t?"AllCombination":"AnyCombination")),n.currentValue=t})),n.getContent().removeClassName("filter-anyobject-off"),n.hide(),this._anyObjectCombination.removeClassName("filter-anyobject-on"),this._anyObjectCombination.show(),this.model.set("combination",i[t].valueItem),n.selectedIndex=t,n},_createRemoveGroupButton:function(){var e=new a(d.getAttributeButtonStyle("group-delete"));e.tooltipInfos=new l({shortHelp:s.get("RemoveVolumeGroup"),mouseRelativePosition:!0}),e.getContent().addClassName("attribute-edit-button-style attribute-edit-group-remove-btn");var t=this;return e.addEventListener("click",(function(e){t.dispatchEvent("NGF_RemoveVolumeGroup",{volId:t.container.getAttribute("id")})})),e},_createVolume:function(e){var t=1,i=this.getElement("#actions_"+this._volSetId);i||(t=0,i=this.getContent()),0===this._deepGroup&&this._updateVolumeUI("volume");var n=new c,s=this.model.get("allVolumes")||[];s.push(n),this.model.set("allVolumes",s),this.model.set("state","edit");var r=new o({model:n,filterSpecId:this._filterSpecId,volSetId:this._volSetId,idVol:p});p++,r.render().inject(i,t?"before":""),r.setFocus(),this._showAddButtons(!1),this._listOfVolumes.push(r),this._highlightVolumeGroup(),this.listenTo(r,"NGF_RemoveVolume",this._onRemoveVolume.bind(this)),this.listenTo(r,"NGF_VolumeSelected",this._onSelectedVolume.bind(this)),e?(r.model.set("parameters",e.volume),r.model.set("state","read")):this._sendEvent&&(this._onSelectedVolume(r.getValues()),r.model.set("state","edit"))},_highlightVolumeGroup:function(){var e=window.document.body.getElement(".f-volume-container.edit");if(e){var t=e.getElement(".attribute-edit-group-selected");t&&t.removeClassName("attribute-edit-group-selected")}0!==this._deepGroup&&this.getContent().addClassName("attribute-edit-group-selected")},_onAddVolumeGroup:function(){this._onValidateEditedVolume();var t=1,i=this.getElement("#actions_"+this._volSetId);i||(t=0,i=this.getContent()),0===this._deepGroup&&this._updateVolumeUI("group");var o=new n;o.set("isActivated","1"),o.set("state","edit");var s=this.model.get("allVolumes")||[];s.push(o),this.model.set("allVolumes",s),this.model.set("state","read"),_++;var r=new m({UXId:this._UXId,NGFUXId:this._NGFUXId,widgetId:this._widgetId,model:o,volSetId:_,initCombination:this._initCombination?0:1,displayMode:"full",deepGroup:this._deepGroup+1,sendEvent:this._sendEvent,filterSpecId:this._filterSpecId});r.render().inject(i,t?"before":""),this._showAddButtons(!0),r.getContent().addClassName("subgroupdivborder"),r._highlightVolumeGroup();var a=r._listOfVolumes.length;a&&r._listOfVolumes[a-1].setFocus(),this._listOfVolumes.push(r),this.listenTo(r,"NGF_RemoveVolumeGroup",this._onRemoveVolume.bind(this)),this.listenTo(r,"NGF_ValidateEditedVolume",this._onValidateEditedVolume.bind(this)),r._divAction=e.createElement("div",{class:"attr-edit-actions",id:"actions_"+_}),r._divAction.inject(r.getContent()),r.addVolumeBtn=r._createAddVolumeButton(r),r.addVolumeBtn.inject(r._divAction),r.addVolumeGroupBtn=r._createAddVolumeGroupButton(r),r.addVolumeGroupBtn.inject(r._divAction)},_showAddButtons:function(e){0===this._deepGroup&&this.dispatchEvent("NGF_DisplayAddActions",{display:e})},_onRemoveVolume:function(e){this._onValidateEditedVolume(),this._removeVolumeAndUpdateUI(e),d.resetSelectedVolumeOf3D(this._NGFUXId,this._widgetId,this._rootId)},cleanVolumes:function(){this._divCombination.destroy()},_removeVolumeAndUpdateUI:function(e){for(var t=e.volId,i=this._listOfVolumes.length-1;i>=0;i--)if(this._listOfVolumes[i].container.id===t){this._removeVolume(i),1>=this._listOfVolumes.length&&0===this._deepGroup&&this._switchToSingleVolume(),0===this._listOfVolumes.length&&(0!==this._deepGroup?this.dispatchEvent("NGF_RemoveVolumeGroup",{volId:this.getContent().id}):(p=0,this._setDisplayMode("none"),this.dispatchEvent("NGF_RemoveCriterion",{})));break}var n=this._listOfVolumes.length;if(1<=n){var o=this._listOfVolumes[n-1];this._isGroup(o)||0===this._deepGroup?this._showAddButtons(!1):(o.showAddButtons(!0),this._highlightVolumeGroup())}},_removeVolume:function(e){for(var t=e||0,i=e+1||this._listOfVolumes.length,n=i-1;n>=t;n--)this._listOfVolumes[n].destroy();this._listOfVolumes.splice(t,i-t);var o=this.model.get("allVolumes");o&&o.splice(t,i-t),this.model.set("allVolumes",o)},_onVolumeDefinedInit:function(e){this._onVolumeDefined(e)},_onCancelVolumeDefined:function(){0===this._deepGroup&&(this.removeEmptyVolume(),this.model&&this.model.set("state","edit"),d.resetSelectedVolumeOf3D(this._NGFUXId,this._widgetId,this._rootId),u.publish("NGF_Criterion_Edition",{}))},_onVolumeDefined:function(e){if(this._UXId===e.UXId){var t=this,i=function(e){h.setUsageTracker(t._widgetId,"NGF-Volume-Type",e)};if("edit"===this.model.get("state")){if(!(void 0!==e.specId&&this._filterSpecId!==e.specId||void 0!==e.setId&&this._volSetId!==e.setId)){var n,o=e.action;if(e.id)for(var s=this._listOfVolumes.length,r=0;r<s;r++){if((c=this._listOfVolumes[r])&&c.model.get("id")===e.id&&(n=c.model,"add"===o&&"edit"===n.get("state")&&c.isEmpty())){o="update";break}}"add"===o?(i(e.volume.type),this._onValidateEditedVolume(),this.createVolume(e),d.resetSelectedVolumeOf3D(this._NGFUXId,this._widgetId,this._rootId)):"update"===o&&(n||1!==this._listOfVolumes.length||(n=this._listOfVolumes[0].model),n&&(n.get("parameters")&&n.get("parameters").type===e.volume.type||i(e.volume.type),n.set("state","edit"),n.set("parameters",e.volume),n.set("state","read"))),d.openFilterPanel("volume_"+Date.now())}}else if("add"===e.action&&0===this._deepGroup){i(e.volume.type);var a,l=this._listOfVolumes.length;for(r=0;r<l;r++){var c;if((c=this._listOfVolumes[r])&&"edit"===c.model.get("state")){a=c;break}}a||(this.dispatchEvent("NGF_SwitchToEdit",{}),this.createVolume(e),d.resetSelectedVolumeOf3D(this._NGFUXId,this._widgetId,this._rootId),d.openFilterPanel("volume_"+Date.now()))}}},_onValidateEditedVolume:function(){if(0===this._deepGroup){var e=function(t){var i=0;if(t){for(var n=t.get("allVolumes")||[],o=n.length,s=0;s<o&&!i;s++){var r=n[s];r.get("allVolumes")?i=e(r):"edit"===r.get("state")&&(r.set("state","read"),i=1)}t.set("state","read")}};e(this.model)}else this.dispatchEvent("NGF_ValidateEditedVolume",{})},_onSelectedVolume:function(t){this._onValidateEditedVolume(),this.model.set("state","edit");let i=t.parameters;i&&"box"===i.type&&!i.transformation_matrix&&(i=e.clone(i),i.transformation_matrix=[1,0,0,0,1,0,0,0,1,0,0,0]);var n={NGFUXId:this._NGFUXId,appId:this._NGFUXId,widgetId:this._widgetId,action:"update",id:t.id,displayName:t.displayName,filteredRoot:this._rootId,volume:i};u.publish("NGFilter_Volume",n)},_updateVolumeUI:function(e){0===this._listOfVolumes.length?"volume"===e?this._setDisplayMode("light"):"group"===e&&(this._divCombination.addClassName("attribute-edit-group"),this.getContent().removeClassName("attribute-edit-group"),this._setDisplayMode("none"),this.dispatchEvent("NGF_SwitchDisplayContext",{context:1,combination:this._divCombination,view:this})):1!==this._listOfVolumes.length||this._isGroup(this._listOfVolumes[0])?this._setDisplayMode("full"):(this._divCombination.addClassName("attribute-edit-group"),this.getContent().removeClassName("attribute-edit-group"),this._listOfVolumes[0].showRemoveButton(!0),this._listOfVolumes[0].showAddButtons(!1),this._setDisplayMode("middle"),this.dispatchEvent("NGF_SwitchDisplayContext",{context:1,combination:this._divCombination,view:this}))},_switchToSingleVolume:function(){if(0===this._listOfVolumes.length)this._divCombination.removeClassName("attribute-edit-group"),this.getContent().addClassName("attribute-edit-group"),this.dispatchEvent("NGF_SwitchDisplayContext",{context:0,view:this});else if(1===this._listOfVolumes.length)if(this._isGroup(this._listOfVolumes[0]))this._setDisplayMode("none");else{this._divCombination.removeClassName("attribute-edit-group"),this.getContent().addClassName("attribute-edit-group");var e=this._listOfVolumes[0];e.showRemoveButton(!0),e.showAddButtons(!1),this._setDisplayMode("light"),this.dispatchEvent("NGF_SwitchDisplayContext",{context:0,view:this})}},isVolumeValid:function(){for(var e=[],t=this._listOfVolumes.length,i=0;i<t;i++){var n=this._listOfVolumes[i];if(this._isGroup(n))e=n.isVolumeValid();else{var o=n.isVolumeValid();if(!o.isValid){var s=o.errorKey;void 0===e[s]&&(e[s]=""),e[s]+="<br>   "+o.errorMsg}}}return e},_isGroup:function(e){return!!e._listOfVolumes},removeEmptyVolume:function(){var e=this;this._onValidateEditedVolume();let t=function(i){for(let o=i._listOfVolumes.length-1;o>=0;o--){var n=i._listOfVolumes[o];e._isGroup(n)?t(n):n.isEmpty()&&i._removeVolumeAndUpdateUI({volId:n.getContent().id})}};t(this)},redrawVolumeSpecification:function(){var e=this,t=function(i){i._listOfVolumes.forEach((i=>{e._isGroup(i)?t(i):i.redrawVolumeSpecification()}))};t(this)},viewFromMdl:function(e){var t=this._sendEvent;this._sendEvent=0;var i=e.allVolumes;this._buildVolumeFromModel(i[0]),this._sendEvent=t},_buildVolumeFromModel:function(e){var t=e.allVolumes;this._combinationCombo.currentValue=e.combination;for(var i=t.length,n=0;n<i;n++){if(t[n].allVolumes)this._onAddVolumeGroup(),this._listOfVolumes[this._listOfVolumes.length-1]._buildVolumeFromModel(t[n]);else this._listOfVolumes.length<n+1&&this._createVolume(),this._listOfVolumes[n].volumeViewFromMdl(t[n])}this._sendEvent=1},createVolume:function(e){this._createVolume(e)},createVolumeGroup:function(){this._onAddVolumeGroup()},_createAddVolumeButton:function(e){var t=new a(d.getAttributeButtonStyle("plus"));t.tooltipInfos=new l({shortHelp:s.get("AddVolume"),mouseRelativePosition:!0}),t.getContent().addClassName("attribute-edit-button-style attribute-edit-add-btn2");var i=e;return t.addEventListener("click",(function(e){i._createVolume()})),t},_createAddVolumeGroupButton:function(e){var t=new a(d.getAttributeButtonStyle("group-add"));return t.tooltipInfos=new l({shortHelp:s.get("AddVolumeGroup"),mouseRelativePosition:!0}),t.getContent().addClassName("attribute-edit-button-style attribute-edit-addGroup-btn2"),d.MAX_DEEP_VOLUME_GROUP==e._deepGroup?(t.disabled=!0,t.active=!1):t.addEventListener("click",(function(t){e._onAddVolumeGroup()})),t}});return m})),define("DS/ENONextGenFilterUX/views/CriteriaVolumeView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Promise","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Handlebars/Handlebars4","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/Controls/Button","DS/Controls/TooltipModel","DS/ENONextGenFilterUX/views/VolumeCombinationView","text!DS/ENONextGenFilterUX/templates/volumeViewTemplate.html"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h){"use strict";return e.extend({className:"volumeCriterion",tagName:"li",domEvents:{"click .volumeCriterion-read .volumeRead":"_onEditAttribute","click .volumeCriterion-read .volumeRead-multi-attr":"_onEditAttribute"},setup:function(e){this._parent(e),this._filterSpecId=e.filterSpecId,this._rootId=e.rootId,this._template=r.compile(h),this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this)),this._sendEvent=e.sendEvent,this._volumeFilterIcon=l.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_VolumeFilter.png"),this._volumeTypeIcons=[],this._volumeTypeIcons.box=l.getWebappsAssetUrl("ENONextGenFilterUX","icons/16/Box.png"),this._volumeTypeIcons.sphere=l.getWebappsAssetUrl("ENONextGenFilterUX","icons/16/Sphere.png"),this._volumeTypeIcons.proximity=l.getWebappsAssetUrl("ENONextGenFilterUX","icons/16/Proximity.png")},render:function(){this.container.setContent(this._template({stateClass:this.model.get("state"),titleClass:a.get("titleVolumeUX"),titleVolumeReadUX:a.get("titleVolumeReadUX"),touchMode:s.FILTER_TOUCH,iconHeader:this._volumeFilterIcon})),this._createHeaderCtxMenu();let e=this.container.getElement(".volumeCriterion-edit .criterionDropDown");return e&&e.addClassName("focused"),this.attrEditInputs=this.getElement(".attributeCriterion-edit .attr-edit-inputs"),this.attrEditInputsAttr=this.getElement(".attributeCriterion-edit .attr-edit-inputs-allAttributes"),this.attrEditActions=this.getElement(".attributeCriterion-edit .attr-edit-actions"),this.attrEditInputsAttr.hide(),this.addVolumeBtn=this._createAddVolumeButton(this.attrEditActions),this.addVolumeGroupBtn=this._createAddVolumeGroupButton(this.attrEditActions),this._validateButton=this._createValidateButton(),this._createVolumeCombination(),this.listenTo(this._combinationView,"NGF_RemoveCriterion",this.destroy.bind(this)),this},destroy:function(){s.resetSelectedVolumeOf3D(this._NGFUXId,this._widgetId,this._rootId),this._combinationView&&this._combinationView.destroy(),this.dispatchEvent("NGF_RemoveCriterion",{idxView:this.cid,criteriaType:this.model.get("criteriaType"),edited:"edit"===this.model.get("state")?1:0}),this.stopListening(),this.model=null,this._parent(),this.container=null},_createHeaderIcon:function(){t.createElement("img",{src:this._volumeFilterIcon,height:"22px"}).inject(this.getElement(".attributeCriterion-edit .criteriaIcon"))},_createHeaderCtxMenu:function(){this._createCriterionCtxMenuWUX(this.getElement(".criterionDropDown")),this._setContextualMenu("edit")},_cancelEditCriteria:function(){this._createVolumeCombination(),this.listenTo(this._combinationView,"NGF_RemoveCriterion",this.destroy.bind(this)),this._savedBeforeEdit&&this.viewFromMdl(this._savedBeforeEdit)},onStateChange:function(e,t){var i=this,n=this.getElement(".f-volume-container");n.setAttribute("class","f-volume-container "+t);let o=n.getElement(".volumeCriterion-read .criterionDropDown"),r=n.getElement(".volumeCriterion-edit .criterionDropDown");if("read"===t){o&&o.addClassName("focused"),r&&r.removeClassName("focused");var l="",d="",c=this._isThereVolumeActivated(this._combinationView.model);if(c){var u=this.model.criterionToString();u&&1<u.length&&(l=u.shift()),l=u&&1<u.length?l:"",d=this._getVolumeHTML(u)}else d=a.get("noVolumeActivated");let e;this.getElement("#readHeader #prefix").setText(a.get(l?"titleVolumeUX":"titleVolumeReadUX")+" "+l),u&&1<u.length?(this.getElement(".volumeRead#value").hide(),e=this.getElement(".volumeRead-multi-attr")):(this.getElement(".volumeRead-multi-attr").hide(),e=this.getElement(".volumeRead#value")),e.setHTML(d),e.show(),this._setContextualMenu("read"),c||this._switchCriterionState()}else{o&&o.removeClassName("focused"),r&&r.addClassName("focused"),this._savedBeforeEdit=this.model.keepComponentsToFeedUI(!0);var h=s.getLengthUnit();s.getLengthUnitPreference().then((e=>{e&&h.unit!==e.unit&&(s.setLengthUnit(e),i._combinationView.redrawVolumeSpecification()),this._setContextualMenu("edit"),this.dispatchEvent("NGF_Criterion_SwitchedToEdit",{type:i.model.get("criteriaType"),state:1})}))}},_isThereVolumeActivated:function(e){for(var t=0,i=e.get("allVolumes")||[],n=i.length,o=0;o<n&&!t;o++){var s=i[o];s.get("allVolumes")?t=this._isThereVolumeActivated(s):"1"===s.get("isActivated")&&(t=1)}return t},_getVolumeHTML:function(e){for(var t="",i=0;i<e.length;i++)if(Array.isArray(e[i])){var n=e[i];t+='<li class="volumeRead-multi-attr-group">'+n[0],t+='<ul class="volumeRead-multi-attr"><div>',n.shift(),t+=this._getVolumeHTML(n),t+="</div></ul></li>"}else{var o=this._getInfosVolumeFromName(e[i],this._combinationView.model),s=o.type?'<img src="'+this._volumeTypeIcons[o.type]+'">':"";t+="<li"+("0"===o.isActivated?' class="f-criterion-deactivated"':"")+">"+s+e[i]+"</li>"}return t},_getInfosVolumeFromName:function(e,t){for(var i={},n=t.get("allVolumes")||[],o=n.length,s=0;s<o&&!i.type;s++){var r=n[s];if(r.get("allVolumes"))i=this._getInfosVolumeFromName(e,r);else if(r.get("displayName")===e){var a=r.get("parameters");i={isActivated:r.get("isActivated"),type:a?a.type:void 0}}}return i},_getDOMElementToUpdateOnActivateChange:function(){var e=[];let t=this.getElement("#"+this._getId()+" .volumeCriterion-read");return e.push(t.getElement("#readHeader")),e.push(...t.getElements("img")),e},_getCallbackToEditCriterion:function(){return this._editVolume.bind(this)},_editVolume:function(){this.model.set("state","edit"),this._combinationView.model.set("state","edit")},_isCriterionModified:function(){var e=!1;if(this.model){let t=JSON.stringify(this.model.keepComponentsToFeedUI(!0));e=JSON.stringify(this._savedBeforeEdit)!==t}return e},isCriterionValidate:function(){var e=this;if(0===s.isAsynchronousValidation()){this.model.get("state");return!0,e._combinationView.removeEmptyVolume(),s.resetSelectedVolumeOf3D(e._NGFUXId,e._widgetId,e._rootId),s.isModelActivated(e.model)||!0!==e._isCriterionModified()||e._switchCriterionState(),true}return new o((function(t){e._combinationView.removeEmptyVolume(),s.resetSelectedVolumeOf3D(e._NGFUXId,e._widgetId,e._rootId),s.isModelActivated(e.model)||!0!==e._isCriterionModified()||e._switchCriterionState(),e._savedBeforeEdit=void 0,t(!0)}))},viewFromMdl:function(e){this._combinationView.viewFromMdl(e),this._repairInfos=e.repairFilterInfo?{proximityPath:e.proximityPath,repairInfo:e.repairFilterInfo}:{},"0"===e.isActivated&&this._switchCriterionState()},_createVolumeCombination:function(){this._combinationView&&(this._combinationView.destroy(),this.model.set("allVolumes",[]));var e=new n;e.set("isActivated","1"),e.set("state","edit");var t=[];t.push(e),this.model.set("allVolumes",t),this._combinationView=new u({UXId:this._UXId,NGFUXId:this._NGFUXId,widgetId:this._widgetId,rootId:this._rootId,model:e,attrEditInputs:this.attrEditInputs,attrEditInputsAttr:this.attrEditInputsAttr,sendEvent:this._sendEvent,filterSpecId:this._filterSpecId}),this._combinationView.render().inject(this.attrEditInputs),this.listenTo(this._combinationView,"NGF_SwitchDisplayContext",this._onSwitchDisplayContext.bind(this)),this.listenTo(this._combinationView,"NGF_DisplayAddActions",this._onDisplayAddActions.bind(this)),this.listenTo(this._combinationView,"NGF_SwitchToEdit",this._checkBeforeEdit.bind(this)),this._combinationView._sendEvent=1,this._sendEvent=1},_onSwitchDisplayContext:function(e){1===e.context?(e.combination.inject(this.attrEditInputs),e.view.inject(this.attrEditInputsAttr),this.attrEditInputsAttr.show()):(e.view.inject(this.attrEditInputs),this.attrEditInputsAttr.hide());var t=this.getElement(".attribute-edit-add-btn2");t.inject(this.attrEditActions),(t=this.getElement(".attribute-edit-addGroup-btn2")).inject(this.attrEditActions),(t=this.getElement(".attributeCriterion-edit-validate")).inject(this.attrEditActions)},_onDisplayAddActions:function(e){var t=this.attrEditActions.getElement(".attribute-edit-add-btn2"),i=this.attrEditActions.getElement(".attribute-edit-addGroup-btn2");t&&i&&e.display&&(t.show(),i.show())},_createAddVolumeButton:function(e){if(this.addVolumeBtn)return this.addVolumeBtn;var t=new d(s.getAttributeButtonStyle("plus"));t.label=a.get("addCriterionLabel"),t.showLabelFlag=s.isLabelCriterionDisplayed(),t.inject(e),t.tooltipInfos=new c({shortHelp:a.get("AddVolume"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attribute-edit-add-btn2");var i=this;return t.addEventListener("click",(function(e){i._cleanSelected(),i._combinationView.createVolume()})),t},_createAddVolumeGroupButton:function(e){if(this.addVolumeGroupBtn)return this.addVolumeGroupBtn;var t=new d(s.getAttributeButtonStyle("group-add"));t.label=a.get("addCriterionGroupLabel"),t.showLabelFlag=s.isLabelCriterionDisplayed(),t.inject(e),t.tooltipInfos=new c({shortHelp:a.get("AddVolumeGroup"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attribute-edit-addGroup-btn2");var i=this;return t.addEventListener("click",(function(e){i._cleanSelected(),i._combinationView.createVolumeGroup()})),t},_cleanSelected:function(){var e=this.getElement(".attribute-edit-group-selected");e&&e.removeClassName("attribute-edit-group-selected")},_createValidateButton:function(){var e=new d(s.getAttributeValidateButtonStyle());e.label=a.get("validateCriterionLabel"),e.showLabelFlag=s.isLabelCriterionDisplayed(),e.inject(this.attrEditActions),e.tooltipInfos=new c({shortHelp:a.get("ValidateCriteriaTooltip"),mouseRelativePosition:!0});var t="attribute-edit-button-style  attributeCriterion-edit-validate";t+=this.sequenceMode?"":" colorized",e.getContent().addClassName(t);var i=this;return e.addEventListener("buttonclick",(function(){0===s.isAsynchronousValidation()?i.isCriterionValidate()&&i.model&&i.dispatchEvent("NGF_Criterion_Validation",{criteriaType:i.model.get("criteriaType")}):i.isCriterionValidate().then((function(e){e&&i.model&&i.dispatchEvent("NGF_Criterion_Validation",{criteriaType:i.model.get("criteriaType")})}))})),e},isThereCriteria:function(){var e=function(t){for(var i=0,n=t.get("allVolumes")||[],o=n.length,s=0;s<o&&!i;s++){var r=n[s];i=r.get("allVolumes")?e(r):r.get("parameters")?1:0}return i};return!!this._combinationView&&e(this._combinationView.model)},updateModelFromRepair:function(e){if(e&&Array.isArray(e)&&2>e.length)return{modelUpdated:!1,attributes:void 0};e[0];var t=[],i=[];this._repairInfos.repairInfo&&(t=this._repairInfos.repairInfo.brokenProximity||[],i=this._repairInfos.repairInfo.brokenLogicalDB||[]);var n=[],o=[],s=[];e[1].forEach((function(e){e.attributes.forEach((function(t){if("resourceid"===t.name)n.push(t.value);else if("logicalid"===t.name)o.push(t.value);else if("ds6w:label"===t.name){var i=e.attributes.findIndex((e=>"ds6wg:revision"===e.name));s.push(t.value+(-1===i?"":" - "+e.attributes[i].value))}}))}));var r=function(e,a){for(var l=!1,d=e.get("allVolumes")||[],c=d.length,u=0;u<c;u++){var h=d[u];if(h.get("allVolumes"))l=r(h,a);else{var p=h.get("parameters");if("proximity"===p.type){var _=p.root_path_physicalid,m=(_=_.length?_[0]:[]).toString();t.forEach(((e,t)=>{if(m===e[t].toString()){var r=e[t].length;p.root_path_physicalid.splice(0),p.root_path_alias.splice(0);var a=[],d=[];i.forEach((e=>{e.forEach((e=>{var t=o.indexOf(e);-1!==t&&(a.push(n[t]),d.push(s[t]))}))})),r===a.length?(p.root_path_physicalid.push(a),p.root_path_alias=d,p.isRepaired=1):h.set("parameters",void 0),l=!0}}))}}}return l},a=r(this.model,e);return{modelUpdated:a,attributes:a?this.model:void 0}},buildViewFromRepairModel:function(e){e.get("criteriaType")===this.model.get("criteriaType")&&(this._combinationView.removeEmptyVolume(),this.model&&(this.model.unset("repairFilterInfo"),this._repairInfos=void 0,this.model.set("state","edit"),this.viewFromMdl(e.keepComponentsToFeedUI()),this.model.set("state","read")))}})})),define("DS/ENONextGenFilterUX/views/GroupView",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/WAFData/WAFData","UWA/Promise","DS/UIKIT/Mask","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Handlebars/Handlebars4","text!DS/ENONextGenFilterUX/templates/groupViewTemplate.html","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENONextGenFilterUX/views/CriteriaAttributeView","DS/ENONextGenFilterUX/models/CriterionModel","DS/ENONextGenFilterUX/collections/FilterUIGroupCollection","DS/WebappsUtils/WebappsUtils","DS/ENONextGenFilterUX/views/CriteriaTagView","DS/ENONextGenFilterUX/models/GroupModel","DS/ENONextGenFilterUX/views/CriteriaConfigurationView","DS/Logger/Logger","DS/Controls/Button","DS/Controls/TooltipModel","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/ENONextGenFilterUX/views/CriteriaContextMgmtView","DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterUX/views/CriteriaVolumeView","DS/ENOFilterBIUX/NGFServices","DS/Controls/Expander","DS/Menu/Menu","DS/Controls/Popup"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h,p,_,m,f,g,v,b,C,y,F,I,A,S,E,N,w){"use strict";var x=t.extend({className:"filtergroup-topdiv",domEvents:{"click .f-group-container .Sequence-read":"_onEditSubGroup","click .f-group-container .group-header2":"_onEditSubGroup"},setup:function(e){r.displayInternalTimeTrace(1,"GroupView"),this._hasConf=!1,this._UXId=e.UXId||"",this._NGFUXId=e.NGFUXId,this._widgetId=e.widgetId,this._groupId=e.groupId||0,this._childGroupId=e.childGroupId||0,this.types=e.types||null,this._synthesisInfos=e.synthesisInfos||null,this._synthesisInfos&&!this.types&&(this.types=r.getTypesOfSynthesis(this._synthesisInfos)),this._synthesisState=e.synthesisState||-1,this._securityContext=e.securityContext,this._rootID=e.rootID||d.get("root"),this._rootAlias=e.rootAlias||"?",this._rootRevision=e.rootRevision||"",this.model.setFilterSpecificationRoot(this._rootID),this.collection=this.model.get("groupCollection"),this._subGroupId=e.subGroup||0,this._savedRootID=e.savedRootID,this._template=a.compile(l),this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this)),this.listenTo(this.model,"onChange:isActivated",this._onActivateChange.bind(this)),this._isConfigurationAvailable=e.configAvailable,this._isVolumeAvailable=e.volumeAvailable,this._isContextAvailable=e.contextAvailable,this._isAttributeAvailable=e.attributeAvailable,this._cfgView=null,this._volumeView=null,this._contextMgmtView=null,this._listView=[],this._listViewId=[],this.filterViewToClone=e.filterViewToClone,this._subGroupKeepRemoveMode=1,this._defaultSpecName=this.model.getFilterSpecificationName(),this._subscribe0=I.subscribe("NGFilter_WidgetRemoved",this._onWidgetRemoved.bind(this)),this._subscribe1=I.subscribe("NGFilter_VolumeDefined",this._onVolumeDefined.bind(this)),this._subscribe2=I.subscribe("NGFilter_ConfigDefined",this._onUpdateFilterWithConfig.bind(this)),this._globalFilterState="New"},render:function(){var t=this;this.container.setAttribute("id","topgroupdiv"+this._getId()),this.container.setContent(this._template({stateClass:this.model.get("state"),filterAppliesTo:d.get("filterAppliesTo"),groupId:this._getId(),subGroup:this._subGroupId?"sequence":"",groupName:0===this._subGroupId?this._defaultSpecName:d.get("headerAttributeSequenceEdit"),iconHeader:0===this._subGroupId?"filter":p.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_AttributeFilter.png")}));var i=this.getElement("div.filter-applies"),n=this.options.linkedRoots;if(n){var o=[];n.forEach((e=>{o.push({label:e.alias,value:e.id,description:e.alias})})),this._appliesToCombo=new y({touchMode:r.TOUCH_MODE,elementsList:o,enableSearchFlag:!1,selectedIndex:0}),this._appliesToCombo.inject(i),this._appliesToCombo.getContent().addClassName("filter-applies-combo"),this._dispatchChangeRootEvent=1,this._appliesToCombo.addEventListener("change",(e=>{t._dispatchChangeRootEvent?t.dispatchEvent("NGF_ChangeRootOfSpecifcation",{specId:t.cid,rootId:t._rootID,newRootId:e.dsModel.value,callback:t._onChangeRoot.bind(this)}):t._onChangeRoot(e.dsModel.value),t._dispatchChangeRootEvent=1}))}else{if(0===this._subGroupId)this._dispatchChangeRootEvent=0,e.createElement("span",{class:"filter-applies-root",id:"multi_root_"+this._groupId,text:r.getRootTitle(this._rootAlias,this._rootRevision)}).inject(i)}if(0===this._subGroupId){var s=e.createElement("div",{}),a=new v(r.getAttributeButtonStyle("chevron-down"));a.displayStyle="lite",a.inject(s),this._SpecExpander=new E({touchMode:r.TOUCH_MODE,domId:"SpecExpander-"+this._groupId,header:this.model.getFilterSpecificationLabel(),expandedFlag:!0,customHeader:s,style:"filled-separate"});var l=this.getElement(".tree-v2");this._SpecExpander.inject(l,"before"),this._SpecExpander.body=l,this._SpecExpander.getContent().getElement(".wux-controls-expander-header").addClassName("group-header"),this._createContextualMenuWUX(a.getContent()),this._createAddCriterionButtons()}else{var c=this.getElement(this._getCSSId()+" .subGroup-edit-actions");this.addAttributeButton=this._createAddAttributeSequenceButton(c),this._createValidateButton(c),this._createContextualMenuWUX()}return this._filterSpecNameEditor=this._createRenameFilterSpecLineEditor(),this._filterSpecNameEditor.hide(),0===this._subGroupId&&(r.displayInternalTimeTrace(0,"GroupView(end of render)"),S.setPerformanceTracker(this._widgetId,"NGF-Filter-Render","NGFilter_UX",{Render_duration:Date.now()-r.getReferenceTime()},1)),this},_onChangeRoot:function(e){this.model.setFilterSpecificationRoot(e)},clearCriteria:function(){for(var e=this._listView.length-1;e>=0;e--){var t=this._listView[e];t&&t.destroy()}},_onWidgetRemoved:function(e){this._NGFUXId===e.NGFUXId&&this.updateCriteriaAvailibility({attributeUsed:!1===e.attributeAvailable?e.attributeAvailable:void 0,contextUsed:!1===e.contextAvailable?e.contextAvailable:void 0,volumeUsed:!1===e.volumeAvailable?e.volumeAvailable:void 0})},_getId:function(e){var t="grp_"+this._groupId;return t+=e||0===this._subGroupId?"":this._subGroupId},_getCSSId:function(e){return"#"+this._getId(e)},isThereCriteria:function(){for(var e=!1,t=this._listView.length,i=0;i<t;i++)if(this._listView[i].isThereCriteria()){e=!0;break}return e},_getListCriteriaType:function(){var e=[];return this._listView.forEach((t=>{e.push(t.model.get("criteriaType"))})),e=[...new Set(e)]},getCriteriaViewsByType:function(e){var t=[];return this._listView.forEach((i=>{e===i.model.get("criteriaType")&&t.push(i)})),t},getConfigRevision:function(){var e=this.getCriteriaViewsByType("config"),t=[];return e.forEach((e=>{if(r.isModelActivated(e.model)){var i=e.model.get("expression");i&&i.configurationRevision&&t.push(i.configurationRevision)}})),t},_onEditCriterion:function(e){I.publish("NGF_Criterion_Edition",e),this.switchToEdit(),this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{status:"ValidOK"})},_onComputeSynthesis:function(e){this.dispatchEvent("NGF_ComputeSynthesis",e)},feedViewWithFilter:function(e){var t=this;return new o((function(i){if(e){var n=e.specification.type,o=e.specification.data;"NGFilter_VolumeDefined"===n?(t._onVolumeDefined(o),i()):t._isConfigurationAvailable&&"NGFilter_ConfigDefined"===n&&t._initFilterWithConfig(e.data).then((function(){i()}))}else i()}))},switchToEdit:function(){"read"===this.model.get("state")?(this.model.set("state","edit"),this.model.set("isActivated","1"),0!==this._subGroupId?this.dispatchEvent("NGF_Criterion_SwitchedToEdit"):this.dispatchEvent("NGF_Group_SwitchedToEdit",{groupId:this.cid})):this.dispatchEvent("NGF_Group_SwitchedToEdit",{groupId:this.cid})},setFilterState:function(e){this._globalFilterState=e},_editReadMgt:function(e){var t;if(this.collection){var i=this.collection.findWhere({state:"edit"});void 0!==i&&(t=i.get("criteriaType"),i.set("state","read"),this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{status:"ValidOK"})),this.dispatchEvent("NGF_AddSpecificationState")}I.publish("NGF_Criterion_Edition",{type:t,state:0})},setTypes:function(e){this.types=e},setSynthesisInfos:function(e){e&&e.synthesis?(this._updateSynthesis(e,this),this._setEnableAddCriterionButtons(!0),this._onDelayedCreateAttribute()):(s.unmask(this.container),this._isAttributeBeingCreatedBeforeEndSynthesis=!1)},_updateSynthesis:function(e,t){t._synthesisInfos=e.synthesis||t._synthesisInfos,t._synthesisState=e.state||t._synthesisState,t.types=r.getTypesOfSynthesis(t._synthesisInfos);for(var i=!!t._createAttributeBtn&&t._createAttributeBtn.disabled,n=t._listView.length,o=0;o<n;o++){var a=t._listView[o],l=a.model.get("criteriaType"),d=a.model.get("sequenceType");"attribute"!==l&&"attribute"!==d||("Sequence"===l?this._updateSynthesis(e,a):a.updateSynthesis(e),i&&(a.buildFilteredTypeUI(t.types),s.unmask(a.getElement(".f-attribute-container"))))}},_setEnableAddCriterionButtons:function(e){var t=!1===e,i=!1!==e;this._createAttributeBtn&&(this._createAttributeBtn.disabled=t,this._createAttributeBtn.active=i),this._createConfigBtn&&!this._createConfigBtn.disabled&&(this._createConfigBtn.disabled=t,this._createConfigBtn.active=i),this._createVolumeBtn&&!this._createVolumeBtn.disabled&&(this._createVolumeBtn.disabled=t,this._createVolumeBtn.active=i),this._createContextBtn&&!this._createContextBtn.disabled&&(this._createContextBtn.disabled=t,this._createContextBtn.active=i)},onStateChange:function(e,t){var i=this.getElement(this._getCSSId()),n=" "+t,o=this._subGroupId?" sequence":"",s=i.hasClassName("group-collapse")?" group-collapse":"";if(i.setAttribute("class","f-group-container"+n+o+s),0!==this._subGroupId){var a=this._getCSSId();if(this._GroupContextualMenu=[],"read"===t){var l=this.collection.findWhere({isActivated:"1"}),c=this.getElement(this._getCSSId()+" .Sequence-read .subGroup-read-criterion");c&&(l?c.removeClassName("f-criterion-deactivated"):c.addClassName("f-criterion-deactivated"));var u=this.model.groupToString();this.getElement(a+" .Sequence-read .subGroup-read-criterion").setContent([{html:u}]),this._GroupContextualMenu.push(this._editSequenceItem),this._GroupContextualMenu.push(r.isModelActivated(this.model)?this._deactivateItem:this._activateItem),this._GroupContextualMenu.push(this._deleteItem)}else this._GroupContextualMenu.push(this._deleteItem);var h="";if("read"===t)h=(this._subGroupKeepRemoveMode?d.get("keep"):d.get("remove"))+" "+d.get("headerAttributeSequenceRead");else h=d.get("headerAttributeSequenceEdit");(0===this._subGroupId?this._SpecExpander.getContent().getElement(".wux-controls-expander-container").getElement(".headerTitle"):this.getElement(".group-name")).setContent({tag:"span",html:h})}},createTagNGF:function(e){var t=this.collection.findWhere({criteriaType:"tag"});t&&this._rootID===t.get("rootID")?Object.keys(e.allfilters).length||Object.keys(e.localfilters).length?t.set("tagData",e):this._onRemoveCriterion({criteriaType:"tag",idxView:this._tagView.cid}):(t=new u({criteriaType:"tag",tagData:e,rootID:this._rootID,widget:this._UXId}),this.collection.add(t),this._tagView=new _({UXId:this._UXId,NGFUXId:this._NGFUXId,widgetId:this._widgetId,childGroupId:this._childGroupId,model:t}),this._listView.push(this._tagView),this._listViewId.push(this._tagView.cid),S.setUsageTracker(this._widgetId,"NGF-Create_Criterion","tag"))},createAttribute:function(e,t,i){var n=this,o=r.isDelayedSynthesisActive();if(0===o&&0===this._subGroupId&&-1===this._synthesisState&&void 0===this._isAttributeBeingCreatedBeforeEndSynthesis)this._attrView=void 0,s.mask(this.container,d.get("LoaderForAttributes")),this._isAttributeBeingCreatedBeforeEndSynthesis=!0;else if(e)if("create"===t){var a=new u({criteriaType:"attribute",state:"edit"});if(this.collection.add(a),this._attrView=new c({UXId:this._UXId,NGFUXId:this._NGFUXId,widgetId:this._widgetId,childGroupId:this._childGroupId,model:a,types:e||[],fromCriterionMdl:i?i.model:void 0,listAttrFromType:i?i.listAttr:void 0,listAttrFromSubType:i?i.listAttrExtension:void 0,customizeCtxMenu:!1,sequenceMode:0!==this._subGroupId,keepValue:i?i.model.Keep:this._subGroupKeepRemoveMode,synthesisInfos:this._synthesisInfos,synthesisState:this._synthesisState,isEditable:this._isAttributeAvailable}),0===this._subGroupId){var l=this._SpecExpander.getContent().getElement(".wux-controls-expander-body>ul>.criterionButtonLi");this._attrView.render().inject(l,"before"),this.dispatchEvent("NGF_AttributeCommandsState",{enable:1}),this._addCriterionView(this._attrView),1!==o||i||-1!==this._synthesisState?this._attrView.buildFilteredTypeUI(e||[],this._filteredTypeFromModel):(this._isAttributeBeingCreatedBeforeEndSynthesis=!0,this._attrView.buildFilteredTypeUIAsync(e||[],this._filteredTypeFromModel).then((()=>{n._onComputeSynthesis({callback:n._onDelayedCreateAttribute.bind(n)})})))}else{var h=this.getElement(this._getCSSId()+" .Sequence-edit>ul");this._attrView.render().inject(h),this._attrView.getElement(".criteriaIcon").hide(),this._addCriterionView(this._attrView),this._attrView.buildFilteredTypeUI(e,this._filteredTypeFromModel)}}else"update"===t?this._attrView&&this._attrView.buildFilteredTypeUI(e,this._filteredTypeFromModel):console.log("RCI - GroupView : unknown status for createAttribute: "+t);else this._attrView=void 0;return this._attrView},_onDelayedCreateAttribute:function(){this._isAttributeBeingCreatedBeforeEndSynthesis&&(s.unmask(this.container),this._isAttributeBeingCreatedBeforeEndSynthesis=!1,this.updateOnceSynthesisComputed())},updateOnceSynthesisComputed:function(){this._attrView&&this._attrView.updateOnceSynthesisComputed()},_createContextMgmtView:function(e){if(!this._contextMgmtView){var t=new u({criteriaType:"context",state:"read"});this.collection.add(t),this._contextMgmtView=new F({UXId:this._UXId,NGFUXId:this._NGFUXId,widgetId:this._widgetId,childGroupId:this._childGroupId,rootId:this._rootID,model:t,groupView:this,fromModel:e,isEditable:this._isContextAvailable}),this._addCriterionView(this._contextMgmtView);var i=this._SpecExpander.getContent().getElement(".wux-controls-expander-body>ul>.criterionButtonLi");this._contextMgmtView.render().inject(i,"before"),this._createContextBtn&&(this._createContextBtn.disabled=!0,this._createContextBtn.active=!1)}return this._contextMgmtView},_onSwitchCriterionToSequence:function(t){var i=this;0===r.isAsynchronousValidation()?i._onSwitchCriterionToSequenceSync(i,t):this.areCriteriaValidate(t).then((function(n){if(n){var o=i._createSubGroupView(t.type),s=i._listViewId.indexOf(t.idxView),r=i._listView[s],a=r.container,l=a.getElement(".colorized");l&&l.removeClassName("colorized"),o.collection.add(r.model),o._listView[0]=r,o._listViewId[0]=r.cid,o._subGroupKeepRemoveMode=t.attributeKeep?1:0,i.stopListening(r),o._initCriterionViewEvents(r);var d=i.collection.indexOf(r.model);i.collection.remove(r.model),i.collection.add(o.model,{at:d}),i._listView[s]=o,i._listViewId[s]=o.cid,i._listView.pop(),i._listViewId.pop();var c=e.createElement("li").inject(a,"after");o.render().inject(c),a.remove().inject(o.getElement(".Sequence-edit>ul")),"function"==typeof r.switchCriterionToSequence&&r.switchCriterionToSequence(),o._addNewCriterion({type:r.model.get("criteriaType")})}}))},_onSwitchSequenceToCriterion:function(e){var t=this._listViewId.indexOf(e.idxView),i=this._listView[t],n=i.container.getParent(),o=i._listView[0];this.stopListening(i),this._initCriterionViewEvents(o);var s=this.collection.indexOf(i.model);this.collection.remove(i.model),this.collection.add(o.model,{at:s}),this._listView[t]=o,this._listViewId[t]=o.cid,o.container.remove().inject(n,"after"),"function"==typeof o.switchSequenceToCriterion&&o.switchSequenceToCriterion(),i.stopListening(),i._listView.splice(0),i._listViewId.splice(0),i.collection.reset(),n.remove()},_createSubGroup:function(t){var i=this._createSubGroupView(t);if(i){var n=e.createElement("li").inject(this.getElement(this._getCSSId(this._groupId)+" .criterionButtonLi"),"before");i.render().inject(n)}return i},_createSubGroupView:function(e){var t,i=this;if(e){this.nbGroup=void 0===this.nbGroup?1:this.nbGroup+1;var n=new h([],{widgetId:this._bodyContainer}),o=new m({subGroupCollection:n,criteriaType:"Sequence",sequenceType:e,subGroupId:this.nbGroup,groupCollection:n});this.collection.add(o),t=new x({appId:this._NGFUXId,widgetId:this.options.widgetId,groupId:this._groupId,childGroupId:this._childGroupId,subGroup:this.nbGroup,model:o,types:this.types,rootID:this._rootID,savedRootID:this._savedRootID,synthesisInfos:this._synthesisInfos,synthesisState:this._synthesisState,securityCtx:this._securityContext,NGFUXId:this.options.NGFUXId,configAvailable:this._isConfigAvailable,volumeAvailable:this._isVolumeAvailable,contextAvailable:this._isContextAvailable,attributeAvailable:this._isAttributeAvailable}),this._addCriterionView(t),this.listenTo(t,"NGF_SwitchSequenceToCriterion",this._onSwitchSequenceToCriterion.bind(this)),this.listenTo(t,"NGF_CheckActivateCriteria",(()=>{i.dispatchEvent("NGF_CheckActivateCriteria")}))}return t},_onCriterionActivated:function(){0!==this._subGroupId&&"edit"===this.model.get("state")&&(this.collection.findWhere({isActivated:"1"})&&r.isModelActivated(this.model)||this._toggleActivatedState({updateChildren:!1}));this.dispatchEvent("NGF_CheckActivateCriteria")},isThereActiveCriteria:function(){return this.collection.findWhere({isActivated:"1"})?1:0},_createAddCriterionButtons:function(){var t=this,i=this.getElement(this._getCSSId(this._groupId)+" .criterionButtonLi"),n=e.createElement("div",{class:"filter-groups-cmd",id:"actions_gv_"+this._groupId});n.inject(i),this._createContextBtn=this._createAddCriterionButton("context",n),!this._isContextAvailable&&this._createContextBtn.hide(),this._createAttributeBtn=this._createAddCriterionButton("attribute",n),!this._isAttributeAvailable&&this._createAttributeBtn.hide(),this._createConfigBtn=this._createAddCriterionButton("config",n),!this._isConfigurationAvailable&&this._createConfigBtn.hide(),this._createVolumeBtn=this._createAddCriterionButton("volume",n),!this._isVolumeAvailable&&this._createVolumeBtn.hide(),this._setDisplayLabel(r.isLeftPanelMaximized());var o=window.document.body.getElement(".filter-IDCard-Area"),s=window.document.body.getElement(".filter-Filter-Area");window.addEventListener("resize",(e=>{if(o&&s&&1===r.isLeftPanelMaximized()){let e=o.getDimensions().width,i=s.getDimensions().width;console.log("resize event (2) => IDCard/Filter width = "+e+" / "+i),i&&(r.TOUCH_MODE?t._setDisplayLabel(1050<=i?1:0):t._setDisplayLabel(840<=i?1:0))}}))},_createAddCriterionButton:function(e,t){var i,n,o,s,a,l=r.TOUCH_MODE?"32":"22";switch(e){case"attribute":n="add_attr_criterion",o=d.get("addAttributeCriterion"),a=d.get("addAttributeCriterionTooltip"),s=p.getWebappsAssetUrl("ENONextGenFilterUX","icons/"+l+"/filterAddAttribute.png");break;case"config":n="add_config_criterion",o=d.get("addConfigurationCriterion"),a=d.get("addConfigurationCriterionTooltip"),s=p.getWebappsAssetUrl("ENONextGenFilterUX","icons/"+l+"/filterAddConfiguration.png");break;case"volume":n="add_volume_criterion",o=d.get("addVolumeCriterion"),a=d.get("addVolumeCriterionTooltip"),s=p.getWebappsAssetUrl("ENONextGenFilterUX","icons/"+l+"/filterAddVolume.png");break;case"context":n="add_context_criterion",o=d.get("addContextCriterion"),a=d.get("addContextCriterionTooltip"),s=p.getWebappsAssetUrl("ENONextGenFilterUX","icons/"+l+"/filterAddSelection.png")}if(void 0!==n){(i=new v({touchMode:r.TOUCH_MODE,domId:n,displayStyle:"normal",showLabelFlag:!1,id:n,icon:s,label:o})).inject(t),i.tooltipInfos=new b({shortHelp:a,mouseRelativePosition:!0});var c=this;i.addEventListener("click",(function(t){r.isModelActivated(c.model)&&c._checkBeforeAdd(e)}))}return i},_onRenameSpecification:function(e){this._SpecExpander.getContent().getElement(".wux-controls-expander-container").getElement(".headerTitle").hide(),this._filterSpecNameEditor.show(),this._filterSpecNameEditor._giveFocus()},_onEditSubGroup:function(e){e&&e.stopPropagation&&e.stopPropagation(),this._checkBeforeEdit({callback:e.context&&e.context.forceEdit?this._editSubGroupForced.bind(this):this._editSubGroup.bind(this)})},_editSubGroup:function(e){this.model.get("isParentActivated")&&r.isModelActivated(this.model)&&this.switchToEdit()},_editSubGroupForced:function(e){this._setActivatedState(1,{updateChildren:!1}),this.switchToEdit()},_addNewCriterion:function(e){"attribute"===e.type?(this.types&&this._savedRootID===this._rootID||(this._savedRootID=this._rootID),this._addAnyCriterion(e)):this._addAnyCriterion(e)},_onVolumeDefined:function(e){if(!1===(!!this._createVolumeBtn&&this._createVolumeBtn.disabled)&&this._UXId===e.UXId&&!this._volumeView&&(void 0===e.specId||this._groupId===e.specId)){var t=this._volumeView?0:1;this._createVolume(0),this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{status:"ValidOK"}),e.action=t?"update":e.action,I.publish("NGFilter_VolumeDefined_Init",e),t&&(r.openFilterPanel("First_Volume_Defined_"+this._groupId),this.dispatchEvent("NGF_DisplayGlobalFilterView"))}},_onUpdateFilterWithConfig:function(e){var t=this,i=S.computeUXId(e.NGFUXId,e.rootID);if(this.isViewEdited()&&this._UXId===i){var n=e;this._initFilterWithConfig(n).then((function(){t.dispatchEvent("NGF_EndSetFilterSpecification",{applyFilter:void 0===n.applyFilter?0:n.applyFilter,displayFilter:void 0===n.displayFilter?1:n.displayFilter})}))}},_initFilterWithConfig:function(t){var i=this,n=t.specification.data;return new o((function(o,s){var a="config",l=i._getListCriteriaType().findIndex((e=>a===e));-1===l||t.forceUpdate?i._checkBeforeEdit({callback:function(){-1===l?i._createConfig(!1,!!n):(i._cfgView._initWithConfig=!0,i._cfgView.editConfiguration()),i._cfgView.launchCfgFactoryWithConfig(n).then((function(){o()}))}}):(r.displayNotification({level:"info",message:e.String.format(d.get("CriterionNotAppliedAsAlreadyDefined"),d.get(a))}),s())}))},_addAnyCriterion:function(e){var t=this;this.switchToEdit();let i=1,n=e.type;switch(n){case"attribute":this.createAttribute(this.types||[],"create");break;case"config":this._createConfig(!1);break;case"volume":r.isLeftPanelMaximized()&&r.displayNotification({level:"info",message:d.get("MinimizeLeftPanelToVolume")}),r.getLengthUnitPreference().then((e=>{r.setLengthUnit(e),t._createVolume()}));break;case"context":r.isLeftPanelMaximized()&&r.displayNotification({level:"info",message:d.get("MinimizeLeftPanelToSelect")}),this._createContextMgmtView();break;default:i=0}this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{status:"ValidOK"}),i&&I.publish("NGF_Criterion_Edition",{type:n,state:1}),S.setUsageTracker(this._widgetId,"NGF-Create_Criterion",n)},_checkBeforeAdd:function(e){this._checkBeforeEdit({type:e,callback:this._addNewCriterion.bind(this)})},_checkBeforeEdit:function(e){this.dispatchEvent("NGF_Criterion_ValidateEdited",e)},areCriteriaValidate:function(e){if(0===r.isAsynchronousValidation())return this.areCriteriaValidateSync(this);var t=this._listView?this._listView.length:0,i=!t;if(t){i=!0;for(var n=[],s=[],a=0;a<t&&i;a++){var l=this._listView[a];null!==l&&"edit"===l.model.get("state")&&(n.push(l),void 0===l._subGroupId||0===l._subGroupId?s.push(l.isCriterionValidate()):s.push(this._isSequenceValidate(l)))}return o.all(s).then((function(e){i=!0;for(var t=e.length,o=0;o<t;o++){i=i?e[o]:i;var s=n[o];void 0!==s._subGroupId&&0!==s._subGroupId||e[o]&&s.model&&s.model.set("state","read")}return i&&I.publish("NGF_Criterion_Edition",{}),i}))}return new o((function(e){e(i)}))},_isSequenceValidate:function(e){return new o((function(t,i){e.areCriteriaValidate().then((function(i){i&&e.dispatchEvent("NGF_Criterion_Validation",{criteriaType:e.model.get("criteriaType"),viewId:e._getCSSId()}),t(i)}))}))},areCriteriaValid:function(){for(var e=!0,t=this._listView?this._listView.length:0,i=0;i<t&&e;i++){var n=this._listView[i];null!==n&&"edit"===n.model.get("state")&&(void 0===n._subGroupId||0===n._subGroupId?"function"==typeof n.isCriterionValid&&(e=n.isCriterionValid()):e=n.areCriteriaValid())}return e},setDeactivateVisible:function(e){var t=this._GroupContextualMenu.findIndex((e=>"activate-item-DDCtx"===e.recId));e?-1===t&&(this._GroupContextualMenu=[],this._GroupContextualMenu.push(0===this._subGroupId?this._renameItem:this._editSequenceItem),this._duplicateItem&&this._GroupContextualMenu.push(this._duplicateItem),this._GroupContextualMenu.push(this._deactivateItem),this._GroupContextualMenu.push(this._deleteItem)):0===this._subGroupId&&(this._GroupContextualMenu=[],this._GroupContextualMenu.push(this._renameItem),this._duplicateItem&&this._GroupContextualMenu.push(this._duplicateItem),this._GroupContextualMenu.push(this._deleteItem))},_createContextualMenuWUX:function(e){if(e||!this._GroupContextualMenu){this._renameItem={type:"PushItem",recId:"rename-item-DDCtx",title:d.get("renameFilterSpecification"),icon:r.getIconByName("rename"),action:{this:this,callback:this._onRenameSpecification}},this._editSequenceItem={type:"PushItem",recId:"editSequence-item-DDCtx",title:d.get("editCriteria"),icon:r.getIconByName("pencil"),action:{this:this,callback:this._onEditSubGroup,context:{forceEdit:1}}},this._duplicateItem={type:"PushItem",recId:"duplicate-item-DDCtx",title:d.get("duplicateFilterGroup"),icon:r.getIconByName("duplicate"),action:{this:this,callback:this._duplicateSpecification}},this._activateItem={type:"PushItem",recId:"activate-item-DDCtx",title:d.get("activatedCriteria"),icon:r.getIconByName("eye"),action:{this:this,callback:this._checkBeforeChangeState}},this._deactivateItem={type:"PushItem",recId:"activate-item-DDCtx",title:d.get("deactivatedCriteria"),icon:r.getIconByName("eye-off"),action:{this:this,callback:this._checkBeforeChangeState}},this._deleteItem={type:"PushItem",recId:"delete-item-DDCtx",title:d.get("deleteFilterGroup"),icon:r.getIconByName("trash"),action:{this:this,callback:this._removeGroup}},this._GroupContextualMenu=[],0===this._subGroupId&&this._GroupContextualMenu.push(this._renameItem),this._duplicateItem&&0===this._subGroupId&&this._GroupContextualMenu.push(this._duplicateItem),this._GroupContextualMenu.push(this._deleteItem);var t=this;(e||this.getElement(this._getCSSId()+" .ctx-group-menu")).addEventListener("click",(function(e){if(e.stopPropagation(),t.model.get("isParentActivated")){var i=e.target.getBoundingClientRect();N.show(t._GroupContextualMenu,{position:r.getMenuPosition(i)})}}))}},_createConfig:function(e,t){if(!this._cfgView){var i=new u({criteriaType:"config",state:e?"edit":"read"});this.collection.add(i),this._cfgView=new f({UXId:this._UXId,NGFUXId:this._NGFUXId,widgetId:this._widgetId,childGroupId:this._childGroupId,model:i,rootId:this._rootID,initWithConfig:t||!1,isEditable:this._isConfigurationAvailable,pfServiceId:this.options.pfServiceId,securityContext:this._securityContext}),this.listenTo(this._cfgView,"NGF_Criterion_Config",this._onConfigCriterionCB.bind(this));var n=this._SpecExpander.getContent().getElement(".wux-controls-expander-body>ul>.criterionButtonLi");this._cfgView.render().inject(n,"before"),this._addCriterionView(this._cfgView),e||this._cfgView.editConfiguration(),this._createConfigBtn&&(this._createConfigBtn.disabled=!0,this._createConfigBtn.active=!1)}},_onConfigCriterionCB:function(e){e.displayMode;switch(e.action){case"remove":this._cfgView&&this._cfgView.destroy(),this._hasConf=!1;break;case"update":this._hasConf=e.hasConf;var t=e.cfgType||e.model&&e.model.config_filter_id?"configId":"binary";S.setUsageTracker(this._widgetId,"NGF-Configuration",t)}},_createVolume:function(e){if(!this._volumeView){var t=new u({criteriaType:"volume",state:"edit"});this.collection.add(t),this._volumeView=new A({UXId:this._UXId,NGFUXId:this._NGFUXId,widgetId:this._widgetId,rootId:this._rootID,childGroupId:this._childGroupId,model:t,sendEvent:0!==e?1:0,filterSpecId:this._groupId,isEditable:this._isVolumeAvailable}),this._createVolumeBtn&&(this._createVolumeBtn.disabled=!0,this._createVolumeBtn.active=!1);var i=this._SpecExpander.getContent().getElement(".wux-controls-expander-body>ul>.criterionButtonLi");this._volumeView.render().inject(i,"before"),this._addCriterionView(this._volumeView)}return this._volumeView},_duplicateSpecification:function(){this.dispatchEvent("NGF_DuplicateSpecifcation",{specId:this.cid,rootSpec:this._appliesToCombo?this._appliesToCombo.value:this._rootID,specName:this.model.getFilterSpecificationName()})},updateDuplicatedView:function(e){this._appliesToCombo&&(this._appliesToCombo.value=e.rootSpec,this._dispatchChangeRootEvent=1),this.isThereCriteria()&&this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{status:"ValidOK"})},setEnableDuplication:function(e){var t=this._GroupContextualMenu.findIndex((e=>"duplicate-item-DDCtx"===e.recId));e?-1===t&&this._GroupContextualMenu.splice(1,0,this._duplicateItem):-1!==t&&this._GroupContextualMenu.splice(t,1)},_removeGroup:function(){0===this._subGroupId?this.dispatchEvent("NGF_RemoveGroup",{groupId:this.cid,initFilterUI:1}):this._onRemoveCriterion({idxView:this.cid,subgGroupId:this._subGroupId})},destroy:function(){for(var e=this._listView.length,t=e-1;t>=0;t--){var i=this._listView[t];null!=i&&i.destroy()}if(0===this._subGroupId){this._subscribe0.unsubscribe("NGFilter_WidgetRemoved"),this._subscribe1.unsubscribe("NGFilter_VolumeDefined"),this._subscribe2.unsubscribe("NGFilter_ConfigDefined"),this._listView.splice(0,e),this._listViewId.splice(0,e);var n=this.collection.toArray();this.collection.remove(n),this._volumeView=void 0,this.stopListening(),this.model=null,this._parent(),this.container=null}},_onRemoveCriterion:function(e){if(0===this._subGroupId){if(this._listViewId.length,-1!==(o=this._listViewId.indexOf(e.idxView))){var t=this._listView[o].model;this.collection.remove(t),this._listView.splice(o,1),this._listViewId.splice(o,1),1}if(e.criteriaType&&"attribute"===e.criteriaType||"Sequence"===e.criteriaType){var i=this.getCriteriaViewsByType("attribute").concat(this.getCriteriaViewsByType("Sequence"));this.dispatchEvent("NGF_AttributeCommandsState",{enable:i.length?1:0})}if(e.criteriaType&&"config"===e.criteriaType&&(this._hasConf=e.hasConf,!1===this._hasConf&&(this._createConfigBtn&&(this._createConfigBtn.disabled=!1,this._createConfigBtn.active=!0),this._cfgView=void 0)),e.criteriaType&&"context"===e.criteriaType&&(this._contextMgmtView=null,this._createContextBtn&&(this._createContextBtn.disabled=!1,this._createContextBtn.active=!0)),e.criteriaType&&"volume"===e.criteriaType)this.collection.findWhere({criteriaType:"volume"})||(this._volumeView=void 0,this._createVolumeBtn&&(this._createVolumeBtn.disabled=!1,this._createVolumeBtn.active=!0));var n=document.getElementsByClassName(".keepChildren");void 0!==n[0]&&n.hide(),this.dispatchEvent("NGF_AddSpecificationState"),e.edited&&I.publish("NGF_Criterion_Edition",{})}else{var o,s,r,a;if(-1!==(o=this._listViewId.indexOf(e.idxView))?(a=[this._listView[o].model],s=o,r=1):(a=this.collection.toArray(),s=0,r=this._listView.length),this.collection.remove(a),this._listView.splice(s,r),this._listViewId.splice(s,r),0!==this._listView.length){var l=this._listView[0].model.get("criteriaType"),d=this._listView[0].model.get("sequenceType");("attribute"===l||"Sequence"===l&&"attribute"===d)&&this._listView[0].setEnableKeepRemove(!0),1===this._listView.length&&this.dispatchEvent("NGF_SwitchSequenceToCriterion",{idxView:this.cid})}else this.dispatchEvent("NGF_RemoveCriterion",{idxView:e.idxView}),this.stopListening(),this.model=null,this._parent(),this.container.getParent().remove()}},_checkBeforeChangeState:function(){this.dispatchEvent("NGF_Criterion_ValidateEdited",{callback:this._toggleActivatedState.bind(this)})},setActivatedState:function(e,t){this._setActivatedState(e,t)},_toggleActivatedState:function(e){var t=r.isModelActivated(this.model)?0:1;this._setActivatedState(t,e)},_setActivatedState:function(e,t){var i=0===e?"0":"1";if(this.model.setActivated(i),0===this._subGroupId){if(t&&!0===t.updateChildren){this.collection.forEach((function(e){e.set("isActivated",i)}))}this.dispatchEvent("NGF_SpecificationActivateChange",{viewId:this._getId()})}else{var n=r.isModelActivated(this.model)?this._deactivateItem:this._activateItem,o=this._GroupContextualMenu.findIndex((e=>n.recId===e.recId));-1===o?this._GroupContextualMenu.splice(2,0,e?this._activateItem:this._deactivateItem):this._GroupContextualMenu[o]=n}},_onActivateChange:function(e,t){let i="0"===t;if(0===this._subGroupId){var n=r.isModelActivated(e)?this._deactivateItem:this._activateItem,o=this._GroupContextualMenu.findIndex((e=>n.recId===e.recId));-1===o?this._GroupContextualMenu.splice(2,0,i?this._activateItem:this._deactivateItem):this._GroupContextualMenu[o]=n;var s=this._SpecExpander.getContent().getElement(" .tree-v2"),a=this._SpecExpander.getContent().getElement(".wux-controls-expander-header").getElement(".headerTitle");let t=i?0:1;this.collection.forEach((function(e){e.set("isParentActivated",t)})),i?(a.addClassName("f-group-deactivated"),s.addClassName("f-group-deactivated")):(a.removeClassName("f-group-deactivated"),s.removeClassName("f-group-deactivated"))}else{let e=this._getCSSId(),t=this.getElement(e+" .group-header2");i?t.addClassName("f-group-deactivated"):t.removeClassName("f-group-deactivated"),this.getElements(e+" ol").forEach((function(e){i?e.addClassName("f-group-deactivated"):(e.removeClassName("f-group-deactivated"),e.removeClassName("f-criterion-deactivated"))}))}},_addCriterionView:function(e){this._listView.push(e),this._listViewId.push(e.cid),this._childGroupId++,this._initCriterionViewEvents(e)},_initCriterionViewEvents:function(e){this.listenTo(e,"NGF_RemoveCriterion",this._onRemoveCriterion.bind(this)),this.listenTo(e,"NGF_Criterion_SwitchedToEdit",this._onEditCriterion.bind(this)),this.listenTo(e,"NGF_Criterion_Validation",this._editReadMgt.bind(this)),this.listenTo(e,"NGF_Criterion_ValidateEdited",this._checkBeforeEdit.bind(this)),this.listenTo(e,"NGF_Criterion_Activated",this._onCriterionActivated.bind(this));var t=this,i=e.model.get("criteriaType"),n=e.model.get("sequenceType");("attribute"===i||"Sequence"===i&&"attribute"===n)&&(this.listenTo(e,"NGF_AttrKeepToRemoveMode",(function(){if(t._subGroupId){t._subGroupKeepRemoveMode=0;for(var e=t._listView.length,i=1;i<e;i++)t._listView[i].initKeepRemove("Remove")}this.dispatchEvent("NGF_AttrKeepToRemoveMode")})),this.listenTo(e,"NGF_AttrRemoveToKeepMode",(function(){if(t._subGroupId){t._subGroupKeepRemoveMode=1;for(var e=t._listView.length,i=1;i<e;i++)t._listView[i].initKeepRemove("Keep")}this.dispatchEvent("NGF_AttrRemoveToKeepMode")})),this.listenTo(e,"NGF_ComputeSynthesis",this._onComputeSynthesis.bind(this)),"attribute"===i&&(this.listenTo(e,"NGF_SwitchCriterionToSequence",this._onSwitchCriterionToSequence.bind(this)),0!==this._subGroupId&&this.listenTo(e,"NGF_Criterion_Activated",this._onCriterionActivated.bind(this))))},setTagMdlAsLocal:function(e){if(JSON.stringify(e.allfilters)!==JSON.stringify(e.localfilters)){e.localfilters||(e.localfilters={});for(var t=0;t<Object.keys(e.allfilters).length;t++){var i=Object.keys(e.allfilters)[t];e.allfilters[i].forEach((t=>{if(e.localfilters[i])for(var n=0;n<e.localfilters[i].length;n++)e.localfilters[i][n].object!==t.object&&e.localfilters[i].push(t);else e.localfilters[i]=e.allfilters[i]}))}}},filterViewFromModel:function(e,t,i,n){var o=this,s=!1;this._appliesToCombo&&(this._dispatchChangeRootEvent=0,this._appliesToCombo.value=e||this._rootID),this.switchToEdit();var a=[];return t.toFeedUI.forEach((t=>{if(null!==t){var l=t.criteriaType,d=null;if("attribute"===l){o.types=n;var c=[];if(o.types.forEach((e=>{c.push(e.name)})),r.isEasyAttributeDisplayMode()&&r.FILTER_ANY_OBJECT===t.type)o._filteredTypeFromModel=t.type;else{let e=c.indexOf(t.type);o._filteredTypeFromModel=-1===e?void 0:t.type}if(d=o.createAttribute(o.types,"create",{model:t,listAttr:i[t.type],listAttrExtension:i[t.extension]})){var u=d.viewFromMdl(t);a=a.concat(u)}else console.log("\n\n ==> filterViewFromModel / attribute = "+o._rootAlias+"\n\n");delete o._filteredTypeFromModel}else if("config"===l)o._createConfig(!0),(d=o._cfgView).viewFromMdl(t),o._onConfigCriterionCB({hasConf:!0,action:"update",model:t});else if("Sequence"===l){var h=t.sequenceType;if("attribute"===h){var p=t.allAttributes;if(p){var _=[];p.forEach((function(e){_.push(e.isActivated||"1"),e.isActivated="1"})),d=o._createSubGroup(h);var m={filterSpecificationName:o.model.getFilterSpecificationName(),isActivated:"1",toFeedUI:p};d.filterViewFromModel(e,m,i,n),d.collection.forEach((function(e,t){e.set("isActivated",_[t])})),d._subGroupKeepRemoveMode=m.toFeedUI[0].Keep,d._listView[0].setEnableKeepRemove(!0)}}}else if("context"===l){var f=(d=o._createContextMgmtView(!1)).model;Object.keys(t).forEach((function(e){f.set(e,t[e])})),d.viewFromMdl(f)}else if("volume"===l){(d=o._createVolume(0)).viewFromMdl(t)}else"tag"===l&&(s=t,o.setTagMdlAsLocal(t),o.createTagNGF(t),o._tagView&&o._tagView.viewFromMdl(t));d&&d.model&&d.model.set("state","read")}})),t.isActivated&&"0"===t.isActivated&&this._toggleActivatedState({updateChildren:!1}),this.updateFilterSpecificationName(t.filterSpecificationName||this._defaultSpecName),{retrievedTags:s,attrNotFound:a}},getProdConfOfConfigFilter:function(){return this._hasConf?this._cfgView.getProdConfId():void 0},checkConfigFilter:function(e){return!this._cfgView||this._cfgView.checkConfigFilter(e)},_createAddAttributeSequenceButton:function(e){let t=new v(r.getAttributeButtonStyle("list-add"));t.inject(e),t.tooltipInfos=new b({shortHelp:d.get("addAttributeInSeqenceTooltip"),mouseRelativePosition:!0});t.getContent().addClassName("attribute-edit-button-style attributeCriterion-edit-addSequence-btn");var i=this;return t.addEventListener("click",(function(e){S.setUsageTracker(i._widgetId,"NGF-Attribute","Create_Sequence");var t=i._listView?i._listView.length:0,n=!t;if(t){n=!0;for(var o=0;o<t;o++){var s=i._listView[o];if(null!==s&&"edit"===s.model.get("state")&&(void 0===s._subGroupId||0===s._subGroupId)){if("function"!=typeof s.isCriterionValidate){n=!1,r.displayNotification({level:"error",message:d.get("NeedToValidateCrirerion")});break}(n=s.isCriterionValidate())&&s.model.set("state","read")}}}n&&i._addNewCriterion({type:"attribute"})})),t},_createValidateButton:function(e){if(0===r.isAsynchronousValidation())this._createValidateButtonSync(this,e);else{this._validateButton=new v(r.getAttributeValidateButtonStyle()),this._validateButton.inject(e),this._validateButton.tooltipInfos=new b({shortHelp:d.get("validateAttributeSequenceCriterionTooltip"),mouseRelativePosition:!0});this._validateButton.getContent().addClassName("attribute-edit-button-style attributeCriterion-edit-validate colorized");var t=this;this._validateButton.addEventListener("buttonclick",(function(){t.areCriteriaValidate().then((function(e){e&&t.dispatchEvent("NGF_Criterion_Validation",{criteriaType:t.model.get("criteriaType"),viewId:t._getCSSId()})}))}))}},_createRenameFilterSpecLineEditor:function(){var e,t=new C({touchMode:r.TOUCH_MODE,placeholder:d.get("placeHolderFilterName"),domId:"Rename_Specification"});t.value=this.model.getFilterSpecificationName()||d.get("defaultGroupName"),e=0===this._subGroupId?this._SpecExpander.getContent().getElement(".wux-controls-expander-container").getElement(".headerTitle"):this.getElement(".group-name"),t.inject(e,"after");var i=this,n=function(e){var t=e.dsModel.value;i.model.getFilterSpecificationName()===t?i.updateFilterSpecificationName(t):(t=""===t?i._defaultSpecName:t,i.dispatchEvent("NGF_UpdateSpecificationName",{name:t,computeIndexCB:function(e){i.model.setFilterSpecificationIndex(e.index),i.updateFilterSpecificationName(e.name)}}))};return t.addEventListener("focus",(function(e){t.value=i.model.getFilterSpecificationName()})),t.addEventListener("change",n),t.addEventListener("blur",n),t},updateFilterSpecificationName:function(e){if(this.model.setFilterSpecificationName(e),this._filterSpecNameEditor.hide(),this._SpecExpander){var t=this._SpecExpander.getContent().getElement(".wux-controls-expander-container").getElement(".headerTitle");t.setText(" "+this.model.getFilterSpecificationLabel()),t.show()}this.dispatchEvent("NGF_UpdateSpecificationName",{name:e})},isViewEdited:function(){var e=this.collection.findWhere({state:"edit"});return!(!("edit"===this.model.get("state")?1:0)&&!e)},buildViewsFromRepairModel:function(e){this._listView.forEach((t=>{t.buildViewFromRepairModel(e)}))},updateModelsFromRepair:function(e){var t=[];return this._listView.forEach((i=>{t.push(i.updateModelFromRepair(e))})),t},checkDisplayKeepChildren:function(){for(var e=!1,t=this.collection.toArray(),i=0;i<t.length;i++)if("attribute"===t[i].get("criteriaType")&&!0===t[i].get("Keep")){e=!0;break}return e},updateCriteriaAvailibility:function(e){void 0!==e.volumeUsed&&(e.volumeUsed?(this._createVolumeBtn.show(),this._volumeView&&this._volumeView.setEditable(!0)):(this._createVolumeBtn.hide(),this._volumeView&&this._volumeView.setEditable(!1))),void 0!==e.contextUsed&&(e.contextUsed?(this._createContextBtn.show(),this._contextMgmtView&&this._contextMgmtView.setEditable(!0)):(this._createContextBtn.hide(),this._contextMgmtView&&this._contextMgmtView.setEditable(!1))),void 0!==e.attributeUsed&&(e.attributeUsed?this._createAttributeBtn.show():this._createVolumeBtn.hide(),this._listView.forEach((t=>{var i=t.model.get("criteriaType"),n=t.model.get("sequenceType");"attribute"!==i&&"attribute"!==n||t.setEditable(!!e.attributeUsed)})))},updateOnLeftPanelWidthChange:function(e){this._setDisplayLabel(e),this._listView.forEach((t=>{t.updateOnLeftPanelWidthChange(e)}))},_setDisplayLabel:function(e){this._createContextBtn&&(this._createContextBtn.showLabelFlag=!!e),this._createAttributeBtn&&(this._createAttributeBtn.showLabelFlag=!!e),this._createConfigBtn&&(this._createConfigBtn.showLabelFlag=!!e),this._createVolumeBtn&&(this._createVolumeBtn.showLabelFlag=!!e)},_onSwitchCriterionToSequenceSync:function(t,i){var n=t;if(n.areCriteriaValidateSync(n)){var o=n._createSubGroupView(i.type),s=n._listViewId.indexOf(i.idxView),r=n._listView[s],a=r.container,l=a.getElement(".colorized");l&&l.removeClassName("colorized"),o.collection.add(r.model),o._listView[0]=r,o._listViewId[0]=r.cid,o._subGroupKeepRemoveMode=i.attributeKeep?1:0,n.stopListening(r),o._initCriterionViewEvents(r);var d=n.collection.indexOf(r.model);n.collection.remove(r.model),n.collection.add(o.model,{at:d}),n._listView[s]=o,n._listViewId[s]=o.cid,n._listView.pop(),n._listViewId.pop();var c=e.createElement("li").inject(a,"after");o.render().inject(c),a.remove().inject(o.getElement(".Sequence-edit>ul")),"function"==typeof r.switchCriterionToSequence&&r.switchCriterionToSequence(),o._addNewCriterion({type:r.model.get("criteriaType")})}},areCriteriaValidateSync:function(e){var t=e,i=t._listView?t._listView.length:0,n=!i;if(i){n=!0;for(var o=0;o<i;o++){var s=t._listView[o];if(null!==s&&"edit"===s.model.get("state"))if(void 0===s._subGroupId||0===s._subGroupId){if("function"!=typeof s.isCriterionValidate){n=!1,r.displayNotification({level:"error",message:d.get("NeedToValidateCrirerion")});break}(n=s.isCriterionValidate())&&s.model&&s.model.set("state","read")}else(n=s.areCriteriaValidateSync(t))&&s.dispatchEvent("NGF_Criterion_Validation",{criteriaType:s.model.get("criteriaType"),viewId:s._getCSSId()})}}return n},_createValidateButtonSync:function(e,t){var i=e;i._validateButton=new v(r.getAttributeValidateButtonStyle()),i._validateButton.inject(t),i._validateButton.tooltipInfos=new b({shortHelp:d.get("validateAttributeSequenceCriterionTooltip"),mouseRelativePosition:!0});i._validateButton.getContent().addClassName("attribute-edit-button-style attributeCriterion-edit-validate colorized"),i._validateButton.addEventListener("buttonclick",(function(){i.areCriteriaValidateSync(i)&&i.dispatchEvent("NGF_Criterion_Validation",{criteriaType:i.model.get("criteriaType"),viewId:i._getCSSId()})}))}});return x})),define("DS/ENONextGenFilterUX/views/GlobalFilterView",["UWA/Class","UWA/Class/View","UWA/Core","UWA/Promise","UWA/Utils/InterCom","DS/WAFData/WAFData","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Handlebars/Handlebars4","text!DS/ENONextGenFilterUX/templates/globalViewTemplate.html","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENONextGenFilterUX/utils/FilterPersistencyServices","DS/ENONextGenFilterUX/views/GroupView","DS/ENONextGenFilterUX/views/FilterRepairView","DS/ENONextGenFilterUX/collections/FilterUIGlobalFilterCollection","DS/ENONextGenFilterUX/collections/FilterUIGroupCollection","DS/ENONextGenFilterUX/models/GroupModel","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/PlatformAPI/PlatformAPI","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/LineEditor","DS/Controls/Button","DS/Controls/ComboBox","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/WebappsUtils/WebappsUtils","DS/Controls/TooltipModel","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/ENOFilterBIUX/FBIProxyServices","DS/Controls/Editor","DS/ENONextGenFilterUX/utils/FilterCollectionServices","text!DS/ENONextGenFilterUX/assets/ENOStrRefinementUX_require.json","DS/Utilities/TouchUtils","DS/Menu/Menu","DS/ENOFilterBIUX/NGFSecurityCtxConverter","DS/ENONextGenFilterUX/views/AdvFilterIDCard","DS/TagNavigatorOpenness/views/ActiveCriteriaView"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h,p,_,m,f,g,v,b,C,y,F,I,A,S,E,N,w,x,T,V,D,O,U,G,M,R,L,P){"use strict";var k="",B=1;return t.extend({_wgtActiveCriteriaView:null,domEvents:{"click .global-header-filtername":"_renameFilterCmd"},setup:function(e){var t=this;d.displayInternalTimeTrace(1,"GlobalFilterView"),this._isNewRepairActive=!!f.isActivated("RepairOnDrop"),this._hasToComputeSynthesis=1,this._computeSynthesisOnTimeOut=1e3*f.isDebugActive("SynthesisTimeOut"),this._currentMenuClass="Filter-menu",this._template=a.compile(l),this._defaultServiceId="3DSpace",this._pfServiceId=e.pfServiceId,this._appId=this.options.NGFUXId,this._widgetId=this.options.widgetId||this.options.widget,this._UXId=this.options.UXId,this._NGFUXId=this.options.NGFUXId,this._appQueryParam=this.options.appQueryParam,this._securityContext=this.options.securityContext,this._queryFormat=this._getQueryFormat(this._NGFUXId),this._lightCB=sessionStorage.getItem("NGFilter_lightCB_"+this._NGFUXId+"-"+this._widgetId),this._appliedFilterTitle="",this._filterName="",this._filterDescription="",this._activeFilter="",this._hasAppliedNGF=!1,this._currentFilterSpecification="",this._filterState="New",this._types=null,this._rootID=e.rootID,this._rootAlias=e.rootAlias||"?",this._rootRevision=e.rootRevision||"",this._headerContainer=e.headerContainer;var n,o=localStorage.getItem("NGF_DisplayDensity");n=null===o?void 0===G.getTouchMode()||!!G.getTouchMode():"true"===o||"1"===o,d.updateTouchMode(n),this._onChangeDensity({touchMode:n}),this._isConfigAvailable=!1!==e.configUsed,this._isVolumeAvailable=!1!==e.volumeUsed,this._isContextAvailable=!1!==e.contextUsed,this._isAttributeAvailable=!1!==e.attributeUsed,this._filterToApply=e.filterToApply,this._listGroupView=[],this._listGroupViewId=[],this.nbGroupView=0,this.idxGFV=e.idxGFV,this.collection=new p(null,{appId:this._appId,widgetId:this._widgetId,model:e.model}),this._filterRepairView=this._createRepairFilterView(this.options),this._isFilterBroken=!1,this._isLeftPanelMaximized=0;var s=f._getFilterSpecification(this.options);s&&s.data&&s.data.filterMdl&&s.data.filterMdl.length&&(this._droppedFilterData=[s.data]),this._dropOption=s?s.data.dropOption:this.options.dropOption,this._tagData="dropOnFilter"!==this._dropOption&&s&&s.data?i.clone(s.data.tagData):void 0,this._tagsInMdl=i.clone(this._tagData),this._tagsOnly=!1,this._keepAttributeChildren=!0,this._keepFilters={},S.mask(t.container),!t._rootID&&e.filterToApply&&(t._rootID=e.filterToApply.rootID,t._rootAlias=e.filterToApply.rootAlias||this._rootAlias),this._wgtActiveCriteriaView=this._createActiveCriteriaView(),this._filterIDCard=this._createFilterIDCardView(),this.listenTo(this.model,"onChange:state",this._onStateChange.bind(this)),document.addEventListener("touchChange",(function(e){t._onChangeDensity({touchMode:G.getTouchMode()})})),this._subscribeRemoveFilter=b.subscribe("NGFilter.RemoveFilter",this._onRemoveFilter.bind(this)),this._subscribeRedraw=b.subscribe("NGFilter.Redraw",this._onRedraw.bind(this)),this._subscribeSecurityContext=b.subscribe("NGFilter.SetDefaultSecurityContext",this._onSetSecurityContext.bind(this)),this._subscribeWidgetRemoved=b.subscribe("NGFilter_WidgetRemoved",this._onWidgetRemoved.bind(this)),this._subscribeRemoveFromTaggerACV=b.subscribe("NGFilter.RemoveFromTaggerACV",this.onAddCriteriaChange.bind(this)),this._subscribeLaunchFilterCmd=b.subscribe("NGFilter_LaunchFilterCmd",this._onLaunchFilterCmd.bind(this)),this._subscribeFocusACV=b.subscribe("NGFilter.addFocusChangeListener",this._onAddFocusChangeListener.bind(this)),this._synthesisState=1===d.isDelayedSynthesisActive()?-1:1,this._isFilteredSynthesis=!1,f.getMqlExpandIntent(this._securityContext,this._pfServiceId).then((function(e){t._expandIntent=f.getExpandIntent(e),sessionStorage.setItem("NGFilter_ExpandIntent_"+t._NGFUXId,t._expandIntent)})),this.render()},render:function(){var e=this;this.container.setContent(this._template({attributeChildrenHiddenLabel:r.get("AttributeChildrenHidden")})),this._createGlobalBtn(),this._attrFromSynthesis=[];e._onSetSecurityContext({NGFUXId:e._NGFUXId,securityContext:e._securityContext}),e._linkedRoots=void 0,function(){if(d.displayInternalTimeTrace(1,"GlobalFilterView Before Expand Synthesis"),e._droppedFilterData)e._getLinkedRootsFromModel(e._droppedFilterData).then((t=>{e._linkedRoots=t;var i=function(t,i){e._synthesisInfos=t,e._initFilterGroup(),e._buildViewFromDroppedFilter(i),e._removeSynthesisAlert(),d.computeAttributesFromSynthesis(t).then((function(t){e._attrFromSynthesis=t}),(function(t){e._attrFromSynthesis=t})),d.displayInternalTimeTrace(0,"GlobalFilterView After Expand Synthesis")};-1===e._synthesisState?e._computeSynthesisFromModel(e._droppedFilterData[0]).then((t=>{i(t,e._droppedFilterData)})):d.getExpandSynthesisInfos(e._getExpandContext(),e._appQueryParam).then((function(t){i(t,e._droppedFilterData)}),(function(t){e._synthesisInfos=[],e._synthesisState=-1,e._initFilterGroup(),e._buildViewFromDroppedFilter(e._droppedFilterData),e._displaySynthesisAlert()}))}));else{var t=function(){var t=function(){sessionStorage.setItem("NGF_isUXBuilt_"+e._UXId,!0),e._initFilterGroup()};return new n((i=>{e._getLinkedRoots().then((n=>{e._linkedRoots=n||void 0,t(),i()}),(function(e){console.log(" ==> _getLinkedRoots / Retrieve root failed, err = "+e),t(),i()}))}))};if(-1===e._synthesisState)t().then((()=>{e._removeSynthesisAlert()}));else{var i=function(t){e._synthesisInfos=t,d.computeAttributesFromSynthesis(e._synthesisInfos).then((function(t){e._attrFromSynthesis=t}),(function(t){e._attrFromSynthesis=t})),e.groupView.setSynthesisInfos({synthesis:e._synthesisInfos,state:e._synthesisState}),d.displayInternalTimeTrace(0,"GlobalFilterView After Expand Synthesis")};t().then((()=>{d.getExpandSynthesisInfos(e._getExpandContext(),e._appQueryParam).then((function(t){i(t),e._removeSynthesisAlert()}),(function(t){e._synthesisState=-1,i([]),e._displaySynthesisAlert()}))}))}}}(),e._defaultFilterName=e._getVolatileFilterName(),e._updateFilterTitle(e._defaultFilterName),this._headerContainer.getElement(".global-header-filtername").tooltipInfos=new w({shortHelp:r.get("ClickToRenameFilter")+" "+this._filterName,mouseRelativePosition:!0});var t=d.getRootFilterContainer(this._UXId);this._cmdsContainer=t.getElement(".global-filter-commands"),this._createRenameFilterUI(),this._createGlobalFilterCommandWUX(),this._createKeepAttributeChildrenUI(),this._updateKeepAttributeChildrenUI(this._keepAttributeChildren),this._divCombination=this._createCombination(),this._divCombination.hide(),this._divSpecificationCmd=this.getElement("#filter-specifications-cmd"),this._addNewSpecBtn=this._createNewSpecificationBtn(this._divSpecificationCmd),this._addExistingSpecBtn=this._createExistingSpecificationBtnWUX(this._divSpecificationCmd),this._divSpecificationCmd.hide();var i=new I({domId:"go-WelcomePage",showLabelFlag:!1,icon:d.getIconByName("home"),displayStyle:"lite"});i.inject(this._cmdsContainer),i.getContent().addClassName("go-WelcomePage"),i.addEventListener("buttonclick",this._onGoBackWelcomePage.bind(this)),i.tooltipInfos=new w({shortHelp:r.get("GoBackWelcomePageTooltip"),mouseRelativePosition:!0});var o=this.options.ghostContainer;return o&&o.remove(),this},onAddCriteriaChange:function(){this._onACCriteria(this._getFilterTitle())},_onAddFocusChangeListener:function(e){this._wgtActiveCriteriaView.updateActiveViewOnFocusChange(e)},_createGlobalBtn:function(){var e=this.getElement(".global-footer");this._applyFilterButton=new I({touchMode:d.TOUCH_MODE,domId:"applyFilterButton",label:r.get("applyFilterButtonLabel"),emphasize:"primary",disabled:!0}),this._applyFilterButton.inject(e),this._applyFilterButton.getContent().addClassName("applyFilterButtonLabel"),this._applyFilterButton.addEventListener("buttonclick",this._onApplyFilterCB.bind(this)),this._saveFilterButton=new I({touchMode:d.TOUCH_MODE,domId:"saveFilterButton",label:r.get("saveFilterButtonLabel"),emphasize:"secondary",disabled:!0}),this._saveFilterButton.inject(e),this._saveFilterButton.getContent().addClassName("saveFilterButtonLabel"),this._saveFilterButton.addEventListener("buttonclick",this._onSaveFilter.bind(this)),this._saveAsFilterButton=new I({touchMode:d.TOUCH_MODE,domId:"saveAsFilterButton",label:r.get("saveAsFilterButtonLabel"),emphasize:"secondary",disabled:!0}),this._saveAsFilterButton.inject(e),this._saveAsFilterButton.getContent().addClassName("saveAsFilterButtonLabel"),this._saveAsFilterButton.addEventListener("buttonclick",this._onSaveAsFilter.bind(this))},_onWidgetRemoved:function(e){this._NGFUXId===e.NGFUXId&&(this._queryFormat=this._getQueryFormat(this._NGFUXId),this._expandIntent=this._getExpandIntent(this._NGFUXId))},_onLaunchFilterCmd:function(){this.groupView.isViewEdited()&&this.validateEditedCriterion().then((e=>{b.publish("NGF_Criterion_Edition",{})}))},_getQueryFormat:function(e){for(var t=0,i=sessionStorage.length,n=0;n<i;n++){var o=sessionStorage.key(n);-1!==o.indexOf("NGFilter_ExpandType_"+e)&&(t|=sessionStorage.getItem(o))}var s=1===v.getOption("ProgressiveSynthesisOn")?1:0;return f.isProgressiveExpandActive()&&s?t|=f.EXPAND_SERVICES.progressive:t&f.EXPAND_SERVICES.expand||t&f.EXPAND_SERVICES.expand3d||(t|=f.EXPAND_SERVICES.expand),t},_getExpandIntent:function(e){for(var t=sessionStorage.length,i=0;i<t;i++){var n=sessionStorage.key(i);if(-1!==n.indexOf("NGFilter_ExpandIntent_"+e)&&"1"===sessionStorage.getItem(n))return 1}return 0},_onSetSecurityContext:function(e){let t=this;this._NGFUXId===e.NGFUXId&&this._defaultSC!==e.securityContext&&(this._defaultSC=e.securityContext,this._getCreateSecurityContexts().then((function(e){0!==e.length?e.indexOf(t._defaultSC)?t._scForSaveFilter=R.getPrefixedSecurityContext(t._defaultSC):t._scForSaveFilter||(t._scForSaveFilter=R.getPrefixedSecurityContext(e[0]),console.log("** _onSetSecurityContext = "+t._defaultSC+" not writable => use 1st allowed SC = "+e[0])):t._scForSaveFilter=""})),this._filterIDCard&&this._filterIDCard.setContext({securityContext:this._defaultSC}))},_cancelRepairFilter:function(){this._onResetFilter(),this._onACCriteria(this._getFilterTitle()),this._isNewRepairActive&&(delete this._retrievedTags,this.options.droppedInfos&&b.publish("NGFilter.ApplyDroppedFilters/"+this._UXId,{success:[],failure:[{rootId:this._rootID,evt:"info",msg:i.String.format(r.get("DropBorkenFilterCancelled"),this._droppedFilterData[0].filterTitle)}]}))},setAppQueryParam:function(e){this._appQueryParam=e},_onGoBackWelcomePage:function(){if(f.setUsageTracker(this._widgetId,"NGF-Commands","homePage"),this._isFilterFromModel)if(this._filterIDCard.isFilterModified())this._displaySaveDialogForSavedFilter();else{var e=JSON.stringify(this.getFilterSpecification(this._rootID,this._keepAttributeChildren));!(!this._currentFilterSpecification||this._currentFilterSpecification===e)?this._displaySaveDialogForSavedFilter():this._displaySaveDialogForVolatileFilter()}else this._displaySaveDialogForVolatileFilter()},_getImmersiveFrame:function(){return this._immersiveFrame||(this._immersiveFrame=new y({identifier:"NGF_ConfirmRequest",domId:"NGF_ConfirmRequest"}),this._immersiveFrame.inject(d.getRootFilterContainer(this._UXId))),this._immersiveFrame},_deactivateImmersiveFrame:function(){this._immersiveFrame&&(this._immersiveFrame.getContent().remove(),this._immersiveFrame=null)},_displaySaveDialogForSavedFilter:function(){var e=this,t=i.createElement("div",{class:"ngf-save-dialog"});i.createElement("img",{src:N.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterWarning.png")}).inject(t);var n="<span>"+r.get("SaveSavedFilterBeforeGoHome")+"<span>",o="<span>"+r.get("LostModificationsOnSavedFilter")+"<span>";i.createElement("div",{class:"ngf-save-dialog-margin",html:"<span>"+n+"<br>"+o+"<br><span>"}).inject(t);var s=new C({domId:"dialog-goHomePage",touchMode:!0,modalFlag:!0,title:r.get("HomeFilteringTitle")+" - "+this._filterTitle,content:t,immersiveFrame:this._getImmersiveFrame(),customButtonsDefinition:[{domId:"save-goHomePage",label:r.get("SaveBeforeGoHome"),emphasize:"primary",disabled:!(!g.isSupplemental()&&!g.isShattered()),onClick:function(t){let i=e.getFilterSpecification(e._rootID,e._keepAttributeChildren),n=e._defaultDBFilterName;if(e._keepFilterNames){let t=e._keepFilterNames.length;for(var o=0;o<t;o++){let t=e._keepFilterNames[o];if(e._filterTitle===e._keepFilters[t].filterTitle){n=t;break}}}e._updateFilter(e._scForSaveFilter,n,e._filterDescription,e._filterTitle,"",i,e._activeFilter).then((function(t){t&&(s.close(),e._deactivateImmersiveFrame(),e._goToHomePage(e._getFilterTitle()),e._combinationCombo.selectedIndex=1)}))}},{domId:"ok-goHomePage",label:r.get("DontSaveBeforeGoHome"),emphasize:"secondary",onClick:function(t){s.close(),e._deactivateImmersiveFrame(),e._goToHomePage(e._getFilterTitle()),e._combinationCombo.selectedIndex=1}},{domId:"cancel-goHomePage",label:r.get("CancelSaveUI"),onClick:function(t){s.close(),e._deactivateImmersiveFrame()}}]});this._addMenuClass(e._currentMenuClass),s.addEventListener("close",(function(t){e._deactivateImmersiveFrame(),e._removeMenuClass(e._currentMenuClass)}))},_displaySaveDialogForVolatileFilter:function(){var e=this;if("true"===sessionStorage.getItem("NGF_ToggleHomePage"))this._goToHomePage(this._getFilterTitle());else{var t=i.createElement("div",{class:"ngf-save-dialog"}),n="<span>"+r.get("SaveVolatileFilterBeforeGoHome")+"<span>",o="<span>"+r.get("LostModificationsOnVolatileFilter")+"<span>";i.createElement("div",{html:"<span>"+n+"<br>"+o+"<br><span>"}).inject(t);var s=new C({domId:"dialog-goHomePage",touchMode:!0,modalFlag:!0,title:r.get("HomePageTitle"),content:t,immersiveFrame:this._getImmersiveFrame(),buttons:{Cancel:new I({domId:"cancel-goHomePage",onClick:function(t){s.close(),e._deactivateImmersiveFrame()}}),Ok:new I({domId:"ok-goHomePage",label:r.get("GoToHomePageButton"),emphasize:"primary",onClick:function(t){s.close(),e._deactivateImmersiveFrame(),e._goToHomePage(e._getFilterTitle()),e._renameFilterLineEditor&&(e._renameFilterLineEditor.value=e._getFilterTitle())}})},checkboxInfos:{label:r.get("DoNotShowAgain"),checkFlag:!1}});this._addMenuClass(e._currentMenuClass),s.addEventListener("close",(function(t){sessionStorage.setItem("NGF_ToggleHomePage",s.checkboxInfos.checkFlag),e._deactivateImmersiveFrame(),e._removeMenuClass(e._currentMenuClass)}))}},_isThereCriteriaDefined:function(){for(var e=!1,t=this._listGroupView.length,i=0;i<t;i++)if(this._listGroupView[i].isThereCriteria()){e=!0;break}return e},_displaySynthesisAlert:function(e,t){var i=this;if(!this._alertSynthesisFailed){this._alertSynthesisFailed=new E({visible:!0,closeOnClick:!1,events:{onRemoveMessage:function(){i._removeSynthesisAlert()}}});let s=d.getRootFilterContainer(this._UXId).getElement(".filter-Grid");this._alertSynthesisFailed.inject(s,"before");var n=t||r.get("ExpandSynthesisFailed"),o="<a> ("+r.get("RefreshSynthesis")+")</a>";this._alertSynthesisFailed.add({className:"primary",message:n+" "+o}),this._alertSynthesisFailed.getContent().getElement("a").addEventListener("click",(function(t){i._refreshSynthesisInfos(e||!0,!0,n)}))}},_removeSynthesisAlert:function(){this._alertSynthesisFailed&&this._alertSynthesisFailed.isVisible&&(this._alertSynthesisFailed.getContent().remove(),this._alertSynthesisFailed=void 0)},_buildViewFromDroppedFilter:function(e){var t=this;this.retrieveFilter=!0,this.droppedFilter=!0;let i=!!(e&&e.length&&e[0].share);this._keepFilters={},this._keepFilterNames=[],this._initFiltersToKeep(e,this.retrieveFilter).then((function(n){t._keepFilters=n.filters,t._keepFilterNames=n.names;var o=t._keepFilters,s=e.length;t._filterDescription=s?e[s-1].filterDescription:"",s=Object.keys(o).length;var r=0;for(var a in o)t._setFilterTitle(o[a].filterTitle),r++,d.checkAndGetListOfAttributesFromSelectedFilter(o[a]).then((function(e){t.groupView.setSynthesisInfos({synthesis:t._synthesisInfos,state:t._synthesisState}),t._buildFilterUIFromSelectedFilter(a,e,d.getTypesOfSynthesis(t._synthesisInfos));var n=t._getFilterTitle();if(t._updateFilterTitle(n),s===r){t._updateCombinationCombo(),t._updateAddSpecificationButton(),t._setGlobalButtonsStatus(i?"ValidOK":"SaveAsOK");let e=t.collection.getActiveGroupCollection();t._setApplySelectable(!!e.length)}})),t._activeFilter=o[a].filterPhysicalId||o[a].filterId,"dropOnFilter"!==t._dropOption&&(t._updateActiveCriteriaView(t._getFilterTitle()),k=t._UXId,t._hasAppliedNGF=!0);t._onDisplayGlobalFilterView()}),(function(e){t._displayNotifOnActionFilterFailed("FilterCanNotBeRestored",e)}))},_getDefaultFilterName:function(){var e=this;return this._defaultFilterName||(this._defaultFilterName=r.get("defaultFilterName")+"-"+this.idxGFV),new n((function(t){c.getDefaultFilterName(e._defaultFilterName,e._defaultSC).then((function(i){e._defaultDBFilterName=i,t(i)}))}))},_getVolatileFilterName:function(){if(!this._defaultFilterName)return B=this.idxGFV?this.idxGFV++:B++,r.get("defaultFilterName")+"-"+B},_initFilterGroup:function(){this._setGlobalButtonsStatus("New"),this._addGroupView()},_addGroupView:function(e){var t=this,i=new _([],{widgetId:this._bodyContainer});let n=new m({groupCollection:i});var o=e&&e.specName?e.specName:n.getFilterSpecificationName(),s=this.collection.getGroupCollectionIndex(o);-1!==s&&n.setFilterSpecificationIndex(s),this.groupView=new u({NGFUXId:this._NGFUXId,appId:this._appId,widgetId:this._widgetId,groupId:this.nbGroupView,rootID:this._rootID,rootAlias:this._rootAlias,rootRevision:this._rootRevision,model:n,UXId:this._UXId,synthesisInfos:this._synthesisInfos,synthesisState:this._synthesisState,securityContext:this._defaultSC,configAvailable:this._isConfigAvailable,volumeAvailable:this._isVolumeAvailable,contextAvailable:this._isContextAvailable,attributeAvailable:this._isAttributeAvailable,tagData:this._tagData,pfServiceId:this._pfServiceId,linkedRoots:this._linkedRoots}),this.nbGroupView+=1,this._listGroupView.push(this.groupView),this._listGroupViewId.push(this.groupView.cid),this.groupView.render().inject(this.getElement("#filter-groups")),this.collection.add(n),this.listenTo(this.groupView,"NGF_RemoveGroup",this._onRemoveGroup.bind(this)),this.listenTo(this.groupView,"NGF_Criterion_ValidateEdited",this.validateEditedCriterion.bind(this)),this.listenTo(this.groupView,"NGF_Group_SwitchedToEdit",this._onEditGroup.bind(this)),this.listenTo(this.groupView,"NGF_AddSpecificationState",this._updateAddSpecificationButton.bind(this)),this.listenTo(this.groupView,"NGF_AttributeCommandsState",this._onAttributeCommandsState.bind(this)),this.listenTo(this.groupView,"NGF_UpdateSpecificationName",this._onUpdateSpecificationName.bind(this)),this.listenTo(this.groupView,"NGF_UpdateApplySaveSaveAsState",this._updateApplySaveSaveAsState.bind(this)),this.listenTo(this.groupView,"NGF_SpecificationActivateChange",this._onSpecificationStateChange.bind(this)),this.listenTo(this.groupView,"NGF_DisplayGlobalFilterView",this._onDisplayGlobalFilterView.bind(this)),this.listenTo(this.groupView,"NGF_EndSetFilterSpecification",this._onEndSetFilterSpecification.bind(this)),this.listenTo(this.groupView,"NGF_ComputeSynthesis",this._onComputeSynthesis.bind(this)),this.listenTo(this.groupView,"NGF_DuplicateSpecifcation",this._onDuplicateSpecification.bind(this)),this.listenTo(this.groupView,"NGF_ChangeRootOfSpecifcation",this._onChangeRootOfSpecification.bind(this)),this.listenTo(this.groupView,"NGF_CheckActivateCriteria",this._checkActiveCriteria.bind(this)),this.listenTo(this.groupView,"NGF_AttrKeepToRemoveMode",(function(){!1===this._checkDisplayKeepChildren()&&this._updateKeepAttributeChildrenUI()})),this.listenTo(this.groupView,"NGF_AttrRemoveToKeepMode",(function(){this._updateKeepAttributeChildrenUI(this._keepAttributeChildren)})),this.listenTo(this.groupView,"NGF_RefreshSynthesis",(function(e){e&&e.refresh?t._refreshSynthesisInfos(!1,!0,e.onErrorMsg):d.displayNotification({level:"warning",message:r.get("RefreshOnCriteriaNotValid")})})),this._tagData&&this.groupView.createTagNGF(this._tagData),1<this._listGroupView.length&&(this._listGroupView.forEach((function(e){e.setDeactivateVisible(!0)})),this._divCombination&&this._divCombination.show()),this._filterToApply&&(this._feedViewWithFilter(this._filterToApply),this._filterToApply=void 0)},_feedViewWithFilter:function(e){var t=this,n=(l=e?e.specification:void 0)&&l.type?l.type:"";if("NGFilter_CopyFromAnyFilterToRoots"===n){if(!this._isThereCriteriaDefined()){var o=l.data;this._filterToApply=void 0,this.buildFilterUIFromFilterRelatedToQuery(o.filterData,o.listAttr,o.rootId,o.options).then((function(){t.onApplyFilter()}))}}else if("NGFilter_VolumeDefined"===n)b.publish(n,l.data);else if("NGFilter_ConfigDefined"===n)e.NGFUXId=e.NGFUXId||this._NGFUXId,b.publish(n,e);else if("NGFilter_RetrieveFilter"===n||"NGFilter_ShareFilterSpec"===n||"NGFilter_RetrieveRoot"===n)this._dropOption=l.data.dropOption,this._dropedFilterIds=[],this._dropedFilterIds=Array.isArray(l.data.filterId)?l.data.filterId:[l.data.filterId];else if("NGFilter_createFromTag"===n){var s="NGF_tagMgtRunning_"+this._UXId;sessionStorage.setItem(s,!0),this.setTagsDataOnNGF(l.data)}else if("NGFilter_Unlink"===n)t._computeSynthesisFromModel(l.data).then((i=>{t._synthesisInfos=i,d.computeAttributesFromSynthesis(i).then((function(i){var n=d.getTypesOfSynthesis(t._synthesisInfos);t._attrFromSynthesis=i;var o=[];o[d.FILTER_ANY_OBJECT]=t._attrFromSynthesis;t._buildFilterViewFromFilterModel(l.data,o,n);t._onDisplayGlobalFilterView(),e.applyFilter?t.onApplyFilter({dispatchApplyToApp:e.applyFilter}):e._tagsOnly||t._updateActiveCriteriaView(t._getFilterTitle())}))}));else if("NGFilter_SetPublicFilterSpec"===n){let n=function(t,i){if(e.proxyEvent){var n={status:1};t&&(n.status=0,n.error={level:i?"warning":"error",title:r.get("SetPublicFilterSpecification"),message:t}),b.publish(e.proxyEvent,n)}};if(this._isThereCriteriaDefined()&&!this._tagsOnly)n(r.get("FilteringInProgress"),1);else{let o=l.data?i.clone(l.data):void 0;if(o&&!(o.title||o.referencedObject||o.filter)&&(o={title:this._defaultFilterName,referencedObject:{identifier:this._rootID},filter:l.data}),o&&o.filter){(o.filter.filterSpecifications||[]).forEach((e=>{(e||[]).filterCriteria.forEach((e=>{if(e&&"tag"===e.criteriaType){let t=e.tagsDefinition?e.tagsDefinition:{};Object.keys(t).forEach((e=>{(t[e]?t[e]:{}).forEach((e=>{let t=e?Object.keys(e):[];for(let i=t.length-1;i>=0;i--)"object"!==t[i]&&"type"!==t[i]&&delete e[t[i]]}))}))}}))}))}f.convertPublicSpecToFilterSpec(t._securityContext,o).then((function(i){t._resetFilter({initFilterUI:1}),l.data={filterUIComponents:i.filterSpec},l.data.filterUIComponents.forEach((function(e){if("toFeedUI"in e&&Array.isArray(e.toFeedUI)){var i=!1;e.toFeedUI.forEach((function(e){"tag"===e.criteriaType&&(i=!0,f._mergeTagData(e,t._tagsInMdl),delete t._tagsInMdl,t._tagsInMdl=UWA.clone(e),delete t._tagData,t._tagData=UWA.clone(e))})),t._tagsInMdl&&!i&&e.toFeedUI.push({criteriaType:"tag",allfilters:t._tagsInMdl.allfilters,localfilters:t._tagsInMdl.localfilters})}})),t._computeSynthesisFromModel(l.data).then((o=>{t._synthesisInfos=o,d.computeAttributesFromSynthesis(o).then((o=>{t._attrFromSynthesis=o,d.checkAndGetListOfAttributesFromSelectedFilter(l.data).then((s=>{s[d.FILTER_ANY_OBJECT]=o,t._isFilterBroken=!1;var r=d.getTypesOfSynthesis(t._synthesisInfos);t._buildFilterViewFromFilterModel(l.data,s,r);t._isFilterFromModel=0,delete t.options.filterToApply,t._renameFilterLineEditor&&(t._renameFilterLineEditor.value=i.title),t._onDisplayGlobalFilterView(),e.applyFilter&&t.onApplyFilter(),b.publish("NGF_DisplayView",{UXId:t._UXId,displayFilter:e.displayFilter}),n()}))}))}))}),(function(e){console.log("==> SetPublicFilter / convertToPersistency , err = "+e),n(e.error)}))}}else if("NGFilter_GetPublicFilterSpecFromVolatile"===n){var a=e.rootID,l=this.getFilterSpecification(a,this._keepAttributeChildren,void 0,{keepEmpty:!1}),c={rootPhysicalId:a,filterName:this._defaultFilterName,filterTitle:this._getFilterTitle(),filterDescription:this._filterDescription,filterUIComponents:l,rootServiceId:this.options.pfServiceId};f.convertVolatileFilterSpecToPublicSpec(t._securityContext,c).then((t=>{var i={status:1,publicSpec:t};b.publish(e.proxyEvent,i)}),(function(t){console.log("==> GetPublicFilter / convertToPublic , err = "+t);var i={status:0,error:{level:"error",title:r.get("GetPublicFilterSpecification"),message:t}};b.publish(e.proxyEvent,i)}))}else this.groupView&&this.groupView.feedViewWithFilter(e).then((function(){t._updateApplySaveSaveAsState({status:"ValidOK"}),t._onDisplayGlobalFilterView(),e&&e.applyFilter&&t.onApplyFilter(),e&&e.displayFilter&&d.openFilterPanel(t._UXId)}))},_onEndSetFilterSpecification:function(e){this._updateApplySaveSaveAsState({status:"ValidOK"}),this._onDisplayGlobalFilterView(),1===e.applyFilter&&this.onApplyFilter(),0!==e.displayFilter&&d.openFilterPanel("NGF_EndSetFilterSpecification_"+Date.now())},_onDuplicateSpecification:function(e){this._onAddNewFilterSpecification(e)},_onChangeRootOfSpecification:function(e){var t=this;this.validateEditedCriterion().then((function(i){if(i){t.groupView.model.set("state","read");var n=t.collection.keepComponentsToFeedUI(t._rootID,t._keepAttributeChildren,void 0,{keepEmpty:!0}),o=t._listGroupViewId.indexOf(e.specId),s=[];s.push(n[0]),s.push(n[o+1]),d.checkCompatibiltyFilterRules(t._securityContext,e.rootId,{rootPhysicalId:e.newRootId,filterUIComponents:s},1,t.options.pfServiceId).then((function(i){i.result.error?d.checkAndGetListOfAttributesFromSelectedFilter(i.filterSpec).then((function(n){n[d.FILTER_ANY_OBJECT]=t._attrFromSynthesis;var s=d.getTypesOfSynthesis(t._synthesisInfos);t._listGroupView[o].clearCriteria(),t._listGroupView[o].filterViewFromModel(e.rootId,i.filterSpec.filterUIComponents[1],n,s),e.callback&&e.callback.call(t,e.newRootId)})):e.callback&&e.callback.call(t,e.newRootId),t._updateCombinationCombo()}))}}))},_onComputeSynthesis:function(e){var t=this;this._hasToComputeSynthesis&&(this._hasToComputeSynthesis=0,setTimeout((()=>{-1!==this._synthesisState&&S.mask(this.container),d.getExpandSynthesisInfos(this._getExpandContext(),this._appQueryParam).then((function(i){d.computeAttributesFromSynthesis(i).then((function(n){t._hasToComputeSynthesis=1,S.unmask(t.container),t._synthesisInfos=i,t._synthesisState=1,t._attrFromSynthesis=n,t._listGroupView.forEach((function(e){e.setSynthesisInfos({synthesis:t._synthesisInfos,state:t._synthesisState,attributes:t._attrFromSynthesis})})),"function"==typeof e.callback&&e.callback(e.options),t._removeSynthesisAlert()}),(function(e){console.log("_onComputeSynthesis / computeAttributesFromSynthesis failed, err = "+e),t._listGroupView.forEach((e=>{e.updateOnceSynthesisComputed()})),t._hasToComputeSynthesis=1,S.unmask(t.container),t._displaySynthesisAlert()}))}),(function(e){console.log("_onComputeSynthesis / getExpandSynthesisInfos failed, err = "+e),t._listGroupView.forEach((e=>{e.updateOnceSynthesisComputed()})),t._hasToComputeSynthesis=1,S.unmask(t.container),t._displaySynthesisAlert()}))}),this._computeSynthesisOnTimeOut))},_refreshSynthesisInfos:function(e,t,i){var n=void 0===t||t;n&&S.mask(this.container);var o=this,s=function(e,t){o._synthesisInfos=e,o._synthesisState=1,o._attrFromSynthesis=t,o._listGroupView.forEach((function(e){e.setSynthesisInfos({synthesis:o._synthesisInfos,state:o._synthesisState,attributes:o._attrFromSynthesis})})),n&&S.unmask(o.container),o._removeSynthesisAlert()},r=function(e,t){t&&S.unmask(o.container),o._displaySynthesisAlert(e,i)};if(e)if(0===g.getCVQueryBuildMode()){var a=this._buildCVQuerySync(),l=V.completeCVQueryWithAppParams(JSON.parse(a),this._appQueryParam,void 0,!1);d.refreshExpandSynthesisInfos(this._getExpandContext(),l).then((function(e){s(e),o._isFilteredSynthesis=!0}),(function(t){r(e,n)}))}else this.buildCVQuery().then((function(t){var i=V.completeCVQueryWithAppParams(JSON.parse(t),o._appQueryParam,void 0,!1);d.refreshExpandSynthesisInfos(o._getExpandContext(),i).then((function(e){d.computeAttributesFromSynthesis(e).then((function(t){s(e,t),o._isFilteredSynthesis=!0}))}),(function(t){r(e,n)}))}));else d.getExpandSynthesisInfos(this._getExpandContext(),this._appQueryParam).then((function(e){d.computeAttributesFromSynthesis(e).then((function(t){s(e,t)}))}),(function(t){r(e,n)}))},_checkDisplayKeepChildren:function(){let e=!1,t=this._listGroupView.length;for(var i=0;i<t&&!e;i++){let t=this._listGroupView[i];d.isModelActivated(t.model)&&(e=t.checkDisplayKeepChildren())}return e},_onSelectObject:function(e){this._rootID=e.rootID,this._rootAlias=e.rootAlias,this.groupView&&(this.groupView._rootID=this._rootID,this.groupView._rootAlias=this._rootAlias),this.getElement(".filter-applies")&&this.getElement(".filter-applies-root").setContent(this._rootAlias)},_onSaveFilter:function(){var e=this;this._saveBasedOnPLMNew=(v.getOption("NGF_PLMNew")?1:0)||f.isActivated("NGF_PLMNew"),0===d.isAsynchronousValidation()?e._onSaveFilterSync(e):this.validateEditedCriterion().then((function(t){if(t){var i="{}";0===g.getCVQueryBuildMode()&&(i=e._buildCVQuerySync());var n=e.getFilterSpecification(e._rootID,e._keepAttributeChildren);e._isFilterFromModel?e._checkFilterNameAndUpdateFilter(e._defaultFilterName,i,n):e._saveBasedOnPLMNew?e._onSavePLMNew():e._displayRenameDialogAndCreateFilter("SaveTitle",i,n),e.groupView.switchToEdit()}else e.groupView.switchToEdit()}))},_onSavePLMNew:function(e){var t=this;let n=d.getRootFilterContainer(this._UXId),o=i.String.format(r.get("LoaderForPLMnew"));S.mask(n,o);var s=t.getFilterSpecification(t._rootID,t._keepAttributeChildren);let a={callbacks:{onSuccess:function(e){f.getFilterBasics(e.result[0].identifier,t._scForSaveFilter).then((i=>{d.displayNotification({level:"success",message:r.get("FilterCreationSuccessfull")});let n=i[0][e.result[0].identifier],o=(n.maturity,n.project,n.revision,n.filterTitle);t._updateFilterTitleAndAC(o);t._setGlobalButtonsStatus("SaveOK"),t._activeFilter=e.result[0].identifier,b.publish("NGFilter_saved",{rootID:t._rootID,filterId:e.result[0].identifier}),t._displayFilterIDCard(!0,e.result[0].identifier,n),t._isFilterFromModel=1,t._unsavedChangesMsgDisplayed=!1}))},onFailure:function(e){e&&e.result&&e.result[0]&&e.result[0].errors&&(d.displayNotification({level:"info",title:r.get("FilterCanNotBeSaved")+" ",subtitle:e.result[0].errors.errorTitle,message:"<p>"+r.get("FilterCanNotBeSaved")+" <br>"+e.result[0].errors.errorTitle+"</p>"}),console.log("** Advanced Filter PLMNew creatio KO: "+e.result[0].errors.errorTitle),S.unmask(n,o))},onCancel:function(e){e.preferedCredential&&(t._scForSaveFilter=e.preferedCredential)}},service:this._pfServiceId,serviceBaseUrl:g.getPlatformServiceUrl(f.getTenant(),this._pfServiceId),tenant:f.getTenant(),securityContext:this._scForSaveFilter,ENOStrSpecDesc:s,physicalId:t._rootID,UXId:t._UXId,title:this._forcedTitle,saveAs:e};require(["DS/ENONewWidget/command/NewContentCommandBase"],(()=>{require(["DS/ENONextGenFilterUX/views/PLMNewAdvancedFilterCmd"],(e=>{new e(a).execute(a)}))}))},_onSaveAsFilter:function(){var e=this;this._saveBasedOnPLMNew=(v.getOption("NGF_PLMNew")?1:0)||f.isActivated("NGF_PLMNew"),this._saveBasedOnPLMNew?this.validateEditedCriterion().then((function(t){t&&(e._onSavePLMNew(!0),e.groupView.switchToEdit())})):0===d.isAsynchronousValidation()?e._onSaveAsFilterSync(e):this.validateEditedCriterion().then((function(t){if(t){var i="{}";0===g.getCVQueryBuildMode()&&(i=e._buildCVQuerySync());var n=e.getFilterSpecification(e._rootID,e._keepAttributeChildren);e._displayRenameDialogAndCreateFilter("SaveAsTitle",i,n),e.groupView.switchToEdit()}}))},_checkFilterNameAndUpdateFilter:function(e,t,n){var o=this;if(this._areFilterTitleAndDescriptionSafe()){o._invalidFilterName&&(o._invalidFilterName.destroy(),o._invalidFilterName=null),o._invalidFilterDescription&&(o._invalidFilterDescription.destroy(),o._invalidFilterDescription=null);var s=i.createElement("div",{class:"ngf-save-dialog"});i.createElement("img",{src:N.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterWarning.png")}).inject(s);var a=r.get("OverwriteExistingFilter"),l=r.get("ProceedValidation");i.createElement("div",{class:"ngf-save-dialog-margin",html:"<span>"+a+"</span><br><span>"+l+"</span>"}).inject(s);var d=new C({touchMode:!0,modalFlag:!0,title:r.get("SaveTitle")+" - "+o._filterTitle,content:s,immersiveFrame:this._getImmersiveFrame(),buttons:{Cancel:new I({label:r.get("CancelSaveUI"),emphasize:"secondary",onClick:function(e){d.close(),o._deactivateImmersiveFrame()}}),Apply:new I({domId:"saveAsFilterButton",label:r.get("saveAsFilterButtonLabel"),emphasize:"secondary",onClick:function(e){d.close(),o._deactivateImmersiveFrame(),o._onSaveAsFilter()}}),Ok:new I({label:r.get("SaveButton"),emphasize:"primary",onClick:function(i){o._updateFilter(o._scForSaveFilter,e,o._filterDescription,o._filterTitle,t,n,o._activeFilter).then((function(e){e&&(d.close(),o._deactivateImmersiveFrame())}))}})}});this._addMenuClass(o._currentMenuClass),d.addEventListener("close",(function(e){o._deactivateImmersiveFrame(),o._removeMenuClass(o._currentMenuClass)}))}else{let e=[r.get("InvalidTitleOrDescription")];this._displayCreateFilterFailed(e)}},_displayRenameDialogAndCreateFilter:function(e,t,n,o){var s=this;let a=s._canFilterBeCreated();if(a.length)this._displayCreateFilterFailed(a);else{var l=new i.Element("div",{class:"ngf-Save-content"}),c=new i.Element("div",{class:"ngf-Save-filterName",html:"<p>"+r.get("FilterNameToSave")+"</p>"}).inject(l,"top"),u=r.get("placeHolderFilterName"),h=new F({touchMode:d.TOUCH_MODE,placeholder:u,domId:"SaveName"});h.inject(c);var p=d.MAX_CHAR_DESCRIPTION,_=new i.Element("div",{class:"ngf-Save-filterName",html:"<p>"+i.String.format(r.get("FilterDescriptionToSave"),p)+"</p>"});_.inject(l),u=r.get("FilterDescriptionToSavePlaceHolder");var m=new D({touchMode:d.TOUCH_MODE,nbRows:3,newLineMode:"enter",domId:"SaveDescription"});m.inject(_),m.addEventListener("change",(function(e){if(s._isFilterNameAllowed()&&s._isFilterDescriptionAllowed()){var t=e.dsModel.value.slice(0,p-1),i=e.target;void 0===i.tooltipInfos?i.tooltipInfos=new w({shortHelp:t,mouseRelativePosition:!0}):i.tooltipInfos.shortHelp=t,s._filterDescription=t}})),m.addEventListener("uncommittedChange",(function(e){var t=e.dsModel.valueToCommit,n=s.saveUIModal.getContent().getElement("#SaveDescription"),o=t.slice(0,p-1),a=d.isSafeDescription(o);if(a&&p>=t.length)n.removeClassName("attr-edit-inputs-Attribute-Error"),s._invalidFilterDescription&&s._invalidFilterDescription.hide();else{n.addClassName("attr-edit-inputs-Attribute-Error");var l=a?void 0:r.get("BadCharacters")+": "+d.NOT_ALLOWED.forDescription.join(" "),c=p<t.length?i.String.format(r.get("FilterDescriptionTooLong"),p):void 0,u=l?'<p style="margin:0px">'+l+"</p>":"";u+=c?'<p style="margin:0px">'+c+"</p>":"",s._invalidFilterDescription?(s._invalidFilterDescription.setHTML(u),s._invalidFilterDescription.show()):s._invalidFilterDescription=new i.Element("div",{class:"wux-control-inline-saveName",html:u}).inject(n,"bottom")}if(s.saveUIModal){var h=!a||!s._isFilterDescriptionAllowed();s.saveUIModal.getContent().getElement(".wux-ui-state-primary").dsModel.disabled=h}})),this._getDefaultFilterName().then((function(t){S.unmask(y),h.value="SaveAsTitle"===e?s._defaultDBFilterName:o&&o.filterName?o.filterName:s._forcedTitle?s._forcedTitle:s._defaultDBFilterName,b=h.value,h.addEventListener("focus",(function(e){})),h.addEventListener("change",(function(e){if(s._isFilterNameAllowed()&&s._isFilterDescriptionAllowed()){s.saveUIModal.getContent().getElement("#SaveName");b=e.dsModel.value}})),h.addEventListener("uncommittedChange",(function(e){var t=e.dsModel.valueToCommit,n=s.saveUIModal.getContent().getElement("#SaveName"),o=d.isSafeTitle(t),a=!t.length;if(!1===o||a){var l="";l=a?'<p style="margin:0px">'+r.get("FilterNameMustBeFeed")+"</p>":'<p style="margin:0px">'+r.get("BadCharacters")+": "+d.NOT_ALLOWED.forTitle.join(" ")+"</p>",n.addClassName("attr-edit-inputs-Attribute-Error"),s._invalidFilterName?(s._invalidFilterName.setHTML(l),s._invalidFilterName.show()):s._invalidFilterName=new i.Element("div",{class:"wux-control-inline-saveName",html:l}).inject(n,"bottom")}else n.removeClassName("attr-edit-inputs-Attribute-Error"),s._invalidFilterName&&s._invalidFilterName.hide();if(s.saveUIModal){var c=!(o&&!a&&s._isFilterDescriptionAllowed());s.saveUIModal.getContent().getElement(".wux-ui-state-primary").dsModel.disabled=c}}))}));var g=new i.Element("div",{class:"ngf-Save-filterName"}).inject(l,"bottom"),v=new i.Element("p",{}).inject(g);i.createElement("span",{text:r.get("getCurrentSecurityContext")}).inject(v),this._getCreateSecurityContexts().then((function(e){0===e.length&&d.displayNotification({level:"error",title:r.get("FilterCanNotBeSaved")+" ",subtitle:r.get("PLMNew_NoSaveCredentials"),message:"<p>"+r.get("FilterCanNotBeSaved")+"<br>"+r.get("PLMNew_NoSaveCredentials")+"</p>"}),s._securityContextCombo=new A({touchMode:d.TOUCH_MODE,elementsList:e,enableSearchFlag:!1}).inject(g,"bottom"),s._scForSaveFilter=s._securityContextCombo.currentValue,s._securityContextCombo.addEventListener("change",(function(e){s._scForSaveFilter=e.dsModel.currentValue}));var t=e.findIndex((e=>-1!==e.valueItem.indexOf(s._defaultSC)));s._securityContextCombo.selectedIndex=-1===t?0:t,-1===t&&console.log("** _displayRenameDialogAndCreateFilter & _getCreateSecurityContexts: selected SC = "+s._defaultSC+" not writable => use 1st allowed SC = "+s._securityContextCombo.selectedIndex);var n=i.createElement("span",{class:"fonticon fonticon-help ngf-Save-SecutiryContext-Help"});n.inject(v),n.tooltipInfos=new w({shortHelp:r.get("SecurityContextTooltip"),mouseRelativePosition:!0})}));var b=this._getFilterTitle();this._invalidFilterName&&(this._invalidFilterName.destroy(),this._invalidFilterName=null),this._invalidFilterDescription&&(this._invalidFilterDescription.destroy(),this._invalidFilterDescription=null),this.saveUIModal=new C({touchMode:!0,modalFlag:!0,title:r.get(e),domId:"NGF_SavePanel",content:l,immersiveFrame:this._getImmersiveFrame(),buttons:{Cancel:new I({label:r.get("CancelSaveUI"),emphasize:"secondary",onClick:function(e){s.saveUIModal.close(),s._deactivateImmersiveFrame(),o&&o.onCancel&&o.onCancel.call()}}),Ok:new I({label:r.get("SaveButton"),emphasize:"primary",onClick:function(i){if(b){let i=s._filterState;s._saveFilter(s._scForSaveFilter,s._defaultDBFilterName,s._filterDescription,b,t,n).then((function(t){if(t&&(i="SaveOK",o&&o.onOk&&o.onOk.call(),f.setUsageTracker(s._widgetId,"NGF-Save-Filter",{label:"save",value:"SaveAsTitle"===e?2:1}),f.setUsageTracker(s._widgetId,"NGF-Save-Filter-SpecificationCount",{label:"count",value:s._listGroupView.length}),1<s._listGroupView.length)){var n=s._combinationCombo.currentValue;n="union"===n?"any":"intersection"===n?"all":"except",f.setUsageTracker(s._widgetId,"NGF-Multi-Specification-Combination",n)}s.saveUIModal.close(),s._deactivateImmersiveFrame(),s._setGlobalButtonsStatus(i)}))}else s.saveUIModal.getContent().getElement("#SaveName").addClassName("attr-edit-inputs-Attribute-Error"),s._removeMenuClass(s._currentMenuClass)}})}}),this.saveUIModal.getContent().addClassName("ngf-save-dialog-width"),m.value=this._filterDescription;var y=document.body.getElement("#NGF_SavePanel .wux-windows-window-mask-content");S.mask(y),this._addMenuClass(s._currentMenuClass),this.saveUIModal.addEventListener("close",(function(e){s._deactivateImmersiveFrame(),s._removeMenuClass(s._currentMenuClass)}))}return this.saveUIModal},_isFilterNameAllowed:function(){return!!(!this._invalidFilterName||this._invalidFilterName&&this._invalidFilterName.isHidden())},_isFilterDescriptionAllowed:function(){return!!(!this._invalidFilterDescription||this._invalidFilterDescription&&this._invalidFilterDescription.isHidden())},_canFilterBeCreated:function(){let e=[];return!this._areFilterTitleAndDescriptionSafe()&&e.push(r.get("InvalidTitleOrDescription")),e},_displayCreateFilterFailed:function(e){if(e&&e.length){let t="<ol>";e.forEach((e=>{(e=Array.isArray(e)?e:[e]).forEach((e=>{t+="<li>"+e+"</li>"}))})),t+="</ol>",d.displayNotification({level:"warning",title:r.get("SaveFilterTitle")+" ",subtitle:r.get("FilterCanNotBeSaved"),message:t})}},_areFilterTitleAndDescriptionSafe:function(){return d.isSafeTitle(this._filterTitle)&&d.isSafeDescription(this._filterDescription)?1:0},_getCreateSecurityContexts:function(){var e=this;return new n((function(t,i){sessionStorage.removeItem("NGF_listSecurityContext"),e._listSecurityContext?t(e._listSecurityContext):f.getCreateSecurityContexts(f.getTenant(),e._pfServiceId).then((function(i){var n=[],o=i.cspaces;if(Array.isArray(o)){for(var s=0;s<o.length;s++)n[s]={labelItem:o[s].label,valueItem:R.getPrefixedSecurityContext(o[s].value)};e._listSecurityContext=n}t(n)}))}))},_onApplyFilterCB:function(e){this.onApplyFilter()},onApplyFilter:function(e){var t=this;0===d.isAsynchronousValidation()?t.onApplyFilterSync(t):this.validateEditedCriterion().then((function(i){if(i)if(1===t._synthesisState&&t._isFilteredSynthesis&&(t._refreshSynthesisInfos(!1,!1),t._isFilteredSynthesis=!1),k=t._UXId,t._hasAppliedNGF=!0,t._appliedFilterTitle=t._getFilterTitle(),t._tagsOnly=!!e&&e.tagsOnly,0===g.getCVQueryBuildMode()){var n=t._buildCVQuerySync(!1);t._applyFilter({CVQuery:n,isEmpty:!!e&&e.empty}),t.groupView.switchToEdit(),t._updateAddSpecificationButton(),t._updateApplySaveSaveAsState({status:"ValidOK"})}else t.buildCVQuery().then((function(i){t._applyFilter({CVQuery:i,isEmpty:!!e&&e.empty,tagsInMdl:t._tagsInMdl,dispatchApplyToApp:e?e.dispatchApplyToApp:void 0,event:e?e.event:void 0}),t.groupView.switchToEdit(),t._updateAddSpecificationButton(),t._updateApplySaveSaveAsState({status:"ValidOK"})}),(function(e){t._displayNotifOnActionFilterFailed("FilterCanNotBeApplied",e)}));else t.groupView.switchToEdit()}))},_onRemoveFilter:function(e){var t=e.NGFUXId;if(t){var i=0;if(e.rootIds)for(var n=Array.isArray(e.rootIds)?e.rootIds:[e.rootIds],o=0;o<n.length;o++){if(t+"_"+n[o]===this._UXId){i=1;break}}else i=-1!==this._UXId.indexOf(t)?1:i;i&&(this._resetFilter({initFilterUI:0}),this._updateActiveCriteriaView(""),this._hasAppliedNGF=!1,this.dispatchConfigRevision(!0),this._subscribeRemoveFilter&&this._subscribeRemoveFilter.unsubscribe("NGFilter.RemoveFilter"),this._subscribeRemoveFilter&&this._subscribeRedraw.unsubscribe("NGFilter.Redraw"),this._subscribeSecurityContext&&this._subscribeSecurityContext.unsubscribe("NGFilter.SetDefaultSecurityContext"),this._subscribeLaunchFilterCmd&&this._subscribeLaunchFilterCmd.unsubscribe("NGFilter_LaunchFilterCmd"),this._filterIDCard&&this._filterIDCard.remove())}},_emptyFilter:function(e){var t=this._listGroupView.length;if(0!==t){for(var i=e&&e.initFilterUI?e.initFilterUI:void 0,n=t-1;n>=0;n--){var o=this._listGroupView[n];null!=o&&this._removeGroup({groupId:o.cid},i)}b.publish("NGF_Criterion_Edition",{})}this._divSpecificationCmd.hide(),this._setGlobalButtonsStatus("New")},_saveFilter:function(e,t,o,s,a,l){var u=this;return new n((function(n,h){u._setFilterTitle(s);var p="3DSpace"!==u._pfServiceId?u._pfServiceId:"";c.saveFilter(e,t,o,s,u._rootID,a,l,p).then((function(e){e&&e.filter?(d.displayNotification({level:"success",message:r.get("FilterCreationSuccessfull")}),u._updateFilterTitleAndAC(s),e.filterId&&(u._activeFilter=e.filterId,b.publish("NGFilter_saved",{rootID:u._rootID,filterId:e.filterId})),u._displayFilterIDCard(!0,e.filterId,e.filter[0]),u._isFilterFromModel=1,u._unsavedChangesMsgDisplayed=!1,n(!0)):(d.displayNotification({level:"error",subtitle:i.String.format(r.get("FilterCreationFailed"),"Advanced Filter"),message:"<p>"+r.get("FilterAccessFailed-1")+"<br>"+r.get("FilterAccessFailed-2")+"</p>"}),u._setFilterTitle(u._defaultFilterName),n(!1))}))}))},_updateFilter:function(e,t,i,o,s,a,l){var u=this;return new n((function(n,h){if(u._areFilterTitleAndDescriptionSafe())c.updateFilter(e,t,i,o,s,a,l).then((function(e){e&&e.filter?(d.displayNotification({level:"success",message:r.get("FilterUpdateSuccessfull")}),u._filterIDCard&&u._filterIDCard.displayUnsavedChangesPanel(!1),u._unsavedChangesMsgDisplayed=!1,u._updateFilterTitleAndAC(o),n(!0)):(d.displayNotification({level:"error",subtitle:r.get("FilterUpdateFailed"),message:"<p>"+r.get("FilterAccessFailed-1")+"<br>"+r.get("FilterAccessFailed-2")+"</p>"}),n(!1))}));else{let e=[r.get("InvalidTitleOrDescription")];u._displayCreateFilterFailed(e),n(!1)}}))},_applyFilter:function(e){var t,i,n=this,o=e.CVQuery,s=e.isEmpty,a=this._appliedFilterTitle,l=!1;if(s||(t=n.getFilterSpecification(n._rootID,n._keepAttributeChildren),i=JSON.stringify(t),l=!(!this._currentFilterSpecification||this._currentFilterSpecification===i),this._isFilterFromModel?l?(a+=r.get("WithUnsavedChanges"),this._unsavedChangesMsgDisplayed=!0):a+=this._unsavedChangesMsgDisplayed?r.get("WithUnsavedChanges"):"":a+="",l&&this._filterIDCard.displayUnsavedChangesPanel(!0)),this._currentFilterSpecification=i,this._updateActiveCriteriaView(a),e&&e.tagsInMdl&&this._wgtActiveCriteriaView.updateCriteria(e.tagsInMdl),o&&(o="string"==typeof o?JSON.parse(o):o),null==e.dispatchApplyToApp||e.dispatchApplyToApp){var d={empty:s,appId:n._appId,widget:n._widgetId,CVQuery:o.CVQuery,CVQuery3D:o.CVQuery3D,CVQueryV2:o.CVQueryV2,filterMdl:t,filterRootIds:[n._rootID],filterRootAlias:[n._rootAlias],filterTitle:n._filterTitle,filterId:n._activeFilter?n._activeFilter:void 0,tagsInMdl:e.tagsInMdl,event:e.event};this._removeUselessQueries(d),b.publish("onApplyNGFilter/"+n._NGFUXId,d),this.dispatchConfigRevision(s)}sessionStorage.setItem("NGF_isUXBuilt_"+n._UXId,!0)},_removeUselessQueries:function(e){this._queryFormat&f.EXPAND_SERVICES.progressive||delete e.CVQueryV2,this._queryFormat&f.EXPAND_SERVICES.expand||delete e.CVQuery,this._queryFormat&f.EXPAND_SERVICES.expand3d||delete e.CVQuery3D},dispatchConfigRevision:function(e){var t={NGFUXId:this._NGFUXId,widgertId:this._widgetId,rootId:this._rootID},i=[];if(e||this._listGroupView.forEach((e=>{if(d.isModelActivated(e.model)){var t=e.getConfigRevision();i=i.concat(t)}})),i.length){this._filterAppliedWithConfigRevision=1;var n="NGFilter.SetConfigurationRevision_"+this._widgetId;t.configRevision=i,b.publish(n,t)}else if(this._filterAppliedWithConfigRevision){this._filterAppliedWithConfigRevision=0;n="NGFilter.RemoveConfigurationRevision_"+this._widgetId;b.publish(n,t)}},_onRedraw:function(e){this._wgtActiveCriteriaView&&this._UXId===e.filterId&&(this._isFilterBroken&&void 0!==this._isFilterBroken||this._updateActiveCriteriaView(this._hasAppliedNGF?this._getFilterTitle():""),k=this._UXId)},_updateActiveCriteriaView:function(e){if(this._hasAppliedNGF||this._tagsOnly||!this._hasAppliedNGF&&!e){if(null!==this._wgtActiveCriteriaView){var t=[];e&&t.push({displayValue:e,icon:"I_DefineFilter"}),this._wgtActiveCriteriaView.updateAdditionalCriteria(t)}b.publish("NGFilter.onRenameNGFilter/"+this._NGFUXId,e)}},_onACTrash:function(e){k===this._UXId&&(this._taggerMgt=!1,this._hasTag()&&(Object.keys(this._tagsInMdl.allfilters).length&&!Object.keys(this._tagsInMdl.localfilters).length&&this._hasAppliedNGF||(this._taggerMgt=!0)),this._onACEvent())},_onACCriteria:function(e){e&&this._appliedFilterTitle&&-1!==e.indexOf(this._appliedFilterTitle)&&this._onACEvent()},_hasTag:function(){return!(!this._tagsInMdl||!Object.keys(this._tagsInMdl.allfilters).length&&!Object.keys(this._tagsInMdl.localfilters).length)},_onACEvent:function(){if(this._appliedFilterTitle="",this._hasTag()){var e=this;if(this._tagsOnly=!0,0===g.getCVQueryBuildMode()){var t=this._buildCVQuerySync();this._applyFilter({CVQuery:t,isEmpty:!1})}else this.buildCVQuery().then((function(t){e._applyFilter({CVQuery:t,isEmpty:!1})}))}else this._applyFilter({CVQuery:f.buildEmptyFilter(this._rootID),isEmpty:!0});k="",this._hasAppliedNGF=!1,sessionStorage.setItem("NGF_tagMgtRunning_"+this._UXID,!1),this._taggerMgt=!1},_onResetFilterCmd:function(e){f.setUsageTracker(this._widgetId,"NGF-Commands","reset"),this._onResetFilter()},_onResetFilter:function(e){this._resetFilter({initFilterUI:1,updateAC:e&&e.context?e.context.updateAC:1}),this._keepAttributeChildren=!0,this._isHideOrShowCmdDisabled=0,this._updateKeepAttributeChildrenUI(this._keepAttributeChildren),this._filterIDCard&&this._filterIDCard.remove(),this._displayFilterIDCard(!1),this._isFilterFromModel=0,this._unsavedChangesMsgDisplayed=!1,this._isFilterBroken=!1},_resetFilter:function(e){this._emptyFilter(e),this._updateFilterTitle(this._defaultFilterName),this._updateActiveCriteriaView(this._hasAppliedNGF?this._getFilterTitle():""),this._activeFilter="",this._filterDescription="",this._forcedTitle=""},_onRemoveGroup:function(e){this._removeGroup(e,e.initFilterUI)},_removeGroup:function(e,t){var i=this._listGroupViewId.indexOf(e.groupId);if(-1!==i){var n=this._listGroupView[i];this._listGroupView.splice(i,1),this._listGroupViewId.splice(i,1),this.collection.removeGroupCollection(n.model),n.destroy();var o=this._listGroupView.length;if(0!==o){for(var s=-1,r=o-1;r>=0;r--)if(d.isModelActivated(this._listGroupView[r].model)){this.groupView=this._listGroupView[r],s=r;break}-1===s&&(this.groupView=this._listGroupView[o-1],this.groupView.setActivatedState(1)),this.groupView.setDeactivateVisible(1!==o),this.groupView.switchToEdit(),1===o&&this._divCombination&&(this._divCombination.hide(),this._combinationCombo.selectedIndex=1)}else{var a=this.getElement("#filter-groups");if(null!==a)for(;a.hasChildNodes();)a.removeChild(a.firstChild);delete this.groupView,this.nbGroupView=0,1===t&&(this._updateFilterTitle(this._defaultFilterName),this._setGlobalButtonsStatus("New"),this._synthesisState=-1,this._synthesisInfos=void 0,this._initFilterGroup(),this._removeSynthesisAlert())}this._updateCombinationCombo(),this._updateAddSpecificationButton(),this._updateAttributeCommandsState()}},_renameFilterCmd:function(){f.setUsageTracker(this._widgetId,"NGF-Commands","renameFilter"),"SaveOK"!==this._filterState?this.model.set("state","edit"):d.displayNotification({level:"info",message:r.get("UseSaveAsToRenameExistingFilter")})},_onStateChange:function(e,t){"edit"===t&&null!==this._renameFilterLineEditor&&this._renameFilterLineEditor._giveFocus()},_createRenameFilterUI:function(){this._renameFilterLineEditor=this._createRenameFilterLineEditor()},_createRenameFilterLineEditor:function(){var e=this;let t=this._headerContainer.getElement(".global-header-filtername");var i=new F({touchMode:!0,placeholder:r.get("placeHolderFilterName"),selectAllOnFocus:!0,domId:"Rename_Filter"});i.value=e._defaultFilterName,i.inject(t),i.getContent().setAttribute("ngf_touch_unsensitive","");var n=function(t){var i=d.isSafeTitle(t);return i?e._renameFilterLineEditor.getContent().removeClassName("attr-edit-inputs-Attribute-Error"):(d.displayNotification({level:"error",message:UWA.String.format(r.get("InvalidCharacters"),d.NOT_ALLOWED.forTitle.join(" "))}),e._renameFilterLineEditor.getContent().addClassName("attr-edit-inputs-Attribute-Error")),i};i.addEventListener("focus",(function(i){e._renameFilterLineEditor.getContent().hasClassName("attr-edit-inputs-Attribute-Error")||(e._renameFilterLineEditor.value=e._getFilterTitle(),t.addClassName("selected-nodes-active"))})),i.addEventListener("change",(function(t){var i=t.dsModel.value;n(i)&&e._updateFilterTitleAndAC(i)})),i.addEventListener("blur",(function(i){var o=i.dsModel.value;n(o)?(e._updateFilterTitleAndAC(o),t.removeClassName("selected-nodes-active")):e._renameFilterLineEditor._giveFocus()})),i.addEventListener("uncommittedChange",(function(e){var t=e.dsModel.valueToCommit;n(t)}));let o=new I(d.getAttributeButtonStyle("rename"));return o.displayStyle="lite",o.getContent().addClassName("attribute-edit-button-style"),o.inject(t),o.addEventListener("buttonclick",this._renameFilterCmd.bind(this)),o.tooltipInfos=new w({shortHelp:r.get("renameFilterTooltip"),mouseRelativePosition:!0}),o.hide(),this._renameFilterBtn2=o,i},_updateFilterTitleAndAC:function(e){this._forcedTitle=e,this._updateFilterTitle(e),this.model.set("state","read"),this._updateActiveCriteriaView(e)},_updateFilterTitle:function(e){this._setFilterTitle(e),this._appliedFilterTitle&&(this._appliedFilterTitle=e)},_setFilterTitle:function(e){this._filterTitle=e},_getFilterTitle:function(){return this._filterTitle?this._filterTitle:this._defaultFilterName},_displayFilterIDCard:function(e,t,i){var n=this;e&&t?this._filterIDCard.updateIDCard(t,i).then((function(){n._headerContainer.getElement(".global-header-filtername").hide(),n._headerContainer.getElement(".global-header-idcard").show(),n._filterIDCard.attachResizeSensor()})):(this._headerContainer.getElement(".global-header-filtername").show(),this._headerContainer.getElement(".global-header-idcard").hide())},_createGlobalFilterCommandWUX:function(){var e=this,t=this._cmdsContainer;this._densityBtn=new I({domId:"global-density-filter",touchMode:!0,showLabelFlag:!1,displayStyle:"lite",icon:d.getIconByName(G.getTouchMode()?"view-big-tile":"view-small-tile")}),this._densityBtn.inject(t),this._densityBtn.getContent().setAttribute("ngf_touch_unsensitive",""),this._densityBtn.tooltipInfos=new w({shortHelp:r.get("densityFilterTooltip"),mouseRelativePosition:!0});var i=[{type:"RadioItem",recId:"global-density-comfortable-item2-DDCtx",title:r.get("DisplayDensityComfortableItem"),icon:d.getIconByName("view-big-tile"),action:{this:this,callback:()=>{d.updateTouchMode(!0)}}},{type:"RadioItem",recId:"global-density-compact-item2-DDCtx",title:r.get("DisplayDensityCompactItem"),icon:d.getIconByName("view-small-tile"),action:{this:this,callback:()=>{d.updateTouchMode(!1)}}}];this._densityBtn.addEventListener("buttonclick",(function(e){e.stopPropagation();var t=e.target.getBoundingClientRect();i[0].state=(d.TOUCH_MODE?"selected":"unselected")+"|enabled",i[1].state=(d.TOUCH_MODE?"unselected":"selected")+"|enabled",M.show(i,{position:d.getMenuPosition(t)})}));var n=new I({domId:"global-reset-filter",touchMode:!0,showLabelFlag:!1,displayStyle:"lite",icon:d.getIconByName("reset")});n.inject(t),n.getContent().setAttribute("ngf_touch_unsensitive",""),n.tooltipInfos=new w({shortHelp:r.get("resetFilterTooltip"),mouseRelativePosition:!0}),n.addEventListener("buttonclick",this._onResetFilterCmd.bind(this)),this._hideAttrChildren=new I({domId:"global-hide-attribute-children",touchMode:!0,showLabelFlag:!1,displayStyle:"lite",icon:d.getIconByName("flow-children-eye-off")}),this._hideAttrChildren.setOption("isActive",!0),this._hideAttrChildren.inject(t),this._hideAttrChildren.getContent().setAttribute("ngf_touch_unsensitive",""),this._hideAttrChildren.disabled=!0,this._hideAttrChildren.tooltipInfos=new w({shortHelp:r.get("HideAttributeChildrenItem"),mouseRelativePosition:!0}),this._hideAttrChildren.addEventListener("buttonclick",this._onHideAttributeChildrenCmd.bind(this)),this._showAttrChildren=new I({domId:"global-show-attribute-children",touchMode:!0,showLabelFlag:!1,displayStyle:"lite",icon:d.getIconByName("flow-children-eye")}),this._showAttrChildren.setOption("isActive",!1),this._showAttrChildren.inject(t),this._showAttrChildren.getContent().setAttribute("ngf_touch_unsensitive",""),this._showAttrChildren.disabled=!0,this._showAttrChildren.tooltipInfos=new w({shortHelp:r.get("ShowAttributeChildrenItem"),mouseRelativePosition:!0}),this._showAttrChildren.addEventListener("buttonclick",this._onShowAttributeChildrenCmd.bind(this)),this._showAttrChildren.hide(),this._refineBtn=new I({domId:"global-refine-suggested-values",touchMode:!0,showLabelFlag:!1,displayStyle:"lite",icon:d.getIconByName("list-filter")}),this._refineBtn.inject(t),this._refineBtn.getContent().setAttribute("ngf_touch_unsensitive",""),this._refineBtn.tooltipInfos=new w({shortHelp:r.get("RefreshSynthesisInfosTooltip"),mouseRelativePosition:!0}),this._refineBtn.disabled=!0,this._refineBtn.addEventListener("buttonclick",(function(t){f.setUsageTracker(e._widgetId,"NGF-Commands","refineAttributes"),e._refreshSynthesisInfos(!0,!0),e._refineBtn.disabled=!0})),this._renameFilterBtn=new I({domId:"global-rename-filter",touchMode:!0,showLabelFlag:!1,displayStyle:"lite",icon:d.getIconByName("rename")}),this._renameFilterBtn.inject(t),this._renameFilterBtn.getContent().setAttribute("ngf_touch_unsensitive",""),this._renameFilterBtn.tooltipInfos=new w({shortHelp:r.get("renameFilterTooltip"),mouseRelativePosition:!0}),this._renameFilterBtn.addEventListener("buttonclick",this._renameFilterCmd.bind(this))},_createKeepAttributeChildrenUI:function(){this._showKeepAttrChildren=new I({touchMode:d.TOUCH_MODE,displayStyle:"lite",label:r.get("ShowAttributeChildren"),id:"ShowKeepAttrChildren"}),this._showKeepAttrChildren.tooltipInfos=new w({shortHelp:r.get("ShowAttributeChildrenItem"),mouseRelativePosition:!0}),this._showKeepAttrChildren.inject(this.getElement("#keepAttributeChildrenMsg")),this._showKeepAttrChildren.getContent().addClassName("keepAttributeChildrenShowButton");var e=this;this._showKeepAttrChildren.addEventListener("buttonclick",(function(t){e._onShowAttributeChildrenCmd()}))},_onHideAttributeChildrenCmd:function(){f.setUsageTracker(this._widgetId,"NGF-Commands","hideChildren"),this._keepAttributeChildren=!1,this._updateKeepAttributeChildrenUI(this._keepAttributeChildren)},_onShowAttributeChildrenCmd:function(){this._keepAttributeChildren=!0,this._updateKeepAttributeChildrenUI(this._keepAttributeChildren)},_updateKeepAttributeChildrenUI:function(e){let t=this,i=function(e,i){if(e||i)if(t._isHideOrShowCmdDisabled){t._isHideOrShowCmdDisabled=0;let e=t._hideAttrChildren.getOption("isActive")?t._hideAttrChildren:t._showAttrChildren;e.disabled=!1,e.show()}else e?(t._hideAttrChildren.show(),t._hideAttrChildren.setOption("isActive",!0),t._showAttrChildren.hide(),t._showAttrChildren.setOption("isActive",!1)):(t._hideAttrChildren.hide(),t._hideAttrChildren.setOption("isActive",!1),t._showAttrChildren.show(),t._showAttrChildren.setOption("isActive",!0));else{t._isHideOrShowCmdDisabled=1,(t._hideAttrChildren.getOption("isActive")?t._hideAttrChildren:t._showAttrChildren).disabled=!0}};void 0===e?(this.getElement("#keepAttributeChildrenMsg").hide(),i(!1,!1)):!0===e?(this.getElement("#keepAttributeChildrenMsg").hide(),i(!0,!1)):(this.getElement("#keepAttributeChildrenMsg").show(),i(!1,!0))},_buildFilterUIFromSelectedFilter:function(e,t,i,n){var o=this._keepFilters[e];this._setFilterTitle(o.filterTitle);var s=this._buildFilterViewFromFilterModel(o,t,i,n);this._retrievedTags=s,this._isNewRepairActive&&this._isFilterBroken||(this._buildCVQueryOfSelectedFilter(s),delete this._retrievedTags)},_buildCVQueryOfSelectedFilter:function(e){var t=this;if(this._isFilterBroken||"drop"!==t._dropOption||(t._appliedFilterTitle=t._getFilterTitle(),t._hasAppliedNGF=!0,t._updateActiveCriteriaView(t._getFilterTitle()),e&&this._wgtActiveCriteriaView.updateCriteria(e)),e&&0===g.getCVQueryBuildMode()){var i=this._buildCVQuerySync();this._appliedFilterTitle=this._filterTitle,this._applyFilter({CVQuery:i,isEmpty:!1})}else{var n=t.options.droppedInfos;n&&t.buildCVQuery().then((function(i){var o=JSON.parse(i);o&&(o.filterTitle=t._getFilterTitle(),e&&(o.tagsInMdl=e,e.localfilters||(e.localfilters={}))),t._applyDroppedFilters(n.retrieveFilters,n.filterId,o),delete t.options.droppedInfos}))}},_buildFilterViewFromFilterModel:function(e,t,n,o){var s=this;this._scForSaveFilter||s._onSetSecurityContext({NGFUXId:s._NGFUXId,securityContext:s._securityContext});var a,l=f.getFilterUIComponents(e),c=l.length;this._combinationCombo&&o&&1===o.addExisting?a=this._combinationCombo.value:(a=l[0].toFeedUI.combinationOfSpecification||"union",a+="minus"===a?"-"+l[0].toFeedUI.minusIndex:"");var u=["-"].concat(l[0].toFeedUI.rootIds);t[d.FILTER_ANY_OBJECT]=this._attrFromSynthesis;for(var h=[],p={},_=1;_<c;_++){var m=this.groupView.filterViewFromModel(u[_],l[_],t,n);if(h=h.concat(m.attrNotFound),m.retrievedTags&&(p=m.retrievedTags,this._tagsInMdl=this._tagsInMdl?f._mergeTagData(this._tagsInMdl,m.retrievedTags):m.retrievedTags),_!==c-1){var g=this._listGroupView.length-1;this._listGroupView[g].model.set("state","read"),this._addGroupView()}}p&&Object.keys(p).length&&"dropOnFilter"===this._dropOption&&d.displayNotification({level:"info",message:r.get("filterWithNonAppliedTag")}),this._updateCombinationCombo(),this._updateAddSpecificationButton(),this._isFilterInContext?(this._isFilterFromModel=this._isFilterFromModel?1:0,this._isFilterInContext=0,this._updateApplySaveSaveAsState({status:"ValidOK"})):(this._isFilterFromModel=1,this._setGlobalButtonsStatus("SaveAsOK"));let v=this.collection.getActiveGroupCollection();this._setApplySelectable(!!v.length),S.unmask(s.container);let b=[];if(this._listGroupView.forEach((e=>{let t=e.getProdConfOfConfigFilter();t&&b.push(t)})),b.length&&(b=[...new Set(b)],d.executeFetch(b,[],[],s._defaultServiceId).then((function(e){if(b=[],e&&e.infos.nresults&&e.results.forEach((e=>{let t=e.attributes.find((e=>"resourceid"===e.name));t&&b.push(t.value)})),b.length){let e=[];s._listGroupView.forEach(((t,i)=>{if(!t.checkConfigFilter(b)){let t=s.collection.at(i)?s.collection.at(i).getFilterSpecificationName():"Specification #"+i;e.push(t)}})),e.length&&d.displayNotification({level:"warning",message:r.get("InvalidProdConfFilter")+" "+e.join(", ").toString()})}}))),h.length&&(h=[...new Set(h)],d.displayAttrNotFoundNotif(h)),s._isFilterBroken){d.openFilterPanel(),S.mask(s.container);var y=new i.Element("div",{html:"<p>"+r.get("BrokenFilterWarning")+"</p>"}),F=function(){f.setUsageTracker(s.widgetId,"NGF-RepairFilter","solve-repair");var e=s._filterRepairView.createJSONForRepairWebservice(),t=d.getGlobalEditContainer(s._UXId);if(null!==t){var i={url:d.getPlatformServiceUrl(),ctx:s._defaultSC};s._filterRepairView.logWebServiceOptions(i),s._filterRepairView.logFilterInfos({title:s._getFilterTitle(),combinationSpec:s._combinationCombo&&s._combinationCombo.value}),s._filterRepairView.fetchRepairedPathsFromWebService(e).then((function(e){"RepairFilterFetchData_FAILURE"!==e&&(t.empty(),s._filterRepairView.render().getContent().inject(t));S.unmask(s.container)}))}s._onRedraw({filterId:s.options.UXId}),s._onACCriteria(s._getFilterTitle()),s.droppedFilter&&d.openFilterPanel(s.options.UXId)},A=function(){f.setUsageTracker(s.widgetId,"NGF-RepairFilter","stop-repair"),s._onRedraw({filterId:s.options.UXId}),s._cancelRepairFilter()},E=new C({touchMode:!0,modalFlag:!0,title:r.get("RepairFilterTitle"),content:y,immersiveFrame:this._getImmersiveFrame(),domId:"NGF_RepairPanel",buttons:{Cancel:new I({class:"repair-cancel",label:r.get("CancelSolveUI"),emphasize:"secondary",onClick:function(e){E.close(),s._deactivateImmersiveFrame(),A.call()}}),Ok:new I({class:"repair-solve",label:r.get("SolveButton"),emphasize:"primary",onClick:function(e){E.close(),F.call()}})}});this._addMenuClass(s._currentMenuClass),E.addEventListener("close",(function(e){S.unmask(s.container),s._deactivateImmersiveFrame(),s._removeMenuClass(s._currentMenuClass)}))}if(this._combinationCombo){if(this._combinationCombo.currentValue===a){let e=this._combinationCombo.selectedIndex;this._combinationCombo.selectedIndex=2>e?0===e?1:0:e}this._combinationCombo.currentValue=a}if(1===this.collection.getGroupCollectionCount()){var N=l[0].toFeedUI.keepChildren;void 0!==N&&this._keepAttributeChildren!==N&&(this._keepAttributeChildren=N,this._updateKeepAttributeChildrenUI(this._keepAttributeChildren))}if(this._displayFilterIDCard(!0,this._activeFilter),this._currentFilterSpecification||(this._currentFilterSpecification=JSON.stringify(s.getFilterSpecification(s._rootID,s._keepAttributeChildren))),this._unsavedChangesMsgDisplayed=!1,this._updateAttributeCommandsState(),this._isFilterFromModel){if(!this._areFilterTitleAndDescriptionSafe()){let e=[r.get("InvalidTitleOrDescription")];this._displayCreateFilterFailed(e)}}return p&&Object.keys(p).length?p:void 0},_updateAttributeCommandsState:function(e){for(var t=this._listGroupView.length,i=0;i<t;i++){var n=this._listGroupView[i].getCriteriaViewsByType("attribute").concat(this._listGroupView[i].getCriteriaViewsByType("Sequence"));if(n.length){var o=1===n.length&&n[0].isViewEdited()?0:1;this._onAttributeCommandsState({enable:o});break}}},_cancelSearch:function(e){},_initFiltersToKeep:function(e,t){var o=this,s=new n((function(n,s){var r={},a=[],l=function(e){e.forEach((function(e){(e=f._getFilterSpecification(e)?i.clone(f._getFilterSpecification(e).data):e).filterName=e&&e.filterName?e.filterName:o._defaultFilterName;var t=e.filterName;r[t]||(r[t]={}),r[t].rootPhysicalId=e.rootPhysicalId||e.rootExtPosPhysicalId||e.rootID,r[t].filterUIComponents=e.filterUIComponents||e.filterMdl,r[t].filterDescription=e.filterDescription,r[t].filterTitle=e.filterTitle?e.filterTitle:o._defaultFilterName,r[t].filterPhysicalId=e.filterPhysicalId||e.filterId,r[t].pathDB={added:{physical:e.addedNodesList_PhysicalID?JSON.parse(e.addedNodesList_PhysicalID):[],logical:e.addedNodesList_LogicalID?JSON.parse(e.addedNodesList_LogicalID):[]},excluded:{physical:e.excludedNodesList_PhysicalID?JSON.parse(e.excludedNodesList_PhysicalID):[],logical:e.excludedNodesList_LogicalID?JSON.parse(e.excludedNodesList_LogicalID):[]},proximity:{physical:e.proximityNodesList_PhysicalID?JSON.parse(e.proximityNodesList_PhysicalID):[],logical:e.proximityNodesList_LogicalID?JSON.parse(e.proximityNodesList_LogicalID):[]}},a.push(t),0===g.getCVQueryBuildMode()&&O.buildCVQueryFromModel(e),r[t].filterCVQuery=e.filterCVQuery}))},d=function(e,t){return new Promise((function(i){t?o._checkAndRepairFilterIfNeeded(e).then((function(){i()})):i()}))};if(Array.isArray(e)&&"object"==typeof e[0]){l(e);let i=a.length-1;d(r[a[i]],t).then((()=>{n({filters:r,names:a})}))}else g.getPlatformServices(f.getTenant()).then((function(){S.mask(o.container),f.getAllDataFromFilterIds("object"==typeof e?e.filterId:e,f.getTenant(),o._defaultSC).then((function(e){if(e&&e.success){l(e.success);let i=a.length-1;d(r[a[i]],t).then((()=>{n({filters:r,names:a})}))}else S.unmask(o.container),s({filters:r,names:a,failure:e?e.failure:[]})}))}))}));return s},_buildFromSelectedFilterId:function(e,t){var i=this,n=t&&!t.resetFilter?0:1;n&&this._resetFilter({initFilterUI:1});let o=e.resourceid_value,s=e["ds6w:identifier_value"];if(void 0===o){var a=e;f.getFilterDataFromFilterId(a,f.getTenant(),this._defaultSC).then((function(e){if(e.success){o=a,s=e.success[0].filterName;var l=e.success[0].rootPhysicalId;i._rootID!==l?d.displayNotification({level:"error",message:r.get("RecentFilterKO")}):i._buildFromSelectedFilterData(o,s,t,n)}else d.displayNotification({level:"warning",message:r.get("invalidFilterId")})}),(function(e){}))}else i._buildFromSelectedFilterData(o,s,t,n)},_buildFromSelectedFilterData:function(e,t,n,o){var s=this;this._keepFilters={},this._keepFilterNames=[],this._initFiltersToKeep(e,this.retrieveFilter).then((function(a){s._keepFilters=a.filters,s._keepFilterNames=a.names,t!==a.names[0]&&(s._keepFilters[t]=a.filters[a.names[0]],s._keepFilterNames=[t]);var l=s._keepFilters[t];s._filterDescription=l.filterDescription;var c=function(a){d.checkAndGetListOfAttributesFromSelectedFilter(a).then((function(l){var c;0===g.getCVQueryBuildMode()&&(c=d.upgradeAndCompleteQuery(JSON.parse(a.filterCVQuery))),c=JSON.parse(a.filterCVQuery),a.filterCVQuery=c;var u=s._listGroupView.length,h=a.filterUIComponents.length-1,p=a.filterUIComponents;p&&1>=p&&!p[1].filterSpecificationName&&h--;var _=u+h-(n?0:1);if(d.MAX_FILTER_SPECIFICATION>=_){var m=p[0].toFeedUI.rootIds||[];if(m.length&&s._linkedRoots){var f=[];s._linkedRoots.forEach((e=>{-1===m.findIndex((t=>e.id===t))&&f.push(e.alias)})),f.length&&d.displayNotification({level:"warning",message:r.get("RestoreFilterWithAnotherLinkedRoot")+f.toString()})}a.filterTitle=n&&n.addExisting?s._getFilterTitle():a.filterTitle;let c=n?{...n}:{};c=i.merge(c,{resetFilter:o,filterTitle:a.filterTitle,nbSpecGlobal:_}),o?-1===s._synthesisState?(s._buildFromSelectedFilter(e,t,l,s._synthesisInfos,c),s._removeSynthesisAlert()):d.getExpandSynthesisInfos(s._getExpandContext(),s._appQueryParam).then((function(i){s._synthesisInfos=i,s._buildFromSelectedFilter(e,t,l,s._synthesisInfos,c),s._removeSynthesisAlert()}),(function(i){s._buildFromSelectedFilter(e,t,l,s._synthesisInfos,c),s._displaySynthesisAlert()})):s._buildFromSelectedFilter(e,t,l,s._synthesisInfos,c)}else{if(S.unmask(s.container),!o){var v=n.editedModel;v&&v.set("state","edit")}var b=UWA.String.format(r.get("maxFilterSpecOnRetrieveFilter"),d.MAX_FILTER_SPECIFICATION);d.displayNotification({level:"warning",message:b})}}))};-1===s._synthesisState?s._computeSynthesisFromModel(l).then((e=>{s._synthesisInfos=e,d.computeAttributesFromSynthesis(s._synthesisInfos).then((function(e){s._attrFromSynthesis=e,c(l)}),(function(e){s._attrFromSynthesis=e,c(l)}))})):c(l)}),(function(e){s._filterState="New",s._displayNotifOnActionFilterFailed("FilterCanNotBeRestored",e)}))},_displayNotifOnActionFilterFailed:function(e,t){var n=[];t&&t.failure&&t.failure.forEach((e=>{e.filterTitle&&n.push(e.filterTitle)})),d.displayNotification({level:"error",message:i.String.format(r.get(e),n.toString())})},_displayMaxFilterSpecDefinedNotif:function(){var e=UWA.String.format(r.get("maxFilterSpecDefined"),d.MAX_FILTER_SPECIFICATION);d.displayNotification({level:"info",message:e})},_buildFromSelectedFilter:function(e,t,i,n,o){var s=this;let r=o.resetFilter,a=o.nbSpecGlobal,l=o.filterTitle;r||(s._addGroupView(),s._updateCombinationCombo()),s.groupView.setSynthesisInfos({synthesis:n,state:s._synthesisState});var c=this._activeFilter;s._activeFilter=r?e:s._activeFilter,s._buildFilterUIFromSelectedFilter(t,i,d.getTypesOfSynthesis(n),o),r?(s._activeFilter=e,s._updateFilterTitle(l)):s._activeFilter=c,d.MAX_FILTER_SPECIFICATION===a&&s._displayMaxFilterSpecDefinedNotif()},in_apps_search:function(e){var t=this;this._internals={registrationOpts:function(){return{title:r.get("SearchFilters"),mode:"furtive",default_with_precond:!0,show_precond:!1,widget_id:t._widgetId,app_socket_id:"NGFilter_"+t._widgetId,idcard_activated:!1,tenant:f.getTenant(),multiSel:!!f.isDebugActive("extendedCmds")&&(e.multiSel||!0),recent_search:{types:["ENOStrRefinementSpecification"]},UXOptions:{dnD:!1,localActions:!1,searchRecentContent:!0,globalToolbarActions:{saveAsFavorite:!1,export:!1,print:!1}}}}};var n=i.extend(this._internals.registrationOpts(),e),s=new o.Socket(n.app_socket_id,{dispacthRetryInterval:0});!0===e.debug_mode&&s.setDebugMode(!0),e.parent_window?s.subscribeServer("SearchComServer",window):s.subscribeServer("SearchComServer"),s.dispatchEvent("RegisterContext",n),e.context_name&&(n.context_title=e.context_name),n.default_search_criteria=e.fts_value,s.dispatchEvent("InContextSearch",n),s.addListener("Selected_Objects_search",(function(i){if(i.length>1)if(f.isDebugActive("extendedCmds")&&e.multiSel){if("function"==typeof e.callback){var n=[];i.forEach((e=>{n.push(e.resourceid_value)})),e.callback.call(t,n)}}else console.log("No MultiSel allowed");else"function"==typeof e.callback&&e.callback.call(t,i[0]);s.removeListener("onCloseTransient"),s.disconnect()})),s.addListener("onCloseTransient",(function(t){"function"==typeof e.cancel&&e.cancel(null),s.dispatchEvent("UnregisterContext",n.widget_id),s.removeListener("onCloseTransient"),s.disconnect()}))},_onEditGroup:function(e){if(this.groupView.cid!==e.groupId)for(var t=this._listGroupView.length,i=0;i<t;i++)if(this._listGroupView[i].cid===e.groupId){this.groupView.model.set("state","read"),this.groupView=this._listGroupView[i];break}},_isFilterValid:function(){for(var e=!0,t=this._listGroupView?this._listGroupView.length:0,i=0;i<t&&e;i++){var n=this._listGroupView[i];null!==n&&n.isViewEdited()&&"function"==typeof n.areCriteriaValid&&(e=n.areCriteriaValid())}return e},validateEditedCriterion:function(e){if(0===d.isAsynchronousValidation())return this.validateEditedCriterionSync(this,e);var t=this._listGroupView.length,i=!t;if(t){i=!0;for(var o=[],s=0;s<t&&i;s++){var r=this._listGroupView[s];r&&r.isViewEdited()&&o.push(r.areCriteriaValidate(e))}return n.all(o).then((function(t){i=!0;for(var n=t.length,o=0;o<n&&i;o++)i=t[o];return i&&e&&"function"==typeof e.callback&&e.callback(e),i}))}return new n((function(e){e(i)}))},_onAddNewFilterSpecification:function(e){var t=this;0===d.isAsynchronousValidation()?t._onAddNewFilterSpecificationSync(t):this.validateEditedCriterion().then((function(n){if(n){if(t.groupView.model.set("state","read"),t._addGroupView(e),e){var o=t.collection.keepComponentsToFeedUI(t._rootID,t._keepAttributeChildren,void 0,{keepEmpty:!0}),s=t._listGroupViewId.indexOf(e.specId),r=[];r.push(i.clone(o[0])),r.push(i.clone(o[s+1])),d.checkAndGetListOfAttributesFromSelectedFilter({filterUIComponents:r}).then((function(i){var n=d.getTypesOfSynthesis(t._synthesisInfos);i[d.FILTER_ANY_OBJECT]=t._attrFromSynthesis,t.groupView.filterViewFromModel(e.rootSpec,r[1],i,n),t.groupView.updateDuplicatedView(e),!1===t._checkDisplayKeepChildren()?t._updateKeepAttributeChildrenUI():t._updateKeepAttributeChildrenUI(t._keepAttributeChildren)}))}t._updateAddSpecificationButton(t._combinationCombo.value),t._updateCombinationCombo(),d.MAX_FILTER_SPECIFICATION===t._listGroupView.length&&(t._updateAddSpecificationButton(),t._displayMaxFilterSpecDefinedNotif())}}))},_onAddExistingFilterSpecificationWUX:function(e){var t=e.context.relatedTo,i=-1;d.FILTER_RELATED_TO_ROOT===t?i=1:d.FILTER_RELATED_TO_ALL_REVISIONS===t?i=2:d.FILTER_RELATED_TO_ANY_ROOT===t&&(i=3),f.setUsageTracker(this._widgetId,"NGF-Multi-Specification",{label:"existing",value:i}),d.setReferenceTime(Date.now()),this._isFilterInContext=1,this._onAddExistingFilterSpecification(t)},_onAddExistingFilterSpecification:function(e){var t=this;if(0===d.isAsynchronousValidation())t._onAddExistingFilterSpecificationSync(t);else{var i=t._listGroupView.find((function(e){return"edit"===e.model.get("state")})),n=i?i.model:void 0;n&&this.validateEditedCriterion().then((function(i){if(i){var o={resetFilter:!1,editedModel:n,addExisting:1};t.retrieveFiltersRelatedTo({type:e,rootIDs:[t._rootID]},o)}}))}},_createCombination:function(){var e=i.createElement("div",{class:"filter-groups-Combination"});return e.inject(this.getElement("#filter-groups"),"before"),this._followingLabel=this._createCombinationLabel(),this._combinationCombo=this._createCombinationSpecificationUI(),this._combinationCombo.inject(e),this._followingLabel.inject(e),e},_createCombinationLabel:function(){return i.createElement("label",{class:"innerfiltertypecombo",text:r.get("FollowingCombination"),id:"global-combination-specification-label"})},_createCombinationSpecificationUI:function(){var e=this;let t=[{labelItem:r.get("AllCombination"),valueItem:"intersection"},{labelItem:r.get("AnyCombination"),valueItem:"union"},{labelItem:r.get("MinusCombination"),valueItem:"minus-0"},{labelItem:r.get("MinusCombination"),valueItem:"minus-1"}],i=new x({shouldBeSelected:function(e){return e.options.grid.selectable}});t.forEach(((e,t)=>{var n=new T({label:e.labelItem,grid:{valueItem:e.valueItem,selectable:!0},disabled:!1});i.addChild(n)}));let n=new A({touchMode:d.TOUCH_MODE,elementsTree:i,selectedIndex:1,enableSearchFlag:!1,domId:"combination-specification"});return n.addEventListener("change",(function(t){let i=t.dsModel.currentValue;if(-1===i.indexOf("minus"))e.model.set("combinationOfSpecification",i),e.model.unset("minusIndex"),e._followingLabel.show();else{let t=i.split("-");e.model.set("combinationOfSpecification",t[0]),e.model.set("minusIndex",t[1]),e._followingLabel.hide()}e._updateAddSpecificationButton(i)})),n},_createNewSpecificationBtn:function(e){var t=new I({domId:"addNewSpec",touchMode:d.TOUCH_MODE,displayStyle:"normal",label:r.get("addNewSpecification"),icon:"plus"});t.inject(e),t.tooltipInfos=new w({shortHelp:r.get("addNewSpecificationTooltip"),mouseRelativePosition:!0});var i=this;return t.addEventListener("buttonclick",(function(e){f.setUsageTracker(i._widgetId,"NGF-Multi-Specification","new"),d.setReferenceTime(Date.now()),i._onAddNewFilterSpecification()})),t},_createExistingSpecificationBtnWUX:function(e){var t=new I({domId:"addExistingSpec",touchMode:d.TOUCH_MODE,displayStyle:"normal",label:r.get("addExistingSpecification"),icon:"plus"});t.inject(e),t.tooltipInfos=new w({shortHelp:r.get("addExistingSpecificationTooltip"),mouseRelativePosition:!0}),this._ExistingContextualMenu=[{type:"PushItem",title:i.String.format(r.get("SearchOnRoot"),this._rootAlias),tooltip:i.String.format(r.get("SearchOnRootTooltip"),this._rootAlias),icon:N.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterOpenFilter.png"),action:{this:this,callback:this._onAddExistingFilterSpecificationWUX,context:{relatedTo:d.FILTER_RELATED_TO_ROOT}}},{type:"PushItem",title:i.String.format(r.get("SearchOnAllRevisions"),this._rootAlias),tooltip:i.String.format(r.get("SearchOnAllRevisionsTooltip"),this._rootAlias),icon:N.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterCopyFilter.png"),state:"3DSpace"===this._pfServiceId?"enabled":"disabled",action:{this:this,callback:this._onAddExistingFilterSpecificationWUX,context:{relatedTo:d.FILTER_RELATED_TO_ALL_REVISIONS}}},{type:"PushItem",title:r.get("CopyFromAnyFilters"),tooltip:r.get("SearchAnyTooltip"),icon:N.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterCopyFilter.png"),action:{this:this,callback:this._onAddExistingFilterSpecificationWUX,context:{relatedTo:d.FILTER_RELATED_TO_ANY_ROOT}}}];var n=this;return t.addEventListener("buttonclick",(function(e){e.stopPropagation();var t=e.target.getBoundingClientRect();M.show(n._ExistingContextualMenu,{position:d.getMenuPosition(t)})})),t},_updateCombinationCombo:function(){if(this._combinationCombo){let t=this._combinationCombo.elementsTree.getRoots(),i=this.collection.getActiveGroupCollection();if(2===i.length){var e=r.get("MinusCombination")+" ";t[2].setLabel(e+i[0].getFilterSpecificationLabel()),t[3].setLabel(e+i[1].getFilterSpecificationLabel()),t[2].show(),t[3].show()}else t[2].hide(),t[3].hide();this._divCombination&&1<i.length?this._divCombination.show():this._divCombination.hide()}},_onAttributeCommandsState:function(e){var t=!e||!e.enable;this._refineBtn.disabled=t,this._hideAttrChildren.disabled=t,this._showAttrChildren.disabled=t},_updateAddSpecificationButton:function(e){this._addNewSpecBtn&&this._addExistingSpecBtn&&(this._isThereCriteriaDefined()?this._divSpecificationCmd.show():this._divSpecificationCmd.hide(),2===this._listGroupView.length?e&&-1!==e.indexOf("minus")?(this._addNewSpecBtn.disabled=!0,this._addExistingSpecBtn.disabled=!0):(this._addNewSpecBtn.disabled=!1,this._addExistingSpecBtn.disabled=!1):d.MAX_FILTER_SPECIFICATION===this._listGroupView.length?(this._addNewSpecBtn.disabled=!0,this._addExistingSpecBtn.disabled=!0,this._duplicateSpecDisabled||(this._listGroupView.forEach((e=>{e.setEnableDuplication(!1)})),this._duplicateSpecDisabled=1)):(this._addNewSpecBtn.disabled=!1,this._addExistingSpecBtn.disabled=!1,this._duplicateSpecDisabled&&(this._duplicateSpecDisabled=0,this._listGroupView.forEach((e=>{e.setEnableDuplication(!0)})))))},setTagsDataOnNGF:function(e){if(e&&this._listGroupView){k&&this._hasAppliedNGF||("createFromTag"===e.dropOption?this._tagsOnly=!0:"drop"===e.dropOption?this._tagsOnly=!1:"dropOnFilter"!==e.dropOption?this._tagsOnly=!0:console.log("FilterViewManager.get3DXView, unknown case of dropOption"+options.dropOption)),this._tagsInMdl=i.clone(e.tagData);for(var t=0;t<this._listGroupView.length;t++)this._listGroupView[t].createTagNGF(e.tagData);if("createFromTag"===e.dropOption)if(this._hasAppliedNGF||this._hasTag()){var n=this;if(0===g.getCVQueryBuildMode()){var o=this._buildCVQuerySync();this._applyFilter({CVQuery:o,isEmpty:!1})}else this.buildCVQuery().then((function(e){n._applyFilter({CVQuery:e,isEmpty:!1,tagsInMdl:n._tagsInMdl})}))}else this._applyFilter({CVQuery:f.buildEmptyFilter(this._rootID),isEmpty:!0,tagsInMdl:this._tagsInMdl})}else console.log("RCIII GlobalFilterView : should have group view in existing GlobalFilterView")},updateDataOnNGF:function(e){var t={};t.rootID=e.rootID,t.rootAlias=e.rootAlias,this._onSelectObject(t)},_onSpecificationStateChange:function(){!1===this._checkDisplayKeepChildren()?this._updateKeepAttributeChildrenUI():this._updateKeepAttributeChildrenUI(this._keepAttributeChildren),this._updateCombinationCombo(),this._checkActiveCriteria()},_checkActiveCriteria:function(){let e=!1,t=this._listGroupView.length;for(let i=0;i<t;i++){let t=this._listGroupView[i];if(d.isModelActivated(t.model)&&t.isThereActiveCriteria()){e=!0;break}}this._setApplySelectable(!!e)},_setGlobalButtonsStatus:function(e){this._filterState=e,this.groupView&&this.groupView.setFilterState(e),this._renameFilterBtn.disabled=!!this._isFilterFromModel;let t=!(!g.isShattered()&&!g.isSupplemental());switch(e){case"New":this._setApplySelectable(!1),this._setSaveSelectable(!1),this._setSaveAsSelectable(!1);break;case"ValidOK":this._setApplySelectable(!0),this._setSaveSelectable(!t),this._setSaveAsSelectable(!1);break;case"SaveAsOK":this._setApplySelectable(!0),this._setSaveSelectable(!1),this._setSaveAsSelectable(!t);break;case"SaveOK":this._setApplySelectable(!0),this._setSaveSelectable(!t),this._setSaveAsSelectable(!t)}},_setApplySelectable:function(e){this._applyFilterButton.disabled=0==e},_setSaveSelectable:function(e){this._saveFilterButton.disabled=0==e},_setSaveAsSelectable:function(e){this._saveAsFilterButton.disabled=0==e},_updateApplySaveSaveAsState:function(e){if("SaveOK"!==this._filterState){let t=e.status||this._filterState;t="ValidOK"===t&&"SaveAsOK"===this._filterState?"SaveOK":t,this._filterState=t,this._setGlobalButtonsStatus(this._filterState),this.groupView&&this.groupView.setFilterState(this._filterState)}},_getExpandContext:function(){return{rootID:this._rootID,securityContext:this._defaultSC,tenant:f.getTenant(),widgetId:this._widgetId,pfServiceId:this._pfServiceId,rootTitle:d.getRootTitle(this._rootAlias,this._rootRevision)}},_onChangeDensity:function(e){let t=e.touchMode;if(f.setUsageTracker(this._widgetId,"NGF-Commands",{label:"density",value:1}),this._isFilterValid()&&(f.setUsageTracker(this._widgetId,"NGF-Density",t?"comfortable":"compact"),t?this.getContent().removeClassName("compact"):this.getContent().addClassName("compact"),this.collection)){let e=d.getRootFilterContainer(this._UXId),t=G.getTouchMode(),o=e.getElements(".filter-Grid .wux-controls-abstract:not([ngf_touch_unsensitive])");o.forEach((e=>{e.dsModel&&(e.dsModel.touchMode=t)})),o=e.getElements(".filter-Grid .filter-groups-cmd .wux-icon-path");var i=t?"22":"32",n="22"===i?"32":"22";o.forEach((e=>{let t=e.getAttribute("src");t=t.replace("/assets/icons/"+i+"/","/assets/icons/"+n+"/"),e.setAttribute("src",t)}))}this._densityBtn&&(this._densityBtn.icon=d.getIconByName(t?"view-big-tile":"view-small-tile"))},_getConfigPCIds:function(e,t){var i=this;return new Promise((function(n){if(t){let t=[],o=e.filterUIComponents,s=o.length;for(let e=1;e<s;e++){(o[e].toFeedUI||[]).forEach((e=>{if("config"===e.criteriaType){let i=e.config_filter_id;i&&t.push(i.physical_id)}}))}t.length?d.executeFetch(t,[],[],i._defaultServiceId).then((function(e){t=[],e&&e.infos.nresults&&(e.results.forEach((e=>{let i=e.attributes.find((e=>"resourceid"===e.name));i&&t.push(i.value)})),t=[...new Set(t)]),n(t)})):n(void 0)}else n(void 0)}))},_checkAndRepairFilterIfNeeded:function(e){var t=this;return t._isFilterBroken=!1,new n((function(i){var n;if(e)n={filterUIComponents:e.filterUIComponents,pathDB:e.pathDB};else if(t._keepFilterNames&&t._keepFilterNames.length){var o=t._keepFilterNames[0];n={filterUIComponents:t._keepFilters[o].filterUIComponents,pathDB:t._keepFilters[o].pathDB}}else n={filterUIComponents:t.options.filterUIComponents};t._filterRepairView.checkForBrokenPathsInFilter(n).then((function(e){if(Array.isArray(e.newPaths))if("3DSpace"!==t._pfServiceId){var o=r.get("RepairFilterNotAvailableOutOf3DSpace");console.log("==> _checkAndRepairFilterIfNeeded() /  "+o),i()}else e.specificationToRepair.forEach((t=>{(n.filterUIComponents[t+1].toFeedUI||[]).forEach((i=>{var n=i.criteriaType;("context"===n||"volume"===n)&&(i=e.newPaths[t])}))})),t._isFilterBroken=!0,t._filterRepairView.logPathsInFiltersInfo(e.newPaths),i(n);else"PathsOK"!==e&&"NoContextFilter"!==e||i()}))}))},_updateModelFromRepairPanel:function(e){for(var t=this,i=!1,n=0;n<this._listGroupView.length;n++){this._listGroupView[n].updateModelsFromRepair(e).forEach((e=>{e.modelUpdated&&(i=i||e.modelUpdated,t._listGroupView[n].buildViewsFromRepairModel(e.attributes))}))}i&&t._setGlobalButtonsStatus("SaveOK")},_getBuildCVQueryOptions:function(){return{queryFormat:this._queryFormat,excludeRoot:f.isRootExcludedFromSynthesis()?1:0,partialPath:this._getExpandIntent(this._NGFUXId)}},buildCVQuery:function(){var e=this;return new n((function(t,i){var n=e._getBuildCVQueryOptions();e.collection.buildCVQuery(e._defaultSC,e._rootID,e._keepAttributeChildren.toString(),e._tagsOnly,n).then((function(e){t(e)}),(function(e){}))}))},buildCVQueryFromFilterSpec:function(e){var t=this;return new n((function(i,n){var o=t._getBuildCVQueryOptions();t.collection.buildCVQueryFromFilterSpec(t._defaultSC,t._rootID,t._keepAttributeChildren.toString(),e,o).then((function(e){i(e)}),(function(e){}))}))},_buildCVQuerySync:function(e){return this.collection._buildCVQuerySync(this._rootID,this._keepAttributeChildren.toString(),e)},_addMenuClass:function(e){if(e){var t=window.document.body;t.addClassName(e);var i=t.querySelector(".column.left");i&&i.addClassName(e)}},_removeMenuClass:function(e){if(e){var t=window.document.body;t.removeClassName(e);var i=t.querySelector(".column.left");i&&i.removeClassName(e)}},addNewCriterion:function(e){!this._cmdsContainer.visibleFlag&&this._cmdsContainer.show(),this.groupView._addNewCriterion(e)},retrieveFiltersRelatedTo:function(e,t){this.retrieveFilter=!0,this.droppedFilter=!1;var i=e.type;if("3DSpace"!==this._pfServiceId&&(d.FILTER_RELATED_TO_ROOT===i||d.FILTER_RELATED_TO_ANY_ROOT===i)){var n=r.get("only3DSpaceResults");console.log("==> retrieveFiltersRelatedTo() /  "+n)}var o=this;g.getPlatformServices(f.getTenant()).then((function(){d.FILTER_RELATED_TO_ROOT===i?o._retrieveFiltersRelatedToRoots(e.rootIDs,t):d.FILTER_RELATED_TO_ALL_REVISIONS===i?(o._isFilterInContext=1,o._retrieveFiltersRelatedToAllRevisions(e.rootIDs,t)):d.FILTER_RELATED_TO_ANY_ROOT===i&&(o._isFilterInContext=1,o._retrieveFiltersRelatedToQuery(e.query,t))}))},_retrieveFiltersRelatedToRoots:function(e,t,i){var n=this,o=(Date.now(),e||[this._rootID]);g.internalFilterSearchPrecondition({filterType:"ENOStrRefinementSpecification",rootId:o,param:i}).then((e=>{""===e?d.displayNotification({level:"info",message:r.get("NoRevisonFound")}):n.in_apps_search({precond:e,title:r.get("SearchFilters"),callback:function(e){n.groupView.model.set("state","read"),n._dropOption="dropOnFilter",d.setReferenceTime(Date.now()),n._buildFromSelectedFilterId.call(n,e,t),n._onDisplayGlobalFilterView(),!this._isLeftPanelMaximized&&d.openFilterPanel("NGF_Search_"+Date.now())},cancel:function(){n._cancelSearch.call(n,n.options),!this._isLeftPanelMaximized&&d.openFilterPanel("NGF_Search_"+Date.now())}})}))},_retrieveFiltersRelatedToAllRevisions:function(e,t){return this._retrieveFiltersRelatedToRoots(e,t,"allrevs")},_retrieveFiltersRelatedToQuery:function(e,t){var i=this;(t=t||{}).displayNotif=1,t.resetFilter=void 0===t.resetFilter||t.resetFilter,this.in_apps_search({precond:e||"[ds6w:type]:ENOStrRefinementSpecification",title:r.get("SearchFilters"),callback:function(e){d.setReferenceTime(Date.now()),f.getAllDataFromFilterIds(e.resourceid_value,f.getTenant(),i._defaultSC).then((function(e){if(e&&e.success){var n=e.success[0];d.checkAndGetListOfAttributesFromSelectedFilter(n).then((function(e){i._buildFilterUIFromFilterRelatedToQuery(n,e,i._rootID,t)}))}else i._displayNotifOnActionFilterFailed("FilterCanNotBeRestored",e)})),!this._isLeftPanelMaximized&&d.openFilterPanel("NGF_Search_"+Date.now())},cancel:function(){i._cancelSearch.call(i,i.options),!this._isLeftPanelMaximized&&d.openFilterPanel("NGF_Search_"+Date.now())}})},buildFilterUIFromFilterRelatedToQuery:function(e,t,i,n){this.groupView&&this.groupView.isThereCriteria()&&(this._onACCriteria(this._getFilterTitle()),this._onResetFilter());var o=this;return new Promise((function(s){o._buildFilterUIFromFilterRelatedToQuery(e,t,i,n).then((function(e){s(e)}))}))},_buildFilterUIFromFilterRelatedToQuery:function(e,t,n,o){var s=this;return new Promise((function(n){var a=s._listGroupView.length,l=e.filterUIComponents.length-1,c=e.filterUIComponents;c&&1>=c&&!c[1].filterSpecificationName&&l--;var u=a+l-(o?0:1),h=o&&!o.resetFilter?0:1;if(d.MAX_FILTER_SPECIFICATION>=u)0===h&&(s.groupView&&s.groupView.model.set("state","read"),s._addGroupView(),s._updateCombinationCombo()),d.checkCompatibiltyFilterRules(s._defaultSC,s._rootID,e,o?o.displayNotif:1,s._pfServiceId).then((function(e){s._dropOption="dropOnFilter";var r=function(e,r){let a=s._isFilterInContext;var l=d.getTypesOfSynthesis(r||s._synthesisInfos);s._buildFilterViewFromFilterModel(e.filterSpec,t,l,o),a&&s._updateApplySaveSaveAsState({status:"ValidOK"}),s._onDisplayGlobalFilterView(),d.MAX_FILTER_SPECIFICATION===u&&s._displayMaxFilterSpecDefinedNotif(),n(i.merge({rootID:s._rootID,rootAlias:s._rootAlias},e.result))};-1===s._synthesisState?s._computeSynthesisFromModel(e.filterSpec).then((i=>{s._synthesisInfos=i,s.groupView.setSynthesisInfos({synthesis:s._synthesisInfos,state:s._synthesisState}),d.computeAttributesFromSynthesis(i).then((function(n){s._attrFromSynthesis=n,t[d.FILTER_ANY_OBJECT]=s._attrFromSynthesis,r(e,i)}))})):d.getExpandSynthesisInfos(s._getExpandContext(),s._appQueryParam).then((function(t){r(e,t)}))}),(function(){s._goToHomePage()}));else{if(S.unmask(s.container),0===h){var p=o.editedModel;p&&p.set("state","edit")}var _=UWA.String.format(r.get("maxFilterSpecOnRetrieveFilter"),d.MAX_FILTER_SPECIFICATION);d.displayNotification({level:"warning",message:_})}}))},_goToHomePage:function(e){e?this._onACCriteria(e):this._onACTrash(),this._onResetFilter(),this._onAttributeCommandsState({enable:0}),this._cmdsContainer.hide(),this.dispatchEvent("NGF_GoToWelcomePage")},_onDisplayGlobalFilterView:function(e){!this._cmdsContainer.visibleFlag&&this._cmdsContainer.show(),this.dispatchEvent("NGF_DisplayGlobalFilterView")},_applyDroppedFilters:function(e,t,n){var o=this,s={success:[],failure:[]};if(e.failure&&s.failure.push(e.failure[0]),e.success){var r=e.success[0];n.appId=o._appId,n.widget=o._widgetId,n.filterRootIds=[r.rootPhysicalId||r.rootID],sessionStorage.setItem("NGF_isUXBuilt_"+o._UXId,!0),this._removeUselessQueries(n);var a=function(e){o.dispatchConfigRevision(!1),b.publish("NGFilter.ApplyDroppedFilters/"+o._UXId,e)};if(this._isFilterBroken)if(0===g.getCVQueryBuildMode()){var l=o._updateDataForAppCB(e);a(l)}else o._updateDataForAppCBAsync(e).then((function(e){a(e)}));else{var d=f._getFilterSpecification(r)?i.clone(f._getFilterSpecification(r).data):void 0;s.success.push({rootId:r.rootPhysicalId||r.rootID,rootAlias:r.rootAlias,filterId:t,filterTitle:d?d.filterTitle:void 0,filterMdl:d?d.filterMdl:void 0,filter:n,fromDropOnFilter:"dropOnFilter"===(d?d.dropOption:void 0),tagsInMdl:"dropOnFilter"===(d?d.dropOption:void 0)?void 0:n.tagsInMdl}),a(s)}}},_updateDataForAppCB:function(e){var t=this,i={success:[],failure:[]};if(e&&e.success)for(var n=0;n<e.success.length;n++){var o=e.success[n],s=O.buildCVQueryFromModel(o),r=d.upgradeAndCompleteQuery(JSON.parse(s));r.appId=t._appId,r.widget=t._widgetId,r.filterRootIds=[o.rootPhysicalId];var a={rootId:o.rootPhysicalId,filterId:o.filterId,filterName:o.filterName,filter:r,fromDropOnFilter:t.options.fromDropOnFilter};i.success.push(a)}return i},_updateDataForAppCBAsync:function(e){var t=this,i={};if(e&&e.success){i.success=[],i.failure=[];for(var o=[],s=function(e){return new n((function(i,n){var o=t.getFilterSpecification(t._rootID,t._keepAttributeChildren,t._tagsOnly);t.buildCVQueryFromFilterSpec(o).then((function(n){var o=n;o.appId=t._appId,o.widget=t._widgetId,o.filterRootIds=[e.rootPhysicalId||e.rootID],t._removeUselessQueries(o);var s={rootId:e.rootPhysicalId||e.rootID,rootAlias:e.rootAlias,filterId:e.filterId,filterTitle:e.filterTitle,filterName:e.filterName,filterMdl:e.filterMdl,filter:o,fromDropOnFilter:"dropOnFilter"===t.options.dropOption};s.fromDropOnFilter=!1===s.fromDropOnFilter||s.fromDropOnFilter,d.displayNotification({level:"info",message:r.get("filterWithNonAppliedTag")}),i(s)}))}))},a=0;a<e.success.length;a++){var l=e.success[a];o.push(s(l))}return n.all(o).then((function(e){return e.forEach((function(e){i.success.push(e)})),i}))}},updateView:function(e){this._appQueryParam=e.appQueryParam||{};var t=f._getFilterSpecification(e),n=e.dropOption||(t?t.data.dropOption:void 0);if("drop"!==n&&"dropOnFilter"!==n)this._onRedraw({filterId:e.UXId}),t&&t.type&&t.data&&(this._feedViewWithFilter(e.filterToApply),this.options.filterToApply=i.clone(e.filterToApply),e.filterToApply=void 0);else{var o=e.filterId||(t?t.data.filterId:void 0),s=e.filterTitle||(t?t.data.filterTitle:void 0),r={success:[{rootId:e.rootID,filter:"tbd",filterId:Array.isArray(o)?o:[o],filterTitle:s||void 0,fromDropOnFilter:"dropOnFilter"===n}],failure:[]};b.publish("NGFilter.ApplyDroppedFilters/"+e.UXId,r)}},_computeSynthesisFromModel:function(e){for(var t={"ds6w:type":[],"ds6w:kind":[]},i=f.getFilterUIComponents(e),o=i.length,s=function(e){void 0!==e&&e.forEach((e=>{e.criteriaType&&e.type&&-1===t["ds6w:type"].indexOf(e.type)&&t["ds6w:type"].push(e.type);var i=e.allAttributes;if(void 0===i){var n=e.uri;if(t[n]||(t[n]=[]),e.attrValue){var o=Array.isArray(e.attrValue)?e.attrValue.flat():[e.attrValue];t[n]=t[n].concat(o)}}else s(i)}))},a=1;a<o;a++){i[a].toFeedUI.forEach((e=>{if(null!==e){var i=e.criteriaType;if("attribute"===i){var n=e.type;n&&(-1===t["ds6w:type"].indexOf(n)&&t["ds6w:type"].push(n),e.extension&&e.extension.length&&-1===t["ds6w:kind"].indexOf(e.extension)&&t["ds6w:kind"].push(e.extension)),s(e.allAttributes)}else"Sequence"===i&&"attribute"===e.sequenceType&&s(e.allAttributes)}}))}for(var l in t)if(t.hasOwnProperty(l)){let e=t[l];e.length&&(t[l]=[...new Set(e)])}return new n(((e,i)=>{g.getNlsOfPropertiesValues(t).then((function(i){var n,o=[],s=d.FILTER_ANY_OBJECT;for(var a in t)if(t.hasOwnProperty(a)){var l=[];if(i[a])t[a].forEach((e=>{let t=i[a][e]?s===e?r.get(s):i[a][e]:e;t="true"===t||"false"===t?r.get(t):t,l.push({nlsvalue:t,value:e,isAggregate:0})}));else{let e=t[a];e&&e.length?e.forEach((e=>{let t=e;t="true"===t||"false"===t?r.get(t):t,l.push({nlsvalue:t,value:e,isAggregate:0})})):l.push({nlsvalue:a,value:d.ATTRIBUTE_NOT_VALUATED,isAggregate:0})}o.push({property:a,values:l})}n=[],o.forEach((e=>{if(e.values){var t={};e.values.forEach((e=>{var i=e.nlsvalue;t[i]?t[i].values.push(e.value):(t[i]={},t[i].values=[e.value])})),e.values.length&&(e.values=[],Object.keys(t).forEach((function(i){var n=t[i].values.length,o=1===n?0:1,s={nlsvalue:i,value:1===n?t[i].values[0]:t[i].values,isAggregate:o};e.values.push(s)})),n.push(e))}})),e(o=n)}))}))},getFilterSpecification:function(e,t,i,n){var o=e||this._rootID,s=t||this._keepAttributeChildren;return this.collection.keepComponentsToFeedUI(o,s,i,n)},updateOnLinkUnlinkWith:function(e,t){if(this._queryFormat=this._getQueryFormat(t.NGFUXId),this._expandIntent=this._getExpandIntent(t.NGFUXId),this._listGroupView.forEach((e=>{e.updateCriteriaAvailibility(t)})),"NGFilter_Link"===e){if(t.applyFilter)this.onApplyFilter({event:t.eventName,empty:t.empty,tagsOnly:this._tagsOnly});else if(t.eventName){var i={results:"OK"};b.publish(t.eventName,i)}}else if("NGFilter_Unlink"===e&&(this._tagsOnly&&(t._tagsOnly=!0),t.eventName)){i={results:"OK"};b.publish(t.eventName,i)}},_getLinkedRoots:function(){var e=this;return new n((function(t,i){if(0===f.isActivated("MultiRoot"))t();else if(v.getOption("NGF_VDRP_AllowMultirootFilter")||0){var n=[{id:e._rootID,alias:e._rootAlias}],o={relations:["positioningArch_to"],attributes_for_detailview:["physicalid"],countmanagement:!1,debug:!1,ids:[e._rootID],trueREST:!0,displayTime:!1};s.authenticatedRequest(f.getGetEcoSystemUrl(f.getTenant()),{headers:g.getRESTHeaders(),method:"POST",data:JSON.stringify(o),type:"json",proxy:"passport",onComplete:function(i){S.unmask(e.container);var o=[];i.New.Objects&&i.New.Objects.forEach((t=>{e._rootID!==t.id&&o.push({id:t.id,name:t["ds6w:identifier"],alias:t.name})})),o.length?1===o.length?(n.push({id:o[0].id,alias:o[0].alias}),t(n)):(d.displayNotification({level:"error",message:r.get("InvalidLinkedRootsCount")}),t(null)):t(null)},onFailure:function(i){console.log("==> Get Linked roots failed, err = "+i),S.unmask(e.container),t(n)}})}else e._onDebugGetLinkedRoots().then((e=>{t(e)}))}))},_getLinkedRootsFromModel:function(e){return new n((t=>{if(0===f.isActivated("MultiRoot"))t();else{var i=e[0].filterMdl[0].toFeedUI.rootIds||[];1<[...new Set(i)].length?d.executeFetch(i,[],["ds6w:label","ds6wg:revision"]).then((function(e){var n=d.getAliasesFromFetched(i,e),o=[];i.forEach(((e,t)=>{o.push({id:e,alias:n[t]})})),t(o)}),(function(e){console.log(" ==> _getLinkedRootsFromModel / Retrieve root from model failed, err = "+e);var n=[];i.forEach(((e,t)=>{n.push({id:e.id,alias:"Root #"+t})})),t(n)})):t()}}))},_onUpdateSpecificationName:function(e){if(e.computeIndexCB&&e.name){var t=this.collection.getGroupCollectionIndex(e.name);e.computeIndexCB({index:-1!==t?t:0,name:e.name})}else this._updateCombinationCombo()},updateOnLeftPanelWidthChange:function(e){this._isLeftPanelMaximized=e,e?this._renameFilterBtn.hide():this._renameFilterBtn.show(),e?this._renameFilterBtn2.show():this._renameFilterBtn2.hide(),this._filterIDCard.updateOnLeftPanelWidthChange(e,this._isFilterFromModel),this._listGroupView.forEach((t=>{t.updateOnLeftPanelWidthChange(e)}))},onShatteredChange:function(e){this._onACCriteria(this._getFilterTitle()),this._onResetFilter({context:{updateAC:1}})},_createRepairFilterView:function(e){var t=this;let i=new h({options:e});return this.listenTo(i,"RepairFilter_UpdatetUI",(function(e){t._updateModelFromRepairPanel(e.data),t._isNewRepairActive&&(t._isFilterBroken&&t._buildCVQueryOfSelectedFilter(t._retrievedTags),delete t._retrievedTags)})),this.listenTo(i,"NGF_CancelRepairFilter",(function(e){b.publish("Frame3DXInfra.Close"),t._cancelRepairFilter()})),i},_createActiveCriteriaView:function(e){if(null===this._wgtActiveCriteriaView){var t=d.getRootFilterContainer(this._UXId).getElement(".ActiveCriteriaView-container");let e=new P({sections:[{id:"section-additionalFilters",title:r.get("activeFilters"),icon:{fonticon:"filter"}},{id:"section-filters"}]});return e.render(),t&&e.inject(t),e.addEvent("onAdditionalCriteriaChange",this.onAddCriteriaChange.bind(this)),e}return this._wgtActiveCriteriaView},_createFilterIDCardView:function(){var e=this;let t=new L({parent:this._headerContainer,serviceId:this._defaultServiceId,securityContext:this._securityContext,widgetId:this._widgetId,UXId:this._UXId}),i=t.getContainer();return this.listenTo(i,"NGF_OwnerChangedNewSpecification",(function(t){1===e._isFilterFromModel&&(e._isFilterFromModel=0,e._updateFilterTitle(e._defaultFilterName),e._updateActiveCriteriaView(e._defaultFilterName),e._forcedTitle="",e._headerContainer.getElement(".global-header-filtername").show())})),this.listenTo(i,"NGF_RenameFilter",this._renameFilterCmd.bind(this)),this.listenTo(i,"NGF_UpdateFilterTitle",(function(t){1===e._isFilterFromModel&&(e._updateFilterTitle(t),e._updateActiveCriteriaView(t))})),t},_onDebugGetLinkedRoots:function(){var e=this;return new n((function(t,i){var n=[{id:e._rootID,alias:e._rootAlias}];e.in_apps_search({refine:{"ds6w:what/ds6w:contentStructure":[{type:"string",object:"Root",disptext:"Root",field:["implicit"]}]},multiSel:!0,precond:'flattenedtaxonomies:"types/VPMReference"',title:"Select Root(s) to link to "+e._rootAlias,callback:function(i){var o=[e._rootID,i.resourceid_value];d.executeFetch([o,i.resourceid_value],[],["ds6w:label","ds6wg:revision"]).then((function(i){var s=d.getAliasesFromFetched(o,i);n=[],o.forEach(((e,t)=>{n.push({id:e,alias:s[t]})})),e._combinationCombo.selectedIndex=1,t(n)}),(function(o){n.push({id:i,alias:"Root #2"}),e._combinationCombo.selectedIndex=1,t(n)}))},cancel:function(){e._combinationCombo.selectedIndex=1,t()}})}))},_onSaveFilterSync:function(e){var t=e;if(!(t.groupView&&"edit"===t.groupView.model.get("state")?1:0)||t.validateEditedCriterion())if(0===g.getCVQueryBuildMode()){var i=t._buildCVQuerySync(),n=t.getFilterSpecification(t._rootID,t._keepAttributeChildren);"ValidOK"===t._filterState?t._displayRenameDialogAndCreateFilter("SaveTitle",i,n):t._checkFilterNameAndUpdateFilter(t._defaultFilterName,i,n),t.groupView.switchToEdit()}else{n=t.getFilterSpecification(t._rootID,t._keepAttributeChildren);"ValidOK"===t._filterState?t._displayRenameDialogAndCreateFilter("SaveTitle","{}",n):t._checkFilterNameAndUpdateFilter(t._defaultFilterName,"{}",n),t.groupView.switchToEdit()}else t.groupView.switchToEdit()},_onSaveAsFilterSync:function(e){var t=e;if(!(t.groupView&&"edit"===t.groupView.model.get("state")?1:0)||t.validateEditedCriterion())if(0===g.getCVQueryBuildMode()){var i=t._buildCVQuerySync(),n=t.getFilterSpecification(t._rootID,t._keepAttributeChildren);t._displayRenameDialogAndCreateFilter("SaveAsTitle",i,n),t.groupView.switchToEdit()}else{n=t.getFilterSpecification(t._rootID,t._keepAttributeChildren);t._displayRenameDialogAndCreateFilter("SaveAsTitle","{}",n),t.groupView.switchToEdit()}},onApplyFilterSync:function(e){var t=e;if(!(t.groupView&&"edit"===t.groupView.model.get("state")?1:0)||t.validateEditedCriterion())if(1===this._synthesisState&&this._isFilteredSynthesis&&(t._refreshSynthesisInfos(!1,!1),t._isFilteredSynthesis=!1),k=t._UXId,t._hasAppliedNGF=!0,t._appliedFilterTitle=t._getFilterTitle(),0===g.getCVQueryBuildMode()){var i=t._buildCVQuerySync();t._applyFilter({CVQuery:i,isEmpty:!1}),t.groupView.switchToEdit(),t._updateAddSpecificationButton(),t._updateApplySaveSaveAsState({status:"ValidOK"})}else t.buildCVQuery().then((function(e){t._applyFilter({CVQuery:e,isEmpty:!1}),t.groupView.switchToEdit(),t._updateAddSpecificationButton(),t._updateApplySaveSaveAsState({status:"ValidOK"})}));else t.groupView.switchToEdit()},validateEditedCriterionSync:function(e,t){var i=e,n=i._listGroupView.length,o=!n;if(n){o=!0;for(var s=0;s<n&&o;s++){var a=i._listGroupView[s];if(null!==a&&a.isViewEdited())if("function"==typeof a.areCriteriaValidate){var l=a.areCriteriaValidate(t);l?a.model.set("state","read"):o=l}else o=!1,d.displayNotification({level:"error",message:r.get("NeedToValidateCrirerion")})}o&&t&&"function"==typeof t.callback&&t.callback(t)}return o},_onAddNewFilterSpecificationSync:function(e){var t=e;t.validateEditedCriterion()&&(t._addGroupView(),t._updateCombinationCombo(),d.MAX_FILTER_SPECIFICATION===t._listGroupView.length&&(t._updateAddSpecificationButton(),t._updateApplySaveSaveAsState({status:"ValidOK"}),t._displayMaxFilterSpecDefinedNotif()))},_onAddExistingFilterSpecificationSync:function(e){for(var t=e,i=void 0,n=0;n<t._listGroupView.length;n++)if("edit"===t._listGroupView[n].model.get("state")){i=t._listGroupView[n].model;break}if(t.validateEditedCriterion()){var o={resetFilter:!1,editedModel:i};t._retrieveFilters(t._rootID,o)}},_retrieveFilters:function(e,t){this.retrieveFilter=!0,this.droppedFilter=!1,this.retrieveFiltersRelatedTo({type:d.FILTER_RELATED_TO_ROOT,rootIDs:e},t)}})})),define("DS/ENONextGenFilterUX/views/ContainerFilterView",["UWA/Class","UWA/Class/View","UWA/Core","UWA/Utils","UWA/Promise","DS/ENONextGenFilterUX/views/GlobalFilterView","DS/ENONextGenFilterUX/models/GlobalFilterModel","DS/Handlebars/Handlebars4","text!DS/ENONextGenFilterUX/templates/containerViewTemplate.html","DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/NGFServices","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENOFilterBIUX/FBIServices","DS/ENONextGenFilterUX/views/WelcomePageFilterView","DS/Utilities/Utils"],(function(e,t,i,n,o,s,r,a,l,d,c,u,h,p,_,m){"use strict";var f=1;return t.extend({domEvents:{},setup:function(){c.displayInternalTimeTrace(0,"ContainerView"),this._isWebInWin=this.options.isWebInWin,this.appId=this.options.appId,this._widgetId=this.options.widgetId||this.options.widget,this._UXId=this.options.UXId,this.rootID=this.options.rootID,this.rootAlias=this.options.rootAlias||"?",this._NGFUXId=this.options.NGFUXId,this._appQueryParam=this.options.appQueryParam||{},this._template=a.compile(l),this._filterToApply=this.options.filterToApply,this._dropedFilterNames=[],this.options.filterNames&&(this._dropedFilterNames=Array.isArray(this.options.filterNames)?this.options.filterNames:[this.options.filterNames]),this._dropedFilterIds=[];var e,t,i,n=u._getFilterSpecification(this.options)?u._getFilterSpecification(this.options).data.filterId:void 0;n&&(this._dropedFilterIds=Array.isArray(n)?n:[n]),this.options.tagData&&(this._tagData=this.options.tagData),p.setShattered(this.options.shattered),p.setURLParams({param:this.options.paramsURL}),this._subscribeShatteredChange=d.subscribe("NGFilter_ShatteredChange",this._onShatteredChange.bind(this)),void 0===this.options.configUsed&&(this.options.configUsed="1"===this._isWebInWin?1:0);for(var o=sessionStorage.length,s=0;s<o;s++){var r=sessionStorage.key(s),h=sessionStorage.getItem(r);-1!==r.indexOf("NGFilter_Volume_"+this._NGFUXId)?e="true"===h||(e||!1):-1!==r.indexOf("NGFilter_Context_"+this._NGFUXId)?t="false"!==h||(t||!1):-1!==r.indexOf("NGFilter_Attribute_"+this._NGFUXId)&&(i="false"!==h||(i||!1))}this.options.volumeUsed=void 0!==e&&e,this.options.contextUsed=void 0===t||t,this.options.attributeUsed=void 0===i||i,this.options.configUsed=1,this.inject(this.options.ghostContainer||this.options.mainNGFContainer),this.render()},destroy:function(){this._subscribe0&&this._subscribe0.unsubscribe("Frame3DXInfra.onPanelClose"),this._subscribe1&&this._subscribe1.unsubscribe("Frame3DXInfra.LeftPanelMaximized"),delete this._subscribe0,delete this._subscribe1,this._subscribeShatteredChange&&this._subscribeShatteredChange.unsubscribe("NGFilter_ShatteredChange"),delete this._subscribeShatteredChange,this._parent()},render:function(){var e=this;this.container.setAttribute("id","NGF_"+this.cid),this.container.setAttribute("class","mainNGF"),this.container.setContent(this._template({filterId:this._UXId,containerHeightClass:"f-globalFilter-container-height"+("safari"===n.Client.Engine.name?"-Safari":""),otherCmds:c.isFilterCmdHeaderActivated()}));let t=this.getElement(".filter-Grid");this._subscribe1=d.subscribe("Frame3DXInfra.LeftPanelMaximized",(i=>{c.setLeftPanelMaximized(i),i?t.addClassName("filter-Grid-extended"):t.removeClassName("filter-Grid-extended"),e.globalViewFilter.updateOnLeftPanelWidthChange(i)})),this._toolBar=this.getElement(".filter-Commands"),this._expandLeftPanel3DD=document&&document.querySelector(".left-panel-actions")?1:0,this._expandLeftPanel3DD&&(this._subscribe0=d.subscribe("Frame3DXInfra.onPanelClose",this._onCloseFilterPanel.bind(this))),u.isDebugActive("LeftPanelCmds")&&(this._toolBar.style.marginRight="0px");var o=u._getFilterSpecification(e.options)?u._getFilterSpecification(e.options).data:void 0;if(o&&o.filterMdl&&o.filterMdl.length)e._dropedFilterIds=[],e._dropedFilterIds=o?Array.isArray(o.filterId)?o.filterId:[o.filterId]:void 0,e._fromFilterDataToAppAndUXView({success:[e.options]});else{var s={appId:e.appId,widget:e._widgetId,UXId:e._UXId,rootID:e.rootID,rootAlias:e.rootAlias,rootRevision:e.options.rootRevision,configUsed:e.options.configUsed,volumeUsed:e.options.volumeUsed,contextUsed:e.options.contextUsed,attributeUsed:e.options.attributeUsed,filterToApply:e._filterToApply,idxGFV:f++,fromDropOnFilter:o?o.fromDropOnFilter:void 0,dropOption:o?o.dropOption:void 0,filterMdl:o?o.filterMdl:void 0,NGFUXId:e._NGFUXId,appQueryParam:e._appQueryParam,securityContext:e.options.securityContext,queryFormat:e.options.queryFormat,pfServiceId:e.options.pfServiceId,ghostContainer:e.options.ghostContainer};if(s.tagData=e._tagData,e._createViews(s),e._filterToApply=void 0,u.isDebugActive("extendedCmds")){let t="DS/ENONextGenFilterUX/views/NGFDebugCommands";require([t],(t=>{let n=i.clone(e.options);n.globalViewFilter=e.globalViewFilter,n.elmCmds=e.getElement("#filter-extra-commands");new t(n)}),(e=>{console.log(" Require failed for: "+t)}))}}return this},updateView:function(e){this._appQueryParam=e.appQueryParam||{},this.globalViewFilter&&this.globalViewFilter.updateView(e)},updateViewAsync:function(e){var t=this;return new o((function(i){t.updateView(e),i(t)}))},getFilteringContext:function(){return{NGFUXId:this._NGFUXId,widgetId:this._widgetId}},_fromFilterDataToAppAndUXView:function(e){var t=this;if(e.success){var n=e.success[0],o={idxGFV:f++,widget:t._widgetId,filterUIComponents:n.filterMdl,droppedInfos:{retrieveFilters:e,filterId:t._dropedFilterIds[0]}},s=i.merge(n,o);t._createViews(s),t._welcomeView.hide()}},_onCloseFilterPanel:function(){"1"===this._isWebInWin&&sendNotificationToWin("NGFClose","Close"),!this._expandLeftPanel3DD&&""!==this._widgetId&&d.publish("Frame3DXInfra.Close",{}),sessionStorage.setItem("NGF_tagMgtRunning_"+this._UXId,!1)},setTagsDataOnNGF:function(e){this.globalViewFilter.setTagsDataOnNGF(e)},updateDataOnNGF:function(e){this.globalViewFilter.updateDataOnNGF(e)},_createViews:function(e){var t=this;e.container=t.getElement(".welcomepage-container"),t._welcomeView=new _(e),this._filterGrid=t.getElement(".filter-Grid"),e.container=t.getElement(".globalFilterView-container"),e.headerContainer=t.getElement(".global-header"),e.model=new r({state:"init"}),t.globalViewFilter=new s(e),t.listenTo(t._welcomeView,"NGF_WLC_AddCriterion",(function(e){t._welcomeView.hide(),t._toolBar.show(),t._filterGrid.show(),t.globalViewFilter.show(),t.globalViewFilter.addNewCriterion(e)})),t.listenTo(t._welcomeView,"NGF_WLC_RetrieveFilter",(function(e){var i=e.type,n=-1;c.FILTER_RELATED_TO_ROOT===i?n=1:c.FILTER_RELATED_TO_ALL_REVISIONS===i?n=2:c.FILTER_RELATED_TO_ANY_ROOT===i&&(n=3),u.setUsageTracker(this._widgetId,"NGF-Retrieve_Filters_Related_To",{label:i,value:n}),t.globalViewFilter.retrieveFiltersRelatedTo(e)})),t.listenTo(t.globalViewFilter,"NGF_GoToWelcomePage",(function(e){t._toolBar.hide(),t._filterGrid.hide(),t.globalViewFilter.hide(),t._welcomeView.show()})),t.listenTo(t.globalViewFilter,"NGF_DisplayGlobalFilterView",(function(e){t._welcomeView.hide(),t._toolBar.show(),t._filterGrid.show(),t.globalViewFilter.show()}))},getFilterSpecification:function(){return{filterUIComponents:this.globalViewFilter.getFilterSpecification()}},updateOnLinkUnlinkWith:function(e,t){this.options.queryFormat=t.queryFormat,this.options.volumeUsed=t.volumeUsed,this.options.contextUsed=t.contextUsed,this.options.attributeUsed=t.attributeUsed,this.globalViewFilter.updateOnLinkUnlinkWith(e,t)},_onShatteredChange:function(e){this._NGFUXId===e.NGFUXId&&(p.setShattered(e.shattered),p.setURLParams({param:e.paramsURL}),this.globalViewFilter&&this.globalViewFilter.onShatteredChange(e))}})})),define("DS/ENONextGenFilterUX/views/FilterViewManager",["UWA/Class","UWA/Core","UWA/Promise","DS/PlatformAPI/PlatformAPI","DS/Logger/Logger","DS/ENONextGenFilterUX/views/ContainerFilterView","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/NGFServices","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX"],(function(e,t,i,n,o,s,r,a,l,d){"use strict";var c=null;return e.extend({init:function(e){var t=Date.now();l.setReferenceTime(e.referenceTime||t);var i=t-l.getReferenceTime();l.displayInternalTimeTrace(1,"FilterViewManager Loading"),a.setFilteringContext({tenant:e.widgetTenant||"OnPremise"});var o=e.widgetId||e.widget;a.setPerformanceTracker(o,"NGF-Loading","NGFilter_UX",{Loading_duration:i},1),null===c&&(c=this._initManager()),this._initDisplay=e.display,this._viewChangeData=void 0,this._currentNGFUXId=void 0,n.subscribe("NGFilter.RemoveFilter",this._onRemoveFilter.bind(this)),n.subscribe("NGFilter_ViewChange",this._onViewChange.bind(this)),n.subscribe("Frame3DXInfra.ViewChange",this._onViewChange.bind(this))},get3DXViewAsync:function(e){var t=this;return new i((function(i){let o=function(e){var o;if(e&&e.filterToApply){let r,u;if(Array.isArray(e.filterToApply)?(r=e.filterToApply[0],u=r&&r.specification?r.specification.type:""):(r=e.filterToApply,u=r&&r.specification?r.specification.type:""),"NGFilter_CopyFromAnyFilterToRoots"===u)o=t._onCopyFromAnyFilterToRoots(e),i(o);else if("NGFilter_Link"===u||"NGFilter_Unlink"===u)o=t._onLinkOrUnlinkWith(e),i(o);else if("NGFilter_SetPublicFilterSpec"===u)n.subscribe("NGF_DisplayView",(function(e){n.unsubscribe("NGF_DisplayView"),e&&e.displayFilter&&e.UXId&&(c.display(e.UXId),l.openFilterPanel("NGFilter_SetPublicFilterSpec-"+Date.now()))})),t._onSetPublicFilterSpecFilter(e).then((e=>{i(o=e)}));else if("NGFilter_GetPublicFilterSpecFromVolatile"===u){if(c.get(a.computeUXId(r.NGFUXId,r.rootID)))t._get3DXView(e),i(null);else{var s=r.proxyEvent?r.proxyEvent:"";s&&n.publish(s,{status:0,error:{level:"error",title:d.get("GetPublicFilterSpecification"),message:d.get("NoFilterDefinedOnRoot")}}),i(null)}}else"NGFilter_createFromTag"===u&&Array.isArray(e.filterToApply)?t._currentNGFUXId!==e.NGFUXId&&(t._currentNGFUXId=e.NGFUXId,t._updateFilterViewsWithSpecifications(e).then((e=>{t._currentNGFUXId=void 0,i(o=e)}))):(o=t._get3DXView(e),i(o))}else o=t._get3DXView(e),i(o)},s=function(){l.getPlatformServices(a.getTenant()).then((function(){if(t._initDone=1,e.securityContext)o(e);else{let t=e.rootServiceId||e.serviceId||"3DSpace";a.getAllSecurityContexts(a.getTenant(),t).then((function(t){var i=t.cspaces.findIndex((e=>e.isDefault));e.securityContext=t.cspaces[-1===i?0:i].value,o(e)}))}}))};l.initPreferences().then((()=>{e.widgetTenant===a.getTenant()?t._initDone?o(e):s():(a.updateFilteringContext({tenant:e.widgetTenant||a.getTenant()}),s())}))}))},_get3DXViewAsync:function(e){let t=this;return new i((function(i,n){i(t._get3DXView(e))}))},_get3DXView:function(e){var t;if(void 0===e.createFilterView||e.createFilterView){l.setReferenceTime(Date.now()),l.displayInternalTimeTrace(1,"FilterViewManager 3DXView"),e.NGFUXId=e.NGFUXId||e.appId;var i=e.widgetId||e.widget;e.UXId=e.NGFUXId&&e.rootID?a.computeUXId(e.NGFUXId,e.rootID):e.UXId||i;var n=e.UXId,o="NGF_isUXBuilt_"+n,r="NGF_tagMgtRunning_"+n;if(null===(t=c.get(n))){e.pfServiceId=e.rootServiceId||e.serviceId||"3DSpace",delete e.rootServiceId,sessionStorage.setItem(o,!1),e.tagData&&sessionStorage.setItem(r,!0);let i=!e.ghostContainer,a=new s(e);c.add(n,a),i&&c.display(n),t=c.get(n)}else{if("false"===sessionStorage.getItem(o))return;if("true"===sessionStorage.getItem(r))return;t.updateView(e),(void 0===e.display||e.display)&&c.display(n)}}return t},_onViewChange:function(e){if("maximized"===e.type){this._viewChangeData?this._viewChangeData=this._viewChangeData.NGFUXId?this._viewChangeData:e:this._viewChangeData=e;var t=this;setTimeout((function(){t._viewChangeData&&!1===c.isThereViewWithId(t._viewChangeData.NGFUXId,t._viewChangeData.widgetId||t._viewChangeData.id)&&n.publish("Frame3DXInfra.Close",{}),t._viewChangeData=void 0}),1e3)}},_onRemoveFilter:function(e){c.isThereViewWithId(e.NGFUXId)&&(c.remove(e.NGFUXId,e.rootIds),n.publish("Frame3DXInfra.Close",{}))},_onCopyFromAnyFilterToRoots:function(e){var o,s=this,r=e.NGFUXId,d=e.widgetTenant||"OnPremise",u=e.securityContext||"OnPremise",h=e.filterToApply.specification.data;a.getAllDataFromFilterIds(h.filterId.id||h.filterId,d).then((function(d){var p=d.success[0];let _=p?p.filterUIComponents:void 0;if(_&&_.length&&"VDRP"===_[0].specificationType)return l.displayNotification({level:"error",message:"Invalid filter specification type (VDRP)"}),o;l.checkAndGetListOfAttributesFromSelectedFilter(p).then((function(d){var _=h.options?h.options.displayNotif:1,m=[],f=e;return h.rootInfos.forEach((function(e){f.rootID=e.id,f.rootAlias=e.alias,f.rootRevision=e.revisions,m.push(function(e,i){var n=e.rootID,o=e.rootAlias;return new Promise((function(e){var s={rootID:n};a.isDebugActive("ngf")&&(s.rootAlias=o);var d=a.computeUXId(r,n);c.get(d)&&!h.options.resetFilter?(s.error=-1,e(s)):l.checkCompatibiltyFilterRules(u,n,p,_,i).then((function(i){s=t.merge(s,i.result),e(s)}))}))}(f,e.service))})),i.all(m).then((function(e){var l=t.clone(h.options);l.resetFilter=1;var u=[];return h.rootInfos.forEach((function(e){var i=a.computeUXId(r,e.id),n=t.createElement("div",{id:"NGF-CopyFromAnyFilterToRoots_"+i});n.inject(window.document.body),n.hide();var o=c.get(i);(!o||o&&h.options.resetFilter)&&(f.rootID=e.id,f.rootAlias=e.alias,f.rootRevision=e.revision,f.rootServiceId=e.service,f.display=!1,f.ghostContainer=n,f.filterToApply={specification:{type:"NGFilter_CopyFromAnyFilterToRoots",data:{filterData:p,listAttr:d,rootId:e.id,options:l}}},u.push(s._get3DXViewAsync(f)))})),i.all(u).then((t=>{o=t&&t.length?t[t.length-1]:void 0;var i=h.options&&h.options.eventName?h.options.eventName:"";if(i){var s={};s.results=e,n.publish(i,s)}})),o}))}),(function(e){return console.log(" ==> onCopyFromAnyFilterToRoots / Retrieve List Of Attribute,  err = "+e),o}))}),(function(e){return console.log(" ==> onCopyFromAnyFilterToRoots / Retrieve Data Filter,  err = "+e),o}))},_onLinkOrUnlinkWith:function(e){var o;if(!(e&&e.filterToApply&&e.filterToApply.specification))return console.log(" => Link / Unlink : No specification defined"),o;var s=e.filterToApply,l=s.specification.type,d=s.specification.data||{},u=[];if(d&&(u=Array.isArray(d.rootID)?d.rootID:[d.rootID]),u.length&&("NGFilter_Link"===l||"NGFilter_Unlink"===l)){var h=Array.isArray(e.rootID)?e.rootID:[e.rootID];if(r.setShattered(e.shattered),r.setURLParams({param:e.paramsURL}),"NGFilter_Link"===l){h.forEach((t=>{c.get(a.computeUXId(e.NGFUXId,t))&&c.remove(e.NGFUXId,t)}));var p={};return p.attributeUsed=e.attributeUsed||d.attributeUsed,p.contextUsed=e.contextUsed||d.contextUsed,p.volumeUsed=e.volumeUsed||d.volumeUsed,p.queryFormat=e.queryFormat|Number.parseInt(d.queryFormat),p.NGFUXId=d.NGFUXId,p.applyFilter=s.applyFilter,p.empty=d&&d.empty?d.empty[0]:void 0,p.eventName=d&&d.eventName?d.eventName:"",u.forEach((e=>{var t=c.get(a.computeUXId(d.NGFUXId,e));if(t)t.updateOnLinkUnlinkWith(l,p),o=t;else{var i=d&&d.eventName?d.eventName:"";if(i){var s={results:"OK"};n.publish(i,s)}}})),o}if("NGFilter_Unlink"===l){var _=Array.isArray(e.rootAlias)?e.rootAlias:[e.rootAlias],m=s;delete e.filterToApply;var f=[];h.forEach(((i,n)=>{e.rootID=i,e.rootAlias=_[n],e.UXId=a.computeUXId(e.NGFUXId,i);var o=t.createElement("div",{id:"NGF-BuildFilter_"+e.UXId});o.inject(window.document.body),o.hide(),e.ghostContainer=o,f.push(this._get3DXViewAsync(e))})),i.all(f).then((function(t){var i={};return u.forEach((e=>{var t=c.get(a.computeUXId(d.NGFUXId,e));t?(i[e]=t.getFilterSpecification(),t.updateOnLinkUnlinkWith(l,d)):d&&d.eventName&&n.publish(d.eventName,{results:"OK"}),o=t})),h.forEach(((t,n)=>{var o=i[t]||i[u[0]];o&&(e.rootID=t,e.rootAlias=_[n],e.UXId=a.computeUXId(e.NGFUXId,t),m.specification.data=o,e.filterToApply=m,e.filterToApply._tagsOnly=d&&d._tagsOnly?d._tagsOnly:void 0,c.get(e.UXId).updateView(e))})),o}))}}},_onSetPublicFilterSpecFilter:function(e){var o=this;return new i((function(s,r){if(e&&e.filterToApply&&e.filterToApply.specification){var u=[e.rootID];l.executeFetch(u).then((r=>{if(r.infos.nresults){var h=l.getAliasesFromFetched(u,r);e.rootAlias=h.length?h[0]:"?",e.filterToApply.rootAlias=e.rootAlias,function(){var n=function(e,t){return new i(((n,o)=>{var s=[];e.forEach((e=>{s.push(e.updateViewAsync(t))})),i.all(s).then((function(e){n(e.length?e[0]:void 0)}))}))},r=e.filterToApply,l=a.computeUXId(e.NGFUXId,e.rootID),d=c.get(l)?[c.get(l)]:[];if(d.length)n(d,e).then((e=>{s(e)}));else{var u=t.createElement("div",{id:"NGF-BuildFilter_"+l});u.inject(window.document.body),u.hide(),delete e.filterToApply,e.UXId=l,e.ghostContainer=u;var h=[];h.push(o._get3DXViewAsync(e)),i.all(h).then((function(t){e.filterToApply=r,n(t,e).then((e=>{s(e)}))}))}}()}else{var p=d.get("InvalidRootIdentifier");if(console.log(" => Set Public Speciifcation, err = "+p),e&&e.filterToApply&&e.filterToApply.eventName){var _={status:0,error:{level:"error",title:d.get("SetPublicFilterSpecification"),message:p}};n.publish(e.filterToApply.eventName,_)}s(null)}}))}else{var h=d.get("NoSpecificationDefined");if(console.log(" => Set Public Speciifcation, err = "+h),e&&e.filterToApply&&e.filterToApply.eventName){var p={status:0,error:{level:"error",title:d.get("SetPublicFilterSpecification"),message:h}};n.publish(e.filterToApply.eventName,p)}s(null)}}))},_updateFilterViewsWithSpecifications:function(e){var n=this;let o=c.getCurrentUXId(),s=e.filterToApply;var r=[];let l;return e.filterToApply.forEach((i=>{if(e.filterToApply=i,e.rootID=i.rootID,e.UXId=a.computeUXId(e.NGFUXId,e.rootID),!c.get(e.UXId)){e.rootAlias=i.rootAlias,e.filterToApply=void 0;var o=t.createElement("div",{id:"NGF-BuildFilter_"+e.UXId});o.inject(window.document.body),o.hide(),e.ghostContainer=o,r.push(n._get3DXViewAsync(e))}})),i.all(r).then((function(t){return s.forEach((t=>{e.filterToApply=t,e.rootID=t.rootID,e.rootAlias=t.rootAlias,e.UXId=a.computeUXId(e.NGFUXId,e.rootID),l=e.UXId,c.get(e.UXId).updateView(e)})),o?c.get(o):c.get(l)}))},_initManager:function(){return{_listView:{},_currentUXId:"",get:function(e){return e&&this._listView[e]?this._listView[e]:null},getCurrentUXId:function(){return this._currentUXId||""},isThereViewWithId:function(e,t){var i=this,n=Object.keys(this._listView);return!!(e?n.find((function(t){var n=i._listView[t].getFilteringContext();return-1!==e.indexOf(n.NGFUXId)})):n.find((function(e){var n=i._listView[e].getFilteringContext();return-1!==t.indexOf(n.widgetId)})))},add:function(e,t){e&&t&&(this._listView[e]||(this._listView[e]=t))},display:function(e){if(e){var t=this._currentUXId;t!==e&&(""!==t&&this._listView[t]&&this._listView[t].hide(),this._listView[e]&&(this._currentUXId=e,this._listView[e].show()))}},remove:function(e,t){if(e){if(t)for(var i=Array.isArray(t)?t:[t],n=i.length-1;n>=0;n--){var o=a.computeUXId(e,i[n]);this._remove(o)}else{var s=Object.keys(this._listView);for(n=s.length-1;n>=0;n--)-1!==s[n].indexOf(e)&&this._remove(s[n])}0!==Object.keys(this._listView).length&&this._listView[this._currentUXId]||(this._currentUXId="")}},_remove:function(e){var t=c.get(e);t&&(t.remove(),delete this._listView[e])}}}})})),define("DS/ENONextGenFilterUX/ENOAdvFilterUX",["UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterUX/views/FilterViewManager"],(function(e,t,i,n){"use strict";return t.extend({init:function(e){i.subscribe("Frame3DXInfra.Update",this._onUpdate.bind(this)),i.subscribe("NGFilter_SessionStorage",this._onSessionStorage.bind(this)),i.subscribe("NGFilter_LocalStorage",this._onLocalStorage.bind(this))},_onUpdate:function(e){let t=this;if("Filter"===e.type){let i=widget.body,o=function(e,n){n.display=void 0===n.display||n.display,n.mainNGFContainer=i,e.get3DXViewAsync(n).then((e=>{if(e){let n="function"==typeof e.get3DXViewId?e.get3DXViewId():e.cid;if(t._viewId!==n||!n){let o=document.getElementById("NGF_"+t._viewId);o&&o.remove(),i.setContent(e),t._viewId=n}}}))},s=e.options;this._filterViewMgr||(t._filterViewMgr=new n(s)),o(this._filterViewMgr,s)}},_onSessionStorage:function(e){e&&e.removeItems&&e.removeItems.forEach((e=>{sessionStorage.removeItem(e)})),e&&e.setItems&&e.setItems.forEach((e=>{sessionStorage.setItem(e.key,e.value)}))},_onLocalStorage:function(e){e&&e.forEach((e=>{localStorage.setItem(e.key,e.value)}))}})})),define("DS/ENONextGenFilterUX/utils/FilterAdvServicesWebInWin",["UWA/Core","UWA/Class","UWA/Widget","UWA/Class/Options","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBISettings","DS/ENONextGenFilterUX/views/FilterViewManager","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/FBIServices","DS/PlatformAPI/PlatformAPI"],(function(e,t,i,n,o,s,r,a,l,d){"use strict";return t.singleton(n,{initServices:function(e){var t=e.filterSettings.platform_services;l.setOption("fromWebInWin",1),l.setOption("str_platformServices",t),a.setOption("str_platformServices",t)},renderFilterViewInWin:function(){var e=new i,t=e.getValue("X3DContentId")?JSON.parse(e.getValue("X3DContentId")):null,n=(e.getView&&e.getView().type,"[");if(null===t||void 0!==e.getValue("lastRootNodeID")||e.getValue("clearInPreview"))n=null;else{var o=t.data;if(null!==o&&o.items.length>0){for(var s=o.items,a=0;a<s.length;a++)n+='"'+s[a].objectId+'"',n+=s.length-1===a?"]":",";e.setValue("lastRootNodeID",n)}}var l=null;"function"==typeof(l=new r(options)).get3DXViewAsync&&l.get3DXViewAsync(options).then((function(e){e.inject(document.body)}))},addRemovePaths:function(e){console.log("In addOrRemovePaths"),d.publish("NGFilter.OccPath",{selectedPath:e.selectedPaths,pathAlias:e.pathAlias})}})})),define("DS/ENONextGenFilterUX/ENONextGenFilterUXWIW",["DS/ENONextGenFilterUX/views/FilterViewManager","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENONextGenFilterUX/utils/FilterAdvServicesWebInWin","DS/ENOFilterBIUX/FBIServices","UWA/Class","UWA/Core","UWA/Widget","DS/PlatformAPI/PlatformAPI"],(function(e,t,i,n,o,s,r,a){"use strict";return o.extend({init:function(e){this.options=e,i.initServices(e),i.renderFilterViewInWin()},addOrRemovePaths:function(e){console.log("In addOrRemovePaths"),a.publish("NGFilter.OccPath",{selectedPath:e.selectedPaths,pathAlias:e.pathAlias})}})}));