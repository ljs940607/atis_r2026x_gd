define("DS/DMUBaseUI/DMUToolsUsers",["require","exports","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/Visualization/ThreeJS_DS","DS/PADUtils/PADSettingsMgt","UWA/Core"],(function(e,t,n,o,i,r,a){"use strict";let s=[],d=[],l=[16007990,15277667,10233776,6765239,4149685,2201331,240116,48340,38536,5025616,9159498,13491257,16771899,16761095,16750592,16733986,7951688,6323595];return class{static getUserLogin(){return o.getUserLogin()}static getUserName(e,t,i){return new Promise((a=>{if(!e)return void a("");if(e===o.getUserLogin()){const e=o.getUserName();return i&&i(e),a(e)}let d=s.find((function(t){return t.login===e}));if(d&&d.name)return i&&i(d.name),a(d.name);let l=function(t){d=s.find((t=>t.login===e)),d?d.name=t:s.push({login:e,name:t})},c=null,u=null,p=null;t?(c=t.get3DSpaceUrl(),u=t.getPlatformId(),p=t.getSecurityContext()):(c=o.get3DSpaceUrl(),u=o.getPlatformId(),p=r.getSetting("pad_security_ctx")),n.authenticatedRequest(c+"/resources/modeler/pno/person/"+e+"?tenant="+u,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:p},timeout:6e4,onComplete:function(t){let n=JSON.parse(t),o=e;n&&n.firstname&&(o=n.firstname,o+=n.lastname?" "+n.lastname:""),l(o),i&&i(o),a(o)},onFailure:function(){l(e),a(e)},onTimeout:function(){l(e),a(e)}})}))}static getUserColor(e){if(!e)return;if(e===o.getUserLogin())return new i.Color(7913210);let t,n=s.find((function(t){return t.login===e}));if(n&&n.color)return n.color;let r,a=function(e){let t=Math.min(e,255).toString(16);return 1===t.length&&(t="0"+t),t},d=[];for(r=0;r<e.length;r++)d[r%3]?d[r%3]=Math.floor(((e.charCodeAt(r)-48)/74*255+d[r%3])/2):d[r%3]=Math.floor((e.charCodeAt(r)-48)/74*255);let c=parseInt(a(d[0])+a(d[1])+a(d[2]),16);if(l&&l.length){let o=l[0];return l.forEach((function(e){o=Math.abs(e-c)<Math.abs(o-c)?e:o})),t=new i.Color(o),n?n.color=t:s.push({login:e,color:t}),l.splice(l.indexOf(o),1),n?n.color=t:s.push({login:e,color:t}),t}t=new i.Color;let u=t.getHSL();return u.s=Math.max(u.s,.5),u.l=u.l<.5?.5:u.l>.7?.7:u.l,t.setHSL(u.h,u.s,u.l),n?n.color=t:s.push({login:e,color:t}),t}static getImage(e,t){if(e&&t){for(let n=0;n<d.length;n++)if(d[n].url===e)return void t(d[n].stream);n.authenticatedRequest(e,{proxy:"none",type:"blob",timeout:18e4,onComplete:function(n){let o=new FileReader;o.onload=function(){d.push({url:e,stream:o.result}),t(o.result)},o.readAsDataURL(n)},onFailure:function(){t(e,!0)},onTimeout:function(){t(e,!0)}})}}static getUserImageURL(e){if(!e)return;let t=s.find((function(t){return t.login===e}));if(t&&t.imageUrl)return t.imageUrl;let n=o.getPlatformURL("3DSwym")+"/api/user/getpicture/login/"+e+"/format/mini";return t?t.imageUrl=n:s.push({login:e,imageUrl:n}),n}static formatDate(e){return e?a.String.parseRelativeTime(e.toString()):""}}})),define("DS/DMUBaseUI/DMUContextualBarAdapter",["UWA/Class","DS/DMUBaseExperience/EXPManagerSet"],(function(e,t){"use strict";return e.extend({getSharedContextualCommandList:function(){return[]},getContextualCommandList:function(){return null},getSharedContextualMenuCommandList:function(){return[]},getContextualMenuCommandList:function(){return[]},getSharedHeaderTypes:function(){return{}},register:function(e){if(e){var n=t.getManager({name:"DMUUserExperienceManager",context:e.frmWindow});n&&(e.contextualBar&&n.registerContextualBar(e.contextualBar),e.contextualMenu&&n.registerContextualMenu(e.contextualMenu))}},unregister:function(e){if(e){var n=t.getManager({name:"DMUUserExperienceManager",context:e.frmWindow});n&&(e.contextualBar&&n.unregisterContextualBar(e.contextualBar),e.contextualMenu&&n.unregisterContextualMenu(e.contextualMenu))}}})})),define("DS/DMUBaseUI/DMUToolsLeader",["DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseExperience/EXPToolsVisualization","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/ArrowNode","DS/DMUBaseExperience/EXPToolsMaterial"],(function(e,t,n,o,i,r){"use strict";let a={attachment:{CENTER:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4},_computeNewPoints:function(e,t,i,r,s,d){var l={};l.vBreak=t.clone(),l.vAttach=t.clone();var c,u,p=r&&void 0!==r.width?s.offsetWidth*r.width:15,h=r&&void 0!==r.height?s.offsetHeight*r.height:0;s.offsetHeight?u=s.offsetHeight/2:s.style&&s.style.pixelHeight&&(u=s.style.pixelHeight/2),s.offsetWidth?c=s.offsetWidth/2:s.style&&s.style.pixelWidth&&(c=s.style.pixelWidth/2);var m=n.getWindowPositionFromPoint(e,t,d);m=new o.Vector2(m.left,m.top);var g=n.getWindowPositionFromPoint(e,i,d);g=new o.Vector2(g.left,g.top);var f,D,v,C,S=(new o.Vector2).subVectors(g,m),w=c+p,P=u+h,M=s.rotationAngle?s.rotationAngle:0;if(S=new o.Vector2(S.x*Math.cos(M)-S.y*Math.sin(M),S.x*Math.sin(M)+S.y*Math.cos(M)),Math.abs(S.y)<u&&Math.abs(S.x)<c)return l.vBreak=null,l.vAttach=null,l;if(S.x>0){var y=(new o.Vector2).addVectors(m,new o.Vector2(w*Math.cos(M),-w*Math.sin(M)));S.y>0?(v=(new o.Vector2).addVectors(m,new o.Vector2(-P*Math.sin(M+Math.PI),-P*Math.cos(M+Math.PI))),g.distanceToSquared(y)<g.distanceToSquared(v)?(D=y,f=a.attachment.RIGHT):(D=v,f=a.attachment.BOTTOM)):(C=(new o.Vector2).addVectors(m,new o.Vector2(-P*Math.sin(M),-P*Math.cos(M))),g.distanceToSquared(y)<g.distanceToSquared(C)?(D=y,f=a.attachment.RIGHT):(D=C,f=a.attachment.TOP))}else{var U=(new o.Vector2).addVectors(m,new o.Vector2(w*Math.cos(M+Math.PI),-w*Math.sin(M+Math.PI)));S.y>0?(v=(new o.Vector2).addVectors(m,new o.Vector2(-P*Math.sin(M+Math.PI),-P*Math.cos(M+Math.PI))),g.distanceToSquared(U)<g.distanceToSquared(v)?(D=U,f=a.attachment.LEFT):(D=v,f=a.attachment.BOTTOM)):(C=(new o.Vector2).addVectors(m,new o.Vector2(-P*Math.sin(M),-P*Math.cos(M))),g.distanceToSquared(U)<g.distanceToSquared(C)?(D=U,f=a.attachment.LEFT):(D=C,f=a.attachment.TOP))}if(l.vBreak=a._computeProjection(e,t,D.x,D.y),f===a.attachment.RIGHT||f===a.attachment.LEFT){f===a.attachment.LEFT&&(M+=Math.PI);var T=new o.Vector2(c*Math.cos(M),c*Math.sin(M));l.vAttach=a._computeProjection(e,t,m.x+T.x,m.y-T.y)}else if(f===a.attachment.TOP||f===a.attachment.BOTTOM)if(h){f===a.attachment.TOP&&(M+=Math.PI);var x=new o.Vector2(-u*Math.sin(M),u*Math.cos(M));l.vAttach=a._computeProjection(e,t,m.x-x.x,m.y+x.y)}else l.vAttach=l.vBreak.clone();return l},_computeProjection:function(e,i,r,a){var s=n.getViewpointInfo(e.currentViewpoint).sight.negate(),d=n.getLineFromWindowPosition(e,r,a),l=t.computeLinePlaneDistance(d.position.toArray(),d.direction.toArray(),i.toArray(),s.toArray());return new o.Vector3(l.aPosition[0],l.aPosition[1],l.aPosition[2])}};return Object.freeze({modifyLeaderNode:function(t,n,o,s,d,l,c,u,p,h,m,g){var f=!1,D={};if(D.vBreak=s.clone(),D.vAttach=s.clone(),o&&(D=a._computeNewPoints(t,s,d,l,m,g)),null===D.vBreak&&null===D.vAttach)return f;var v=r.getDashType(p),C={arrowWidth:c,headLength:Math.max(2*c+4,10),viewpoint:t.currentViewpoint,arrowDashType:v,arrowScale:2,color:u},S=!e.areEqual(D.vBreak,d,"Vector3"),w=n.getChildByName("attach"),P=Math.max(2*c+4,10);w?S?(D.vBreak.distanceTo(w._initialPoint)&&w.updateInitialPosition(D.vBreak),d.distanceTo(w._finalPoint)&&w.updateFinalPosition(d),u!==w.materialArrow.color&&w.updateColor(u),c!==w.materialArrow.lineWidth&&w.setArrowWidth(c),P!==w._headLength&&w.setHeadSize(P),h!==w._head&&w.setHeadType(h),v!==w.savedPattern&&(w.savedPattern=v,w.setArrowPattern(v)),2!==w.materialArrow.scale&&w.setArrowPatternScale(2),f=!0):(n.removeChild(w),f=!0):S&&(C.initialPoint=D.vBreak.clone(),C.finalPoint=d.clone(),C.head=h,(w=new i(C)).setPickParent(!0),w.name="attach",n.addChild(w),f=!0);var M=S&&!e.areEqual(D.vBreak,D.vAttach,"Vector3"),y=n.getChildByName("step");return y?M?(D.vBreak.distanceTo(y._initialPoint)&&y.updateInitialPosition(D.vBreak),D.vAttach.distanceTo(y._finalPoint)&&y.updateFinalPosition(D.vAttach),u!==y.materialArrow.color&&y.updateColor(u),c!==y.materialArrow.lineWidth&&y.setArrowWidth(c),P!==y._headLength&&y.setHeadSize(P),0!==y._head&&y.setHeadType(0),v!==y.savedPattern&&(y.savedPattern=v,y.setArrowPattern(v)),2!==y.materialArrow.scale&&y.setArrowPatternScale(2),f=!0):(n.removeChild(y),f=!0):M&&(C.initialPoint=D.vBreak.clone(),C.finalPoint=D.vAttach.clone(),C.head=0,(y=new i(C)).setPickParent(!0),y.name="step",n.addChild(y),f=!0),f}})})),define("DS/DMUBaseUI/DMUToolsContextualBar",["require","exports","DS/PADUtils/PADUtilsServices"],(function(e,t,n){"use strict";return class{static isCloud(){return n.isCloud()}}})),define("DS/DMUBaseUI/DMUReviewDnDComponent",["UWA/Core","UWA/Utils","DS/PADUtils/PADSettingsMgt","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/Generics","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/Utilities/TouchUtils","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ButtonGroup","i18n!DS/DMUBaseUI/assets/nls/DMUBaseUI"],(function(t,n,o,i,r,a,s,d,l,c,u,p,h){"use strict";let m;const g={mode:"drop",behavior:"WITH_CONTEXT",unserializedData:null,broadcast:!0};function f(e,t,n){var o=[{id:e.member[0].specificationReport.member[0]["@id"],type:"Specification Report"}];n.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:o.map((function(n){return{envId:t||require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:n.reviewId?n.reviewId:n.id,objectType:"PointCloud"!==n.type?n.type:"R2V_Activity",displayName:n.displayName,serviceId:"PointCloud"!==n.type?void 0:"r2vsurvey",subContext:{id:e.member[0]["@id"],type:e.member[0].typeactualName,label:e.member[0].V_Name}}}))}}})}function D(e,t,n,o){var i={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:[{envId:t||require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.member[0]["@id"],objectType:e.member[0].typeactualName,displayType:e.member[0].typedisplayName,displayName:e.member[0].V_Name,serviceId:"3DSpace"}]}};o.addRootNodesFromContent({json3DXContent:i,dispatch:!0,inContext:n})}function v(e,n,o,i,a,s){var d=require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/resources/v1/modeler/dsspec/dsspec:PhysicalProduct/"+n+"?$mask=dsspec:SpecAndRelatedInfoObjectMask";require("DS/PADUtils/utilsWS/WSUtils").executeRequest(d,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(n){let o=JSON.parse(n);o&&o.member&&o.member.length>0&&o.member[0]&&o.member[0].specificationReport&&o.member[0].specificationReport.member&&o.member[0].specificationReport.member.length>0&&o.member[0].specificationReport.member[0]?"AskOpeningMode"===m?function(e){var n,o,i,a=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),s=window.document.getElementsByClassName("DMULoadingPanel");a.length&&(a[0].dsModel.off(),a[0].dsModel.destroy(),a=null);s.length&&s[0].destroy();var d=t.createElement("div",{class:"DMUDisplayChooserDiv"});d.setStyles({height:"100%",display:"flex"});var m=r.getWebappsAssetUrl("DMUReviewCommonWebApp","icons/");(i=new u({label:h.ProductDefinition,type:"radio",checkFlag:"product"===localStorage.getItem("defaultSelectedTypeData"),icon:{iconPath:m+"I_DMU_CATASDAPAppIcon.png",iconSize:{height:"100px",width:"100px"}},onClick:function(){localStorage.setItem("defaultSelectedTypeData","product")}})).getContent().setStyles({margin:"auto","margin-right":"5px",display:"grid"}),i.getContent().addClassName("prdLoadingButton"),(o=new u({label:h.RSDefinition,type:"radio",checkFlag:"releaseSnapshot"===localStorage.getItem("defaultSelectedTypeData"),icon:{iconPath:m+"I_DMU_SpecificationManagement.png",iconSize:{height:"100px",width:"100px"}},onClick:function(){localStorage.setItem("defaultSelectedTypeData","releaseSnapshot")}})).getContent().setStyles({margin:"auto","margin-left":"5px",display:"grid"}),o.getContent().addClassName("rsLoadingButton");var g=new p({}).inject(d);g.getContent().addClassName("contexTypeBtnGroup"),g.getContent().setStyles({display:"flex",height:"100%",width:"100%"}),g.addChild(i),g.addChild(o);var f=new u({emphasize:"primary",label:h.openButtonLabel,onClick:function(){var t=this.getParents().find((e=>e.hasClassName("modalContextTypeChooser")));if(t){var o=t.getElementsByClassName("contexTypeBtnGroup");if(o.length&&o[0].dsModel){var i=o[0].dsModel.getButton(0).checkFlag;e.onOkClickCB(!0===i?"product":"SRDocument",n)}}}}),D=new u({label:h.cancelButtonLabel,onClick:function(){n.close&&n.close(),n.destroy&&n.destroy(),e.viewer._dropZoneContainer.show("drop")}});(n=new c({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:h.panelLoading,resizableFlag:!1,immersiveFrame:e.viewer.getFrameWindow().getImmersiveFrame(),position:l.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:f,Cancel:D},content:d})).getContent().addClassName("modalContextTypeChooser"),n.width=o.getContent().getSize().width+i.getContent().getSize().width+30,n.addEventListener("close",(function(){n.destroy&&n.destroy(),e.viewer._dropZoneContainer.show("drop")}))}({viewer:e,onOkClickCB:function(t,n){n.close&&n.close(),n.destroy&&n.destroy(),"SRDocument"===t?f(o,a,e):D(o,a,s,e)}}):"OpenReleaseSnapshot"===m?f(o,a,e):D(o,a,s,e):D(o,a,s,e)},onFailure:function(){var t={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:[{envId:a||require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:n,objectType:o,displayName:i,serviceId:"3DSpace"}]}};e.addRootNodesFromContent({json3DXContent:t,dispatch:!0,inContext:s})}})}return{callSpecReportData:function(e,t,n){i.readPreferences([{Repository:"DMURepository",PreferenceNames:["ProductLoadingMode"]}]).then((function(o){let i=o.repositories[0].preferences;i.length&&i[0].name&&"ProductLoadingMode"===i[0].name&&(m=i[0].value),t&&t.data&&t.data.items&&t.data.items.length&&"VPMReference"===t.data.items[0].objectType&&"Open3DDefinition"!==m?v(e,t.data.items[0].objectId,t.data.items[0].objectType,t.data.items[0].displayName,t.data.items[0].envId,n):e.addRootNodesFromContent({json3DXContent:t,dispatch:!1})})).catch((function(e){window.console.warn("Could not get server value, default value set instead.",e)}))},initViewerDnd:function(r,l){if(window&&window.location&&window.location.search&&""!==window.location.search){var c={};t.extend(c,n.parseQuery(window.location.search)),c.dndLA&&"1"===c.dndLA&&o.setSetting("dndLA",!0)}if(!o.getSetting("activate_newDropInvite")){var u=o.getSetting("dndLA")?"DS/PADUtils/views/PADDnDInviteLA":"DS/PADUtils/views/PADDnDInvite";require([u],(function(t){function n(e){e.preventDefault(),r.addWidgetBorder(),o.getSetting("dndLA")?r._dropZoneContainer._onDragOver(e):e.shiftKey?r._dropZoneContainer.show("add_as_object"):r._dropZoneContainer.show("add_in_context")}function c(){r.clearWidgetBorder(),o.getSetting("dndLA")&&r._dropZoneContainer._onDragEnd(e),0!==r.getRoots().length||r._checkHiddenRoots()?r._dropZoneContainer.hide():r._dropZoneContainer.show("drop")}async function u(e){e.preventDefault(),e.stopPropagation();var t,n,c,u=!1;if(r.elements.container.contains(e.target)){if(o.getSetting("dndLA")){let o=(n=0,c=0,(t=e).pageX||t.pageY?(n=t.pageX,c=t.pageY):(t.clientX||t.clientY)&&(n=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:n,y:c}),i=r._dropZoneContainer.options.invitesArray.filter((function(e){return function(e,t){let n=!1,o=e.getBoundingClientRect();var i,r;return r=o,(i=t).y>=r.top&&i.y<=r.bottom&&i.x>=r.left&&i.x<=r.right&&(n=!0),n}(e,o)}));if(i.length){let t=i[0].dataset.id,n=r._dropZoneContainer.options.three[t];var p="WITH_CONTEXT"===n.behavior;if(e.shiftKey)p=!1;else if("FILTER"===n.behavior){u=!0;let t=s.deserializeDroppedData(e),o=function(e,t){return a.merge({behavior:e,unserializedData:t},g)}(n.behavior,t);d.publish({event:"ENXViews/WelcomePanel/openContent",data:o})}}else{r._dropZoneContainer.hide();p=!0;e.shiftKey&&(p=!1)}}else{r._dropZoneContainer.hide();p=!0;e.shiftKey&&(p=!1)}var h,f=require("DS/PADUtils/PADUtilsServices").deserializeDroppedData({dataTransfer:e.dataTransfer});f&&f.data.items&&f.data.items.length&&(h=f.data.items[0].objectType);var D=await l(h);i.readPreferences([{Repository:"DMURepository",PreferenceNames:["ProductLoadingMode"]}]).then((function(e){let t=e.repositories[0].preferences;t.length&&t[0].name&&"ProductLoadingMode"===t[0].name&&(m=t[0].value),D.includes("VPMReference")&&!D.includes("AecSite")&&"Open3DDefinition"!==m?v(r,f.data.items[0].objectId,f.data.items[0].objectType,f.data.items[0].displayName,f.data.items[0].envId,p):u||r.addRootNodesFromContent({json3DXContent:f,dispatch:!0,inContext:p}),r._dropZoneContainer.hide(),r._dropZoneContainer.show("drop"),u=!1,r.clearWidgetBorder()})).catch((function(e){window.console.warn("Could not get server value, default value set instead.",e)}))}}function p(e){e.preventDefault(),r.clearWidgetBorder(),o.getSetting("dndLA")?r._dropZoneContainer._onDragEnter(e):e.shiftKey?r._dropZoneContainer.show("add_as_object"):r._dropZoneContainer.show("add_in_context")}function h(e){o.getSetting("dndLA")?r._dropZoneContainer._onDragLeave(e):null!==e.relatedTarget&&e.relatedTarget.classList.contains("paddnd_invite_container")||(r._dropZoneContainer.hide(),0===r.getRoots().length&&r._dropZoneContainer.show(),r.clearWidgetBorder())}r._dropZoneContainer=new t({renderTo:r.elements.container,mode:"inviteWithFilter",filterActive:o.getSetting("enopad3dviewer_FilterAvailable"),dropOnInvite:function(e){u(e)}}),r.getExecutionContext?r._dndTokens[0]=n:r._dndCB[0]=n,r.getExecutionContext?r._dndTokens[1]=c:r._dndCB[1]=c,r.getExecutionContext?r._dndTokens[2]=u:r._dndCB[2]=u,r.getExecutionContext?r._dndTokens[3]=p:r._dndCB[3]=p,r.getExecutionContext?r._dndTokens[4]=h:r._dndCB[4]=h,r.elements.container.addEventListener("dragenter",p),r.elements.container.addEventListener("dragover",n),r.elements.container.addEventListener("dragleave",h),r.elements.container.addEventListener("dragend",c),r.elements.container.addEventListener("drop",u)}))}}}})),define("DS/DMUBaseUI/DMUNode3D",["DS/Visualization/Node3D","DS/Mesh/MeshUtils"],(function(e,t){"use strict";return e.extend({init:function(e){this._parent();var n=e||{},o=this;this.getDMUType=function(){return"function"==typeof n.getType?n.getType():""},this.getViewer=function(){return n.frmWindow?n.frmWindow.getViewer():null},this.setReadOnly=function(e){o.setPickable(e?t.PICKTHROUGH:t.PICKABLE)},this.mergeParams=function(e,t){for(var n=function(e){return null!=e&&e.clone?e.clone():e},o=Object.keys(t),i=0;i<o.length;i++)if("graphicProperties"!==o[i])e[o[i]]=n(t[o[i]]);else for(var r=Object.keys(t[o[i]]),a=0;a<r.length;a++)if("fontStyle"===r[a]||"fillStyle"===r[a]||"fillStyle"===r[a])for(var s=Object.keys(t[o[i]][r[a]]),d=0;d<s.length;d++)e[o[i]][r[a]][s[d]]=n(t[o[i]][r[a]][s[d]]);else e[o[i]][r[a]]=n(t[o[i]][r[a]]);return e}},remove:function(){this.removeDMUNode3DOverload&&this.removeDMUNode3DOverload(),this._parent()}})})),define("DS/DMUBaseUI/DMUManipulableNode3D",["DS/DMUBaseUI/DMUNode3D"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.setNoZ(!0);var t,n,o=this;this.setRepManipulator=function(e){e&&(t&&t.destroy(),(t=e)&&n&&t.linkToNode(n))},this.getRepManipulator=function(){return t},this.linkManipulatorToNode=function(e){n=e},this.removeDMUNode3DOverload=function(){t&&(t.destroy(),t=null),n=null,o.removeChildren&&o.removeChildren()}},remove:function(){this.removeDMUNode3DOverload&&this.removeDMUNode3DOverload(),this._parent()}})})),define("DS/DMUBaseUI/DMUNode2D",["DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUBaseExperience/EXPToolsVisualization","DS/Visualization/ThreeJS_DS"],(function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e);var o=this;this.setExcludeFromBounding(!0);var i=1;this.setMaximalProportionalZoneWidth=function(e){i=e},this.getProportionalFactor=function(e){var t=o.getViewer().SCREEN_WIDTH/2,n=o.getViewer().SCREEN_HEIGHT/2,r=t/n;if(e&&r<i){var a=Math.pow((i-r)/i,3);return Math.round(r/i*n*a+n*(1-a))}return n},this.convertPixelsInProportionalCoord=function(e,t){return e/o.getProportionalFactor(t)/window.devicePixelRatio},this.convertProportionalCoordInPixels=function(e,t){return e*o.getProportionalFactor(t)*window.devicePixelRatio},this.convertCoordsInPixels=function(e){var t=o.getViewer().SCREEN_WIDTH/2,i=o.getProportionalFactor(e.fitOnX);return"center"===e.windowAnchor?new n.Vector2(t+e.coords.x*i,(1-e.coords.y)*i+(o.getViewer().SCREEN_HEIGHT/2-i)):new n.Vector2(e.coords.x*i,e.coords.y*i)},this.get3DPositionFromScreenCoordinates=function(e){if(e.coords){var r=(new n.Vector2).copy(e.coords),a=o.getProportionalFactor();let u=o.getViewer().SCREEN_HEIGHT/2;if(e.proportionalPosition&&"center"===e.windowAnchor){var s=o.getViewer().SCREEN_WIDTH/2,d=s/u,l=i*u>s?r.x/i*d:r.x;if(r.x=s+l*a,r.y=(1-r.y)*a+(u-a),e.width&&"center"===e.anchor){var c=e.width/2;r.x-c<0&&(r.x=c),r.x+c>2*s&&(r.x=2*s-c)}}let p=o.getViewer().getSceneBoundingSphere();return t.getPositionFromIntersection(o.getViewer(),r,p?p.center:new n.Vector3)}return new n.Vector3(1,0,0)}}})}));