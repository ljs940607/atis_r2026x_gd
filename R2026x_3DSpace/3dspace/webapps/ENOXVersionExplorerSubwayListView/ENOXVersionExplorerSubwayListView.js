define("DS/ENOXVersionExplorerSubwayListView/VersionExplorerColumnManager",["UWA/Core","DS/GraphListView/ColumnManagerBase","DS/WidgetServices/WidgetServices","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","i18n!DS/ENOXVersionExplorerSubwayListView/assets/nls/SubwayColumnsTitles","i18n!DS/ENOXVersionExplorerViews/assets/nls/VersionExplorerView"],(function(e,t,n,o,i,l,s){"use strict";const r={day:"numeric",year:"numeric",month:"long",hour:"numeric",minute:"numeric"};return t.extend({init:function(t){if(this._parent(t),this.versionExplorerController=t.versionExplorerController,this.setDefaultColumns([{dataIndex:"__GRAPH__",getCellValueForSort:function(e){return e},sortFunction:function(e,t){return e.options.fakeDate<t.options.fakeDate?-1:1},compareFunction:function(e,t){return e.options.fakeDate<t.options.fakeDate?-1:1}},{width:250,dataIndex:"tree",kind:"tree",getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"user"},getCellValue:function(e){var t,n,o,l=e.nodeModel?e.nodeModel.options.label:void 0,s="",r=(e.nodeModel.getTreeDocument()||this.treeDocument)._DATA_MODEL_TYPE;if(r!==i.DATA_MODEL_TYPES.MODEL_P&&r!==i.DATA_MODEL_TYPES.MODEL_REVISION&&e.nodeModel.options.ancestors&&e.nodeModel.options.ancestors.length){for(var a=0;a<e.nodeModel.options.ancestors.length;a++)t&&"I"!==e.nodeModel.options.ancestors[a].semantic||(t=e.nodeModel.options.ancestors[a].icon),t&&t.indexOf("I_MajorVersion.png")>0&&(n="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-line-add",o="WUXManagedFontIcons.Font3DS");t&&(s='<img src="'+t+'">',s=t)}var c=!1;let d;return s?(d={iconPath:"url("+s+")"},c=!0):n?(d={iconName:n,fontIconFamily:o},c=!0):(d={iconName:"",fontIconFamily:1},c=!0),l?c?{icon:d,label:l}:{label:l}:void 0}}]),t.versionExplorerController&&t.versionExplorerController.options&&t.versionExplorerController.options.customizeColumnHash)for(var n=t.versionExplorerController.options.customizeColumnHash,o=Object.keys(n),l=0;l<o.length;l++){var s=n[o[l]];s.columnDefFunction&&s.columnDefFunction(this)}this._customColumnViews.push({id:"thumbnail_cell_view",buildContent:function(){return new e.Element("div",{styles:{height:"80px","background-repeat":"no-repeat","background-size":"contain","background-position":"center center"}})}},{id:"title_cell_view",buildContent:function(){return e.createElement("div",{class:"with-version-semantic",html:["<span>",'<div class="symbol"></div>','<div class="title"></div>',"</span>"].join("\n")})}})},_customizeColumnView:function(t){if("modified"===(t=this._parent(t)).dataIndex)t.onCellRequest=function(e){if(!e.isHeader){var o=e.nodeModel,i=n.getLanguage();if(o.options.grid[t.dataIndex]instanceof Date){var l=o.options.grid[t.dataIndex].toLocaleString(i,r);e.cellModel&&(e.cellModel=l),this.defaultOnCellRequest(e)}}};else if("creationDate"===t.dataIndex)t.onCellRequest=function(e){if(e.isHeader){var i=e.cellView._cellInfos.manager.getOrderedColumnState(),l=!0;o.historyConfig&&o.historyConfig.settings&&o.historyConfig.settings.subwayGraph&&Array.isArray(o.historyConfig.settings.subwayGraph.sortColumns)&&o.historyConfig.settings.subwayGraph.sortColumns.length&&(l=o.historyConfig.settings.subwayGraph.sortColumns.indexOf("creationDate")>=0),l&&"creationDate"===i.dataIndex||"__GRAPH__"===i.dataIndex||"code"===i.dataIndex?e.cellView.getContent().addClassName("wux-ui-sort-"+i.sortOrder):(e.cellView.getContent().removeClassName("wux-ui-sort-asc"),e.cellView.getContent().removeClassName("wux-ui-sort-desc"))}else{var s=e.nodeModel,a=n.getLanguage();if(s.options.grid[t.dataIndex]instanceof Date){var c=s.options.grid[t.dataIndex].toLocaleString(a,r);e.cellModel&&(e.cellModel=c),this.defaultOnCellRequest(e)}}};else if("code"===t.dataIndex)t.sortFunction=function(e,t){var n=e.options.grid.code,o=t.options.grid.code;const i=e=>(+e).toString()===e,l=n.match(/\d+|\D+/g),s=o.match(/\d+|\D+/g);let r=0,a=Math.min(l.length,s.length);for(;r<a&&l[r]===s[r];)r++;return r===a?l.length-s.length:i(l[r])&&i(s[r])?l[r]-s[r]:l[r].localeCompare(s[r])},t.getCellValueForSort=function(e){return e},t.compareFunction=function(e,n){return t.sortFunction(e,n)},t.onCellRequest=function(e){if(e.isHeader){var t=e.cellView._cellInfos.manager.getOrderedColumnState(),n=!0;o.historyConfig&&o.historyConfig.settings&&o.historyConfig.settings.subwayGraph&&Array.isArray(o.historyConfig.settings.subwayGraph.sortColumns)&&o.historyConfig.settings.subwayGraph.sortColumns.length&&(n=o.historyConfig.settings.subwayGraph.sortColumns.indexOf("code")>=0),n&&"creationDate"===t.dataIndex||"__GRAPH__"===t.dataIndex||"code"===t.dataIndex?e.cellView.getContent().addClassName("wux-ui-sort-"+t.sortOrder):(e.cellView.getContent().removeClassName("wux-ui-sort-asc"),e.cellView.getContent().removeClassName("wux-ui-sort-desc"))}else{e.nodeModel;this.defaultOnCellRequest(e)}};else if("current"===t.dataIndex);else if("resp"===t.dataIndex);else if("thumbnail"===t.dataIndex)t.width=131,t.onCellRequest=function(n){if(!n.isHeader){var o=n.nodeModel.options.grid.thumbnail||n.nodeModel.options.grid.icon||"";let i=e.createElement("div",{className:"title_cell_view",height:"80px",styles:{"background-repeat":"no-repeat","background-size":"contain","background-position":"center center",width:"100%",height:"100%","background-image":"url("+o+")"},events:{mousedown:function(e){e.preventDefault(),e.stopPropagation(),"function"==typeof t.cellClickCB&&t.cellClickCB(n,e)}}});i.computeContentSize=function(){return 131},i.getTweakerPadding=function(){return 2},n.cellView.setReusableContent(i),n.cellView.getContent().tooltipInfos&&(n.cellView.getContent().tooltipInfos.shortHelp=s.ClickToViewThumbnail)}},t.cellClickCB=function(e){e.cellModel&&require(["DS/PADUtils/views/PADThumbnail"],(function(t){new t({cellModel:e.cellModel})._modal.elements.body.getElement(".padthumbnail_main").setStyle("background-image","url("+e.cellModel+")")}))};else if("maturity_nls"===t.dataIndex){t.versionExplorerController=this.versionExplorerController,t.alignment="center";var i=t.versionExplorerController._isMaturityButtonDisabled();if(t.versionExplorerController._statesData&&t.versionExplorerController._statesData.policies&&t.versionExplorerController._statesData.policies.length>0){t.states=t.versionExplorerController._statesData.policies[0].states,t.onCellRequest=function(e){if(!e.isHeader){var n=e.nodeModel,o=n.options.grid[t.dataIndex],l=n.options.grid.maturity,s=[];t.versionExplorerController._statesData.policies&&(s=t.versionExplorerController._statesData.policies[0].states);for(var r="red",a=0;a<s.length;a++)if(s[a].stateSysName===l){r=s[a].activeColor;break}let c=this.reuseCellContent("maturity_reusable_content_id");c.style.color="#FFFFFF"===r?"#000000":"#FFFFFF",c.style.backgroundColor=r,c.setHTML(o),c.removeEvent("mousedown"),c.addEvent("mousedown",(function(n){1!=i&&(n.preventDefault(),n.stopPropagation(),"function"==typeof t.cellClickCB&&t.cellClickCB(e,n))})),"#FFFFFF"===r&&(c.style.border="1px solid #E2E4E3"),e.cellView.setReusableContent(c)}};var l=t.versionExplorerController._setUseWebCommandsOnNative(),a=t.versionExplorerController.areCommandsEnabled(),c=t.versionExplorerController._isFromWebInWinWrapper();!a||t.versionExplorerController._isMIB||1==i||1==c&&1!=l||(t.cellClickCB=function(e,n){if(e.cellModel&&0==n.button&&!t.isProcessingMaturityClick){t.isProcessingMaturityClick=!0;var o=e.nodeModel;t.versionExplorerController.publishEvent("preEventCompletedENOXVersionExplorerShowMaturity",o),setTimeout((function(){t.isProcessingMaturityClick=!1}),500)}})}}else t.onCellRequest=function(e){if(!e.isHeader){var o=e.nodeModel.options.grid[t.dataIndex];e.cellView.getContent();if(o instanceof Date){var i=n.getLanguage(),l=o.toLocaleString(i,r);e.cellModel&&(e.cellModel=l)}this.defaultOnCellRequest(e)}};return t},getColumns:function(){var e=this._parent();return o.historyConfig&&o.historyConfig.settings&&o.historyConfig.settings.subwayGraph&&Array.isArray(o.historyConfig.settings.subwayGraph.sortColumns)&&o.historyConfig.settings.subwayGraph.sortColumns.length&&e.forEach((function(e){e.isSortable=o.historyConfig.settings.subwayGraph.sortColumns.indexOf(e.dataIndex)>=0})),e}})})),define("DS/ENOXVersionExplorerSubwayListView/VersionExplorerSubwayListView",["UWA/Core","DS/GraphListView/GraphDataGridListView","DS/ENOXVersionExplorerSubwayListView/VersionExplorerColumnManager","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/LifecycleServices/LifecycleServicesSettings","DS/UIKIT/Mask","css!DS/ENOXVersionExplorerSubwayListView/styles/VersionExplorerSubwayListView"],(function(e,t,n,o,i,l,s,r,a){"use strict";function c(e){var t=[];if(e[0]&&e[1]){if(void 0===e[0].__SUBWAYGRAPHNODE__||void 0===e[1].__SUBWAYGRAPHNODE__)return t;var n=e[0].__SUBWAYGRAPHNODE__.data.parentEdges.find((function(t){return t.parentNode===e[1].__SUBWAYGRAPHNODE__}))||e[0].__SUBWAYGRAPHNODE__.data.childEdges.find((function(t){return t.childNode===e[1].__SUBWAYGRAPHNODE__}));if(n)t.push(n);else{for(var o,i=0,l=this._grMergeConnections.length;i<l;i++){var s=this._grMergeConnections[i];if(s.grParent===e[0].__SUBWAYGRAPHNODE__&&s.grChild.__SUBWAYGRAPHNODE__===e[1]||s.grParent===e[1].__SUBWAYGRAPHNODE__&&s.grChild===e[0].__SUBWAYGRAPHNODE__){o=s;break}}o&&(o.edge?t.push(o.edge):o.edges&&(t=o.edges))}}return t}return t.extend({_options:void 0,init:function(t){var i=this;this._options=e.extend({columnManager:new n(t),customOnDrop:t.customOnDrop,defaultCellHeight:48,enableListSelection:!0,useGlobalStorage:t.model.useGlobalStorage,globalStorageName:t.model.globalStorageName,versionExplorerController:t.versionExplorerController,cellDragEnabledFlag:!t.versionExplorerController.isEffectivityBasedModeOrEffectivityBasedReuseMode(),onDragStartCell:function(e,t){var n=t.nodeModel._options.data,o=t.nodeModel.options.grid,i=o&&o.contents&&o.contents.length>0?o.contents[0].id:n.id,l={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:[{envId:s.getTenant(),serviceId:n.serviceId,contextId:n.contextId,objectId:i,objectType:n.type,displayName:n.displayName+" "+n.revision,session_object:!1}]}};try{e.dataTransfer.effectAllowed="uninitialized",e.dataTransfer.setData("text/searchitems",JSON.stringify(l)),e.dataTransfer.setData("Text",JSON.stringify(l))}catch(t){e.dataTransfer.setData("Text",JSON.stringify(l))}},onDropCell:function(e,t){"function"==typeof this.options.customOnDrop&&this.options.customOnDrop(e)},onDropBlank:function(e,t){"function"==typeof this.options.customOnDrop&&this.options.customOnDrop(e)},onDragOverColumnHeader:function(e,t){return 1!=t.cellView.collectionView.columns[t.columnID].alwaysOn||t.cellView.collectionView.columns[t.columnID].isDraggable},onDragEnterColumnHeader:function(e,t){return!1},columnDragEnabledFlag:function(e,t){return 1!=t.cellView.collectionView.columns[t.columnID].alwaysOn||t.cellView.collectionView.columns[t.columnID].isDraggable},onDragStartColumnHeader:function(e,t){return 1!=t.cellView.collectionView.columns[t.columnID].alwaysOn||t.cellView.collectionView.columns[t.columnID].isDraggable},onDragEndColumnHeader:function(e,t){return i._options.versionExplorerController.saveCustomizedColumns(),!0},onDropColumnHeader:function(e,t){return i._options.versionExplorerController.saveCustomizedColumns(),!0},onContextualEvent:function(e){if(!(e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.nodeModel.__MASTER__)){var t=!1;e.cellInfos&&(0!=e.cellInfos.cellView.collectionView.columns[e.cellInfos.columnID].isDraggable&&(t=!0),1==e.cellInfos.cellView.collectionView.columns[e.cellInfos.columnID].isPinnable?t=!0:0==e.cellInfos.cellView.collectionView.columns[e.cellInfos.columnID].isPinnable&&(t=!1));var n,o,l,s=[],r={filter:!0,pin:t,sizeColumnToFit:!0,firstColumnsVisibility:!1,columnsManagement:!1};s=e.collectionView.buildDefaultContextualMenu(e,r);for(var a=0;a<s.length;a++)if(!(s[a].icon&&"pin"!==s[a].icon.iconName||void 0===s[a].submenu))for(var c=0;c<s[a].submenu.length;c++)0==c?(n=s[a].submenu[c].action.callback,s[a].submenu[c].action.callback=function(e){i.prepareUpdateColumns(),n(e),i.pushUpdateColumns()}):1==c?(o=s[a].submenu[c].action.callback,s[a].submenu[c].action.callback=function(e){i.prepareUpdateColumns(),o(e),i.pushUpdateColumns()}):2==c&&(l=s[a].submenu[c].action.callback,s[a].submenu[c].action.callback=function(e){i.prepareUpdateColumns(),l(e),i.pushUpdateColumns()});var d=this.getColumnManager().getColumns(),u=d,g=void 0;return e.cellInfos&&(u=e.cellInfos.cellView.collectionView.options.columns,g=u[e.cellInfos.columnID].dataIndex),d.forEach((function(e){var t=i._treeDoc.getFilterManager().isDataFiltered(),n=i._manager;!t&&n.elements.header&&(n.elements.header.getElementsByClassName("wux-datagridview-filter").length>0&&(t=!0));if(!(!i._options.versionExplorerController.areCommandsEnabled()&&"__DROPDOWN__"===e.dataIndex||t&&"__GRAPH__"===e.dataIndex)&&(0!=e.isShowHideable&&1!=e.isHidden&&g===e.dataIndex||e.isShowHideable)){var o=i.layout.getColumnVisibleFlag(e.dataIndex)?"selected":"unselected";s.push({type:"CheckItem",title:e.text||e.menuText,icon:e.icon,state:i.layout.getColumnAlwaysVisibleFlag(e.dataIndex)?"disabled|"+o:o,action:{callback:function(t){if(t&&t.context&&t.context.id){var n=i.layout.getColumnVisibleFlag(t.context.id);i.layout.setColumnVisibleFlag(t.context.id,!n,{isUserInteraction:!0}),e.isHidden=!e.isHidden,"__GRAPH__"===e.dataIndex&&(e.isHidden?(i._manager.elements.poolContainer.getElement(".subway-graph-canvas").hide(),i._options.versionExplorerController._isGraphColumnHiddenExplicitly=!0):(i._manager.elements.poolContainer.getElement(".subway-graph-canvas").show(),i._options.versionExplorerController._isGraphColumnHiddenExplicitly=!1)),i._options.versionExplorerController.saveCustomizedColumns()}},context:{id:e.dataIndex}}})}})),s}this.setActiveCell(e.cellInfos.nodeModel),i._options.onNodeDropdownMenu({cellInfos:e.cellInfos,event:e.data.event})},graphSortingColumnID:["code","creationDate","__GRAPH__"],ascending:o.UserSettings.subwaySortAscending,enableActiveUI:!0,enableKeyboardNavigation:!0},t),this._parent(this._options),this.registerReusableCellContent({id:"maturity_reusable_content_id",buildContent:function(){return e.createElement("div",{class:"wux-controls-label",html:"",styles:{backgroundColor:"",color:"#000000",paddingLeft:"5px",paddingRight:"5px","text-align":"center","margin-block":"auto"},events:{}})}}),this.registerReusableCellContent({id:"graph_reusable_content_id",buildContent:function(){return e.createElement("div",{class:"wux-controls-label",html:"",styles:{},events:{}})}}),this.registerReusableCellContent({id:"dropdown_reusable_content_id",buildContent:function(){return e.createElement("div",{class:"wux-controls-label",html:'<span class="fonticon fonticon-2x fonticon-open-down"></span>',styles:{width:"100%",height:"100%"},events:{}})}}),this.registerReusableCellContent({id:"intent_reusable_content_id",buildContent:function(){return e.createElement("div",{class:"wux-controls-label",html:"",styles:{},events:{}})}}),this.registerReusableCellContent({id:"specification_reusable_content_id",buildContent:function(){return e.createElement("div",{class:"wux-controls-label",html:"",styles:{},events:{}})}})},updateSelectionMode:function(e){var t=this._manager;e||this.prepareUpdateColumns(),void 0!==this.layout.getColumnVisibleState("__DROPDOWN__")&&this.options.columnManager[this._model._SELECTION_MODE&i.SELECTION_MODES.WITH_COMMANDS?"showColumns":"hideColumns"](["__DROPDOWN__"]),this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ONLY?t.options.selection.canMultiSelect=!0:(t.options.selection.canMultiSelect=!1,this._model.getXSO().get().length>1&&this._model.getXSO().empty()),e||this.pushUpdateColumns(),(!(this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ONLY)||!(this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ACTIVE))&&this._treeDoc.getXSO().get().length>1&&this._treeDoc.getXSO().empty()},onSelectListView:function(e){if(this.isUnselecting)this.isUnselecting=!1;else{var t=this.options.versionExplorerController.getDisableSelection(),n=e.data.nodeModel.__MASTER__.getAttribute("__filter__");if(!t&&(!this._model._FILTER_ENABLED||this._model._FILTER_ENABLED&&n)){this._parent(e);var o=this._model.getXSO().get();if(!(this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ACTIVE)&&o.length>1){for(var l=0;l<o.length;l++)o[l].options.grid.__checked__=!0;e.data.nodeModel.__MASTER__._modelEvents.publish({event:"_ENOXVersionExplorerManageMultiSelect",data:!1})}}else!this._model._FILTER_ENABLED||n&&!t||(this.isSelecting=!0,e.data.nodeModel.unselect())}},onUnselectListView:function(e){if(this.isSelecting)this.isSelecting=!1;else{var t=this.options.versionExplorerController.getDisableSelection(),n=e.data.nodeModel.__MASTER__.getAttribute("__filter__");!this._model._FILTER_ENABLED||n&&!t?this._parent(e):(this.isUnselecting=!0,e.data.nodeModel.select())}},onHighlightLink:function(e){var t=this._graph,n=c.bind(this)(e.data);t.withLockedUpdate((function(){n.forEach((function(e){t.addToSelection(e)}))}))},onUnhighlightLink:function(e){var t=this._graph,n=c.bind(this)(e.data);t.withLockedUpdate((function(){n.forEach((function(e){t.removeFromSelection(e)}))}))},_addEventListeners:function(){var e=this;this._parent(),this._addEvent("LISTVIEWMANAGER","preFullUpdateView",(function(t){e._manager.onPostUpdateViewOnce((function(t){e.onUpdateViewComplete.bind(e)(t)}))})),this._addEvent("LISTVIEWMANAGER","showColumn",(function(t){"creationDate"===e._manager.getDataIndexFromColumnID(t.columnID)&&e._manager._setColumnState(t.columnID,"sort:"+(e.options.ascending?"asc":"desc"))})),this._addEvent("LISTVIEWMANAGER","click",(function(t){var n=e._manager.options.columns.find((function(e){return e.dataIndex===t.dataIndex}));n&&"function"==typeof n.cellClickCB&&n.cellClickCB(t)})),e._addEvent("MODEL","highlightLink",e.onHighlightLink.bind(this)),e._addEvent("MODEL","unhighlightLink",e.onUnhighlightLink.bind(this))},onMasterNodeAttributeChanged:function(e){e.data;this._parent(e)},_setActive:function(e){this._manager},_setFilter:function(e){},onUpdateViewComplete:function(e){var t;this._manager;if("attributeChanged"===e.event&&(t=e.data.nodeModel),t&&t.__LISTVIEWCOPY__)this._setActive(t.__LISTVIEWCOPY__),this._setFilter(t.__LISTVIEWCOPY__);else for(var n,o=0,i=this._treeDoc.getAllDescendants(),l=i.length;o<l;o+=1)n=i[o],this._setActive(n),this._setFilter(n)},onSort:function(e){this._parent(e),"creationDate"===e.columnDataIndex&&o._saveUserSettings("subwaySortAscending",this.options.ascending,this._model.useGlobalStorage,this._model.globalStorageName,this._model.webToWinComSocket)},updateNodes:function(){this._parent()},deactivate:function(){this._parent();var e=this._graph;e.withLockedUpdate((function(){for(var t,n=e.edges.first;n;n=t)t=n.next,n.isSelected()&&e.removeFromSelection(n)}))},activate:function(){this._parent(),this._updateGraphSelection()},prepareUpdateView:function(){this._removeEvent("MASTER","select"),this._removeEvent("MASTER","unselect"),this._removeEvent("MASTER","attributeChanged")},pushUpdateView:function(){this._addEvent("MASTER","select",this.onSelectMaster.bind(this)),this._addEvent("MASTER","unselect",this.onUnselectMaster.bind(this)),this._addEvent("MASTER","attributeChanged",this.onMasterNodeAttributeChanged.bind(this))},setRowHeight:function(e){var t=this.options.columnManager.getColumns().findIndex((function(e){return"thumbnail"===e.dataIndex&&!e.isHidden}))>=0?80:e;return this._parent(t),t},_updateGraphSelection:function(){var e=this._model.getHighlightedLinksData(),t=[],n=this._graph;if(e.length)for(var o=0,i=e.length;o<i;o++)t=t.concat(c.bind(this)(e[o]));n.withLockedUpdate((function(){for(var e,o=n.edges.first;o;o=e)e=o.next,o.isSelected()&&n.removeFromSelection(o);t.forEach((function(e){if(e&&e.getGraph()===n)n.addToSelection(e);else;}))}))}})}));