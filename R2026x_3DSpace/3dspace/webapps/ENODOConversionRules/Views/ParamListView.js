define("DS/ENODOConversionRules/Views/ParamListView",["UWA/Class/View","DS/Handlebars/Handlebars","text!DS/ENODOConversionRules/assets/templates/edfm.formatparams.html","DS/ENODerivedFormatEssentials/Utils/DerivedFormatUtil","DS/ENOjquery/ENOjquery","DS/ENO6WPlugins/jQueryUI","DS/Controls/TooltipModel","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/Slider","DS/Controls/LineEditor"],(function(e,a,t,r,n,d,m,i,l,o,s){"use strict";return e.extend({tagName:"div",converter:"",className:"derivedformatparamlistview",setup:function(e){var r=this;r.selection=e.selection,r.paramlist=e.parameters?Object.assign({},e.parameters):{},r.derivedform=e.derivedForm,r.outputStreamId=e.outputStreamId,r.inputStreamId=e.inputStreamId,r.targetIndex=e.selectedIndex-1,r.addButton=null;var n=a.compile(t),d=derivedformatmanagementinfra.getNLSData().label.parameters,m=r.getParameters();r.container.setHTML(n({rows:m||[],labels:derivedformatmanagementinfra.getNLSData().label,title:d}));var i=e.container?e.container:widget.body;r.derivedform&&(r.derivedform.getDocument().getElementById("derivedformatfield-formatparams").innerHTML="",i=r.derivedform.getDocument().getElementById("derivedformatfield-formatparams")),r.container.inject(i),r.populateMandatoryParameters(r,m.mandatoryParam,r.container);var o=document.getElementById("edfm-derivedformatparamview-input-addparams");r.addButton=new l({label:"",domId:"edfm-derivedformatparamview-input-addparams-button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(o),r.addButton.disabled=!0,r.addButton.addEventListener("click",r.paramListAdd.bind(null,r));var s=document.getElementById("edfm-derivedformatparamview-input-paramName");m.hasOwnProperty("rowsParam")&&0==m.rowsParam.length?s.disabled=!0:s.disabled=!1,document.getElementById("edfm-derivedformatparamview-input-paramName").addEventListener("change",r.paramListChange.bind(null,r,m)),document.getElementById("dfm-derivedformatform-parameter-table").addEventListener("click",r.paramListDelete.bind(null,r)),document.getElementById("derivedformatparamview-custominput-inputerror")&&(document.getElementById("derivedformatparamview-custominput-inputerror").style.display="none"),document.getElementById("edfm-derivedformatparamview-param-warning-row")&&(document.getElementById("edfm-derivedformatparamview-param-warning-row").style.display="none"),r.getCellTooltip(document.getElementsByClassName("edfm-derivedformatparamview-param-col-inputkey")),r.getCellTooltip(document.getElementsByClassName("edfm-derivedformatparamview-param-col-inputvalue"))},paramListDelete:function(e,a){var t=document.getElementById("derivedformatfield-converter"),r=document.getElementById("derivedformatfield-connector"),n=document.getElementById("derivedformatfield-source"),d=document.getElementById("derivedformatfield-target");if(a.target.classList.contains("edfm-derivedformatparamview-input-row-delete")){var m=a.target.parentElement.parentElement,i=m.cells[0].firstElementChild.name;if(e.paramlist.hasOwnProperty(i)&&delete e.paramlist[i],m.remove(),t&&r&&n&&d){var l=document.getElementById("edfm-derivedformatparamview-param-warning-row"),o=document.getElementById("edfm-derivedformatparamview-param-warning");("3DEXPERIENCE"===t.value&&"SOLIDWORKS"===r.value&&"SLDPRT"===n.value&&"ExactGeometry"===d.value&&"Polyhedral"===selectedParam.name||"3DEXPERIENCE"===t.value&&"3DEXPERIENCE"===r.value&&"ExactGeometry"===d.value&&"AdditionalFeatures"===selectedParam.name)&&(l.style.display="","Polyhedral"===selectedParam.name?o.innerHTML=derivedformatmanagementinfra.getNLSData().label.polyhedralwarning:"AdditionalFeatures"===selectedParam.name&&(o.innerHTML=derivedformatmanagementinfra.getNLSData().label.genericFeatureWarning))}}},paramListAdd:function(e,a){if(!0!==e.addButton.disabled){var t=document.getElementById("edfm-derivedformatparamview-input-addparams").parentElement.parentElement,r=t.parentElement,n=t.cells[0].firstChild.selectedOptions[0].value,d=(document.getElementById("edfm-derivedformatparamview-param-warning"),document.getElementById("derivedformatfield-converter")),m=document.getElementById("derivedformatfield-connector"),i=document.getElementById("derivedformatfield-source"),l=document.getElementById("derivedformatfield-target");d&&m&&i&&l&&("3DEXPERIENCE"==d.value&&"SOLIDWORKS"==m.value&&"SLDPRT"==i.value&&"ExactGeometry"==l.value&&"Polyhedral"==n||"3DEXPERIENCE"==d.value&&"3DEXPERIENCE"==m.value&&"ExactGeometry"==l.value&&"AdditionalFeatures"==n)&&(document.getElementById("edfm-derivedformatparamview-param-warning-row").style.display="none");var o,s,u=t.cells[0].firstChild.selectedOptions[0].innerHTML;if(t.cells[1].firstChild.id.contains("paramEnumValue")?(o=t.cells[1].firstChild.selectedOptions[0].value,s=t.cells[1].firstChild.selectedOptions[0].innerHTML):("number"===t.cells[1].firstChild.type&&t.cells[1].firstChild.checkValidity()||"text"===t.cells[1].firstChild.type&&e.validateParams(t.cells[1].firstChild.value))&&(o=s=t.cells[1].firstChild.value),n&&o)if(e.paramlist.hasOwnProperty(n)){e.paramlist[n]=o;for(var v=1;v<r.rows.length;v++)r.rows[v].cells[0].childNodes[0].name===n&&(r.rows[v].cells[1].childNodes[0].name=o,r.rows[v].cells[1].childNodes[0].value=s)}else{e.paramlist[n]=o;var f=r.insertRow(1),p=f.insertCell(0),c=f.insertCell(1),g=f.insertCell(2);p.width="45%",c.width="45%",g.width="10%";var y=UWA.createElement("input",{class:"edfm-derivedformatparamview-param-col-inputkey",type:"text",disabled:!0,value:u,name:n}).inject(p),E=UWA.createElement("input",{class:"edfm-derivedformatparamview-param-col-inputvalue",type:"text",disabled:!0,value:s,name:o}).inject(c);g.innerHTML='<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-trash edfm-derivedformatparamview-input-row-delete" style="font-size: 18px; cursor: pointer !important;"></span>',e.getCellTooltip([y,E])}t.cells[0].firstChild.options[0].selected=!0,t.cells[1].firstChild.remove();var I=UWA.createElement("select",{class:"form-control edfm-derivedformatparamview-input",id:"edfm-derivedformatparamview-input-paramEnumValue",disabled:!0}).inject(t.cells[1]);e.populateParameters(I,[{displayValue:derivedformatmanagementinfra.getNLSData().label.selectValue,value:"",selected:!0,disabled:!0}]),e.addButton.disabled=!0}},paramListChange:function(e,a,t){var r=document.getElementById("edfm-derivedformatparamview-input-paramName");if(r){var n=r.selectedOptions[0].value,d=a.rowsParam.find((function(e,a){return e.name==n})),m=document.getElementById("edfm-derivedformatparamview-input-paramValue-col");if(m.removeChild(m.firstChild),d&&"enum"===d.typeValue){UWA.createElement("select",{class:"form-control edfm-derivedformatparamview-input",id:"edfm-derivedformatparamview-input-paramEnumValue"}).inject(m);var i=document.getElementById("edfm-derivedformatparamview-input-paramEnumValue");e.populateParameters(i,d.options);var l=document.getElementById("derivedformatfield-converter"),o=document.getElementById("derivedformatfield-connector"),s=document.getElementById("derivedformatfield-source"),u=document.getElementById("derivedformatfield-target");if(l&&o&&s&&u){var v=document.getElementById("edfm-derivedformatparamview-param-warning-row"),f=document.getElementById("edfm-derivedformatparamview-param-warning");("3DEXPERIENCE"===l.value&&"SOLIDWORKS"===o.value&&"SLDPRT"===s.value&&"ExactGeometry"===u.value&&"Polyhedral"===d.name||"3DEXPERIENCE"===l.value&&"3DEXPERIENCE"===o.value&&"ExactGeometry"===u.value&&"AdditionalFeatures"===d.name)&&(v.style.display="","Polyhedral"===d.name?f.innerHTML=derivedformatmanagementinfra.getNLSData().label.polyhedralwarning:"AdditionalFeatures"===d.name&&(f.innerHTML=derivedformatmanagementinfra.getNLSData().label.genericFeatureWarning))}}else if(document.getElementById("edfm-derivedformatparamview-input-paramEnumValue")&&document.getElementById("edfm-derivedformatparamview-input-paramEnumValue").remove(),"integer"===d.typeValue||"real"===d.typeValue){var p="integer"===d.typeValue?1:.01,c=d.rangeValue.split("|"),g=c[0].NaN?"":c[0],y=c[1].NaN?"":c[1];UWA.createElement("input",{type:"number",value:d.defaultValue,step:p,min:g,max:y,class:"form-control edfm-derivedformatparamview-input"}).inject(m)}else"text"===d.typeValue&&UWA.createElement("input",{type:"text",value:d.defaultValue,class:"form-control edfm-derivedformatparamview-input"}).inject(m);e.addButton.disabled=!1}},getData:function(){return this.paramlist},onMandatoryParameterChange:function(e,a,t){a.length>0&&t.length>0&&(e.paramlist.hasOwnProperty(a),e.paramlist[a]=t,e.updateAliasOnMandChange(e))},updateAliasOnMandChange:function(e){var a=document.getElementById("derivedformatfield-converter").selectedOptions[0]?document.getElementById("derivedformatfield-converter").selectedOptions[0].value:"",t=document.getElementById("derivedformatfield-connector").selectedOptions[0]?document.getElementById("derivedformatfield-connector").selectedOptions[0].value:"",n=document.getElementById("derivedformatfield-source").selectedOptions[0]?document.getElementById("derivedformatfield-source").selectedOptions[0].value:"",d=document.getElementById("derivedformatfield-target").selectedOptions[0]?document.getElementById("derivedformatfield-target").selectedOptions[0].value:"",m=e.outputStreamId?e.outputStreamId:"*",i={data:{converter:a,category:t,source:n,target:d,inputStreamId:e.inputStreamId?e.inputStreamId:"authoring",outputStreamId:m,parameters:e.paramlist},url:"/resources/v1/modeler/conversionAdmin/derivedformatmanagement/getconversiondetails",method:"POST",onComplete:function(e){var a=UWA.is(e,"string")?JSON.parse(e):e;if(a.hasOwnProperty("outputStreamId")){var t=a.outputStreamId;document.getElementById("derivedformatfield-outputStreamId").value=t}},onFailure:function(e){console.log(e)}};r.sendServerRequest(i)},populateMandatoryParameters:function(e,a,t){for(var r=document.getElementsByClassName("edfm-derivedformatparamview-mandatoryparam"),n=0;n<r.length;n++){var d=r[n].firstElementChild.firstElementChild.name,m=r[n].children[1];e.parameterValueCreation(e,a,d,m)}},parameterValueCreation:function(e,a,t,r){if(t){var n=a.find((function(e,a){return e.name==t}));if(r.removeChild(r.firstElementChild),n&&"enum"===n.typeValue){for(var d=null,m=[],l=0;l<n.options.length;l++){var u=n.options[l],v={value:u.value,label:u.displayValue};!0===u.selected&&(d=u.value),m.push(v)}n.hasOwnProperty("value")&&(d=n.value),e.onMandatoryParameterChange(e,t,d);var f=new i({elementsList:m,value:d,selectedIndex:0});f.inject(r),f.addEventListener("change",(function(a){e.onMandatoryParameterChange(e,t,f.value)}))}else if(document.getElementById("edfm-derivedformatparamview-input-paramEnumValue")&&document.getElementById("edfm-derivedformatparamview-input-paramEnumValue").remove(),"integer"===n.typeValue||"real"===n.typeValue){var p="integer"===n.typeValue?1:.01,c=n.rangeValue.split("|"),g=c[0].NaN?"":c[0],y=c[1].NaN?"":c[1],E=new o({value:n.defaultValue,minValue:g,maxValue:y,stepValue:p});E.inject(r),E.addEventListener("change",(function(a){e.onMandatoryParameterChange(e,inputParamName,a.dsModel.value)}))}else if("text"===n.typeValue){var I=new s({placeholder:"PlaceHolder",value:n.defaultValue});I.inject(r),I.addEventListener("change",(function(a){I.value.length>=0&&e.onMandatoryParameterChange(e,inputParamName,I.value)}))}}},getParameters:function(){var e={},a=new Array,t=new Array,r=new Array,n=this,d=derivedformatmanagementinfra.getInfraCollection();if(document.getElementById("derivedformatfield-converter")&&document.getElementById("derivedformatfield-connector")&&document.getElementById("derivedformatfield-source")&&document.getElementById("derivedformatfield-target")){var m=document.getElementById("derivedformatfield-converter").selectedOptions[0]?document.getElementById("derivedformatfield-converter").selectedOptions[0].value:"";n.converter=m;var i=document.getElementById("derivedformatfield-connector").selectedOptions[0]?document.getElementById("derivedformatfield-connector").selectedOptions[0].value:"",l=document.getElementById("derivedformatfield-source").selectedOptions[0]?document.getElementById("derivedformatfield-source").selectedOptions[0].value:"",o=document.getElementById("derivedformatfield-target").selectedOptions[0]?document.getElementById("derivedformatfield-target").selectedOptions[0].value:"",s=d.find((function(e,a){return e.get("name")==m}));if(s){var u=s.get("connectors").find((function(e,a){return e.name==i}));if(u){var v=u.supportedformats.find((function(e,a){return e.source.name==l}));if(v){var f=v.targets.filter((function(e,a){return e.target==o}));if(n.targetIndex)var p=v.targets[n.targetIndex].parameters;if(f&&f.length>1&&p)for(var c=0;c<f.length;c++){var g=f[c];if(g.parameters)for(var y=0;y<g.parameters.length;y++){var E=g.parameters[y].values?g.parameters[y].values.split("|"):[],I=new Array,w=g.parameters[y].default?g.parameters[y].default:E[0],h=!!g.parameters[y].mandatory&&g.parameters[y].mandatory;for(var B in E)I.push({value:E[B],selected:w==E[B],displayValue:derivedformatmanagementinfra.getNLSData()[n.converter].parameter[E[B]]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[E[B]]:E[B]});var N={name:g.parameters[y].name,displayName:derivedformatmanagementinfra.getNLSData()[n.converter].parameter[g.parameters[y].name]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[g.parameters[y].name]:g.parameters[y].name,options:I,typeValue:g.parameters[y].type,defaultValue:g.parameters[y].default,rangeValue:g.parameters[y].range};!1===h?t.push(N):(N.value=g.parameters[y].default,N.displayValue=derivedformatmanagementinfra.getNLSData()[n.converter].parameter[N.value]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[N.value]:N.value,r.push(N))}}else if(f&&f[0].parameters)for(y=0;y<f[0].parameters.length;y++){E=f[0].parameters[y].values?f[0].parameters[y].values.split("|"):[],I=new Array,w=f[0].parameters[y].default?f[0].parameters[y].default:E[0],h=!!f[0].parameters[y].mandatory&&f[0].parameters[y].mandatory;for(var B in E)I.push({value:E[B],selected:w==E[B],displayValue:derivedformatmanagementinfra.getNLSData()[n.converter].parameter[E[B]]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[E[B]]:E[B]});N={name:f[0].parameters[y].name,displayName:derivedformatmanagementinfra.getNLSData()[n.converter].parameter[f[0].parameters[y].name]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[f[0].parameters[y].name]:f[0].parameters[y].name,options:I,typeValue:f[0].parameters[y].type,defaultValue:f[0].parameters[y].default,rangeValue:f[0].parameters[y].range};!1===h?t.push(N):(N.value=f[0].parameters[y].default,N.displayValue=derivedformatmanagementinfra.getNLSData()[n.converter].parameter[N.value]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[N.value]:N.value,r.push(N))}}}}if(n.selection){var S=n.selection.get("parameters");for(var D in S){void 0===(h=r.find((function(e,a){if(e.name===D)return e.displayValue=derivedformatmanagementinfra.getNLSData()[n.converter].parameter[S[D]]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[S[D]]:S[D],e.value=S[D],!0})))&&a.push({name:D,displayName:derivedformatmanagementinfra.getNLSData()[n.converter].parameter[D]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[D]:D,value:S[D],displayValue:derivedformatmanagementinfra.getNLSData()[n.converter].parameter[S[D]]?derivedformatmanagementinfra.getNLSData()[n.converter].parameter[S[D]]:S[D]})}}}return e.rowsParam=t,e.deployedParam=a,e.mandatoryParam=r,e},validateParams:function(e){return!e.contains(",")&&!e.contains("|")},populateParameters:function(e,a){for(var t in a){var r=new Option(a[t].displayValue,a[t].value);a[t].selected&&(r.selected=!0),a[t].disabled&&(r.disabled=!0),e.add(r)}},getCellTooltip:function(e){if(e&&e.length>0)for(var a=0;a<e.length;a++){var t=e[a];(t.className.contains("inputkey")&&t.offsetWidth/t.value.length<7.5||t.className.contains("inputvalue")&&t.offsetWidth/t.value.length<6.6)&&(t.tooltipInfos=new m({shortHelp:t.value}))}}})}));