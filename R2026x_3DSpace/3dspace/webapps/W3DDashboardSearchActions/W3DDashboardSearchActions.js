define("DS/W3DDashboardSearchActions/Utils",["UWA/Utils"],(function(e){"use strict";function a(e){return e.replace(/\/$/,"")}function r(e){return e.replace(/^https?:\/\//,"")}var t,o={getServiceUrl:(t={},function(e){return new Promise((function(a,r){t[e]?a(t[e]):require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(o){o.getServiceUrl({serviceName:e,onComplete:function(r){a(t[e]=r)},onFailure:function(e){r(e)}})}))}))}),navigateTo:function(t){var n=t.dashboardModelId,i=t.tabId,s=t.tabName&&e.encodeUrl(t.tabName),c=t.manageDashboardModelId,d=t.manageDashboardFacet,l=t.platformId;if(!l)throw new Error("Missing platform id.");return o.getServiceUrl("3DDashboard").then((function(e){var t;if(!e||0===e.length)throw new Error("No platform available for 3DDashboard service.");if(!(t=(e.find((function(e){return(e.platformId||"").toLowerCase()===(l||"").toLowerCase()}))||{}).url))throw new Error("3DDashboard URL could not be retrieved for platform: "+l);window.dsBaseUrl&&r(a(window.dsBaseUrl)).indexOf(r(a(t)).replace(/^euw?1/,""))>-1&&!/addinmode/.test(window.location.search)?require(["DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/ManageDashboardManager","DS/TransientWidget/TransientWidget","DS/TopFrame/TopFrame"],(function(e,a,r,t,o){t.isWidgetOpen()?t.closeWidget():o.closePanel("right"),setTimeout((function(){n&&a.routeTo({dashboard:n,tabId:i,keepAll:!0,discards:a.parts.tab}),i&&e._setActiveTab(i),(c||d)&&r.open({contextModelId:c||n,facet:d})}))})):window.open(t+"#dashboard:"+(n||c)+(s?"/tab:"+s:"")+(d?"/manage:"+d:""))}))},removeNamespace:function(e){return e.replace(/^.+?:/,"")}};return o})),define("DS/W3DDashboardSearchActions/views/Preview",["UWA/Core","DS/W3DDashboardSearchActions/Utils","DS/SNInfraUX/SearchPreviewContainer","DS/Handlebars/Handlebars4","i18n!DS/W3DDashboardSearchActions/assets/nls/main","css!DS/W3DDashboardSearchActions/views/preview"],(function(e,a,r,t,o){"use strict";var n={primaryContent:t.compile('{{#if description}}<div class="description"><p>{{description}}</p></div>{{/if}}<ul>    {{#each children}}<li class="{{#if dummy}}dummy{{/if}}">        <a class="tab-name" data-tab-id="{{w_id}}">{{name}}</a>        <ul>            {{#each children}}<li>{{name}}</li>{{/each}}        </ul>    </li>{{/each}}</ul>')};function i(e,a,r){var t;return t=e.map((function(e){return e.w_id})),r||(r=e.map((function(e){if(-1===t.indexOf(e.p_id))return e.p_id})).filter((function(e){return!!e}))[0]),e.filter((function(e){return e.p_id===r})).map((function(r){return{p_id:r.p_id,w_id:r.w_id,name:r.name,children:i(e,a,r.w_id)}})).sort(a)}function s(e,a,r){for(e=e.slice(0);e.length%a!=0;)e.push(r);return e}return r.extend({getPrimaryContent:function(r){if(r&&r.onComplete){var t,c,d,l=[],m=r.searchmodel;try{l=JSON.parse(m.get("ds6w:tabs_value"))}catch(e){return d="Context's tabs could not be retrieved from search result.",console.error(d,e),r.onFailure(d)}if(!(c=m.get("ds6w:dashboard_platform"))){var u=m.get("sourceid")||"";c=a.removeNamespace(u)}c||(d="Missing platform id from search result.",console.error(d)),r.onCusto({layout:"horizontal"}),t=e.createElement("div",{class:"ifwe-search-primary",html:n.primaryContent({dashboardTabsNLS:o.dashboardTabs,description:m.get("ds6w:description_value"),children:s(i(l,(function(e,a){return e.name<a.name?-1:e.name>a.name?1:0})),6,{name:"",children:[],dummy:!0})})}),[].forEach.call(t.querySelectorAll(".tab-name"),(function(e){c?e.addEventListener("click",(function(){var t=e.getAttribute("data-tab-id"),o=l.filter((function(e){return e.w_id===t}))[0];a.navigateTo({platformId:c,dashboardModelId:a.removeNamespace(r.searchmodel.id),tabId:o.w_id,tabName:o.name})})):e.classList.add("disable-link")})),r.onComplete(t)}},getSecondaryContent:function(e){if(e&&e.onComplete){var a={type:{predicate:"type",value:o.typeValue},title:{predicate:"label"},creationDate:{predicate:"created"},modificationDate:{predicate:"modified"},responsible:{predicate:"responsible"}};e.onFailure(Object.keys(a).map((function(r){var t=a[r],n="ds6w:"+t.predicate,i=t.value||e.searchmodel.get(n);return i&&{id:n,title:o[r],value:i}})).filter((function(e){return!!e})))}}})})),define("DS/W3DDashboardSearchActions/3DDashboard",["DS/W3DDashboardSearchActions/Utils","i18n!DS/W3DDashboardSearchActions/assets/nls/main"],(function(e,a){"use strict";return{getFacets:function(r){var t,o,n,i=r.model,s=e.removeNamespace(i.get("sourceid")),c=[];try{c=JSON.parse(i.get("ds6w:members_value"))}catch(e){}n=c.length>1,t=["properties"],o=[{text:a.propertiesFacet,name:"properties",icon:"doc-log",expandedFlag:!0}],n&&(t.push({require:"DS/W3DDashboardSearchActions/views/Members",facet:{text:a.membersFacet,name:"members",icon:"users"},options:{members:c,source:s,dashboardModelId:e.removeNamespace(i.id),dashPlatformId:i.get("ds6w:dashboard_platform")||e.removeNamespace(i.get("sourceid"))}}),o.push({name:"members",expandedFlag:!0})),r.setFacets(t,o)},getActions:function(e){var r,t={actions:[],status:"success"};if(!e||!e.onComplete)throw new Error("Unexpected argument format");return e.models&&1===e.models.length?(r=e.models[0],t.actions.push({id:r.get("id"),actions:[{title:a.goToDashboard,icon:"login",id:"goToDashboard",multisel:!1,sourcejs:"DS/W3DDashboardSearchActions/3DDashboard"}]}),e.onComplete(t)):(t.status="failure",e.onComplete(t))},executeAction:function(a){var r=e.removeNamespace(a.object_id||a.object_ids[0]||"");if(!r)throw new Error("Expected dashboard model id to execute search action.");var t=a.actionsHelper.getModel({id:r});return e.navigateTo({platformId:t.get("ds6w:dashboard_platform")||e.removeNamespace(t.get("sourceid")),dashboardModelId:r})},getDoubleClickAction:function(e){e&&e.onComplete&&e.onComplete({sourceJS:"DS/W3DDashboardSearchActions/3DDashboard",id:"open"})},getRenderPreview:function(e){e&&e.onComplete&&require(["DS/W3DDashboardSearchActions/views/Preview"],(function(a){e.onComplete(new a)}))}}})),define("DS/W3DDashboardSearchActions/views/Members",["UWA/Core","DS/W3DDashboardSearchActions/Utils","DS/EditPropWidget/facets/Common/FacetsBase","DS/Handlebars/Handlebars","DS/UIKIT/Tooltip","i18n!DS/W3DDashboardSearchActions/assets/nls/main","css!DS/W3DDashboardSearchActions/views/members"],(function(e,a,r,t,o,n){"use strict";var i={content:t.compile('<ul>{{#each members}}    <li class="member-profile">    {{#if isUser}}        <img src="{{avatar}}" alt="{{name}}" data-name="{{name}}" />    {{else}}        <div class="fonticon fonticon-users-group" data-name="{{name}}"></div>    {{/if}}    </li>{{/each}}</ul>')};return r.extend({init:function(r){var t;this._parent.apply(this,arguments),this.elements.container||(t=this.elements.container=e.createElement("div",{class:"ifwe-search-members"})),a.getServiceUrl("3DSwym").then((function(s){var c=(s.filter((function(e){return e.platformId===r.source}))[0]||s[0]).url;e.createElement("div",{html:i.content({members:r.members.map((function(e){var a="user"===e.member_type;return{isUser:a,name:a?e.first_name+" "+e.last_name:e.name,avatar:c+"/api/user/getpicture/login/"+e.login+"/format/normal"}}))})}).inject(t),[].forEach.call(t.querySelectorAll(".member-profile > *"),(function(e){new o({position:"top",target:e,body:e.getAttribute("data-name")}),e.addEventListener("click",(function(){a.navigateTo({platformId:r.dashPlatformId,manageDashboardModelId:r.dashboardModelId,manageDashboardFacet:n.membersFacet})}))}))}))}})}));