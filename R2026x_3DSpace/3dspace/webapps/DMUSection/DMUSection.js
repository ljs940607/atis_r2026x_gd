define("DS/DMUSection/DMUSectionContextCmd",["DS/CATWebUXComponents/DMUCommand"],(function(e){"use strict";return e.extend({init:function(e){var t=e||{};this._parent(t)}})})),define("DS/DMUSection/DMUClippingPrecisePosCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUToolsClipping","DS/Visualization/PathElement","DS/DMUMeasurable/DMUSectionPosService","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUSwitchRepService","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUPlaySection/DMUSectionPosPreVisuNode3D","DS/DMUPlaySection/DMUClippingService","DS/Visualization/ThreeJS_DS","DS/Mesh/Mesh","DS/Visualization/Node3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","i18n!DS/DMUSection/assets/nls/DMUSection"],(function(e,t,i,n,o,a,l,r,s,c,p,d,u,g,h,m,S,f,v,C){"use strict";return e.extend({init:function(e){this._parent(e,"shared",!0),!this._id&&e.ID&&(this._id=e.ID),this.executionContext&&(this._isRunning=!1),"DMUSectionPreSelectPrecisePosHdr"===e.ID&&(this.objectAction=!0),this._keepDefaultController=!0;var t=this;t._destroy=function(){t._dlgBar&&(t._dlgBar.destroy(),t._dlgBar=null),Object.getPrototypeOf(t)._destroy.apply(t,arguments)}},_initPref:function(){},allowManipulation:function(e){return"Measure"===e.object||"Section"===e.object||void 0},setButtonEnableFlag:function(e){var t=document.getElementsByClassName("DMUSectionPosCommand"),i=e.btnId,n=e.enableFlag,o=null;"Ok"===i?o=t[0].getElementsByClassName("btn-primary"):"Cancel"===i&&(o=t[0].getElementsByClassName("btn-default")),o&&o[0]&&(!0===n?o[0].disabled=!1:!1===n&&(o[0].disabled=!0))},setText:function(e){var t=document.getElementsByClassName("DMUSectionPosCommand"),i=null;t&&t.length&&t[0].getElementsByClassName&&(i=t[0].getElementsByClassName("msg"))&&i[0]&&i[0].textContent&&e&&(i[0].textContent=e)},_beginExecute:function(){var e=this;this.executionContext&&(this._isRunning=!0);let i=e.getFrameWindow().getViewer();e.isFinalStateExecuted=void 0;var n=o.getContextViewer({viewer:i});if(n.getController&&(e._viewerController=n.getController()),e.section=e.sectionForObjectAction,!e.section){var l=t.get();if(1===l.length&&e.getFrameWindow){var r=o.getReviewContext({viewer:i});r&&(e.section=r.getDMUObjectFromPathElement(l[0].pathElement))}}if(!e.section){var s=h.retriveClippingObjsFromSlide(i);s&&s.length&&(e.section=s[0])}t.empty(),e.section&&(e.section._posCmdActive=!0,e.section._lastPoshdr=e._id,h.deActivateClipping([e.section],this._viewer,!0)),e.objListObjectAction=e.section.csoList,e.objListObjectAction&&e.objListObjectAction.length&&(e.objectAction||(e.objectAction=!0),e.objListObjectAction.forEach((function(e){t.add(e)})));var c="primHybrid";e._pathElementAgentWithCSO=new a({agentId:"_pathElementAgentWithCSO",viewer:e._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:c,prePickingMode:c,valuedFromCSO:!0,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:e,checkAppli:e._checkPicking,displayAppli:e._previsualize,switchRepOnPreSelection:true,viewerController:e._viewerController,timeoutDurationForRepLoading:1e3}),e._pathElementAgentWithoutCSO=new a({agentId:"_pathElementAgentWithoutCSO",viewer:e._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:c,prePickingMode:c,valuedFromCSO:!1,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:e,checkAppli:e._checkPicking,displayAppli:e._previsualize,switchRepOnPreSelection:true,viewerController:e._viewerController,timeoutDurationForRepLoading:1e3}),e._measurable=[],e._selectedObject=[],e._parent()},pauseExecute:function(){this.section&&(this.section._posCmdActive=!1),this._pathElementAgentWithCSO.deactivate(),this._pathElementAgentWithoutCSO.deactivate(),this._dlgBar.hide(),this._preVisuNode&&this._removePreVisuNode(),this.highlightNode&&this.highlightNode.setVisibility(!this._viewer.getVisibleSpace()),this.executionContext&&(this._isRunning=!1),this.done()},resumeExecute:function(){this.section&&(this.section._posCmdActive=!0),this._pathElementAgentWithCSO.activate(),this._pathElementAgentWithoutCSO.activate(),this._dlgBar.show(),this.highlightNode&&this.highlightNode.setVisibility(this._viewer.getVisibleSpace()),this.executionContext&&(this._isRunning=!0)},cancelExecute:function(){if(this._parent(),this.executionContext&&(this._isRunning=!1),this._pathElementAgentWithCSO.deactivate(),this._pathElementAgentWithoutCSO.deactivate(),this._pathElementAgentWithCSO=null,this._pathElementAgentWithoutCSO=null,this.sectionForObjectAction=void 0,this.objListObjectAction=void 0,this.OnlyPlaneTreated=void 0,this.objectAction=void 0,this._removePreVisuNode(),this._removehiglightVisuNode(),this._dlgBar&&this._dlgBar.destroy(),this.section)if(this.section.csoList=void 0,this.section._posCmdActive=void 0,this.cancelObjActionCmd){this.cancelObjActionCmd=void 0;var e=this.section;e.getParent().removeDMUObjects?e.getParent().removeDMUObjects([e]):e.getParent().getCurrentSlide().removeDMUObject(e)}else h.activateClipping([this.section],this._viewer),this.section.addOrRemoveFromCSO(!0);this._PlanePos=void 0,this.section=null,this.restoreDefaultController()},getPlanePos:function(){return this._PlanePos},computePlanePos:function(e){var t=this,i=t._viewer;t.OnlyPlaneTreated=void 0,t._bBox=void 0;var n,a=e&&e.inProgressSelList&&e.inProgressSelList.length?e.inProgressSelList:t._selectedObject,s=p.getViewpointInfo(i.currentViewpoint),d=e&&e.inProgressMeasurableList&&e.inProgressMeasurableList.length?e.inProgressMeasurableList:void 0;t._bBox=r.computeBoundingBox(t._viewer,void 0,(function(){return t.section&&"DMUTemporaryBag"!==t.section.getParent().getType()}),(function(){return o.getContextViewer({viewer:t._viewer})}));var u=function(){var e;if(t._bBox&&t._bBox.center)e=t._bBox.center();else{var i=r.computeBoundingSphere(t._viewer);i&&i.center&&(e=i.center)}return e},g=function(e){return!!t._bBox&&t._bBox.containsPoint(e)};if(a&&a.length){var h,m="",S=a.length;if(n=void 0,1===S){var f=d?d[0]:void 0,v=a[0];m="SingleSel",n=c.sectionPosMap[m].getPos({selectedObject:v,measurable:f||(t._measurable&&t._measurable.length?t._measurable[0]:void 0),info:s,viewer:i,boxCenterCB:u,isInBox:g})}else{var C,P=[],b=[],D=[],_=-1;for(h=0;h<S;h++){var M=a[h].pathElement,x=l.isOOCTileSetNodeInPath(M),U=M.getLastElement().sgNode;if(M&&(U||x)){var y=d?d[h]:t._measurable&&t._measurable.length&&t._measurable[h]?t._measurable[h]:c.getMeasurable({primitive:M.getLastElement().sgNode,pathElement:M,position:a[h].position,normal:a[h].normal,isOOCTileSetNodeInPath:x});if(P.push(y),b.push(a[h].pathElement),D.push(a[h]),m+=c.getSelMapName(y.getType()),(C=c.sectionPosMap[m])&&C.getPos){_=h+1;break}}}if(-1!==_){var w=C.getPos({measurables:P,selectedObjectList:D,info:s,boxCenterCB:u,isInBox:g,objectAction:t.objectAction?t.objectAction:void 0});w&&w.planeDef&&(t.OnlyPlaneTreated=w.treatOnlyPlane,n=w.planeDef)}}}return t._PlanePos=n,n},computeAndUpdatePlanePos:function(){var e=this;if(this.computePlanePos(),this._PlanePos&&this.section){if(!this._bBox){this._bBox=r.computeBoundingBox(e._viewer,void 0,(function(){return e.section&&"DMUTemporaryBag"!==e.section.getParent().getType()}),(function(){return o.getContextViewer({viewer:e._viewer})}))}var t=this.section.getAttribute("sPlaneBoxMode"),i=this._PlanePos;if("BoxMode"!==t){var n=c.computePlaneDim(this._bBox,i,this.modifyOrigin);n&&(n.fPlaneSizeV&&n.fPlaneSizeU&&(this.section.setAttribute("fYDirSize",n.fPlaneSizeV),this.section.setAttribute("fXDirSize",n.fPlaneSizeU),this.section.setAttribute("fYDirGridStep",n.fPlaneSizeV/20),this.section.setAttribute("fXDirGridStep",n.fPlaneSizeU/20)),n.plane&&(this._PlanePos=n.plane))}var a,l=this.section.getAttribute("fSliceOffset");if(!isNaN(l)&&("BoxMode"===t||"SliceMode"===t)){var s=this._PlanePos.decompose(),p=new m.Vector3(0,0,1).applyQuaternion(s[1]);p.negate(),p=p.normalize().multiplyScalar(l/2),a=(a=(new m.Vector3).getPositionFromMatrix(this._PlanePos)).add(p)}a&&this._PlanePos.setPosition(a),this.section.setAttribute("mPlaneReferential",this._PlanePos)}},buildGraph:function(){var e=this;function o(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)}function a(){e.highlightNode=new f,e.highlightNode.setNoZ(!0),e.highlightNode.setPickable(S.PICKTHROUGH),e._viewer&&(l.getSceneRoot(e._viewer).add(e.highlightNode),e._viewer.render())}function r(t){if(t){var i,n=new s,o=[];i=t.getPathElement();var a=t.getPrimitive();if(a)for(var l=THREEDS.SubElement.getFromSGNode(a);null!==l;)o.unshift(l),l=l.getParent();n.setFromArray(i.externalPath,o),e.addInHSO({path:n},!0)}}function p(t){if(t){var i,n=t.getType();switch(c.getSelMapName(n)){case"Point":case"Line":n===u.GeometryType.SPHERE?(!function(t){if(t){var i=t.getType();e.highlightNode||a(),e._preVisuNode||(e._preVisuNode=new g(e._viewer));var n=i===u.GeometryType.SPHERE?t.getCenter():t.getSelPoint();o(e.highlightNode,e._preVisuNode.getPointNode(n))}}(t),e.highlightNode&&(i={pathElement:l.buildPathElement(e.highlightNode)},e.addInHSO({path:i.pathElement},!0))):r(t);break;case"Axis":!function(t){t&&(e.highlightNode||a(),e._preVisuNode||(e._preVisuNode=new g(e._viewer)),o(e.highlightNode,e._preVisuNode.getAxisNode(t)))}(t),e.highlightNode&&(i={pathElement:l.buildPathElement(e.highlightNode)},e.addInHSO({path:i.pathElement},!0));break;default:return}e.highlightNode&&(e.highlightNode.setVisibility(e._viewer.getVisibleSpace()),e._viewer.render())}}e.changeDefaultController(),e._beginExecute(),e._dlgBar&&(e._dlgBar.removeAll(),e._dlgBar.destroy()),e._dlgBar=new n({className:"DMUSectionPosCommand"}).inject(e.getFrameWindow().getUIFrame()),e._dlgBar.add({msgType:"primary",message:C.firstSelection,closable:!1,buttons:[{className:"primary",label:C.ok,onClick:function(){e.publish({event:"DMUSectionPosCmdValidated"})}},{className:"default",label:C.cancel,onClick:function(){e.publish({event:"DMUSectionPosCmdCancelled"})}}]});var d=e.createInitialState("initialState");e.setEnterStateAction(d,(function(){e._dlgBar.show(),e.getFrameWindow().getViewer().render(),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!1})}));var h=e.getFinalState(),m=e.createState("firstSelDoneState"),v=e.createState("secondSelDoneState"),P=e.createState("thirdSelDoneState"),b=function(n){"DMUSectionPreSelectPrecisePosHdr"===e.options.ID?e.cancelObjActionCmd=!0:e.cancelObjActionCmd=!1,e.isFinalStateExecuted=!0,e._removePreVisuNode(),e._removehiglightVisuNode(),t.empty(),i.empty(),e._PlanePos=void 0,e.cancel(),n()},D=function(t){e.isFinalStateExecuted=!0;var i=e.OnlyPlaneTreated;e._removePreVisuNode(),e._removehiglightVisuNode(),e.computeAndUpdatePlanePos(),e.cancel(),t(),e._measurable&&e._measurable.length&&e._measurable.forEach((function(e){i&&e.getType()!==u.GeometryType.PLANE||r(e)})),e.OnlyPlaneTreated=void 0,e._PlanePos=void 0};function _(){p(e._measurable[0]),e.setText(C.secondSelection),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!0})}function M(){if(e.modifyOrigin=!0,e._measurable&&e._measurable.length){var t=e._measurable[0].getType();t!==u.GeometryType.POINT&&t!==u.GeometryType.LINE||(e.modifyOrigin=!1),t===u.GeometryType.PLANE||t===u.GeometryType.SURFACE||t===u.GeometryType.CURVE||t===u.GeometryType.CIRCLE||e.objectActionValidSelDone?((t===u.GeometryType.CIRCLE||e.objectActionValidSelDone&&e._selectedObject&&e._selectedObject.length>1)&&(e.modifyOrigin=!1),e.publish({event:"DMUSectionPosCmdValidated"})):_()}}function x(){e.modifyOrigin=!1,e.goForthirdSel?(e.setText(C.thirdSelection),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!1}),e._measurable&&e._measurable.length>1&&(p(e._measurable[0]),p(e._measurable[1])),e.goForthirdSel=!1):e.publish({event:"DMUSectionPosCmdValidated"})}function U(e){for(var t=0;t<e.length;t++)if(e[t].getType()===u.GeometryType.PLANE)return{index:t}}e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:d,iFinalState:h,iAction:b}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:m,iFinalState:h,iAction:b}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:v,iFinalState:h,iAction:b}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:P,iFinalState:h,iAction:b}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:m,iFinalState:h,iAction:D}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:v,iFinalState:h,iAction:D}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:P,iFinalState:h,iAction:D}),e.addTransition({iSender:e,iEvent:"GoToSecondSelDoneState",iInitialState:m,iFinalState:v,iAction:function(t){t(),e._measurable&&e._measurable.length>1&&(p(e._measurable[0]),p(e._measurable[1]))}}),document.addEventListener("keydown",(function(t){if(t&&("Enter"===t.key||13===t.keyCode)&&!1===t.ctrlKey&&!1===t.altKey&&!1===t.shiftKey&&!1===t.metaKey){var i=document.getElementsByClassName("DMUSectionPosCommand");if(i&&i.length){var n;(n=i[0].getElementsByClassName("btn-primary"))&&n[0]&&!1===n[0].disabled&&e.publish({event:"DMUSectionPosCmdValidated"})}}})),e.addTransition({iEvent:e._pathElementAgentWithCSO,iInitialState:d,iFinalState:m,iCondition:function(n){e.onlyOneInSelList=!1,e.goForthirdSel=!1,e.objectActionValidSelDone=!1;var o=!1;if(e._measurable=[],e._selectedObject=[],e.objectAction&&(t.empty(),i.empty()),e.objectAction&&1!==n.length){var a=[],l=[];if(n.forEach((function(e){var t=c.getMeasurable(e);t&&(l.push(t),a.push(e))})),2===a.length)o=!0,function(t,i){if(!(!t||!i||t.length<2||i.length<2)){var n=t[0].getType(),o=t[1].getType(),a=e._checkfor2PointSel(n,o);if(a||e.computePlanePos({inProgressSelList:i,inProgressMeasurableList:t}))t&&t.forEach((function(t){e._measurable.push(t)})),i.forEach((function(t){e._selectedObject.push(t)})),a?(p(t[0]),p(t[1]),e.goForthirdSel=!0):e.objectActionValidSelDone=!0;else{var l=U(t);l&&void 0!==l.index?(e._measurable.push(t[l.index]),e._selectedObject.push(i[l.index]),p(t[l.index]),e.objectActionValidSelDone=!0):(e._measurable.push(t[0]),e._selectedObject.push(i[0]),p(t[0]))}}}(l,a);else if(3===a.length)o=!0,function(t,i){if(!(!t||!i||t.length<3||i.length<3))if(e.modifyOrigin=!1,e.computePlanePos({inProgressSelList:i,inProgressMeasurableList:t}))t&&t.forEach((function(t){e._measurable.push(t)})),i.forEach((function(t){e._selectedObject.push(t)})),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[0],i[1]],inProgressMeasurableList:[t[0],t[1]]}))e._measurable.push(t[0]),e._measurable.push(t[1]),e._selectedObject.push(i[0]),e._selectedObject.push(i[1]),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[0],i[2]],inProgressMeasurableList:[t[0],t[2]]}))e._measurable.push(t[0]),e._measurable.push(t[2]),e._selectedObject.push(i[0]),e._selectedObject.push(i[2]),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[1],i[2]],inProgressMeasurableList:[t[1],t[2]]}))e._measurable.push(t[1]),e._measurable.push(t[2]),e._selectedObject.push(i[1]),e._selectedObject.push(i[2]),e.objectActionValidSelDone=!0;else{var n=U(t);n&&n.index?(e._measurable.push(t[n.index]),e._selectedObject.push(i[n.index]),p(t[n.index]),e.objectActionValidSelDone=!0):(e._measurable.push(t[0]),e._selectedObject.push(i[0]),p(t[0]))}}(l,a);else{o=!0;var r=U(l);r&&r.index?(e._measurable.push(l[r.index]),e._selectedObject.push(a[r.index]),p(l[r.index]),e.objectActionValidSelDone=!0):(e._measurable.push(l[0]),e._selectedObject.push(a[0]),p(l[0]))}}else{var s=c.getMeasurable(n[0]);s&&s.getType()!==u.GeometryType.PRODUCT&&(e._measurable.push(s),e._selectedObject.push(n[0]),p(s),e.onlyOneInSelList=!0,o=!0)}return o},iAction:function(t){t(),!e.objectAction||e.objectActionValidSelDone?M():e.onlyOneInSelList?(e.onlyOneInSelList=!1,M()):e.goForthirdSel?(x(),e.publish({event:"GoToSecondSelDoneState"})):e._measurable&&1===e._measurable.length&&_(),e.objectAction=void 0}}),e.addTransition({iEvent:e._pathElementAgentWithoutCSO,iInitialState:m,iFinalState:v,iCondition:function(t){var i=c.getMeasurable(t[0]);if(i){if(i.getType()!==u.GeometryType.PRODUCT&&e._measurable.push(i),e._selectedObject.push(t[0]),p(i),!e.goForthirdSel&&2===e._measurable.length){var n=e._measurable[0].getType(),o=e._measurable[1].getType();e._checkfor2PointSel(n,o)&&(e.goForthirdSel=!0)}return!0}return!1},iAction:function(e){e(),x()}}),e.addTransition({iEvent:e._pathElementAgentWithoutCSO,iInitialState:v,iFinalState:P,iCondition:function(t){var i=c.getMeasurable(t[0]);return!!i&&(i.getType()!==u.GeometryType.PRODUCT&&e._measurable.push(i),e._selectedObject.push(t[0]),p(i),e.modifyOrigin=!1,!0)},iAction:function(t){t(),e.publish({event:"DMUSectionPosCmdValidated"})}})},_isLoaded:function(e){var t=this;t._switchService||(t._switchService=new d({viewer:t._viewer}));var i,n=[],o=e;if(t._switchService.retriveNodesFromPath(o,n),n&&n.length)for(var a=0;a<n.length;a++)if(i=n[a],t._viewerController.hasMeshInRAM(l.getNodeID(i))&&"cgr"===t._viewerController.getLoadedStream(i))return!0;return!1},_checkfor2PointSel:function(e,t){var i=!1;return"Point"===c.getSelMapName(e)&&"Point"===c.getSelMapName(t)&&(i=!0),i},_checkPicking:function(e,t){if(!e)return!1;if(!t._isLoaded(e))return!0;var i=c.getMeasurable({pathElement:e});if(i){if(t._measurable&&!t._measurable.length)return!0;var n=[],o=[];t._measurable.forEach((function(e){n.push(e)})),n.push(i),t._selectedObject.forEach((function(e){o.push(e)})),o.push({pathElement:e});var a="",l=function(){return n.forEach((function(e){a+=c.getSelMapName(e.getType())})),!(!c.sectionPosMap[a]||!t.computePlanePos({inProgressSelList:o,inProgressMeasurableList:n}))};if(t._measurable&&1===t._measurable.length){t.goForthirdSel=!1;var r=n[0].getType(),s=n[1].getType();return t._checkfor2PointSel(r,s)?(t.goForthirdSel=!0,!0):l()}if(t._measurable&&2===t._measurable.length)return l()}return!1},_removePreVisuNode:function(){this._preVisuNode&&(l.getSceneRoot(this._viewer).remove(this._preVisuNode),this._viewer.render(),this._preVisuNode.removeChildren(),this._preVisuNode.remove(),this._preVisuNode=void 0)},_removehiglightVisuNode:function(){this.highlightNode&&(l.getSceneRoot(this._viewer).remove(this.highlightNode),this._viewer.render(),this.highlightNode.removeChildren(),this.highlightNode.remove(),this.highlightNode=void 0)},_previsualize:function(e,t){if(e&&e.pathElement){var i,n,o,a,r=t._viewer,s=new m.Vector3,d=new m.Vector3,h=new m.Vector3,f=function(){return a&&"Axis"===c.getSelMapName(a.getType(),!t._PlanePos)};if(t._PlanePos)if(a=c.getMeasurable(e),(n=t._PlanePos).extractBasis(s,d,h),f())if(a.getType()===u.GeometryType.CIRCLE)o=a.getCenter();else{var C=e.position?e.position:a.getSelPoint(),P=a.getPoints(),b=a.getAxis().clone().toArray(),D=C.clone().toArray(),_=P.beginPoint.toArray(),M=h.clone().toArray(),x=v.computeTwoLinesDistance(D,M,_,b).aPosition2;o=new m.Vector3(x[0],x[1],x[2])}else o=e.position?e.position:(new m.Vector3).getPositionFromMatrix(n);else{var U=p.getViewpointInfo(r.currentViewpoint);i=c.sectionPosMap.SingleSel.getPos({selectedObject:e,info:U,viewer:r,retriveMeasureble:!0}),a=i&&i.measurable?i.measurable:c.getMeasurable(e),i.plane&&((n=i.plane).extractBasis(s,d,h),o=(new m.Vector3).getPositionFromMatrix(n))}return n&&(a||(a=c.getMeasurable(e)),t._preVisuNode?t._preVisuNode.buildPreVisuNode({data:{point:o,normal:h.negate(),measurable:a,toShowAxisVisu:f}}):(t._preVisuNode=new g(r),t._preVisuNode.buildPreVisuNode({data:{point:o,normal:h.negate(),measurable:a,toShowAxisVisu:f}}),t._preVisuNode.setNoZ(!0),t._preVisuNode.setPickable(S.PICKTHROUGH),r&&(l.getSceneRoot(r).add(t._preVisuNode),r.render())),t._preVisuNode.setVisibility(r.getVisibleSpace())),!0}t._preVisuNode&&t._removePreVisuNode()}})})),define("DS/DMUSection/DMUClippingPositionPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Windows/Dialog","DS/DMUBaseExperience/DMUContextManager","DS/Controls/Button","DS/Controls/SpinBox","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Menu/ContextualMenu","DS/DMUPlaySection/DMUClippingService","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUBaseUIControllers/DMUWebPreferencesController","DS/CATWebUXPreferences/CATWebUXPreferencesManager","i18n!DS/DMUSection/assets/nls/DMUSection","css!DS/DMUSection/DMUSection.css"],(function(e,t,i,n,o,a,l,r,s,c,p,d,u,g,h,m,S,f){"use strict";return t.extend({init:function(t,v){let C=f.clippingPositionPanel,P=f.stepValueContextualMenu,b=v,D=t.viewer,_=t.frameWindow;this._contextViewer=o.getContextViewer({viewer:D});var M=null;let x,U,y,w,E,V,N,I,O,L,A,B=[],k=o.giveEventsController({viewer:D}),T=!0,F={lengthPrefName:"Length",anglePrefName:"Angle",LengthDecDisplayName:"LengthDisplay",angleDecDisplayName:"AngleDisplay",orignalLengthUnit:"Millimeter",orignalAngleUnit:"Radian"};function j(e,t,i,n){return h.convert(t,e,i,n)}let R=j(F.anglePrefName,1,"Degree",F.orignalAngleUnit),H={clippingPositionSpinnerList:[],oreintationSpinnerList:[],rotationSpinnerList:[],sliceBoxPlanePositionSpinnerList:[],translationSectionPlaneSpinner:{},sliceBoxPlaneOffsetSpinner:{}},W={clippingPositionSpinnerList:{valueList:[[1],[1],[1]],usedValue:[1,1,1],insertIndex:[0,0,0]},oreintationSpinnerList:{valueList:[[R],[R],[R]],usedValue:[R,R,R],insertIndex:[0,0,0]},rotationSpinnerList:{valueList:[[R],[R],[R]],usedValue:[R,R,R],insertIndex:[0,0,0]},sliceBoxPlanePositionSpinnerList:{valueList:[[1],[1],[1]],usedValue:[1,1,1],insertIndex:[0,0,0]},translationSectionPlaneSpinner:{valueList:[1],usedValue:1,insertIndex:0},sliceBoxPlaneOffsetSpinner:{valueList:[1],usedValue:1,insertIndex:0}},X="DMUClippingPosPanelStepValues",z=[{lable:C.planeDirW+"+",planeName:"Front",attributName:"sliceOffset"},{lable:C.planeDirW+"-",planeName:"Back",attributName:"sliceOffset"},{lable:C.planeDirU+"+",planeName:"Right",attributName:"uSize"},{lable:C.planeDirU+"-",planeName:"Left",attributName:"uSize"},{lable:C.planeDirV+"+",planeName:"Bottom",attributName:"vSize"},{lable:C.planeDirV+"-",planeName:"Top",attributName:"vSize"}];function G(){let e=W,t=localStorage.getItem(X);return t&&(e=JSON.parse(t)),e}function q(){b&&z.forEach((e=>{switch(e.refPos=(new i.Vector3).getPositionFromMatrix(b._getPlanReferential(e.planeName)),e.lable){case C.planeDirW+"+":e.refDir=b.getNormal().negate();break;case C.planeDirW+"-":e.refDir=b.getNormal();break;case C.planeDirU+"+":e.refDir=b.getUDirection();break;case C.planeDirU+"-":e.refDir=b.getUDirection().negate();break;case C.planeDirV+"+":e.refDir=b.getVDirection();break;case C.planeDirV+"-":e.refDir=b.getVDirection().negate()}}))}let Z,J={width:"-webkit-fill-available",position:"absolute","margin-left":"36px","margin-right":"10px"},Y=(e,t,i)=>j(e,t,e===F.anglePrefName?F.orignalAngleUnit:F.orignalLengthUnit,(i||m.getCurrentUnit(e)).unit);function K(e,t,i,n){let o=n||m.getCurrentUnit(e);var a={},l=e===F.anglePrefName?F.anglePrefName:F.lengthPrefName,r=n&&n.unit?n.unit:m.readPreferences({name:"cke",PreferenceNames:[l]}).preferences[0].value;let s=o&&o.decimalPlaceRW?parseInt(o.decimalPlaceRW):3;return(isNaN(s)||s<0)&&(s=3),a.value=h.convert(t,e,i,r),a.unit=o.nls,a.nbDecimal=s,a}function Q(e,t){T!==t&&e&&setTimeout((()=>{T=t;let i=e.getNode();if(i){i.setClippingPickable(t);let e=i.getRobot?i.getRobot():void 0;e&&e._setFilterVisibility&&e._setFilterVisibility(t)}e._movegauge&&(t?(e._movegauge.setVisibleFlag(t),e.refreshSlider()):e._movegauge.setVisibleFlag(t))}),300)}var $=function(e,t){let n=t||C;if(!e)return n+":";var o,a,l,r,s={x:new i.Vector3,y:new i.Vector3,z:new i.Vector3};return e.extractBasis(s.x,s.y,s.z),o=s.z.clone().negate(),a=n,r=.9995,o.normalize(),o.x>r?l=C.positionX:o.y>r?l=C.positionY:o.z>r&&(l=C.positionZ),l?a+"|"+l:a+":"};function ee(t){return new e.Element("div",{class:"DMUClippingPositionEditor"}).inject(t)}var te={mainDiv:void 0,transaltionCordinateEditorList:void 0,transaltionOffsetEditor:void 0,rotationAngleEditorList:void 0,orinetationAngelEditorList:void 0};let ie=this;function ne(){H.translationSectionPlaneSpinner._spinner&&0!==H.translationSectionPlaneSpinner._spinner.value&&(H.translationSectionPlaneSpinner.silentValueUpdate=!0,H.translationSectionPlaneSpinner._spinner.value=0),x&&z.forEach((e=>{e.refPos=(new i.Vector3).getPositionFromMatrix(b._getPlanReferential(e.planeName))}))}function oe(e){if(H&&H.rotationSpinnerList&&H.rotationSpinnerList.length)for(var t=0;t<3;t++)e!==t&&0!==H.rotationSpinnerList[t]._spinner.value&&(H.rotationSpinnerList[t].silentValueUpdate=!0,H.rotationSpinnerList[t]._spinner.value=0)}function ae(e,t){if(!x)return;let n=t&&t.doNotUpdateOffset,o=t&&t.doNotUpdatePlanePos,a=(new i.Vector3).getPositionFromMatrix(b._getPlanReferential(z[x.selectedIndex].planeName)),l=z[x.selectedIndex].refPos.clone();if(U&&(U.textContent=$(b._getPlanReferential(),z[x.selectedIndex].lable)),!n){let t=a.clone().distanceTo(l);if(!isNaN(t)){let i=K(F.lengthPrefName,t,F.orignalLengthUnit,e&&e.lenthUnitPref?e.lenthUnitPref:void 0).value;H.sliceBoxPlaneOffsetSpinner._spinner.value!==i&&(ie.isSubscribed&&(H.sliceBoxPlaneOffsetSpinner.silentValueUpdate=!0),H.sliceBoxPlaneOffsetSpinner._spinner.value=i)}}if(!o){let t=a.toArray();for(var r=0;r<3;r++){let i=K(F.lengthPrefName,t[r],F.orignalLengthUnit,e&&e.lenthUnitPref?e.lenthUnitPref:void 0).value;H.sliceBoxPlanePositionSpinnerList[r]._spinner.value!==i&&(ie.isSubscribed&&(H.sliceBoxPlanePositionSpinnerList[r].silentValueUpdate=!0),H.sliceBoxPlanePositionSpinnerList[r]._spinner.value=i)}}}function le(e,t,n){let o=!0,a=!0;t&&(1===t?a=!1:2===t&&(o=!1));let l,r=b.getNode().getPlaneGeometryCB();if(o&&ae(e,n),o){l=b.getClippingCenter().clone().toArray()}let s=[],c=r?r.referential:void 0,p={x:new i.Vector3,y:new i.Vector3,z:new i.Vector3};c&&c.extractBasis(p.x,p.y,p.z);let u=p.z.negate();if(a){let e={x:new i.Vector3(1,0,0),y:new i.Vector3(0,1,0),z:new i.Vector3(0,0,1)},t=t=>{for(var n=0;n<3;n++)if(!d.isZero(t[n]))switch(n){case 0:(new i.Vector3).crossVectors(e.x,u).z<0&&(t[n]=2*Math.PI-t[n]);break;case 1:(new i.Vector3).crossVectors(e.y,u).z<0&&(t[n]=2*Math.PI-t[n]);break;case 2:(new i.Vector3).crossVectors(e.z,u).z<0&&(t[n]=2*Math.PI-t[n])}};s.push(u.angleTo(e.x)),s.push(u.angleTo(e.y)),s.push(u.angleTo(e.z)),d.isZero(s[0]%(2*Math.PI))&&(s[0]=0),d.isZero(s[1]%(2*Math.PI))&&(s[1]=0),d.isZero(s[2]%(2*Math.PI))&&(s[2]=0),t(s)}let g=n?n.rotIndexToAvoid:void 0;for(var h=0;h<3;h++){if(o&&(!n||!n.iDoNotUpdateClippingPositionValue)){let t=K(F.lengthPrefName,l[h],F.orignalLengthUnit,e&&e.lenthUnitPref?e.lenthUnitPref:void 0).value;H.clippingPositionSpinnerList[h]._spinner.value!==t&&(ie.isSubscribed&&(H.clippingPositionSpinnerList[h].silentValueUpdate=!0),H.clippingPositionSpinnerList[h]._spinner.value=t)}if(a){let t=$(r.referential,C.planeDirW);if(y&&(y.textContent=t),w&&(w.textContent=t),h!==g){var m=K(F.anglePrefName,s[h],F.orignalAngleUnit,e&&e.angleUnitPref?e.angleUnitPref:void 0).value;H.oreintationSpinnerList[h]._spinner.value!==m&&(ie.isSubscribed&&(H.oreintationSpinnerList[h].silentValueUpdate=!0),H.oreintationSpinnerList[h]._spinner.value=m)}}}}function re(){ie.isSubscribed=!0;let e=()=>{N.disabled&&(N.disabled=!1)},t=(e,t,n)=>{let o=(new i.Matrix4).copy(A);var a=b.getClippingCenter();let l;o.setPosition(a);let r=n||m.getCurrentUnit(F.anglePrefName);l=j(F.anglePrefName,t,r.unit,F.orignalAngleUnit),l%=2*Math.PI;var s=o.decompose();let c=new i.Vector3(0,0,1).applyQuaternion(s[1]).negate();var p,g,h,S,f;let v=b.getNode();var C;let P,D,_,M,x,U,y,w=(e,t,n)=>{let o,a=n;return _=(new i.Vector3).crossVectors(e,t),_.length()&&!d.isZero(_.length())&&(o=((e,t,n)=>{const o=t.normalize().toArray(),a=e.toArray(),l=Math.cos(n),r=Math.sin(n),s=[a[0]*l+(o[1]*a[2]-o[2]*a[1])*r+o[0]*(o[0]*a[0]+o[1]*a[1]+o[2]*a[2])*(1-l),a[1]*l+(o[2]*a[0]-o[0]*a[2])*r+o[1]*(o[0]*a[0]+o[1]*a[1]+o[2]*a[2])*(1-l),a[2]*l+(o[0]*a[1]-o[1]*a[0])*r+o[2]*(o[0]*a[0]+o[1]*a[1]+o[2]*a[2])*(1-l)];return new i.Vector3(s[0],s[1],s[2])})(e,_,a),o&&o.length()&&!d.isZero(o.length())||(o=void 0)),o},E={x:new i.Vector3(1,0,0),y:new i.Vector3(0,1,0),z:new i.Vector3(0,0,1)};switch(e){case 0:D=w(E.x,c,l),D||(P=new i.Vector3(0,0,1),M=new i.Vector3(-1,0,0),y=u.getXYAxisDirFromZ(M.clone()),y.xDir&&y.yDir&&(x=y.xDir,U=y.yDir),o=x&&U?(new i.Matrix4).makeBasis(x,U,M).setPosition(a):(new i.Matrix4).rotateY(-Math.PI/2).setPosition(a));break;case 1:D=w(E.y,c,l),D||(M=new i.Vector3(0,-1,0),P=new i.Vector3(0,0,1),y=u.getXYAxisDirFromZ(M.clone()),y.xDir&&y.yDir&&(x=y.xDir,U=y.yDir),o=x&&U?(new i.Matrix4).makeBasis(x,U,M).setPosition(a):(new i.Matrix4).rotateX(Math.PI/2).setPosition(a));break;case 2:D=w(E.z,c,l),D||(M=new i.Vector3(0,0,-1),P=new i.Vector3(0,1,0),y=u.getXYAxisDirFromZ(M.clone()),y.xDir&&y.yDir&&(x=y.xDir,U=y.yDir),o=x&&U?(new i.Matrix4).makeBasis(x,U,M).setPosition(a):(new i.Matrix4).rotateY(Math.PI).setPosition(a))}if(D){let e=D.negate();var V=u.getXYAxisDirFromZ(e.clone());V.xDir&&V.yDir&&(o=(new i.Matrix4).makeBasis(V.xDir,V.yDir,e).setPosition(a))}else d.isZero(0-l)||(l=2*Math.PI-l,v.setPlaneGeometryCB({referential:o}),h=P.clone().dot(b.getUDirection()),S=P.clone().dot(b.getVDirection()),f=P.clone().dot(b.getNormal().negate()),p=d.areEqual(Math.abs(S),1,"float"),g=d.areEqual(Math.abs(h),1,"float"),p?(C=d.isLessOrEqual(S,0)?-l:l,o=o.rotateY(C)):g?(C=d.isLessOrEqual(h,0)?-l:l,o=o.rotateX(C)):(C=d.isLessOrEqual(f,0)?l:-l,o=o.rotateZ(C)));L=(new i.Matrix4).copy(o),v.setPlaneGeometryCB({referential:o,toRelocate:!0,UpdateRobotpos:!0,refreshNode:!0})},n=()=>{if(H.translationSectionPlaneSpinner.silentValueUpdate)return void(H.translationSectionPlaneSpinner.silentValueUpdate=!1);var e=b.getAttribute("mPlaneReferential"),t=ie.refClippingPostion.clone(),n=b.getNormal().clone().negate();let o=m.getCurrentUnit(F.lengthPrefName),a=j(F.lengthPrefName,H.translationSectionPlaneSpinner._spinner.value,o.unit,F.orignalLengthUnit),l=t.add(n.normalize().multiplyScalar(a));e.setPosition(l),L=(new i.Matrix4).copy(e),A=(new i.Matrix4).copy(e),b.modifyPlaneReferential(e),b.getNode().updateRobotPos(!0),le({lenthUnitPref:o},1)},o=e=>{if(H.clippingPositionSpinnerList[e].silentValueUpdate)return void(H.clippingPositionSpinnerList[e].silentValueUpdate=!1);let t=[],n=m.getCurrentUnit(F.lengthPrefName);for(var o=0;o<3;o++)t.push(j(F.lengthPrefName,H.clippingPositionSpinnerList[o]._spinner.value,n.unit,F.orignalLengthUnit));var a=b.getAttribute("mPlaneReferential");let l=new i.Vector3(t[0],t[1],t[2]);if(!b.isSinglePlaneMode()){let e=b.getNode().getPlaneGeometryCB();var r=e.referential.decompose(),s=new i.Vector3(0,0,1).applyQuaternion(r[1]);s=s.normalize().multiplyScalar(e.sliceOffset/2),l=l.add(s.negate())}if(a.setPosition(l),ie.refClippingPostion=l.clone(),L=(new i.Matrix4).copy(a),A=(new i.Matrix4).copy(a),b.modifyPlaneReferential(a),b.getNode().updateRobotPos(!0),H.sliceBoxPlanePositionSpinnerList&&H.sliceBoxPlanePositionSpinnerList.length&&x){let e=b._getPlanReferential(z[x.selectedIndex].planeName);z[x.selectedIndex].refPos=(new i.Vector3).getPositionFromMatrix(e)}le({lenthUnitPref:n},1,{iDoNotUpdateClippingPositionValue:!0}),H.translationSectionPlaneSpinner._spinner&&0!==H.translationSectionPlaneSpinner._spinner.value&&(H.translationSectionPlaneSpinner.silentValueUpdate=!0,H.translationSectionPlaneSpinner._spinner.value=0)},a=[()=>{o(0)},()=>{o(1)},()=>{o(2)}],l=()=>{if(H.sliceBoxPlaneOffsetSpinner.silentValueUpdate)return void(H.sliceBoxPlaneOffsetSpinner.silentValueUpdate=!1);var e=z[x.selectedIndex].refPos.clone();let t=m.getCurrentUnit(F.lengthPrefName),n=z[x.selectedIndex].refDir.clone(),o=j(F.lengthPrefName,H.sliceBoxPlaneOffsetSpinner._spinner.value,t.unit,F.orignalLengthUnit),a=e.add(n.normalize().multiplyScalar(o));b.getNode().setPlaneGeometryCB({newCenter:a,from:z[x.selectedIndex].planeName,UpdateRobotpos:!0,refreshNode:!0}),L=(new i.Matrix4).copy(b.getNode().getPlaneGeometryCB().referential),A=(new i.Matrix4).copy(b.getNode().getPlaneGeometryCB().referential),ie.refClippingPostion=(new i.Vector3).getPositionFromMatrix(L),le({lenthUnitPref:t},1,{doNotUpdateOffset:!0})},r=e=>{if(H.sliceBoxPlanePositionSpinnerList[e].silentValueUpdate)return void(H.sliceBoxPlanePositionSpinnerList[e].silentValueUpdate=!1);let t=[],n=m.getCurrentUnit(F.lengthPrefName);for(var o=0;o<3;o++)t.push(j(F.lengthPrefName,H.sliceBoxPlanePositionSpinnerList[o]._spinner.value,n.unit,F.orignalLengthUnit));var a=b.getClippingCenter().clone(),l=z[x.selectedIndex].refDir.clone();let r=new i.Vector3(t[0],t[1],t[2]);r=(new i.Plane).setFromNormalAndCoplanarPoint(l,r).projectPoint(a),z[x.selectedIndex].refPos=r.clone(),b.getNode().setPlaneGeometryCB({newCenter:r,from:z[x.selectedIndex].planeName,UpdateRobotpos:!0,refreshNode:!0}),L=(new i.Matrix4).copy(b.getNode().getPlaneGeometryCB().referential),A=(new i.Matrix4).copy(b.getNode().getPlaneGeometryCB().referential),ie.refClippingPostion=(new i.Vector3).getPositionFromMatrix(L),le({lenthUnitPref:n},1,{doNotUpdatePlanePos:!0})},s=[()=>{r(0)},()=>{r(1)},()=>{r(2)}],c=e=>{if(H.oreintationSpinnerList[e].silentValueUpdate)return void(H.oreintationSpinnerList[e].silentValueUpdate=!1);E=void 0,V!==e&&(L=(new i.Matrix4).copy(b.getNode().getPlaneGeometryCB().referential),A=(new i.Matrix4).copy(b.getNode().getPlaneGeometryCB().referential)),V=e;let n=m.getCurrentUnit(F.anglePrefName),o=m.getCurrentUnit(F.lengthPrefName);t(e,H.oreintationSpinnerList[e]._spinner.value,n),ne(),oe(),H.rotationSpinnerList._spinner&&0!==H.translationSectionPlaneSpinner._spinner.value&&(H.translationSectionPlaneSpinner.silentValueUpdate=!0,H.translationSectionPlaneSpinner._spinner.value=0),le({lenthUnitPref:o,angleUnitPref:n},void 0,{rotIndexToAvoid:e}),q()},p=[e=>{c(0)},e=>{c(1)},e=>{c(2)}],g=e=>{if(H.rotationSpinnerList[e].silentValueUpdate)return void(H.rotationSpinnerList[e].silentValueUpdate=!1);V=void 0,E!==e&&(L=(new i.Matrix4).copy(b.getNode().getPlaneGeometryCB().referential),A=(new i.Matrix4).copy(b.getNode().getPlaneGeometryCB().referential)),E=e;let t=m.getCurrentUnit(F.anglePrefName),n=m.getCurrentUnit(F.lengthPrefName);((e,t,n)=>{let o=(new i.Matrix4).copy(L);var a=b.getClippingCenter();o.setPosition(a);let l,r,s=!1,c=n||m.getCurrentUnit(F.anglePrefName);var p,u,g,h,S;l=j(F.anglePrefName,t,c.unit,F.orignalAngleUnit),l%=2*Math.PI;let f=b.getNode();var v;if(d.isZero(0-l))s=!1;else{switch(e){case 0:r=b.getUDirection(),u=!0;break;case 1:r=b.getVDirection(),p=!0;break;case 2:r=b.getNormal().negate()}g=r.clone().dot(b.getUDirection()),h=r.clone().dot(b.getVDirection()),S=r.clone().dot(b.getNormal().negate())}s||(p?(v=d.isLessOrEqual(h,0)?-l:l,o=o.rotateY(v)):u?(v=d.isLessOrEqual(g,0)?-l:l,o=o.rotateX(v)):(v=d.isLessOrEqual(S,0)?l:-l,o=o.rotateZ(v))),A=(new i.Matrix4).copy(o),f.setPlaneGeometryCB({referential:o,toRelocate:!0,UpdateRobotpos:!0,refreshNode:!0})})(e,H.rotationSpinnerList[e]._spinner.value,t),le({lenthUnitPref:n,angleUnitPref:t}),ne(),oe(e),q()},h=[()=>{g(0)},()=>{g(1)},()=>{g(2)}],S=()=>{ae({lenthUnitPref:m.getCurrentUnit(F.lengthPrefName)})};H.translationSectionPlaneSpinner&&H.translationSectionPlaneSpinner._spinner&&(H.translationSectionPlaneSpinner._spinner.addEventListener("beginEdit",e),H.translationSectionPlaneSpinner._spinner.addEventListener("endEdit",n),H.translationSectionPlaneSpinner._spinner.addEventListener("change",n)),H.sliceBoxPlaneOffsetSpinner&&H.sliceBoxPlaneOffsetSpinner._spinner&&(H.sliceBoxPlaneOffsetSpinner._spinner.addEventListener("beginEdit",e),H.sliceBoxPlaneOffsetSpinner._spinner.addEventListener("endEdit",l),H.sliceBoxPlaneOffsetSpinner._spinner.addEventListener("change",l)),x&&x.addEventListener("change",S);for(var f=0;f<3;f++)H.clippingPositionSpinnerList[f]._spinner.addEventListener("beginEdit",e),H.clippingPositionSpinnerList[f]._spinner.addEventListener("endEdit",a[f]),H.clippingPositionSpinnerList[f]._spinner.addEventListener("change",a[f]),H.oreintationSpinnerList[f]._spinner.addEventListener("beginEdit",e),H.oreintationSpinnerList[f]._spinner.addEventListener("endEdit",p[f]),H.oreintationSpinnerList[f]._spinner.addEventListener("change",p[f]),H.rotationSpinnerList[f]._spinner.addEventListener("beginEdit",e),H.rotationSpinnerList[f]._spinner.addEventListener("endEdit",h[f]),H.rotationSpinnerList[f]._spinner.addEventListener("change",h[f]),H.sliceBoxPlanePositionSpinnerList&&H.sliceBoxPlanePositionSpinnerList.length&&(H.sliceBoxPlanePositionSpinnerList[f]._spinner.addEventListener("beginEdit",e),H.sliceBoxPlanePositionSpinnerList[f]._spinner.addEventListener("endEdit",s[f]),H.sliceBoxPlanePositionSpinnerList[f]._spinner.addEventListener("change",s[f]))}function se(){function i(i){if(!i.spinner||!i.keyID)return null;let o,r=G();o=isNaN(i.index)?r[i.keyID].valueList:r[i.keyID].valueList[i.index];var c={type:"PushItem",title:P.title,submenu:[]};let p=(e,t,i,n,o)=>{let a=G();if(isNaN(n)){if(a[i].usedValue=e,!a[i].valueList.includes(e))if(a[i].valueList.length<5)a[i].valueList.push(e);else{let t=a[i].insertIndex;a[i].valueList[t]=e,a[i].insertIndex=(a[i].insertIndex+1)%5}H[i]._spinner.stepValue=t}else if(o){for(let n=0;n<3;n++)if(a[i].usedValue[n]=e,H[i][n]._spinner.stepValue=t,!a[i].valueList[n].includes(e))if(a[i].valueList[n].length<5)a[i].valueList[n].push(e);else{let t=a[i].insertIndex[n];a[i].valueList[n][t]=e,a[i].insertIndex[n]=(a[i].insertIndex[n]+1)%5}}else if(a[i].usedValue[n]=e,H[i][n]._spinner.stepValue=t,!a[i].valueList[n].includes(e))if(a[i].valueList[n].length<5)a[i].valueList[n].push(e);else{let t=a[i].insertIndex[n];a[i].valueList[n][t]=e,a[i].insertIndex[n]=(a[i].insertIndex[n]+1)%5}localStorage.setItem(X,JSON.stringify(a))};if(o&&o.length){let e=m.getCurrentUnit(i.magnitudeName),t=e?e.nls:"";o.sort(((e,t)=>t-e)).forEach((n=>{let o=n,a=i.magnitudeName===F.lengthPrefName?F.orignalLengthUnit:F.orignalAngleUnit;e.unit!==a&&(o=K(i.magnitudeName,n,a,e).value);let l=Math.trunc(30*o)/30;c.submenu.push({type:"PushItem",title:l.toString()+" "+t,action:{this:{valueInCurrentUnit:o,valueInStore:n,keyID:i.keyID,index:i.index},callback:function(){let e=this.valueInStore,t=this.valueInCurrentUnit,i=this.keyID,n=this.index;p(e,t,i,n)}}})}))}return c.submenu.push({type:"PushItem",title:P.stepValue,action:{this:i,callback:function(){let i,o,r=this,c=r.keyID,d=r.index;O&&O.destroy(),O=null;let u=()=>{let e=((e,t,i)=>{let n=e===F.anglePrefName?F.orignalAngleUnit:F.orignalLengthUnit;return j(e,t,(i||m.getCurrentUnit(e)).unit,n)})(r.magnitudeName,i.value),t=Boolean(r.applyAllComp)&&Boolean(o&&o.checkFlag);p(e,i.value,c,d,t)},g=()=>{O&&(O.destroy(),O=null)};O=new n({modalFlag:!0,identifier:"DMUClippingPositionChangeStepValueDlg",ensureHeightDefinitionOnHierarchy:!0,title:P.title,content:(t=>{let n,a=e.createElement("div"),p=m.getCurrentUnit(r.magnitudeName);return n=isNaN(d)?H[c]._spinner.stepValue:H[c][d]._spinner.stepValue,i=new l({value:n,units:p.nls,selectAllOnFocus:!1,pageStepValue:1,displayStyle:"lite"}).inject(a),i.getContent().setStyles({width:"144px"}),t&&(o=new s({type:"checkbox",label:P.ApplyAllBnt,value:0,checkFlag:!1}).inject(a)),a})(Boolean(r.applyAllComp)),immersiveFrame:t.immersiveFrame,buttons:{Abort:new a({label:P.cancelBtn,onClick:function(){g()}}),Ok:new a({emphasize:"primary",label:P.okLabel,onClick:function(){u(),g()}})},resizableFlag:!1})}}}),[c]}let o=[()=>i({spinner:H.clippingPositionSpinnerList[0]._spinner,applyAllComp:H.clippingPositionSpinnerList,index:0,keyID:"clippingPositionSpinnerList",magnitudeName:F.lengthPrefName}),()=>i({spinner:H.clippingPositionSpinnerList[1]._spinner,applyAllComp:H.clippingPositionSpinnerList,index:1,keyID:"clippingPositionSpinnerList",magnitudeName:F.lengthPrefName}),()=>i({spinner:H.clippingPositionSpinnerList[2]._spinner,applyAllComp:H.clippingPositionSpinnerList,index:2,keyID:"clippingPositionSpinnerList",magnitudeName:F.lengthPrefName})],r=[()=>i({spinner:H.oreintationSpinnerList[0]._spinner,applyAllComp:H.oreintationSpinnerList,index:0,keyID:"oreintationSpinnerList",magnitudeName:F.anglePrefName}),()=>i({spinner:H.oreintationSpinnerList[1]._spinner,applyAllComp:H.oreintationSpinnerList,index:1,keyID:"oreintationSpinnerList",magnitudeName:F.anglePrefName}),()=>i({spinner:H.oreintationSpinnerList[2]._spinner,applyAllComp:H.oreintationSpinnerList,index:2,keyID:"oreintationSpinnerList",magnitudeName:F.anglePrefName})],p=[()=>i({spinner:H.rotationSpinnerList[0]._spinner,applyAllComp:H.rotationSpinnerList,index:0,keyID:"rotationSpinnerList",magnitudeName:F.anglePrefName}),()=>i({spinner:H.rotationSpinnerList[1]._spinner,applyAllComp:H.rotationSpinnerList,index:1,keyID:"rotationSpinnerList",magnitudeName:F.anglePrefName}),()=>i({spinner:H.rotationSpinnerList[2]._spinner,applyAllComp:H.rotationSpinnerList,index:2,keyID:"rotationSpinnerList",magnitudeName:F.anglePrefName})],d=[()=>i({spinner:H.sliceBoxPlanePositionSpinnerList[0]._spinner,applyAllComp:H.sliceBoxPlanePositionSpinnerList,index:0,keyID:"sliceBoxPlanePositionSpinnerList",magnitudeName:F.lengthPrefName}),()=>i({spinner:H.sliceBoxPlanePositionSpinnerList[1]._spinner,applyAllComp:H.sliceBoxPlanePositionSpinnerList,index:1,keyID:"sliceBoxPlanePositionSpinnerList",magnitudeName:F.lengthPrefName}),()=>i({spinner:H.sliceBoxPlanePositionSpinnerList[2]._spinner,applyAllComp:H.sliceBoxPlanePositionSpinnerList,index:2,keyID:"sliceBoxPlanePositionSpinnerList",magnitudeName:F.lengthPrefName})],u=()=>i({spinner:H.translationSectionPlaneSpinner._spinner,keyID:"translationSectionPlaneSpinner",magnitudeName:F.lengthPrefName}),g=()=>i({spinner:H.sliceBoxPlaneOffsetSpinner._spinner,keyID:"sliceBoxPlaneOffsetSpinner",magnitudeName:F.lengthPrefName});H.translationSectionPlaneSpinner&&H.translationSectionPlaneSpinner._spinner&&c.addEventListener(H.translationSectionPlaneSpinner._spinner.getContent(),{callback:u}),H.sliceBoxPlaneOffsetSpinner&&H.sliceBoxPlaneOffsetSpinner._spinner&&c.addEventListener(H.sliceBoxPlaneOffsetSpinner._spinner.getContent(),{callback:g});for(var h=0;h<3;h++)c.addEventListener(H.clippingPositionSpinnerList[h]._spinner.getContent(),{callback:o[h]}),c.addEventListener(H.oreintationSpinnerList[h]._spinner.getContent(),{callback:r[h]}),c.addEventListener(H.rotationSpinnerList[h]._spinner.getContent(),{callback:p[h]}),H.sliceBoxPlanePositionSpinnerList&&H.sliceBoxPlanePositionSpinnerList.length&&c.addEventListener(H.sliceBoxPlanePositionSpinnerList[h]._spinner.getContent(),{callback:d[h]})}this.build=function(){if(ie.isSubscribed=!1,E=void 0,V=void 0,b=function(e){var t;if(e)for(var i=g.get(),n=0;n<i.length;n++){let o=e.getDMUObjectFromPathElement(i[n].pathElement);o&&("DMUClipping"!==o.getType()&&"DMUSection"!==o.getType()||(t=o))}if(!t){let e=p.retriveClippingObjsFromSlide(D,!0);e&&e.length&&(1===e.length?t=e[0]:e.forEach((e=>{e&&"DMUClipping"===e.getType()&&(t=e)})))}return t}(o.getReviewContext({viewer:D})),b){if(b.getNode().clearAllRulers(),!M){this.clearElem(!0),b.beginManipulation(),I={height:390,width:176},Q(b,!1),this.refClippingPostionInfo=b.getNode().getPlaneGeometryCB(),this.refClippingPostion=b.getClippingCenter(),L=(new i.Matrix4).copy(this.refClippingPostionInfo.referential),L.setPosition(b.getNode().getCenter()),A=(new i.Matrix4).copy(L),q();let s=function(t){let i=m.getCurrentUnit(F.lengthPrefName),n=m.getCurrentUnit(F.anglePrefName),o=i&&i.decimalPlaceRW?parseInt(i.decimalPlaceRW):3,a=n&&n.decimalPlaceRW?parseInt(n.decimalPlaceRW):3;(isNaN(o)||o<0)&&(o=3),(isNaN(a)||a<0)&&(a=3);let s=G(),c=ie.refClippingPostionInfo?ie.refClippingPostionInfo:b?b.getNode().getPlaneGeometryCB():void 0,p=e.createElement("div",{class:"DMUClippingPositionMainDiv"});te.mainDiv=p,new e.Element("div",{html:C.position}).inject(p),H.clippingPositionSpinnerList.push({type:"X",mainDiv:ee(p),magnitude:F.lengthPrefName,label:C.positionX}),H.clippingPositionSpinnerList.push({type:"Y",mainDiv:ee(p),magnitude:F.lengthPrefName,label:C.positionY}),H.clippingPositionSpinnerList.push({type:"Z",mainDiv:ee(p),magnitude:F.lengthPrefName,label:C.positionZ});let d=c?c.referential:void 0,u=$(d,C.planeDirW);if((void 0===t||b.isSinglePlaneMode())&&(new e.Element("div",{html:C.translation}).inject(p).setStyles({"padding-top":"10px"}),H.translationSectionPlaneSpinner={type:"W",mainDiv:ee(p),magnitude:F.lengthPrefName,label:u},H.translationSectionPlaneSpinner._spinner=new l({units:i.nls,decimals:o,stepValue:Y(F.lengthPrefName,s.translationSectionPlaneSpinner.usedValue,i),pageStepValue:1}),y=new e.Element("span",{text:H.translationSectionPlaneSpinner.label}).inject(H.translationSectionPlaneSpinner.mainDiv),H.translationSectionPlaneSpinner._spinner.elements.container.setStyles(J),H.translationSectionPlaneSpinner._spinner.inject(H.translationSectionPlaneSpinner.mainDiv)),new e.Element("div",{html:C.orientation}).inject(p).setStyles({"padding-top":"10px"}),H.oreintationSpinnerList.push({type:"OrtX",mainDiv:ee(p),magnitude:F.anglePrefName,label:C.orientationX}),H.oreintationSpinnerList.push({type:"OrtY",mainDiv:ee(p),magnitude:F.anglePrefName,label:C.orientationY}),H.oreintationSpinnerList.push({type:"OrtZ",mainDiv:ee(p),magnitude:F.anglePrefName,label:C.orientationZ}),new e.Element("div",{html:C.rotation}).inject(p).setStyles({"padding-top":"10px"}),H.rotationSpinnerList.push({type:"U",mainDiv:ee(p),magnitude:F.anglePrefName,label:C.rotationU}),H.rotationSpinnerList.push({type:"V",mainDiv:ee(p),magnitude:F.anglePrefName,label:C.rotationV}),H.rotationSpinnerList.push({type:"W",mainDiv:ee(p),magnitude:F.anglePrefName,label:u}),"BoxMode"===t||"SliceMode"===t){let n=[];I.height=503;let a=0;n.push(z[a++].lable+" "+C.planePosition),n.push(z[a++].lable+" "+C.planePosition),"BoxMode"===t&&(n.push(z[a++].lable+" "+C.planePosition),n.push(z[a++].lable+" "+C.planePosition),n.push(z[a++].lable+" "+C.planePosition),n.push(z[a++].lable+" "+C.planePosition)),x=new r({elementsList:n,enableSearchFlag:!1}).inject(p),x.getContent().addClassName("DMUClippingPositionEditorCombobox"),x.elements.container.setStyles({"padding-top":"10px"}),H.sliceBoxPlanePositionSpinnerList.push({type:"X",mainDiv:ee(p),magnitude:F.lengthPrefName,label:C.positionX}),H.sliceBoxPlanePositionSpinnerList.push({type:"Y",mainDiv:ee(p),magnitude:F.lengthPrefName,label:C.positionY}),H.sliceBoxPlanePositionSpinnerList.push({type:"Z",mainDiv:ee(p),magnitude:F.lengthPrefName,label:C.positionZ}),new e.Element("div",{html:C.offset}).inject(p).setStyles({"padding-top":"10px"}),u=$(d,z[x.selectedIndex].lable),H.sliceBoxPlaneOffsetSpinner={type:"offsetW",mainDiv:ee(p),magnitude:F.lengthPrefName,label:u},H.sliceBoxPlaneOffsetSpinner._spinner=new l({units:i.nls,decimals:o,stepValue:Y(F.lengthPrefName,s.sliceBoxPlaneOffsetSpinner.usedValue,i),pageStepValue:1}),U=new e.Element("span",{text:H.sliceBoxPlaneOffsetSpinner.label}).inject(H.sliceBoxPlaneOffsetSpinner.mainDiv),H.sliceBoxPlaneOffsetSpinner._spinner.elements.container.setStyles(J),H.sliceBoxPlaneOffsetSpinner._spinner.inject(H.sliceBoxPlaneOffsetSpinner.mainDiv)}for(var g=0;g<3;g++)new e.Element("span",{text:H.clippingPositionSpinnerList[g].label}).inject(H.clippingPositionSpinnerList[g].mainDiv),H.clippingPositionSpinnerList[g]._spinner=new l({units:i.nls,decimals:o,stepValue:Y(F.lengthPrefName,s.clippingPositionSpinnerList.usedValue[g],i),pageStepValue:1}),H.clippingPositionSpinnerList[g]._spinner.elements.container.setStyles(J),H.clippingPositionSpinnerList[g]._spinner.inject(H.clippingPositionSpinnerList[g].mainDiv),new e.Element("span",{text:H.oreintationSpinnerList[g].label}).inject(H.oreintationSpinnerList[g].mainDiv),H.oreintationSpinnerList[g]._spinner=new l({units:n.nls,decimals:a,stepValue:Y(F.anglePrefName,s.oreintationSpinnerList.usedValue[g],n),pageStepValue:1}),H.oreintationSpinnerList[g]._spinner.elements.container.setStyles(J),H.oreintationSpinnerList[g]._spinner.inject(H.oreintationSpinnerList[g].mainDiv),"OrtZ"===H.oreintationSpinnerList[g].type?w=new e.Element("span",{text:H.rotationSpinnerList[g].label}).inject(H.rotationSpinnerList[g].mainDiv):new e.Element("span",{text:H.rotationSpinnerList[g].label}).inject(H.rotationSpinnerList[g].mainDiv),H.rotationSpinnerList[g]._spinner=new l({units:n.nls,decimals:a,stepValue:Y(F.anglePrefName,s.rotationSpinnerList.usedValue[g],n),pageStepValue:1}),H.rotationSpinnerList[g]._spinner.elements.container.setStyles(J),H.rotationSpinnerList[g]._spinner.inject(H.rotationSpinnerList[g].mainDiv),H.sliceBoxPlanePositionSpinnerList&&H.sliceBoxPlanePositionSpinnerList.length&&(new e.Element("span",{text:H.sliceBoxPlanePositionSpinnerList[g].label}).inject(H.sliceBoxPlanePositionSpinnerList[g].mainDiv),H.sliceBoxPlanePositionSpinnerList[g]._spinner=new l({units:i.nls,decimals:o,stepValue:Y(F.lengthPrefName,s.sliceBoxPlanePositionSpinnerList.usedValue[g],i),pageStepValue:1}),H.sliceBoxPlanePositionSpinnerList[g]._spinner.elements.container.setStyles(J),H.sliceBoxPlanePositionSpinnerList[g]._spinner.inject(H.sliceBoxPlanePositionSpinnerList[g].mainDiv));return le({lenthUnitPref:i,angleUnitPref:n}),p}(b.getAttribute("sPlaneBoxMode"));N=new a({label:C.okBtn,emphasize:"primary",disabled:!0,showLabelFlag:!0,onClick:()=>{var e=p.retriveCurrentReview(D);if(e&&e.getCurrentSlide){var t=e.getCurrentSlide();t&&t.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:t})}ie.clear()}});var t={modalFlag:!1,identifier:"ClippingPositionDialog",ensureHeightDefinitionOnHierarchy:!0,title:C.title?C.title:"Clipping Position",content:s,immersiveFrame:_.getImmersiveFrame(),buttons:{Abort:new a({label:C.cancelBtn,emphasize:"secondary",showLabelFlag:!0,onClick:()=>{ie.clear(!0)}}),Ok:N},resizableFlag:"horizontal"};(M=new n(t)).addEventListener("close",(()=>{this.cancleModification()})),Z=S?S.givePreferenceManager({context:_}):null,Z&&(ie._prefSubscribe=Z.subscribe("com.ds.mep:onPrefUpdate",(function(e){var t=JSON.parse(e[1].preferences).repositories;t&&t.length&&t.forEach((e=>{if(e&&e.preferences&&e.preferences.length)for(var t=0;t<e.preferences.length;t++){let i,n=e.preferences[t].name,o=(e,t,i)=>{let n=e?e._spinner:void 0;if(!n)return;let o=h.convert(n.value,t,n.units,i.name);n.value!==o&&(ie.isSubscribed&&(e.silentValueUpdate=!0),n.value=o),n.units=i.symbol};if(F.lengthPrefName===n&&h[n]&&e.preferences[t].value)i=h[n][e.preferences[t].value],H.clippingPositionSpinnerList.forEach((e=>{o(e,n,i)})),H.sliceBoxPlanePositionSpinnerList&&H.sliceBoxPlanePositionSpinnerList.forEach((e=>{o(e,n,i)})),H.sliceBoxPlaneOffsetSpinner&&o(H.sliceBoxPlaneOffsetSpinner,n,i),H.translationSectionPlaneSpinner&&o(H.translationSectionPlaneSpinner,n,i);else if(F.anglePrefName===n&&h[n]&&e.preferences[t].value)i=h[n][e.preferences[t].value],H.oreintationSpinnerList.forEach((e=>{o(e,n,i)})),H.rotationSpinnerList.forEach((e=>{o(e,n,i)}));else if(F.LengthDecDisplayName===n){let i=parseInt(e.preferences[t].value);null!=i&&(H.clippingPositionSpinnerList.forEach((e=>{e._spinner.decimals=i})),H.sliceBoxPlanePositionSpinnerList&&H.sliceBoxPlanePositionSpinnerList.forEach((e=>{e._spinner.decimals=i})),H.translationSectionPlaneSpinner&&H.translationSectionPlaneSpinner._spinner&&(H.translationSectionPlaneSpinner._spinner.decimals=i),H.sliceBoxPlaneOffsetSpinner&&H.sliceBoxPlaneOffsetSpinner._spinner&&(H.sliceBoxPlaneOffsetSpinner._spinner.decimals=i))}else if(F.angleDecDisplayName===n){let i=parseInt(e.preferences[t].value);null!=i&&(H.oreintationSpinnerList.forEach((e=>{e._spinner.decimals=i})),H.rotationSpinnerList.forEach((e=>{e._spinner.decimals=i})))}}}))}))),re(),se(),k||(k=o.giveEventsController({viewer:ie._viewer})),k&&(B&&B.length||(B=[],B.push(k.addEvent("onEditCommandStart",(()=>{setTimeout((()=>{T=void 0,Q(b,!1)}),100)}))),B.push(k.addEvent("onEditCommandEnd",(()=>{})))))}var s={pathElement:u.buildPathElement(b.getNode())};return g.remove(s),M}},this.isBuilt=function(){return null!==M},this.isShow=function(){return!!M&&M.visibleFlag},this.show=function(){M&&M.show()},this.noShow=function(){M&&this.clear(!0)},this.cancleModification=function(){var e,t;if((this.clearElem(),b)&&this.refClippingPostionInfo){let i=b.getNode().getPlaneGeometryCB();i.uSize===this.refClippingPostionInfo.uSize&&i.vSize===this.refClippingPostionInfo.vSize&&i.referential===this.refClippingPostionInfo.referential||(e=this.refClippingPostionInfo,(t=b).getNode().setPlaneGeometryCB(e),t.refreshNode(),t.getNode().updateRobotPos())}},this.clearElem=function(e){k&&B&&B.length&&(B.forEach((e=>{k.removeEvent(e)})),B=[]),Q(b,!0),e||b.endManipulation(),M&&(M=null,H.clippingPositionSpinnerList=[],H.oreintationSpinnerList=[],H.rotationSpinnerList=[],H.sliceBoxPlanePositionSpinnerList=[],H.translationSectionPlaneSpinner={},H.sliceBoxPlaneOffsetSpinner={},x=null,T=!0)},this.clear=function(e,t){if(b&&!t){var i={pathElement:u.buildPathElement(b.getNode())};g.add(i)}M&&(M.destroy(),e?this.cancleModification():this.clearElem(),Z||(Z=S?S.givePreferenceManager({context:this.getFrameWindow()}):null),Z&&ie._prefSubscribe&&Z.unsubscribe(ie._prefSubscribe))}}})})),define("DS/DMUSection/DMUClippingCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUPlaySection/DMUClippingService","DS/DMUPlaySection/DMUStoreyNavigratorController","DS/DMUPlaySection/DMUToolsSection"],(function(e,t,i,n,o,a){"use strict";var l,r,s=e.extend({init:function(e){this._parent(e),l=this.getFrameWindow().getViewer(),r=t.getContextViewer({viewer:l});var n=this;this.onStateChange((function(){n.getState()?s.ActivateClipping():s.DeactivateClipping()}));var o=!1,a=t.getReviewContext({viewer:l});if(a){var c=a.getCurrentSessionMarkup();if(c){var p=c.getCurrentSlide();if(p){var d=p.getEnvironmentOverload();o="boolean"==typeof d.state.bLockUnlockSection?d.state.bLockUnlockSection:void 0;let e=i.getClippingCmdService();e&&e.updateClippingPlaneHideShowState({reviewContext:t.getReviewContext({viewer:l}),state:o})}}}}});return s.ActivateClipping=function(e,t){if(!l&&t&&(r||(r=t.executionContext.getComponent("Viewer")),r&&(l=r.getViewer())),!l){r||(r=require("DS/PADUtils/PADContext").get()),r&&(l=r.getViewer())}if(!i.isExplodeCmdActive(r)){var s=n.retriveClippingObjsFromSlide(l);if(s&&s.length>0)n.activateClipping(s,l);else{let e=a.getEditCmd(l);e&&!e.isRunning()&&(o.setActivateClippingActionFlag(!0),e.begin())}}e&&e()},s.DeactivateClipping=function(e,t){if(!l&&t&&(r||(r=t.executionContext.getComponent("Viewer")),r&&(l=r.getViewer())),!l){r||(r=require("DS/PADUtils/PADContext").get()),r&&(l=r.getViewer())}if(!i.isExplodeCmdActive(r)){var o=n.retriveClippingObjsFromSlide(l);n.deActivateClipping(o,l)}e&&e()},s})),define("DS/DMUSection/DMUClippingContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPUtils","DS/WebappsUtils/WebappsUtils","DS/DMUPlaySection/DMUToolsSection","i18n!DS/DMUSection/assets/nls/DMUSection"],(function(e,t,i,n,o,a,l){"use strict";var r={DMUExitClippingEditionHdr:{type:"PushItem",identifier:"DMUExitClippingEditionHdr",module:"DMUSection",iconPath:"icons/32/I_WebClippingEditionExit.png"},DMUContourViewerHdr:{type:"PushItem",identifier:"DMUContourViewerHdr",module:"DMUSection",iconPath:"icons/32/I_WebClippingSecondaryViewer.png"},DMUClippingPositionHdr:{type:"PushItem",identifier:"DMUClippingPositionHdr",module:"DMUSection",iconPath:"icons/32/I_WebClippingPositonEditorPanel.png"},DMUAlignViewHdr:{type:"CheckItem",identifier:"DMUAlignViewHdr",module:"DMUSection",iconPath:"icons/32/I_WebClippingAlignView.png"},DMUPropertiesHdr:{type:"PushItem",identifier:"DMUPropertiesHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUProperties.png"},DMUHideShowHdr:{type:"PushItem",identifier:"DMUHideShowHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUHideShow.png"},DMUCutHdr:{type:"PushItem",identifier:"DMUCutHdr",module:"DMUBaseCommands",iconPath:"icons/32/I_DMUCutCmd.png"},DMUCopyHdr:{type:"PushItem",identifier:"DMUCopyHdr",module:"DMUBaseCommands",iconPath:"icons/32/I_DMUCopyCmd.png"},DMUDeleteHdr:{type:"PushItem",identifier:"DMUDeleteHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUDelete.png"},DMUCutUncutHdr:{type:"PushItem",identifier:"DMUCutUncutHdr",module:"DMUSection",iconPath:"icons/32/I_WebClippingUncutObjectMgt.png"}},s=function(e){return e&&e.getComponent?e.getComponent(WAfrStandardComponentKey.HandlerComponent):void 0};return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];return e&&e.length&&e.forEach((function(e){e._clippingPosPanelUI&&e._clippingPosPanelUI.isShow()||-1!==t.indexOf(e.getType())||t.push(e.getType())})),1!==t.length||-1===t[0].indexOf("DMUClipping")&&-1===t[0].indexOf("DMUSection")?[]:this.getContextualMenuCommandList()},getContextualMenuCommandList:function(){var e=this;this._executionContext&&!this._handler&&(this._handler=s(this._executionContext));var t,n,a=[],c=this.isInEdition(),p=(t=!0,(!(n=i.getReviewContext({viewer:e._viewer}).getCurrentSessionMarkup())||n&&!n.getActiveFlag()||n&&n.getActiveFlag()&&!n.isVisible()||n&&n.getActiveFlag()&&n.isVisible()&&n.isReadOnly()||n&&n.getActiveFlag()&&n.isVisible()&&!n.isReadOnly()&&!n.getCurrentSlide())&&(t=!1),t),d=p&&this.isSinglePlaneMode()&&this.getAttribute("bSectionCurvesVisible");c&&a.push({line:1,name:"DMUExitClippingEditionStr",hdr_list:["DMUExitClippingEditionHdr"]}),p&&"DMUSection"===this.getType()&&a.push({line:1,name:"DMUHideShowStr",hdr_list:["DMUHideShowHdr"]}),this.isEditable()?(a.push({line:1,name:"DMUPropertiesStr",hdr_list:["DMUPropertiesHdr"]}),this.isConstructionItemMode()||a.push({line:1,name:"DMUClippingPositionStr",hdr_list:["DMUClippingPositionHdr"]}),a.push({line:1,name:"DMUCutUncutStr",hdr_list:["DMUCutUncutHdr"]}),c&&d&&p&&a.push({line:1,name:"DMUContourViewerStr",hdr_list:["DMUContourViewerHdr"]}),a.push({line:1,name:"DMUAlignViewPointStr",hdr_list:["DMUAlignViewHdr"]}),p&&(a.push({line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}),a.push({line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]}),a.push({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}))):this.isEditable()||a.push({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}),this.cmdHdrState_list=[],this.cmdHdrState_list.push({name:"DMUContourViewerHdr",state:this.isSecondaryViewerShow()}),a.length||(a=null);let u=a;return e._executionContext&&a&&a.length>0&&(u=[],a.forEach((t=>{if(t&&t.hdr_list&&t.hdr_list.length){var i=t.hdr_list[0];let n,a=r[i].type;const c=e.cmdHdrState_list.find((e=>e.name===i));"RadioItem"!==a&&"CheckItem"!==a||c&&c.state&&(n="selected"),u.push({type:a,handlerId:r[i].identifier,title:l[i],state:n,icon:r[i].iconPath?o.getWebappsAssetUrl(r[i].module,r[i].iconPath):void 0,action:{this:e,callback:function(t){e._handler||(e._handler=s(e._executionContext)),t&&e._handler.executeHandler({id:t})}.bind(this,i)}})}}))),u},getSharedContextualCommandList:function(e){var t=[];return e&&e.length&&e.forEach((function(e){e._clippingPosPanelUI&&e._clippingPosPanelUI.isShow()||-1!==t.indexOf(e.getType())||t.push(e.getType())})),t.length>=1&&(-1!==t[0].indexOf("DMUClipping")||-1!==t[0].indexOf("DMUSection"))?this.getContextualCommandList():[]},getContextualCommandList:function(){this._executionContext&&!this._handler&&(this._handler=s(this._executionContext));var e=null;let t,o;if(this.isInEdition()){var l,r,c,p=this.getAttribute("sPlaneBoxMode");if(o="ConstructionItemMode"===p||a.isClippingEligibleForStoreyMode(this._viewer,i.getContextViewer({viewer:this._viewer})),"3dPlay"!==this._typeApps&&"DMUSection"!==this.getType()&&(t="BoxMode"===p?"ClippingDisplayModeBoxHdr":"SliceMode"===p?"ClippingDisplayModeSliceHdr":"ConstructionItemMode"===p?"ClippingDisplayModeStoreyHdr":"ClippingDisplayModePlaneHdr",o?(l={name:"ClippingDisplayModeWithStorey",line:1,hdr_list:["DMUClippingDisplayModeStoreyHdr","DMUClippingDisplayModePlaneHdr","DMUClippingDisplayModeSliceHdr","DMUClippingDisplayModeBoxHdr"],selectedHdr:"DMU"+t},c={name:"ClippingPositionWithStorey",line:1,hdr_list:["DMUClippingReverseHdr"]}):l={name:"ClippingDisplayMode",line:1,hdr_list:["DMUClippingDisplayModePlaneHdr","DMUClippingDisplayModeSliceHdr","DMUClippingDisplayModeBoxHdr"],selectedHdr:"DMU"+t}),"ConstructionItemMode"!==p){if("3dPlay"!==this._typeApps){let e="BoxMode"===p?["DMUClippinBoxWithObjectsHdr","DMUResetClippingBoxHdr"]:"SliceMode"===p?["DMUClippinSliceWithObjectsHdr","DMUResetClippingSliceHdr"]:["DMUClippinPlaneWithObjectsHdr","DMUResetClippingPlaneHdr"];r={name:"BoxMode"===p?"ClippingDefBox":"SliceMode"===p?"ClippingDefSlice":"ClippingDefPlane",line:1,hdr_list:e,selectedHdr:"Reset"===this._lastClippingDefHdr?e[1]:e[0]}}c={name:"ClippingPosition",line:1,hdr_list:["DMUClippingNormalToXHdr","DMUClippingNormalToYHdr","DMUClippingNormalToZHdr","DMUClippingNormalUserHdr","DMUClippingReverseHdr"],selectedHdr:this._lastPoshdr?this._lastPoshdr:"DMUClippingNormalToXHdr"}}e=[],l&&e.push(l),r&&e.push(r),c&&e.push(c),n.isEnvActivated("clippingDeleteCmdInContextBar",!0)&&e.push({name:"ClippingDelete",line:1,hdr_list:["DMUSectionDeleteSectionHdr"]})}else e=[{name:"DMUEditClipingstr",line:1,hdr_list:["DMUClippingEditionHdr"]}];t&&this._handler&&this._handler.setRadioItemState({id:t,radioId:o?"ClippingDisplayModeWithStorey":"ClippingDisplayMode",state:!0,args:{ID:t,Value:null}});let d=e;return this._executionContext&&e&&e.length>0&&(d=[],e.forEach((e=>{e&&e.hdr_list&&e.name&&d.push({type:"handler",identifier:"DMUEditClipingstr"!==e.name&&"ClippingPositionWithStorey"!==e.name||!e.hdr_list.length?e.name:e.hdr_list[0]})}))),d},applyStateToContextHdr:function(e){if(e.length>0)for(var i=0;i<e.length;i++){var n=t.getCommand(e[i].name,"Default");n&&n.setState&&n.setState(e[i].state)}},setCheckCmdHdrState:function(e){this.applyStateToContextHdr&&e.length>0&&this.applyStateToContextHdr(e)},getSharedHeaderTypes:function(){return{}},register:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:e.type?e.type:"DMUClipping",module:"DMUSection",workbenchName:"DMUSection"},contextualMenu:{type:e.type?e.type:"DMUClipping",module:"DMUSection",workbenchName:"DMUSection"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:e.type?e.type:"DMUClipping",module:"DMUSection",workbenchName:"DMUSection"},contextualMenu:{type:e.type?e.type:"DMUClipping",module:"DMUSection",workbenchName:"DMUSection"}})}})})),define("DS/DMUSection/DMUSectionSecondaryViewer",["DS/DMUControls/EXPSecondaryViewer","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/DMUBaseExperience/EXPToolsVisualization","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUControls/assets/nls/DMUControls"],(function(e,t,i,n,o,a){"use strict";return e.extend({init:function(e){var t=this._setupOptions(e);this._sectionObj=e,this._parent(t),this._setupViewer(e),this.addCommands(),this.show()},_setupOptions:function(e){return{body:e._frmWindow.getUIFrame(),height:"378",width:"360",title:a.sectionsecondaryviewer,position:{top:"50",left:"50"}}},_setupViewer:function(e){var o=e._viewer.backgroundColor;this._viewerSecondary.setBackgroundColor(o),this._bgColorDefault=!0;var a=e.getSectionCurvesFor2DViwer();this._viewerSecondary.addNode(a);var l={viewer:this._viewerSecondary};this._viewpointSec=new i(l),this._viewpointSec.onMove(this._viewerSecondary.render),this._viewerSecondary.addViewpoint(this._viewpointSec),this._viewpointSec.setDefaultController(!0,"CATIA"),this._viewpointSec.control.setRotationActive(!1);var r=this._viewpointSec.getAngle(),s=a.bSphere,c=s.center,p=1.5*s.radius/Math.tan(r/2);n.moveViewpoint({viewpoint:this._viewerSecondary.currentViewpoint,target:c,sightDirection:new t.Vector3(0,0,1),upDirection:new t.Vector3(0,1,0),targetDistance:p,duration:0})},render:function(){this._viewerSecondary.render()},addCommands:function(){for(var e=o.getWebappsAssetUrl("DMUSection","icons/32/"),i=[{className:"secondaryViewerRotateCWCmd",nls:a.rotateClockwise,url:e+"I_3DSHAREPRORotateCW.png",callback:function(e){var t=.5*Math.PI;e._rotateViewpoint(t)}},{className:"secondaryViewerRotateCCWCmd",nls:a.rotateCounterClockwise,url:e+"I_3DSHAREPRORotateCCW.png",callback:function(e){var t=-.5*Math.PI;e._rotateViewpoint(t)}},{className:"secondaryViewerFlipVerticalCmd",nls:a.flipVertical,url:e+"I_SectionWebInvertVertical.png",callback:function(e){var i=e.options.viewer.currentViewpoint,n=i.getTarget(),o=i.control.orientation.clone(),a=i.getUpDirection(),l=Math.PI,r=(new t.Quaternion).setFromAxisAngle(a,l);o.multiplyQuaternions(r,o.clone());var s=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:o,distanceToTarget:s,duration:400})}},{className:"secondaryViewerFlipHorizontalCmd",nls:a.flipHorizontal,url:e+"I_SectionWebInvertHorizontal.png",callback:function(e){var i=e.options.viewer.currentViewpoint,n=i.getTarget(),o=i.control.orientation.clone(),a=i.getUpDirection(),l=i.getSightDirection(),r=(new t.Vector3).crossVectors(a,l).normalize(),s=Math.PI,c=(new t.Quaternion).setFromAxisAngle(r,s);o.multiplyQuaternions(c,o.clone());var p=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:o,distanceToTarget:p,duration:400})}},{className:"secondaryViewerBgColorCmd",nls:a.switchBgColor,url:e+"I_MldColor2.png",callback:function(e){if(e._bgColorDefault){var t=e._sectionObj.getAttribute("cFillStyleColor");e._viewerSecondary.setBackgroundColor(t.getHex())}else{var i=e._sectionObj._viewer.backgroundColor;e._viewerSecondary.setBackgroundColor(i)}e._bgColorDefault=!e._bgColorDefault}}],n=0;n<i.length;n++)this.addButton(i[n])},_rotateViewpoint:function(e){var i=this.options.viewer.currentViewpoint,n=i.getTarget(),o=i.getEyePosition(),a=i.control.orientation.clone(),l=(new t.Vector3).subVectors(o,n).normalize(),r=(new t.Quaternion).setFromAxisAngle(l,e);a.multiplyQuaternions(r,a.clone());var s=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:a,distanceToTarget:s,duration:400})}})})),define("DS/DMUSection/DMUClippingProperties",["UWA/Core","UWA/Class","DS/Controls/Label","DS/Controls/Toggle","DS/Controls/SpinBox","DS/Controls/ColorPicker","DS/Controls/ComboBox","DS/Visualization/ThreeJS_DS","DS/CATWebUXPreferences/DMUClippingPrefService","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUBaseUIControllers/DMUWebPreferencesController"],(function(e,t,i,n,o,a,l,r,s,c,p){"use strict";return t.extend({init:function(){this.getPropertiesDisplay=function(t,d){var u,g,h,m,S,f,v,C,P,b,D,_,M,x,U,y,w=s.getPrefNLS(),E={},V=!1,N=null,I=!1,O=null,L=!0,A=!1,B=null,k=!1,T=null,F=!1,j=null,R=!1,H=null,W=!1,X=null,z=!1,G=null,q=!1,Z=null,J=!1,Y=null,K=!1,Q=null,$=!1,ee=null,te=!1,ie=null,ne=!1,oe=null,ae=!1,le=null;function re(e,t,i){var n={},o="angle"===e?"Angle":"Length",a=p.readPreferences({name:"cke",PreferenceNames:[o]}).preferences[0].value;return n.value=c.convert(t,e,i,a),n.unit=p.getCurrentUnit(e).nls,n.nbDecimal=p.getCurrentUnit(e).decimalPlaceRW,n}function se(t,r,s,c){var p,d;switch(E[c]||(E[c]={}),t){case"radio+color":var u=e.createElement("div",{class:"DMUSectionRadioColorboxComboDiv",styles:{display:"flex","align-items":"center"}}).inject(r),g=e.createElement("div",{styles:{"padding-top":"5px","margin-left":"0px"}}).inject(u),h=[];for(let e=0;e<s.options.length;e++){let t=new n({label:s.options[e].nls,value:s.options[e].id,type:"radio",checkFlag:s.options[e].id===s.val}).inject(g);h.push(t),s.onChange&&t.addEventListener("change",(e=>{e.dsModel.checkFlag&&s.onChange(e.dsModel.value)}))}E[c].radio=h;var m=e.createElement("div",{styles:{"padding-bottom":"20px","margin-left":"10px"}}).inject(u),S=new a({value:s.colorValue,alignment:"left"});S.inject(m),E[c].color=S;break;case"color+spin":var f=e.createElement("div",{class:"DMUSectionColorSpinboxComboDiv",styles:{display:"flex","align-items":"center"}}).inject(r);if(E[c].div=f,s.nlsColor){e.createElement("label",{text:s.nlsColor,class:"wux-label",styles:{"padding-right":"10px","font-weight":"inherit"}}).inject(f)}var v=new a({value:s.colorValue,alignment:"left"});if(v.inject(f),E[c].color=v,s.nlsSpin){e.createElement("label",{text:s.nlsSpin,class:"wux-label",styles:{"padding-left":"10px","font-weight":"inherit"}}).inject(f)}var C=e.createElement("div",{styles:{display:"flex","margin-left":"5px",width:"100px"}}).inject(f),P=s.spinerVal;(d=new o({value:P.value,units:P.units,minValue:P.minValue,maxValue:P.maxValue,stepValue:P.stepValue,disabled:s.disableSpinboxAtUncheck&&!s.getValue(),pageStepValue:1})).inject(C),E[c].spinner=d;break;case"color+combo":var b=e.createElement("div",{class:"DMUSectionColorComboDiv",styles:{display:"flex","align-items":"center"}}).inject(r);if(E[c].div=b,s.nlsColor){let e=new i({value:s.nlsColor});e.getContent().setStyles({margin:"0","padding-right":"10px","font-weight":"inherit",background:"none"}),e.getContent().getChildren()[0].setStyles({padding:"0px"}),e.inject(b),E[c].labelColor=e}var D=new a({value:s.colorValue,alignment:"left"});if(D.inject(b),E[c].color=D,s.nlsCombo){let e=new i({value:s.nlsCombo});e.getContent().setStyles({margin:"0px","padding-left":"10px","font-weight":"inherit",background:"none"}),e.getContent().getChildren()[0].setStyles({padding:"0px"}),e.inject(b),E[c].labelCombo=e,e.inject(b)}var _=e.createElement("div",{styles:{display:"flex","margin-left":"5px",width:"100px"}}).inject(b),M=new l({elementsList:s.options,value:s.comboValue,disabled:s.isDisabled&&s.isDisabled(),enableSearchFlag:"undefined"===s.enableSearchFlag||s.enableSearchFlag}).inject(_);E[c].combo=M,s.onChange&&M.addEventListener("change",(e=>{s.onChange(e.dsModel.value)}));break;case"radio+spin":var x=e.createElement("div",{class:"DMUSectionRadioSpinboxComboDiv",styles:{display:"flex","align-items":"center"}}).inject(r);E[c].div=x;var U=e.createElement("div",{styles:{"padding-top":"5px","margin-left":"0px"}}).inject(x),y=[];for(let e=0;e<s.options.length;e++){let t=new n({label:s.options[e].nls,value:s.options[e].id,type:"radio",checkFlag:s.options[e].id===s.val}).inject(U);y.push(t),s.onChange&&t.addEventListener("change",(e=>{e.dsModel.checkFlag&&s.onChange(e.dsModel.value)}))}E[c].radio=y;var w=e.createElement("div",{styles:{display:"flex","padding-bottom":"20px","margin-left":"10px",width:"100px"}}).inject(x),V=s.spinerVal,N=re(V.magnitude,V.value,V.originUnit);(d=new o({value:N.value,units:N.unit,decimals:N.nbDecimal,minValue:re(V.magnitude,V.minValue,V.originUnit).value,maxValue:re(V.magnitude,V.maxValue,V.originUnit).value,stepValue:re(V.magnitude,Math.PI/180,V.originUnit).value,disabled:s.disableSpinboxAtUncheck&&!s.getValue(),pageStepValue:1})).inject(w),E[c].spinner=d;break;case"combo":var I=e.createElement("div",{styles:{display:"grid","grid-template-columns":"50% 50%",margin:"2px 0",width:"150px"}}).inject(r);s.customStyle&&I.setStyles(s.customStyle),e.createElement("span",{text:s.nls,class:"DMUSectionComboSectionTitle",styles:{margin:"auto 0px"}}).inject(I);var O=new l({elementsList:s.options,value:s.val,disabled:s.isDisabled&&s.isDisabled(),enableSearchFlag:"undefined"===s.enableSearchFlag||s.enableSearchFlag}).inject(I);E[c].combo=O,s.onChange&&O.addEventListener("change",(e=>{s.onChange(e.dsModel.value)}));break;case"checkBox":var L=new n({type:"checkbox",label:s.lable,value:s.value,checkFlag:s.checkFlag,mixedState:Boolean(s.mixedState)});L.inject(r),E[c].checkBox=L,s.onChange&&L.addEventListener("change",(e=>{s.onChange(e.dsModel.checkFlag)}));break;case"spin":var A=e.createElement("div",{styles:{display:"flex","grid-template-columns":"50% 50%",margin:"2px 0",width:"150px"}}).inject(r);E[c].div=A;var B=new i({value:s.label});B.getContent().setStyles({margin:"auto 0px","padding-right":"10px",background:"none"}),B.getContent().getChildren()[0].setStyles({padding:"0px"}),B.inject(A),(d=new o({value:parseInt(s.spinerVal.value),units:"px",minValue:parseInt(s.spinerVal.minValue),maxValue:parseInt(s.spinerVal.maxValue),stepValue:s.spinerVal.stepValue,disabled:s.disableSpinboxAtUncheck&&!s.getValue(),pageStepValue:1})).inject(A),E[c].spinner=d,E[c].label=B;break;default:p=e.createElement("div")}return p}function ce(e){return 100*(1-e)}function pe(e){return isNaN(e)?.5:0!==e?1-e/100:1}function de(e){return new r.Color("#"+e)}(function(e){var t=!1;if(e){for(u=0;u<e.length;u++){if(null===(y=e[u].getAttribute("bCustomCappingColor"))||null===y){var i=e[u].getAttribute("cCappingColor");y=!!i}if(null===O?O=y:y!==O&&(O="MixState"),y=e[u].getAttribute("cCappingColor"),null===N?N=y:JSON.stringify(y)!==JSON.stringify(N)&&(N="MixState"),y=e[u].getAttribute("bHatchingDisplay"),null===B?B=y:y!==B&&(B=void 0),y=e[u].getAttribute("cHatchingColor"),null===T?T=y:JSON.stringify(y)!==JSON.stringify(T)&&(T="MixState"),y=e[u].getAttribute("fHatchingLineStyleThickness"),null===j?j=y:y!==j&&(j=void 0),y=e[u].getAttribute("sHatchingAnglesMode"),null===H?H=y:y!==H&&(H="MixState"),y=e[u].getAttribute("fHatchingSingleAngleValue"),null===X?X=y:y!==X&&(X=void 0),y=e[u].getAttribute("fHatchingPitchValue"),null===G?G=y:y!==G&&(G=void 0),y=e[u].getAttribute("bSectionCurvesVisible"),null===Z?Z=y:y!==Z&&(Z=void 0),null===(y=e[u].getAttribute("bCustomContourColor"))||null===y){var n=e[u].getAttribute("cLineStyleColor");y=!!n}null===Y?Y=y:y!==Y&&(Y="MixState"),y=e[u].getAttribute("cLineStyleColor"),null===Q?Q=y:JSON.stringify(y)!==JSON.stringify(Q)&&(Q="MixState");var o=e[u].getAttribute("fLineStyleThickness");o||(o=e[u].getAttribute("fLineStyleThicknessIndex")),(y=o)||(y=e[u].getAttribute("fLineStyleThicknessIndex")),null===ee?ee=y:y!==ee&&(ee=void 0),y=e[u].getAttribute("bClippingPlaneVisible"),null===ie?ie=y:y!==ie&&(ie=void 0),y=e[u].getAttribute("cFillStyleColor"),null===oe?oe=y:JSON.stringify(y)!==JSON.stringify(oe)&&(oe="MixState"),y=e[u].getAttribute("fOpacity"),null===le?le=y:y!==le&&(le=void 0)}t=!0}return t})(t)&&(h=!1,I=!1,"MixState"===O?(O=void 0,I=!0):h=O,V=!1,"MixState"===N?(N=void 0,V=!0):g=N?N.getHexString():void 0,L=!1,A=!1,void 0===B?A=!0:L=B,m=!1,k=!1,"MixState"===T?(T=void 0,k=!0):m=T?T.getHexString():void 0,S=void 0,F=!1,void 0===j?F=!0:j&&(S=j.toString()),f=!1,R=!1,"MixState"===H?(H=void 0,R=!0):f=H,v=void 0,W=!1,void 0===X?W=!0:v=X,C=void 0,z=!1,void 0===G?z=!0:C=G,P=!1,q=!1,void 0===Z?q=!0:P=Z,b=!1,J=!1,"MixState"===Y?(Y=void 0,J=!0):b=Y,K=!1,"MixState"===Q?(Q=void 0,K=!0):D=Q?Q.getHexString():void 0,_=void 0,$=!1,void 0===ee?$=!0:ee&&(_=ee.toString()),M=!1,te=!1,void 0===ie?te=!0:M=ie,ne=!1,"MixState"===oe?(oe=void 0,ne=!0):x=oe?oe.getHexString():void 0,U=void 0,ae=!1,void 0===le?(ae=!0,le="0"):isNaN(le)||(U=ce(le))),function(){var t=e.createElement("div",{styles:{"padding-bottom":"20px"}});t.inject(d);var n={"font-weight":"bold","text-align":"left",background:"none"},o=new i({value:w.cappingSubSection.title});o.getContent().setStyles(n),o.inject(t),se("radio+color",e.createElement("div",{styles:{"margin-left":"10px"}}).inject(t),{options:s.colorRadioOptions,val:I?"None":h?s.colorRadioOptions[0].id:s.colorRadioOptions[1].id,colorValue:V?void 0:void 0===g?s.capping.getColorValue():g},"capping");var a=function(e){E&&E.hatching&&E.hatchingangle&&E.hatchingpitch&&(E.hatching.labelColor&&(E.hatching.labelColor.disabled=!e),E.hatching.color&&(E.hatching.color.disabled=!e),E.hatching.labelCombo&&(E.hatching.labelCombo.disabled=!e),E.hatching.combo&&(E.hatching.combo.disabled=!e),E.hatchingangle.radio&&(E.hatchingangle.radio[0].disabled=!e,E.hatchingangle.radio[1].disabled=!e),E.hatchingangle.spinner&&(E.hatchingangle.spinner.disabled=!e),E.hatchingpitch.spinner&&(E.hatchingpitch.spinner.disabled=!e),E.hatchingpitch.label&&(E.hatchingpitch.label.disabled=!e))},l=new i({value:w.hatchingSubSection.title});l.getContent().setStyles(n),l.inject(t);var r=e.createElement("div",{styles:{"margin-left":"10px"}}).inject(t);se("checkBox",r,{lable:w.hatchingSubSection.displayHatchingCheckboxLbl,value:"DMUDisplayHatching",checkFlag:L,mixedState:A,onChange:function(e){a(e)}},"hatching"),se("color+combo",r,{nlsColor:w.hatchingSubSection.hatchingColorLbl,nlsCombo:w.hatchingSubSection.hatchingThicknessLbl,options:F?s.contourThicknessComboOptionsWithNA:s.contourThicknessComboOptions,colorValue:k?void 0:m,comboValue:F?void 0:void 0===S?s.hatching.getThicknessValueToSet():S},"hatching");var c=s.hatching.getSingleAngleValueInfos();R||W?c.value=void 0:void 0!==f&&(c.value=v),c.originUnit="Radian",se("radio+spin",r,{options:s.anglesRadioOptions,val:R?"None":void 0===f?s.hatching.getAnglesMode():f,spinerVal:c},"hatchingangle"),c=s.hatching.getPitchValueInfos(),z?c.value=void 0:void 0!==C&&(c.value=C),se("spin",r,{label:w.hatchingSubSection.hatchingPitchLbl,spinerVal:c},"hatchingpitch"),a(L);var p=new i({value:w.contourSubSection.title});p.getContent().setStyles(n),p.inject(t);var u=e.createElement("div",{styles:{"margin-left":"10px"}}).inject(t);se("checkBox",u,{lable:w.contourSubSection.computeCheckboxLbl,value:"DMUComputeContour",checkFlag:P,mixedState:q},"contour"),se("radio+color",u,{options:s.colorRadioOptions,val:J?"None":b?s.colorRadioOptions[0].id:s.colorRadioOptions[1].id,colorValue:K?void 0:void 0===D?s.contour.getColorValue():D},"contour"),se("combo",u,{options:$?s.contourThicknessComboOptionsWithNA:s.contourThicknessComboOptions,nls:w.contourSubSection.thicknessComboboxLbl,val:$?void 0:_},"contour");var y=new i({value:w.representationSubSection.title});y.getContent().setStyles(n),y.inject(t);var N=e.createElement("div",{styles:{"margin-left":"10px"}}).inject(t);se("checkBox",N,{lable:w.representationSubSection.displayCheckboxLbl,value:"DMUClippingPlaneDisplay",checkFlag:M,mixedState:te},"representation"),c=s.sectionPlane.getTransparencyValue(),ae?c.value=void 0:void 0!==U&&(c.value=U),se("color+spin",N,{nlsColor:w.representationSubSection.colorBtn,nlsSpin:w.representationSubSection.transparencySpinnerboxLbl,spinerVal:c,colorValue:ne?void 0:void 0===x?s.sectionPlane.getColorValue():x},"representation")}(),this.getPropertiesToSet=function(){pe();var e,t,i,n,o,a=[],l=E.capping.radio,r=l[0].checkFlag,s=l[1].checkFlag;(r||s)&&r!==O&&a.push({name:"bCustomCappingColor",value:r}),(t=E.capping.color.value)&&(t=de(t),JSON.stringify(N)!==JSON.stringify(t)&&(a.push({name:"cCappingColor",value:t}),N=t));var d=E.hatching.checkBox;d.mixedState||(e=d.checkFlag)!==B&&(a.push({name:"bHatchingDisplay",value:e}),B=e),(t=E.hatching.color.value)&&(t=de(t),JSON.stringify(T)!==JSON.stringify(t)&&(a.push({name:"cHatchingColor",value:t}),T=t)),(n=E.hatching.combo.value)&&parseFloat(n)!==j&&"0"!==n&&(a.push({name:"fHatchingLineStyleThickness",value:parseFloat(n)}),j=parseFloat(n));var u,g,h,m,S,f=E.hatchingangle.radio,v=f[0].checkFlag,C=f[1].checkFlag;if(v||C){var P=v?"Single":"Various";P!==H&&(a.push({name:"sHatchingAnglesMode",value:P}),H=P)}u="angle",g=E.hatchingangle.spinner.value,h="Radian",m="angle"===u?"Angle":"Length",S=p.readPreferences({name:"cke",PreferenceNames:[m]}).preferences[0].value,(o=c.convert(g,u,S,h))===X||isNaN(o)||(a.push({name:"fHatchingSingleAngleValue",value:o}),X=o),(o=E.hatchingpitch.spinner.value)===G||isNaN(o)||(a.push({name:"fHatchingPitchValue",value:o}),X=o);var b=E.contour.checkBox;b.mixedState||(e=b.checkFlag)!==Z&&(a.push({name:"bSectionCurvesVisible",value:e}),Z=e),r=(l=E.contour.radio)[0].checkFlag,s=l[1].checkFlag,(r||s)&&r!==Y&&(a.push({name:"bCustomContourColor",value:r}),Y=r),(t=E.contour.color.value)&&(t=de(t),JSON.stringify(t)!==JSON.stringify(Q)&&(a.push({name:"cLineStyleColor",value:t}),Q=t)),(n=E.contour.combo.value)&&parseFloat(n)!==ee&&"0"!==n&&(a.push({name:"fLineStyleThicknessIndex",value:parseFloat(n)}),ee=parseFloat(n));var D=E.representation.checkBox;return D.mixedState||(e=D.checkFlag)!==ie&&(a.push({name:"bClippingPlaneVisible",value:e}),ie=e),(t=E.representation.color.value)&&(t=de(t)),JSON.stringify(t)!==JSON.stringify(oe)&&void 0!==t&&(a.push({name:"cFillStyleColor",value:t}),oe=t),(i=E.representation.spinner.value)===ce(le)||isNaN(i)||(a.push({name:"fOpacity",value:pe(i)}),le=pe(i)),a},this.afterSetProperties=function(e,t){if(e&&t)for(u=0;u<e.length;u++){for(var i=0;i<t.length;i++){var n=t[i];n&&"bSectionCurvesVisible"===n.name&&!1===n.value&&e[u].removeSectionCurve()}e[u].refreshNode(!0)}}}}})})),define("DS/DMUSection/DMUEditClippingCmdMode",[],(function(){"use strict";function e(){}return e.prototype.ComputeCommandMode=function(e,t){return new Promise((i=>{var n=e.getComponent(WAfrStandardComponentKey.CommandsManagerComponent).getRunningCommand();return i(n&&["DMUPositionOverloadHdr","CAT3DComposeMoveHdr","CAT3DComposeWidgetDefaultHdr","CAT3DComposeExamineSelectionHdr"].includes(n)?t.NESTED:t.EXCLUSIVE)}))},e})),define("DS/DMUSection/DMUClippingResizeCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/Selection/CSOManager","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUBaseExperience/DMUContextManager","DS/StateCommandEngine/PathElementAgent","DS/DMUPlaySection/DMUClippingService","DS/CATWebUXPreferences/DMUClippingPrefService","i18n!DS/DMUSection/assets/nls/DMUSection"],(function(e,t,i,n,o,a,l,r){"use strict";return e.extend({init:function(e){this._parent(e,"shared",!0),!this._id&&e.ID&&(this._id=e.ID),this.executionContext&&(this._isRunning=!1),this._keepDefaultController=!0;var i=this;function n(e){var n=e;if(n&&n.length||(n=t.get()),n&&n.length&&n[0].pathElement){var o=n[0].pathElement;i._selectedObject||(i._selectedObject=[]),i._selectedObject.push(o),i.setButtonEnableFlag({btnId:"Ok",enableFlag:!0}),i._addAllSelToHSO()}}function o(){}i.addCSOCB=function(){i._tokensXSO_onPostAdd||(this._tokensXSO_onPostAdd=t.onPostAdd(n)),i._tokensXSO_onPostRemove||(this._tokensXSO_onPostRemove=t.onPostRemove(o))},i.removeCSOCB=function(){i._tokensXSO_onPostAdd&&t.unsubscribe(i._tokensXSO_onPostAdd),i._tokensXSO_onPostRemove&&t.unsubscribe(i._tokensXSO_onPostRemove),i._tokensXSO_onPostAdd=i._tokensXSO_onPostRemove=null},i._destroy=function(){i._dlgBar&&(i._dlgBar.destroy(),i._dlgBar=null),Object.getPrototypeOf(i)._destroy.apply(i,arguments)}},_initPref:function(){},allowManipulation:function(e){return"Measure"===e.object||"Section"===e.object||void 0},setButtonEnableFlag:function(e){var t=document.getElementsByClassName("DMUClippingResizeDlg"),i=e.btnId,n=e.enableFlag,o=null;"Ok"===i?o=t[0].getElementsByClassName("btn-primary"):"Cancel"===i&&(o=t[0].getElementsByClassName("btn-default")),o&&o[0]&&(!0===n?o[0].disabled=!1:!1===n&&(o[0].disabled=!0))},_beginExecute:function(){this.executionContext&&(this._isRunning=!0),this.isFinalStateExecuted=void 0;var e=t.get();if(1===e.length&&this.getFrameWindow){var i=n.getReviewContext({viewer:this.getFrameWindow().getViewer()});i&&(this.section=i.getDMUObjectFromPathElement(e[0].pathElement))}t.empty(),this.addCSOCB(),this.section&&(this.section._posCmdActive=!0,this.section._lastClippingDefHdr="Resize",a.deActivateClipping([this.section],this._viewer,!0)),this._pathElem=new o({agentId:"_pathElem",viewer:this._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"mesh",prePickingMode:"mesh",valuedFromCSO:!1,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[]}),this._selectedObject=[],this._parent()},pauseExecute:function(){this.removeCSOCB(),this.section&&(this.section._posCmdActive=!1),this._pathElem.deactivate(),this._dlgBar.hide(),this.executionContext&&(this._isRunning=!1),this.done()},resumeExecute:function(){this.section&&(this.section._posCmdActive=!0),this.addCSOCB(),this._pathElem.activate(),this._dlgBar.show(),this.executionContext&&(this._isRunning=!0)},cancelExecute:function(){this._parent(),this.executionContext&&(this._isRunning=!1),this.section&&(this.section._posCmdActive=void 0),this.removeCSOCB(),this._pathElem.deactivate(),this._pathElem=null,this._dlgBar&&(this._dlgBar.destroy(),this._dlgBar=null),this.emptyHSO(),this.section&&(a.activateClipping([this.section],this._viewer),this.section.addOrRemoveFromCSO(!0)),this.section=null,this.restoreDefaultController(),this.done()},buildGraph:function(){var e=this;e.changeDefaultController(),e._beginExecute(),e._dlgBar&&(e._dlgBar.removeAll(),e._dlgBar.destroy()),e._dlgBar=new i({className:"DMUClippingResizeDlg"}).inject(e.getFrameWindow().getUIFrame()),e._dlgBar.add({msgType:"primary",message:r.ValidateSelObj,closable:!1,buttons:[{className:"primary",label:r.ok,onClick:function(){e.publish({event:"DMUSectionPosCmdValidated"})}},{className:"default",label:r.cancel,onClick:function(){e.publish({event:"DMUSectionPosCmdCancelled"})}}]});var t=e.createInitialState("initialState");e.setEnterStateAction(t,(function(){e._dlgBar.show(),e.getFrameWindow().getViewer().render(),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!1})}));var n=e.getFinalState();e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:t,iFinalState:n,iAction:function(t){e.cancel(),t()}}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:t,iFinalState:n,iAction:function(t){e.section&&a.resizeClippingFromObject(e.section,{objForBB:e._selectedObject,boxMode:e.section.getAttribute("sPlaneBoxMode"),planeDir:l.planeNormalDir.getDirValue()},e._viewer),e.cancel(),t()}}),document.addEventListener("keydown",(function(t){if(t&&("Enter"===t.key||13===t.keyCode)&&!1===t.ctrlKey&&!1===t.altKey&&!1===t.shiftKey&&!1===t.metaKey){var i=document.getElementsByClassName("DMUClippingResizeDlg");if(i&&i.length){var n;(n=i[0].getElementsByClassName("btn-primary"))&&n[0]&&!1===n[0].disabled&&e.publish({event:"DMUSectionPosCmdValidated"})}}})),e.addTransition({iEvent:e._pathElem,iInitialState:t,iFinalState:t,iCondition:function(t){var i=t[0].pathElement;return e._selectedObject.push(i),!0},iAction:function(t){e.setButtonEnableFlag({btnId:"Ok",enableFlag:!0}),t(),e._addAllSelToHSO()}})},_addAllSelToHSO:function(){this._selectedObject.forEach((e=>{this.addInHSO({path:e},!0)}))}})})),
/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/DMUSection/CATWebUXCutElementsDialogContent",["UWA/Core","UWA/Controls/Abstract","DS/WebappsUtils/WebappsUtils","DS/Controls/Button","DS/Controls/SelectionChips","DS/UIKIT/Spinner","i18n!DS/DMUSection/assets/nls/DMUSection","css!DS/DMUSection/DMUSection.css"],(function(e,t,i,n,o,a,l){"use strict";return t.extend({defaultOptions:{className:"",cutUncutStatus:1},init:function(t){var r,s,c,p,d=t||{};d.className=d.className||"",this._parent(d),this.transitionTime=d.animationOff||this._debugmode?0:200,this.elements.container=e.createElement("div",{class:"CATWebUXCutElementsDialogContent"+this.options.className});let u=t.cutUncutStatus,g=t.onRemoveChip,h=t.onCutUncutStatusModify,m=i.getWebappsBaseUrl(),S=e.createElement("div",{class:"CATWebUXCutUncutModeMain"}).inject(this.elements.container),f=(r=new n({displayStyle:"normal",label:l.clippingCutUncutPanel.cutSelectedElemBnt,icon:{iconPath:m+"DMUSection/assets/icons/32/I_WebCutObjects.png",iconSize:{height:"32px",width:"32px"}},type:"check",checkFlag:0!==u}).inject(S)).getContent();f.addClassName("CATWebUXCutMode"),f.addEventListener("buttonclick",(function(){s&&(s.checkFlag=!1),h()}));let v=(s=new n({displayStyle:"normal",label:l.clippingCutUncutPanel.uncutSelectedElemBnt,icon:{iconPath:m+"DMUSection/assets/icons/32/I_WebUncutObjects.png",iconSize:{height:"32px",width:"32px"}},type:"check",checkFlag:0===u}).inject(S)).getContent();v.addClassName("CATWebUXUncutMode"),v.addEventListener("buttonclick",(function(){r&&(r.checkFlag=!1),h()})),new e.Element("hr",{class:"CATWebUXUncutSeparator"}).inject(this.elements.container);let C=e.createElement("div",{class:"CATWebUXCutUncuSelectionChipsMain"}).inject(this.elements.container);(c=new o({noContextMenu:!0,placeholder:l.clippingCutUncutPanel.noSelection,identifier:"UniqueIdentifier",selection:{toggle:!1,mode:o.SELECTION_MODE.SINGLE,unselectAllOnEmptyArea:!1}}).inject(C)).getContent().addClassName("CATWebUXCutUncutSelectionChips"),c.addEventListener("onPostRemove",(function(e){e.options&&e.options.chips&&g(e.options.chips)})),this.showLoadingUI=function(){p||(p=(new a).inject(c.getContent())),p.show()},this.hideLoadingUI=function(){p&&p.hide()},this.destroyLoadingUI=function(){p&&p.destroy(),p=null},this.getCutMode=function(){return r.checkFlag},this.addChips=function(e){c&&c.addChips(e)},this.removeChip=function(e){c&&c.removeChip(e)},this.getAllChipsOptions=function(){if(c)return c.getAllChipsOptions()},this.getBaseURL=function(){return m}},getContainer:function(){return this.elements.container}})})),define("DS/DMUSection/DMUSelectiveSectionContextCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUControls/EXPLevelSelector","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","i18n!DS/DMUSection/assets/nls/DMUSection"],(function(e,t,i,n,o,a,l,r){"use strict";return e.extend({init:function(e){this._parent(e,"exclusive",!0)},_beginExecute:function(){var e=l.getReviewContext({viewer:this.getFrameWindow().getViewer()});e&&(this._section=e.getDMUObjectFromPathElement(a._items[0].pathElement),this._pathElementAgentForSection=null,this._firstSelectedPathElement=null,this._selectedPathElement=null,this._pathElementAgentForSection=new i({agentId:"_pathElementAgentForSection",frameWindow:this._frmWindow,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!0,saveToCSO:!1,multiAcquisition:!0,multiAcquisitionCtrl:!0,acceptedGeometries:[]})),this._parent()},cancelExecute:function(){this._parent(),this._pathElementAgentForSection=null,this._levelSelector&&this._levelSelector.clean(),this._firstSelectedPathElement=null,this._selectedPathElement=null,this._section=null,this._viewer.render(),this.restoreDefaultController(),this.done()},buildGraph:function(){this.changeDefaultController(),this._beginExecute();var e=this.createInitialState("initialState"),i=this.getFinalState(),a=this;this.setEnterStateAction(e,(function(){this.sendNotify("info",r.notifyobjectselection)})),this.setExitStateAction(e,(function(){this.cleanNotify()}));var l={iEvent:this._pathElementAgentForSection,iInitialState:e,iFinalState:e,iCondition:function(e){var i=!1;if(e&&void 0!==e[0].pathElement.getLastElement().sgNode){var n=e[0].pathElement;if(void 0!==n){var o=t.getLastReference(n);if(o){var a=o.getLastElement();t.isReference(a)&&(i=!0)}}}return i},iAction:function(e,i){a._levelSelector&&a._levelSelector.clean(),a._firstSelectedPathElement=i[0].pathElement.clone(),a._selectedPathElement=i[0].pathElement.clone();var l=function(){var e,t=[];t.push(a._selectedPathElement),(e=t)&&a._section&&(a._section.setObjects(e),n.addInCSO(a._section,!1),a._section._viewer.render())};a._levelSelector=new o({iFrameWindow:this._frmWindow,iGetPathElementCB:function(){return t.getLastReference(a._firstSelectedPathElement)},iFilterNodeCB:function(e){return t.isReference(e)},iGet3DPositionCB:function(){var e=a._selectedPathElement.getBoundingSphere(a._viewer).center;return e.x=e.x-60,e.y=e.y-60,e},iOnLevelSelectCB:function(e){a._selectedPathElement=e.pathElement.clone(),l()}}),l(),e&&e()}};this.addTransition(l),this.addEmptySelectionTransition(e,i,(function(e){this._section._itfContextbar&&this._section._itfContextbar.clear(),this.cancel(),e&&e()}))}})})),define("DS/DMUSection/DMULockUnlockSection",["DS/DMUSection/DMUClippingCmd"],(function(e){"use strict";return e})),define("DS/DMUSection/DMUClippingCutUncutCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseExperience/DMUToolsClipping","DS/Visualization/ThreeJS_DS","DS/DMUPlaySection/DMUClippingService","DS/DMUMeasurable/DMUToolsSceneGraph","DS/StateCommandEngine/PathElementAgent","DS/Selection/CSOManager","DS/DMUSection/CATWebUXCutElementsDialogContent","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel","DS/LevelSelector/LevelSelector","i18n!DS/DMUSection/assets/nls/DMUSection","css!DS/DMUSection/DMUSection.css"],(function(e,t,i,n,o,a,l,r,s,c,p,d,u,g,h){"use strict";let m;return e.extend({init:function(e){var S=this;S._parent(e,"shared",!0),S.contextViewer=t.getContextViewer({viewer:S._viewer});let f=S.getFrameWindow(),v=!1,C=!1;var P,b,D,_;let M;function x(){var e=g._noAnim;g._noAnim=!0,g.destroyView(),g._noAnim=e}function U(e){if(_)return _;if(!e&&!D)return;let t=e||D,i=t.getParent?t.getParent():void 0;return i&&(_=i.getAttribute("oLinksManager")),_}function y(){var e=[],t=S._selectionInfo.id,i=t.length,n=U(D);if(n&&i>0)for(var o=0;o<i;o++){var a,l=n.getChildWithID(t[o]);l&&(a=n.getOccurrenceIdPath(l.path)),a&&e.push(a)}return e}function w(e,t,i){let n;var o=U(D);if(o){var a=o.getChildWithID(e);if(a&&(n=o.getOccurrenceIdPath(a.path)),n){D.getNode()._enableClippingPlaneforCutUncut([n],b&&b.getCutMode(),{doNotApplyHatching:!0,toRemove:!0,addClippingOnRoot:t,getSelectedObjectsIdsPat:y,listPathElem:i}),f.getViewer().render()}}}function E(e){let t=isNaN(e)?S._selectionInfo.path.length-1:e;if(t>-1){let e,i=S._selectionInfo.path.splice(t,1),n=S._selectionInfo.name.splice(t,1),o=S._selectionInfo.id.splice(t,1);o&&o.length&&(e=o[0],e?e=parseInt(e):n&&n.length&&(e=n[0])),w(o[0],0===S._selectionInfo.id.length,i),function(e){if(!e)return;let t=-1;if("number"==typeof e){let n=b.getAllChipsOptions();for(var i=0;i<n.length;++i)if(n[i].id===e){t=i,v=!0;break}}b&&-1!==t&&b.removeChip(t)}(e)}}function V(e,t,i){S._selectionInfo.path.push(e),i&&M(e,i.pos);var n=U(D);let o=t&&t.id?t:n.getOccurrence({pathElement:e},!0);if(!o||!o.id||!o.path)return;o&&S._selectionInfo.id.push(o.id),function(e,t,i){if(!e)return;let n=t.getOccurrenceIdPath(e);if(!n)return;let o=D.getNode();1===S._selectionInfo.id.length&&(o.clean(),o._makePlanedata(),o.updateClippingPlaneWithMaterial(D.getAttribute("sPlaneBoxMode"),!0)),o._enableClippingPlaneforCutUncut([n],b&&b.getCutMode(),{doNotApplyHatching:!0,getSelectedObjectsIdsPat:y,listPathElem:i}),f.getViewer().render()}(o.path,n,[e]),b&&b.showLoadingUI();const a={path:e,context:S.contextViewer,pathNum:S._selectionInfo.path.length-1,fromNode:!m,callback:function(e,t){b&&b.hideLoadingUI(),this._selectionInfo.name[t.forPathNum]=t.name;let i=this._selectionInfo.id?this._selectionInfo.id[t.forPathNum]:void 0;if(e!==i)return;let n=i?parseInt(i):void 0;b&&b.addChips([{id:n,label:t.name,index:t.forPathNum,tooltip:new u({title:t.name})}])}.bind(S,o.id)};l.getRefInstNames(a)}function N(){S.emptyHSO(),S._selectionInfo&&S._selectionInfo.path&&S._selectionInfo.path.length&&S._selectionInfo.path.forEach((e=>{S.addInHSO({path:e},!0)}))}function I(e,t){x(),e.forEach((e=>{let i,o=-1;if(i=U(D).getOccurrence({pathElement:e},!0),i&&i.id){if(S._selectionInfo.id.length)for(let e=0;e<S._selectionInfo.id.length;e++){const t=S._selectionInfo.id[e];if(i.id===t){o=e;break}}if(-1!==o)E(o);else{let o=t;if(!o){let t=n.computeBoundingBox(S._viewer,[e]);if(t&&!t.isNaN()&&t.center&&(o=t.center()),!o){let t=n.computeBoundingSphere(S._viewer,[e]);t&&t.center&&(o=t.center)}}V(e,i,{pos:o})}}}))}function O(e){let t=!1;var i=e&&e.getElement?e.getElement(0):void 0;return i&&void 0!==i.name&&"DMUReviewBag"===i.name&&(t=!0),t}function L(e){var t=e;if(t&&t.length||(t=s.get()),t&&t.length&&t[0].pathElement){var i=t[0].pathElement;if(O(i))return;S._selectionInfo.path||(S._selectionInfo.path=[]),S._selectionInfo.id||(S._selectionInfo.id=[]),S._selectionInfo.name||(S._selectionInfo.name=[]);let e=[];window.treatLeafElem?l.parseForLeafNodes(i,S._viewer,e):e.push(i),I(e),N()}}function A(){S._tokensXSO_onPostAdd||(S._tokensXSO_onPostAdd=s.onPostAdd(L))}function B(){S._tokensXSO_onPostAdd&&s.unsubscribe(S._tokensXSO_onPostAdd),S._tokensXSO_onPostRemove&&s.unsubscribe(S._tokensXSO_onPostRemove),S._tokensXSO_onPostAdd=S._tokensXSO_onPostRemove=null}function k(){_=null,x(),S.executionContext&&(S._isRunning=!1),D&&(D._posCmdActive=void 0),B(),S._pathElem&&S._pathElem.deactivate(),S._pathElem=null,P&&(P.destroy(),P=null),S.emptyHSO(),D&&(a.activateClipping([D],S._viewer),C&&(C=!1,D.setInEdition(!0,!1)),D.addOrRemoveFromCSO(!0),D.endManipulation()),D=null}function T(e,i){if(!e)return;let n;i&&(n=b&&b.getCutMode()?1:0),e.setAttribute("iCutUncutMode",n);var o=t.giveEventsController({viewer:f.getViewer()});o&&o.fireEvent("onSaveRequested")}function F(e){k&&k(),S.restoreDefaultController(),e&&e()}function j(e){if(D){let e;e=S._selectionInfo.path.length===S._selectionInfo.id.length?S._selectionInfo.id:function(e){if(e&&S._selectionInfo.path&&S._selectionInfo.path.length){var t=U(e),i=[];return S._selectionInfo.path.forEach((e=>{if(e){var n=t.getOccurrence({pathElement:e},!0);n&&n.id&&i.push(n.id)}})),i}}(D);let t=D.getNode(),i=D.getAttribute("sTargetIds");if(!i||!i.length||e&&0!==e.length||(t.clean(),D.setAttribute("sTargetIds",[]),T(D)),e&&t){t.clean();let i=e.length>0;i?D.setAttribute("sTargetIds",e):D.setAttribute("sTargetIds",[]),T(D,i)}}k&&k(),S.restoreDefaultController();var t=a.retriveCurrentReview(S._viewer);if(t&&t.getCurrentSlide){var i=t.getCurrentSlide();i&&i.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:i})}e&&e()}function R(){S.publish({event:"DMUClippingCutUncutValidated"})}function H(){S.publish({event:"DMUClippingCutUncutCancelled"})}function W(e){if(v)return void(v=!1);if(!e||!e.length)return;let t=e=>{let t=S._selectionInfo.path.splice(e,1);S._selectionInfo.name.splice(e,1),w(S._selectionInfo.id.splice(e,1)[0],0===S._selectionInfo.id.length,t)};if(1===e.length){if(e[0].chipOptions&&void 0!==e[0].chipOptions.index){let i=e[0].chipOptions.id;i=i?i.toString():-1;let n=-1;if(S._selectionInfo.id.some((function(e,t){return e===i&&(n=t,!0)})),n>-1)t(n);else{let i=e[0].chipOptions.label;n=S._selectionInfo.name.indexOf(i),n>-1&&t(n)}}N()}else if(e.length>1){let e=D.getNode();e.clean(),e._makePlanedata(),e.updateClippingPlaneWithMaterial(D.getAttribute("sPlaneBoxMode"),!0),e._enableClippingPlaneforCutUncut([],b&&b.getCutMode(),{doNotApplyHatching:!0,addClippingOnRoot:!0,getSelectedObjectsIdsPat:y}),f.getViewer().render(),S._selectionInfo.path=[],S._selectionInfo.name=[],S._selectionInfo.id=[],b&&b.destroyLoadingUI(),S.emptyHSO()}}function X(){if(!S._selectionInfo.id||!S._selectionInfo.id.length)return;let e=[];var t=U(D);if(S._selectionInfo.id.forEach((i=>{let n;var o=t.getChildWithID(i);o&&(n=t.getOccurrenceIdPath(o.path)),n&&e.push(n)})),e.length){let t=D.getNode();t.clean(),t._makePlanedata(),t.updateClippingPlaneWithMaterial(D.getAttribute("sPlaneBoxMode"),!0),t._enableClippingPlaneforCutUncut(e,b&&b.getCutMode(),{doNotApplyHatching:!0,getSelectedObjectsIdsPat:y,listPathElem:S._selectionInfo.path}),f.getViewer().render()}}function z(e){!function(e){if(e){var t=(b=new c({cutUncutStatus:e.cutUncutStatus,onRemoveChip:e.onRemoveChip,onCutUncutStatusModify:e.onCutUncutStatusModify})).getContent();(P=new p({modalFlag:!1,identifier:"ClippingCutUncutDialog",ensureHeightDefinitionOnHierarchy:!0,title:h.clippingCutUncutPanel.title,content:t,immersiveFrame:e.immersiveFrame,buttons:{Abort:new d({label:h.clippingCutUncutPanel.closeLabel,onClick:function(){H(),P&&P.destroy(),P=null}}),Ok:new d({emphasize:"primary",label:h.clippingCutUncutPanel.okLabel,onClick:function(){R(),P&&P.destroy(),P=null}})},width:240,minWidth:240,resizableFlag:!0})).addEventListener("close",(function(){H()}))}}({cutUncutStatus:e?e.getAttribute("iCutUncutMode"):1,immersiveFrame:f.getImmersiveFrame(),onOKClick:R,onCancelClick:H,onRemoveChip:W,onCutUncutStatusModify:X}),function(){let e=0;S._selectionInfo.path&&S._selectionInfo.path.length&&setTimeout((()=>{let t=S._selectionInfo.path.length,i=function(t){let i;void 0!==t.name&&(S._selectionInfo.name[t.forPathNum]=t.name),b&&b.hideLoadingUI();let n=S._selectionInfo.id&&S._selectionInfo.id[t.forPathNum]?parseInt(S._selectionInfo.id[t.forPathNum]):void 0;i={id:n,label:S._selectionInfo.name[t.forPathNum],index:e,tooltip:new u({title:S._selectionInfo.name[t.forPathNum]})},e++,i&&setTimeout((()=>{b&&b.addChips([i])}),100)};!function(){for(let e=0;e<t;e++)b&&b.destroyLoadingUI(),b&&b.showLoadingUI(),l.getRefInstNames({path:S._selectionInfo.path[e],callback:i,context:S.contextViewer,pathNum:e,fromNode:!m})}()}),100)}()}S.executionContext&&(S._isRunning=!1),M=(e,n)=>{let a=[],r=function(i){a=[];for(var n=l.getLastReference(e),o=[],r=n.externalPath.length,s=0;s<r;++s){var c=n.getLastElement(!0);l.isReference(c)&&(a.push({pathElement:n.clone(),name:c.name,internalLevel:r-s}),o.push(c)),n=n.getParentPath()}var p=S.contextViewer?S.contextViewer:t.getContextViewer({reviewContext:t.getReviewContext({viewer:f.getViewer()})});l.getName(o,(function(e){for(var t=e.length,n=0;n<t;++n)a[n].name=e[n];i()}),p,"");return{currentLevel:0,levels:a}};var s=n;s||(s=new o.Vector3);var c=i.getWindowPositionFromPoint(S._viewer,s,f),p={positionX:c.left,positionY:c.top-110,uiFrame:f.getUIFrame(),selectedPath:r,getLevels:r,onHover:function(e){e&&setTimeout((()=>{S.addInPSO({path:e.pathElement},!0)}),200)},onSelect:function(e){E();let t,i=-1;if(t=U(D).getOccurrence({pathElement:e.pathElement},!0),t&&t.id){if(S._selectionInfo.id.length)for(let e=0;e<S._selectionInfo.id.length;e++){const n=S._selectionInfo.id[e];if(t.id===n){i=e;break}}-1!==i?(E(i),x()):V(e.pathElement),N()}}};x(),g.createView(p)},S._beginExecute=function(){m=a.checkProgOrDynViewModeMode(S.contextViewer),S.executionContext&&(S._isRunning=!0);var e=t.getReviewContext({viewer:f.getViewer()});if(D=function(e){var t;if(e)for(var i=s.get(),n=0;n<i.length;n++){let o=e.getDMUObjectFromPathElement(i[n].pathElement);o&&("DMUClipping"!==o.getType()&&"DMUSection"!==o.getType()||(t=o))}if(!t){let e=a.retriveClippingObjsFromSlide(S._viewer,!0);e&&e.length&&(1===e.length?t=e[0]:e.forEach((e=>{e&&"DMUClipping"===e.getType()&&(t=e)})))}return t}(e),D){D.beginManipulation(),s.empty(),D._clippingPosPanelUI&&D._clippingPosPanelUI.isShow()&&D._clippingPosPanelUI.clear(!0,!0),D&&(D._posCmdActive=!0,C=!1,D.isInEdition()&&(C=!0,D.setInEdition(!1,!1))),S._pathElem=new r({agentId:"_pathElem",viewer:S._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"mesh",prePickingMode:"mesh",valuedFromCSO:!1,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[]}),S._selectionInfo={},S._selectionInfo.path=[],S._selectionInfo.id=[],S._selectionInfo.name=[];let e=D._getListOfPathForCutUnCut();e&&(S._selectionInfo.path=e.listOfSelectedObj,S._selectionInfo.id=e.listOfID),z(D),A()}else S.cancel();N()},S.pauseExecute=function(){_=null,B(),D&&(D._posCmdActive=!1),S._pathElem.deactivate(),P.hide(),S.executionContext&&(S._isRunning=!1),S.done()},S.resumeExecute=function(){_=null,D&&(D._posCmdActive=!0),A(),S._pathElem.activate(),P.show(),S.executionContext&&(S._isRunning=!0),N()},S.buildGraph=function(){S.changeDefaultController(),S._beginExecute();var e=S.createInitialState("initialState");S.setEnterStateAction(e,(function(){f.getViewer().render()}));var t=S.getFinalState();S.addTransition({iSender:S,iEvent:"DMUClippingCutUncutCancelled",iInitialState:e,iFinalState:t,iAction:F}),S.addTransition({iSender:S,iEvent:"DMUClippingCutUncutValidated",iInitialState:e,iFinalState:t,iAction:j}),document.addEventListener("keydown",(function(e){e&&("Enter"!==e.key&&13!==e.keyCode||!1===e.ctrlKey&&!1===e.altKey&&!1===e.shiftKey&&!1===e.metaKey&&R())})),S.addTransition({iEvent:S._pathElem,iInitialState:e,iFinalState:e,iCondition:function(e){var t=e[0].pathElement;return!O(t)&&(I([t],e[0].position),!0)},iAction:function(e){e(),N()}});S.addEmptySelectionTransition(e,e,(function(e){e&&(e(),N())}))},S.cancelExecute=function(){_=null,b&&b.destroyLoadingUI(),k&&k(),S.restoreDefaultController(),S.done()},S.destroy=function(){_=null,S.restoreDefaultController(),S.done()}}})})),define("DS/DMUSection/DMUSectionSecondaryViewerlImpl",["UWA/Class","DS/DMUSection/DMUSectionSecondaryViewer"],(function(e,t){"use strict";return e.extend({init:function(e){var i=null;this.isBuilt=function(){return null!==i},this.build=function(){return i||(i=new t(e)),i},this.isShow=function(){return!!i&&i.isShow()},this.show=function(){i&&i.show()},this.noShow=function(){i&&i.noShow()},this.render=function(){i&&i.render()},this.clear=function(){i&&(i.clear(),i=null)},this.getViewer=function(){if(i)return i.getViewer()}}})})),define("DS/DMUSection/DMUClippingContextCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/DMUMeasurable/DMUSectionPosService","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUPlaySection/DMUToolsSection","DS/DMUPlaySection/DMUClippingService","DS/DMUPlaySection/DMUStoreyNavigratorController","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUSection/DMUSectionSecondaryViewerlImpl","DS/DMUSection/DMUClippingPositionPanel"],(function(e,t,i,n,o,a,l,r,s,c,p){"use strict";var d,u;let g={ClippingDefPlane:["ClippingPlaneWithObjectsHdr","ResetClippingPlaneHdr"],ClippingDefSlice:["ClippingSliceWithObjectsHdr","ResetClippingSliceHdr"],ClippingDefBox:["ClippingBoxWithObjectsHdr","ResetClippingBoxHdr"],ClippingPosition:["ClippingNormalToXHdr","ClippingNormalToYHdr","ClippingNormalToZHdr","ClippingNormalToZHdr","ClippingNormalUserHdr","ClippingReverseHdr"]};var h=e.extend({init:function(e){var t=e||{};if(this._bCmdState=!1,t.mode="DMUSectionDeleteSectionHdr"!==t.ID?"shared":"exclusive",this._parent(t),t&&(this._executionContext=t.executionContext),!this._viewer){if(this._executionContext){let e=this._executionContext.getComponent("Viewer");e&&e.getViewer&&(this._viewer=e.getViewer())}this._viewer||(this._viewer=this.getFrameWindow().getViewer())}this.allowManipulation=function(e){return"Section"===e.object||void 0},this.id=this._id?this._id:this.getId()},beginExecute:function(){var e=this,d=this._viewer?this._viewer:this.getFrameWindow().getViewer();if(function(t){var i="DMUClippingEditionHdr"===t;if("DMUExitClippingEditionHdr"!==t&&!i)return!1;if(!e._executionContext||"DMUClippingEditionHdr"===t){var n=o.getEditCmd(d);n&&(i?n.begin():n.cancel())}return!0}(this.id))this.done();else{if("DMUClippingPositionHdr"===this.id)return function(){let t=v(r.getReviewContext({viewer:d}));t._clippingPosPanelUI?t._clippingPosPanelUI.isBuilt()?t._clippingPosPanelUI.isShow()?t._clippingPosPanelUI.clear():t._clippingPosPanelUI.show():t._clippingPosPanelUI.build():(d||(d=e._viewer?e._viewer:e.getFrameWindow().getViewer()),t._clippingPosPanelUI=new p({frameWindow:e.getFrameWindow(),viewer:d},t),t._clippingPosPanelUI&&t._clippingPosPanelUI.build())}(),void this.done();var u,g=function(e,t,a){if(e.setStoreyNavigatorVisu(!1),a){var l=e.getAttribute("fSliceOffset"),s=e.getAttribute("mPlaneReferential"),c=function(){return"DMUTemporaryBag"!==e.getParent().getType()},p=function(){return r.getContextViewer({viewer:d})};if(!l&&"NormalMode"!==t){var u=n.computeBoundingSphere(d,void 0,c,p),g=o.computeClippingSlice(u,s);if(g||!isNaN(g))l=g;else{let e=n.computeBoundingBox(d,void 0,c,p);var h=i.computePlaneDim(e,s,!1,!0);l=isNaN(h.fSliceOffset)?u.radius:h.fSliceOffset}e.setAttribute("fSliceOffset",l)}}e.getNode().clean(),t!==e.getAttribute("sPlaneBoxMode")&&(e._lastClippingDefHdr=void 0),t&&(localStorage.setItem("DMUClippingBoxMode",t),e.setAttribute("sPlaneBoxMode",t));let m=e.getNode();if(m){let e=m.getRobot();e||(m.initClippingRobot(),e=m.getRobot()),e&&e.updateRobotPos()}e.refreshNode(),d.render()},h=function(e){let t=e||v(r.getReviewContext({viewer:d}));t&&t.sectionViewpoint()},m=t.get();if(1===m.length){var S=r.getReviewContext({viewer:d});if(S){var f=S.getDMUObjectFromPathElement(m[0].pathElement);if(f||"DMUExitClippingEditionHdr"===this.id){switch(this.id){case"DMUClippingDisplayModePlaneHdr":g(f,"NormalMode");break;case"DMUClippingDisplayModeSliceHdr":g(f,"SliceMode",!0),C(f);break;case"DMUClippingDisplayModeBoxHdr":g(f,"BoxMode",!0),C(f);break;case"DMUClippingDisplayModeStoreyHdr":!function(t){let i=t;var n=function(t){var n=t||i._storeyNavigatorcntroller;if(!n){let e="NormalMode";return localStorage.setItem("DMUClippingBoxMode",e),i.setAttribute("sPlaneBoxMode",e),void a.resetClipping(i,d)}let l=o.getStoreyinfoOnSlide(e._viewer);i.setStoreyNavigatorVisu(!0);let r=i.getNode();r&&r.getRobot()&&r.cleanClippingRobot(),l&&n.SetCurrentStorey(l);let s=n.GetPosition3D();i.updateClippingPosAndOrientation(s,!1,!0),o.setStoreyinfoOnSlide(e._viewer,n.GetCurrentStorey()),d.render()};let s="ConstructionItemMode";if(i&&i.getAttribute("sPlaneBoxMode")!==s){i.getNode().clean(),i.setAttribute("sPlaneBoxMode",s);var c=r.getContextViewer({viewer:d});if(i._storeyNavigatorcntroller)n();else{let e=o.getBuildingRootData(d);i._storeyNavigatorcntroller=l.getDMUStoreyNavigratorController({context:c,getBuidlingRootID:()=>e?e.ID:void 0,storyeRetrivalSuccessCB:e=>{n(e)},storyeRetrivalFailCB:()=>{let e="NormalMode";localStorage.setItem("DMUClippingBoxMode",e),i.setAttribute("sPlaneBoxMode",e),a.resetClipping(i,d)}})}}}(f),C(f);break;case"DMUClippinPlaneWithObjectsHdr":case"DMUClippinSliceWithObjectsHdr":case"DMUClippinBoxWithObjectsHdr":default:break;case"DMUResetClippingPlaneHdr":case"DMUResetClippingSliceHdr":case"DMUResetClippingBoxHdr":f._lastClippingDefHdr="Reset",a.resetClipping(f,d);break;case"DMUClippingNormalToXHdr":f.sectionToX(f._lastPoshdr!==this.id),f._lastPoshdr=this.id;break;case"DMUClippingNormalToYHdr":f.sectionToY(f._lastPoshdr!==this.id),f._lastPoshdr=this.id;break;case"DMUClippingNormalToZHdr":f.sectionToZ(void 0,void 0,f._lastPoshdr!==this.id),f._lastPoshdr=this.id;break;case"DMUClippingReverseHdr":f.sectionFlip(!0),f._lastPoshdr=this.id;break;case"DMUContourViewerHdr":(u=f)._iViewerSecondaryWindow?u._iViewerSecondaryWindow.isBuilt()?u._iViewerSecondaryWindow.isShow()?u._iViewerSecondaryWindow.noShow():(u._iViewerSecondaryWindow.show(),u.manageCurvesAndHatching({computeCurves:!0})):u._iViewerSecondaryWindow.build():(u._iViewerSecondaryWindow=new c(u),u._iViewerSecondaryWindow&&u._iViewerSecondaryWindow.build());break;case"DMUAlignViewHdr":h(f);break;case"DMUSectionDeleteSectionHdr":f.getParent().removeDMUObjects?f.getParent().removeDMUObjects([f]):f.getParent().getCurrentSlide().removeDMUObject(f)}S.getCurrentSessionMarkup()&&S.getCurrentSessionMarkup().isVisible()&&S.getCurrentSessionMarkup().getCurrentSlide()&&S.getCurrentSessionMarkup().getCurrentSlide().fireEvent("onSlidePreviewRefreshRequired",{dmuObject:S.getCurrentSessionMarkup().getCurrentSlide()})}}}else"DMUAlignViewHdr"===this.id&&h();this.done()}function v(e){var i;if(e)for(var n=t.get(),o=0;o<n.length;o++){let t=e.getDMUObjectFromPathElement(n[o].pathElement);t&&("DMUClipping"!==t.getType()&&"DMUSection"!==t.getType()||(i=t))}if(!i){let e=a.retriveClippingObjsFromSlide(d,!0);e&&e.length&&(1===e.length?i=e[0]:e.forEach((e=>{e&&"DMUClipping"===e.getType()&&(i=e)})))}return i}function C(e){if(e._iViewerSecondaryWindow&&e._iViewerSecondaryWindow.isShow()){var t=s.getCommand("DMUContourViewerHdr","Default");t&&(t.begin(),t._bCmdState=!1)}}},getState:function(){return this._bCmdState},setState:function(e){this._bCmdState=e}});return h.executeContextualBarCmd=function(e,i){if(!d&&i.executionContext&&(d=i.executionContext),i&&i.args&&i.args.Value){let e=0;var n=setInterval((function(){e++;var o,a=t.get();if(1===a.length){if(!u){let e=d.getComponent("Viewer");e&&e.getViewer&&(u=e.getViewer())}if(u){var l=r.getReviewContext({viewer:u});if(l){var c=l.getDMUObjectFromPathElement(a[0].pathElement);c&&c.getType&&"DMUClipping"===c.getType()&&(o=!0)}}}if(o){let t=s.getCommand(i.args.Value,d);t&&t.begin?(t.begin(),clearInterval(n)):e>20&&clearInterval(n)}else clearInterval(n)}),100)}if(i&&i.args&&i.args.Value&&i.args.ID){let e=i.args.ID,t=g[e],n=i.args.Value.replace("DMU","");t&&d.getComponent(WAfrStandardComponentKey.HandlerComponent).setRadioItemState({id:n,radioId:e,state:!1})}e&&e()},h.executeContextualBarCmdUnset=function(e){e&&e()},h})),define("DS/DMUSection/DMUClippingBaseCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUSwitchRepService","DS/DMUBaseExperience/EXPUtils","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/Selection/CSOManager","DS/Visualization/ThreeJS_DS","DS/DMUSection/DMUClippingPrecisePosCmd","DS/DMUPlaySection/DMUClippingService","DS/DMUControls/EXPNotify"],(function(e,t,i,n,o,a,l,r,s,c,p,d){"use strict";var u=e.extend({init:function(e,t,i){this._parent(e,t,i),this._context=e.context,this.sendNotify||(this.sendNotify=function(e,t,i){return this._notification&&this._notification.destroy(),this._notification=new d({body:this._frmWindow.getUIFrame(),type:e,notificationType:"HelpNotification",message:t,duration:i,autoHide:"number"==typeof i&&i>0}),this._notification}),a.setAuthoringFeatureTypes("Section")},checkAndCreateReviewContext:async function(){if(!a.getReviewContext({viewer:this.getFrameWindow().getViewer()})){let e=a.getContextViewer({viewer:this.getFrameWindow().getViewer()});await l.createReviewContext({context:e})}},begin:function(){if(!this._isRunning){var e=o.getCommand(o.getCurrentCmdId(this._ctx),this._ctx),t=e&&e.getRequestedCommandMode?e.getRequestedCommandMode({cmd:"Section"}):"exclusive";this._mode="shared"===t?"shared":"exclusive"}this._parent.apply(this,arguments)},setCommandMode:function(e){this._sectionCommandMode=void 0,"ProgressiveVisuLoading"===e&&(this._sectionCommandMode="ProgressiveVisuLoading")},_beginExecute:function(){var e=this;if(e.csoList=void 0,this._viewer.currentViewpoint.setDefaultController(!1,"FLY_WALK"),e.clippingPrecisePosCmd=void 0,e.isInCreation){let l=localStorage.getItem("DMUClippingBoxMode")||"NormalMode";e.clippingPreSelectedObj=void 0;let p=r.get();if(p&&p.length&&(e.clippingPreSelectedObj=[],p.forEach((function(t){var i=t.pathElement;i&&e.clippingPreSelectedObj.push(i)}))),"NormalMode"===l){if(function(){var n,o,l=e._viewer,s=r.get(),c=s.length,p=[],d=!1;if(c){var u=a.getContextViewer({viewer:e._viewer});for(u.getController&&(e._viewerController=u.getController()),e._switchService||(e._switchService=new i({viewer:l})),n=0;n<c;n++){var g,h,m=[];if(h=t.isOOCTileSetNodeInPath(s[n].pathElement),s[n].pathElement&&s[n].pathElement.getLastElement())if(s[n].pathElement.getLastElement().sgNode||t.isPathToAxisSystem(s[n].pathElement)||h){if(!h)if(e._switchService.retriveNodesFromPath(s[n].pathElement,m),m&&m.length)for(o=0;o<m.length;o++)g=m[o],s[n].pathElement&&s[n].pathElement.getLastElement&&(e._viewerController.hasMeshInRAM(t.getNodeID(g))&&"thumbnail"!==e._viewerController.getLoadedStream(g)||(p.push(s[n]),d=!0));else p.push(s[n]),d=!0}else p.push(s[n]),d=!0;else p.push(s[n]),d=!0}}d&&p.length&&p.forEach((function(e){r.remove(e)}))}(),r.get().length){e.clippingPreSelectedObj=[],e.clippingPrecisePosCmd=o.getCommand("DMUSectionPreSelectPrecisePosHdr",e._context),e.clippingPrecisePosCmd||(e.clippingPrecisePosCmd=new c({context:this._context,ID:"DMUSectionPreSelectPrecisePosHdr",isEnabled:!0})),e.csoList=[];r.get().forEach((function(t){var i;t.normal&&t.tangent&&t.position||(i=function(t){if(t&&t.event){var i=t.event.currentPosition?t.event.currentPosition:t.event.from?t.event.from[0].currentPosition:new s.Vector2(0,0),n=i?e._viewer.getMousePosition(i):void 0;return n?e._viewer.pick(n,"primHybrid",!0):void 0}}(t)),e.csoList.push({pathElement:t.pathElement?t.pathElement.clone():void 0,position:t.position?t.position.clone():i&&i.position?i.position:void 0,normal:t.normal?t.normal.clone():i&&i.normal?i.normal:void 0,tangent:t.tangent?t.tangent.clone():i&&i.tangent?i.tangent.clone():void 0})}))}}else e.clippingPrecisePosCmd=void 0;e._bProfiling&&window.console&&window.console.profile&&window.console.profile("Section"),n._sendUsageProbe("command","Section")}this.beginCB(void 0,!0),this._parent()},buildGraph:function(){this.changeDefaultController(),this._beginExecute();var e=this.createInitialState("initialState"),t=this.getFinalState(),i=this;this.setEnterStateAction(e,this._performCallback),this.addEmptySelectionTransition(e,t,(function(e){e&&function(){let e=r.get();var t=!0;let n=p.retriveClippingObjsFromSlide(i._viewer,!0);if(n&&n.length)for(var o=0;o<n.length;o++){let e=n[o].getNode().getRobot(),i=n[o]._clippingPosPanelUI;if(i&&i.isShow()||e&&e.isManipulationOnGo&&e.isManipulationOnGo()){t=!1;break}}if(e&&e.length)for(var a=0;a<e.length;a++){let i=e[a];if(i&&i.pathElement){var l=i.pathElement.getLastElement();if(l&&l.isClippingNode&&l.isClippingNode()){t=!1;break}}}return t}()&&(i.cancel(),e())}))},_destroy:function(){this.clearEvents(),this._parent()}});return u})),define("DS/DMUSection/DMUEditClippingCmd",["DS/DMUSection/DMUClippingBaseCmd","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/DMUToolsClipping","DS/CATWebUXPreferences/DMUClippingPrefService","DS/DMUPlaySection/DMUClippingService","DS/Visualization/ThreeJS_DS","DS/DMUPlaySection/DMUToolsSection","DS/CoreEvents/Events"],(function(e,t,i,n,o,a,l,r){"use strict";var s=e.extend({init:function(e){this._parent(e,"shared",!0),!this._id&&e.ID&&(this._id=e.ID);var i=this;this.executionContext&&(this._isRunning=!1),this._keepDefaultController=!0,this.options=e;let n=e.args;if(e.args){let e=Object.keys(n),t=Object.values(n);this._arguments=[];for(let i=0;i<e.length-1;i++)this._arguments.push({ID:e[i],Value:t[i]})}var a;"ProgressiveVisuLoading"===this._arguments[0].ID&&(this._sectionCommandMode="ProgressiveVisuLoading"),this._appTypeFromArg=i._arguments.length?i._arguments[0].ID:"",i.executionContext&&i._arguments.length&&i._arguments[0].Value&&(this._appTypeFromArg=i._arguments[0].Value);var s,c=t.getContextViewer({viewer:this.getFrameWindow().getViewer()}),p=[];i.beginCB=function(e,n){let l;c&&c.setRobotVisibility&&(a=c.isRobotVisible())&&c.setRobotVisibility(!1),i._eventController||(i._eventController=t.getEventsController({viewer:i._viewer})),i._eventController.fireEvent("onEditCommandStart"),l=e?[e]:o.retriveClippingObjsFromSlide(i._viewer,!0),l&&l.forEach((function(e){if(e){e.updateAppType&&e.updateAppType(i._appTypeFromArg||i._arguments[0].ID);var t=e.getNode();if(t){let i=e._sID?e._sID:"0";t.setPickingInManipulationModeForLineTraslation(!1),e.isSectionDisplayed()&&(n||e.isInEdition())&&t.initClippingRobot(p[i]);let o=t.getRobot();o&&(p[i]=o._getRulerOriginPos())}}}))},i.endExecuteCB=function(){void 0!==a&&c&&c.setRobotVisibility&&c.setRobotVisibility(a),l.cleanClippingVisu(i._viewer)},i.resumeExecute=function(){let e=o.retriveClippingObjsFromSlide(i._viewer,!0),t=!1;e&&e.length?e.forEach((function(e){e&&e.isConstructionItemMode()&&e.setStoreyNavigatorVisu(!0)})):this.executionContext&&(t=!0),this.executionContext&&(this._isRunning=!0,t)?i.cancel():void 0!==s&&s===i._viewer.getVisibleSpace()?i.beginCB():(i.cancel(),p=[])},i.pauseExecute=function(){this.executionContext&&(this._isRunning=!1);let e=o.retriveClippingObjsFromSlide(i._viewer,!0);e&&e.length&&e.forEach((function(t){if(t){t.isConstructionItemMode()&&t.setStoreyNavigatorVisu(!1);let i,n=t._sID?t._sID:"0",o=e[0].getNode();o&&(i=o.getRobot()),i&&(p[n]=i._getRulerOriginPos())}})),i.endExecuteCB(),s=i._viewer.getVisibleSpace(),i.done()},i.getRequestedCommandMode=function(e){return"Measure"===e.cmd||"Section"===e.cmd?"shared":void 0},i.allowManipulation=function(e){return"Measure"===e.object||"Section"===e.object||void 0},i._destroy=function(){!function(){let e=o.retriveClippingObjsFromSlide(i._viewer,!0);e&&e.forEach((function(e){if(e){var t=e.getNode();t&&t.cleanClippingRobot()}}))}(),i._cancelToken&&(r.unsubscribe(i._cancelToken),i._cancelToken=null),Object.getPrototypeOf(i)._destroy.apply(i,arguments)},i._eventController||(i._eventController=t.getEventsController({viewer:i._viewer})),i._eventController&&(i.initClippingVisuCb=i._eventController.addEvent("initClippingVisu",(e=>{i.beginCB(e)}))),this._cancelToken=r.subscribe({event:this._id+"/CANCEL"},(()=>{r.unsubscribe(this._cancelToken),this._cancelToken=null,this.cancelExecute()}))},setCommandMode:function(e){this._parent(e)},_performCallback:async function(){var e=this;await this.checkAndCreateReviewContext();var r={getDefaultValues:async function(){var o=e._appTypeFromArg?e._appTypeFromArg:e._arguments.length?e._arguments[0].ID:"";await n.readClippingPref();let r,s="NormalMode",c=localStorage.getItem("DMUClippingBoxMode");"3dPlay"!==o&&(r=l.isClippingEligibleForStoreyMode(e._viewer,t.getContextViewer({viewer:e._viewer})),r?(s="ConstructionItemMode",e.clippingPreSelectedObj=void 0):c&&(s=c));let p,d=i.computeBoundingBox(e._viewer,e.clippingPreSelectedObj);if("ConstructionItemMode"===s&&d&&d.min&&d.max&&(e.clippingPreSelectedObj=void 0,p=l.computeSectionPlaneReferencial(e._viewer,d,!1,"z"),p)){var u=(new a.Plane).setFromNormalAndCoplanarPoint(new a.Vector3(0,0,1),new a.Vector3(0,0,0));p.setPosition(u.projectPoint(p.getPosition()))}let g=e.clippingPrecisePosCmd;return{appType:o,setInEdit:!0,isClipping:!0,iDoNotChkLockUnlockStatus:!0,sectionCommandMode:e._sectionCommandMode,planeReferential:p,buildingRoot:r,precisePosCmd:g,csoList:e.csoList,bbox:d,boxMode:s,isCustomCappingColor:n.capping.isCustomColor(),isCustomContourColor:n.contour.isCustomColor(),cappingColor:n.capping.getColorToSet(),lineStyleColor:n.contour.getColorToSet(),lineStyleThicknessIndex:n.contour.getThicknessToSet(),bDisplayPermanently:n.sectionPlane.getDisplayStatus(),fillStyleColor:n.sectionPlane.getColorToSet(),opacity:n.sectionPlane.getOpacityVal(),planeDir:n.planeNormalDir.getDirValue(),isHatchingDisplayed:n.hatching.getDisplayStatus(),hatchingColor:n.hatching.getColorToSet(),hatchingThickness:n.hatching.getThicknessToSet(),hatchingAnglesMode:n.hatching.getAnglesMode(),hatchingSingleAngleValue:n.hatching.getSingleAngleToSet(),hatchingPitchValue:n.hatching.getPitchToSet()}}};o.editClipping(e._viewer,r),e.clippingPrecisePosCmd&&e.clippingPrecisePosCmd.isRunning()||i.getClippingCmd(t.getContextViewer({viewer:e._viewer})).setState(!0)},_beginExecute:function(){this.isInCreation=!1;let e=o.retriveClippingObjsFromSlide(this._viewer,!0);e&&0!==e.length||(this.isInCreation=!0),this._parent(),this.executionContext&&(this._isRunning=!0)},cancelExecute:function(){this._parent(),o.editClipping(this._viewer,{},!0),this.endExecuteCB(),this.clippingPreSelectedObj=void 0,this._viewer.currentViewpoint.setDefaultController(!0,"FLY_WALK");var e=o.retriveCurrentReview(this._viewer);if(e&&e.getCurrentSlide){var i=e.getCurrentSlide();i&&i.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:i})}this.executionContext&&(this._isRunning=!1);let n=this._eventController;n||(n=t.giveEventsController({viewer:this._viewer})),n&&n.fireEvent("onSaveRequested"),this._cancelToken&&(r.unsubscribe(this._cancelToken),this._cancelToken=null),this.restoreDefaultController()},clearEvents:function(){this.initClippingVisuCb&&(this._eventController||(this._eventController=t.giveEventsController({viewer:this._viewer})),this._eventController&&this._eventController.removeEvent(this.initClippingVisuCb))}});return s})),define("DS/DMUSection/DMUCreateSectionCmd",["DS/DMUSection/DMUEditClippingCmd"],(function(e){"use strict";return e}));