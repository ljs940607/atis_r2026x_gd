/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationExpController/CAT3DAnnotExpControllerInstance",["DS/CAT3DAnnotationController/CAT3DAnnotBaseControllerInstance","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController","DS/CATWebUXSlideShow/CATWebUXSlideShowController","DS/CAT3DAnnotationAttributeController/CAT3DAnnotationAttributeController","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils","DS/Visualization/SceneGraphUtils","DS/SceneGraphOverrides/SceneGraphOverrideSet","text!DS/CAT3DAnnotationExpController/assets/json/CAT3DAnnotationExpController.json"],(function(t,e,n,o,i,a,r,l,s,g){"use strict";return t.extend({init:function(t){var h=t||{};this._parent(h);var u,f=h.workbenchName||"CAT3DAnnotationWidgetWkb",A=h.moduleName||"CAT3DAnnotationWidget",d=h.ctxViewer,c=this;let p=!1;var m,C,v,y,b,E=!0,T={},P=null,L=JSON.parse(g),S=[],R={visible:[],hidden:[]},D=[],x=function(t){for(var e,n=t.children,o=0;o<n.length&&!e;o++)if(!n[o].getAnnotationClassType)for(var i=n[o].children,a=0;a<i.length;a++)if(i[a].getPathElement&&i[a].setInternalSceneGraph){e=i[a];break}return e};function O(t){if(t){var e=t.getLastElement(!0);if(e.getAnnotationUuid&&e.getAnnotationUuid()&&"tpsAnnotationSet"!==e.getAnnotationClassType()&&"tpsRoot"!==e.getAnnotationClassType()){var n=e.getAttributeCategory(),o=e.getAnnotationUuid();T[n]||(T[e.getAttributeCategory()]={}),T[n][o]||(T[n][o]=[t].concat(c.getPointedPaths(t)))}t.getChildrenPathes().forEach(O)}}var I=[];function w(){b&&(clearTimeout(b),b=null),d&&E&&0!==Object.keys(T).length&&(b=setTimeout((function(){var t=[];I&&I.length&&I.forEach((t=>{t&&t.parents&&t.parents.length&&t.parents[0].removeChild(t)})),I=[];var o=n.get().filter((t=>!0===t.annotXHighlight));o&&o.length&&n.remove(o),e.get().forEach((function(e){let n=[],o=e.pathElement.getLastElement(!0);o.getAnnotationUuid?(n=c.getAllRelatedPaths(e.pathElement,e.filterOpts),o.getAnnotationSurfaceNormalRep()&&(I.push(o.getAnnotationSurfaceNormalRep()),e.pathElement.getParentPath().addChild(o.getAnnotationSurfaceNormalRep()))):d&&d.getRootBagPath().isAParentOf(e.pathElement)&&(n=c.getPointedPaths(e.pathElement),n.push(e.pathElement)),t=t.concat(n.map((function(t){return{pathElement:t.clone(),annotXHighlight:!0}})))})),t&&t.length&&n.add(t),d&&d.getViewer().render()})))}function k(t){P&&S&&P.deleteOverrides(S),S.length=0;var e=n.get().map((function(t){if(!0===t.displayMode)return t}));e&&e.length&&n.remove(e),t||(l.applyVisibilityToPaths(R.visible,0),R.visible.length=0,l.applyVisibilityToPaths(R.hidden,1),R.hidden.length=0),d&&d.getViewer().render()}var V=this.onAnnotationSetLoaded;this.onAnnotationSetLoaded=function(t){V(t),t&&t.path&&t.path.getLastElement(!0)&&(O(t.path),t.path.getLastElement(!0).getRootAnnotationNode&&t.path.getLastElement(!0).getRootAnnotationNode("RootAttributes").setVisibility(!0))};var F=this.onAnnotationSetRemoved;this.onAnnotationSetRemoved=function(t){var e,n;F(t),t&&t.nodes&&t.nodes.length&&(e=t.nodes,n=function(t){if(t&&t.getAnnotationUuid&&t.getAnnotationUuid()&&"tpsAnnotationSet"!==t.getAnnotationClassType()&&"tpsRoot"!==t.getAnnotationClassType()){var e=t.getAttributeCategory(),o=t.getAnnotationUuid();T[e]&&T[e][o]&&delete T[e][o]}t&&t.children.forEach(n)},e&&e.length&&e.forEach(n))},this._getParentAnnotationSetPath=function(t){for(var e=t.clone();e&&(!e.getLastElement(!0).getAnnotationClassType||"tpsAnnotationSet"!==e.getLastElement(!0).getAnnotationClassType());)e=e.getParentPath();return e};var U=this.setActiveState;this.setActiveState=function(t){if(U(t),t!==p)if(t){!function(){if(!d)return;let t,e=d.getExecutionContext?d.getExecutionContext():void 0;e&&(t=e.getComponent(WAfrStandardComponentKey.HandlerComponent),t.isCheckExecutable("AnnotationFilter")||t.enableCheck("AnnotationFilter"),t.setCheckState({id:"AnnotationFilter",state:"false"!==localStorage.getItem("CAT3DAnnotationFilterCmd")}),t.setCheckState({id:"AnnotationBlanking",state:"true"===localStorage.getItem("CAT3DAnnotationBlankingCmd")}),t.isCheckExecutable("AnnotationBrowser")||t.enableCheck("AnnotationBrowser"),t.setCheckState({id:"AnnotationBrowser",state:"false"!==localStorage.getItem("CAT3DAnnotationBrowserCmd")}))}(),(C=d.isDefaultContextualBarVisible())&&d.setDefaultContextualBarVisibility(!1),(v=d.isOpenWithMenuAvailable())||d.setOpenWithMenuAvailability(!0),(y=d.isRobotVisible())&&d.setRobotVisibility(!1),d.getFrameWindow().getContextualUIManager().register({onContextualBarReady:function(){var t=c.getContextualCommandList();return t.WAfrCtxBarRow1?t:{cmdList:t}},context:d.getCommandContext?d.getCommandContext():null,workbenchName:f,module:A,cmdPrefix:"",subscriberId:A,merge:!0});var n=i.giveSlideShowController({context:d.getFrameWindow(),id:"CAT3DAnnotationSlideShow"});n&&n.setListOfCommandsAllowed(["CAT3DAnnotationWidgetDefaultHdr"]),o.get3DAnnotFilterController({context:d}),m||((m={}).onPostAdd=e.onPostAdd(w),m.onPostRemove=e.onPostRemove(w)),P||(P=new s(d.getRootBagPath().getLastElement(!0)),d.getViewer().getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(P)),p=!0}else t||(k(),d&&(d.getViewer().getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(P),P=null,d.getFrameWindow().getContextualUIManager().unregister(A)),void 0!==C&&d.setDefaultContextualBarVisibility(C),C=void 0,void 0!==v&&d.setOpenWithMenuAvailability(v),v=void 0,void 0!==y&&d.setRobotVisibility(y),y=void 0,m&&(e.unsubscribe(m.onPostAdd),e.unsubscribe(m.onPostRemove),m=null),T={},p=!1)};var B=this.clearController;function G(t,e,n){t&&(t.getLastElement(!0).getAnnotationUuid&&-1!==e.indexOf(t.getLastElement(!0).getAnnotationUuid())&&n.push(t.clone()),t.getChildrenPathes().forEach((function(t){G(t,e,n)})))}function N(t,e){if(!t)return!1;if(!(e&&t.getLastElement(!0).getAttributeCategory&&e[t.getLastElement(!0).getAttributeCategory()]))return!0;if(e&&t.getLastElement(!0).getAttributeCategory&&e[t.getLastElement(!0).getAttributeCategory()])for(var n=0;n<e[t.getLastElement(!0).getAttributeCategory()].length;n++)if(e[t.getLastElement(!0).getAttributeCategory()][n].type===t.getLastElement(!0).getAttributeType())return e[t.getLastElement(!0).getAttributeCategory()][n].state;return!0}function H(t,e){for(var n=t.getChildrenPathes(),o=0;o<n.length;o++)n[o].getLastElement(!0).getAttributeCategory&&e.push(n[o].clone()),H(n[o],e)}this.clearController=function(){B(),d=c=null},this.getPointedPaths=function(t){var e=[];if(d.getRootBagPath().isAParentOf(t)){var n=t.getLastElement(!0);n.getAnnotationClassType&&"tpsAttribute"===n.getAnnotationClassType()&&(e=e.concat(c.getRelatedGeometryPaths(t)))}return e};let M=[];function _(t,e){return new Promise((n=>{if(e&&e.length){const i=c._getParentAnnotationSetPath(t),a=i&&i.getLastElement(!0);if(a){let t=[],i=[];e.forEach((e=>{const n=a.getPointedCompIds(e.compRelId[0]);if(n&&n.length){t.push(n[n.length-1]);let e=d.getController().getNode({id:n[n.length-1]});e&&r.is3DLeaf(e)&&i.push(e)}})),(o=t,new Promise((function(t){if(o&&o.length){for(var e=[],n=0;n<o.length;n++)-1===M.indexOf(o[n])&&e.push(o[n]);if(e.length){var i=d.getController();e.forEach((function(t){i.lockRepresentationMeshInRAM(t)})),M=M.concat(e),i.lockNodes({ids:o}),i.setForceReferencesLoad({data:o.map((function(t){return{id:t,state:!0}})),callback:t})}else t()}}))).then((()=>{d.getController().switchNodeVisuStreamOnDemand({data:i.map((function(t){return{node:t,stream:"cgr"}})),callbacks:{onURLLoad:function(){},onComplete:async()=>{await function(t){return new Promise((e=>{if(t&&t.length){for(var n=[],o=t.length-1;o>=0;o--)-1!==M.indexOf(t[o])&&(n.push(t[o]),M.splice(M.indexOf(t[o]),1));if(n.length){var i=d.getController();n.forEach((function(t){i.unlockRepresentationMeshInRAM(t)})),i.unlockNodes({ids:t}),i.setForceReferencesLoad({data:t.map((function(t){return{id:t,state:!1}})),callback:e})}else e()}else e()}))}(t);let o=[];i.forEach(((t,n)=>{const i=l.buildPathesLeadingToNode(t);if(i&&i[0]){let t=c.getCGRPath(i[0]);if(t){let i=t.getLastElement(!0).getPathElement([e[n].extGeomPath],t);o=o.concat(i)}}})),n(o)},onFailure:()=>{n([])},onTimeout:()=>{n([])}}})}))}else n([])}else n([]);var o}))}function W(t){var e,n=[];if("rep"===t.getType()){var o=t.getPrimitives();for(e=0;e<o.length;e++)n=n.concat(THREEDS.SubElement.getFromSGNode(o[e]))}for(e=0;e<n.length;e++)if(2===n[e].getCellDimension())return!1;return!0}function q(t,e,n,o,i){if(t&&n&&e){var a=t.getLastElement(!0),r=[];if(a.getPointedFeatureIds){var l=a.getPointedFeatureIds();if(l&&l.length){var s=[];l.forEach((function(t){o&&o!==t.name||(s=s.concat(t.uuids))})),s&&s.length&&e.getChildrenPathes().some((function(t){if("RootAttributes"===t.getLastElement(!0).getAnnotationType()){var e=[];return G(t,s,e),r=r.concat(e),!0}}))}}if(i){var g=[];r.forEach((function(t){if(t.getLastElement(!0).getAttributeCategory&&i[t.getLastElement(!0).getAttributeCategory()])for(var e=t.getChildrenPathes(),n=0;n<e.length;n++)for(var o=0;o<i[t.getLastElement(!0).getAttributeCategory()].length;o++){i[t.getLastElement(!0).getAttributeCategory()][o].type===e[n].getLastElement(!0).getAttributeType()&&g.push(e[n].clone());break}})),r=r.concat(g)}r.forEach((function(t){-1===n.indexOf(t)&&n.push(t)}))}}function j(t){if(t){var e,o=t.paths;if(k(),o&&o.length){var i,a,r,s,g,h=[],u=[],f=[],A=[],d=[],p=[],m=o.slice(),C=[];for(o.forEach((function(e){for(var n=e.clone();n&&"tpsAnnotationSet"!==n.getLastElement(!0).getAnnotationClassType();)n=n.getParentPath();var o=[];H(e,o),o.forEach((function(t){-1===m.indexOf(t)&&m.push(t)})),o.forEach((function(e){q(e,n,m,null,t.opts)})),s=e.getLastElement(!0);var i=L.displayParentObjTypes[s.getAttributeCategory()]?L.displayParentObjTypes[s.getAttributeCategory()][s.getAttributeType()]:null,a=[];if(q(e,n,a,null,t.opts),i&&i.parentType){for(var r=e.clone();r&&r.getLastElement(!0).getAttributeType;){if(r.getLastElement(!0).getAttributeType()===parseFloat(i.parentType)){p.push(r);break}r=r.getParentPath()}d=d.concat(T[s.getAttributeCategory()][s.getAnnotationUuid()]),o.forEach((function(e){if(N(e,t.opts)){var n=e.getLastElement(!0);n.getAttributeCategory&&(d=d.concat(T[n.getAttributeCategory()][n.getAnnotationUuid()]))}})),a.forEach((function(e){if(e.getLastElement(!0).getAttributeCategory&&e.getLastElement(!0).getAttributeCategory()===s.getAttributeCategory()&&N(e,t.opts)){var n=T[e.getLastElement(!0).getAttributeCategory()][e.getLastElement(!0).getAnnotationUuid()];if("true"===i.highlightOnlyLineicReps)for(var o=0;o<n.length;o++)!n[o].getLastElement(!0).getAnnotationClassType&&W(n[o].getLastElement())&&d.push(n[o]);else d=d.concat(n)}}))}else a.forEach((function(t){-1===m.indexOf(t)&&m.push(t)}));var l=[];q(e,n,l,"Highlight"),l&&l.length&&l.forEach((function(e){if(e&&e.getLastElement(!0)&&e.getLastElement(!0).getAttributeCategory){var n=[];H(e,n),n.forEach((function(e){N(e,t.opts)&&(d=d.concat(T[e.getLastElement(!0).getAttributeCategory()][e.getLastElement(!0).getAnnotationUuid()]))}))}}))})),i=0;i<m.length;i++)(e=m[i]).getLastElement(!0).getAttributeType&&(C[e.getLastElement(!0).getAttributeCategory()]||(C[e.getLastElement(!0).getAttributeCategory()]=[]),-1===C[e.getLastElement(!0).getAttributeCategory()].indexOf(e.getLastElement(!0).getAttributeType())&&C[e.getLastElement(!0).getAttributeCategory()].push(e.getLastElement(!0).getAttributeType())),s=m[i].getLastElement(!0),h.push(s.getAnnotationUuid()),u.includes(s.getAttributeCategory())||u.push(s.getAttributeCategory());if(u.forEach((function(e){var n=T[e];if(n){var l,s,g=Object.keys(n);for(i=0;i<g.length;i++){l=-1!==h.indexOf(g[i]);var u=!0;if((s=n[g[i]])[0].getLastElement(!0).getAttributeType){var c=!1;if(t.opts&&t.opts[e]&&t.opts[e].length){var v=m.slice().concat(p);for(a=0;a<v.length;a++)if(v[a].isAParentOf(s[0])||v[a].isEqual(s[0])){for(r=0;r<t.opts[e].length;r++)if(t.opts[e][r].type===s[0].getLastElement(!0).getAttributeType()){l=t.opts[e][r].isolateElts&&C[e]&&-1!==C[e].indexOf(t.opts[e][r].type)?t.opts[e][r].state&&-1!==h.indexOf(s[0].getLastElement(!0).getAnnotationUuid()):t.opts[e][r].state,c=!0;break}break}}if(L.forceVisiblityTypes[e]&&"true"===L.forceVisiblityTypes[e][s[0].getLastElement(!0).getAttributeType()]&&(l=!0),!l&&!c)for(a=0;a<p.length;a++)if(p[a].isAParentOf(s[0])||p[a].isEqual(s[0])){u=!1;break}}if(u)for(a=0;a<s.length;a++){const t=s[a];if(t){let n=t.getLastElement(!0);if(n.getAttributeCategory&&n.getAttributeType){let e=L.filterRepresentationVisibility[n.getAttributeCategory()]?L.filterRepresentationVisibility[n.getAttributeCategory()][n.getAttributeType()]:null;if(l&&e&&n.getAnnotationAttributeNode){let i=n.getAnnotationAttributeNode();i&&i.setVisibility("true"!==e.hideOnParentSelection||o.some((e=>e.isEqual(t))))}}t.internalPath.length?"3DAnnotations"===e?l&&-1===d.indexOf(t)&&d.push(t):-1===R[l?"visible":"hidden"].indexOf(t)&&R[l?"visible":"hidden"].push(t):t.externalPath.length&&(l&&-1===f.indexOf(t)?f.push(t):l||-1!==A.indexOf(t)||A.push(t))}}}}})),A.length){var v=A.filter((function(t){return!f.some((function(e){return t.isAParentOf(e)}))}));if(v.length){if(!(g=P.createOverride({pathes:v})))return void window.console.error("override not correct");S.push(g),g.setVisibility(!1)}}if(f.length){if(!(g=P.createOverride({pathes:f})))return void window.console.error("override not correct");S.push(g),g.setVisibility(!0)}for(i=R.hidden.length-1;i>=0;i--)l.getVisibilityFromPath(R.hidden[i])||R.hidden.splice(i,1);for(R.hidden.length&&l.applyVisibilityToPaths(R.hidden,0),i=R.visible.length-1;i>=0;i--)l.getVisibilityFromPath(R.visible[i])&&R.visible.splice(i,1);R.visible.length&&l.applyVisibilityToPaths(R.visible,1),d.length&&n.add(d.map((function(t){return{pathElement:t,displayMode:!0}}))),c._publish("onDisplayedAnnotationsOrFeaturesChanged",{paths:o})}}}this.getAllRelatedPaths=function(t,e){var n=[];if(t&&t.getLastElement(!0).getAnnotationUuid){var o,i,a=[t.clone()];"tpsAttribute"===t.getLastElement(!0).getAnnotationClassType()&&H(t.clone(),a);for(var r=0;r<a.length;r++)if(N(a[r],e)&&(i=a[r].getLastElement(!0),(o=T[i.getAttributeCategory()]?T[i.getAttributeCategory()][i.getAnnotationUuid()]:null)&&o.length)){const t=o.find((t=>Array.isArray(t)));_(a[r],t).then((e=>{if(!e||!e.length)return;let n=T[i.getAttributeCategory()]?T[i.getAttributeCategory()][i.getAnnotationUuid()]:null;n&&n.splice(n.indexOf(t),1,...e),w()})),n=n.concat(o.filter((t=>!Array.isArray(t))))}}return n};var X=this.onAdditionalInfosRequired;this.onAdditionalInfosRequired=function(t){return"AnnotFilter"===t.controller||"AnnotAttrBrowser"===t.controller?{getJSONModel:c._getJSONModel}:X(t)},this.disableCtxCommandsAvailability=function(t){D=!0===t?t:t.slice()};var J=this.getAnnotControllerPrototype;this.getAnnotControllerPrototype=function(){var t=J();return t.getPointedPaths=function(t){if(c)return c.getPointedPaths(t)},t.getAllRelatedPaths=function(t,e){if(c)return c.getAllRelatedPaths(t,e)},t.getRelatedGeometryPaths=function(t){if(c)return c.getRelatedGeometryPaths(t)},t.getPontingAnnotations=function(t,e){if(c)return c.getPontingAnnotations(t,e)},t.getAssociatedInformations=function(t,e){if(c)return c.getAssociatedInformations(t,null,e)},t.isolatePaths=j,t.disableCtxCommandsAvailability=c.disableCtxCommandsAvailability,t},this.getPontingAnnotations=function(t,e){var n,o,i,a,l,s=[],g=[],h=t.internalPath;for(i=0;i<h.length;i++)null!=(n=h[i].getCGMID?h[i].getCGMID():null)&&(o=h[i].getType(),s.push(n),g.push(o));for(var u=t.clone();u&&!r.getNodeID(u.getLastElement(!0));)u=u.getParentPath();if(!u)return[];var f,A=u.getChildrenPathes();for(i=0;i<A.length;i++)A[i].getLastElement(!0).getAnnotationClassType&&"tpsAnnotationSet"===A[i].getLastElement(!0).getAnnotationClassType()&&(f=A[i]);if(f){var d=f.getLastElement(!0).getTTRSs();if(d){var c=[];for(i=0;i<d.length;i++){if(d[i].geoP&&d[i].geoP.length)for(let t=0;t<d[i].geoP.length;t++){let n=d[i].geoP[t];if(e){let t=!0;for(a=0;a<n.length;a++)if(n[a]!==s[a]){t=!1;break}t&&"primitive"===g[g.length-1]&&-1===c.indexOf(d[i].tpsID)&&c.push(d[i].tpsID)}else n.equals(s)&&"primitive"===g[g.length-1]&&-1===c.indexOf(d[i].tpsID)&&c.push(d[i].tpsID)}d[i].geomLinks&&d[i].geomLinks.length&&c.push(d[i].tpsID)}if(c.length){var p=[],m=function(t,e){var n=t?t.getLastElement(!0):null;if(n&&n.getAnnotationClassType){var o=void 0!==n.getAnnotationTTRS?n.getAnnotationTTRS():null;if(o&&-1!==o.indexOf(e)){for(var i=!1,a=p.length-1;a>=0;a--){if(p[a].isEqual(t)){i=!0;break}p[a].isAParentOf(t)&&p.splice(a,1)}i||p.push(t)}for(var r=t.getChildrenPathes(),l=0;l<r.length;l++)m(r[l],e)}};for(l=0;l<c.length;l++){var C=f.getChildrenPathes();for(i=0;i<C.length;i++)if((o=C[i].getLastElement(!0).getAnnotationType())&&"RootViews"!==o&&"RootCaptures"!==o){var v=C[i].getChildrenPathes();for(a=0;a<v.length;a++)m(v[a],c[l])}}return p}}}return[]},this.getRelatedGeometryPaths=function(t){var e=[];return(t&&t.length?t:[t]).forEach((t=>{if(t){var n=t.getLastElement(!0);if(!n.getAnnotationClassType)return e;var o=c._getParentAnnotationSetPath(t),i=void 0!==n.getAnnotationTTRS&&n.getAnnotationTTRS()?n.getAnnotationTTRS():[],a=void 0!==n.getAnnotationTTRSRep?n.getAnnotationTTRSRep():null;if(a&&a.length&&(i=i.concat(a)),i&&i.length){var r=o.getLastElement(!0).getTTRSs(),l=[],s=[],g=[];for(let t=0;t<i.length;t++)for(let e=0;e<r.length;e++)if(i[t]===r[e].tpsID){r[e].geoP&&r[e].geoP.length&&(l=l.concat(r[e].geoP)),r[e].referencedCGs&&r[e].referencedCGs.length&&(s=s.concat(r[e].referencedCGs)),r[e].geomLinks&&r[e].geomLinks.length&&g.push(r[e].geomLinks);break}if(l.length){var h=c.getCGRPath(o);if(h){var u=h.getLastElement(!0),f=u.getPathElement(l,h);if(!f||f&&!f.length){let t=o.getLastElement(!0).getRootAnnotationNode("RootGeometries"),n=t.children;for(let i=0;i<n.length;i++){if(x(n[i])&&(f=u.getPathElement(l,h))&&f.length){var A=o.clone();A.addElement(t),A.addElement(n[i]),e.push(A),e=e.concat(c.getRelatedGeometryPaths(A));break}}}else e=e.concat(f)}}if(s.length){let t=o.getChildrenPathes();for(let n=0;n<t.length;n++)if(t[n].getLastElement(!0).getAnnotationType&&"RootGeometries"===t[n].getLastElement(!0).getAnnotationType()){let o=t[n].getChildrenPathes();for(let t=0;t<o.length;t++)o[t].getLastElement(!0).getAnnotationID&&-1!==s.indexOf(o[t].getLastElement(!0).getAnnotationID())&&e.push(o[t].clone())}}g.length&&(e=e.concat(g))}}})),e},this.getAnnotationControllerType=function(){return"3DAnnotationExperience"};var z=this._disableAnnotUI,K=!1;this._disableAnnotUI=function(){z();var t=o.give3DAnnotFilterController({context:d});t&&t.getActiveState()&&(K=t.getPanelVisibilityFlag(),t.setPanelVisibilityFlag(!1)),(t=a.give3DAnnotAttrBrowserController({context:d}))&&t.getActiveState()&&(u=t.getPanelVisibilityFlag(),t.setPanelVisibilityFlag(!1))};var Q=this._enableAnnotUI;this._enableAnnotUI=function(){Q();var t=o.give3DAnnotFilterController({context:d});t&&t.setPanelVisibilityFlag(K),void 0!==u&&(t=a.give3DAnnotAttrBrowserController({context:d}))&&t.setPanelVisibilityFlag(u)};var Y=this._onCommandStartCB;this._onCommandStartCB=function(t){"CAT3DAnnotationLevelSelectorHdr"===t._id&&(E=!1,t.onEnd((function(){E=!0}))),Y(t)};var Z=this.getAssociatedInformations;this.getAssociatedInformations=function(t,e,n){var i=e;return i||(i=o.give3DAnnotFilterController({context:d})),Z(t,i,n)},this.getContextualCommandList=function(){var t,n=[];if(!d||!0===D)return n;var o=d.getRootBagPath();const i=e.get().map((t=>{if(o.isAParentOf(t.pathElement)||t.pathElement.getLastElement(!0).getAnnotationClassType)return t.pathElement})).filter((t=>{if(t)return t}));if(0===i.length)return n;var a=!1,r=!1,l=!1;for(t=0;t<i.length;t++){if(!a){var s,g=c._getSelectedAnnotationsVisibilityFlag();if(!0===g||!1===g||void 0===g)s=1===i.length&&(i[0].getLastElement(!0).getAnnotationClassType&&"tpsAnnotationSet"===i[0].getLastElement(!0).getAnnotationClassType()||!i[0].getLastElement(!0).getAnnotationClassType)?g?"CAT3DAnnotationSetHideHdr":"CAT3DAnnotationSetShowHdr":g?"CAT3DAnnotationHideHdr":"CAT3DAnnotationShowHdr",n.push({line:1,name:g?"CAT3DAnnotationHideStr":"CAT3DAnnotationShowStr",hdr_list:[s],type:"handler",identifier:s}),a=!0}var h=i[t].getParentPath(),u=i[t].getLastElement(!0);u.getAttributeCategory&&L.typesWithAdditionalInformation[u.getAttributeCategory()]&&L.typesWithAdditionalInformation[u.getAttributeCategory()][u.getAttributeType()]&&(l=!0),(u.getAnnotationClassType&&"tpsAnnotationSet"!==u.getAnnotationClassType()&&"tpsAttribute"!==u.getAnnotationClassType()||!u.getAnnotationClassType)&&1===i.length&&(r||h&&"RootBag"!==h.getLastElement(!0).name&&((u.getAnnotationClassType&&"tpsAnnotationSet"!==u.getAnnotationClassType()||-1===D.indexOf("CAT3DAnnotationLevelSelectorHdr"))&&n.push({line:1,name:"CAT3DAnnotationLevelSelectorStr",hdr_list:["CAT3DAnnotationLevelSelectorHdr"],type:"handler",identifier:"CAT3DAnnotationLevelSelectorHdr"}),r=!0)),1===i.length&&"RootBag"===h.getLastElement(!0).name&&-1===D.indexOf("RemoveRootHdr")&&n.push({name:"CAT3DAnnotationRemoveRootStr",line:1,hdr_list:["RemoveRootHdr"],type:"handler",identifier:"ENO3DRemoveRootCmd"})}return l&&n.push({name:"CAT3DAnnotShowAttrRelatedInfosStr",line:1,hdr_list:["CAT3DAnnotShowAttrRelatedInfosHdr"],type:"handler",identifier:"AttrRelatedInfos"}),d.getExecutionContext?{WAfrCtxBarRow1:{model:n}}:n}}})})),define("DS/CAT3DAnnotationExpController/CAT3DAnnotationExpController",[],(function(){}));